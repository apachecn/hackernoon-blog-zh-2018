<html>
<head>
<title>Chatbot with Angular 5 &amp; DialogFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Angular 5和DialogFlow的聊天机器人</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/chatbot-with-angular-5-dialogflow-fdac97fef681?source=collection_archive---------1-----------------------#2018-01-04">https://medium.com/hackernoon/chatbot-with-angular-5-dialogflow-fdac97fef681?source=collection_archive---------1-----------------------#2018-01-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/0b937979fb91b8222c42d5101a531a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*D8fHIsIuZ_QTPXcKJ-2o9A.png"/></div></figure><p id="d74c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我看到了许多关于如何为各种各样的协作平台构建聊天机器人的帖子，如<strong class="ja hv"> Slack </strong>、<strong class="ja hv"> Facebook Messenger </strong>、<strong class="ja hv"> HipChat </strong> …所以我决定使用<strong class="ja hv"> Angular </strong>最新版本<strong class="ja hv"> v5.0.0、</strong>T10】dialog flow和<strong class="ja hv"> AWS </strong>从零开始构建一个聊天机器人。</p><p id="bc85" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">下面是我们的<a class="ae jw" href="http://smartbot-mlabouardy.s3-website-us-east-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">聊天机器人</a>在这篇文章结束时的样子:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff jx"><img src="../Images/29fc497f23c5f83ff7602e4907eb596c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*blUU1TvCMn87urlElADdTA.gif"/></div></div></figure><p id="0e6a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:这个项目是开源的，可以在我的<a class="ae jw" href="https://github.com/mlabouardy/dialogflow-angular5" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到。</p><p id="6509" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">首先，使用<a class="ae jw" href="https://github.com/angular/angular-cli" rel="noopener ugc nofollow" target="_blank"> Angular CLI </a>创建一个全新的Angular项目:</p><blockquote class="kg kh ki"><p id="d2f1" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">ng新智能机器人— style=scss</p></blockquote><p id="4405" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1 —聊天机器人架构</strong></p><p id="d040" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们将把聊天应用拆分成不同的组件，每个组件都能够使用属性指令与其他组件进行通信:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff kn"><img src="../Images/e8091e3cac71616d8122add3a01a581f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*kvG6eG9yVEW4l6mM."/></div></figure><p id="af70" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 2 —消息实体</strong></p><p id="8b26" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">通过发出以下命令创建一个空类:</p><blockquote class="kg kh ki"><p id="8370" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">ng生成类模型/消息</p></blockquote><p id="254c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">消息实体有3个字段:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="e9c4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 3 —消息列表组件</strong></p><p id="6943" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">生成新组件:</p><blockquote class="kg kh ki"><p id="4833" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">ng生成组件组件/消息列表</p></blockquote><p id="08a1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在我们可以通过迭代来显示消息:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="65ed" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">该组件的代码应该如下所示:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="7754" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意使用的是<em class="kj"> @app/models </em>而不是相对路径，它叫做<strong class="ja hv">别名</strong>。为了能够使用别名，我们必须将<em class="kj">路径</em>属性添加到我们的<em class="kj"> tsconfig.json </em>文件中，如下所示:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="ca04" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:我还添加了<em class="kj"> @env </em>别名，以便能够从应用程序中的任何地方访问环境变量。</p><p id="d3ea" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 4 —消息项组件</strong></p><p id="f6a6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们构建一个组件，它只在我们的消息列表中显示一条消息:</p><blockquote class="kg kh ki"><p id="a6c6" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">ng生成组件组件/消息项</p></blockquote><p id="e104" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在<em class="kj">message-item.component.html</em>中，增加以下内容:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="e79d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">组件的代码应该如下所示:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="13dc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 5 —消息表单组件</strong></p><p id="39c9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们构建负责发送消息的表单:</p><blockquote class="kg kh ki"><p id="3a6f" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">ng生成组件组件/消息项</p></blockquote><p id="5698" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在message-form.component.html的<em class="kj"/>中，增加以下内容:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="d919" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">及其在<em class="kj">message-form . component . ts:</em>中对应的类型脚本代码</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="df74" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">每次用户点击发送按钮时，都会调用<strong class="ja hv"> sendMessage() </strong>方法。</p><p id="fe4e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">就是这样！自己试试，你会发现它很有效。</p><blockquote class="kg kh ki"><p id="9219" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">发球</p></blockquote><p id="9aad" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">此时，你不会得到任何回应，这就是NLP的用武之地。</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kq"><img src="../Images/bc50bff983ed2ddb22c1a9512dce3d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ykuTbhfW-MKKk1qVxcksw.png"/></div></div></figure><p id="4e8b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6 — NLP后端</strong></p><p id="fe3f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我选择与<a class="ae jw" href="https://dialogflow.com/" rel="noopener ugc nofollow" target="_blank">对话流。</a>注册<strong class="ja hv"> DialogFlow </strong>并创建一个新代理:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kr"><img src="../Images/56c36e40c9ecd0044af2fa0f3d53ff6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hYyemZBEDfOdpUxU."/></div></div></figure><p id="e92b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然后，启用<strong class="ja hv">闲聊</strong>功能进行简单的闲聊:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff ks"><img src="../Images/1389bf98c9ff1d19a94d2313e49cfde8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cmi4XRBKu8AkKosS."/></div></div></figure><p id="eb71" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:如果你不喜欢这些问题的回答，你可以很容易地修改它们。为了更进一步，你可以创建你自己的<strong class="ja hv">意图</strong> &amp; <strong class="ja hv">实体</strong>，如我在<a class="ae jw" href="http://www.blog.labouardy.com/bot-in-messenger-with-dialogflow-golang/" rel="noopener ugc nofollow" target="_blank">之前的教程</a>中所述。</p><p id="ce49" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">复制<strong class="ja hv"> DialogFlow客户端访问令牌</strong>。它将用于进行查询。</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kt"><img src="../Images/4a081cb1b5257d3c06ae507c7b8ff79b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mus40T-LGCoWCKE9."/></div></div></figure><p id="ad9c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">将令牌传递到您的<em class="kj">环境/environment.ts </em>文件中:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="8c5e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 7 — DialogFlow服务</strong></p><p id="9b1e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">生成<strong class="ja hv"> DialogFlow服务</strong>，该服务将调用<strong class="ja hv"> DialogFlow API </strong>来检索相应的响应；</p><blockquote class="kg kh ki"><p id="9394" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">ng生成服务服务/对话流</p></blockquote><p id="5dab" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">它使用<strong class="ja hv"> DialogFlow API </strong>来处理文本形式的自然语言。每个API请求都在<strong class="ja hv"> HTTP头</strong>中包含<strong class="ja hv">授权</strong>字段。</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="0551" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">将<strong class="ja hv"> MessageFormComponent </strong>中的<em class="kj"> sendMessage() </em>方法更新如下:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="35e9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">最后，在<em class="kj">app.component.html中，</em>复制并粘贴以下代码，以包含<em class="kj">消息列表</em>和<em class="kj">消息格式</em>指令:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="0cad" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 8 —部署到AWS </strong></p><p id="c72b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">生成生产级工件:</p><blockquote class="kg kh ki"><p id="c8b5" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">ng build — env=prod</p></blockquote><p id="f90f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">构建工件将存储在<em class="kj"> dist/ </em>目录中</p><p id="a8d5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">接下来，用<strong class="ja hv"> AWS CLI </strong>创建一个<strong class="ja hv"> S3铲斗</strong>:</p><blockquote class="kg kh ki"><p id="8a69" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">AWS S3 MB S3://smart bot-mlabouardy</p></blockquote><p id="16c0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">将构建工件上传到存储桶:</p><blockquote class="kg kh ki"><p id="a904" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">AWS S3 CP dist/S3://smart bot-mlabouardy-recursive-grants read = uri = http://ACS . Amazon AWS . com/groups/global/all users</p></blockquote><p id="e5ea" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">最后，为您的存储桶打开网站托管:</p><blockquote class="kg kh ki"><p id="58b1" class="iy iz kj ja b jb jc jd je jf jg jh ji kk jk jl jm kl jo jp jq km js jt ju jv hn dt translated">aws s3网站S3://smart bot-mlabouardy-index-document index.html</p></blockquote><p id="e634" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果您将浏览器指向<a class="ae jw" href="http://smartbot-mlabouardy.s3-website-us-east-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv"> S3桶URL </strong> </a>，您应该会看到聊天框:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff ku"><img src="../Images/08f4a0d7ba279c6726eaa806ab630d4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bUWQOyXc2cHLoHfR."/></div></div></figure></div></div>    
</body>
</html>