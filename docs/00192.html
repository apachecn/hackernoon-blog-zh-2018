<html>
<head>
<title>Deploy to EC2 with AWS CodeDeploy from Bitbucket Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS代码从位存储桶管道部署到EC2</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploy-to-ec2-with-aws-codedeploy-from-bitbucket-pipelines-4f403e96d50c?source=collection_archive---------2-----------------------#2018-01-07">https://medium.com/hackernoon/deploy-to-ec2-with-aws-codedeploy-from-bitbucket-pipelines-4f403e96d50c?source=collection_archive---------2-----------------------#2018-01-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/0467bfb05154e783de68a1272d6e1b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c0NMl8M-Z64cnE3XcYG-Eg.png"/></div></div></figure><div class=""/><p id="9e49" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在持续交付和容器以及不可变环境的概念出现之前，人们在发布时用最新的代码手动更新环境。这是一个非常常见的地方，我敢打赌，大多数软件商店仍然以这种方式工作。</p><p id="3cff" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从这种状态到连续交付的一个非常简单的步骤是自动化该过程中的手工步骤。也就是说，用最新最好的代码自动更新环境。</p><p id="6a2e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这很容易通过结合两个非常有用的工具来实现:AWS CodeDeploy和Bitbucket管道。</p><h1 id="51c8" class="ka kb if bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">先决条件</h1><p id="6130" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">在此部署管道可以运行之前，需要满足一些要求。我们将一起走过这些步骤。假设您具备一些基本的AWS知识。</p><h2 id="13ff" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">InternationalAssociationofMachinists国际机械师协会</h2><p id="29e8" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">需要创建一个用户，Bitbucket可以使用该用户将工件上传到S3，并通知CodeDeploy一个新的修订版已经准备好进行部署。</p><p id="72b3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先创建一个名为<em class="lr"> CodeDeployGroup </em>的IAM组。该组需要<code class="eh ls lt lu lv b">AmazonS3FullAccess</code>和<code class="eh ls lt lu lv b">AWSCodeDeployFullAccess</code>权限。创建一个用户并将其添加到该组。该用户只需要编程访问。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lw"><img src="../Images/08327117ec0ec633fd052bb3361bf15d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lLygUWel3nHU8MXSy3JtBA.png"/></div></div></figure><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mb"><img src="../Images/eb4cc99f6dfe4f74fe2fb54501291678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*unt1RlP18gdo2rQwmP4Icg.png"/></div></div></figure><p id="09dd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">记下该用户的访问密钥。以后还会需要。</p></div><div class="ab cl mc md hc me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><p id="357d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们将创建一个可以关联到EC2实例并与CodeDeploy交互的角色。</p><p id="d015" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在转到角色并单击<em class="lr">创建角色</em>之后，选择<code class="eh ls lt lu lv b">EC2</code> AWS服务，因为EC2是将与CodeDeploy交互的服务。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mj"><img src="../Images/1f84d508148a5145af243ebecf98c2e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZCPr3TcUEK-bSDAbI8G-aw.png"/></div></div></figure><p id="876e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保<strong class="je ig">可信实体</strong>和<strong class="je ig">策略</strong>分别为<code class="eh ls lt lu lv b">ec2.amazonaws.com</code>和<code class="eh ls lt lu lv b">AWSCodeDeployRole</code>T5。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mk"><img src="../Images/6aa30db0dbc1a3e0105e6b7c5ee64f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OKf4-fXuEn9UkfAe32P0AQ.png"/></div></div></figure><p id="2934" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建角色后，将<strong class="je ig">信任关系</strong>编辑如下。将区域更改为您正在使用的区域。</p><pre class="lx ly lz ma fq ml lv mm mn aw mo dt"><span id="ae28" class="ld kb if lv b fv mp mq l mr ms">{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Service": [<br/>            "ec2.amazonaws.com",<br/>            "codedeploy.us-west-2.amazonaws.com"<br/>        ]<br/>      },<br/>      "Action": "sts:AssumeRole"<br/>    }<br/>  ]<br/>}</span></pre></div><div class="ab cl mc md hc me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><p id="db5d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">概括地说，我们创建了一个新的IAM用户，该用户属于一个拥有完全CodeDeploy和S3权限的组。我们记下了该用户的访问密钥信息供以后使用。</p><p id="218a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我们为EC2创建了一个IAM角色，并编辑了信任关系以允许访问CodeDeploy。</p><h2 id="f136" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">S3</h2><p id="6014" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">需要创建一个存储桶来存储应用程序的<em class="lr">版本</em>。修订版只是运行代码所需要的东西加上<a class="ae mt" href="https://docs.aws.amazon.com/codedeploy/latest/userguide/application-specification-files.html" rel="noopener ugc nofollow" target="_blank"> AppSpec </a>文件的存档。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mu"><img src="../Images/388c0989463512c38f33408083f41ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K5qdjLSyXl96D5enhcRWrw.png"/></div></div></figure><p id="b1c1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在一个真实世界的例子中，您可能想要修补这个铲斗的生命周期管理，以帮助节省成本，但是现在一切都保持默认。</p><h2 id="0766" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">EC2</h2><p id="3124" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">需要启动CodeDeploy可以用作部署目标的EC2实例。</p><p id="bf17" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择Amazon Linux AMI和t2.micro实例类型。除了IAM角色之外，所有配置详细信息都是默认的，IAM角色将是前面创建的角色。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mv"><img src="../Images/a9810c50f3a3641301add44e3072361c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ljCDrZlYfSH7YgEHM1-f-Q.png"/></div></div></figure><p id="fd97" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">保留默认的存储设置。设置一个你会记住的标签。CodeDeploy使用此标记来标识要部署到的实例。我使用标签<code class="eh ls lt lu lv b">Name=Code Deploy Instance</code>。安全组应该允许SSH和访问应用程序所需的任何端口。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mw"><img src="../Images/4318d762b4677e8656ffe259d97ca0d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-1aXqZqDL4KegCrofaaBw.png"/></div></div></figure><p id="eedd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，需要在实例上安装CodeDeploy代理。为了不重复信息，请按照<a class="ae mt" href="https://docs.aws.amazon.com/codedeploy/latest/userguide/codedeploy-agent-operations-install.html" rel="noopener ugc nofollow" target="_blank">官方对您的平台</a>的指示进行操作。这个代理就是CodeDeploy在EC2实例上实际进行更改的方式。</p></div><div class="ab cl mc md hc me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><p id="cb73" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">配置EC2的要点是，必须附加一个IAM角色，以允许EC2与CodeDeploy通信，CodeDeploy代理需要在实例上运行，并且需要标记实例，以便CodeDeploy可以识别参与部署的实例。</p><h2 id="2863" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">代码部署</h2><p id="dd5c" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">如果这是您第一次使用CodeDeploy，您将看到以下屏幕。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mx"><img src="../Images/98e76698cf1e6e5ecebd3c76f1ccae47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J67o1y5HJ146r6N7eUXi9w.png"/></div></div></figure><p id="fe67" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择自定义部署。</p><p id="8988" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为应用程序和部署组命名。选择EC2/内部和就地部署。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff my"><img src="../Images/b2a2d75294356e81e690efc8b5b1b3ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hBEYPGowQhB-6DLzmB2cEQ.png"/></div></div></figure><p id="05f8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将部署到任何自动伸缩之外的现有EC2实例，因此选择<em class="lr"> Amazon EC2实例</em>选项，并提供标识您想要部署到的实例的标记。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mz"><img src="../Images/67c9764db115c02004cc077eba45fe96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N0fUVMPosTs5EFB_P3nUjw.png"/></div></div></figure><p id="ccaf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将部署配置设置为<code class="eh ls lt lu lv b">CodeDeployDefault.OneAtATime</code></p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff na"><img src="../Images/f1a66eeb4d9d2f286366e79dacf98885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GxoYHZRIEhCbeIZlcP5Z7Q.png"/></div></div></figure><p id="ec86" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">服务角色应该设置为之前创建的IAM角色。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nb"><img src="../Images/bdc553f35153f3cb27906105b3629871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2OBJOOCLjK7QbO1MhCoFoQ.png"/></div></div></figure></div><div class="ab cl mc md hc me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><p id="2bcc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这太多了。简而言之，我们所做的就是告诉CodeDeploy我们有了一个新的应用程序，以及哪些EC2实例参与了部署。</p><h2 id="543d" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">比特桶</h2><p id="eaea" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">我们现在需要告诉Bitbucket所有这些信息。为存储库设置以下环境变量。这些将由AWS SDK通过稍后显示的Python脚本来使用。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nc"><img src="../Images/328d517cb63fe837bb083336f9d74564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_8OSC4fDsg0HMZAacYPjzw.png"/></div></div></figure><p id="0a97" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ls lt lu lv b">AWS_SECRET_ACCESS_KEY</code>和<code class="eh ls lt lu lv b">AWS_ACCESS_KEY_ID</code>是本文开头创建的用户，不是你个人的AWS用户账号。</p><h1 id="c569" class="ka kb if bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">建造管道</h1><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nd"><img src="../Images/dbedbe75e116df23717a94bfcf9a157b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZiPgZaC6aVePEaz7CyFZ-Q.jpeg"/></div></div><figcaption class="ne nf fg fe ff ng nh bd b be z ek">Not this kind</figcaption></figure><p id="9291" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所有的基础工作都已完成，剩下的唯一工作就是构建管道来触发CodeDeploy。这分三步进行:</p><ol class=""><li id="d10d" class="ni nj if je b jf jg jj jk jn nk jr nl jv nm jz nn no np nq dt translated">将修订版<em class="lr">部署到S3</em></li><li id="90eb" class="ni nj if je b jf nr jj ns jn nt jr nu jv nv jz nn no np nq dt translated">告诉CodeDeploy新的修订版已经准备好了</li><li id="6df2" class="ni nj if je b jf nr jj ns jn nt jr nu jv nv jz nn no np nq dt translated">等待CodeDeploy执行部署</li></ol><p id="0cfc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">详细描述编程方式超出了本文的范围，所以只需下载<a class="ae mt" href="https://bitbucket.org/awslabs/aws-codedeploy-bitbucket-pipelines-python/src/73b7c31b0a72a038ea0a9b46e457392c45ce76da/codedeploy_deploy.py?at=master&amp;fileviewer=file-view-default" rel="noopener ugc nofollow" target="_blank">这个Python脚本</a>并将其放在项目目录的根目录下。这个脚本将执行上述所有步骤。请随意通读，以了解正在发生的事情。您将看到这个脚本使用了我们在Bitbucket中设置的环境变量。</p><h2 id="28bd" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">bitbucket-pipeline . yml</h2><p id="912b" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">第一步是写<code class="eh ls lt lu lv b">bitbucket-pipelines.yml</code>文件。对于我非常简单的Sinatra服务器来说，除了创建要发送到S3的修订版之外，什么也不用做。</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="nw nx l"/></div></figure><p id="9633" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你对AWS SDKs不熟悉，<code class="eh ls lt lu lv b">boto3</code>只是一个针对AWS的Python SDK。</p><p id="a5fa" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如您所见，我们已经用<code class="eh ls lt lu lv b">app.rb</code>、<code class="eh ls lt lu lv b">appspec.yml</code>和整个<code class="eh ls lt lu lv b">scripts/</code>目录创建了一个zip存档(这可以是任何主要的存档格式)。这个归档文件需要包含运行应用程序所需的所有代码和库，因为这是最终部署的归档文件。</p><h2 id="c4db" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">应用代码</h2><p id="c07d" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated"><code class="eh ls lt lu lv b">app.rb</code>是我为此创作的非常简单的Sinatra。这里没什么值得注意的。</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="nw nx l"/></div></figure><h2 id="8507" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">生命周期脚本</h2><p id="e42e" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">包含管理应用程序生命周期的所有脚本。在最基本的配置中，应该有启动服务器、停止服务器和安装服务器所需的依赖项的脚本。记得让这些脚本可执行。</p><p id="930e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我有以下脚本来管理我的Sinatra服务器。在实际环境中，您可能希望使用systemd或pm2之类的东西来管理服务器的启动和停止。</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="nw nx l"/></div></figure><h2 id="3bee" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">应用规范</h2><p id="fcd2" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated"><code class="eh ls lt lu lv b">appspec.yml</code>是CodeDeploy配置。这里可以配置几个生命周期事件挂钩，但是我们只担心三个。<code class="eh ls lt lu lv b">BeforeInstall</code>、<code class="eh ls lt lu lv b">ApplicationStop</code>和<code class="eh ls lt lu lv b">ApplicationStart</code>。</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="nw nx l"/></div></figure><p id="1a04" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ls lt lu lv b">BeforeInstall</code>在下一个版本移入之前运行。这是确保运行应用程序所需的一切就绪的好地方。</p><p id="3af4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ls lt lu lv b">ApplicationStop</code>是下载修订版前的第一步。这应该包含一些优雅地关闭应用程序的方法。</p><p id="91be" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在CodeDeploy流程接近尾声时运行，负责启动应用程序。</p><p id="4f48" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae mt" href="https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html" rel="noopener ugc nofollow" target="_blank">阅读更多关于这些生命周期事件挂钩和其他可用活动的信息</a>。</p><p id="17e7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此时，您的存储库应该类似于下面这样。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ny"><img src="../Images/765108b02bfce26194a5bc867982c8cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fojcGy4N5etOfv6mRo0w5w.png"/></div></div></figure><h2 id="52fd" class="ld kb if bd kc le lf lg kg lh li lj kk jn lk ll ko jr lm ln ks jv lo lp kw lq dt translated">运行管道</h2><p id="db09" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">此时，我们已经准备好将所有内容推送到Bitbucket并启动管道。希望一切都已正确配置，您将获得一个漂亮的绿色部署！</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nz"><img src="../Images/4e78036556bce3cd64bd3c6546a78742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LoyQExZRwIVc6c0BXaZmLQ.png"/></div></div></figure><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff oa"><img src="../Images/15088932c08a7afe9ee501bf5175cd9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Bzz3gJCJH5AbOWcemKG6A.png"/></div></div><figcaption class="ne nf fg fe ff ng nh bd b be z ek">Success!</figcaption></figure><p id="7787" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">干得好！现在，您已经使用CodeDeploy和Bitbucket管道成功地实现了自动化部署！这是一个非常基本的设置，但是你应该掌握足够的知识来实现你想要的。</p><p id="d1f2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请继续关注未来的文章，在那里我将讨论常见的CodeDeploy错误以及如何对它们进行故障排除。</p></div><div class="ab cl mc md hc me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><p id="600e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">感谢阅读！如果你喜欢你所读的，那么留下一个👏或者很少有人跟随。</p></div></div>    
</body>
</html>