<html>
<head>
<title>API Consumer-Contract Tests and Test-Doubles with Karate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">API消费者合同测试和空手道双打测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/api-consumer-contract-tests-and-test-doubles-with-karate-72c30ea25c18?source=collection_archive---------12-----------------------#2018-01-07">https://medium.com/hackernoon/api-consumer-contract-tests-and-test-doubles-with-karate-72c30ea25c18?source=collection_archive---------12-----------------------#2018-01-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/d1a7ce085ab1e50dfe111ce1f1290b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CML_b5QN52Q4R8VPSOs3cg.jpeg"/></div></div></figure><div class=""/><p id="943a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://github.com/intuit/karate" rel="noopener ugc nofollow" target="_blank">空手道</a>最近在GitHub上超过了<a class="ae ka" href="https://github.com/intuit/karate/stargazers" rel="noopener ugc nofollow" target="_blank"> 500颗星</a>，并且在<a class="ae ka" href="https://github.com/intuit/karate/wiki/Community-News" rel="noopener ugc nofollow" target="_blank">广受欢迎</a>，甚至开始在<a class="ae ka" href="https://twitter.com/KarateDSL/status/935197434191347712" rel="noopener ugc nofollow" target="_blank">的招聘广告中出现</a>作为一项想要的技能。考虑到这个项目只有十个月，还不错！</p><h1 id="d4c7" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">测试双打</h1><p id="bdab" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">正在开发中(并且即将发布)的一个特性是能够加速测试加倍来“模拟”一个可能仍在开发中的web服务API依赖——或者测试环境可能不可用或不稳定。对于许多团队来说，这是一个<a class="ae ka" rel="noopener" href="/@copyconstruct/testing-microservices-the-sane-way-9bb31d158c16"> <em class="le">重大的</em>痛点</a>——“T12】脆弱的集成测试”对于许多处理微服务的平台团队来说，是痛苦的传奇来源。</p><p id="30c4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">空手道的创新<a class="ae ka" href="https://hackernoon.com/yes-karate-is-not-true-bdd-698bf4a9be39" rel="noopener ugc nofollow" target="_blank">“误用”小黄瓜</a>在实践中表现得非常好，实际上即使在服务器端“<a class="ae ka" href="https://hackernoon.com/tagged/inverting" rel="noopener ugc nofollow" target="_blank">反转</a>”也非常适合。这里有一个例子展示了为一个<a class="ae ka" href="https://hackernoon.com/tagged/rest" rel="noopener ugc nofollow" target="_blank"> REST </a>服务编写一个<em class="le">有状态的</em>双测试是多么简单。万事俱备，比如空手道对JSON和XML的原生支持，以及<a class="ae ka" href="https://www.infoq.com/articles/nashorn" rel="noopener ugc nofollow" target="_blank">嵌入式JavaScript引擎</a>的威力。</p><figure class="lg lh li lj fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lf"><img src="../Images/82bdb41c77e55ed85444c6beb9d3b6e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IaOV_SeigIIsPx7w3P0YaQ.png"/></div></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">the actual source for this example: <a class="ae ka" href="https://github.com/intuit/karate/blob/master/karate-demo/src/test/java/mock/proxy/demo-mock.feature" rel="noopener ugc nofollow" target="_blank">demo-mock.feature</a></figcaption></figure><p id="24c0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在<a class="ae ka" href="https://github.com/intuit/karate/tree/develop/karate-netty#capabilities" rel="noopener ugc nofollow" target="_blank">项目文档</a>中找到一个全面的功能列表。随着自述文件的发展，一个使用<a class="ae ka" href="https://projects.spring.io/spring-boot/" rel="noopener ugc nofollow" target="_blank"> Spring Boot </a>的演示端到端示例已经创建，作为社区的早期预览，总结如下。</p><h1 id="8c5a" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">消费者-提供者示例</h1><p id="020a" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们使用一个Java“消费者”的简化示例，它对支付服务(提供者)进行HTTP调用，其中已经实现了<code class="eh lo lp lq lr b">GET</code>、<code class="eh lo lp lq lr b">POST</code>、<code class="eh lo lp lq lr b">PUT</code>和<code class="eh lo lp lq lr b">DELETE</code>。‘提供者’为<code class="eh lo lp lq lr b"><a class="ae ka" href="https://github.com/intuit/karate/blob/develop/karate-demo/src/test/java/mock/contract/Payment.java" rel="noopener ugc nofollow" target="_blank">Payment.java</a></code>‘POJO’实现CRUD，<code class="eh lo lp lq lr b">POST</code>(或create)导致一条消息(<code class="eh lo lp lq lr b"><a class="ae ka" href="https://github.com/intuit/karate/blob/develop/karate-demo/src/test/java/mock/contract/Shipment.java" rel="noopener ugc nofollow" target="_blank">Shipment.java</a></code>作为JSON)被放在一个队列中，消费者正在监听这条消息。</p><p id="b007" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="http://activemq.apache.org/" rel="noopener ugc nofollow" target="_blank"> ActiveMQ </a>被用于将异步流混合到这个例子中，在一些<a class="ae ka" href="https://github.com/intuit/karate/blob/develop/karate-demo/src/test/java/mock/contract/QueueUtils.java" rel="noopener ugc nofollow" target="_blank">简单的</a> <a class="ae ka" href="https://github.com/intuit/karate/blob/develop/karate-demo/src/test/java/mock/contract/QueueConsumer.java" rel="noopener ugc nofollow" target="_blank">实用程序</a>的帮助下，我们能够将异步消息混合到空手道测试<em class="le">以及双倍测试</em>中。</p><figure class="lg lh li lj fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ls"><img src="../Images/ded25d044f0ba622018827166c3d33f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CMnfxoJYXmz8IsOla8pyUw.jpeg"/></div></div></figure><figure class="lg lh li lj fq hw"><div class="bz el l di"><div class="lt lu l"/></div></figure><h1 id="be33" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">服务器端空手道</h1><p id="2b24" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">“栅栏另一边”的空手道(<em class="le">处理</em> HTTP请求，而不是<em class="le">发出</em>)被证明非常有效，而且简单。</p><ul class=""><li id="1b0a" class="lv lw if je b jf jg jj jk jn lx jr ly jv lz jz ma mb mc md dt translated">对表达JSON和XML的“本地”支持</li><li id="737d" class="lv lw if je b jf me jj mf jn mg jr mh jv mi jz ma mb mc md dt translated">操纵甚至转换有效载荷</li><li id="1ec9" class="lv lw if je b jf me jj mf jn mg jr mh jv mi jz ma mb mc md dt translated">验证有效负载，如果需要，使用比JSON模式更简单的替代方案</li><li id="c20c" class="lv lw if je b jf me jj mf jn mg jr mh jv mi jz ma mb mc md dt translated">空手道是关于进行HTTP调用的T21，如果需要的话，给你调用“下游”服务的灵活性</li><li id="d196" class="lv lw if je b jf me jj mf jn mg jr mh jv mi jz ma mb mc md dt translated">如果需要，内存中的JSON和JsonPath解决“状态”和过滤问题</li><li id="1b5f" class="lv lw if je b jf me jj mf jn mg jr mh jv mi jz ma mb mc md dt translated">如果需要的话，混合定制的JavaScript(甚至Java代码)——用于复杂的逻辑</li><li id="8b2c" class="lv lw if je b jf me jj mf jn mg jr mh jv mi jz ma mb mc md dt translated">在启动时轻松“播种”数据或切换环境/配置</li></ul><p id="2b0b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你想想，以上都是<em class="le">足够</em>实现<em class="le">任何</em>微服务。空手道的DSL语法正是集中在这些方面，从而开启了有趣的可能性。</p><p id="97cf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">可能很难相信你可以用空手道在几分钟内建立一个“可用”的微服务——但是一定要试试，让我知道你的想法！</p><figure class="lg lh li lj fq hw"><div class="bz el l di"><div class="mj lu l"/></div></figure></div></div>    
</body>
</html>