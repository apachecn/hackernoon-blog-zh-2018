<html>
<head>
<title>Creating A Highly Scalable Website Monitoring Service in half an hour using AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda在半小时内创建高度可伸缩的网站监控服务</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/creating-a-website-monitoring-service-in-half-an-hour-using-lambdas-4f64fb199df3?source=collection_archive---------6-----------------------#2018-01-10">https://medium.com/hackernoon/creating-a-website-monitoring-service-in-half-an-hour-using-lambdas-4f64fb199df3?source=collection_archive---------6-----------------------#2018-01-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a73e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Lambda函数是一项真正令人敬畏的<a class="ae jp" href="https://hackernoon.com/tagged/technology" rel="noopener ugc nofollow" target="_blank">技术</a>，如果你没有读过我的理论，即<a class="ae jp" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>和更具体的AWS Lambdas将在2018年接管世界，那么请在这里查看:</p><div class="jq jr fm fo js jt"><a href="https://hackernoon.com/how-serverless-computing-will-change-the-world-in-2018-7818fc06b447" rel="noopener  ugc nofollow" target="_blank"><div class="ju ab ej"><div class="jv ab jw cl cj jx"><h2 class="bd hv fv z el jy eo ep jz er et ht dt translated">无服务器计算将如何在2018年改变世界</h2><div class="ka l"><h3 class="bd b fv z el jy eo ep jz er et ek translated">无服务器计算是一个相当新的概念，在流行程度上有所增长。这部分是由于…</h3></div><div class="kb l"><p class="bd b gc z el jy eo ep jz er et ek translated">hackernoon.com</p></div></div><div class="kc l"><div class="kd l ke kf kg kc kh ki jt"/></div></div></a></div><p id="eafb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它吸引了一些读者，不知何故成为了1月1日阅读量最大的媒体文章之一……我想这一定是新闻不多的一天。</p><h2 id="c44e" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">然而，无服务器到底能做什么？</h2><p id="8250" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">我宣扬这些无服务器技术是很好的，但是它并没有向您展示这项技术的真正潜力。</p><p id="0bed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以，为了向你展示Lambda的真正可能性，我想我会把这本书放在一起，向你展示这项技术到底能做什么！</p><h2 id="210b" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">介绍uptime girl——我最新的百万美元创业公司</h2><p id="a97b" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">在这篇文章中，我将建立一个网站正常运行时间监视器，允许人们填写表格，它将自动为您创建一个新的lambda函数，该函数将每15分钟检查一次您的网站的健康状况，并在其中一个网站死亡时向您发送电子邮件。我将更多地关注面向Lambda的概念，并讨论诸如IAM和角色设置之类的东西。</p><p id="3ff5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每一个好的创业公司都需要一个吸引人的名字，所以我们将称之为<code class="eh lj lk ll lm b">UpTimeGirl</code>网站监控服务，有点像比利·周？</p><blockquote class="ln lo lp"><p id="3e0d" class="ir is lq it b iu iv iw ix iy iz ja jb lr jd je jf ls jh ji jj lt jl jm jn jo hn dt translated">声明:如果你真的从这个想法中赚了一百万美元，我希望至少有一瓶啤酒！！</p></blockquote><h2 id="ed80" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">要求</h2><p id="9578" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">由于这是一个软件项目，它需要一套需求，否则我们如何能够从我们的项目中定义任何形式的成功？由于我想为我的所有站点构建一个世界级的数百万美元的监控解决方案，我希望它具有以下要求:</p><ul class=""><li id="f75e" class="lu lv hu it b iu iv iy iz jc lw jg lx jk ly jo lz ma mb mc dt translated">它绝不能自己倒下。</li><li id="f9a0" class="lu lv hu it b iu md iy me jc mf jg mg jk mh jo lz ma mb mc dt translated">跑起来一定很便宜。我们当然需要实现利润最大化。</li><li id="ed0c" class="lu lv hu it b iu md iy me jc mf jg mg jk mh jo lz ma mb mc dt translated">每当一个网站关闭，它必须通知我，无论是通过文本或电子邮件</li><li id="7ffd" class="lu lv hu it b iu md iy me jc mf jg mg jk mh jo lz ma mb mc dt translated">它必须扩展到数百个，如果不是数千个站点。</li></ul><p id="af60" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将在不到半小时的时间内为一个项目提出一套相当不错的要求，我想你会同意的。</p><h2 id="2423" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">前端</h2><p id="aa45" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">前端将是一个简单的VueJS应用程序，它既有一个输入框，将采取新的网站进行监控，也有一个显示已注册网站的瓷砖列表。</p><p id="14f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">为什么是VueJS？我目前正在尝试学习它，我想为什么不呢？</strong></p><p id="ff82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这只是一个非常简单的前端，看起来像这样:</p><figure class="mj mk ml mm fq mn fe ff paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="fe ff mi"><img src="../Images/93315698d2249cb5eec7079cf2defdc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7U689A9eD8oPFnYiC0nzBA.png"/></div></div></figure><p id="fd0e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想要这个的源代码，你可以在我的github repo这里找到:<a class="ae jp" href="https://github.com/elliotforbes/uptimegirl" rel="noopener ugc nofollow" target="_blank">https://github.com/elliotforbes/uptimegirl</a></p><p id="1d10" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我目前只是使用一个非常简单的<code class="eh lj lk ll lm b">HTTP GET</code>请求来触发构建lambda函数的Python API。</p><h2 id="304c" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">API</h2><p id="ed1f" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">该API将用Python编写，并将使用Boto3 AWS SDK来使我能够与AWS的各种API进行交互。这个API本质上将接受一个<code class="eh lj lk ll lm b">URL</code>和<code class="eh lj lk ll lm b">time_period</code>，它将基于这些参数动态地生成和创建一个新的Lambda函数。</p><blockquote class="ln lo lp"><p id="df8d" class="ir is lq it b iu iv iw ix iy iz ja jb lr jd je jf ls jh ji jj lt jl jm jn jo hn dt translated">免责声明:我可以保证这不是生产就绪。</p></blockquote><figure class="mj mk ml mm fq mn"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="9911" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这段代码中，我们在Python 3.6中创建了一个简单的<a class="ae jp" href="https://www.youtube.com/watch?v=Z784Mwm4VBg" rel="noopener ugc nofollow" target="_blank"> aiohttp REST API </a>。这将有两个主要端点，一个get_functions端点和一个create_lambda_function端点，可以分别通过<code class="eh lj lk ll lm b">/funcs</code>和<code class="eh lj lk ll lm b">/create</code>访问。</p><p id="6a4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<code class="eh lj lk ll lm b">get_functions()</code>函数中，我们简单地返回一个json响应，其中包含当前在Lambda服务中注册的所有函数。</p><p id="3627" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lj lk ll lm b">create_lambda_function()</code>函数是有趣的地方。在这里，我们创建了一个字典对象，它包含了我们希望传入的所有环境变量。在这种情况下，我们只是传入我们希望监控的<code class="eh lj lk ll lm b">URL</code>。为了确保函数名的唯一性，我们用一点点正则表达式的魔力从URL创建了一个字母数字函数名。</p><p id="0821" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这样做之后，我们创建我们的<code class="eh lj lk ll lm b">Code</code>字典对象，它将简单地以字节的形式传入我们的<code class="eh lj lk ll lm b">lambda.zip</code>文件。然后，我们将<code class="eh lj lk ll lm b">env</code>字典和<code class="eh lj lk ll lm b">code</code>字典传递给AWS的<code class="eh lj lk ll lm b">create_function</code>函数，这应该会为我们创建lambda函数。</p><p id="1cfe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">之后，我们尝试将CloudWatch事件触发器附加到我们新创建的lambda函数，方法是使用<code class="eh lj lk ll lm b">put_targets()</code>函数并传入我们已经在AWS控制台中定义的15分钟规则的名称和目标列表，在本例中是单个目标。</p><p id="b3a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦这一切顺利运行，我们就返回一个简单的非json(我知道…抱歉)响应。</p><p id="9cd5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在github repo中，我已经包含了一个dockerfile，如果你想走这条路，可以在AWS的ECS上运行和部署，现在我把它全部放在localhost上，因为显然还有很多开发工作要做。</p><h2 id="66a8" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">兰姆达斯</h2><p id="f157" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">我们将动态创建的Lambda函数本质上将试图使用一个简单的<code class="eh lj lk ll lm b">GET</code>请求获取我们传递给它的任何URL。然后，我们将根据用来触发每个功能的CloudWatch事件规则，每隔15分钟运行一次。</p><p id="eb07" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果这些预定请求中的任何一个发生失败，它将自动向SNS发布一个事件，然后SNS将向订阅该SNS的任何人发送一封电子邮件和一条短信。</p><h2 id="d492" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">代码</h2><p id="6511" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">我们的lambda函数的代码非常简单。它所做的就是试图向一个URL发送一个<code class="eh lj lk ll lm b">GET</code>请求，这个请求是从一个环境变量中获取的，这个环境变量是在我们动态创建函数时设置的。如果这个请求失败，那么它抛出一个异常。</p><figure class="mj mk ml mm fq mn"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="063a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们想让我们的系统通知我们任何错误，那么我们可以用两种不同的方法之一。我们可以扩展我们的Lambda函数并添加必要的代码来发布到SNS主题，或者我们可以在CloudWatch上设置一个警报，每当我们的Lambda函数报告一个错误时抛出一个错误。</p><p id="388f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了简单起见，我们将选择后者:</p><figure class="mj mk ml mm fq mn fe ff paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="fe ff mi"><img src="../Images/7b3470d6714e7aa640f9ed96b4a75c4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dM6TV6DaOJXIXn_SrwR9Tg.png"/></div></div></figure><p id="7e9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后嘣！我们有一个警报系统，当我们的系统停机时，它会给我们发电子邮件。</p><p id="4a2a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">订阅这个SNS主题的人的名单可以由前端动态修改，但我们需要留下一些工作让我们做，一旦我们通过了我们的创业公司的第一轮融资。</p><h2 id="b4ba" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">我们在生产中！</h2><p id="d3c1" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">在不到半个小时的时间里，我们已经能够使用一系列lambda函数成功构建一个完整的监控解决方案，该解决方案现已投入使用。</p><p id="f029" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它不仅具有难以置信的弹性，还可以扩展到潜在的数千个站点，并且由于我们正在创建的lambdas非常小，因此这样做的成本是最小的。</p><p id="b85f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，通过创建新的lambdas来编排新站点添加的前端和API尚未部署到ECS，因为我觉得这超出了范围，但是如果您想开始这方面的工作，这里有一个docker文件。如果你真的觉得元，你完全可以从一个Lambda函数服务前端应用程序，并使用API网关将其前置，然后将Python API分割成一系列Lambda端点，但我将把这作为读者的后续任务！</p><p id="8636" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">仍然有很多可以改进的地方，但是我希望这个简单的例子有助于突出Lambda函数不可思议的能力以及如何使用它们。在传统的应用程序中，您不仅需要编写大量的代码，还需要跨多个可用性区域部署它。这些都表现出额外的复杂性，需要花费更多的时间来构建和发布。</p><h1 id="25cf" class="mv kk hu bd kl mw mx my kp mz na nb kt nc nd ne kw nf ng nh kz ni nj nk lc nl dt translated">结论</h1><p id="d3e8" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">希望你觉得这篇文章很有见地，令人愉快！如果你在设置这些lambda函数时需要任何进一步的帮助，请在下面的评论区留下你的评论或发推特给我:<a class="nm nn gr" href="https://medium.com/u/eb71d34fbe09?source=post_page-----4f64fb199df3--------------------------------" rel="noopener" target="_blank">埃利奥特·福布斯</a></p><p id="c3d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我也在<a class="ae jp" href="https://linkedin.com/in/elliotforbes" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上，如果你想联系的话！</p><p id="ec15" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lq">如果你没有时间亲自推进这个创业想法，Cronitor的天才团队已经基于这一设计创建了一个正常运行时间监控工具，该工具使用了全球部署的Lambda。我强烈推荐在这里查看他们的产品—</em><a class="ae jp" href="https://cronitor.io/uptime-monitoring" rel="noopener ugc nofollow" target="_blank">https://cronitor.io/uptime-monitoring</a>。</p><figure class="mj mk ml mm fq mn"><div class="bz el l di"><div class="no mu l"/></div></figure></div></div>    
</body>
</html>