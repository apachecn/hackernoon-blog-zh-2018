<html>
<head>
<title>Learning these 5 microservice patterns will make you a better engineer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习这5种微服务模式会让你成为更好的工程师</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/learning-these-5-microservice-patterns-will-make-you-a-better-engineer-52fc779c470a?source=collection_archive---------1-----------------------#2018-01-11">https://medium.com/hackernoon/learning-these-5-microservice-patterns-will-make-you-a-better-engineer-52fc779c470a?source=collection_archive---------1-----------------------#2018-01-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/7f2db81cc9f13a627e4b6e5c1fa30ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*wbSHeQ5AZ9-XH76WOE46HA.png"/></div></figure><p id="35da" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">对于许多工程师来说，进入微服务可能很难，因为很难决定应该在哪里划线。对我来说，80%的服务属于五个类别中的一个，以这种方式划分职责允许你考虑如何通过管道将服务连接在一起来设计功能，就像你在Unix shell脚本中所做的那样。</p><p id="d0e9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们来讨论一下所有微服务的共同点。领域驱动设计之父Eric Evans将它们定义如下:“(服务)可以消费和产生消息。”(【https://www.youtube.com/watch?v=yPvef9R3k-M】T4)</p><p id="f473" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">记住这一点，对于每种服务模式，我将讨论产生或消费的消息类型。</p><p id="8fa4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这些消息又可以细分为两类:事件和命令。</p><p id="4a5a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">不过在我们开始之前，因为上下文很重要，我第一次听说这些微服务模式是从库<a class="ae jw" href="https://github.com/mateodelnorte/servicebus" rel="noopener ugc nofollow" target="_blank"> servicebus </a>的创建者<a class="jx jy gr" href="https://medium.com/u/79e3e76c6223?source=post_page-----52fc779c470a--------------------------------" rel="noopener" target="_blank"> Matt Walters </a>那里。Servicebus是一个流行的。Net库NServiceBus，由Udi达汗创建并推广。</p><p id="e179" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">Servicebus允许你使用AMQP作为通用语言，通过JSON有效负载，轻松编写<code class="eh jz ka kb kc b">send</code>和<code class="eh jz ka kb kc b">listen</code>命令，以及<code class="eh jz ka kb kc b">publish</code>和<code class="eh jz ka kb kc b">subscribe</code>事件。这意味着其他编程语言可以很容易地实现相同的接口，并能够无缝地参与到由多种语言编写的部分组成的系统中。</p><blockquote class="kd ke kf"><p id="a8b8" class="iy iz kg ja b jb jc jd je jf jg jh ji kh jk jl jm ki jo jp jq kj js jt ju jv hn dt translated">如果你是一名Go或Python开发人员，愿意为此做出贡献，请给我发消息！</p></blockquote><p id="b049" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">长话短说，5种微服务模式。</p><h2 id="b95e" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">1.模特服务</h2><p id="f61b" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">如果你想到了MVC，那么你就可以使用这种类型的服务。模型服务是模型应该存在的地方。根据领域的复杂性，边界通常是在集合或实体级别上确定的。</p><p id="65b4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">模型服务使用与上下文相关的消息。例如，如果您有一个库存服务，一些与消费相关的命令消息将是<code class="eh jz ka kb kc b">inventory.product.create</code>或<code class="eh jz ka kb kc b">inventory.product.increaseStock</code>。作为响应，您需要生成一些事件消息，这样系统的其他部分就可以知道模型是如何变化的，并对这些变化做出响应。本例中产生的事件消息是<code class="eh jz ka kb kc b">inventory.product.created</code>和<code class="eh jz ka kb kc b">inventory.product.stockLevelIncreased</code>。</p><blockquote class="kd ke kf"><p id="2d47" class="iy iz kg ja b jb jc jd je jf jg jh ji kh jk jl jm ki jo jp jq kj js jt ju jv hn dt translated"><strong class="ja hv">更新:1/7/19 —查看</strong> <a class="ae jw" href="https://hackernoon.com/complicated-patterns-arent-always-that-complicated-usually-it-s-the-simple-ones-that-bite-you-caf870f2bf03" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv">我在HackerNoon </strong> </a> <strong class="ja hv">上的一篇新文章，这篇文章讨论了模特的事件采购。</strong></p></blockquote><h2 id="d638" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">2.反规格化服务</h2><p id="df06" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">除了分布式系统之外，反规范化器正是关系数据库正在做的事情。他们将多个规范化的输入源连接到一个可供客户使用的可读数据结构中。</p><p id="f9eb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">例如，假设你有一个电子商务应用程序。当库存水平增加或减少，或者变得可用时，您的应用程序应该知道这一点。</p><p id="7cc3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这意味着使用反规范化器服务，您可以订阅从上面的模型服务发出的事件，如果您使用MongoDb，可以使用类似mongoose的东西将数据保存在一个完美的结构中，供特定的应用程序使用。</p><p id="92c3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">想象一下，如果您的应用程序工程师在MongoDB上使用像Meteor这样的东西，他们只需从外部系统获得实时库存，而无需编写一行代码。这在RethinkDB与GraphQL订阅配合使用时也能很好地工作！</p><h2 id="6532" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">3.网关服务</h2><p id="e8ed" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">网关服务的使用非常类似于非规范化器。然而，它不是连接到数据库，而是连接到API。</p><p id="aba1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我最近在使用一个名为LiftIgniter的推荐引擎，我们的库存需要与它同步。该服务订阅<code class="eh jz ka kb kc b">inventory.product.updated</code>和<code class="eh jz ka kb kc b">inventory.product.added</code>事件，并简单地将格式化的数据发送到适当的端点。</p><p id="1b3f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">后来，添加了一个额外的服务来监听相同的事件，通过构建Magento网关服务，我们能够使电子商务商店与不断变化的库存水平保持同步！</p><h2 id="916b" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">4.Ingestor服务</h2><p id="edcd" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">到目前为止，我们所讨论的都是处理通过系统传播的数据，或者在模型服务中创建的数据。然而，将外部数据导入系统是一个常见的需求。从概念上讲，来自外部数据源的数据需要被吸收到系统其余部分所使用的通用语言中。这是饮食服务的工作。</p><p id="acdc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">Ingestor服务通常只生成消息。这些服务通常包括通过HTTP接收API POST，或者运行CRON作业，并以一定的时间间隔进行抓取。然后，使用通用语言(AMQP w/ JSON)将提取或接收的数据发布到系统。</p><h2 id="fb1c" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">5.适配器服务</h2><p id="1070" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">适配器服务是一个更罕见的用例，但是值得一提。与网关服务类似，适配器使用消息，然后使用该数据调用系统上的库。这方面的一个例子可能是使用像ImageMagick这样的图形操作工具。ImageMagick是一个强大的工具，但是没有Node.js绑定。适配器服务通过执行子流程，然后用系统的通用语言生成包含结果的消息来解决这个问题。</p><h2 id="86da" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">API服务</h2><p id="7464" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">更新:2018年1月12日<br/>发表这篇文章一天后，我意识到他们可能对API的适用性感到困惑。所以我决定增加这一节，并解释我的理由。它们绝对是微服务，但它们并不是真正的新服务，也不在我的新教学内容列表中。</p><p id="33c6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">API服务应该保持轻量级。如果您正在将一整套业务逻辑构建到一个API中，那么您正在构建一个整体。它比我们过去在“n层”架构中看到的应用程序和服务器的组合稍好，但最终也会导致臭名昭著的“大泥球”或“意大利面条式代码”。</p><p id="665c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">为了实现这一点，使用上面的“反规范化器服务”将数据的高效查询视图投射到API读取的数据库中。这就产生了一个单向的数据流，或者像我第一次从Matt那里听到的那样，一个“单向系统”。</p><h1 id="faf2" class="lk kl hu bd km ll lm ln kq lo lp lq ku lr ls lt kx lu lv lw la lx ly lz ld ma dt translated">单向系统</h1><p id="e788" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">使用以上这些模式允许您在单向工作流中处理不可变事件。如果您对应用程序开发感兴趣，那么您肯定熟悉Redux是如何改变状态管理的。拥有一个存储状态的组件树可以让你很容易地推断出动作是如何影响状态的，因为它们是简单不变的事实，都发生在一个集中的位置。</p><p id="900d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果您遵循上述模式，您将使用有时更复杂的命令查询责任分离，或CQRS。命令由模型服务使用，生成的事件由反规范化器或网关服务使用，它们更新读取模型。然后对读取模型进行查询。</p><p id="fc31" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">因为您使用不可变的消息，这使得事件源成为构建模型服务的完美模式。Matt Walters的另一个创造值得一试，是一个名为[sourced](<a class="ae jw" href="https://github.com/mateodelnorte/sourced" rel="noopener ugc nofollow" target="_blank">https://github.com/mateodelnorte/sourced</a>)的微框架，它与servicebus完美地协调工作，可以轻松地添加事件源功能来消费服务的事件，并将它们保存到数据库中。</p><h1 id="1bad" class="lk kl hu bd km ll lm ln kq lo lp lq ku lr ls lt kx lu lv lw la lx ly lz ld ma dt translated">结论</h1><p id="7e91" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">最后，值得一提的是，随着服务的简化，一些复杂性必然会转移到架构中。希望我已经为您提供了一种在头脑中用一些普通的乐高积木构建微服务系统的方法。</p><p id="ec17" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果你还没有读过我的另一篇文章，“<a class="ae jw" href="https://hackernoon.com/what-makes-a-microservice-architecture-14c05ad24554" rel="noopener ugc nofollow" target="_blank">有效微服务架构的10个难题</a>”也请阅读！它涵盖了构成微服务架构的组件。</p><blockquote class="kd ke kf"><p id="790c" class="iy iz kg ja b jb jc jd je jf jg jh ji kh jk jl jm ki jo jp jq kj js jt ju jv hn dt translated">如果你想跳过花几个月时间学习如何自己设置这一切的部分，我正在准备一个网络课程，向你展示我如何系统化这个过程，并编写系统，这样你就可以在最快的时间内启动、运行和高效地使用微服务！立即注册，在所有人之前获得访问权限！访问<a class="ae jw" href="https://www.microservicedriven.com/get-access" rel="noopener ugc nofollow" target="_blank">微服务驱动</a>获取信息！</p></blockquote><blockquote class="mb"><p id="fa18" class="mc md hu bd me mf mg mh mi mj mk jv ek translated">有兴趣听听我的DevOps之旅，没有无用的AWS认证？现在就在HackerNoon 上阅读。DevOps是有效微服务的先决条件。</p></blockquote><p id="3c4e" class="pw-post-body-paragraph iy iz hu ja b jb ml jd je jf mm jh ji jj mn jl jm jn mo jp jq jr mp jt ju jv hn dt translated">感谢阅读！如果你跟着我，给我50次掌声，这真的会帮助我接触到更多的人！点击和#HODL下面的鼓掌按钮；)</p><blockquote class="kd ke kf"><p id="6bb8" class="iy iz kg ja b jb jc jd je jf jg jh ji kh jk jl jm ki jo jp jq kj js jt ju jv hn dt translated">如果你想联系我，你可以在LinkedIn或Twitter上给我发消息。</p></blockquote></div></div>    
</body>
</html>