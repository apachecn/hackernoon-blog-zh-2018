<html>
<head>
<title>The 10 Puzzle Pieces of an Effective Microservice Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有效微服务架构的10大难题</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/what-makes-a-microservice-architecture-14c05ad24554?source=collection_archive---------3-----------------------#2018-01-11">https://medium.com/hackernoon/what-makes-a-microservice-architecture-14c05ad24554?source=collection_archive---------3-----------------------#2018-01-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/627dd116b994cf267f0c2a050a61fc6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*2Qvg3-UdNKNDAAdprUrmiA.png"/></div></figure><p id="5a08" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">任何人都可以做微小的服务。这是你做“Hello World”express服务器的第一件事。如果你以前做过“Hello World”express服务器，那么恭喜你！你做了一个微服务！</p><p id="6d57" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">从一个到许多，问题开始堆积。</p><p id="bad4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">他们应该如何互相交谈？休息？RPC？消息传递？为什么要选择一个而不是另一个？</p><p id="c174" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">比方说，您确实设法连接了一个由几个服务组成的小系统，并且您选择了REST，因为它看起来最简单，而且您已经知道了。是时候把它们部署到某个地方了。如果你尝试过在平台即服务(PaaS)上运行微服务，比如Modulus或Heroku，这可能会非常耗时，而且非常昂贵。</p><p id="a0dd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">更不用说通过互联网而不是专用网络进行通信的延迟。那不行。哦，您还需要提供环境变量，以便知道ping哪个端点。</p><p id="2ef7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然后你考虑部署。部署总是一件痛苦的事，现在您需要做七次？！</p><p id="0c48" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">上面的场景基本上就是我第一次尝试的样子。不过我很聪明，我使用了单向数据流！可惜这只是其中的一部分。</p><p id="e599" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">伐木呢？还有监控？你把秘密藏在哪里？自动缩放？</p><p id="9e0d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">你终于意识到，你现在除了想做小服务之外，还需要学习如何在AWS中构建自己的基础设施。</p><blockquote class="jw"><p id="ba6e" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">突然，我们微小的服务感觉不那么微小了。</p></blockquote><p id="ab4d" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">结合使用以下工具有可能大大提高开发服务的速度、部署服务的速度以及在任何环境中运行服务的便利性。额外的好处是，一旦它们被编码，它们就可以重复使用。</p><p id="b0f1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">更多的是跟踪资源和学习每一个资源，以及它们如何交互，这构成了学习曲线的大部分。</p><h1 id="ab2a" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">有效微服务架构的10个拼图</h1><h2 id="fe24" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">1.集装箱化</h2><p id="9d8f" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">没有容器化，你就无法有效地构建微服务。有太多的碎片。我的意思是，你可以做T1，但这真的需要更多的工作。</p><p id="51f1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">想象一下，如果你想买一些奥利奥，而它们是分开来的。退一步说，这不太方便。</p><p id="025a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">就服务而言，容器简化了开发、测试、部署和生产中的运行。所有你每天需要整天做的事情都是你的工作，所以不妨让它变得更简单。</p><blockquote class="jw"><p id="dd2b" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">服务需要容器，就像奥利奥一样。</p></blockquote><p id="1691" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated"><strong class="ja hv">工具:</strong><em class="mc">T5】Docker</em></p><h2 id="b73f" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">2.一簇</h2><p id="513b" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">但你不只是想要奥利奥，对吧？你还想做烤奶酪和番茄汤，因为外面很冷。也许还有些除臭剂和牙膏，这样你就不是一个难闻的不合群的人了，所以你也得到了。当然，还有啤酒。</p><p id="42ec" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">想象一下，如果你必须一个人把所有的杂货带回家。这说不通。所以，你把它们放在袋子里。你把重的放在底部，这样它们就不会挤压面包，把冷的放在一起，这样它们就可以一起冷却了。有些东西你用双袋包装，以防多余。</p><blockquote class="jw"><p id="90f2" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">包包就像服务器，你需要不止一个，它们装着你的服务。</p></blockquote><p id="21de" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">拥有多个可以让您避免失败的情况，比如一个可用性区域出现故障。或者，你的汤罐破了，纸袋破了。还好你装了双袋。给自己一个掌声。你可以用底部的按钮。；)</p><p id="ae5b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">您可以从任何主要的云提供商那里获得您的服务器。这里最重要的是将基础设施整理成文。有几种不同的方法可以做到这一点。在过去，许多人使用Ansible来实现这一点，但是考虑到快速可伸缩性的需求，等待服务器启动和配置是没有意义的。相反，您可以“烘焙”安装了所有工具的机器的映像，然后将该映像用于Terraform或Cloudformation。一旦为弹性设计了集群，新AMI的滚动更新将允许您更新整个基础设施。</p><p id="b13f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">服务器</strong> : AWS、Azure、数字海洋<br/> <strong class="ja hv">工具</strong> : Cloudformation、Terraform、Packer</p><h2 id="8fcb" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">3.管弦乐手</h2><p id="9baa" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">现在，你很擅长打包东西，但是，你住在纽约，你花了82美元买了这些烤奶酪配料和啤酒，现在你要自己把它们装进袋子里？算了吧！你在家做饭已经省钱了！有一个装袋工，每天一整天不停地往袋子里装东西，他们说，真的很擅长！</p><blockquote class="jw"><p id="5188" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">管弦乐队就像杂货店的装袋工。</p></blockquote><p id="cb20" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">orchestrator知道您的服务的内存需求，以及需要分配多少CPU，她会仔细地将每个服务放入适当的服务器中。</p><p id="c681" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">工具</strong> : Docker Swarm，Kubernetes</p><h2 id="7e45" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">4.持续部署</h2><p id="a088" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">我想我不能再忍受杂货店的事情了。关于UberEats的事？我不知道。如果你有什么想法，请发表评论！我们去交黄铜税吧。部署非常耗时，而且您有更重要的事情要做。</p><blockquote class="jw"><p id="149c" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">自动化它，自动化它，自动化它。</p></blockquote><p id="b117" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">这直接有助于企业赚钱。整个精益创业就是建立、测量、学习和重复这个循环。持续部署允许您更快地完成这项工作。越快完成越好，因为这样你就可以衡量、学习并知道下一步要做什么。</p><p id="5b63" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我个人认为你应该努力让一切自动化到你可以自信地<a class="ae md" href="https://hackernoon.com/i-have-a-confession-to-make-i-commit-to-master-6a804f334beb" rel="noopener ugc nofollow" target="_blank">承诺掌握</a>的程度。当在一堆微小的服务中重复15次时，Git流就太麻烦了。当你需要的时候创建分支，但是，如果你有适当的安全检查，只提交给master也是可以的。</p><p id="241d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">工具</strong> : Jenkins(有管道和蓝海)、TravisCI、CircleCI</p><h2 id="312c" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">5.代理人</h2><p id="1d7e" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">您的服务应该是安全的。保护它们的好方法？</p><blockquote class="jw"><p id="e34d" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">不要把你的服务直接暴露在互联网上！</p></blockquote><p id="c33b" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">相反，使用面向公众的反向代理。但是，它需要易于配置，理想情况下，它可以根据服务上定义的一些配置选项来配置自己，这样开发服务的团队就可以决定如何最好地与代理交互，而不必通过ssh连接到服务器。</p><p id="4b60" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">工具</strong> : HAProxy、nginx、docker-flow-proxy</p><h2 id="03ca" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">6.信息排队</h2><p id="bdbf" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">服务应该用通用语言交流。消息队列可以用作将消息发送给所有订阅客户端的粘合剂。此外，它不应该是一个服务的责任，知道你的其他服务在互联网上运行。如果他们搬家，你需要知道。</p><p id="ae0a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">当然，您可以使用像Consul这样的分布式密钥存储库，并保持其最新，以避免不断地重新配置您的服务，或者更好地使用orchestrator的DNS特性并使用REST，但是，这仍然需要很多额外的责任和配置。这使得您的服务<em class="mc">紧密耦合</em>。</p><blockquote class="jw"><p id="5178" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">使用单向触发和遗忘消息使您的服务松散耦合，并且易于扩展。</p></blockquote><p id="d164" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">相反，使用消息队列，您可以简单地发送或发布消息，以一种“一劳永逸”的方式。其他服务可以在不影响原始发布服务的情况下轻松添加或删除。这也使得您的架构非常容易扩展。此外，通过重试和错误队列等功能，您可以减少服务崩溃的压力。当服务恢复时，将简单地重试该消息。</p><p id="3a93" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">工具</strong> : RabbitMQ、ActiveMQ、AWSMQ、ZeroMQ</p><h2 id="e3d1" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">7.集中记录</h2><p id="ad36" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">由于消息来自多个节点和多个副本，可能会被orchestrator移动，因此通过ssh进入服务器并检查日志并不是一个可行的选择。您需要将它们运送到一个易于搜索的集中位置，并深入了解代码在生产中的功能。</p><blockquote class="jw"><p id="7c6f" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">在一个地方查看所有内容。</p></blockquote><p id="2172" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">此外，知道如何发送日志不应该是服务的责任。相反，总是记录到<code class="eh me mf mg mh b">stdout</code>或<code class="eh me mf mg mh b">stderr</code>，并通过在集群中的每个节点上全局运行工具来收集所有这些日志。然后，日志收集器工具会将日志发送到您的集中式日志记录子系统。</p><p id="a5e4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">工具</strong> : ELK Stack (ElasticSearch，Logstash，Kibana)</p><h2 id="0fd9" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">8.监控和警报</h2><p id="00c9" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">与日志记录类似，您不希望到处追踪服务来查看它们的使用统计数据。相反，应该全部收集并运送到一个集中的位置。</p><blockquote class="jw"><p id="48a4" class="jx jy hu bd jz ka kb kc kd ke kf jv ek translated">在向人类发出警报之前，使用警报来推动扩展或恢复事件。</p></blockquote><p id="cad4" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">如果没有必要，你也不会想去追寻那些信息。理想情况下，你应该只在出问题的时候听到一点声音。这意味着您需要一个警报工具来响应从监控中收集的指标并向用户发出警报。更好的是，它可以提醒微服务触发扩展事件，或者尝试以其他方式解决问题，以避免需要人工干预。</p><p id="e40b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">工具</strong>:普罗米修斯、Alertmanager、Grafana</p><h2 id="7fc3" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">9.元存储库</h2><p id="7967" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">大多数人只听说过单回购或多回购，这两种回购都满足某些要求。然而，对于微服务，您往往会有许多存储库，这可能会变得很难处理。使用元存储库可以解决这个问题，方法是创建一个父存储库和一个命令行工具来一次跨多个存储库执行命令。要了解更多关于元回购的信息，请查看我的文章:<a class="ae md" rel="noopener" href="/@patrickleet/mono-repo-or-multi-repo-why-choose-one-when-you-can-have-both-e9c77bd0c668">单一回购还是多重回购？当你可以两者兼得时，为什么要选择一个呢？</a></p><p id="f320" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">工具</strong> : meta，gitslave</p><h2 id="1a0c" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">10.微服务思维</h2><p id="d8ab" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">当基础设施建成时，架构师的工作还没有完成。为了让架构实现其优势，团队需要采用微服务。由于消息总线的松散耦合和容器化，该架构中的所有工具的目标是通过支持最适合该工作的任何语言来保持灵活性。如果你的团队只是去构建单片，并把它们称为微服务，这是行不通的。因此，他们需要了解微服务设计模式和优势，这样他们就可以满怀信心地进行建设，减少实验。</p><p id="c18c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">有关微服务模式的更多细节，请参见我的另一篇文章“<a class="ae md" href="https://hackernoon.com/learning-these-5-microservice-patterns-will-make-you-a-better-engineer-52fc779c470a" rel="noopener ugc nofollow" target="_blank">学习这5种微服务模式将使你成为更好的工程师</a>”。在那里，我教你如何对你的服务进行分类，谈论总体模式，以及它们如何与领域驱动设计、CQRS和事件源相关联。</p><h2 id="2cbf" class="lj km hu bd kn lk ll lm kr ln lo lp kv jj lq lr kz jn ls lt ld jr lu lv lh lw dt translated">结论</h2><p id="40f3" class="pw-post-body-paragraph iy iz hu ja b jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">我的目标是为您提供微服务架构组件的高级概述。成为一名架构师是一段艰难的旅程，需要学习很多工具，然而，从整体上利用架构的力量将会给你开发的超能力！</p><blockquote class="mi mj mk"><p id="ea3b" class="iy iz mc ja b jb jc jd je jf jg jh ji ml jk jl jm mm jo jp jq mn js jt ju jv hn dt translated">我目前正在开发一门新课程<strong class="ja hv">微服务驱动设计</strong>，在这里你可以学习如何使用上述所有组件构建一个现代微服务架构。欲抢先访问，请在此报名<a class="ae md" href="https://www.microservicedriven.com/get-access" rel="noopener ugc nofollow" target="_blank"/>！</p></blockquote><blockquote class="jw"><p id="6567" class="jx jy hu bd jz ka mo mp mq mr ms jv ek translated">有兴趣听听我的DevOps之旅，没有无用的AWS认证？现在就在HackerNoon 上阅读。DevOps是有效微服务的先决条件！</p></blockquote><p id="495a" class="pw-post-body-paragraph iy iz hu ja b jb kg jd je jf kh jh ji jj ki jl jm jn kj jp jq jr kk jt ju jv hn dt translated">感谢阅读！如果你觉得这有用，请给我一些掌声！这真的会帮助我接触到更多的人！</p><blockquote class="mi mj mk"><p id="770a" class="iy iz mc ja b jb jc jd je jf jg jh ji ml jk jl jm mm jo jp jq mn js jt ju jv hn dt translated">如果你想联系我，请在LinkedIn或Twitter上给我发消息。</p></blockquote></div></div>    
</body>
</html>