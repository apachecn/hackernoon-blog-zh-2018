<html>
<head>
<title>The Microservices Approach to Mobile Application Development (Part II)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移动应用开发的微服务方法(下)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/microservices-architecture-for-mobile-application-development-part-ii-1a68db3aa438?source=collection_archive---------10-----------------------#2018-01-12">https://medium.com/hackernoon/microservices-architecture-for-mobile-application-development-part-ii-1a68db3aa438?source=collection_archive---------10-----------------------#2018-01-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="40fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">在此阅读</em> <a class="ae jq" rel="noopener" href="/@prashantramnyc/microservices-architecture-for-mobile-application-development-part-i-20b4f4089a24"> <strong class="it hv"> <em class="jp">第1部分！</em> </strong> </a></p><p id="848a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<a class="ae jq" rel="noopener" href="/@prashantramnyc/microservices-architecture-for-mobile-application-development-part-i-20b4f4089a24"> <strong class="it hv"> <em class="jp">第一部分</em> </strong> </a>中，我们讨论了如何将一个大型复杂的React原生应用分解成较小的<strong class="it hv"> <em class="jp"> React原生迷你应用</em> </strong>(使用电极原生)，以及如何将迷你应用组合在一起以构建更大的应用。迷你应用允许使用<strong class="it hv"> <em class="jp">为每个迷你应用</em> </strong>使用单独的代码库进行开发，并且<strong class="it hv"> <em class="jp">迷你应用可以围绕特定的业务特性</em> </strong>进行开发。这也允许不同的团队开发每个迷你应用程序。T29】</p><p id="5f05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还讨论了使用React Native时的<strong class="it hv"> <em class="jp">设备上数据存储选项</em> </strong>，而<strong class="it hv"> <em class="jp">领域数据库</em> </strong>成为了一个可行的竞争者。</p><p id="f146" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们收集了各种文章和论坛，以检查和总结在使用React Native  时遇到的一些<strong class="it hv"> <em class="jp">常见性能问题，并探索可能缓解这些问题的解决方案。</em></strong></p><p id="f397" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第二部分中，我们将探讨用React Native构建迷你应用程序的一些更深层次的实现问题，并重点关注</p><ul class=""><li id="190b" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated"><em class="jp">将React Native与现有本机代码集成</em></li><li id="d7bf" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><em class="jp">推送通知(远程和本地)和亚马逊SNS移动推送</em></li><li id="6f78" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><em class="jp">持续会话管理</em></li><li id="af08" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><em class="jp">利用AWS为React原生应用提供的其他MBaaS工具</em></li></ul><p id="29b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的目标仍然是实现一种微服务方法来构建移动应用程序，从而允许不同的团队处理移动应用程序的不同部分，以及一个松散耦合的移动应用程序，可以以不同的增量部署，而不是一个单一的整体移动应用程序。</p><h1 id="6039" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated"><strong class="ak">将React Native与现有App代码集成？</strong></h1><p id="4f95" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">当你从头开始一个新的移动应用时，React Native是很棒的。然而，对于向现有的本地应用程序添加单个视图或用户流，它也能很好地工作。只需几个步骤，您就可以添加新的基于React Native的功能、屏幕、视图等。</p><p id="0539" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，当使用React Native构建应用程序时，有时可能需要访问本机平台API或只是与一些本机代码进行交互。这可能是由许多原因造成的。</p><ul class=""><li id="713b" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated"><em class="jp">性能问题:</em>为了减少React Native JS桥上的传递次数，在Native中实现移动应用程序的某个部分可能是一种更好的方法</li><li id="186a" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><em class="jp">遗留问题:</em>在<a class="ae jq" href="https://www.youtube.com/watch?v=tUfgQtmG3R0" rel="noopener ugc nofollow" target="_blank">棕地开发</a>中，如果您已经有一个现有的移动应用程序，并且正在React Native中创建移动应用程序的新部分，您可能需要使用一些现有的Objective-C、Swift或C++代码，而不必在JavaScript React Native中重新实现。</li><li id="bdc6" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><em class="jp">平台访问:</em>在某些情况下，你可以从React本地javascript代码中访问平台API，如iOS日历API或照片API。</li></ul><p id="835c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">React Native附带了一个名为Native Modules的特性，使用该特性，React Native javascript代码可以访问底层Native平台的全部功能。请注意，任何这样的模块都必须为每个平台单独编写，我们用一些跨平台代码奇偶校验来换取性能效率和本机灵活性。</p><h2 id="023f" class="li kg hu bd kh lj lk ll kl lm ln lo kp jc lp lq kt jg lr ls kx jk lt lu lb lv dt translated"><strong class="ak"><em class="lw">TL:DR；React Native </em>中的原生模块</strong></h2><p id="f2f1" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">一个<a class="ae jq" href="https://facebook.github.io/react-native/docs/native-modules-ios.html" rel="noopener ugc nofollow" target="_blank">本机模块</a>只是一个Objective-C类，它实现了RCTBridgeModule协议。除了实现RCTBridgeModule协议，您的类还必须包含RCT _导出_模块()宏。React Native不会向JavaScript公开CalendarManager的任何方法，除非明确告知这样做。这是使用RCT _导出_方法()宏完成的。</p><p id="20fa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，您可以创建一个图像组件，它是一个使用SDWebImage的桥接本机组件，这样我们就可以与应用程序的本机端共享缩略图的图像缓存。它的工作原理是:</p><ul class=""><li id="ece7" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated">声明一个JavaScript组件来表示您的本机组件</li><li id="4847" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">让React Native知道您打算引用组件的本机代码</li><li id="1d55" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">创建一个与你的道具界面相同的原生视图</li><li id="b89e" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">使用桥接宏向JavaScript公开您的接口</li></ul><p id="e9a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Swift不支持宏，因此将其暴露给React Native需要更多的设置，但工作方式相对相同。</p><blockquote class="lx ly lz"><p id="5557" class="ir is jp it b iu iv iw ix iy iz ja jb ma jd je jf mb jh ji jj mc jl jm jn jo hn dt translated"><strong class="it hv">iOS中单个项目文件中可以使用Objective C和Swift吗？</strong></p><p id="9ffd" class="ir is jp it b iu iv iw ix iy iz ja jb ma jd je jf mb jh ji jj mc jl jm jn jo hn dt translated"><a class="ae jq" href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html" rel="noopener ugc nofollow" target="_blank"> Objective-C和Swift文件可以共存于单个项目</a>，无论该项目最初是Objective-C还是Swift项目。</p><p id="1cb0" class="ir is jp it b iu iv iw ix iy iz ja jb ma jd je jf mb jh ji jj mc jl jm jn jo hn dt translated">每当您在iOS项目中混合使用Swift和Objective-C时，您将需要一个额外的桥接文件，称为桥接文件头，以将Objective-C文件暴露给Swift。如果您通过Xcode文件&gt;新建文件菜单选项将Swift文件添加到您的应用程序，Xcode将为您创建此头文件。您需要在这个头文件中导入RCTBridgeModule.h。在Xcode中混合两种语言时要小心，因为如果没有正确实现，桥可能会泄漏。</p></blockquote><h1 id="4ec0" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">推送通知(远程和本地)和Amazon SNS移动推送</h1><p id="529b" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">推送通知很难，并且在React原生应用中存在独特的问题。这是React Native的另一部分，可能需要针对所使用的特定平台进行定制。</p><p id="5bf4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在研究React Native中的推送通知时，我偶然发现了斯潘塞·卡利的两个关于本地推送通知(使用<a class="ae jq" href="https://github.com/zo0r/react-native-push-notification" rel="noopener ugc nofollow" target="_blank"><em class="jp">React-Native-Push-Notification</em></a>)和远程推送通知(使用<a class="ae jq" href="https://onesignal.com/" rel="noopener ugc nofollow" target="_blank"><em class="jp">one signal</em></a><em class="jp">)</em></p><ul class=""><li id="5f9c" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated"><a class="ae jq" rel="noopener" href="/differential/how-to-setup-push-notifications-in-react-native-ios-android-30ea0131355e"> <em class="jp">如何在React Native中设置本地推送通知(iOS &amp; Android) </em> </a></li><li id="51cd" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" rel="noopener" href="/differential/react-native-push-notifications-with-onesignal-9db6a7d75e1e"> <em class="jp">用一个信号反应本机远程推送通知</em> </a></li></ul><p id="68b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">进一步的研究表明，有几个用于本地通知设置的开源npm库，包括，<br/><a class="ae jq" href="https://www.npmjs.com/package/react-native-notifications" rel="noopener ugc nofollow" target="_blank">react-native-notifications</a>，<a class="ae jq" href="https://www.npmjs.com/package/react-native-push-notifications" rel="noopener ugc nofollow" target="_blank">react-native-push-notifications</a>，<a class="ae jq" href="https://www.npmjs.com/package/react-native-onesignal" rel="noopener ugc nofollow" target="_blank"> react-native-onesignal </a>等等。</p><p id="08bf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我看到了另一篇有趣的文章，比较了OneSignal、urban导和亚马逊SNS移动推送。</p><p id="3070" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> <em class="jp">问题现在变成了<br/> 1。如何将推送通知整合到使用一组迷你应用构建的宏应用中？</em> </strong></p><p id="9077" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">解决方案似乎是为宏应用程序建立通知，而不是在每个组成的迷你应用程序中。 然而，我们在这里冒险进入稀薄的氛围，因为React Native和Electrode Native的许多功能仍然是新的和不断发展的，我还没有遇到过自信地实施这种方法的团队。虽然以这种方式连接各个部分似乎是合乎逻辑的方法。</p><p id="90eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">2<em class="jp">。可以使用亚马逊SNS移动推送vs OneSignal或其他竞争产品，作为推送通知的MBaaS来反应原生应用程序吗？</em> </strong></p><p id="8e07" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里的研究显示，亚马逊在2017年底发布了对React原生应用推送通知的支持。这意味着您可以在Amazon SNS Mobile Push中为React Native应用程序创建一个移动端点(通过使用iOS凭据获得iOS支持，使用Google Firebase注册ID获得Android支持)。</p><p id="790b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，使用Amazon SNS Mobile Push作为推送至宏应用程序(使用组成的迷你应用程序构建)的服务，似乎是在使用微服务方法构建的应用程序中实现推送通知的可行方法。请记住，虽然在这一点上，这仅仅是猜测，我们的团队还没有实现这作为一个彻底的测试。这些技术平台和范例相对较新，但是以这种方式连接它们似乎是一种可行的方法。</p><h1 id="8fca" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">React本地应用中的持久用户会话管理</h1><p id="2bf5" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">持续用户会话是移动应用中的常见功能，用户必须登录才能访问应用中受保护的内容。用户会话必须由应用程序正确管理，以获得无缝的用户体验，这样用户就不会在每次启动应用程序时被注销。</p><p id="26eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我看到了下面的<a class="ae jq" href="http://blog.theodo.fr/2017/03/how-to-create-an-authentication-system-and-a-persistent-user-session-with-react-native/" rel="noopener ugc nofollow" target="_blank">文章，作者使用React Native Async storage和react-native-router-flux实现了一个简单的持久用户会话管理</a>。方法很简单</p><ul class=""><li id="0353" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated">向用户显示一个身份验证页面，在该页面上，用户将被提示输入用户名和密码，并能够注册或登录</li><li id="dde5" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">允许用户使用后端API注册或登录，可能使用OAuth2。</li><li id="aa43" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">从手机的<em class="jp">异步存储器</em>中存储和恢复身份令牌</li><li id="ee56" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">允许用户使用id令牌从API的受保护路由获取内容</li><li id="ffa7" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">验证id令牌是否存在，以创建持久用户会话</li><li id="abfb" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">允许用户访问受保护的主页，用户将能够从API获取受保护的内容或注销。</li></ul><p id="ca86" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">这种方法非常简单，可以在宏应用程序中使用，异步或领域数据库作为底层持久存储。迷你应用还可以使用持久用户会话和令牌来访问各个迷你应用内的受保护内容。</em></p><p id="0b4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另一种可能的替代方法是使用AWS mobile hub IAM管理服务来管理用户会话。这当然使用Amazon Cognito作为认证后端。</p><h1 id="b9a0" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">摘要</h1><p id="bb7a" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">React Native中的迷你应用是开发实现微服务范式的移动应用的可行方法。除了React Native提供的跨平台优势，迷你应用还允许<strong class="it hv"> <em class="jp">单独的代码库，基于业务功能的团队分离</em> </strong>和<strong class="it hv"> <em class="jp">分别扩展和部署移动应用部分的能力</em> </strong>。还可以对使用React Native构建的应用程序进行代码推送(现在是Visual Studio App Center ),这允许用户在手机上更新应用程序，而不必通过应用程序商店。这在推出热补丁或A/B测试或canary发布时非常有用。</p><p id="0fa4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">迷你应用和宏应用可以使用<strong class="it hv"> <em class="jp">异步存储或领域数据库</em> </strong>实现设备上的数据持久性。这可以用于持续的用户会话管理，以避免用户每次在手机上打开应用程序时都要登录。</p><p id="6653" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">理解React Native的细微差别对于充分利用React Native的性能非常重要。为此，确定反应本地桥  e上的<strong class="it hv"> <em class="jp">通道数量并保持该数量较低非常重要。</em></strong></p><p id="de1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在棕地开发的情况下，React Native允许React本机代码与现有的本机代码接口，并且<strong class="it hv"> <em class="jp">本机模块允许开发人员从JS代码访问本机平台API。</em> </strong></p><p id="788d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> <em class="jp">迷你应用的推送通知实现可以在宏应用级别完成，而不是在迷你应用级别。有几个库允许在React Native和平台(如OneSignal)中实现本地通知，允许远程通知，但是这种实现仍然是相对较新的未知领域。</em></strong></p><p id="c856" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Amazon SNS移动推送和npm库可以用来实现推送通知服务。值得注意的是，需要添加特定于平台的代码来实现本机反应，并且在应用程序的iOS实现和Android实现的GCM或Firebase的情况下将使用APN。后端管道可以连接到Amazon SNS Mobile Push作为移动端点，后者又可以连接到Amazon SNS publisher，或者在需要时从AWS Lambda服务或其他SQS服务触发。</p></div><div class="ab cl md me hc mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hn ho hp hq hr"><p id="1553" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">觉得这个帖子有用？点击</em>👏<em class="jp">下面的按钮显示你有多喜欢它:)</em></p><p id="43e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" rel="noopener" href="/@prashantramnyc"> <strong class="it hv"> <em class="jp">关注我上媒</em> </strong> </a> <strong class="it hv"> <em class="jp">获取最新更新和帖子！</em>T13】</strong></p><figure class="ml mm mn mo fq mp fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff mk"><img src="../Images/357de15ef0c461d3d85722efc3bae795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrJKJqBsksWd-8uKM9OvgA.png"/></div></div></figure><p id="db02" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">阅读下一篇:</strong> <a class="ae jq" rel="noopener" href="/@prashantramnyc/microservices-architecture-for-mobile-application-development-part-i-20b4f4089a24">移动应用开发的微服务方法</a></p><p id="8342" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">其他文章:<br/> </strong> <a class="ae jq" rel="noopener" href="/@prashantramnyc/how-to-build-a-simple-sprite-animation-in-javascript-b764644244aa">如何用Javascript构建一个简单的Sprite动画</a></p><p id="7861" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" rel="noopener" href="/@prashantramnyc/promises-in-javascript-explained-277b98850de">承诺用Javascript解释！</a></p></div></div>    
</body>
</html>