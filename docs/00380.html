<html>
<head>
<title>DNS-based DDoS against Uber</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">针对优步的基于DNS的DDoS攻击</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/dns-based-ddos-against-uber-dabc6818cf75?source=collection_archive---------11-----------------------#2018-01-12">https://medium.com/hackernoon/dns-based-ddos-against-uber-dabc6818cf75?source=collection_archive---------11-----------------------#2018-01-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="8823" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在过去的几周里，我一直在测试DNS解析器。</p><p id="7090" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我一直试图找到最好的DNS提供商供个人使用，但主要是为了好玩和好奇。<em class="jq">嘿，谁不想知道Quad9阻止的</em> <a class="ae jp" rel="noopener" href="/@nykolas.z/dns-security-filters-compared-quad9-x-opendns-x-comodo-secure-x-norton-connectsafe-x-yandex-safe-a00ace3bf21f"> <em class="jq">恶意域名</em> </a> <em class="jq">是否比OpenDNS多，或者哪个提供商拥有最好的色情过滤器</em><a class="ae jp" href="https://hackernoon.com/porn-filters-compared-opendns-neustar-cleanbrowsing-norton-yandex-and-adguard-41f207062c4" rel="noopener ugc nofollow" target="_blank"><em class="jq"/></a><em class="jq">。</em></p><p id="fb74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这样做的同时，我还在公共云中设置了自己的DNS解析器来测试PowerDNS和Bind。一切都很顺利，除了它们开始被误用和滥用，作为DDoS others的代理。</p><h2 id="a91d" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">放大DDoS攻击</h2><p id="20e1" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">最常见的DNS DDoS技术之一叫做DNS放大攻击。有人，又名坏人，欺骗他们的受害者的IP地址，并发出DNS查询作为他们。DNS服务器响应受害者IP地址，而不是坏人。</p><p id="583a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">放大和危险来自于DNS查询与响应相比很小的事实。因此，如果攻击者发送1Gbps的查询，受害者可能会得到20Gbps的响应。它把坏人的攻击放大了一大截。有点吓人。</p><p id="ff81" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了隐藏他们的身份，他们通过开放的DNS解析器代理这些攻击，这就是我测试的内容。举个例子，这是我在绑定查询日志中看到的内容:</p><blockquote class="kr ks kt"><p id="5f0f" class="ir is jq it b iu iv iw ix iy iz ja jb ku jd je jf kv jh ji jj kw jl jm jn jo hn dt translated">03-Jan-2018 20:07:52.493查询:信息:客户端<strong class="it hv">191 . 96 . 249 . xx</strong># 34418(isc . org):<strong class="it hv">查询:isc.org IN ANY+E</strong><br/>03-Jan-2018 20:07:52.494查询:信息:客户端<strong class="it hv">191 . 96 . 249 . xx</strong># 34411</p></blockquote><p id="4bf2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个坏家伙试图关闭191.96.249.xx。因此，他在ANY" 中发出对"<em class="jq">isc.org "的欺骗性查询，作为191.96.249.xx。这迫使我的解析器向受害者IP发送该查询生成的大量响应。每秒数百次，直到我关掉它。</em></p><p id="590d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，Bind有一种方法可以最大限度地减少滥用，并对每个源IP地址的DNS响应进行限速。经过一些研究，我在配置中添加了以下内容:</p><blockquote class="kr ks kt"><p id="af53" class="ir is jq it b iu iv iw ix iy iz ja jb ku jd je jf kv jh ji jj kw jl jm jn jo hn dt translated">速率限制{ <br/>每秒响应数5；<br/>}；</p></blockquote><p id="d327" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这限制了每个源IP地址每秒最多5次响应。这可以防止坏人滥用我的服务器进行攻击，因为每秒5次请求不足以打倒任何人。</p><p id="40b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在这里阅读更多关于<a class="ae jp" href="https://www.us-cert.gov/ncas/alerts/TA13-088A" rel="noopener ugc nofollow" target="_blank"> DNS扩增攻击的信息</a>。</p><h2 id="639c" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">随机子域DDoS</h2><p id="e1f5" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">然而，这并不是它的结束。今天，我开始看到一种新类型的DDoS攻击，如果不解析日志并通过iptables禁止IP地址，我仍然无法在Bind或PowerDNS上找到容易实现的解决方案。</p><p id="a02f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">受害者是<strong class="it hv">优步</strong>。</p><p id="8434" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有人，可能是另一个坏人或竞争对手，开始从随机的源IP地址中查询数百个在<strong class="it hv">uber.com</strong>下的无效子域。这绕过了我的绑定配置的速率限制，并强制我的DNS解析器为这些无效的子域联系优步的DNS服务器。日志中是这样的:</p><blockquote class="kr ks kt"><p id="bc78" class="ir is jq it b iu iv iw ix iy iz ja jb ku jd je jf kv jh ji jj kw jl jm jn jo hn dt translated">2018年1月11日13:01:22.356查询:信息:客户端51 . 15 . 57 . 237 # 37071(11–149 . Uber . com):查询:<strong class="it hv">11–149.uber.com</strong>在一个<br/>2018年1月11日13:01:22.357查询:信息:客户端51.15.57.237#37071 (15408.uber</p></blockquote><p id="5a88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每小时乘以几千就知道了。上面的日志可能很难看到，但坏人正在查询随机子域，如下所示:</p><blockquote class="kr ks kt"><p id="5a54" class="ir is jq it b iu iv iw ix iy iz ja jb ku jd je jf kv jh ji jj kw jl jm jn jo hn dt translated">12–229.uber.com<br/>16419.uber.com<br/>246–154.uber.com<br/>4399xiaoyouxidayouquan.uber.com<br/>49739431z70y5970530741.uber.com<br/>5755619.uber.com<br/>6831130420.fls.uber.com<br/>8ca16.uber.com<br/>bet 165 keyiwanma . Uber . com<br/>aomenguojibqaijale . Uber . com<br/>bet 3651 yuleechengkaihuxzhi . Uber . com<br/>biopc 311 . Uber . com<br/>cdn-m3 . Uber . com<br/>devpnp . Uber . com</p></blockquote><p id="357d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它们都不存在，生成一个NXDOMAIN。然而，DNS解析器需要为它们中的每一个联系优步的DNS服务器。</p><p id="5649" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我对日志进行了细分，这是它们平均每小时生成的数量:</p><blockquote class="kr ks kt"><p id="7d9c" class="ir is jq it b iu iv iw ix iy iz ja jb ku jd je jf kv jh ji jj kw jl jm jn jo hn dt translated">2018-1-11下午1:16每秒<br/>2018-1-11下午2:56每秒<br/>2018-1-11下午3:停止<br/>2018-1-11下午4:停止<br/>2018-1-11下午5:780每秒<br/>2018-1-11下午6:停止<br/>2018-1-11</p></blockquote><p id="ecd0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这只是我在公共云中的一个小小的解析器。他们可能滥用数百个开放的DNS解析器向优步的网络发出数以千计的虚假请求——要么关闭它，要么增加他们的运营成本。</p><p id="8c9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在那之后，我将我的测试解析器限制为只有我的IP地址来阻止滥用。这种攻击有趣的一点是，它几乎没有放大价值。1查询的字节大小与NXDOMAIN响应非常相似。</p><p id="a65e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，它仍然可以在保持攻击者匿名的情况下将他们拿下，并真正使他们的DNS服务器承受压力。</p></div></div>    
</body>
</html>