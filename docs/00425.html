<html>
<head>
<title>Migration to Python 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">迁移到Python 3</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/python-3-retrospective-fa7d404ee3cd?source=collection_archive---------23-----------------------#2018-01-13">https://medium.com/hackernoon/python-3-retrospective-fa7d404ee3cd?source=collection_archive---------23-----------------------#2018-01-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="3269" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">年初，我介绍了<a class="ae jp" rel="noopener" href="/@scott_walton/upgrading-to-python-3-cd23b21ecea5"> Pebble的长期运行项目</a>将我们的系统迁移到<a class="ae jp" href="https://hackernoon.com/tagged/python" rel="noopener ugc nofollow" target="_blank"> Python </a> 3。2017年底，我们做的怎么样？</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/d63cb633f8f2053824a78b286fcf9aef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2nuZrbaQmzkVTuYHXAypA.jpeg"/></div></div></figure><h1 id="5788" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">背景</h1><p id="fbd0" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">在Pebble，我们基于Python和<a class="ae jp" href="https://hackernoon.com/tagged/django" rel="noopener ugc nofollow" target="_blank"> Django </a>构建了我们的产品线。随着Django 2.0的即将发布和最大的框架取消了对Python 2的支持，我们决定现在是时候开始认真迁移到Python 3了。</p><p id="3dd9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了进行迁移，我们知道我们需要一种方法来让我们自己对我们的最终目标负责。我们首先在开发团队内部召开月度会议，回顾我们上个月的行动，并制定下个月要完成的行动。</p><p id="1711" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于我们作为一个企业和开发团队的规模，我们知道我们不能停止产品<a class="ae jp" href="https://hackernoon.com/tagged/development" rel="noopener ugc nofollow" target="_blank">开发</a>只是更新我们的系统到<a class="ae jp" href="https://hackernoon.com/tagged/python" rel="noopener ugc nofollow" target="_blank"> Python </a> 3。这导致我们以更零碎的方式更新我们的系统。</p><h1 id="606e" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">回顾</h1><p id="9cc3" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">和任何项目一样，我们经历了起起落落。有些事情进行得非常顺利，有些事情进行得不太顺利，有些事情我们根本就没有实现。</p><h2 id="acbe" class="lf kd hu bd ke lg lh li ki lj lk ll km jc lm ln kq jg lo lp ku jk lq lr ky ls dt translated">好人</h2><p id="db5a" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">我们最大的胜利之一是跟踪和改进我们整个系统的代码覆盖率和lint分数。这样做的一个主要好处是，我们现在能够将这些度量作为KPI来跟踪，以测量我们开发过程的整体健康状况。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lt"><img src="../Images/62cc126a19ff4db9d677c9bbb1a42170.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L9fJJSAUIyOOefuQf-n-sg.jpeg"/></div></div></figure><p id="e0fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将我们的代码库分离出来，特别是我们的<a class="ae jp" href="https://www.mypebble.co.uk/software/fm/" rel="noopener ugc nofollow" target="_blank">基金经理</a>和<a class="ae jp" href="https://www.mypebble.co.uk/software/arro/" rel="noopener ugc nofollow" target="_blank"> Arro </a>产品，使得单独更新系统变得更加容易。我们能够在一个周末执行这种拆分，在这个周末，宕机不会影响我们的用户，对用户几乎没有任何影响。</p><p id="665c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的大多数系统要么现在运行Python 3，要么将在2018年第一季度内更新到Python 3。这一年中的持续工作确保了，到2017年12月底，我们只需要花几天时间完成剩余的代码库，就可以在Python 3中通过测试。我们的系统覆盖率达到90%,我们对下一阶段的迁移充满信心。</p><p id="30ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们跟踪了迁移到Python 3所需完成的动作列表，并在可能的情况下，将它与我们的产品路线图结合起来。这样做让我们很好地了解了什么时候事情可以完成，甚至允许我们删除那些我们预计不再需要的棘手的依赖项(即<em class="lu"> suds </em>)。我们把清单上的每一项都分配给一个人，由他来完成或监督完成。</p><h2 id="5608" class="lf kd hu bd ke lg lh li ki lj lk ll km jc lm ln kq jg lo lp ku jk lq lr ky ls dt translated">坏事</h2><p id="8ea0" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">我们把我们的代码库分割得比我们可能应该的要多。虽然这使得更新单个系统变得更加容易，但也使得保持每个项目的库版本更新更加耗费人力。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lv"><img src="../Images/a33502ca20ffc8da229e6c7896c5c563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4_QIIx9jc7cmMIzmQYFiw.jpeg"/></div></div></figure><p id="d6e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的月度会议很好地记录了我们承诺要做的事情，但是太多的项目在太长的时间里都没有完成。我相信部分原因是因为这个列表与我们通常的产品开发路线图分开维护。</p><h2 id="1848" class="lf kd hu bd ke lg lh li ki lj lk ll km jc lm ln kq jg lo lp ku jk lq lr ky ls dt translated">丑陋的</h2><p id="b2ef" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">我们的一个系统仍然基于Python 2.7，这在不久的将来不太可能改变。在接下来的6-12个月里，我们将在整个企业中开展工作，找出我们需要从这个系统中得到什么。使用这个，我们将能够决定我们是否维护和升级系统，或者我们是否废弃和重写代码库。</p><h1 id="8245" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">经验教训</h1><p id="9b75" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">这个项目非常有趣，虽然在技术上没有挑战性，但提供了一些有趣的业务关注点，新手项目经理或首席开发人员可能会被绊倒。这是一个没有直接面向客户利益的项目，但是会在将来改进你的产品开发过程。</p><h2 id="1b41" class="lf kd hu bd ke lg lh li ki lj lk ll km jc lm ln kq jg lo lp ku jk lq lr ky ls dt translated">高层沟通</h2><p id="dca9" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">在开始这样的项目之前，确保可能受到影响的团队大致了解你在做什么以及为什么。保持高水平，用你的听众能理解的语言。</p><p id="aa7d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，在向您的支持团队解释这一举措的好处时，以下内容不会有所帮助:</p><blockquote class="lw lx ly"><p id="f4ff" class="ir is lu it b iu iv iw ix iy iz ja jb lz jd je jf ma jh ji jj mb jl jm jn jo hn dt translated">Python 3中出色的异常处理将使追踪bug变得更加容易。</p></blockquote><p id="6b5c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">相反，将这些好处更进一步，并将其与您的支持团队的目标联系起来:</p><blockquote class="lw lx ly"><p id="7abb" class="ir is lu it b iu iv iw ix iy iz ja jb lz jd je jf ma jh ji jj mb jl jm jn jo hn dt translated">我们将能够更快地解决客户问题，并有更大的信心。</p></blockquote><p id="324a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有，<em class="lu">对潜在的影响要诚实！</em> <strong class="it hv"> </strong>更广泛的业务是为了帮助你向客户提供优秀的产品，但如果你不预先知道你认为可能会出错的事情，就无法做到这一点。根据你的公司文化，他们甚至可以提供帮助测试，他们可以提前与客户沟通，并帮助保持压力。</p><h2 id="a68a" class="lf kd hu bd ke lg lh li ki lj lk ll km jc lm ln kq jg lo lp ku jk lq lr ky ls dt translated">保持和维护一个列表</h2><p id="21b2" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">减缓我们开发的一个主要因素是我们单独维护这个列表。我坚信保留一份工作清单作为会议记录和成果是正确的做法。我认为我们犯的错误是没有将这些行为添加到我们的产品backlog中。这意味着产品经理和我之间的讨论没有在计划阶段包含这些必要的工作。</p><p id="2726" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我应该做的是将所有的任务转移到我们的常规产品backlog中，并维护受托人。然后，我们可以在会议记录的结果部分记下票号。这样做意味着开发团队工作的常规工作列表包括了一致同意的任务，我们将有一个明确的完成迁移的终点。</p><p id="d34b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这并不意味着我们抛弃会议记录结构——远非如此！为会议记录分配票据参考会使在接下来的会议上达成一致变得更加容易！</p><h2 id="da94" class="lf kd hu bd ke lg lh li ki lj lk ll km jc lm ln kq jg lo lp ku jk lq lr ky ls dt translated">使用状态更新会议</h2><p id="9c25" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">当像这样做长期运行的项目时，<em class="lu">安排具体的状态更新会议</em>。将此会议放在每周或每月定期的日历事件中，并为此腾出时间。如果你试图把它推进公司的一般会议或其他会议，你会发现这个项目永远不会获得动力。</p><h2 id="cede" class="lf kd hu bd ke lg lh li ki lj lk ll km jc lm ln kq jg lo lp ku jk lq lr ky ls dt translated">定期测试Python 3</h2><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mc"><img src="../Images/6eed5a32acf5bbeefcd6ea0c25776fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DufjRZe9unjaQpcHoKq-Ew.jpeg"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">What your system will look like the first time you test Python 3</figcaption></figure><p id="5ad4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然大部分语法变化都很简单，但是最大的挑战是如何处理Python对字符串的处理。您将会发现，只有当您开始尝试用输入测试代码路径时，它们才会失效。花时间在与更广阔的世界互动的领域上运行您的测试套件。确保您在这里运行一些集成测试！</p><h2 id="dec4" class="lf kd hu bd ke lg lh li ki lj lk ll km jc lm ln kq jg lo lp ku jk lq lr ky ls dt translated">将它包含在代码评审中</h2><p id="8462" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">根据代码库的大小，这将需要一些时间。业务的其余部分可能不同意在开发团队工作时停止特性开发，所以您需要达成妥协。</p><p id="6b88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们这边，我们将Python 3项目整合到我们的产品开发中。为了保持两者一致，我们同意强制使用Python 3的习惯用法，<code class="eh mh mi mj mk b">six</code>等。作为我们代码审查过程的一部分。简而言之，审查者会查看每一个编辑过的文件，寻找<code class="eh mh mi mj mk b">__future__</code>导入、<code class="eh mh mi mj mk b">str</code>和<code class="eh mh mi mj mk b">unicode</code>被<code class="eh mh mi mj mk b">six.binary_type</code>和<code class="eh mh mi mj mk b">six.text_type</code>替换，以及一系列其他更改。</p><p id="bf00" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">事实是，当你编码时，你关注的是解决手头的任务，而不是Python 3。通过给予审查者查看Python 3兼容性的许可，我们能够非常快速地升级我们最常用的代码，并更新一些我们原本不会想到要查看的区域！</p><h1 id="66ba" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">摘要</h1><p id="fb2f" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">我们表现如何？我们仍然有一个优秀的代码库，将无法达到Python 3的目标，但是我们的关键产品线将在二月底之前上线Python 3。我认为我们的方法非常有效。</p><p id="d123" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你正在升级你的代码库到Python 3，让我知道这是否有帮助！如果你有什么自己的小技巧，请在下面分享。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ml mm l"/></div></figure></div></div>    
</body>
</html>