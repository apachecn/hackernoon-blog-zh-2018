<html>
<head>
<title>A tale of two Samsungs: ARM vs. Qualcomm in Android graphics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两个三星的故事:安卓图形中的ARM与高通</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-tale-of-two-samsungs-arm-vs-qualcomm-in-android-graphics-c1c6f1eef828?source=collection_archive---------8-----------------------#2018-01-17">https://medium.com/hackernoon/a-tale-of-two-samsungs-arm-vs-qualcomm-in-android-graphics-c1c6f1eef828?source=collection_archive---------8-----------------------#2018-01-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="b129" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">比较ARM和高通Android图形驱动程序的可靠性，S8至S8</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/067e550ed8d72ebf91f20730a2e10cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HTK0KCfEgmEc-fQogIy6iA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">The GraphicsFuzz ShaderTest GLES test suite reveals a variety of graphics driver issues on the Samsung Galaxy S8. The Qualcomm GPU model suffers from considerably more rendering issues and crashes than the ARM GPU model. <a class="ae jz" href="#02a6" rel="noopener ugc nofollow">Skip to our analysis of the results</a>.</figcaption></figure><p id="aac0" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><strong class="kc hv">参见:</strong>后续帖子评估:</p><ul class=""><li id="d883" class="kw kx hu kc b kd ke kg kh kj ky kn kz kr la kv lb lc ld le dt translated"><a class="ae jz" rel="noopener" href="/@afd_icl/nvidia-shield-reliable-graphics-2aa79e04e150">英伟达盾</a></li><li id="aecd" class="kw kx hu kc b kd lf kg lg kj lh kn li kr lj kv lb lc ld le dt translated"><a class="ae jz" rel="noopener" href="/@afd_icl/google-and-qualcomm-pixel-perfect-e8ecefaf5968">谷歌像素设备</a></li></ul><p id="4739" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">Hugues Evrard、Paul Thomson和我最近成立了一家公司<a class="ae jz" href="https://www.graphicsfuzz.com/" rel="noopener ugc nofollow" target="_blank"> GraphicsFuzz </a>，专门从事图形驱动程序的自动化测试。该公司是伦敦帝国理工学院的研究成果，我们去年通过一系列媒介故事对其进行了描述。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><a href="https://www.graphicsfuzz.com/benchmark/android-v1.html"><div class="fe ff lk"><img src="../Images/ce2b5769896292ae18f8e62ec1c8f2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LzEhQp21XfsPU5EjH9fqfQ.png"/></div></a><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Click above to try out our GraphicsFuzz Android benchmark web app.</figcaption></figure><p id="4d2f" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我们最初的产品是<a class="ae jz" href="https://www.graphicsfuzz.com/index.html#products" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv">shader test GLES</strong></a>，这是一个大型的片段着色器套件，GPU设计人员可以授权它来彻底测试OpenGL ES驱动程序的可靠性。</p><p id="78e7" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">这是一系列故事中的第一个，我们将看看Android <a class="ae jz" href="https://hackernoon.com/tagged/opengl" rel="noopener ugc nofollow" target="_blank"> OpenGL </a> ES驱动程序的可靠性，通过在<strong class="kc hv"> ShaderTest GLES </strong>着色器的代表性样本上运行它们来判断。</p><p id="d66e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">您还可以通过<a class="ae jz" href="https://www.graphicsfuzz.com/benchmark/android-v1.html" rel="noopener ugc nofollow" target="_blank"> GraphicsFuzz Android基准测试</a>在您的Android设备上试用这些着色器，在您的浏览器中试用web应用程序，并让我们知道您的发现！</p><h1 id="bfcd" class="ll lm hu bd ln lo lp lq lr ls lt lu lv ja lw jb lx jd ly je lz jg ma jh mb mc dt translated">着色器测试GLES:测试着色器编译器质量</h1><p id="8530" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">我们将从GLES shader test的一些背景开始，但是如果你不耐烦，你可以跳到结果！</p><p id="3c56" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">传统的GPU测试套件侧重于渲染速度或API功能完整性。着色器测试GLES通过测试<em class="mi">着色器编译器质量</em>为故事增添了另一个维度。毕竟一个快速的渲染结果，如果是错的，可能并不是特别有用！</p><p id="f8d2" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">在与业内软件工程师的交谈中，我们一次又一次地听到GPU驱动程序开发人员优先针对高知名度的游戏和应用程序测试他们的驱动程序，例如谷歌Play商店排名前100的游戏。一个不幸的副作用是，不太受欢迎的应用程序的开发者必须解决驱动程序错误，才能让他们的应用程序在消费设备上工作。再加上Android更新推送给最终用户的速度很慢，这就造成了一种自我延续的情况，即GPU驱动程序错误不被视为一个严重的问题，因为流行的游戏运行良好(可能使用变通办法)，GPU驱动程序错误不值得报告，因为如果你希望消费者能够使用你的应用程序，无论如何都有必要解决这些错误。这也阻碍了开发人员编写有趣的着色器:除非驱动程序质量得到改善，否则他们不太可能在一系列设备上工作。</p><h1 id="409d" class="ll lm hu bd ln lo lp lq lr ls lt lu lv ja lw jb lx jd ly je lz jg ma jh mb mc dt translated">ShaderTest GLES方法</h1><p id="2192" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">(<a class="ae jz" rel="noopener" href="/@afd_icl/crashes-hangs-and-crazy-images-by-adding-zero-689d15ce922b">关于着色器和着色器编译器</a>的一些背景，请参见本文。)</p><p id="1385" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">GLES着色器测试由许多<em class="mi">着色器家族</em>组成。每个系列包含一个用于渲染单个帧的<em class="mi">参考</em> <strong class="kc hv"> <em class="mi"> </em> </strong> <em class="mi">着色器</em>，以及数百个用于渲染视觉上与参考相同的帧的<em class="mi">变体着色器</em>，但在此过程中以完全不同的方式锻炼驱动程序。</p><p id="7808" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">变体着色器是通过将<em class="mi">语义保留变换— </em>变换应用于不应影响渲染结果的引用着色器的源代码而从引用着色器获得的。例如，将引用着色器中的代码块包装在以下形式的循环中:</p><pre class="jk jl jm jn fq mj mk ml mm aw mn dt"><span id="0c95" class="mo lm hu mk b fv mp mq l mr ms">for (int i = 0; i &lt; 1; i++) {<br/>  // original code from reference shader<br/>}</span></pre><p id="df87" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">是保持语义转换的一个简单例子。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mt"><img src="../Images/3b03eca6c8d06d2a76204d2a767e598b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cUYAohZpIroVbaRNUIjjfg.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">ShaderTest GLES finds bugs in graphics drivers by identifying rendering mismatches, errors and crashes, across families of equivalent shaders.</figcaption></figure><p id="b947" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">ShaderTest ES在以下情况下会突出显示驱动程序错误和问题:</p><ul class=""><li id="c2d0" class="kw kx hu kc b kd ke kg kh kj ky kn kz kr la kv lb lc ld le dt translated">一个变体着色器被驱动程序的着色器编译器拒绝<em class="mi">——一个<strong class="kc hv">编译失败</strong>；</em></li><li id="7a0f" class="kw kx hu kc b kd lf kg lg kj lh kn li kr lj kv lb lc ld le dt translated">一个变体着色器导致驱动程序的某个组件<em class="mi">崩溃</em>——一个<strong class="kc hv">崩溃错误</strong>；</li><li id="1142" class="kw kx hu kc b kd lf kg lg kj lh kn li kr lj kv lb lc ld le dt translated">与参考着色器相比，变体着色器导致渲染的图像明显不同——这是一个<strong class="kc hv">渲染问题</strong>；</li><li id="b9d8" class="kw kx hu kc b kd lf kg lg kj lh kn li kr lj kv lb lc ld le dt translated">一个变体着色器导致驱动程序由于时间或内存限制而退出——一个<strong class="kc hv">资源问题</strong>。</li></ul><p id="7888" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><strong class="kc hv">编译失败</strong>和<strong class="kc hv">崩溃错误</strong>总是表明有bug。<strong class="kc hv">渲染问题</strong>通常<em class="mi"> </em>由于<em class="mi">误编译</em>错误而出现，由此着色器编译器生成错误代码；由于图形系统中的浮点敏感性，它们有时也会表现出来——shader test GLES可以揭示这两个问题。这里的一大优势是触发渲染问题的错误编译很难被检测到，因此通常会避开传统的测试技术。<strong class="kc hv">资源问题</strong>提供对图形驱动程序的非功能性约束的洞察。</p><h1 id="02a6" class="ll lm hu bd ln lo lp lq lr ls lt lu lv ja lw jb lx jd ly je lz jg ma jh mb mc dt translated">为三星干杯！</h1><p id="35e2" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">让我们首先比较一些参考和变体着色器与市场上最受欢迎的Android设备之一:三星Galaxy S8手机的结果。根据地域的不同，S8配备了ARM或高通GPU，所以让我们看看这些GPU设计师的驱动程序如何。</p><p id="05a0" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html" rel="noopener ugc nofollow" target="_blank">我们的GraphicsFuzz网站展示了ARM和高通S8模型在10个着色器家族中的对比</a>。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><a href="https://www.graphicsfuzz.com/results/S8vS8.html"><div class="fe ff mu"><img src="../Images/d198b7ed85b1f6f9c87d62cea461728e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rrUtEp97Ner5iJKXlHmY0Q.png"/></div></a><figcaption class="jv jw fg fe ff jx jy bd b be z ek">A snapshot of <a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html" rel="noopener ugc nofollow" target="_blank">our online results table</a>, which compares the ARM and Qualcomm S8s head-to-head.</figcaption></figure><p id="1797" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">比较ARM和高通GPU驱动程序之间的结果——从现在开始，我们将简单地称它们为“ARM”和“高通”——ARM模型整体上看起来更可靠。我们发现以下问题:</p><h2 id="9622" class="mo lm hu bd ln mv mw mx lr my mz na lv kj nb nc lx kn nd ne lz kr nf ng mb nh dt translated">渲染问题</h2><p id="58e0" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">高通的渲染问题要多得多<strong class="kc hv"/>:<a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html" rel="noopener ugc nofollow" target="_blank">我们的表格</a>显示了高通的五个渲染问题，而ARM只有一个。</p><p id="2f04" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">例如，<a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_001" rel="noopener ugc nofollow" target="_blank">检查着色器系列001 </a>的结果。抛开崩溃不谈，ARM普遍渲染参考图像:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><a href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_001"><div class="fe ff ni"><img src="../Images/efe122a9865cfa9c45f1257bb8614fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*4Xlw1KjNIy-DoSub3plHGg.png"/></div></a><figcaption class="jv jw fg fe ff jx jy bd b be z ek">The reference image for <a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_001" rel="noopener ugc nofollow" target="_blank"><em class="nj">shader family 001</em></a><em class="nj">. All variants should render a similar image.</em></figcaption></figure><p id="63d3" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">对于高通，我们得到了大多数变体的参考图像，但也有一些错误的图像:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><a href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_001"><div class="fe ff nk"><img src="../Images/40638205c78b28d94c29acfa0d361e0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lEa3QiMfwmFCg3rNC-pXag.png"/></div></a><figcaption class="jv jw fg fe ff jx jy bd b be z ek">On Qualcomm, we get the expected image (left) for most variants in <a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_001" rel="noopener ugc nofollow" target="_blank">shader family 001</a>, but two erroneous images (middle and right), likely due to shader compiler bugs.</figcaption></figure><p id="3055" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_001" rel="noopener ugc nofollow" target="_blank">着色器家族001 </a>着色器的参考着色器对浮点不敏感，因此这些差异很可能对应于着色器编译器错误。</p><p id="6b0e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">对于<a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_007" rel="noopener ugc nofollow" target="_blank">着色器系列007 </a>的变体77，我们还观察到一个ARM渲染问题:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><a href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_007"><div class="fe ff nl"><img src="../Images/cfefb043588b93246823defc69140bd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*YpfIh38HCO6Ci-58u6tvaA.png"/></div></a><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Reference image for <a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_007" rel="noopener ugc nofollow" target="_blank">shader family 007</a> (left) compared with bad image rendered by variant 77 (right) on the ARM S8.</figcaption></figure><h2 id="2d61" class="mo lm hu bd ln mv mw mx lr my mz na lv kj nb nc lx kn nd ne lz kr nf ng mb nh dt translated">不确定性</h2><p id="c38e" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">我们的测试揭示了高通上的两个问题，其中驱动程序的行为不确定:有时着色器编译器在编译期间崩溃；其他时候编译成功，但呈现的图像不正确。这发生在<a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_007" rel="noopener ugc nofollow" target="_blank">着色器系列007 </a>的变体123和<a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_008" rel="noopener ugc nofollow" target="_blank">着色器系列008 </a>的变体51。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nm"><img src="../Images/d930582dfd82ab585469d4a0f003a77a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_HNx75EZa_P7wmvjcP8TeQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Each pair consists of an expected reference image (left image in pair), and a bad variant image rendered by Qualcomm (right image in pair). However, the Qualcomm driver fluctuates nondeterministically between producing this wrong image vs. crashing during compilation.</figcaption></figure><h2 id="32a8" class="mo lm hu bd ln mv mw mx lr my mz na lv kj nb nc lx kn nd ne lz kr nf ng mb nh dt translated">崩溃错误</h2><p id="b8b2" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">在我们的样本中，两位车手都表现出了多次撞车事故:高通28次，而ARM 15次。所有这些都是编译时分段错误—致命信号11 (SIGSEGV)。Android上可用的崩溃数据没有给出任何与这些崩溃的原因相关的信息。</p><p id="fe5c" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">有趣的是，两个驱动程序都无法处理<a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_006" rel="noopener ugc nofollow" target="_blank">着色器家族006 </a>的变体34而不崩溃。然而，正如我们将在<a class="ae jz" href="https://hackernoon.com/tagged/future" rel="noopener ugc nofollow" target="_blank">未来的</a>帖子中看到的，其他图形驱动程序可以处理这种变体。</p><h2 id="ee91" class="mo lm hu bd ln mv mw mx lr my mz na lv kj nb nc lx kn nd ne lz kr nf ng mb nh dt translated">编译失败</h2><p id="41e8" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">ARM驱动程序展示了一个编译器故障，这发生在<a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_003" rel="noopener ugc nofollow" target="_blank">着色器系列003 </a>的变体216上。该问题似乎与三元运算符(？:).高通显示了更多的编译器错误——总共九个(合并了编译器和链接器错误),尽管其中几个错误似乎是由于与switch语句处理相关的单个底层问题。</p><h2 id="771d" class="mo lm hu bd ln mv mw mx lr my mz na lv kj nb nc lx kn nd ne lz kr nf ng mb nh dt translated">资源问题</h2><p id="452d" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">我们的结果没有突出任何高通资源问题，但确实显示了ARM在<a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html#shader_family_003" rel="noopener ugc nofollow" target="_blank">着色器系列003 </a>的变体122上的资源问题，这在渲染期间给出了GL_OUT_OF_MEMORY。</p><p id="3e98" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><a class="ae jz" href="https://www.graphicsfuzz.com/results/S8vS8.html" rel="noopener ugc nofollow" target="_blank">查看完整的S8与S8结果表</a>，并试用<a class="ae jz" href="https://www.graphicsfuzz.com/benchmark/android-v1.html" rel="noopener ugc nofollow" target="_blank"> GraphicsFuzz Android基准测试web应用</a>！</p><h1 id="227c" class="ll lm hu bd ln lo lp lq lr ls lt lu lv ja lw jb lx jd ly je lz jg ma jh mb mc dt translated">下次…</h1><p id="8a6a" class="pw-post-body-paragraph ka kb hu kc b kd md iv kf kg me iy ki kj mf kl km kn mg kp kq kr mh kt ku kv hn dt translated">… <a class="ae jz" rel="noopener" href="/@afd_icl/nvidia-shield-reliable-graphics-2aa79e04e150">我们将看到NVIDIA的Shield TV的Android驱动程序如何支持</a>。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nn no l"/></div></figure></div></div>    
</body>
</html>