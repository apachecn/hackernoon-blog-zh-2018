<html>
<head>
<title>Redux-Saga tutorial for beginners and dog lovers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux-Saga新手和爱狗人士教程</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/redux-saga-tutorial-for-beginners-and-dog-lovers-aa69a17db645?source=collection_archive---------1-----------------------#2018-01-21">https://medium.com/hackernoon/redux-saga-tutorial-for-beginners-and-dog-lovers-aa69a17db645?source=collection_archive---------1-----------------------#2018-01-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="c348" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">构建一个简单的应用程序，<em class="jj">使用React，Redux &amp; Redux-Saga获取</em>狗的图像</h2></div><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff jk"><img src="../Images/f14ded20cd06ea58fa43356b86f15fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sfQctxtPCylO7yTJwnhQwQ.jpeg"/></div></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">Michael Gil — <a class="ae ka" href="https://www.flickr.com/photos/msvg/" rel="noopener ugc nofollow" target="_blank">https://www.flickr.com/photos/msvg/</a></figcaption></figure><p id="9cab" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">我开始在一个<a class="ae ka" href="https://github.com/ruddell/ignite-jhipster/tree/master/boilerplate" rel="noopener ugc nofollow" target="_blank">相当复杂的样板文件</a>中使用<code class="eh kx ky kz la b"><a class="ae ka" href="https://redux-saga.js.org/" rel="noopener ugc nofollow" target="_blank">redux-saga</a></code>。</p><p id="fedd" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">变得稍微舒服一点的道路是曲折和次优的，所以我想我应该写<strong class="kd hv">教程，我希望我刚开始写传奇的时候就已经有了。</strong></p><blockquote class="lb lc ld"><p id="a7b9" class="kb kc le kd b ke kf iv kg kh ki iy kj lf kl km kn lg kp kq kr lh kt ku kv kw hn dt translated">本教程假设您已经牢固掌握React或React Native和Redux。如果你还没有准备好<code class="eh kx ky kz la b">redux-saga</code>(还没有)，我强烈建议你看看这个惊人的、巨大的学习React和Redux的资源宝库。</p></blockquote><div class="li lj fm fo lk ll"><a href="https://github.com/markerikson/react-redux-links" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">markerikson/react-redux-links</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">react-redux-links——我在React、Redux、ES6等网站上收集的精选教程和资源链接</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">github.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz ju ll"/></div></div></a></div><h1 id="9ed8" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">你将建造什么</h1><div class="li lj fm fo lk ll"><a href="https://ryanjyost.github.io/redux-saga-beginner-tutorial/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">狗狗传奇-Redux-传奇入门教程</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">超级简单的应用程序的初学者redux-saga教程。</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">ryanjyost.github.io</p></div></div><div class="lu l"><div class="ms l lw lx ly lu lz ju ll"/></div></div></a></div><h1 id="337e" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">redux-saga是什么？我为什么想要或需要它？</h1><p id="b60b" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated">来自<a class="ae ka" href="https://github.com/redux-saga/redux-saga" rel="noopener ugc nofollow" target="_blank">官方回购</a>:</p><blockquote class="lb lc ld"><p id="c9bf" class="kb kc le kd b ke kf iv kg kh ki iy kj lf kl km kn lg kp kq kr lh kt ku kv kw hn dt translated"><code class="eh kx ky kz la b">redux-saga</code>是一个库，旨在使应用程序副作用(即异步的事情，如数据获取和不纯的事情，如访问浏览器缓存)更容易管理，更有效地执行，简单地测试，更好地处理故障。</p></blockquote><p id="0d6e" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">我认为这是一种有组织的方式，帮助您的Redux应用程序与外界通信并保持同步——主要是外部API。</p><p id="f5e7" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">许多优秀的人对<code class="eh kx ky kz la b">redux-saga</code>的利弊和其他一切发表了意见，比我好得多——所以如果你想真正确定<strong class="kd hv">是什么</strong>和<strong class="kd hv">为什么，这里有一些链接。</strong></p><p id="7893" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">我们将关注<strong class="kd hv">如何</strong>。</p><div class="li lj fm fo lk ll"><a href="https://redux-saga.js.org/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">给我读Redux-Saga</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">心理模型是，一个传奇就像你的应用程序中的一个单独的线程，专门负责侧…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">redux-saga.js.org</p></div></div></div></a></div><div class="li lj fm fo lk ll"><a href="https://jaysoo.ca/2016/01/03/managing-processes-in-redux-using-sagas/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">使用Sagas管理React + Redux中的副作用</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">对我来说，在React+Flux设置中一直有一个棘手的问题，那就是涉及到…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">jaysoo.ca</p></div></div><div class="lu l"><div class="my l lw lx ly lu lz ju ll"/></div></div></a></div><div class="li lj fm fo lk ll"><a href="https://ohyayanotherblog.ghost.io/redux-saga-clock/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">Redux Saga:未来是1975年</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">WTF是时钟？(这是Redux Saga三部分介绍中的第一篇。第二封邮件在这里，还有…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">ohyayaanother blog . ghost . io</p></div></div><div class="lu l"><div class="mz l lw lx ly lu lz ju ll"/></div></div></a></div><div class="li lj fm fo lk ll"><a href="https://shift.infinite.red/using-redux-saga-to-simplify-your-growing-react-native-codebase-2b8036f650de" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">使用redux-saga简化您不断增长的React原生代码库</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">您将编写的一些最脆弱、最尴尬、最难读的代码是流控制。—贝奥武夫</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">红色</p></div></div><div class="lu l"><div class="na l lw lx ly lu lz ju ll"/></div></div></a></div><div class="li lj fm fo lk ll"><a href="https://engineering.universe.com/what-is-redux-saga-c1252fc2f4d1" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">什么是Redux-Saga？</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">Redux-saga是一个Redux中间件库，旨在使处理redux应用程序中的副作用变得更好…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">engineering.universe.com</p></div></div></div></a></div><div class="li lj fm fo lk ll"><a href="https://riad.blog/2015/12/28/redux-nowadays-from-actions-creators-to-sagas/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">当今的Redux:从动作创作者到传奇</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">每当我偶然发现某样东西(某项技术)会改变我的习惯时，我都会说这句话…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">riad .博客</p></div></div></div></a></div><div class="li lj fm fo lk ll"><a href="http://konkle.us/master-complex-redux-workflows-with-sagas/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">使用Sagas掌握复杂的Redux工作流程</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">了解如何使用异步监视器例程(sagas)处理复杂的过程，这些例程监视您的Redux事件。布兰登…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">konkle.us</p></div></div><div class="lu l"><div class="nb l lw lx ly lu lz ju ll"/></div></div></a></div><h1 id="b013" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">我们开始吧</h1><p id="611d" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated">用<code class="eh kx ky kz la b"><a class="ae ka" href="https://github.com/facebookincubator/create-react-app" rel="noopener ugc nofollow" target="_blank">create-react-app</a></code>新建一个app。</p><pre class="jl jm jn jo fq nc la nd ne aw nf dt"><span id="1878" class="ng mb hu la b fv nh ni l nj nk">npx create-react-app dog-saga</span></pre><blockquote class="lb lc ld"><p id="4029" class="kb kc le kd b ke kf iv kg kh ki iy kj lf kl km kn lg kp kq kr lh kt ku kv kw hn dt translated">被<code class="eh kx ky kz la b">npx</code>搞糊涂了？我也是，直到我读到<a class="ae ka" rel="noopener" href="/@maybekatz/introducing-npx-an-npm-package-runner-55f7d4bd282b">这个</a>。</p></blockquote><p id="8e5e" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">进入项目目录，启动应用程序。</p><pre class="jl jm jn jo fq nc la nd ne aw nf dt"><span id="cddc" class="ng mb hu la b fv nh ni l nj nk">cd dog-saga<br/>npm start</span></pre><p id="b526" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">你现在应该看到<code class="eh kx ky kz la b">create-react-app</code>的样板文件，带有旋转的React标志。你很快就会用可爱的狗来代替它。</p><h1 id="995f" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">喜欢这个教程？</h1><p id="6d9a" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated"><a class="ae ka" href="https://tinyletter.com/ryanjyost" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hv">订阅约斯特的帖子简讯</strong> </a> <strong class="kd hv">获取更多。</strong></p><h1 id="92bd" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">Redux</h1><p id="ac51" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated">安装redux。</p><pre class="jl jm jn jo fq nc la nd ne aw nf dt"><span id="05d6" class="ng mb hu la b fv nh ni l nj nk">npm install --save redux</span></pre><p id="9be3" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">在您的<code class="eh kx ky kz la b">src</code>文件夹中创建一个名为<code class="eh kx ky kz la b">redux.js</code>的新文件，并向其中添加以下代码。</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nl nm l"/></div></figure><h2 id="5fd5" class="ng mb hu bd mc nn no np mg nq nr ns mk kk nt nu mm ko nv nw mo ks nx ny mq nz dt translated">我们有三种动作类型和一个减速器</h2><ul class=""><li id="cb00" class="oa ob hu kd b ke mt kh mu kk oc ko od ks oe kw of og oh oi dt translated"><code class="eh kx ky kz la b"><strong class="kd hv">API_CALL_REQUEST</strong></code>表示我们正在开始从<a class="ae ka" href="https://dog.ceo/dog-api/" rel="noopener ugc nofollow" target="_blank">狗API </a>中获取<code class="eh kx ky kz la b">fetching</code>狗的过程。</li><li id="37c8" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated"><code class="eh kx ky kz la b"><strong class="kd hv">API_CALL_SUCCESS</strong></code>告诉商店，我们成功取回了一个<code class="eh kx ky kz la b">dog</code>，因此不再进行<code class="eh kx ky kz la b">fetching</code> one。</li><li id="d705" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated"><code class="eh kx ky kz la b"><strong class="kd hv">API_CALL_FAILURE</strong></code> <strong class="kd hv"> </strong>告诉商店我们的API调用出了问题。我们收到了一个<code class="eh kx ky kz la b">error</code>而不是一个新的<code class="eh kx ky kz la b">dog</code>。</li></ul><p id="8bc0" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">但是我们应该如何制作<code class="eh kx ky kz la b">API_CALL_REQUEST</code>？</p><p id="ddbf" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">商店如何知道API调用是成功还是失败？</p><p id="e9a0" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">我们如何得到可爱的DOGS该死的照片？？？<strong class="kd hv">带着传奇色彩。</strong></p><blockquote class="lb lc ld"><p id="d33e" class="kb kc le kd b ke kf iv kg kh ki iy kj lf kl km kn lg kp kq kr lh kt ku kv kw hn dt translated">附注:我们不会在这个应用程序中使用动作创作者。为了这么简单的事情，他们可能会把水搅浑。此外，您将看到redux-saga如何在没有它们的情况下更清晰地处理和分派动作(在我看来)。</p></blockquote><h1 id="b3fe" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">还原传奇</h1><p id="224f" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated">我们想使用<code class="eh kx ky kz la b">redux-saga</code>创建一个<em class="le">传奇</em>，它将启动一个狗图像的API调用，然后告诉商店该API调用是成功还是失败。</p><ul class=""><li id="9849" class="oa ob hu kd b ke kf kh ki kk oo ko op ks oq kw of og oh oi dt translated">如果成功，我们将得到一个新的<code class="eh kx ky kz la b">dog</code>，并将<code class="eh kx ky kz la b">API_CALL_SUCCESS</code>和<code class="eh kx ky kz la b">dog</code>一起发送出去。</li><li id="6cbe" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated">如果失败，我们将得到一个<code class="eh kx ky kz la b">error</code>，并将<code class="eh kx ky kz la b">API_CALL_FAILURE</code>和<code class="eh kx ky kz la b">error</code>一起发送出去。</li></ul><p id="f08b" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">安装<code class="eh kx ky kz la b">redux-saga</code>。</p><pre class="jl jm jn jo fq nc la nd ne aw nf dt"><span id="f3e3" class="ng mb hu la b fv nh ni l nj nk">npm install --save redux-saga</span></pre><p id="1efe" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">还要安装<code class="eh kx ky kz la b"><a class="ae ka" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank">axios</a></code>，它将帮助我们进行基于<code class="eh kx ky kz la b"><a class="ae ka" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">Promise</a></code>的API调用。</p><pre class="jl jm jn jo fq nc la nd ne aw nf dt"><span id="7725" class="ng mb hu la b fv nh ni l nj nk">npm install axios</span></pre><p id="a655" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">创建一个名为<code class="eh kx ky kz la b">sagas.js</code>的新文件，并向其中添加以下代码。</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nl nm l"/></div></figure><p id="9aca" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">在我们浏览这个新文件之前，请注意<code class="eh kx ky kz la b">function*</code>语法。这创建了一种特殊的ES6新功能，称为<code class="eh kx ky kz la b"><a class="ae ka" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*" rel="noopener ugc nofollow" target="_blank">generator</a></code>。</p><p id="a3e4" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">生成器可以暂停和重新启动——退出和重新进入——并且可以随时记住函数的上下文/状态。</p><p id="4380" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">生成器中的每个<code class="eh kx ky kz la b">yield</code>基本上代表一个更加同步/连续的过程中的一个异步步骤——有点像<code class="eh kx ky kz la b"><a class="ae ka" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" rel="noopener ugc nofollow" target="_blank">async</a></code>函数中的<code class="eh kx ky kz la b">await</code>的<a class="ae ka" href="https://www.reddit.com/r/javascript/comments/2ywqif/if_we_have_functions_and_yields_why_do_we_need/" rel="noopener ugc nofollow" target="_blank"><em class="le"/></a>。</p><p id="07f5" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated"><code class="eh kx ky kz la b">redux-saga</code>依赖于生成器，但是为我们做了相当多的工作，所以(以我相当有限的经验)对于这个用例来说，深入理解它们是不必要的。</p><h2 id="ec50" class="ng mb hu bd mc nn no np mg nq nr ns mk kk nt nu mm ko nv nw mo ks nx ny mq nz dt translated">如果你想了解更多关于发电机的知识，这里有一些资源</h2><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="or nm l"/></div></figure><div class="li lj fm fo lk ll"><a href="https://davidwalsh.name/es6-generators" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">ES6发电机的基础知识</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">ES6发电机:完整系列ES6发电机的基础更深入，ES6发电机与ES6异步运行…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">davidwalsh.name</p></div></div><div class="lu l"><div class="os l lw lx ly lu lz ju ll"/></div></div></a></div><div class="li lj fm fo lk ll"><a rel="noopener follow" target="_blank" href="/javascript-scene/the-hidden-power-of-es6-generators-observable-async-flow-control-cfa4c7f31435"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">ES6发电机的隐藏能量:可观测的异步流量控制</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">在我用JavaScript编写斐波那契生成器时学到的7件令人惊讶的事情中，我介绍了ES6的一个明显的用例…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">medium.com</p></div></div><div class="lu l"><div class="ot l lw lx ly lu lz ju ll"/></div></div></a></div><p id="5ea1" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated"><strong class="kd hv">现在我们来看一下</strong> <code class="eh kx ky kz la b"><strong class="kd hv">sagas.js</strong></code></p><ul class=""><li id="f0c4" class="oa ob hu kd b ke kf kh ki kk oo ko op ks oq kw of og oh oi dt translated">一个<code class="eh kx ky kz la b"><strong class="kd hv">watcherSaga</strong></code>是一个传奇，<em class="le">观察</em>等待一个动作被分派到商店，触发一个<code class="eh kx ky kz la b">workerSaga</code>。</li><li id="0b23" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated"><code class="eh kx ky kz la b"><a class="ae ka" href="https://github.com/redux-saga/redux-saga/tree/master/docs/api#takelatestpattern-saga-args" rel="noopener ugc nofollow" target="_blank">takeLatest</a></code>是由<code class="eh kx ky kz la b">redux-saga</code>提供的一个帮助函数，当它看到一个<code class="eh kx ky kz la b">API_CALL_REQUEST</code>时将触发一个新的<code class="eh kx ky kz la b">workerSaga</code>，同时取消任何先前触发的仍在进行中的<code class="eh kx ky kz la b">workerSaga</code>。</li><li id="0b54" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated"><code class="eh kx ky kz la b"><strong class="kd hv">fetchDog</strong></code>简单地使用<code class="eh kx ky kz la b">axios</code>从dog API请求一个随机的Dog图像，并返回一个<code class="eh kx ky kz la b"><a class="ae ka" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">Promise</a></code>作为响应。</li><li id="6f19" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated"><code class="eh kx ky kz la b"><strong class="kd hv">workerSaga</strong></code>使用另一个<code class="eh kx ky kz la b">redux-saga</code>辅助函数<code class="eh kx ky kz la b"><a class="ae ka" href="https://github.com/redux-saga/redux-saga/tree/master/docs/api#callfn-args" rel="noopener ugc nofollow" target="_blank">call</a></code>尝试<code class="eh kx ky kz la b">fetchDog</code>，并将结果(已解决或失败的<code class="eh kx ky kz la b">Promise</code>)存储在<code class="eh kx ky kz la b">response</code>变量中。</li><li id="2775" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated">如果<code class="eh kx ky kz la b">fetchDog</code>成功，我们从<code class="eh kx ky kz la b">response</code>中提取<code class="eh kx ky kz la b">dog</code>图像，并使用另一个<code class="eh kx ky kz la b">redux-saga</code>辅助函数<code class="eh kx ky kz la b"><a class="ae ka" href="https://github.com/redux-saga/redux-saga/tree/master/docs/api#putaction" rel="noopener ugc nofollow" target="_blank">put</a></code>将有效载荷中带有<code class="eh kx ky kz la b">dog</code>的<code class="eh kx ky kz la b">API_CALL_SUCCESS</code>动作发送到商店。</li><li id="1024" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated">如果<code class="eh kx ky kz la b">fetchDog</code>有错误，我们会通过<code class="eh kx ky kz la b">error</code>发送一个<code class="eh kx ky kz la b">API_CALL_FAILURE</code>动作让商店知道。</li></ul><p id="8b4c" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">唷！开始时有点奇怪，但是在几次实现之后，这种模式/过程及其好处变得更加清晰。</p><h1 id="8690" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">连接React、Redux和Redux-Saga</h1><p id="548c" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated">好了，我们有了自己的作品，现在是时候把它们放在一起了。</p><p id="92aa" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">安装<code class="eh kx ky kz la b"><a class="ae ka" href="https://github.com/reactjs/react-redux" rel="noopener ugc nofollow" target="_blank">react-redux</a></code>。</p><pre class="jl jm jn jo fq nc la nd ne aw nf dt"><span id="80de" class="ng mb hu la b fv nh ni l nj nk">npm install --save react-redux</span></pre><p id="2b54" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">此外，安装Redux dev tools——调试和查看Redux(以及sagas的相关操作)的必备工具。<a class="ae ka" href="https://github.com/reduxjs/redux-devtools" rel="noopener ugc nofollow" target="_blank">点击这里获取设置Redux开发工具的信息。我推荐使用</a><a class="ae ka" href="https://github.com/zalmoxisus/redux-devtools-extension#redux-devtools-extension" rel="noopener ugc nofollow" target="_blank">浏览器扩展</a>。</p><p id="13f6" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">打开您的<code class="eh kx ky kz la b">index.js</code>文件，使它看起来像下面的文件。</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nl nm l"/></div></figure><p id="4974" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">Redux的东西应该看起来很熟悉。</p><ul class=""><li id="b4cc" class="oa ob hu kd b ke kf kh ki kk oo ko op ks oq kw of og oh oi dt translated"><code class="eh kx ky kz la b"><a class="ae ka" href="https://github.com/reactjs/redux/blob/master/docs/api/createStore.md" rel="noopener ugc nofollow" target="_blank">createStore</a></code>与我们的<code class="eh kx ky kz la b">reducer</code></li><li id="ea93" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated">将<a class="ae ka" href="https://github.com/gaearon/redux-devtools" rel="noopener ugc nofollow" target="_blank"> Redux DevTools </a>连接到存储器进行调试和学习</li><li id="49b5" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated">并将<code class="eh kx ky kz la b">&lt;App/&gt;</code>组件包装在带有<code class="eh kx ky kz la b">store</code>的<code class="eh kx ky kz la b">&lt;Provider/&gt;</code>组件中，这样我们就可以在 React中使用Redux <em class="le">了。</em></li><li id="944b" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated"><em class="le">我们将实际上</em><code class="eh kx ky kz la b"><em class="le">connect()</em></code><em class="le"/><code class="eh kx ky kz la b"><em class="le">&lt;App/&gt;</em></code><em class="le">的构件简称为。</em></li></ul><p id="c7cf" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">为了让我们的<code class="eh kx ky kz la b">redux-saga</code>与Redux一起工作…</p><ul class=""><li id="e592" class="oa ob hu kd b ke kf kh ki kk oo ko op ks oq kw of og oh oi dt translated"><code class="eh kx ky kz la b">createSagaMiddleware</code>，并在<code class="eh kx ky kz la b"><a class="ae ka" href="https://github.com/reactjs/redux/blob/master/docs/api/compose.md" rel="noopener ugc nofollow" target="_blank">compose</a></code>和<code class="eh kx ky kz la b"><a class="ae ka" href="https://redux.js.org/docs/api/applyMiddleware.html" rel="noopener ugc nofollow" target="_blank">applyMiddleware</a></code>的帮助下将其应用到Redux <code class="eh kx ky kz la b">store</code></li><li id="45da" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated"><code class="eh kx ky kz la b">run</code>的<code class="eh kx ky kz la b">watcherSaga</code>，这样当有<code class="eh kx ky kz la b">API_CALL_REQUEST</code>时就可以触发<code class="eh kx ky kz la b">workerSaga</code></li></ul><h1 id="0bff" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">将<App/>连接到Redux</h1><p id="6c67" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated">打开<code class="eh kx ky kz la b">App.js</code>并将以下代码粘贴到其中。</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nl nm l"/></div></figure><ul class=""><li id="3fc1" class="oa ob hu kd b ke kf kh ki kk oo ko op ks oq kw of og oh oi dt translated"><code class="eh kx ky kz la b">mapStateToProps</code>将<code class="eh kx ky kz la b">fetching</code>、<code class="eh kx ky kz la b">dog</code>和<code class="eh kx ky kz la b">error</code>的最新状态作为<code class="eh kx ky kz la b">App</code>组件中的<code class="eh kx ky kz la b">props</code>可用。</li><li id="6c27" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated">使用<code class="eh kx ky kz la b">mapDispatchToProps</code>，我们创建了一个名为<code class="eh kx ky kz la b">onRequestDog</code>的函数，它向商店发送一个<code class="eh kx ky kz la b">API_CALL_REQUEST</code>动作。</li><li id="6ab5" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw of og oh oi dt translated"><code class="eh kx ky kz la b">connect</code>组件<code class="eh kx ky kz la b">App</code>并导出它的“还原”版本以用于<code class="eh kx ky kz la b">index.js</code>。</li></ul></div><div class="ab cl ou ov hc ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="hn ho hp hq hr"><h1 id="f55a" class="ma mb hu bd mc md pb mf mg mh pc mj mk ja pd jb mm jd pe je mo jg pf jh mq mr dt translated">喜欢这个教程？</h1><p id="3ca6" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated"><a class="ae ka" href="https://tinyletter.com/ryanjyost" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hv">通过订阅约斯特的帖子获取更多简讯</strong> </a> <strong class="kd hv">。</strong></p></div><div class="ab cl ou ov hc ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="hn ho hp hq hr"><h1 id="3976" class="ma mb hu bd mc md pb mf mg mh pc mj mk ja pd jb mm jd pe je mo jg pf jh mq mr dt translated">在屏幕上显示所有内容</h1><p id="d2c9" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated">现在让我们浏览一下对<code class="eh kx ky kz la b">App</code>组件的渲染输出所做的一些更改<em class="le">(从上到下)</em>，这些更改允许用户查看应用程序的当前状态并请求狗的图像。</p><p id="c921" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated"><strong class="kd hv">所有这些代码片段都来自上面的</strong> <code class="eh kx ky kz la b"><strong class="kd hv">App.js</strong></code> <strong class="kd hv">，所以这里没有新的代码。</strong></p></div><div class="ab cl ou ov hc ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="hn ho hp hq hr"><p id="4c50" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">在下面的代码片段中，我们调整了图像<code class="eh kx ky kz la b">src</code>以显示一个<code class="eh kx ky kz la b">dog</code>图像，如果商店中存在的话。如果<code class="eh kx ky kz la b">dog</code>为<code class="eh kx ky kz la b">null</code>，则退回到反应<code class="eh kx ky kz la b">logo</code>。</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nl nm l"/></div></figure></div><div class="ab cl ou ov hc ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="hn ho hp hq hr"><p id="e31c" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">如果我们应用程序的当前<code class="eh kx ky kz la b">state</code>有一个<code class="eh kx ky kz la b">dog</code>图像，我们告诉用户继续点击。如果没有，我们告诉他们用一个<code class="eh kx ky kz la b">dog</code>替换React <code class="eh kx ky kz la b">logo</code>。</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nl nm l"/></div></figure></div><div class="ab cl ou ov hc ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="hn ho hp hq hr"><p id="c163" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">如果当前的<code class="eh kx ky kz la b">state</code>有错误，我们显示一些文本让用户知道。</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nl nm l"/></div></figure></div><div class="ab cl ou ov hc ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="hn ho hp hq hr"><p id="245b" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">在这里，如果我们的英雄目前正在<code class="eh kx ky kz la b">fetching</code>一个新的狗图像，这意味着<code class="eh kx ky kz la b">workerSaga</code>还没有发送一个<code class="eh kx ky kz la b">API_CALL_SUCCESS</code>或<code class="eh kx ky kz la b">API_CALL_FAILURE</code>，我们禁用该按钮。</p><p id="3529" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">否则，我们为用户提供一个按钮，单击并请求一个随机的狗图像。</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nl nm l"/></div></figure><h1 id="ffaf" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">只是为了好玩，让我们造成一个错误</h1><p id="4e33" class="pw-post-body-paragraph kb kc hu kd b ke mt iv kg kh mu iy kj kk mv km kn ko mw kq kr ks mx ku kv kw hn dt translated">要查看<code class="eh kx ky kz la b">workerSaga</code>派遣一个<code class="eh kx ky kz la b">API_CALL_FAILURE</code>，进入<code class="eh kx ky kz la b">sagas.js</code>并为狗api搞乱<code class="eh kx ky kz la b">url</code>(比如将“品种”改为“床位”)。</p><p id="c8ef" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">现在，当你点击“要求一只狗”按钮时，错误信息显示！</p><h1 id="312b" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">一步一步的回顾</h1><ol class=""><li id="7046" class="oa ob hu kd b ke mt kh mu kk oc ko od ks oe kw pg og oh oi dt translated">事件发生—例如，用户做了一些事情(点击“请求狗”按钮)或更新发生(如<code class="eh kx ky kz la b">componentDidMount</code>)</li><li id="9aa2" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw pg og oh oi dt translated">基于该事件，可能通过在<code class="eh kx ky kz la b">mapDispatchToProps</code>中声明的函数(例如<code class="eh kx ky kz la b">onRequestDog</code>)分派一个<code class="eh kx ky kz la b">action</code></li><li id="5ee0" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw pg og oh oi dt translated">一个<code class="eh kx ky kz la b">watcherSaga</code>看到<code class="eh kx ky kz la b">action</code>并触发一个<code class="eh kx ky kz la b">workerSaga</code>。<em class="le">使用</em> <a class="ae ka" href="https://github.com/redux-saga/redux-saga/tree/master/docs/api#saga-helpers" rel="noopener ugc nofollow" target="_blank"> <em class="le">传奇助手</em> </a> <em class="le">观察不同的动作。</em></li><li id="d087" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw pg og oh oi dt translated"><em class="le">当</em>传奇开始时，<code class="eh kx ky kz la b">action</code>也点击<code class="eh kx ky kz la b">reducer</code>并更新<code class="eh kx ky kz la b">state</code>的某个片段，以指示传奇已经开始并正在进行中(例如<code class="eh kx ky kz la b">fetching</code>)。</li><li id="61f5" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw pg og oh oi dt translated"><code class="eh kx ky kz la b">workerSaga</code>执行一些副作用操作(如<code class="eh kx ky kz la b">fetchDog</code>)。</li><li id="f23b" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw pg og oh oi dt translated">基于<code class="eh kx ky kz la b">workerSaga</code>的操作结果，它会分派一个<code class="eh kx ky kz la b">action</code>来指示该结果。如果成功(<code class="eh kx ky kz la b">API_CALL_SUCCESS</code>)，您可以在操作中包含一个有效负载(例如<code class="eh kx ky kz la b">dog</code>)。如果出现错误(<code class="eh kx ky kz la b">API_CALL_FAILURE</code>)，您可以发送一个<code class="eh kx ky kz la b">error</code>对象来获得关于错误的更多细节。</li><li id="fd6e" class="oa ob hu kd b ke oj kh ok kk ol ko om ks on kw pg og oh oi dt translated"><code class="eh kx ky kz la b">reducer</code>处理来自<code class="eh kx ky kz la b">workerSaga</code>的成功或失败<code class="eh kx ky kz la b">action</code>，并相应地用任何新数据更新存储器，以及将“进行中”指示器(例如<code class="eh kx ky kz la b">fetching</code>)设置为假。</li></ol><p id="23ef" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">在整个过程中，您可以使用Redux <code class="eh kx ky kz la b">state</code>到<code class="eh kx ky kz la b">props</code>的更新来让您的用户了解过程及其进度。</p><h1 id="00c0" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">更多资源</h1><div class="li lj fm fo lk ll"><a href="https://medium.freecodecamp.org/async-operations-using-redux-saga-2ba02ae077b3" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">使用redux-saga的异步操作</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">2017年8月更新:</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">medium.freecodecamp.org</p></div></div><div class="lu l"><div class="ph l lw lx ly lu lz ju ll"/></div></div></a></div><div class="li lj fm fo lk ll"><a href="https://medium.freecodecamp.org/redux-saga-common-patterns-48437892e11c" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hv fv z el lq eo ep lr er et ht dt translated">这种常见的Redux-saga模式的集合将使您的生活更加轻松。</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">这是一个由两部分组成的系列，您可以在这里查看第一部分。</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">medium.freecodecamp.org</p></div></div><div class="lu l"><div class="pi l lw lx ly lu lz ju ll"/></div></div></a></div><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="pj nm l"/></div></figure></div></div>    
</body>
</html>