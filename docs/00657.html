<html>
<head>
<title>The Meeshkan Keras Backend Covers 100% of the Keras Public API: Why This Matters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Meeshkan Keras后端覆盖了100%的Keras公共API:为什么这很重要</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-meeshkan-keras-backend-covers-100-of-the-keras-public-api-why-this-matters-8207cb601f19?source=collection_archive---------23-----------------------#2018-01-21">https://medium.com/hackernoon/the-meeshkan-keras-backend-covers-100-of-the-keras-public-api-why-this-matters-8207cb601f19?source=collection_archive---------23-----------------------#2018-01-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="793b" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated"><em class="jj">TL；Meeshkan现在覆盖了100%的Keras公共API！</em></h2></div><p id="d335" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">当<a class="ae kg" href="https://app.meeshkan.com" rel="noopener ugc nofollow" target="_blank"> Meeshkan </a>从使用DSL转向使用Keras进行机器学习入口时，Meeshkan核心只覆盖了<a class="ae kg" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras公共API </a>的25%。为了保持业务不间断运行，我们使用了一个小脚本来确定Keras模型是否可以部署在Meeshkan后端，如果不能，就使用<a class="ae kg" href="http://deeplearning.net/software/theano/" rel="noopener ugc nofollow" target="_blank"> Theano </a>或<a class="ae kg" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> Tensorflow </a>。</p><p id="512c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">对于Meeshkan来说，这意味着约75%的工作成本更高，处理速度可能更慢，因为这些工作无法利用我们的分布式基础架构。我们决定不将这些成本转嫁给客户，而是对所有机器学习工作保持一个较低的费率。不用说，自从Meeshkan公开测试版<a class="ae kg" href="https://hackernoon.com/meeshkan-machine-learning-a33a8cabb0d6" rel="noopener ugc nofollow" target="_blank">发布以来，我们一直在不知疲倦地工作，以完成我们的定制后端，这样每个没有显式调用<code class="eh kh ki kj kk b">K.some_proprietary_method</code>的Keras作业都可以在我们低成本、相当快的网络上运行。</a></p><p id="1d60" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我很兴奋地报告，我们终于达到了目标！我们将在接下来的几周内推出新版本的Meeshkan，它将覆盖100%的Keras公共API。我们将从A/B测试开始，然后用于所有在我们网络上进行机器学习的客户。</p><figure class="km kn ko kp fq kq fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/0e54fc8ade142923a4310b510d89c29e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*8vH-UmaF6M9fMUjgiqOhIg.gif"/></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Ugh…this is boring…now that Meeshkan covers 100% of the Keras Public API and all of the tests are passing, there is nothing left to fix. How am I gonna spend my Sundays from now on? With my family? Quick, I better write in a couple bugs!</figcaption></figure><p id="4efa" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我今天想写的是我们如何实现这一里程碑，我们学到了什么，以及为什么我认为这一步在我们公司的发展中特别重要。</p><h1 id="5bfd" class="kx ky hu bd kz la lb lc ld le lf lg lh ja li jb lj jd lk je ll jg lm jh ln lo dt translated">达到100%</h1><p id="3368" class="pw-post-body-paragraph jk jl hu jm b jn lp iv jp jq lq iy js jt lr jv jw jx ls jz ka kb lt kd ke kf hn dt translated">编写Keras后端是一项非常艰巨的任务——除了将Keras中的所有东西粘在一起所需的3000多行Python代码之外，后端所依赖的底层库需要非常坚固，因为Keras不会测试您的库代码，只会报告您的计算结果与其他(假设正确的)后端的计算结果之间的数值不一致。此外，虽然Keras做了很多有用的事情，但最终还是由后端作者来实现RNN、卷积、最大池和其他来自ML最热门的棘手张量操作。</p><p id="eaac" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在三个月的时间里，我们对Meeshkan内核进行了四次重写，对后端进行了三次重写，才得到一个可以投入生产的版本。一直以来，在Amazon上运行的CI服务器确保测试通过，并且代码覆盖在最关键的地方是不可避免的。</p><h1 id="78ef" class="kx ky hu bd kz la lb lc ld le lf lg lh ja li jb lj jd lk je ll jg lm jh ln lo dt translated">经验教训</h1><p id="e574" class="pw-post-body-paragraph jk jl hu jm b jn lp iv jp jq lq iy js jt lr jv jw jx ls jz ka kb lt kd ke kf hn dt translated">对于未来的Keras后端作家，这里是我学到的一些经验教训(艰难的方式！)关于如何为Keras组装一个后端。由于不是所有这些信息都可以在Keras文档中找到，我希望它能节省人们的时间并提供有用的信息。</p><h2 id="51c6" class="lu ky hu bd kz lv lw lx ld ly lz ma lh jt mb mc lj jx md me ll kb mf mg ln mh dt translated">1.用这个要点来组织你的工作</h2><figure class="km kn ko kp fq kq"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="0846" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在Keras代码库中，没有一个中心位置告诉您需要实现什么功能来使您的后端通过测试并覆盖Keras公共API。他们提供的最接近的是在<a class="ae kg" href="https://keras.io/backend/" rel="noopener ugc nofollow" target="_blank">https://keras.io/backend</a>，它列出了某些只适用于一些后端的函数和一些不属于公共API的函数(意味着不在后端代码之外的Keras源代码中使用)。上面的字典将键映射到Meeshkan后端中的函数，但是您可以在各个Keras后端(即<code class="eh kh ki kj kk b">grep “def normalize_batch_in_training”</code>)中抓取键并进行grep，以查看它们是如何组合在一起的。我相信这个列表会随着时间的推移而改变，但这就是赫尔辛基时间1月21日周日下午5:23的情况。</p><h2 id="07e9" class="lu ky hu bd kz lv lw lx ld ly lz ma lh jt mb mc lj jx md me ll kb mf mg ln mh dt translated">2.肆无忌惮地逆向工程</h2><p id="2df8" class="pw-post-body-paragraph jk jl hu jm b jn lp iv jp jq lq iy js jt lr jv jw jx ls jz ka kb lt kd ke kf hn dt translated">对于50%左右的Keras后端API表面，通过逆向工程Tensorflow后端并将您的版本与真实版本进行比较，您可以在不到一周的时间内编写一个迷你后端。通过做这个练习，您将了解Keras的内部是如何工作的，并在开始为您选择的库实现后端时有一个非常安全的基线。</p><h2 id="0022" class="lu ky hu bd kz lv lw lx ld ly lz ma lh jt mb mc lj jx md me ll kb mf mg ln mh dt translated">3.<code class="eh kh ki kj kk b"><strong class="ak">_keras_shape, _keras_shape, _keras_shape</strong></code></h2><p id="6aca" class="pw-post-body-paragraph jk jl hu jm b jn lp iv jp jq lq iy js jt lr jv jw jx ls jz ka kb lt kd ke kf hn dt translated">Keras有一个或多或少没有记录的接口，叫做<code class="eh kh ki kj kk b">_keras_shape</code>，基本上可以在任何地方、任何时间调用它来获得张量的形状。</p><pre class="km kn ko kp fq mk kk ml mm aw mn dt"><span id="5f78" class="lu ky hu kk b fv mo mp l mq mr">$ git grep -c _keras_shape<br/>backend/cntk_backend.py:7<br/>backend/meeshkan_backend.py:1<br/>backend/tensorflow_backend.py:8<br/>backend/theano_backend.py:79<br/>engine/topology.py:23<br/>models.py:4</span></pre><p id="df37" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">所以给每样东西都加上一个<code class="eh kh ki kj kk b">_keras_shape</code>。我们用一个偷偷摸摸的装饰器把它固定在<em class="ms">上。</em></p><h2 id="1efe" class="lu ky hu bd kz lv lw lx ld ly lz ma lh jt mb mc lj jx md me ll kb mf mg ln mh dt translated">4.使用其他Keras后端作为模板</h2><p id="9f0e" class="pw-post-body-paragraph jk jl hu jm b jn lp iv jp jq lq iy js jt lr jv jw jx ls jz ka kb lt kd ke kf hn dt translated">Keras有三个开源的全功能后端:CNTK、Tensorflow和Theano。在这三个后端之间，几乎总有一个可以让你在写作时获得灵感。特别是对于像<code class="eh kh ki kj kk b">batch_dot</code>这样在其他ML项目中没有真正对等物的特殊Keras约定，从另一个后端的代码中搭建你的实现将会节省你很多时间。它还允许您在代码中创建逻辑断点，以便在不同后端的相同位置进行调试。</p><h2 id="8e6d" class="lu ky hu bd kz lv lw lx ld ly lz ma lh jt mb mc lj jx md me ll kb mf mg ln mh dt translated">5.继续，给自己一个全连接的密集神经网络</h2><p id="7595" class="pw-post-body-paragraph jk jl hu jm b jn lp iv jp jq lq iy js jt lr jv jw jx ls jz ka kb lt kd ke kf hn dt translated">编写一个Keras后端，你总是会陷入核心张量运算实现细节的细枝末节，而不会只见树木不见森林。当你感到沮丧时，永远不要忘记你是一个点积，一个ReLU和一个L2归一化，远离一个完全连接的神经网络。当然，也不要忽视低垂的果实！我将从实现一个返回后端名称的函数开始。</p><pre class="km kn ko kp fq mk kk ml mm aw mn dt"><span id="150b" class="lu ky hu kk b fv mo mp l mq mr">def __backend(self):<br/>  return 'meeshkan'</span></pre><p id="541d" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">但是一旦你做到了这一点，不要犹豫选择你最喜欢的后端功能，这样你的库就可以马上用Keras构建很酷的东西。这是疯狂的激励！</p><h2 id="bbfe" class="lu ky hu bd kz lv lw lx ld ly lz ma lh jt mb mc lj jx md me ll kb mf mg ln mh dt translated">6.当有疑问时，WWND(numpy会怎么做)</h2><p id="0f3a" class="pw-post-body-paragraph jk jl hu jm b jn lp iv jp jq lq iy js jt lr jv jw jx ls jz ka kb lt kd ke kf hn dt translated">正常人的大脑不可能预见到实现Keras后端所需的每一个张量操作，必须通读代码才能知道发生了什么。在这样做的过程中，您总是会发现一些基本库中没有的操作，这些操作从原语组合起来效率很低，或者根本不可能用原语来组合。因此，您将被迫向核心库写入新的功能。在这样做的时候，我发现如果你的目标是与<strong class="jm hv"> numpy </strong>的API对等，你就不会出错。只有几个函数，比如<code class="eh kh ki kj kk b">np.gradient</code>，其中numpy实现对张量没有太大帮助。当然，有一整类函数(像<code class="eh kh ki kj kk b">tf.nn</code>中的那些)不能被numpy化。但是你必须实现的将所有东西粘在一起的大部分零碎东西都可以被认为是愚蠢的。所以保持你的API调用类似于numpy——当其他人阅读你的后端代码时，你会很感激你这样做了，不用仔细阅读你的库的文档就可以理解正在发生的事情。</p><h1 id="032d" class="kx ky hu bd kz la lb lc ld le lf lg lh ja li jb lj jd lk je ll jg lm jh ln lo dt translated">自信地部署到米什坎</h1><p id="57dc" class="pw-post-body-paragraph jk jl hu jm b jn lp iv jp jq lq iy js jt lr jv jw jx ls jz ka kb lt kd ke kf hn dt translated">米什坎最近实现了许多很棒的里程碑——我们在三藩市与<a class="ae kg" href="https://www.heroku.com" rel="noopener ugc nofollow" target="_blank">的合作伙伴举行了一些很棒的会议，启动了</a><a class="ae kg" href="https://www.accelerace.io/" rel="noopener ugc nofollow" target="_blank"> Accelerace </a>项目，并在我们的<a class="ae kg" href="https://www.udemy.com/meeshkan-machine-learning-the-github-api/" rel="noopener ugc nofollow" target="_blank"> Udemy课程</a>上通过了6000名学生的分数。但是我这个极客认为这个Keras里程碑是最重要的。原因如下。</p><p id="1847" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在我看来，Keras是人工智能事实上的通用语。像英语一样，它是不完美的和特殊的，但像英语一样，许多爱好者被它所提供的东西所激励，他们聚集在它周围交流。Meeshkan也不例外——我们着迷于Keras项目，并认为人工智能中的许多伟大想法可以使用其简洁的API轻松表达出来。</p><p id="8adc" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">越来越多的公司和爱好者每天都在使用Keras制作他们的AI模型。随着人工智能变得越来越容易，人们希望做更多的工作，但受到自己机器的限制。为了让Meeshkan有一个令人信服的商业论点，它需要给人们一个超越他们PC的实质性优势，同时提供与其他Keras后端相同的高质量人工智能。</p><p id="80da" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">因为Meeshkan针对所有其他Keras后端进行了测试，并且通过了100%的测试，所以您可以放心地部署到Meeshkan网络，因为您知道您的AI作业将产生与从Tensorflow和Theano等其他后端获得的结果相同的结果。与此同时，您还可以享受到速度惊人的Meeshkan后端带来的好处，这是市场上最划算的交易，并且只有在新后端完全部署后才会变得更好。</p><p id="05fd" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我希望你能在Meeshkan 上开始构建一些<a class="ae kg" href="https://app.meeshkan.com" rel="noopener ugc nofollow" target="_blank">难以置信的ML项目！我们不能等到我们的新后端完全推出，在这一点上，我们将报告一些整洁的基准。我们希望赢得您的信任，因为我们努力提供业界最佳的质量、速度和价格组合。</a></p><figure class="km kn ko kp fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="fe ff mt"><img src="../Images/8aacf94a89f3457ee70d05f5e2a49b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fZrv-rhFIvidhqeVh0cvvA.png"/></div></div></figure></div></div>    
</body>
</html>