<html>
<head>
<title>You need to use structured logging with AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您需要在AWS Lambda中使用结构化日志记录</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/you-need-to-use-structured-logging-with-aws-lambda-f3af9586d6a8?source=collection_archive---------16-----------------------#2018-01-22">https://medium.com/hackernoon/you-need-to-use-structured-logging-with-aws-lambda-f3af9586d6a8?source=collection_archive---------16-----------------------#2018-01-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="c659" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我希望在第一次开始使用《愤怒的T2》中的AWS Lambda时学到的一课，它会从一开始就让我的生活变得更简单。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/f8b49adffe4c46d66fc1d5fde61fd026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjUak1y45bm0wdo4kwpknw.png"/></div></div></figure><p id="2f02" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，我们很快就到达了那里，它允许我们<a class="ae jp" href="https://hackernoon.com/capture-and-forward-correlation-ids-through-different-lambda-event-sources-220c227c65f5" rel="noopener ugc nofollow" target="_blank">跟踪并在我们的日志消息中包含相关id</a>(然后<a class="ae jp" rel="noopener" href="/@theburningmonk/centralised-logging-for-aws-lambda-b765b7ca9152">将其推送到ELK堆栈)</a>，其中还包含其他有用的信息，例如:</p><ul class=""><li id="b66b" class="kc kd hu it b iu iv iy iz jc ke jg kf jk kg jo kh ki kj kk dt translated">函数执行的年龄</li><li id="91a0" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">祈祷是否是一个冷启动</li><li id="944a" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">日志级别</li><li id="841a" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">等等。</li></ul><p id="142d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回顾过去，我陷入了一个常见的陷阱，那就是忘记了在不同的软件开发范例中曾经很好地服务于我们的实践，至少在我发现如何将这些旧的实践用于新的无服务器范例之前是这样。</p><p id="e66b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这种情况下，我们知道<a class="ae jp" href="https://www.loggly.com/blog/why-json-is-the-best-application-log-format-and-how-to-switch/" rel="noopener ugc nofollow" target="_blank">结构化日志很重要</a>和<a class="ae jp" href="https://stackify.com/what-is-structured-logging-and-why-developers-need-it/" rel="noopener ugc nofollow" target="_blank">为什么我们</a> <a class="ae jp" href="https://blog.treasuredata.com/blog/2012/04/26/log-everything-as-json/" rel="noopener ugc nofollow" target="_blank">需要它们</a>，以及<a class="ae jp" href="https://www.loggly.com/blog/8-handy-tips-consider-logging-json/" rel="noopener ugc nofollow" target="_blank">如何做好</a><a class="ae jp" href="http://dev.splunk.com/view/logging/SP-CAAAFCK" rel="noopener ugc nofollow" target="_blank"/>。但是像许多其他人一样，我们从<code class="eh kq kr ks kt b">console.log </code>开始，因为它简单而且有效(在有限的程度上)。</p><p id="9aa0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，这种方法的上限很低:</p><ul class=""><li id="3d7f" class="kc kd hu it b iu iv iy iz jc ke jg kf jk kg jo kh ki kj kk dt translated">您不能在日志消息中添加上下文信息，至少不能以<strong class="it hv">一致</strong>的方式添加(您可以更改您记录的消息，但是上下文信息应该始终存在，例如用户id、请求id等。)和<strong class="it hv">容易提取</strong>用于<strong class="it hv">自动化</strong>过程</li><li id="8188" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">因此，也很难按特定属性过滤日志消息，例如“显示与此请求ID相关的所有日志消息”</li><li id="c614" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">很难根据配置来控制记录的级别(即调试、信息、警告等)，例如，非生产环境在调试级别记录，但生产环境在信息/警告级别记录</li></ul><p id="627e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就是为什么，如果你刚刚开始你的无服务器之旅，那么从我的错误中吸取教训，从一开始就把你的日志写成结构化JSON <strong class="it hv">。此外，您应该使用您之前使用的任何日志客户端——log4j、nlog、loggly、log4net，无论它是什么——并将客户端配置为将日志消息格式化为JSON和<strong class="it hv">附加尽可能多的上下文信息</strong>。</strong></p><p id="922e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如我在关于如何<a class="ae jp" href="https://hackernoon.com/capture-and-forward-correlation-ids-through-different-lambda-event-sources-220c227c65f5" rel="noopener ugc nofollow" target="_blank">捕获和转发集合id</a>的帖子中提到的，为生产中的一小部分请求在整个调用链上启用调试日志记录也是一个好主意。它帮助您捕获逻辑中普遍存在的错误(这很容易捕获，但前提是您从日志中获得了正确的信息),否则您需要重新部署整个调用链上的所有函数来打开调试日志记录…</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ku"><img src="../Images/4b0a4525b4b6690c235b98b19895c71c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ql8iNWzDNwil9qGEWkfdwQ.png"/></div></div></figure><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kv"><img src="../Images/27ca2be5877b05647194a2429f77a185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZVB-Ex-Akd2ds9mg7TuhxA.png"/></div></div></figure><p id="6cfd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，大规模升级您的无服务器架构是一件简单而有效的事情。查看我关于AWS Lambda日志记录的迷你系列，其中涵盖了<a class="ae jp" href="https://hackernoon.com/centralised-logging-for-aws-lambda-b765b7ca9152" rel="noopener ugc nofollow" target="_blank">日志聚合</a>、<a class="ae jp" href="https://hackernoon.com/capture-and-forward-correlation-ids-through-different-lambda-event-sources-220c227c65f5" rel="noopener ugc nofollow" target="_blank">跟踪相关性id</a>，以及一些<a class="ae jp" href="https://hackernoon.com/tips-and-tricks-for-logging-and-monitoring-aws-lambda-functions-885af6da29a5" rel="noopener ugc nofollow" target="_blank">技巧和诀窍</a>，比如为什么以及如何异步发送定制指标。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="ab fr cl ld"><img src="../Images/8b4e4721bb1973db389b5b533d727ad1.png" data-original-src="https://miro.medium.com/v2/format:webp/0*b_1R345KzKSaI8sg.png"/></div></figure><p id="f870" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">嗨，我叫<strong class="it hv">崔琰</strong>。我是一个<a class="ae jp" href="https://aws.amazon.com/developer/community/heroes/yan-cui/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> AWS无服务器英雄</strong> </a>和<a class="ae jp" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">量产无服务器</strong> </a>的作者。我已经在AWS中运行了近10年的大规模生产工作负载，我是一名架构师或首席工程师，涉足从银行、电子商务、体育流媒体到移动游戏等多个行业。我目前是一名专注于AWS和无服务器的独立顾问。</p><p id="c37e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以通过<a class="ae jp" href="mailto:theburningmonk.com" rel="noopener ugc nofollow" target="_blank">邮箱</a>、<a class="ae jp" href="https://twitter.com/theburningmonk" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae jp" href="https://www.linkedin.com/in/theburningmonk/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><p id="404d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看我的新课程，<a class="ae jp" href="https://theburningmonk.thinkific.com/courses/complete-guide-to-aws-step-functions" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">AWS步骤功能完整指南</strong> </a>。</p><p id="a329" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本课程中，我们将介绍有效使用AWS Step Functions服务所需了解的一切。包括基本概念、HTTP和事件触发器、活动、设计模式和最佳实践。</p><p id="cd40" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击获取您的副本<a class="ae jp" href="https://theburningmonk.thinkific.com/courses/complete-guide-to-aws-step-functions" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff le"><img src="../Images/2faf40b47320300fed81b3e09483ffb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZYcHhOOzUf5VB-Ri.png"/></div></div></figure><p id="ee8c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">来了解AWS Lambda: CI/CD的操作性<strong class="it hv">最佳实践</strong>，本地测试&amp;调试功能、日志记录、监控、分布式跟踪、canary部署、配置管理、认证&amp;授权、VPC、安全性、错误处理等等。</p><p id="8bb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还可以用代码<strong class="it hv"> ytcui </strong>获得<strong class="it hv">票面价格4折</strong>。</p><p id="b65b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击获取您的副本<a class="ae jp" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>