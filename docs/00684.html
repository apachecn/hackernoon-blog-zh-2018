<html>
<head>
<title>Localization in javascript with c-3po</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用c-3po的javascript本地化</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/localization-in-javascript-with-c-3po-7bb5b96a4e01?source=collection_archive---------24-----------------------#2018-01-22">https://medium.com/hackernoon/localization-in-javascript-with-c-3po-7bb5b96a4e01?source=collection_archive---------24-----------------------#2018-01-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="d075" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">项目被重命名为<strong class="ix hv"> ttag </strong>。跟随新博士——<a class="ae jt" href="https://ttag.js.org/" rel="noopener ugc nofollow" target="_blank">https://ttag.js.org/</a>。由于可能的法律侵权，该名称已被更改。(详见本期<a class="ae jt" href="https://github.com/ttag-org/ttag/issues/104" rel="noopener ugc nofollow" target="_blank">第</a>期)</p></blockquote><p id="f3df" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">大家好！</p><p id="8fd8" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">这篇文章是关于新的<strong class="ix hv"> javascript本地化</strong>工具— <a class="ae jt" href="https://c-3po.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hv"> c-3po </strong> </a>。我们在生产中使用c-3po已经将近一年了，我们对此很满意。c-3po被设计成在GNU gettext格式之上提供一个智能和可靠的翻译工作流程。总的来说，c-3po是一个库加上一组<a class="ae jt" href="https://hackernoon.com/tagged/tools" rel="noopener ugc nofollow" target="_blank">工具</a>，可以让你用最少的努力来本地化你的项目。</p><p id="04e6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">恐惧问题:"<strong class="ix hv">为什么</strong> <strong class="ix hv">又多了一个汉化库</strong>？"。有几个成熟的本地化解决方案可以让您满意，但我们决定构建自己的解决方案的主要原因是:</p><ul class=""><li id="e595" class="jx jy hu ix b iy iz jc jd ju jz jv ka jw kb js kc kd ke kf dt translated">我们不想对字符串使用<a class="ae jt" href="https://www.tutorialspoint.com/c_standard_library/c_function_sprintf.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hv"> sprintf </strong> </a>格式。<strong class="ix hv"> es6 </strong>引入了<a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hv">模板字符串</strong> </a>，我们只是想用它们来进行字符串格式化。</li><li id="b33b" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">我们正在寻找一种智能工具，它可以从源代码(js，jsx)中提取翻译字符串，并且能够为提取的字符串添加某种验证。</li><li id="48e3" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">我们一直在寻找一种解决方案，允许我们在构建步骤和脚本执行时预编译翻译。</li><li id="5d62" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">与框架无关的解决方案，几乎可以集成到任何<a class="ae jt" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> javascript </a>框架中，并且可以用于任何构建工具。</li><li id="ec0a" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">希望确保在CI构建期间翻译所有字符串。</li></ul><h1 id="3387" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">欢迎c-3po！</h1><p id="ae2d" class="pw-post-body-paragraph iu iv hu ix b iy lj ja jb jc lk je jf ju ll ji jj jv lm jm jn jw ln jq jr js hn dt translated">以下是如何使用该库的一些示例:</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="lt lu l"/></div></figure><p id="f9d7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">复数形式支持:</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="lt lu l"/></div></figure><blockquote class="ir is it"><p id="4493" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">关于为什么我们应该使用<code class="eh lv lw lx ly b">t</code>标签作为第一个带有<strong class="ix hv"> msgid </strong>的参数的更多细节在<a class="ae jt" href="https://c-3po.js.org/why-use-msgid-for-ngettext.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></blockquote><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="lt lu l"/></div></figure><p id="090f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">上下文支持:</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="lt lu l"/></div></figure><h1 id="a818" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">。采购订单文件</h1><p id="0c79" class="pw-post-body-paragraph iu iv hu ix b iy lj ja jb jc lk je jf ju ll ji jj jv lm jm jn jw ln jq jr js hn dt translated">根据<strong class="ix hv"> GNU gettext </strong>格式，所有翻译都放在<strong class="ix hv">里面。po </strong>文件。每个地区都有自己独立的<strong class="ix hv">。po </strong>文件和所有翻译都添加在那里。c-3po生态系统提供了可靠的工具集，可以创建和更新那些。po 文件。</p><p id="d7bc" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">因此，我们必须以某种方式解析我们的源代码，并提取所有用c-3po标签和函数包装的字符串。为此，我们创建了与javascript AST配合良好的<a class="ae jt" href="https://github.com/c-3po-org/babel-plugin-c-3po" rel="noopener ugc nofollow" target="_blank"><strong class="ix hv">babel-plugin-c-3po</strong></a>。因此，它可以在babel工作的任何地方使用(jsx，ts，tsx，React Native e.t.c)。插件选项<a class="ae jt" href="https://c-3po.js.org/configuration.html" rel="noopener ugc nofollow" target="_blank">在这里</a>有一个单独的文档页面。只是为了减少一些样板工作，我们创建了<a class="ae jt" href="https://github.com/c-3po-org/c-3po-cli" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hv"> c-3po-cli </strong> </a>，它工作在那个插件之上。</p><blockquote class="ir is it"><p id="e0c5" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><code class="eh lv lw lx ly b">npm install -g c-3po</code>将把<code class="eh lv lw lx ly b">c-3po</code>命令添加到您的环境中，这将在下面的例子中使用。</p></blockquote><h1 id="ce5b" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">。采购订单文件创建</h1><p id="6891" class="pw-post-body-paragraph iu iv hu ix b iy lj ja jb jc lk je jf ju ll ji jj jv lm jm jn jw ln jq jr js hn dt translated">假设我们有一个<code class="eh lv lw lx ly b">hello.js</code>文件，并想将其本地化为乌克兰语。</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="lt lu l"/></div></figure><p id="0810" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">要开始，您需要设置<strong class="ix hv">。po </strong>文件为乌克兰语。</p><pre class="lo lp lq lr fq lz ly ma mb aw mc dt"><span id="15f1" class="md km hu ly b fv me mf l mg mh">c-3po init uk uk.po</span></pre><blockquote class="ir is it"><p id="2e5c" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><strong class="ix hv"> uk </strong>是乌克兰语的ISO代码。(所有支持的代码可在<a class="ae jt" href="http://docs.translatehouse.org/projects/localization-guide/en/latest/l10n/pluralforms.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到)</p></blockquote><p id="339e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh lv lw lx ly b">init</code>命令将创建一个空的<code class="eh lv lw lx ly b">po</code>文件，该文件包含所需文件头的最小集合。</p><h1 id="34ac" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">将翻译提取并更新到。采购订单文件</h1><p id="05fb" class="pw-post-body-paragraph iu iv hu ix b iy lj ja jb jc lk je jf ju ll ji jj jv lm jm jn jw ln jq jr js hn dt translated">要提取所有带标签的字符串，您需要执行一个简单的命令:</p><pre class="lo lp lq lr fq lz ly ma mb aw mc dt"><span id="acef" class="md km hu ly b fv me mf l mg mh">c-3po update uk.po hello.js</span></pre><p id="2caa" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">之后，我们的<code class="eh lv lw lx ly b">Hello ${ name }</code>字符串必须出现在<strong class="ix hv"> uk.po </strong>文件中:</p><pre class="lo lp lq lr fq lz ly ma mb aw mc dt"><span id="ed41" class="md km hu ly b fv me mf l mg mh">#: hello.js:3<br/>msgid "Hello ${ name }"<br/>msgstr "</span></pre><blockquote class="ir is it"><p id="7aab" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><strong class="ix hv">更新</strong>命令将添加新的字符串，并删除那些不在源文件中的字符串。如果您的工作流程需要<strong class="ix hv">。pot </strong>文件—您可以使用<code class="eh lv lw lx ly b">extract</code>和<code class="eh lv lw lx ly b">merge</code>命令。</p></blockquote><h1 id="b6d3" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">构建本地化文件</h1><p id="394d" class="pw-post-body-paragraph iu iv hu ix b iy lj ja jb jc lk je jf ju ll ji jj jv lm jm jn jw ln jq jr js hn dt translated">如果您有能力为每种语言构建一个单独的包，建议您这样做，因为这将提高客户端性能(在客户端上没有额外的解析和替换+较小的包)。</p><pre class="lo lp lq lr fq lz ly ma mb aw mc dt"><span id="9e49" class="md km hu ly b fv me mf l mg mh">c-3po replace uk.po hello-uk.js hello.js</span></pre><p id="8b75" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">该命令将创建原始文件<code class="eh lv lw lx ly b">hello-uk.js</code>的本地化版本，并应用来自<code class="eh lv lw lx ly b">uk.po</code>的所有翻译。</p><h1 id="cff1" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">在运行时应用翻译</h1><p id="de5d" class="pw-post-body-paragraph iu iv hu ix b iy lj ja jb jc lk je jf ju ll ji jj jv lm jm jn jw ln jq jr js hn dt translated">另一个选择是你可以应用适当的<strong class="ix hv">。po </strong>文件上的一个脚本执行。</p><p id="2cc3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">以下是如何为我们简单的<code class="eh lv lw lx ly b">hello.js</code>实现这一点:</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="lt lu l"/></div></figure><p id="2796" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">您还可以使用webpack和<a class="ae jt" href="https://github.com/cah4a/po-gettext-loader" rel="noopener ugc nofollow" target="_blank"> po-gettext-loader </a>构建您的工作流，并使用动态导入功能导入适当的<code class="eh lv lw lx ly b">.po</code>。</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="lt lu l"/></div></figure><p id="966e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">有了这个设置，<code class="eh lv lw lx ly b">.po</code>文件中的每一个变化都会触发webpack构建。你可以点击阅读更多关于webpack <a class="ae jt" href="https://c-3po.js.org/localization-with-webpack-and-c-3po.html" rel="noopener ugc nofollow" target="_blank">不同设置的信息。</a></p><h1 id="f824" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">翻译验证和CI</h1><p id="976f" class="pw-post-body-paragraph iu iv hu ix b iy lj ja jb jc lk je jf ju ll ji jj jv lm jm jn jw ln jq jr js hn dt translated">如果有一些未翻译的字符串或一些用标记包装的无效翻译，此命令将抛出:</p><pre class="lo lp lq lr fq lz ly ma mb aw mc dt"><span id="7400" class="md km hu ly b fv me mf l mg mh">c-3po check uk.po hello.js</span></pre><p id="88df" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">关于<strong class="ix hv">验证</strong>—<a class="ae jt" href="https://c-3po.js.org/validation.html" rel="noopener ugc nofollow" target="_blank">https://c-3po.js.org/validation.html</a>的更多细节</p><h1 id="f8a1" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">下一步是什么？</h1><p id="94bb" class="pw-post-body-paragraph iu iv hu ix b iy lj ja jb jc lk je jf ju ll ji jj jv lm jm jn jw ln jq jr js hn dt translated">尽管如此，我们仍在努力改进翻译过程，并打算向库和工具添加新功能。</p><ul class=""><li id="d8b8" class="jx jy hu ix b iy iz jc jd ju jz jv ka jw kb js kc kd ke kf dt translated">简化webpack集成。</li><li id="790b" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">简化翻译设置。</li><li id="3ca2" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">打字稿。</li><li id="2aac" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">更多文档和示例。</li></ul><p id="c9eb" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">目前的翻译过程需要相当多的样板文件，我们可以减少，我们将解决这一问题。任何反馈将不胜感激，公关的欢迎！</p><h1 id="56d6" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">更多链接</h1><ul class=""><li id="f4f6" class="jx jy hu ix b iy lj jc lk ju mi jv mj jw mk js kc kd ke kf dt translated">文件和示例—<a class="ae jt" href="https://c-3po.js.org/" rel="noopener ugc nofollow" target="_blank">https://c-3po.js.org/</a></li><li id="8e36" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">c-3po库—<a class="ae jt" href="https://github.com/c-3po-org/c-3po" rel="noopener ugc nofollow" target="_blank">https://github.com/c-3po-org/c-3po</a></li><li id="9541" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">巴别塔插件c-3po—<a class="ae jt" href="https://github.com/c-3po-org/babel-plugin-c-3po" rel="noopener ugc nofollow" target="_blank">https://github.com/c-3po-org/babel-plugin-c-3po</a></li><li id="34e9" class="jx jy hu ix b iy kg jc kh ju ki jv kj jw kk js kc kd ke kf dt translated">c-3po-CLI—【https://github.com/c-3po-org/c-3po-cli T21】</li></ul><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="ml lu l"/></div></figure></div></div>    
</body>
</html>