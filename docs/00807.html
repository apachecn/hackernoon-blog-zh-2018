<html>
<head>
<title>Live Streaming to 2 Million Users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向200万用户直播</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/live-streaming-to-2-million-users-d1aba226da43?source=collection_archive---------28-----------------------#2018-01-25">https://medium.com/hackernoon/live-streaming-to-2-million-users-d1aba226da43?source=collection_archive---------28-----------------------#2018-01-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1754" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">阿里巴巴光棍节倒计时晚会通过定制界面向全世界开放</em></p><p id="480b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">阿里巴巴的双11全球购物节在流行文化中获得了标志性的地位，其倒计时晚会是线上和线下世界的重要连接点。2017年，阿里巴巴的视频流媒体网站优酷的任务是向数百万用户直播春晚的舞台活动，这对优酷的直播、移动和架构团队构成了不小的挑战。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/a573f5f9012e5bba807fbe08dd12aa2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQm7VMorzcFnPZGdCzI1fg.jpeg"/></div></div></figure><p id="d716" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管优酷直播有成熟的在线业务，但这个项目提出了许多需要解决的新问题。除了直播实际的晚会活动本身，还计划了许多其他互动活动，包括点赞/分享赠品、测验、宝藏活动和数字红包分享。</p><p id="7837" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让活动规划变得更加困难的是，并不是所有需要的投资都及时收到了，因此流媒体网站的需求仍然非常动态。此阶段的另一个重要问题是事件流模板的要求，这导致了现有站点结构的问题。</p><p id="4bbb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，我们决定使用Weex技术——一种类似React Native的轻量级用户界面框架——来构建一个全新的优酷直播界面。新的界面将保留所有当前的功能和操作功能，同时增加对各种光棍节互动活动的支持。</p><p id="e3e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">(进一步了解阿里巴巴的Apache项目<strong class="it hv">Weex</strong>:<a class="ae kc" href="http://weex.apache.org/index.html" rel="noopener ugc nofollow" target="_blank">http://weex.apache.org/index.html</a>)</p><h1 id="42d9" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">包装现有的本机组件</h1><p id="949e" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">这个全新界面的初始工作包括划分功能模块，并确定哪些功能模块将通过Weex SDK或AliWeex SDK中包含的默认组件来实现。此外，还需要确定哪些本地Java模块需要将其本地代码封装到Weex组件中，以供Weex前端开发人员使用。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lg"><img src="../Images/20d9893d38a77df353ce91083ef4f5b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*viLA0-OXy2-bnkhvuQbrYg.png"/></div></div><figcaption class="lh li fg fe ff lj lk bd b be z ek"><em class="ll">Diagram showing the technical structure and functions of the Youku live stream</em></figcaption></figure><p id="aee6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经过初步评估，直播室的功能模块划分如下:</p><p id="e85c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">直播室画面</strong></p><p id="5f97" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是使用Weex前端代码构建的。</p><p id="ba9a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">选择选项卡</strong></p><p id="22af" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">包含文本和图片的视频列表，使用Weex前端代码构建。</p><p id="7b93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">聊天标签</strong></p><p id="6430" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这包括大量的聊天气泡效果和复杂的运算逻辑。最初的Java代码被包装成一个Weex组件。</p><p id="0f90" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">内容直播标签</strong></p><p id="d7f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">包括图形投影、文本、视频、产品链接和其他复杂的逻辑。最初的Java代码被包装成一个Weex组件。</p><p id="3bce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">视频播放器组件</strong></p><p id="aee0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">优酷直播视频播放器的原始Java代码被包装成一个Weex组件。</p><p id="9fbe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">喜欢标记</strong></p><p id="46ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该组件在被单击时，或者在收到来自服务器的“赞”通知时，会生成大量的浮动动画。最初的Java代码被包装成一个Weex组件。</p><p id="94b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">定制选项卡</strong></p><p id="9852" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一个定制的WebView模块被包装成一个Weex组件。它包括各种功能:</p><ol class=""><li id="decd" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">阿里巴巴百川加载淘宝商品，边看直播边启用购买功能。</li></ol><p id="0dba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.一个交互式的HTML5页面实现了数字红包分享，竞猜等。</p><p id="1e24" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.优酷星球投影的HTML5页面等。</p><p id="5b52" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">其他功能模块，如超链接、分享、追踪等，也被包装成Weex模块，供Weex前端开发者使用。</strong></p><p id="e8f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经过功能模块的设计和划分，整个直播室界面完全模块化。它可以根据需求进行组合、分解和定制。</p><p id="e430" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">无论直播房间的设计未来如何变化，只要新编码的直播房间皮肤与各种定制的Weex组件相结合，就可以基于项目约束组装或拆卸所需的直播流。</p><h1 id="8e36" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">交互式活动支持</h1><p id="7479" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">采用了优酷直播平台来执行主持人话题编辑，提供流皮肤，并支持幸运dip事件。特定的完整输入将被集成到交互事件模型中，然后使用PowerMsg发送到服务器，PowerMsg是一个使用HTTP持久连接的主题订阅系统。一旦客户端收到类似的交互消息，这些消息将通过Weex globalEvent直接传递给Weex前端代码。Weex前端代码分析完单词后，会显示主持人的话题，并根据相关指令打开宝箱和幸运蘸酱页面。</p><p id="c827" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这不同于将Weex页面降级为HTML5页面的传统方法。每当我们的降级逻辑遇到异常加载或其他异常时，它会将Weex直播流房间降级为原生直播流房间。这就构成了降级逻辑的新形式。</p><h1 id="3a28" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">挑战和解决方案</h1><p id="f4ee" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">在开发直播房间的过程中，遇到了一些定制Weex组件的标签栏框架和手势冲突的问题。</p><p id="19ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Weex标签栏和定制Weex组件的集成过程中，由于两者之间的手势冲突，标签切换失败。要么水平和垂直手势都被当前标签占用，阻止用户在标签之间切换，要么水平和垂直手势都被标签栏占用，导致垂直滑动在当前标签中失败。</p><p id="be65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">父视图和子视图能够同时滑动的滑动冲突也是一个问题。对此的解决方案是在父视图onInterceptTouchEvent()上构建一个拦截器，如下所示:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lv"><img src="../Images/91841ec10dcb9f96c1c3c74bbb8d0216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IE-wgDEOFi4VqvbPYqGltQ.png"/></div></div></figure><p id="e065" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最终商定的解决方案是编写一个定制的Weex DIV标记，并使用它来包装定制的Weex组件，该组件使用垂直滑动手势并将它们传输到定制的Weex组件。水平滑动手势绕过定制的Weex DIV，被发送到Weex标签栏，解决了滑动手势冲突的问题。</p><p id="560b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，直播Weex前端代码使用了ExpressionBinding来优化滑动性能，我们的自定义DIV标签导致了ExpressionBinding失败。为了克服这个问题，WXComponent的手势识别代码被重写，覆盖了最初随WXComponent提供的默认手势识别代码。这导致ExpressionBinding再次生效。ExpressionBinding的执行顺序如下所示:</p><p id="22b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">触摸开始-&gt; panstart -&gt;表达式绑定panstart -&gt;表达式绑定panmove -&gt;表达式绑定panend -&gt;触摸结束-&gt; panend</p><p id="8573" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">ExpressionBinding的核心概念是检测Java代码中的‘pan start’事件，然后执行Weex Javascript代码传下来的手势处理逻辑，而不是将手势发送到Weex前端代码，等待Javascript处理手势。</p><p id="662a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的自定义DIV标记和自定义Weex组件使得ExpressionBinding无法检测panstart事件。因此，我们重写的WXGesture模块发送WXGestureType。HighLevelGesture.HORIZONTALPAN或WXGestureType。HighLevelGesture.VERTICALPAN在适当的时候向WXComponent发送事件，手动触发ExpressionBinding中标识代码的执行。之后，ExpressionBinding就能够与定制的DIV标签和定制的Weex组件协作了。</p><h1 id="fb49" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">优化屏幕旋转</h1><p id="89ee" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">最初，优酷直播房间的屏幕旋转是通过直接旋转Android活动来实现的，然后使视频水平适应整个屏幕，然后旋转Android活动以将视频视图恢复到其初始大小，并允许重新显示布局的其余部分。</p><p id="8023" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，新的Weex直播流房间大大增加了屏幕旋转的复杂性。垂直和水平屏幕之间的转换变得极其缓慢，以至于每次转换都会导致屏幕在正常显示之前变黑一段时间。</p><p id="0b49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对此问题采用的解决方案如下:</p><p id="7ee2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当从垂直屏幕切换到水平屏幕时，从其父视图组中删除视频视图，然后将其直接添加到当前窗口的décorView中。</p><p id="31be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从水平屏幕切换到垂直屏幕时，从décorView中删除视频视图，然后将其添加到旧的父视图组，最后重置各种布局参数。</p><p id="5986" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些优化极大地增强了屏幕旋转体验，即使在几年前生产的低端设备上也可以快速水平和垂直旋转。</p><h1 id="d7fb" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">圆角视频</h1><p id="4cc1" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">为了实现真正独特的直播体验，使用了圆角视频。这是通过在自定义视频标签上覆盖天猫电视图像来实现的，因此视频仅通过圆形框显示。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lw"><img src="../Images/442fd961b9b95fa38af43ad58dc37e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*-7882Hy-Ee5GeB5Z_nM_GQ.png"/></div><figcaption class="lh li fg fe ff lj lk bd b be z ek"><em class="ll">he Singles’ Day live stream with overlaying Tmall TV screen</em></figcaption></figure><p id="54b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种实现在iOS设备上工作得很好，但在Android设备上失败了，在Android设备上，视频的原始边角仍然可见，并且视频和图片级别也存在问题。</p><p id="6fc2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过向定制的Weex视频组件添加“borderRadius”属性，在UED设计中设置电视画面圆角的适当角度，起草一个定制的视频标签，并将该值传递给本机Java代码，解决了这个问题。然后，在Weex 750px转换后，圆角直接在本机代码中应用于VideoView。</p><p id="a03a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">结果是，拍摄的圆角视频与电视画面的圆角完美匹配，两者看起来就像是一个图像。</p><h1 id="cb33" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">提高渲染和加载速度</h1><h2 id="0f2c" class="lx ke hu bd kf ly lz ma kj mb mc md kn jc me mf kr jg mg mh kv jk mi mj kz mk dt translated">1.优化装载时间</h2><p id="2588" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">Weex live streaming默认为垂直方向，但也可以使用水平方向。原有的Weex逻辑同时初始化竖屏和横屏布局，比较耗时，增加了加载时间。</p><p id="e3e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了解决这一问题，Weex直播室被修改为仅初始化垂直屏幕所需的组件，并延迟加载水平屏幕所需的组件，仅在需要时创建和初始化所需的方向。</p><h2 id="9a49" class="lx ke hu bd kf ly lz ma kj mb mc md kn jc me mf kr jg mg mh kv jk mi mj kz mk dt translated">2.优化冗余布局</h2><p id="07a9" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">可以通过减少布局层次、删除所有冗余视图来进行优化以提高性能。此外，Weex直播室还进行了大量级别/视图简化。两者的结合极大地改善了装载体验。</p><h2 id="9663" class="lx ke hu bd kf ly lz ma kj mb mc md kn jc me mf kr jg mg mh kv jk mi mj kz mk dt translated">3.优化的“喜欢”动画</h2><p id="4c68" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">直播流“喜欢”图标是一个定制的Weex组件。当用户手动点击“喜欢”或从服务器接收到“喜欢”消息时，服务器传送的浮动图标如红心或其他图像在用户界面中被动画化。</p><p id="4ed5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个功能通常工作正常。然而，如果有太多的用户同时观看春晚，Android设备上的“赞”动画会明显滞后。</p><p id="f0d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了解决这个问题，我们创建了一个代码开关，可以减少或隐藏低性能设备上移动的“Like”图标。相反，只有当喜欢的数量达到目标阈值时，或者在更长的时间间隔之后，动画才会出现，从而降低设备上的渲染需求。</p><h1 id="82a4" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">降低服务器需求</h1><p id="6fa2" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">采取以下措施有助于降低对服务器的要求，并确保更流畅的实时流。</p><h2 id="8e8c" class="lx ke hu bd kf ly lz ma kj mb mc md kn jc me mf kr jg mg mh kv jk mi mj kz mk dt translated">1.静态资源优化</h2><p id="74be" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">Weex Javascript捆绑包和其他静态资源在春晚之前被推送到优酷用户的设备上，这导致了:</p><p id="2646" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">减少了节日之夜服务器的资源检索压力。</p><p id="e46d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于挂起的请求资源位于本地存储上，因此显著提高了渲染速度。</p><p id="71f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">增加了页面加载的成功率。</p><h2 id="e697" class="lx ke hu bd kf ly lz ma kj mb mc md kn jc me mf kr jg mg mh kv jk mi mj kz mk dt translated">2.请求合并</h2><p id="c5fe" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">由于某些API请求非常复杂，Weex和Java代码都会请求这些API，并且请求的时间是不确定的。</p><p id="46eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了帮助解决这个问题，我们编写了一个API request Weex定制模块，它可以适应API请求和数据池功能的操作。当发出一个请求时，对同一接口的类似请求会在短时间内被缓存。当第一个请求的数据返回时，所有缓存的请求方都会得到通知。</p><p id="9ba8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个微不足道的优化将服务器的QPS压力降低了超过10万个单位。</p><h2 id="790a" class="lx ke hu bd kf ly lz ma kj mb mc md kn jc me mf kr jg mg mh kv jk mi mj kz mk dt translated">3.受限服务器接口请求</h2><p id="41ca" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">在联欢晚会那天，只要求最低限度的服务器API。例如，没有发送“订阅实时预览”的请求。</p><h1 id="2a34" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">倒计时晚会结果</h1><p id="d23f" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">优酷直播非常成功，带来了:</p><p id="0a5f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">超过655万用户点击进入天猫。</p><p id="16d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">高达200.9万的并发在线观众。</p><p id="3643" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了更密切地监控直播性能，我们在直播室和优酷直播视频播放器的关键点添加了用户跟踪和统计代码。下表显示了结果。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ml"><img src="../Images/a33b2202e5b70de03bd6bdd75a22344a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tT3HUGdbiM98d2u5S8OtKw.png"/></div></div></figure><h1 id="2afb" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">其他成就</h1><p id="148a" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">随着活动的成功，Weex直播室按照原始的原生直播室建造了一个全新的皮肤。现已全面纳入优酷Live运营，旧的原生流媒体平台已移至线下。</p><p id="48e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">春晚期间为Weex直播房间设计的各种用户互动方式现在已经成为优酷直播的常规操作手段。</p><p id="29b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2017天猫光棍节倒计时晚会是优酷历史上第一次如此大规模的采用Weex框架。这也促成了阿里巴巴直播历史上最高的在线观看次数。</p><p id="d908" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于Weex直播室在光棍节的成功，Weex现在负责优酷的所有直播运营，包括2018年除夕活动和即将到来的2018年春节联欢晚会。更多互动和有趣的产品功能将很快发布，以及更流畅的实时流媒体的核心更新，敬请关注。</p></div><div class="ab cl mm mn hc mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hn ho hp hq hr"><h1 id="3287" class="kd ke hu bd kf kg mt ki kj kk mu km kn ko mv kq kr ks mw ku kv kw mx ky kz la dt translated">阿里巴巴科技</h1><p id="f89f" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">关于阿里巴巴最新技术的第一手、详细、深入的信息→在<strong class="it hv">脸书</strong>上搜索<strong class="it hv">“阿里巴巴科技”</strong></p><p id="64ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">【www.facebook.com/AlibabaTechnology T4】</p></div></div>    
</body>
</html>