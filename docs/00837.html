<html>
<head>
<title>Javascript Closure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Javascript闭包</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/picklejs-closures-in-javascript-1cd35576f060?source=collection_archive---------14-----------------------#2018-01-26">https://medium.com/hackernoon/picklejs-closures-in-javascript-1cd35576f060?source=collection_archive---------14-----------------------#2018-01-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="ec42" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">PickleJS系列的一部分</h2></div><p id="7da2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最初发布于1.26.18，作为JavaScript月的一部分。原帖可以在<a class="ae kf" href="https://www.javascriptjanuary.com/blog/picklejs-closures" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff kg"><img src="../Images/4800c773b0dc6eb14adf6377c9e90d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v32HE6VFHdDQVEfWkQk7dw.jpeg"/></div></div></figure><h1 id="487f" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated"><strong class="ak">简介:</strong></h1><p id="cae0" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">欢迎来到(希望)将会成为围绕<a class="ae kf" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>中的一些基本概念的系列博文。这个系列的灵感来自于我在T21图灵软件设计学院上学的时候。当我第一次开始<a class="ae kf" href="https://hackernoon.com/tagged/programming" rel="noopener ugc nofollow" target="_blank">编程</a>时，我发现使用像<code class="eh lp lq lr ls b">Foo, Bar, Baz, Bash</code>这样的变量和函数名的代码示例非常令人困惑。</p><p id="32e1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">例如，来自凯尔·辛普森关于范围的一次演讲:</p><pre class="kh ki kj kk fq lt ls lu lv aw lw dt"><span id="a12d" class="lx kt hu ls b fv ly lz l ma mb">var foo = “bar”;</span><span id="9e93" class="lx kt hu ls b fv mc lz l ma mb">function bar() {<br/> var foo = “baz”;<br/>}</span><span id="d5d1" class="lx kt hu ls b fv mc lz l ma mb">function baz(foo) {<br/> foo = “bam”;<br/> bam = “yay”;<br/>}</span></pre><p id="146c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于许多可能已经从事编程工作一段时间的人来说，这是简单易懂的。对于初学者来说，这可能非常令人困惑。这是一种经常使用的模式，当我第一次学习JavaScript时，我以为<code class="eh lp lq lr ls b">foo, bar, bam, baz, bash</code>是像<code class="eh lp lq lr ls b">return</code>和<code class="eh lp lq lr ls b">function</code>一样的特殊关键字。</p><p id="2505" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当查看代码示例时，读者应该能够确定示例的哪些部分是必要的，哪些是不必要的，如变量名、函数名、参数等。在这篇文章中，我们将使用<a class="ae kf" href="https://en.wikipedia.org/wiki/Sandwich" rel="noopener ugc nofollow" target="_blank">三明治</a>和制作它们的人，作为谈论JavaScript的<code class="eh lp lq lr ls b">closure</code>的例子。长得离谱的变量和函数名应该很容易区分一个例子的哪些部分是JavaScript语言和语法的一部分；以及哪些部分由您作为开发人员来命名。</p><h2 id="7136" class="lx kt hu bd ku md me mf ky mg mh mi lc js mj mk le jw ml mm lg ka mn mo li mp dt translated"><strong class="ak">在我们开始之前</strong></h2><p id="5214" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">我们假设你已经写了一些JavaScript，你理解了<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Functions" rel="noopener ugc nofollow" target="_blank">函数</a>和<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function" rel="noopener ugc nofollow" target="_blank">函数声明</a>。为了理解闭包的威力，熟悉<a class="ae kf" href="https://en.wikipedia.org/wiki/Scope_(computer_science)" rel="noopener ugc nofollow" target="_blank">作用域</a>和词法作用域是必要的，所以如果你不熟悉这些概念，花一点时间阅读它们并回来。</p><h2 id="ec87" class="lx kt hu bd ku md me mf ky mg mh mi lc js mj mk le jw ml mm lg ka mn mo li mp dt translated"><strong class="ak">什么是闭包？</strong></h2><p id="3d4b" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">这是一个在技术面试中经常被问到的问题。闭包并不是JavaScript独有的，但它是JavaScript如此强大的原因之一。<strong class="jl hv">闭包</strong>是一个计算机科学术语，定义了一个函数如何维护它被调用的环境的记录。这意味着一个函数可以跟踪它最初被调用时的参数和变量，即使它是在那个范围之外被调用的。换句话说，<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" rel="noopener ugc nofollow" target="_blank"> MDN文档</a>将闭包定义为“函数和声明该函数的词法环境的组合。”如果这不太有意义，不要担心，我们会在这篇文章结束时解决所有问题！</p><h2 id="5246" class="lx kt hu bd ku md me mf ky mg mh mi lc js mj mk le jw ml mm lg ka mn mo li mp dt translated"><strong class="ak">你可能已经在哪里使用闭包了</strong></h2><p id="113b" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">所有的JavaScript函数都是闭包。函数可以访问函数中定义的变量，以及任何封闭作用域(如全局作用域)中定义的变量。出现闭包的其他常见地方是<code class="eh lp lq lr ls b">setTimeout</code>、事件/点击处理程序和对象。</p><h2 id="b6c2" class="lx kt hu bd ku md me mf ky mg mh mi lc js mj mk le jw ml mm lg ka mn mo li mp dt translated">为什么要利用闭包？</h2><p id="01df" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">如上所述，在定义点击处理程序、编写回调函数或者使用<code class="eh lp lq lr ls b">setTimeout</code>或<code class="eh lp lq lr ls b">setInterval</code>时，你会用到闭包。</p><p id="cbbb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一个<code class="eh lp lq lr ls b">setTimeout</code>函数可能看起来像这样:</p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="c40f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我们声明了我们的<code class="eh lp lq lr ls b">greetTheCustomer</code>函数的地方，我们创建了一个新的范围。如果没有闭包，函数就不能访问<code class="eh lp lq lr ls b">customerName</code>或<code class="eh lp lq lr ls b">deliEmployeeName</code>变量，我们必须显式地将这些变量传递给<code class="eh lp lq lr ls b">greetTheCustomer</code>。在这个例子中，我们已经在<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Glossary/Global_scope" rel="noopener ugc nofollow" target="_blank">全局作用域</a>上声明了我们的变量，但是如果这些变量都是在一个函数中定义的，或者是作为一个对象上的一个方法定义的，那么这个概念是相同的。</p><p id="c288" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在对象内部定义私有变量时，闭包非常有用:</p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="7644" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在本例中，我们通过将<code class="eh lp lq lr ls b">bread</code>和<code class="eh lp lq lr ls b">topping</code>定义为<code class="eh lp lq lr ls b">Sandwich</code>对象的属性，公开了它们。<code class="eh lp lq lr ls b">typicalNumberOfPickles</code>变量在三明治对象之外不可用，为了在<code class="eh lp lq lr ls b">Sandwich</code>对象的范围之外访问它，您可以使用该变量编写一个方法，该方法将作为一个闭包。</p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="6cb5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这里，我们展示了一种公共方法<code class="eh lp lq lr ls b">howManyPicklesAreOnMySandwich</code>来为客户提供关键的一点信息。即使我们不能直接访问全局范围内的<code class="eh lp lq lr ls b">typicalNumberOfPickles</code>变量，由于闭包的存在，我们可以通过我们的新方法获得这些信息。</p><p id="94cd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">用一个方法代替一个对象的常用模式是通过创建一个返回内部函数的函数来利用闭包。该内部函数将可以访问外部函数中定义的任何变量，而不会将这些变量暴露在更大的范围内。</p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="46e8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这里，我们的<code class="eh lp lq lr ls b">morePicklesPlease</code>函数维护对原始<code class="eh lp lq lr ls b">typicalNumberOfPickles</code>变量的访问，并将继续更新它。需要注意的是，每次您存储返回的函数供以后使用时，它都会形成自己的闭包。原始变量不是在每个函数之间共享的，每个函数都有自己的原始环境副本。</p><p id="b973" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在下面的例子中，我们将使用相同的<code class="eh lp lq lr ls b">askForMorePickles</code>功能制作2个不同的三明治，每个三明治都有自己的泡菜数量。</p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="bb12" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这让消费者可以根据完美的泡菜数量定制三明治体验！</p><h2 id="b30a" class="lx kt hu bd ku md me mf ky mg mh mi lc js mj mk le jw ml mm lg ka mn mo li mp dt translated">使用闭包的缺点</h2><p id="6af5" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">因为闭包的每个版本都保留了原始环境的副本，所以直到使用它的所有闭包都被<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Glossary/Garbage_collection" rel="noopener ugc nofollow" target="_blank">垃圾收集</a>后，该环境才会从<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Glossary/Call_stack" rel="noopener ugc nofollow" target="_blank">调用栈</a>中移除。因此，举例来说，如果你有100个不同的函数引用这个原始变量，其中99个被垃圾回收，这个变量仍然存在，直到第100个函数被回收。这会耗尽本地内存，最终导致<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management" rel="noopener ugc nofollow" target="_blank">内存泄漏</a>。</p><h2 id="b07c" class="lx kt hu bd ku md me mf ky mg mh mi lc js mj mk le jw ml mm lg ka mn mo li mp dt translated">总结，或者，你如何在采访中谈论结束</h2><p id="fc63" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">闭包是许多编程语言的基础部分，不仅仅是JavaScript。闭包指的是一个函数，它保持对调用该函数时定义的自由变量的访问。闭包的一些用例是事件处理程序、超时、间隔、回调和在函数中保持变量私有。使用闭包的一个缺点是，它们会导致内存的过度消耗，如果处理不当，还可能导致内存泄漏。</p><p id="8674" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">希望这有助于你解开闭包的谜团。如果你想了解更多，我强烈推荐这本<a class="ae kf" href="https://github.com/getify/You-Dont-Know-JS/tree/master/scope%20%26%20closures" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hv">你不知道的Javascript:Scope&amp;Closure</strong></a>书。</p><p id="7894" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你喜欢这篇文章，并希望看到未来的帖子，请在这里或Twitter上告诉我:<a class="ae kf" href="https://twitter.com/Jeff_Duke_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/Jeff_Duke_io</a></p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="ms mr l"/></div></figure></div></div>    
</body>
</html>