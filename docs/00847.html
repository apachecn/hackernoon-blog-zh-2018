<html>
<head>
<title>Generating a level from an image in Unity3D</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Unity3D中的图像生成关卡</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/generating-a-level-from-an-image-in-unity3d-225b51a68172?source=collection_archive---------24-----------------------#2018-01-26">https://medium.com/hackernoon/generating-a-level-from-an-image-in-unity3d-225b51a68172?source=collection_archive---------24-----------------------#2018-01-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="dd2d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的水平是由不同的块作为瓷砖。不仅对我这个开发者，对游戏设计师来说，硬编码所有的职位都有点痛苦。</p><p id="c15d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我需要能让设计和测试足够快的东西。并且独立于开发者。所以游戏设计者可以在Unity中放一个文件，这个文件会被读取，关卡会出现在屏幕上。</p><p id="ae8e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我暂时想到了如何做这件事。我首先想到的是JSON文件。我来自移动应用程序世界，我习惯于使用JSON做任何事情，所以在这里使用它似乎也是合乎逻辑的。</p><p id="e643" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是后来，游戏设计师有了一个更好的主意。为什么不用图像呢？它看起来更直观，而且足够小，不会占用太多空间。所以我决定使用这种方法。</p><h1 id="5035" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">如何用一张图片生成关卡？</h1><p id="4879" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">这个想法很简单:从图像中读取1个像素，解码de color并在该位置放置一个图块。图像将是宽度的平铺数量x高度的平铺数量。</p><p id="3b58" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以我们从这里开始:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff ks"><img src="../Images/407993692e57c4b4f9e2ff9cea8b0e10.png" data-original-src="https://miro.medium.com/v2/resize:fit:220/format:webp/1*XWJkmWMAE4Igaa69HL4P6g.png"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">I zoomed the image, but it should be 1px per color</figcaption></figure><p id="a0d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对此:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="fe ff le"><img src="../Images/24f8b75bec756220b0c8f526f6553714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_V0QqDsWsqFggiH3KrZiHw.png"/></div></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">The generated level</figcaption></figure><p id="c4f0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">免责声明</strong>:我在这些例子中使用的所有资产都来自<a class="ae lj" href="https://kenney.itch.io/kenney-game-assets-2" rel="noopener ugc nofollow" target="_blank">肯尼游戏资产2 </a>。从这里感谢<a class="ae lj" href="https://kenney.itch.io/" rel="noopener ugc nofollow" target="_blank">肯尼</a>提供如此令人敬畏的资产:)如果你喜欢他们，考虑得到他的一个包。</p><h1 id="c7cf" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">我们的资产</h1><p id="4338" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">出于测试目的，我们将在背景中间生成一个级别。如果这是我们的背景图像:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff lk"><img src="../Images/ddc908cb48494401e1dc71b1cf8fef11.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*Ccs5jHhJpuU_h7al1QIPzg.png"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">Our beautiful grassy background</figcaption></figure><p id="8716" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们希望将图块放在另一幅图像的选中区域:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff lk"><img src="../Images/963e0ffd39f72b766a7ef16e28e27a1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*ohL_-NSFVWZ3ZFLEgU9ozA.png"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">The checked area is where the level will be drawn</figcaption></figure><p id="01e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这只是把他们画在中间。我选择这个数量和位置没有特别的原因，所以你可以随意适应你的游戏要求。</p><p id="4135" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些是将被使用的瓷砖:一个女孩为玩家(蓝色像素在我们的水平地图纹理)，一个僵尸(绿色像素)，火(红色像素)，沙子(黄色像素)和石头(灰色像素)</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/2efc9fcc37508a6cebaa365006606a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*F4obMeCNFSuVF5RG7GOuJg.png"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">The tiles that will be used</figcaption></figure><h1 id="484e" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">让我们开始编码吧</h1><p id="717a" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我不打算详细介绍Unity是如何工作的，所以我只解释与这个主题相关的代码，它从一个图像生成一个关卡。</p><p id="afd5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的场景中有一个包含我的<em class="lm">级别生成器</em>脚本的<em class="lm">游戏对象</em>。该脚本具有以下公共变量(因此我可以从编辑器中调整某些参数):</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ln lo l"/></div></figure><p id="7fed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后在我们的<em class="lm"> Start </em>方法中，我们得到一个对GenerateLevel方法的调用。它看起来是这样的:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ln lo l"/></div></figure><p id="7147" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们遍历包含关卡设计的纹理的宽度和高度。然后，我们得到像素颜色，并检查哪个对象代表了该颜色。如果没有该像素颜色的对象，<em class="lm"> GetGameObject </em>方法将返回null，然后我们将继续下一个像素。这将发生在读取背景像素时(在我的例子中是白色)。</p><p id="cca3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦我们得到了要实例化的对象名，我们需要知道它的位置。为此，我们有两个方法:一个是将图块转换为背景中的像素点(也考虑了上面显示的startingPosition变量),另一个是将像素位置转换为<em class="lm"> Vector3 </em>世界位置。</p><p id="bb12" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">之后，它只是实例化该位置的对象，循环继续，直到纹理结束。</p><p id="0987" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们看看这里使用的其他3种方法:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ln lo l"/></div></figure><p id="5220" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我认为这里的代码非常简单明了。</p><p id="f46d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一种方法只是将x，y平铺从水平设计纹理变成背景中的像素位置。</p><p id="563c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第二种方法将这些像素位置转换成游戏世界点数。</p><p id="94e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第三个只是一个巨大的开关，上面有我们瓷砖的颜色代码和它们相应的预制名称。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="fe ff lp"><img src="../Images/8025ac79c4040bdbe5aee13887208129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AwygvMj4M38aa5KEhp9TTg.png"/></div></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">Level Generation in process! The left image, has been zoomed. In reality it’s 11x6px</figcaption></figure><p id="9483" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这段代码，我们终于从那个小图像中获得了我们的级别。</p><p id="6559" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望这段代码可以帮助那些想做和我们类似事情的人。如果你有任何问题，请随时提问。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><a href="http://eepurl.com/dh-0I1"><div class="fe ff lq"><img src="../Images/db2dc5b9f5ecafe565afcc9d53874a4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Brzxc5tgtSWFpJPKHG6fyA.png"/></div></a></figure></div></div>    
</body>
</html>