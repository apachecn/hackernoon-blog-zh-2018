<html>
<head>
<title>Build performance reports for your Apollo React Components in 30 minutes. ⏲️</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在30分钟内为您的Apollo React组件构建性能报告。⏲️</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-performance-reports-for-your-apollo-react-components-in-30-minutes-%EF%B8%8F-1b4c27a16a84?source=collection_archive---------31-----------------------#2018-01-26">https://medium.com/hackernoon/build-performance-reports-for-your-apollo-react-components-in-30-minutes-%EF%B8%8F-1b4c27a16a84?source=collection_archive---------31-----------------------#2018-01-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7124" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">✨✨自动气象站实验</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/9a40bf1bc5bd7a3fc9650288d0276cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DPTbqyXuDYvWxg0EsKLbA.png"/></div></div></figure><h1 id="ab25" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">动机</h1><p id="596a" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">几个月前，我们开始了一个大项目:<strong class="it hv">将我们的应用程序迁移到GraphQL </strong>。</p><p id="59ab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于<strong class="it hv"> 300+ React组件</strong>和<strong class="it hv"> 20个API端点</strong>有许多嵌套资源，应用程序的可维护性和性能每个月都在恶化。</p><p id="1dea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦这个项目完成，我们想确保GraphQL实现他的承诺，所以我们决定跟踪迁移组件的“感知性能”。</p><blockquote class="le"><p id="ed07" class="lf lg hu bd lh li lj lk ll lm ln jo ek translated"><strong class="ak">我们希望观察GraphQL Ruby API的性能，避免UX/性能退化。</strong></p></blockquote><p id="b6f2" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">考虑到我们已经使用了很多外部SASS (NewRelic、Cloudinary、AWS、Segment、OAuth0、…)，我们没有构建完整的AWS数据ELK堆栈，而是决定构建一个简单且低成本的性能“仪表板”。</p><p id="0b4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于我们细分市场帐户将所有原始数据保存在S3存储桶中，我们决定通过发送自定义事件<code class="eh lt lu lv lw b">Perfomance.QueryLoadTime</code>来使用这些数据。</p><blockquote class="lx ly lz"><p id="65bb" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">注意:<a class="ae me" href="https://segment.com" rel="noopener ugc nofollow" target="_blank"> Segment </a>是一个SASS Analytics API，它提供了与Hubspot、custom webhooks或AWS等200多种服务的集成。</p></blockquote></div><div class="ab cl mf mg hc mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hn ho hp hq hr"><h1 id="2fc6" class="kb kc hu bd kd ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky dt translated">建筑</h1><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mr"><img src="../Images/ef727b4f16a7bf06fa08f4e73eb877c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3X4Dx2PvMEx42lSnznsrg.jpeg"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">Of course, Segment can easily be replaced by AWS <a class="ae me" href="https://aws.amazon.com/fr/kinesis/firehose/" rel="noopener ugc nofollow" target="_blank">Kinesis Firehose</a> and AWS <a class="ae me" href="https://aws.amazon.com/fr/api-gateway/" rel="noopener ugc nofollow" target="_blank">API Gateway</a></figcaption></figure><p id="330e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每次特定GraphQL请求结束时，前端React应用程序都会向Segment发送一个自定义的<code class="eh lt lu lv lw b">Perfomance.QueryLoadTime</code>事件。<br/>该事件随后以JSON原始数据文件的形式存储在S3。</p><p id="0322" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，每周从S3获取数据并进行整合，准备用于Google Sheets。</p><p id="fb5e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们看看如何解决它！</p></div><div class="ab cl mf mg hc mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hn ho hp hq hr"><h1 id="19a7" class="kb kc hu bd kd ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky dt translated">发送性能数据—使用分段设置阿波罗</h1><blockquote class="lx ly lz"><p id="7d4e" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated"><a class="ae me" href="http://apollodata.com" rel="noopener ugc nofollow" target="_blank"> Apollo Data </a>是一个兼容React的GraphQL客户端</p></blockquote><p id="b45d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此，我们需要编写一个<a class="ae me" href="https://www.apollographql.com/docs/react/basics/network-layer.html" rel="noopener ugc nofollow" target="_blank">自定义链接</a>来拦截一些过滤后的查询，并将性能数据发送给Segment。</p><blockquote class="lx ly lz"><p id="78fa" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">你会在下面看到一个<code class="eh lt lu lv lw b">JasonBourne</code>服务。<br/>别担心，这是我们的细分客户包装器。</p></blockquote><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mw mx l"/></div></figure><p id="ac81" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">都是。你所要做的就是将这个<code class="eh lt lu lv lw b">link</code>添加到你的<code class="eh lt lu lv lw b">ApolloClient</code>实例中。</p><pre class="jq jr js jt fq my lw mz na aw nb dt"><span id="1c32" class="nc kc hu lw b fv nd ne l nf ng">export const client = new ApolloClient({<br/>  link: ApolloLink.from([perfMonitorLink, networkLink]),<br/>  cache: apolloCache<br/>});</span></pre><p id="be87" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">前面的部分都准备好了。</p></div><div class="ab cl mf mg hc mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hn ho hp hq hr"><h1 id="bb03" class="kb kc hu bd kd ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky dt translated">构建整合数据—设置AWS Athena</h1><p id="3914" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">Athena是Amazon的一项服务，允许对S3文件运行SQL查询。</p><p id="08e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">配置Athena非常简单，您需要:</p><ol class=""><li id="ad86" class="nh ni hu it b iu iv iy iz jc nj jg nk jk nl jo nm nn no np dt translated">创建数据库</li><li id="b9d6" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">通过指定源和数据结构来创建表</li><li id="374d" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">创建一个命名查询并保存它</li></ol><h2 id="928e" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">数据</h2><p id="8ee6" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">以下是Segment存储到S3 <br/>(针对<code class="eh lt lu lv lw b">Perfomance.QueryLoadTime</code>事件)的原始数据结构</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mw mx l"/></div></figure><p id="be8d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您会注意到许多字段与数据分析无关，所以我们只保留一个子集。</p><h2 id="bfbf" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">创建数据库和表</h2><p id="8046" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated"><strong class="it hv">注意:</strong>AWS Athena上可用的“创建表”UI不允许创建具有复杂数据结构(嵌套字段、联合类型字段等)的表，因此我们需要编写一个创建表查询，手工✍️</p><p id="1dd0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Athena使用一种<a class="ae me" href="https://hive.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache HIVE </a>语言来描述数据，下面是wanted <code class="eh lt lu lv lw b">CREATE TABLE</code>查询:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff oi"><img src="../Images/75206c3f3ec86de557f1950451f00541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8oQnginRLc5Tininc-2dog.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">The query expose the data format (JSON), data structure, the source and the destination</figcaption></figure><p id="cf7e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此，我们可以使用一个叫做<code class="eh lt lu lv lw b"><a class="ae me" href="https://github.com/quux00/hive-json-schema" rel="noopener ugc nofollow" target="_blank">hive-json-schema</a></code>的奇妙工具。<br/>这是一个开源项目——由AWS官方文档推荐——从JSON原始数据生成HIVE查询。</p><p id="ca7e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简而言之，给定一个JSON示例文件，它会生成一个相应的<code class="eh lt lu lv lw b">CREATE TABLE</code>查询。</p><p id="c917" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae me" href="https://github.com/quux00/hive-json-schema#overview" rel="noopener ugc nofollow" target="_blank">看doc </a>，真的很简单(最多花5分钟)。</p><h2 id="c45d" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">编写并保存选择查询</h2><p id="ce5d" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">现在表已经准备好了，我们可以编写一个<code class="eh lt lu lv lw b">SELECT</code>查询。<br/>这是我们的:</p><pre class="jq jr js jt fq my lw mz na aw nb dt"><span id="8acd" class="nc kc hu lw b fv nd ne l nf ng">SELECT<br/>  properties.ellapsedMs, properties.operationName, sentAt<br/>FROM "segment"."perf" WHERE<br/>  event = 'Performance.QueryLoadTime'<br/>ORDER BY sentAt DESC;</span></pre><p id="6b4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为它是普通的SQL，所以您可以选择这个表上所有可用的字段。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff oj"><img src="../Images/378fdbabd10821b7d88a38294ee18fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*aqBd7Y_2saS9L7UkeXL5eQ.png"/></div></figure><p id="0705" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">运行查询并保存。</strong></p><p id="e5bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ma">注意:每次执行查询时，Athena都会将CSV结果存储在您的S3上。<br/>要了解位置(哪个桶)，请前往设置。</em></p><h2 id="4807" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">问题</h2><p id="377e" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">Athena不建议定期运行保存的查询。<br/>然而，我们可以使用AWS Athena API远程运行查询。<br/>下一步，λ。</p></div><div class="ab cl mf mg hc mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hn ho hp hq hr"><h1 id="db16" class="kb kc hu bd kd ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky dt translated">保持数据新鲜—设置定期AWS Lambda</h1><p id="c7b3" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">AWS Lambda是允许创建<a class="ae me" href="https://martinfowler.com/articles/serverless.html" rel="noopener ugc nofollow" target="_blank">无服务器功能</a>的服务。</p><blockquote class="lx ly lz"><p id="f3df" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated"><em class="hu">无服务器架构指的是在很大程度上依赖于运行在临时容器中的定制代码的应用程序(作为服务或“FaaS”)[……]。通过使用这些理念，[…]，这种架构消除了对位于应用程序后面的传统“始终在线”服务器系统的需求。根据具体情况，这种系统可以显著降低运营成本和复杂性，但代价是依赖供应商和(目前)不成熟的支持服务。</em></p></blockquote><p id="5ba4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae me" href="https://martinfowler.com/articles/serverless.html" rel="noopener ugc nofollow" target="_blank"> Martin Fowler —无服务器架构</a></p><p id="8bc9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们不想每周都在AWS Athena UI上手动运行保存的查询，所以我们需要一个每周都运行查询的Lambda。</p><p id="e0a2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是如何做到这一点:</p><ol class=""><li id="940a" class="nh ni hu it b iu iv iy iz jc nj jg nk jk nl jo nm nn no np dt translated">创建周期性lambda</li><li id="5300" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">确保lambda有足够的权限调用Athena并将结果存储到S3</li></ol><h2 id="eb8f" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">创建“周期性λ”</h2><p id="2b6c" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">转到“创建功能”，选择“节点6.10”和“创建自定义角色”。<br/>你将被重定向到<a class="ae me" href="https://aws.amazon.com/fr/iam/" rel="noopener ugc nofollow" target="_blank"> AWS IAM </a>，点击“允许”。<br/> <strong class="it hv">请记下IAM角色的名称，稍后会用到。</strong></p><p id="e6a4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后点击“创建功能”。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ok"><img src="../Images/5173e632ac99c974601548f42fc1c719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N5hOddX0vjPMn3XMlxxgdw.png"/></div></div></figure><h2 id="9c39" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">选择一个触发器</h2><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ol"><img src="../Images/d782874cb80d1935088c8467d8209bd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHZS3jnyr-4NykKtuDU9jg.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">You’ll arrive a page like this.</figcaption></figure><p id="83e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了运行，需要调用一个lambda。我们希望每周调用一次lambda，就像CRON任务一样。</p><p id="a32a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae me" href="https://aws.amazon.com/fr/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> AWS Cloudwatch </a>提供这个功能。</p><p id="6688" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在左侧，选择“CloudWatch Events”，然后使用以下配置:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff om"><img src="../Images/f350da9cad76619c239e24097901f98f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6U6XKHIwLufavOqOAT1dcQ.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">The lambda will be invoked by a Cloudwatch event every 7 days.</figcaption></figure><h2 id="e2de" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">lambda IAM角色</h2><p id="6314" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">这是最棒的部分，您需要进入IAM并找到您刚刚创建的角色。</p><p id="735d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，确保该角色拥有以下权限:</p><ul class=""><li id="a0c6" class="nh ni hu it b iu iv iy iz jc nj jg nk jk nl jo on nn no np dt translated"><strong class="it hv">雅典娜</strong> : <em class="ma"> GetNamedQuery </em>，<em class="ma"> StartQueryExecution </em></li><li id="56e6" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo on nn no np dt translated"><strong class="it hv"> S3 </strong> : <em class="ma">列表桶</em>，<em class="ma">创建桶</em>，<em class="ma">放置对象</em>，<em class="ma">列表桶</em></li></ul><p id="99a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将允许lambda查找并运行查询，并将结果存储在S3上。</p><p id="9ae2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ma">注意:我强烈建议您</em> <a class="ae me" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html" rel="noopener ugc nofollow" target="_blank"> <em class="ma">钻研AWS IAM文档</em> </a> <em class="ma">以便理解所有的含义。</em></p><h2 id="fb22" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">拉姆达代码</h2><p id="f5e9" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">λ必须:</p><ol class=""><li id="5df3" class="nh ni hu it b iu iv iy iz jc nj jg nk jk nl jo nm nn no np dt translated">通过id获取命名查询</li><li id="bd5e" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">开始查询</li><li id="3ef1" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">终止lambda执行</li></ol><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mw mx l"/></div></figure><p id="ea9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ma">注意:要获得您的Athena查询ID，请从Athena“保存的查询”中打开查询，并从URL中复制ID</em></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff oo"><img src="../Images/f4054b98038a4dfc717e47a4cff04886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jHSMmEWGJrbGNszYNY3EFg.png"/></div></div></figure></div><div class="ab cl mf mg hc mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hn ho hp hq hr"><h1 id="70db" class="kb kc hu bd kd ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky dt translated">显示数据—配置Google电子表格</h1><p id="9256" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">现在整合的数据是新的和可用的，我们需要:</p><ol class=""><li id="b1b1" class="nh ni hu it b iu iv iy iz jc nj jg nk jk nl jo nm nn no np dt translated">获取整合数据</li><li id="1311" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">格式化日期字段—如果有</li><li id="5474" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">构建数据透视表</li><li id="7d61" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">构建图表</li></ol><h2 id="e961" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">复制AWS Athena创建的最后一个CSV文件的内容</h2><p id="96c2" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">您将在Lambda源代码中指定的桶中找到该文件。<br/> <em class="ma">记住，我们指定了一个自定义输出位置给AWS Athena开始查询调用。</em></p><p id="6769" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">复制文件的内容，并将其粘贴到新的工作表中。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff op"><img src="../Images/709d085b63df233bed03a1e60fcb85cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*R8H9nuINzxivqpL08agoag.png"/></div></figure><h2 id="3d23" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">格式化数据</h2><p id="5b1a" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">如果您正在处理日期字段，这里有一个技巧。</p><p id="868e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">谷歌电子表格不理解ISO日期格式，我们需要“格式化”它。这是公式，将它应用到每个所需字段的全新列中。</p><pre class="jq jr js jt fq my lw mz na aw nb dt"><span id="256e" class="nc kc hu lw b fv nd ne l nf ng">= DATEVALUE(MID(C2,1,10)) + TIMEVALUE(MID(C2,12,8))</span></pre><p id="8ff1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ma">在这里你会得到一个“MM/DD/YYYY HH:MM:SS”格式的</em> ⤴️</p><div class="jq jr js jt fq ab cb"><figure class="oq ju or os ot ou ov paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/f65eeb83a80cbe0cbfb7008fa11e921d.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*SmUSANIZFMHTVZiN2UmeoQ.png"/></div></figure><figure class="oq ju ow os ot ou ov paragraph-image"><img src="../Images/af8db10efbff86f892c0870891d20524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*3sE6xzLSWLgBPC_VwVj0hg.png"/><figcaption class="ms mt fg fe ff mu mv bd b be z ek ox di oy oz">Remember to change the column format to “Date time”</figcaption></figure></div><h2 id="7299" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">构建“数据透视表”</h2><p id="80c2" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">整合的CSV数据尚不可用。<br/>由于数据对单个值(elapsedMs)使用多个维度(sentAt，operationName)，我们需要构建一个“矩阵/数据透视表”。</p><p id="3ca4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此，创建一个新的工作表并转到<em class="ma">“数据&gt;数据透视表…”</em></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/d5b6395916dfd78b730b927c494f95ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FlBijwkm0NAKfwXVn2Ct8Q.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">Here is an example of pivot table configuration, it’s very “data-specific”.</figcaption></figure><h2 id="60cd" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">配置图表</h2><p id="248d" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">图表的配置非常个性化，取决于您拥有的数据类型，这里有一个基于时间的性能数据示例。</p><p id="e7d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最喜欢的基于时间的性能数据图表类型是<em class="ma">散点图</em> ⤵️</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/9a40bf1bc5bd7a3fc9650288d0276cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DPTbqyXuDYvWxg0EsKLbA.png"/></div></div></figure><p id="2094" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者经典的平滑线图用平均值<br/>代替详细值⤵️</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff pa"><img src="../Images/953ccf45f853ed5e663605b28b23ec9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1y2D87SKPfKNUKYDtlfjg.png"/></div></div></figure><p id="d9ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这有助于我们一目了然地看到趋势和最大值✨</p></div><div class="ab cl mf mg hc mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hn ho hp hq hr"><h1 id="b6f1" class="kb kc hu bd kd ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky dt translated">结论</h1><h2 id="ec71" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">赞成的意见</h2><ul class=""><li id="299b" class="nh ni hu it b iu kz iy la jc pb jg pc jk pd jo on nn no np dt translated">每周只为Lambda执行和Athena查询支付一次费用</li><li id="7cd7" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo on nn no np dt translated">非常灵活的配置</li><li id="c55f" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo on nn no np dt translated">令人讨厌的🤓</li></ul><p id="e651" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Cons </strong></p><ul class=""><li id="3b30" class="nh ni hu it b iu iv iy iz jc nj jg nk jk nl jo on nn no np dt translated">解决方案已经存在:ELK、AWS Quicksight、Tableau</li><li id="55ef" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo on nn no np dt translated">每周复制-粘贴数据</li><li id="87a4" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo on nn no np dt translated">非技术人员不可配置</li></ul><h1 id="072a" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">未来和改进📈</h1><h2 id="db99" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">CVS文件数据粘贴步骤</h2><p id="59e9" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">这一步很难轻易实现自动化，因为AWS Athena创建了一个独特的。每次查询结束时在S3的csv文件。<br/>一种解决方法是做两件事:</p><ol class=""><li id="ded7" class="nh ni hu it b iu iv iy iz jc nj jg nk jk nl jo nm nn no np dt translated">更新lambda，将查询结果保存在一个名为<code class="eh lt lu lv lw b">latest.csv</code>和<strong class="it hv">的文件中，并在S3公开保存</strong><strong class="it hv"/>。</li><li id="d12a" class="nh ni hu it b iu nq iy nr jc ns jg nt jk nu jo nm nn no np dt translated">然后在谷歌电子表格中使用令人敬畏的<code class="eh lt lu lv lw b">IMPORTDATA()</code>功能</li></ol><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff pe"><img src="../Images/c1820a883bf71c4ce1a2d7520897451d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*Bxvd6M-50laDj-EA_6lhlQ.png"/></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">This way, the data will always be the freshest one!</figcaption></figure><h2 id="926d" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">支持多种查询</h2><p id="1c5e" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">我们可能想创建许多Athena查询(示例:BI或高级交叉分析工具报告)</p><p id="c395" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此，我们可以更新Lambda函数来更新所有或许多查询。</p><h2 id="b549" class="nc kc hu bd kd nv nw nx kh ny nz oa kl jc ob oc kp jg od oe kt jk of og kx oh dt translated">Tableau、AWS Quicksight或Datadog怎么样？</h2><p id="c2d7" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">当然，有许多经过考验的专业解决方案。<br/>该博客将解决方案暴露于具有特定财务和技术约束的特定环境中。<br/>我们完全可以配置Datadog或支付Tableau许可证费用，但这没那么有趣！</p><p id="dc06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这当然是一个实验和临时解决方案。</p><h1 id="0104" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">谢谢你的阅读！🌞</h1><p id="97bf" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">我希望你能学到一些关于AWS或GraphQL的东西。<br/>如果我错过了什么，请随时留言！</p></div></div>    
</body>
</html>