<html>
<head>
<title>Hard up for hosting: From DigitalOcean, to AWS, to Heroku.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从数字海洋，到AWS，到Heroku。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/hard-up-for-hosting-from-digitalocean-to-aws-to-heroku-db15a063fa94?source=collection_archive---------15-----------------------#2018-01-27">https://medium.com/hackernoon/hard-up-for-hosting-from-digitalocean-to-aws-to-heroku-db15a063fa94?source=collection_archive---------15-----------------------#2018-01-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/dd55d7b54a7db7da2d879e0706afc97b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*f6L9IxfSsm6vmk9WO-Cc2g.png"/></div></figure><p id="7a6e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt jw translated">今年是2016年。我是一个业余爱好者，有很多想法。很自然，我需要一个便宜的主机提供商来运行我最新的网络应用。我该从哪里开始？谁会被证明是难以捉摸的“最性感的女主人？”</p><p id="da8c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这是我在DigitalOcean、AWS和Heroku之间迁移的故事——试错、利弊和痛点。你已经看过典型的英雄故事。现在系紧你的腰带，给你的剑上油。准备亲身体验一个简单的乡村爱好者的史诗般的故事——以及他对合适主人的追求。</p><h1 id="066a" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">背景:想法和应用程序。</h1><p id="8605" class="pw-post-body-paragraph iy iz hu ja b jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv hn dt translated"><a class="ae li" href="https://tygertec.com/run-better-code/" rel="noopener ugc nofollow" target="_blank">我喜欢跑</a>。在准备下一场比赛时，我遵循了一个训练计划，但所有的训练计划都有一个共同点:它们为不同类型的跑步规定了不同的配速。例如，我被期望根据我是去“轻松”跑、“长距离”跑还是“长距离”跑来调整我的配速。但是什么是<em class="lj"/>是一次“轻松”的跑步？给我以分钟/英里为单位的数字——我怎么知道什么时候达到了目标？为了找到答案，我会根据一个跑步者最近的5000米比赛时间查阅配速表，并写下我为一次预定的跑步指定的配速。</p><p id="76c5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">手动在起搏图表中查找起搏既乏味又无聊。所以我写了一个app帮我做:<a class="ae li" href="https://www.runbypace.com/" rel="noopener ugc nofollow" target="_blank"> RunbyPace </a>。无论我在哪里，我都可以查找给定跑步类型的规定配速，并立即开始跑步。</p><p id="eee6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">但是我应该在哪里托管我的应用程序呢？我不想花太多钱。我为它做了每月5-10美元的预算。我的搜索始于数字海洋。</p><h1 id="79e8" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">数字海洋托管:节省(和斗争)是真实的。</h1><p id="8438" class="pw-post-body-paragraph iy iz hu ja b jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv hn dt translated">数字海洋是一个伟大的开始。他们的droplets预装了不同类型应用的必备工具。在我的例子中，我有一个rails应用程序，所以Ruby、Postgres、Bundler、Unicorn和Nginx都是预装的，可以在Rails上运行。我经历的最大的痛点围绕着更新——保持操作系统补丁，更新Ruby生态系统，以及推送应用程序本身的新版本。由于液滴的内存有限，这都是手工操作，非常困难。</p><h1 id="e047" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">数字海洋专业版</h1><ul class=""><li id="aaf3" class="lk ll hu ja b jb ld jf le jj lm jn ln jr lo jv lp lq lr ls dt translated">不贵，每月5美元。</li><li id="86e1" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated">容易上手。</li><li id="f6ae" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated">许多写得很好的指南。</li></ul><h1 id="b2c3" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">数字海洋公司</h1><ul class=""><li id="3082" class="lk ll hu ja b jb ld jf le jj lm jn ln jr lo jv lp lq lr ls dt translated">我不得不<strong class="ja hv">自己管理一切</strong>，包括Nginx、SSL/TLS证书，而不是开发新的应用功能。</li><li id="0609" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">手动更新</strong>。操作系统更新是一个手动过程。我配置了一个Cron作业来自动安装安全更新，这有点帮助，但仍然。</li><li id="894e" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated">Ruby生态系统的更新也是手动的。</li><li id="4a3d" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">手动展开</strong>。发布新版本的应用程序不是一键操作的事情。我不得不ssh到虚拟机，手动运行我的脚本。</li><li id="aa57" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">可用性。</strong>只有<em class="lj">一个</em>小滴，所以可用性一般。更新和新的应用程序版本意味着应用程序暂时离线。</li><li id="a42c" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">缩放。</strong>结垢的唯一可能性是垂直的，有更大的液滴。</li><li id="6154" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">限位闸板</strong>。基本的droplet只有512MB内存，只够基本操作使用。为了完成耙子任务，我必须杀死独角兽。</li><li id="6ac3" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">生产和开发之间的环境差异</strong>让我害怕对应用程序进行大的改动，因为我不确定它们是否能在生产中发挥作用。我经常推迟发布。</li></ul><p id="597d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">DigitalOcean让我前进，但发布新功能的痛苦让我想要更自动化、更强大的东西。我对尝试AWS产生了兴趣。</p><h1 id="94f8" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">用AWS托管:没有人会访问你的站点，但是每个人都可以——如果他们想的话。</h1><p id="8bc3" class="pw-post-body-paragraph iy iz hu ja b jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv hn dt translated">在我的数字海洋体验之后，我决定尝试一下AWS。我注册并获得了AWS免费层的资格，这意味着我可以以有限的成本享受一点乐趣——但只有一年。</p><h1 id="1eca" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">AWS的目标</h1><p id="127a" class="pw-post-body-paragraph iy iz hu ja b jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv hn dt translated">由于对DigitalOcean记忆犹新，以下是我对AWS的目标:</p><ul class=""><li id="e154" class="lk ll hu ja b jb jc jf jg jj ly jn lz jr ma jv lp lq lr ls dt translated">开发和生产环境之间的平衡。</li><li id="8d9b" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated">高可用性，即使在更新、发布和部署失败时也是如此。</li></ul><h1 id="5c89" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">AWS上的架构</h1><p id="d293" class="pw-post-body-paragraph iy iz hu ja b jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv hn dt translated">我全力投入AWS生态系统。我把我的runbypace.com域名转移到了AWS Route 53，并使用了他们的DNS基础设施。DNS将访问者导向弹性负载平衡器(ELB)，然后将访问者导向EC2实例，这些实例在弹性容器服务(ECS)之上运行Nginx和my Rails应用程序的dockerized版本。在后端，我们在AWS RDS上运行Postgres。AWS还为我办理了SSL证书。</p><pre class="mb mc md me fq mf mg mh mi aw mj dt"><span id="7de9" class="mk kg hu mg b fv ml mm l mn mo"># AWS architecture diagram </span><span id="adbf" class="mk kg hu mg b fv mp mm l mn mo">      Route 53 <br/>         |<br/>   Elastic Load Balancer<br/>      |          | <br/>   ec2/ecs    ec2/ecs<br/>   (nginx)    (nginx)<br/>   (rails)    (rails)<br/>        |      |<br/>       PostgreSQL</span></pre><h1 id="4d41" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">AWS优点</h1><ul class=""><li id="77a8" class="lk ll hu ja b jb ld jf le jj lm jn ln jr lo jv lp lq lr ls dt translated"><strong class="ja hv">成本</strong>。在免费层，整个强大的世界级架构每月仅花费我大约11美元。这主要是由于第二个t2.micro实例。</li><li id="11e6" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">轻松部署</strong>。一旦基础设施就绪，我编写了部署脚本，我就可以用一个命令部署新版本的应用程序。</li><li id="092f" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">通过容器进行开发/生产奇偶校验</strong>。在我的dev box上，我只需要运行<code class="eh mq mr ms mg b">docker compose up</code>并开始编写代码。因为应用程序是容器化的，所以我有信心，如果它能在我的机器上工作，它也能在云中工作。不过，正如你将在“缺点”一节中看到的那样，它并不是100%无缝的。Dockerfiles使得打包和部署我不想开源的资产和工件变得非常容易。</li><li id="1171" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">供货情况</strong>。我在AWS上运行网站的整个过程中，从未出现过一次宕机。当我推送一个新的应用程序版本时，ECS会处理停止一个web任务，以便为新注册的任务腾出空间。一旦新任务通过健康检查，ECS将停止其他web任务，并用新版本替换它们。整个过程天衣无缝。如果我做了一个愚蠢的举动，破坏了一些东西，新版本将无法通过健康检查，ECS将继续运行旧版本的网站。</li><li id="d711" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">更新管理少。如果你运行标准的AMIs(亚马逊机器镜像),他们会为你处理安全更新。</strong></li></ul><h1 id="12d0" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">AWS缺点</h1><ul class=""><li id="cd4a" class="lk ll hu ja b jb ld jf le jj lm jn ln jr lo jv lp lq lr ls dt translated"><strong class="ja hv">成本，后自由层。</strong>免费层到期后，我预计每月要为现有架构支付大约50到65美元。哎哟！对于一个只赚我0美元的业余爱好应用程序来说，这实在是太贵了。</li><li id="8b98" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated">AWS文档有点漫不经心</li><li id="a76f" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv"> ECS别扭</strong>。当时，Kubernetes还不在AWS上。ECS是唯一的选择。等等，你的意思是我必须管理我的容器<em class="lj">和运行它们的虚拟机</em>？我只想把我的容器推到云端。没有简单的方法来自动伸缩EC2实例以响应来自ECS容器的压力？—我必须手动增加EC2实例的数量？呃。因此，如果我遇到大流量高峰，我最好能访问AWS控制台。</li><li id="b4e4" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">仍然需要管理EC2实例。</strong>同样，为什么我必须管理EC2？为什么我在使用AMIs时必须手动更新ECS容器代理？</li><li id="ccc0" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">开发/生产之间的应用配置差异。</strong>对于本地开发，我将配置保存在<code class="eh mq mr ms mg b">docker-compose</code>使用的<code class="eh mq mr ms mg b">.env</code>文件中。对于生产，我将配置与ECS任务定义一起推送。当我添加或修改了一个<code class="eh mq mr ms mg b">.env</code>配置，但忘记更新任务定义时，麻烦就来了。如果我多考虑一下，我想我可以自动完成这个。</li></ul><p id="b783" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">AWS非常强大，但也不是没有痛苦，痛苦机器即将达到每月50美元以上！我研究了Elastic Beanstalk，它应该直接将代码部署到云中，而不需要管理EC2，但是它也很贵！成本大概和我以前的AWS架构一样。因此，我们继续寻找合适的主机提供商——这次是Heroku。</p><h1 id="ea5d" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">Heroku主持:到目前为止，一切顺利</h1><p id="2af0" class="pw-post-body-paragraph iy iz hu ja b jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv hn dt translated">我刚刚开始使用Heroku，所以我仍然处于蜜月期，但目前为止事情看起来很好。价格符合我的需求，部署也不在话下。</p><h1 id="6fe3" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">Heroku Pros</h1><ul class=""><li id="c02d" class="lk ll hu ja b jb ld jf le jj lm jn ln jr lo jv lp lq lr ls dt translated"><strong class="ja hv">价格。爱好dyno每月只需7美元。</strong></li><li id="c5b4" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated"><strong class="ja hv">可扩展性</strong>。显然，它既可以水平扩展(额外的dynos)，也可以垂直扩展(更强大的dynos)</li><li id="852e" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated">摔死<strong class="ja hv">简单自动展开</strong>。现在我所要做的就是推送到主机，Heroku就会自动部署到生产环境。</li><li id="6642" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated">通过<strong class="ja hv"> Heroku构建包</strong>构建配置。对于我的AWS设置，我使用Dockerfiles来调整我的构建设置。有了Heroku，我可以很容易地创建自己的构建包。对于一些例子，见一个构建包，用于<a class="ae li" href="https://github.com/tygerbytes/heroku-buildpack-commithash" rel="noopener ugc nofollow" target="_blank">将当前提交散列部署到任意路径</a>，另一个用于<a class="ae li" href="https://github.com/tygerbytes/heroku-buildpack-keybaseproof" rel="noopener ugc nofollow" target="_blank">将密钥库证明部署到任意目录</a>。</li><li id="7e7f" class="lk ll hu ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls dt translated">免费SSL证书</li></ul><h1 id="7e0e" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">Heroku Cons</h1><ul class=""><li id="c14f" class="lk ll hu ja b jb ld jf le jj lm jn ln jr lo jv lp lq lr ls dt translated">Google域的裸域上的<strong class="ja hv"> SSL证书问题。离开53号公路后，我带runbypace.com回到谷歌域名。对于我的自定义域名<code class="eh mq mr ms mg b">runbypace.com</code>，Heroku要求我用指向<code class="eh mq mr ms mg b">runbypace.herokudns.com</code>的<code class="eh mq mr ms mg b">ANAME</code>记录来配置我的DNS提供商。<em class="lj">不幸的是</em> Google Domains不支持<code class="eh mq mr ms mg b">ANAME</code>记录……_ Google Domains的解决方法是创建一个指向<code class="eh mq mr ms mg b">www.runbypace.herokudns.com</code>的<code class="eh mq mr ms mg b">CNAME</code>，然后创建一个合成记录将<code class="eh mq mr ms mg b">@</code>重定向到<code class="eh mq mr ms mg b">www</code>。<em class="lj">不幸的是</em>，这在SSL证书的某个地方发生了故障，导致<code class="eh mq mr ms mg b">https://runbypace.com</code>拥有无效的证书，尽管<code class="eh mq mr ms mg b">https://www.runbypace.com</code>工作正常。这是一个很大的遗憾，所以我现在改用PointDNS，因为它支持<code class="eh mq mr ms mg b">ANAME</code>记录。</strong></li></ul><p id="8a21" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">随着我在Heroku获得更多的生活经验，我会报告新的发现。</p><h1 id="f7d2" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">我的托管任务暂时告一段落</h1><p id="1447" class="pw-post-body-paragraph iy iz hu ja b jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv hn dt translated">旅伴们，在寻找最佳主机提供商的过程中，我们又迎来了一个喘息的机会。我们见过DigitalOcean，它不贵，但把安装和配置的负担留给了你。然后就是主持界的希尔顿，AWS。如果您需要巨大的可伸缩性和数十亿个9的可用性，它是您唯一的选择之一。如果你只是想做梦和部署代码，Heroku似乎是最合适的，现在…一路平安，编码愉快！</p><p id="49ca" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><em class="lj">原载于2018年1月27日</em><a class="ae li" href="https://tygertec.com/hosting-digitalocean-aws-heroku/" rel="noopener ugc nofollow" target="_blank"><em class="lj">tygertec.com</em></a><em class="lj">。</em></p></div></div>    
</body>
</html>