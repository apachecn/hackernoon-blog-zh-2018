<html>
<head>
<title>Angular Providers: How to inject 3rd party library?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular Providers:如何注入第三方库？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/angular-providers-how-to-inject-3rd-party-library-af4a78722864?source=collection_archive---------8-----------------------#2018-01-29">https://medium.com/hackernoon/angular-providers-how-to-inject-3rd-party-library-af4a78722864?source=collection_archive---------8-----------------------#2018-01-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/29a3110b644ba5ef29015c23b985b4d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n8mj2Fg2YghPt9Y3_twqtQ.png"/></div></div></figure><p id="efe6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">本文将描述使用一些没有Angular <a class="ae ka" href="https://hackernoon.com/tagged/integration" rel="noopener ugc nofollow" target="_blank">集成</a>的库的常见场景。例如，我将使用<a class="ae ka" href="https://github.com/jjt/hashwords" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> HashWords </strong> </a>库，它将散列字符串转换为人类可读的随机单词。如果你懒得看一篇文章，可以查看<a class="ae ka" href="https://github.com/kobvel/ng-providers-common/tree/3rd-party-lib-injection" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> Github repo </strong> </a>的代码示例。</p><p id="c749" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过运行<code class="eh kb kc kd ke b">$ npm install --save hashwords</code>安装库</p><p id="7f7e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将其导入到。angular-cli.json :</p><p id="a6ba" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kb kc kd ke b"><em class="kf">“scripts”</em>: [“../node_modules/hashwords/dist/hashwords.min.js”]</code></p><p id="c320" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过最后一个动作，我们使它在<strong class="je hv">窗口</strong>对象上可用。</p><p id="25d1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们可以在<code class="eh kb kc kd ke b">NgModule</code>的<strong class="je hv">提供商</strong>属性中注册它</p><pre class="kg kh ki kj fq kk ke kl km aw kn dt"><span id="2f76" class="ko kp hu ke b fv kq kr l ks kt">providers: [<br/>    { provide: 'Hashwords', useValue: window['hashwords']() }<br/>]</span></pre><blockquote class="ku kv kw"><p id="2fa4" class="jc jd kf je b jf jg jh ji jj jk jl jm kx jo jp jq ky js jt ju kz jw jx jy jz hn dt translated"><strong class="je hv"> <em class="hu">提供</em> </strong> <em class="hu">应用程序用</em> <strong class="je hv"> <em class="hu">值</em> </strong> <em class="hu"> </em> <code class="eh kb kc kd ke b"><em class="hu">window['hashwords']()</em></code> <em class="hu">对任何注入调用</em><strong class="je hv"><em class="hu">hash words</em></strong><em class="hu">！</em></p></blockquote><p id="f029" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下一步是将这个新创建的值注入到<code class="eh kb kc kd ke b">app.component.ts</code>的构造函数中</p><figure class="kg kh ki kj fq iv"><div class="bz el l di"><div class="la lb l"/></div><figcaption class="lc ld fg fe ff le lf bd b be z ek"><strong class="ak">Hashwords</strong> injection</figcaption></figure><p id="9fb3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用<code class="eh kb kc kd ke b">@Inject({ token: any })</code>装饰器，我们可以手动注入注册的依赖项。当<code class="eh kb kc kd ke b">@<a class="ae ka" href="https://angular.io/api/core/Inject" rel="noopener ugc nofollow" target="_blank">Inject</a>()</code>不存在时，<code class="eh kb kc kd ke b"><a class="ae ka" href="https://angular.io/api/core/Injector" rel="noopener ugc nofollow" target="_blank">Injector</a></code>将使用参数的类型注释。这就是我们使用<code class="eh kb kc kd ke b">constructor(apiService: ApiService)</code>的应用中实际发生的情况。</p><h1 id="7b09" class="lg kp hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">用InjectionToken改进示例</h1><p id="780a" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">前面的例子是完全可行的。但是我们错过了Angular + <a class="ae ka" href="https://hackernoon.com/tagged/typescript" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>应用程序的出色特性——<strong class="je hv">type check</strong>！当然，并不是你需要的每个库都有现成的类型定义。但是通过<strong class="je hv"> InjectionToken </strong>机制，我们可以为我们的第三方库定义一些基本接口，并为我们的应用程序提供我们将要使用的属性和方法的知识。</p><h2 id="e19c" class="ko kp hu bd lh mi mj mk ll ml mm mn lp jn mo mp lt jr mq mr lx jv ms mt mb mu dt translated">#1创建新文件，该文件将包含我们第三方提供商的配置</h2><figure class="kg kh ki kj fq iv"><div class="bz el l di"><div class="la lb l"/></div><figcaption class="lc ld fg fe ff le lf bd b be z ek">libs.providers.ts</figcaption></figure><ul class=""><li id="a219" class="mv mw hu je b jf jg jj jk jn mx jr my jv mz jz na nb nc nd dt translated">LOC 3–8:用我们将在应用程序中使用的方法和属性描述我们库的接口；</li><li id="7aaf" class="mv mw hu je b jf ne jj nf jn ng jr nh jv ni jz na nb nc nd dt translated">LOC 10:创建一个定制的<strong class="je hv"> InjectionToken </strong>,带有我们之前创建的通用类型的接口；</li><li id="38f7" class="mv mw hu je b jf ne jj nf jn ng jr nh jv ni jz na nb nc nd dt translated">LOC 11:创建一个ValueProvider对象，这样我们可以在<strong class="je hv"> NgModule </strong>中注册它</li></ul><h2 id="3ecd" class="ko kp hu bd lh mi mj mk ll ml mm mn lp jn mo mp lt jr mq mr lx jv ms mt mb mu dt translated">#2注册新创建的价值提供商</h2><figure class="kg kh ki kj fq iv"><div class="bz el l di"><div class="la lb l"/></div><figcaption class="lc ld fg fe ff le lf bd b be z ek">LOC 12: Adding <strong class="ak">HashwordsProvider</strong> to providers array</figcaption></figure><h2 id="1eef" class="ko kp hu bd lh mi mj mk ll ml mm mn lp jn mo mp lt jr mq mr lx jv ms mt mb mu dt translated">#3用组件中定义的接口类型注入我们的依赖</h2><figure class="kg kh ki kj fq iv"><div class="bz el l di"><div class="la lb l"/></div></figure><p id="793d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">LOC 3:从<code class="eh kb kc kd ke b">libs.providers.ts</code>导入所需的依赖项；</p><p id="da81" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">LOC 12:现在我们可以注入<code class="eh kb kc kd ke b">Hashword</code> <strong class="je hv"> InjectionToken，</strong>并为hashwords变量定义一个类型，它将是interface—<code class="eh kb kc kd ke b">IHashwords</code>；</p><p id="277c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">LOC 15，16:在这个动作之后，我们可以使用智能感知的<code class="eh kb kc kd ke b">hashwords</code>方法！</p><h1 id="84fa" class="lg kp hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">结论</h1><p id="1ea5" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">通过在Angular应用中注册<strong class="je hv">提供者</strong>的灵活机制，我们可以轻松地包装第三方库，并在应用中使用它们，就像它们是<strong class="je hv"> Angular库一样。</strong></p><p id="b210" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有了注入令牌机制，我们甚至可以<strong class="je hv">定义自定义类型</strong>，让我们的应用程序知道一个导入库的API！</p><blockquote class="ku kv kw"><p id="67dd" class="jc jd kf je b jf jg jh ji jj jk jl jm kx jo jp jq ky js jt ju kz jw jx jy jz hn dt translated"><em class="hu">如果你想从马嘴中直接得到一个信息，请跟我上</em><a class="ae ka" href="https://twitter.com/Kobvel" rel="noopener ugc nofollow" target="_blank"><strong class="je hv"><em class="hu">Twitter</em></strong></a><strong class="je hv"><em class="hu"/></strong><em class="hu"/><a class="ae ka" rel="noopener" href="/@kobvel"><strong class="je hv"><em class="hu">Medium</em></strong></a><em class="hu">账号！</em></p></blockquote><figure class="kg kh ki kj fq iv"><div class="bz el l di"><div class="nj lb l"/></div></figure></div></div>    
</body>
</html>