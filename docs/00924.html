<html>
<head>
<title>A C++ Hello World And The Rose Gold Walled Garden Of Doom</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个C++ Hello World和玫瑰金围墙的毁灭花园</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-c-hello-world-and-the-rose-gold-walled-garden-of-doom-4ac3c92385ed?source=collection_archive---------12-----------------------#2018-01-29">https://medium.com/hackernoon/a-c-hello-world-and-the-rose-gold-walled-garden-of-doom-4ac3c92385ed?source=collection_archive---------12-----------------------#2018-01-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4cd0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我的交叉编译系列文章的第3部分。你可以先看看第一部分和第二部分！</p><div class="jp jq fm fo jr js"><a href="https://hackernoon.com/a-c-hello-world-and-a-glass-of-wine-oh-my-263434c0b8ad" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">一个C++ Hello World和一杯葡萄酒，天啊！</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">其中我们尝试在Linux上使用Microsoft Visual C++编译器</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">hackernoon.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg kh js"/></div></div></a></div><div class="jp jq fm fo jr js"><a href="https://hackernoon.com/a-c-hello-world-and-the-cute-heartless-rainbow-3cc9695f4142" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">一个C++ Hello World和可爱无情的彩虹</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">其中我们用几个外来的工具链和rainbow的能力交叉编译了Windows的Qt应用程序。</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">hackernoon.com</p></div></div><div class="kb l"><div class="ki l kd ke kf kb kg kh js"/></div></div></a></div><figure class="kk kl km kn fq ko fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/223cdbc1ee54daba7488ebd5ad5c027c.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*MQojHnf60qojhdjPSz5Feg.png"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">© <a class="ae ku" href="https://linuxnewbieguide.org" rel="noopener ugc nofollow" target="_blank">https://linuxnewbieguide.org</a></figcaption></figure><p id="6e80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你不能一边迎合Windows和Linux用户的需求，一边忽视第三个主要的，实际上是第二个，桌面操作系统。</p><p id="a141" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我所说的操作系统当然是由一家公司开发和商业化的，该公司最出名的是给世界带来Clang的公司，主要负责维护WebKit(在大多数行业转向Chromium之后)，并创建了一些其他令人惊叹的开源软件，如CUPS。</p><p id="70ed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此我们应该心存感激。</p><p id="9cc0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可能会认为，一家公司不辞辛苦地启动一个全新的编译器来提供更好的用户体验，会使交叉编译到他们的平台变得容易。</p><p id="cbda" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而。</p><p id="59ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那家公司就是苹果。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="4c9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">像在Linux和Windows上一样，我们将需要获取和设置3个部分。一个编译器，一些系统头文件和库，比如<code class="eh lc ld le lf b">libc++</code>和一个用于桌面集成的Sdk。</p><p id="7446" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你以前做过OS X开发，你就会知道XCode中提供了所有这些功能，这是一个5GB的捆绑工具包，其中大部分我们都不需要。</p><p id="607e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">XCode是自由软件。比如啤酒。我们需要很多。然而XCode是专有的，这很好。</p><p id="2e96" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">问题是，如果你阅读XCode 附带的<a class="ae ku" href="https://www.apple.com/legal/sla/docs/xcode.pdf" rel="noopener ugc nofollow" target="_blank">条款和条件，你会发现以下条款。</a></p><blockquote class="lg lh li"><p id="4c12" class="ir is lj it b iu iv iw ix iy iz ja jb lk jd je jf ll jh ji jj lm jl jm jn jo hn dt translated"><strong class="it hv"> 2.7限制条件；无其他许可用途</strong>本协议中规定的授权不允许您，并且您同意不在任何非苹果品牌的计算机或设备上安装、使用或运行苹果软件或苹果服务，或者允许他人这样做。</p></blockquote><p id="2328" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我不是律师。然而，在我看来，苹果正在积极禁止使用他们的库进行交叉编译，不管技术上是否可行。</p><p id="5170" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">因此，本文其余部分讨论的一些想法，如果被应用，可能会使你与苹果达成的任何协议无效。</strong></p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="8ef0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你需要一个苹果ID，所以你需要在apple.com上创建一个账户。我不记得有过比这更糟糕的账户创建经历了。最大的问题当然是他们过时的安全政策。</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div class="fe ff ln"><img src="../Images/f16aaff96050b6f2ccd612dbafa94795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*N0jVAJ-usiFac8Pb78xt4w.png"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">How not to do account creation and security, courtesy of Apple.</figcaption></figure><p id="aa0e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后他们会给你发一封电子邮件进行核实，这太好了。但是你得到的不是邮件中的链接，而是一个你甚至不能粘贴的代码，你必须手动输入。</p><p id="b1a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后您将搜索XCode。幸运的是，自2012年以来，一些好心人在Stackoverflow上维护<a class="ae ku" href="https://stackoverflow.com/a/10335943" rel="noopener ugc nofollow" target="_blank">有效下载链接</a>。</p><p id="96fe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这又变成了“所有软件都很糟糕”的咆哮。对不起</p><p id="5e05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从更积极的方面来说，有人已经建立了一个很好的脚本集合，让您开始在Unix上构建一个OsX工具链。也和Cygwin一起工作！</p><p id="0a46" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您需要克隆它。</p><div class="jp jq fm fo jr js"><a href="https://github.com/cor3ntin/osxcross/" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">cor3ntin/osxcross</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">用于Linux *、BSD和Windows的osxcross - OS X交叉工具链(Cygwin)</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">github.com</p></div></div><div class="kb l"><div class="lo l kd ke kf kb kg kh js"/></div></div></a></div><p id="1a20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是托马斯·普希特拉格作品中的一把叉子，我必须把它修补一下。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="dd04" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">XCode 7.3是作为DMG发布的，虽然这是一种特定于osx的文件格式，但osxcross附带了一个脚本来提取它，很好地利用了<strong class="it hv"> Darling </strong>。稍后会详细介绍。</p><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="d176" class="lt lu hu lf b fv lv lw l lx ly">osxcross/tools/gen_sdk_package.sh Xcode_xxx.dmg</span></pre><p id="842a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不幸的是，开源社区仍然在等待苹果发布一个支持TBD文件v2的ld64链接器，该链接器在osx的更高版本中使用，而不必发布。sdk里的dylib。</p><p id="5a3a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">TBD文件非常酷，它们是动态库中包含的符号的YAML表示，减轻了运送实际库的需要。它们在概念上非常类似于MSVC在构建DLL时生成的<code class="eh lc ld le lf b">.lib</code>文件。我认为TBD文件可以跨平台使用，但是现在LLVM还不能处理它们？)而且开源的ld64处理不了新版本。</p><p id="3d48" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以我们必须坚持使用10.11版本的SDK。很合理！我不厌其烦地支持用于打包XCode更高版本的<code class="eh lc ld le lf b">xip</code>文件。这是一种受babushka玩偶启发的格式，但使用的是压缩档案。不幸的是，我们不能使用比XCode 7.3更新的版本。希望很快改变！</p><p id="9488" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后你可以运行移动生成的<code class="eh lc ld le lf b">MacOSX10.11.sdk.tar.xz</code>到<code class="eh lc ld le lf b">osxcross/tarballs</code>然后启动<code class="eh lc ld le lf b">SDK_VERSION=10.11 ./osxcross/build.sh</code></p><p id="8e03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您还需要运行<code class="eh lc ld le lf b">osxcross/build_llvm_dsymutil.sh</code></p><p id="1f9a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很快，你将拥有一个完整的OSX工具链，包括<code class="eh lc ld le lf b">i386</code>和<code class="eh lc ld le lf b">x86_64</code>(即使当你瞄准OSX时，你完全没有理由用32位构建任何东西)。</p><p id="91b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它甚至建立了我个人的最爱:<code class="eh lc ld le lf b">otool</code>和<code class="eh lc ld le lf b">install_name_tool</code>。如果你曾经在OSX建造过什么东西，你就会知道这些工具有多可怕。或者说OSX装载机有多可怕。</p><p id="cb9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我对进入<strong class="it hv"> osxcross </strong>的工作印象深刻。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="d148" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">配置QBS相当简单，尽管有一些事情需要注意。</p><p id="02d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<code class="eh lc ld le lf b">osxcross/target/bin</code>中，运行:</p><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="4410" class="lt lu hu lf b fv lv lw l lx ly">ln -s x86_64-apple-darwin15-ld ld<br/>cp osxcross-llvm-dsymutil x86_64-apple-darwin15-dsymutil</span></pre><p id="3d7f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将有助于clang找到合适的工具。如果你想支持多个工具链，把<code class="eh lc ld le lf b">ld</code>放在一个子文件夹中</p><p id="4fc6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我的配置文件，你可以适应</p><figure class="kk kl km kn fq ko"><div class="bz el l di"><div class="lz ma l"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Clearly not designed for manual modifications</figcaption></figure><p id="5147" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lc ld le lf b">-prefix</code>选项告诉clang在哪里可以找到合适的<code class="eh lc ld le lf b">ld</code> (ld64)，因为系统链接器不适合链接Mach-O应用程序。</p><p id="8948" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">剩下的只是给qbs适当的搜索路径。</p><p id="5580" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不幸的是，支持。qbs中的plist是不可移植的，所以您会遇到错误</p><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="3479" class="lt lu hu lf b fv lv lw l lx ly">ERROR: TypeError: Result of expression 'PropertyList' [[object Object]] is not a constructor.<br/>         at JavaScriptCommand.sourceCode<br/>         at Rule.prepare in /opt/qtcreator/share/qbs/modules/cpp/DarwinGCC.qbs:262:18</span></pre><p id="b1cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注释掉DarwinGCC.qbs中的规则以修复该问题。</p><p id="d0d4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当然，不能创建<code class="eh lc ld le lf b">info.plist</code>文件将是非常有限的，如果QBS能以平台无关的方式处理这些文件就太好了。</p><p id="fc57" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">目前，在我们所有的。qbs项目文件，我们将使用以下内容来禁用绑定，从而禁用Info.plist生成</p><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="c7e0" class="lt lu hu lf b fv lv lw l lx ly">Depends {<br/>    name: "bundle"<br/>}<br/>bundle.isBundle: false</span></pre><p id="b98d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这一点上，我们能够建立一个简单的控制台Hello World，见第一部分<a class="ae ku" rel="noopener" href="/@corentin.jabot/a-c-hello-world-and-a-glass-of-wine-oh-my-263434c0b8ad"/></p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff mb"><img src="../Images/2392590d7878afe326ce621b68ddaef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gn3Ckk68e7zFRLS0o4MQVQ.png"/></div></div></figure><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="cf04" class="lt lu hu lf b fv lv lw l lx ly"># file helloworld<br/>Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|WEAK_DEFINES|BINDS_TO_WEAK|PIE&gt;</span></pre><p id="1aca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是它能跑吗？</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><h2 id="193a" class="lt lu hu bd mg mh mi mj mk ml mm mn mo jc mp mq mr jg ms mt mu jk mv mw mx my dt translated">哦，亲爱的！</h2><p id="6e0f" class="pw-post-body-paragraph ir is hu it b iu mz iw ix iy na ja jb jc nb je jf jg nc ji jj jk nd jm jn jo hn dt translated">为了运行我们的windows应用程序，我们使用wine。这是一项相当近期的努力——它始于2012年，而葡萄酒始于1993年；Windows 3.1刚刚发布！—提供一个翻译层，叫做<strong class="it hv"> <em class="lj"> darling。这个项目远未成熟，似乎也没有任何形式的资金支持。我希望它会流行起来。</em></strong></p><div class="jp jq fm fo jr js"><a href="https://darlinghq.org/" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">darling | Linux的macOS转换层</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">Linux的Darling - macOS转换层</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">darlinghq.org</p></div></div><div class="kb l"><div class="ne l kd ke kf kb kg kh js"/></div></div></a></div><p id="acff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果按照github 上的说明操作，你可以克隆并构建darling。在我的机器上，整个过程用了不到一个小时。一旦安装，大约800MB。这并不奇怪，因为它是一个完整的系统，带有所有常用的工具，包括g++、ruby、python、Perl、git、bash、swift、ssh…</p><p id="4034" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，构建完成，没有错误，令人惊讶的是，它的工作，似乎非常被动。比葡萄酒更现代，它是集装箱化的！</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff nf"><img src="../Images/e77f959f44b656a1f835915b0c2f47e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*suKeIMzBppaO5urBAuF3ew.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Oh, Hi Mac</figcaption></figure><h2 id="1133" class="lt lu hu bd mg mh mi mj mk ml mm mn mo jc mp mq mr jg ms mt mu jk mv mw mx my dt translated">用binfmt增加魔力</h2><p id="864f" class="pw-post-body-paragraph ir is hu it b iu mz iw ix iy na ja jb jc nb je jf jg nc ji jj jk nd jm jn jo hn dt translated">所以现在我们可以运行mac命令，但是如果我们可以隐藏魔法呢？</p><p id="25b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用一个<a class="ae ku" href="https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html" rel="noopener ugc nofollow" target="_blank">内核工具</a>和一个<a class="ae ku" href="https://www.freedesktop.org/software/systemd/man/binfmt.d.html" rel="noopener ugc nofollow" target="_blank"> systemd服务</a>，我能够创建一个文件<code class="eh lc ld le lf b">/etc/binfmt.d/darling.conf</code>，以便内核能够处理Mach-O文件的启动。</p><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="c8c5" class="lt lu hu lf b fv lv lw l lx ly">:Mach-O 64b:M::\xcf\xfa\xed\xfe::/usr/bin/darling_interpreter:<br/>:Mach-O 32b:M::\xce\xfa\xed\xfe::/usr/bin/darling_interpreter:<br/>:Mach-O FAT:M::\xca\xfe\xba\xbe::/usr/bin/darling_interpreter:</span></pre><p id="34bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">/usr/bin/darling_interpreter是一个启动<em class="lj"> darling shell </em>的脚本——应该是可执行的。</p><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="3c28" class="lt lu hu lf b fv lv lw l lx ly">#!/bin/bash<br/>/usr/local/bin/darling shell "$1"</span></pre><p id="0b21" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">darling文档建议<code class="eh lc ld le lf b">darling &lt;binary&gt;</code>应该可以工作，但是它不能。</p><p id="3ea2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重启binfmt服务(<code class="eh lc ld le lf b">systemctl restart systemd-binfmt</code>)后，我们能够透明地启动OSX应用程序。</p><p id="65e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着我们可以做到</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff ng"><img src="../Images/d656d1f4ccd541e83a147feb19bedc0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNLXvhVChYk8jCXEX_tlkA.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Any sufficiently advanced technology is indistinguishable from magic</figcaption></figure><p id="a148" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哦，顺便说一下，你可以对windows可执行文件和WINE做同样的事情。一些发行版开箱即用。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="93ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第2部分中，我试图在Linux上安装Qt框架的win32版本，而不使用windows。我失败了。</p><h2 id="26a1" class="lt lu hu bd mg mh mi mj mk ml mm mn mo jc mp mq mr jg ms mt mu jk mv mw mx my dt translated">我们能在没有mac的情况下获得Qt for mac吗？</h2><p id="3665" class="pw-post-body-paragraph ir is hu it b iu mz iw ix iy na ja jb jc nb je jf jg nc ji jj jk nd jm jn jo hn dt translated">我下载了安装程序。这是一个. dmg。这将是一个问题，但<a class="ae ku" href="https://github.com/darlinghq/darling-dmg" rel="noopener ugc nofollow" target="_blank">凭借darling的力量</a>我们可以在Linux上挂载dmg。完全没问题。这是我们在这里做的事情。</p><p id="b4dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是安装Qt安装程序dmg会发现它包含一个二进制文件和一个<code class="eh lc ld le lf b">.dat</code>文件，而不是一个简单的文件夹或一些可管理的东西。</p><p id="ea9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">据推测，二进制文件就是安装程序。也许它运行在亲爱的？没有。对OpenGL框架的硬依赖。</p><p id="69c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">打包在蹩脚的无用软件包中的优秀软件似乎是一个反复出现的主题。</p><p id="e7b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是不是所有的希望都再次落空了？这次不会。</p><p id="0d8b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以为mac构建Qt，就像我们为Windows所做的尝试一样。但是会有用的。麦克有<code class="eh lc ld le lf b">make</code>。它知道clang和gcc，在很多方面都很像Linux。毕竟下面有一个UNIX(但我总觉得OSX内部很糟糕，隐藏在漂亮的用户界面下。对于starter来说，<a class="ae ku" href="https://robservatory.com/behind-os-xs-modern-face-lies-an-aging-collection-of-unix-tools/" rel="noopener ugc nofollow" target="_blank">10年前上游版本搬到GPLv3 </a>后，大量工具没有维护。</p><p id="8ada" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">唉，这意味着要处理Qt复杂的构建系统。破解<code class="eh lc ld le lf b">qmake</code>构建文件花了一些时间。看，Qt做了一个可怕的假设，认为osx上的所有工具链都包含xcode。我们没有xcode。</p><p id="f091" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是一旦你绕过所有的自动探测和关于系统上安装了什么的假设…</p><p id="d49a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">….你可以让它工作！</p><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="0edc" class="lt lu hu lf b fv lv lw l lx ly">#configure -release -opensource -confirm-license -xplatform macx-cross-clang -skip qtwebengine -nomake examples -nomake tests    -prefix /home/cor3ntin/dev/cross-compilers/osx/qt5_10</span></pre><figure class="kk kl km kn fq ko"><div class="bz el l di"><div class="lz ma l"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Output of configure. I removed some irrelevant lines.</figcaption></figure><p id="93f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这还不是路的尽头。由于缺少依赖项，Qt小部件构建失败。QtLocation构建失败，因为libc++头文件太旧或损坏(我通过在OSX SDK中复制最新的libc++版本修复了这个问题。成功了)。然后QtLocation抱怨因为<code class="eh lc ld le lf b">std::auto_ptr</code>没有定义所以我黑了几个头。</p><p id="357c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我试图让<code class="eh lc ld le lf b">qwebengine</code> (chromium)来构建，但是它仍然使用另一个构建系统，我一晚上已经做了足够多的构建系统黑客工作。</p><p id="45ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但最终大多数Qt都建成了。</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff nh"><img src="../Images/15aadb2cc8369357459447d607f26b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dAkSjuQcOvUjOJvLXoonmQ.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">It took me a few hours but I got Qt !</figcaption></figure><p id="c07c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们现在看到的是非常有趣的东西。二进制文件是原生的Linux ELF，而框架和库是Macho-O。这很快就能派上用场。</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff ni"><img src="../Images/00ec34e2ba036da2023b12a6e09d6b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zk2hm9b7COXzVReuMjp8vg.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Hello, I’m a Mac — And I’m a PC. And I am a Mac too. — What ?</figcaption></figure><p id="6020" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就操作系统集成而言，Qt是一款充分利用底层系统功能的大型软件。如果我们能造出那样的东西，我们几乎可以造出任何东西。</p><p id="0f33" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最初将我的mkspec文件命名为<code class="eh lc ld le lf b">darling-clang</code>。我是个坏名声。这也使得qbs无法理解这是一个mac版本。我没有重命名mkspec并重新构建Qt，而是修改了qbs。<code class="eh lc ld le lf b">qbs-setup-qt</code>的代码实际上是用正则表达式解析mkspec的<code class="eh lc ld le lf b">.conf</code>文件。不知何故，它起作用了。别对着它呼吸。</p><p id="e256" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最终，一旦我给了qbs它所期望的东西，让它明白我们在和mac打交道，我就可以跟注了</p><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="1417" class="lt lu hu lf b fv lv lw l lx ly">qbs-setup-qt osx/qt5_10/bin/qmake osx-x64-qt510</span></pre><p id="0d74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它创建了正确的概要文件和模块。我手动清理了我的档案，合并了<code class="eh lc ld le lf b">clang-osx</code>和<code class="eh lc ld le lf b">osx-x64-qt510</code></p><p id="bcdb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我们就可以编译或者华丽的<strong class="it hv"><em class="lj">Hello World</em></strong>app了！</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff nj"><img src="../Images/23e078484bdf934c56ff406782eb5a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tn9Qx7yNliDAMRNRtr22Fw.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Compiling an OSX application based on Qt on Linux, using qbs : check</figcaption></figure><p id="1c3b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在怎么办？</p><p id="65d5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">嗯，我们有一个完整的工具链，也许我们可以检查一些东西？</p><p id="b96a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<code class="eh lc ld le lf b">otool -L</code>，osx中相当于<code class="eh lc ld le lf b">ldd</code>的东西，我们可以断言我们确实链接到了一些库</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff nk"><img src="../Images/5b676db6f3b43f8ceb8d3630e4e6b29e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzAw8ry7-fg1nXSwZNH2cQ.png"/></div></div></figure><p id="847a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以使用其他工具。比如<code class="eh lc ld le lf b">nm</code>或者<code class="eh lc ld le lf b">strings</code>或者可怕的<code class="eh lc ld le lf b">install_name_tool</code></p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="bedd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不幸的是，达林还不能处理任何远程图形，所以我们需要一台Mac来启动我们的应用程序。</p><p id="22d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一台真正的mac想象麦克·OSX是违法的，除非是在苹果电脑上。想起了一些词。想象一下我的法语。</p><p id="6687" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">再来说说mac。<em class="lj">Mac。你可能知道那一个。大部分公司都有。</em></p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff nl"><img src="../Images/2d0418878e2fd5a63d70241304a84055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EI7a9DGmUvtstV6c1YqkTw.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">This Is A True Story.</figcaption></figure><p id="497c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它曾经属于鲍勃。这是鲍勃的苹果电脑。但是，5年前，鲍勃去世了，所以他的Mac被送给了爱丽丝。爱丽丝很快就离开了公司——可能纯属巧合。</p><p id="36cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，苹果电脑一直都是苹果电脑。它没有主人。它也没有木偶。可以在<code class="eh lc ld le lf b">ssh bob@mac.yourcompany.com</code>连接。密码简单来说就是<code class="eh lc ld le lf b">pass</code>。它与其他运行在虚拟机上的服务器不在同一个局域网中。无论如何，它都没有被管理，在一个安全严密的网络中提供了一个方便的后门。</p><p id="4128" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当它运行时。有时一停就是几天。这不仅仅是因为人们不关心，他们也不知道它的物理位置。mac mini很容易松脱。在某人的书桌下，楔入一把旧椅子，用作茶几。</p><p id="2e4f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上次它坠毁的时候，你不得不连续三天追踪它，就像在山里追一只大猫一样。你甚至试图打电话给鲍勃的遗孀。</p><p id="e944" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你终于发现了夹在卡罗尔的屏幕和牛津词典之间的苹果电脑。“这是完美的高度！”当你拿回卡罗尔800美元的显示器支架时，她反对道。你用苹果电脑<em class="lj">换了一本旧的宜家目录，卡罗尔发现这本书甚至比苹果迷你电脑还实用。</em></p><p id="69e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你插上mac电脑的电源，努力将它升级到OSX的最新版本“美洲狮”(或者别的什么，很难记清)。</p><p id="14c8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">几天后，当你的同事买了一辆新车，而你失去了自己的家时，我不禁在想:要求用信用卡来申请免费的安全补丁合适吗？</p><p id="0244" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但事实是，mac正在做一项重要的工作。运行所有只能在<em class="lj">MAC</em>上运行的任务。签安装程序，做mac包，iOS的东西，跑纽交所……你不太确定，毕竟是Bob的。</p><p id="d1cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们能够虚拟化OSX，或许生活会有所不同。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="f306" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我正好有一台2011款mac-mini，是前雇主送的。它的生活和苹果电脑有点不同。它从未被爱过，在盒子里度过了最后两年。为了这篇文章的需要，它只能看到一天的生活。这也是我的出版计划晚了4天的原因。我试着安装高灰色屏幕；我不得不重新格式化，安装狮子，然后安装埃尔船长。所以埃尔上尉是我们将要使用的。它拥有惊人的2GB内存，系统只使用了其中的3/4。</p><p id="092b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您应该在mac的系统参数中启用VNC、远程共享和SSH。</p><p id="e851" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这篇文章开始有点长了。这里是迄今为止所取得的成果的一个快速的视觉总结:</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff nm"><img src="../Images/bc1ebc30dca2e037d38067ad700568ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7CT7_Xu6EMy1_NPsFx-JcQ.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Definitively improving our productivity.</figcaption></figure><p id="7603" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们应该停止鬼混。</p><ul class=""><li id="c975" class="nn no hu it b iu iv iy iz jc np jg nq jk nr jo ns nt nu nv dt translated">在OSX机器上复制你的OSX版Qt。你可以使用<code class="eh lc ld le lf b">scp -r</code>、<code class="eh lc ld le lf b">rsync</code>或者一个共享文件夹(通过samba)</li><li id="1f26" class="nn no hu it b iu nw iy nx jc ny jg nz jk oa jo ns nt nu nv dt translated">再次使用<code class="eh lc ld le lf b">scp -r</code>，将你的<code class="eh lc ld le lf b">helloworld-gui</code>复制到机器上。</li><li id="4258" class="nn no hu it b iu nw iy nx jc ny jg nz jk oa jo ns nt nu nv dt translated">我们交叉编译的Qt版本不包含<code class="eh lc ld le lf b">macdeployqt</code>。你可以直接在mac上安装正式版的Qt。为了避免这样做，也为了不必处理<a class="ae ku" href="http://doc.qt.io/qt-5/osx-deployment.html" rel="noopener ugc nofollow" target="_blank">中的</a> <code class="eh lc ld le lf b"><a class="ae ku" href="http://doc.qt.io/qt-5/osx-deployment.html" rel="noopener ugc nofollow" target="_blank">install_name_tool</a></code>的混乱，我们可以设置<code class="eh lc ld le lf b">DYLD_FALLBACK_FRAMEWORK_PATH</code>指向包含所有<code class="eh lc ld le lf b">Qt*.framework</code>的文件夹。DYLD_FALLBACK_FRAMEWORK_PATH在某种程度上是合理的，但可能不起作用，并且有一些相关的安全风险。请不要在已发布的应用中使用它。</li></ul><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="c221" class="lt lu hu lf b fv lv lw l lx ly">export DYLD_FALLBACK_FRAMEWORK_PATH=/Users/cor3ntin/dev/cross-compilation/qt5_10/lib</span></pre><ul class=""><li id="ade5" class="nn no hu it b iu iv iy iz jc np jg nq jk nr jo ns nt nu nv dt translated">像在windows上一样，我们需要在我们的<code class="eh lc ld le lf b">helloworld-gui</code>旁边提供一个<code class="eh lc ld le lf b">qt.conf</code>文件，告诉Qt从哪里加载插件(否则应用程序将无法运行)。我的看起来像那样</li></ul><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="7982" class="lt lu hu lf b fv lv lw l lx ly">[Paths]<br/>Prefix=/Users/cor3ntin/dev/cross-compilation/qt5_10/<br/>Plugins=plugins</span></pre><p id="5af9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，通过<code class="eh lc ld le lf b">ssh</code>连接到mac，您可以执行您的应用程序，它将出现在mac屏幕和远程显示/ VNC会话上</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff ob"><img src="../Images/083f1a4d0ee8fcad44ab707d48fc5c93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkJ8vOuh1zRdE_e2M4vkOw.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">It feels like we climbed a mountain !</figcaption></figure></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><h1 id="4b31" class="oc lu hu bd mg od oe of mk og oh oi mo oj ok ol mr om on oo mu op oq or mx os dt translated">我们能让这一切合法化吗？</h1><p id="7dbb" class="pw-post-body-paragraph ir is hu it b iu mz iw ix iy na ja jb jc nb je jf jg nc ji jj jk nd jm jn jo hn dt translated">Clang、LLVM、ld64和相关工具都是开源项目。这并不意味着开源版本与苹果正在使用的版本相匹配。</p><p id="226e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">事实上，苹果的Clang是Clang proper的修改版本，他们落后上游几个版本。讽刺的是他们启动了这个项目。</p><p id="1229" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">LD64和“cctools”是在“苹果开源许可”下发布的，XCode使用的工具版本也比开源社区使用的版本提前了2年。</p><p id="5759" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">框架本身不是开源的，正如我在开始提到的，不是可再发行的。</p><p id="0b81" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">而现在只由<code class="eh lc ld le lf b">Darling</code>人维护的开源替代方案<code class="eh lc ld le lf b">cocotron</code>是不够的。</p><p id="a6f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它有几个问题</p><ul class=""><li id="2df7" class="nn no hu it b iu iv iy iz jc np jg nq jk nr jo ns nt nu nv dt translated">他们没有构建脚本来实际构建SDK，只安装了<code class="eh lc ld le lf b">.dylib</code>。这个问题可能很容易解决。</li><li id="d7ee" class="nn no hu it b iu nw iy nx jc ny jg nz jk oa jo ns nt nu nv dt translated">他们有一套有限的框架，而这套框架不足以构建Qt。Qt使用下面的框架，那些前缀为<code class="eh lc ld le lf b">!!!!</code>的在Darling中是没有的</li></ul><pre class="kk kl km kn fq lp lf lq lr aw ls dt"><span id="952b" class="lt lu hu lf b fv lv lw l lx ly">* AppKit<br/>* ApplicationServices<br/>!!!! AssetsLibrary<br/>* AudioToolbox<br/>!!!! AudioUnit<br/>!!!! AVFoundation<br/>!!!! Carbon<br/>* Cocoa<br/>!!!! CoreAudio<br/>!!!! CoreBluetooth<br/>* CoreFoundation<br/>* CoreGraphics<br/>!!!! CoreLocation<br/>!!!! CoreMedia<br/>!!!! CoreMotion<br/>* CoreServices<br/>* CoreText<br/>* CoreVideo<br/>!!!! fftreal<br/>* Foundation<br/>* ImageIO<br/>!!!! IOBluetooth<br/>* IOKit<br/>!!!! OpenCL<br/>* QuartzCore<br/>* Security<br/>!!!! SystemConfiguration</span></pre><ul class=""><li id="f52d" class="nn no hu it b iu iv iy iz jc np jg nq jk nr jo ns nt nu nv dt translated">你可以在OSX上编译Qt框架，然后把它们复制到你的Linux机器上，这在大多数情况下都是可行的。</li><li id="2b17" class="nn no hu it b iu nw iy nx jc ny jg nz jk oa jo ns nt nu nv dt translated">利用一个不是官方SDK的SDK有点违背了交叉编译在mac上测试你的软件的目的。你只是在测试它对亲爱的起作用。不能保证Darling SDK头与官方的一致。Mingw也受到这个问题的困扰。</li></ul></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="9238" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，在Linux上为Mac交叉编译复杂的应用程序(包括Qt和基于Qt的应用程序)在技术上是可能的。甚至可以直接无缝地运行非图形应用程序和单元测试。</p><p id="13f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是使用SDK是非法的，根据你的法律，这让整个练习变得有点无意义。存在开源替代方案，但可能不够充分和可靠。</p><p id="b272" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然我们可以满怀希望，但苹果是否会有更多对开发者友好的政策值得怀疑。</p><p id="97e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在那可怕的失望中，是时候结束了！</p></div></div>    
</body>
</html>