<html>
<head>
<title>Harnessing Lightning For Instant Bitcoin Transacting — A Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用闪电进行即时比特币交易——教程</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/harnessing-lightning-for-instant-bitcoin-transacting-a-tutorial-3b9dcdc00552?source=collection_archive---------10-----------------------#2018-02-01">https://medium.com/hackernoon/harnessing-lightning-for-instant-bitcoin-transacting-a-tutorial-3b9dcdc00552?source=collection_archive---------10-----------------------#2018-02-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="adb7" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">快速文本+视频教程</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff jj"><img src="../Images/2f15d4369395309e1012b0d594874b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*zOJIHXTK_2YcJzjue5oSOg.jpeg"/></div><figcaption class="jr js fg fe ff jt ju bd b be z ek">Instawin when you play this card!</figcaption></figure></div><div class="ab cl jv jw hc jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hn ho hp hq hr"><p id="b377" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><strong class="ke hv">更新:我收到了来自社区的一些非常感谢的反馈，以便在帖子中更突出地强调这一重要信息:</strong></p><p id="fd85" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">在开始之前，请注意这个软件是实验性的，可能包含导致资金损失的错误。只使用你能承受损失的少量比特币。 </p></div><div class="ab cl jv jw hc jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hn ho hp hq hr"><p id="1997" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">比特币是一种分散的点对点支付网络，全球各地都在使用它进行无信任交易。该系统通过要求矿工将交易包含在以密码方式相互链接的块中，来实现无信任交易。然而，这意味着交易确认需要时间，并不是每个人都有时间。这种不便的答案是支付渠道，中本聪将其描述为实现渠道合作伙伴之间“高频交易”的一种方式，而不是等待大约10分钟的确认。<a class="ae kz" href="https://blockstream.com/2017/05/11/lightning-on-litecoin.html" rel="noopener ugc nofollow" target="_blank"> Lightning采用了这一理念，并大规模部署。</a>除了只能向您的渠道合作伙伴付款，<a class="ae kz" href="https://blockstream.com/2017/12/06/lightning-spec-electrifies-bitcoin-with-release-candidate.html" rel="noopener ugc nofollow" target="_blank">您还可以立即向闪电网络上的任何人付款，闪电网络是一个支付渠道网络。</a></p><p id="f5bc" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">近日，<a class="ae kz" href="https://blockstream.com/2018/01/16/lightning-charge.html" rel="noopener ugc nofollow" target="_blank"> Blockstream发布了一个名为Blockstream Store的电商购物页面，该页面使用了他们新发布的Wordpress电商插件，该插件使用Lightning Charge构建。</a>最令人兴奋的是，你只能在比特币的mainnet上用闪电网络支付<em class="ky">在<a class="ae kz" href="https://store.blockstream.com/" rel="noopener ugc nofollow" target="_blank"> Blockstream商店</a>上购买东西。</em>这是一个关于如何使用<code class="eh la lb lc ld b">c-lightning</code>(block stream的Lightning实现)设置自己的Lightning节点来购买物品或接收Lightning付款的教程。</p><h2 id="2d28" class="le lf hu bd lg lh li lj lk ll lm ln lo kl lp lq lr kp ls lt lu kt lv lw lx ly dt translated">必备条件:</h2><ul class=""><li id="5743" class="lz ma hu ke b kf mb ki mc kl md kp me kt mf kx mg mh mi mj dt translated">Linux(本指南使用的是Ubuntu 17.10)</li><li id="2ae5" class="lz ma hu ke b kf mk ki ml kl mm kp mn kt mo kx mg mh mi mj dt translated">比特币区块链的充足存储空间</li><li id="b494" class="lz ma hu ke b kf mk ki ml kl mm kp mn kt mo kx mg mh mi mj dt translated">初级到中级命令行知识</li><li id="2373" class="lz ma hu ke b kf mk ki ml kl mm kp mn kt mo kx mg mh mi mj dt translated">与SegWit完全同步的比特币节点</li><li id="933f" class="lz ma hu ke b kf mk ki ml kl mm kp mn kt mo kx mg mh mi mj dt translated">一些比特币</li></ul><h1 id="0ac3" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">步骤0:安装构建工具和依赖项</h1><p id="6713" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">我们的第一步是通过<code class="eh la lb lc ld b">apt</code>安装所需的工具:</p><p id="efcc" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">sudo apt-get install -y autoconf automake build-essential git libtool libgmp-dev libsqlite3-dev python python3 net-tools tmux</code></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div><figcaption class="jr js fg fe ff jt ju bd b be z ek">installing what we need to build lightningd</figcaption></figure><h1 id="6b03" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">步骤1:从比特币PPA安装bitcoind</h1><p id="900b" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">要么从源代码构建<code class="eh la lb lc ld b">bitcoind</code>，从<a class="ae kz" href="https://bitcoin.org/en/" rel="noopener ugc nofollow" target="_blank">bitcoin.org</a>下载并验证二进制文件(首选方法)，要么从比特币PPA安装:</p><p id="6e4a" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">sudo apt-get install software-properties-common<br/>sudo add-apt-repository ppa:bitcoin/bitcoin<br/>sudo apt-get update<br/>sudo apt-get install -y bitcoind</code></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div><figcaption class="jr js fg fe ff jt ju bd b be z ek">installing bitcoind from the bitcoin ubuntu PPA</figcaption></figure><h1 id="64d5" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">步骤2:克隆lightningd存储库并构建:</h1><p id="6d84" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">现在获取<code class="eh la lb lc ld b">c-lightning</code>代码，然后构建它:</p><p id="5039" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">mkdir builds &amp;&amp; cd builds</code></p><p id="95e5" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">git clone https://github.com/ElementsProject/lightning.git</code></p><p id="b295" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">cd lightning</code></p><p id="e9e4" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">make</code></p><p id="9cf0" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><em class="ky">使用</em> <code class="eh la lb lc ld b"><em class="ky">make -jn</em></code> <em class="ky">加速编译。</em> <code class="eh la lb lc ld b"><em class="ky">n</em></code> <em class="ky">为专用于构建的线程数。示例:</em> <code class="eh la lb lc ld b"><em class="ky">make -j10</em></code> <em class="ky">针对10个或更多线程的处理器(如至强)。</em></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div><figcaption class="jr js fg fe ff jt ju bd b be z ek">building lightningd</figcaption></figure><h1 id="99f3" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">步骤3:运行bitcoind、lightningd和lightning-cli来确认安装是否正确</h1><p id="cc44" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">启动<code class="eh la lb lc ld b">bitcoind</code>，然后<code class="eh la lb lc ld b">lightningd</code>，然后<code class="eh la lb lc ld b">lightning-cli</code>以确认一切安装正确:</p><p id="b7e9" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><em class="ky">通过使用</em> <code class="eh la lb lc ld b"><em class="ky">tmux</em></code> <em class="ky">使这个过程更干净，以保持一个终端中的一切整洁:</em></p><p id="bd05" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">tmux</code></p><p id="b025" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><em class="ky">启动</em> <code class="eh la lb lc ld b"><em class="ky">bitcoind</em></code> <em class="ky">，从日志中观察其启动，然后用</em> <code class="eh la lb lc ld b"><em class="ky">bitcoin-cli</em></code> <em class="ky"> : </em>进行测试</p><p id="1521" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">bitcoind</code></p><p id="933a" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">tail -f ~/.bitcoin/debug.log</code></p><p id="28a4" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">bitcoin-cli -getinfo</code></p><p id="0373" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><em class="ky">同样，启动</em> <code class="eh la lb lc ld b"><em class="ky">lightningd</em></code> <em class="ky">，用</em> <code class="eh la lb lc ld b"><em class="ky">lightning-cli</em></code> <em class="ky"> : </em>测试</p><p id="8a21" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">./lightningd/lightningd --network bitcoin --log-level debug</code></p><p id="2ec4" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">./cli/lightning-cli help</code></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div><figcaption class="jr js fg fe ff jt ju bd b be z ek">running bitcoind, then lightningd, then finally lightning-cli</figcaption></figure><h1 id="cfa7" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">步骤4:连接到远程lightning对等机</h1><p id="e806" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">在<code class="eh la lb lc ld b">lightningd</code>和<code class="eh la lb lc ld b">lightning-cli</code>成功建立后，连接到对等机并同步通道图。使用的对等体是块流的:</p><pre class="jk jl jm jn fq nf ld ng nh aw ni dt"><span id="8346" class="le lf hu ld b fv nj nk l nl nm">./cli/lightning-cli connect 02f6725f9c1c40333b67faea92fd211c183050f28df32cac3f9d69685fe9665432 104.198.32.198 9735</span></pre><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div></figure><p id="2926" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">图形自动同步(<code class="eh la lb lc ld b">lightningd</code>日志输出) :</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div></figure><h1 id="e600" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">第5步:创建一个地址，以打开一个渠道:</h1><p id="6149" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">开通闪电支付通道需要有资金支持的UTXO。用<code class="eh la lb lc ld b">lightning-cli</code>生成一个比特币地址，向其发送一些比特币。</p><p id="6df1" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">./cli/lightning-cli newaddr</code></p><p id="66fe" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">向该地址发送一些比特币，<em class="ky">但要注意这是实验性软件。</em></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div></figure><h1 id="76e0" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">第六步:确认我们收到了BTC</h1><p id="cf55" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">使用<code class="eh la lb lc ld b">lightning-cli</code>检查地址是否有资金:</p><p id="8d76" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">./cli/lightning-cli listfunds</code></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div></figure><h1 id="6fb6" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">步骤7:打开与我们之前连接的对等体的通道</h1><p id="64c8" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">要打开支付通道，找到节点的公钥或id(在本例中是Blockstream的),然后使用<code class="eh la lb lc ld b">lightning-cli</code>开始打开通道:</p><p id="84bd" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><em class="ky">打印对等节点id: </em></p><p id="67df" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">./cli/lightning-cli listpeers</code></p><p id="130d" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><em class="ky">复制id并用一些satoshis资助频道:</em></p><pre class="jk jl jm jn fq nf ld ng nh aw ni dt"><span id="f49d" class="le lf hu ld b fv nj nk l nl nm">./cli/lightning-cli fundchann<!-- -->el 02f6725f9c1c40333b67faea92fd211c183050f28df32cac3f9d69685fe9665432 amount_in_satoshis</span></pre><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div></figure><h1 id="5cb3" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">步骤8:监控资金交易确认的lightningd日志:</h1><p id="8049" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">或者，使用<code class="eh la lb lc ld b">tmux</code>切换回<code class="eh la lb lc ld b">lightningd</code>窗口，观察您的融资交易是否被确认:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div></figure><h1 id="5d26" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">步骤9:确认我们已经打开了一个渠道:</h1><p id="ef31" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">开通通道需要三次确认。一旦资金交易有三个确认，使用<code class="eh la lb lc ld b">lightning-cli</code>列出我们的新支付渠道。</p><p id="ed0b" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">./cli/lightning-cli listchannels | grep your_nodes_pubkey</code></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div></figure><h1 id="7305" class="mp lf hu bd lg mq mr ms lk mt mu mv lo ja mw jb lr jd mx je lu jg my jh lx mz dt translated">恭喜你。您已经开通了您的第一个闪电网络支付通道！</h1><p id="bcc0" class="pw-post-body-paragraph kc kd hu ke b kf mb iv kh ki mc iy kk kl na kn ko kp nb kr ks kt nc kv kw kx hn dt translated">您现在可以向他人开具发票以获得即时付款，也可以支付他人寄给您的发票！</p><p id="33b8" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">./cli/lightning-cli invoice amount_in_millisatoshis label description</code></p><p id="ce1b" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">或者</p><p id="4c06" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">./cli/lightning-cli pay <a class="ae kz" href="https://github.com/lightningnetwork/lightning-rfc/blob/master/11-payment-encoding.md" rel="noopener ugc nofollow" target="_blank">bolt11_string</a></code></p><p id="d8c4" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><code class="eh la lb lc ld b">c-lightning</code>的安装文档可以在<a class="ae kz" href="https://github.com/ElementsProject/lightning" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae kz" href="https://github.com/ElementsProject/lightning/blob/master/doc/INSTALL.md" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="eb06" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">感谢阅读！</p><p id="b0e0" class="pw-post-body-paragraph kc kd hu ke b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">-格鲁布斯</p></div></div>    
</body>
</html>