<html>
<head>
<title>Converting Multi-page Layouts To Clean SPAs with JavaScript and JQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript和JQuery将多页面布局转换为干净的SPAs</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/converting-multi-page-layouts-to-clean-spas-with-javascript-and-jquery-415bfe2d37a7?source=collection_archive---------13-----------------------#2018-02-01">https://medium.com/hackernoon/converting-multi-page-layouts-to-clean-spas-with-javascript-and-jquery-415bfe2d37a7?source=collection_archive---------13-----------------------#2018-02-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/ee9b9bc4de7c154080e53a3bc583c9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*citDe-UZmEbFrwH_5QLsgg.png"/></div></div></figure><div class=""/><p id="02f5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我从一个简单的场景开始。在下面的例子中，我们有一个用户Bill，他想访问我们的图书数据库。他搜寻1985年以来的书籍。我们进行API调用，并将结果传递给页面。这里的主要问题是，一旦检索到数据，我们应该如何显示它？</p><figure class="kb kc kd ke fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ka"><img src="../Images/6dc3875338a907f28a3d6c54435c3c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U52aKaO0cGrSvPS6bHX5oQ.png"/></div></div></figure><p id="3f13" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面是一个非常典型的显示数据的布局。数据加载后，顶部的搜索栏和搜索栏下方的结果。然而，这产生了一个小问题，滚动。现在，我们要求用户滚动浏览如此多的数据来找到他们想要的东西。也许比尔不介意。但是假设他在搜索一本1985年的不知名的书。如果他看到标题，也许他会认出来，但是他必须一路滚动到底部，然后翻到第2页，第3页，第4页才能找到。我们要求Bill做的事情可能是这样的:</p><figure class="kb kc kd ke fq hw fe ff paragraph-image"><div class="fe ff kf"><img src="../Images/ab96440bdf4e2b2e0b3721af6e6911a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*ZtZqELXOyydCTIQaKJZH8Q.png"/></div></figure><p id="6480" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，平心而论，这是非常典型的，因此，作为用户，我们已经从许多网站中期待这一点，所以普通用户可能不会介意。但是，为了公平起见，让我们使用JavaScript和JQuery为Bill创建一个更优雅的单页设计。我喜欢先说出我的想法，所以我的想法是这样的:</p><figure class="kb kc kd ke fq hw fe ff paragraph-image"><div class="fe ff kf"><img src="../Images/a82d861f2f647474dfb5628c187798c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*fZ_1nfKoD6tOUzm4ohQlrw.png"/></div></figure><p id="1fb9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这个粗糙的例子中，我们已经完全清理了场地，并留下了大量的呼吸空间和负空间，我相信比尔会喜欢的。我们已经创建了一个侧面板，所有的控制将。用户将在这里搜索，并在同一个面板中看到结果。在我们的简单例子中，我们甚至不需要显示每本书的所有数据。我们可以简单地显示每本书的标题。然后，当点击它时，完整的概要、图像和信息将出现在主要内容区域。</p><p id="96c1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这种情况下，数据并不重要。这可能是玩具飞机，书籍，电子游戏，或公主娃娃。无论哪种情况，对我个人来说，我更喜欢简单、干净的单页设计。</p><h1 id="935e" class="kg kh if bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">第一步:HTML</h1><p id="6f5c" class="pw-post-body-paragraph jc jd if je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">HTML可能非常简单。</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="fc50" class="lo kh if lk b fv lp lq l lr ls">&lt;body&gt;<br/>    &lt;div id="sidepanel" class="sidepanel"&gt;<br/>&lt;input id="input" placeholder="what do you want?" /&gt;<br/>&lt;button type="submit" id="submitBtn"&gt;Go&lt;/button&gt;</span><span id="97de" class="lo kh if lk b fv lt lq l lr ls">&lt;div id="dynamicSideContent"&gt;</span><span id="f902" class="lo kh if lk b fv lt lq l lr ls">//--Content goes here--//<br/>&lt;/div&gt;</span><span id="a2ab" class="lo kh if lk b fv lt lq l lr ls">&lt;/div&gt;<br/>&lt;div id="content" class="content"&gt;</span><span id="8edb" class="lo kh if lk b fv lt lq l lr ls">//--Content goes here--//</span><span id="d556" class="lo kh if lk b fv lt lq l lr ls">&lt;/div&gt;</span><span id="1d7c" class="lo kh if lk b fv lt lq l lr ls">&lt;/body&gt;</span></pre><p id="0fe8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">根据不同的场景，这确实是我们所需要的。是的，最终我们会用一个横幅、一个标志和所有真实网站通常有的东西来美化它。但是最终，由于我们所有的数据都是动态生成的，这就是我们所需要的。</p><p id="8fa2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们有:</p><h2 id="04fd" class="lo kh if bd ki lu lv lw km lx ly lz kq jn ma mb ku jr mc md ky jv me mf lc mg dt translated">a)侧板</h2><blockquote class="mh mi mj"><p id="ab00" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated">1)搜索栏</p><p id="3f22" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated">2)内容加载区</p></blockquote><h2 id="3dd5" class="lo kh if bd ki lu lv lw km lx ly lz kq jn ma mb ku jr mc md ky jv me mf lc mg dt translated">b)内容部门</h2><blockquote class="mh mi mj"><p id="19cf" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated">1)内容加载区</p></blockquote><h1 id="3f12" class="kg kh if bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">步骤2:进行API调用</h1><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="56d3" class="lo kh if lk b fv lp lq l lr ls"><br/>    $(window).load(function() {<br/>      console.log("talking");</span><span id="2974" class="lo kh if lk b fv lt lq l lr ls">fetch('<a class="ae mo" href="https://api.mlab.com/api/1/databases/presentation-maker/collections/ldsScriptures?&amp;l=41994&amp;apiKey=T_4ma8aw6AyAhVzAcfzCpxEKDJqxffrn').then(function(response)" rel="noopener ugc nofollow" target="_blank">myApi_URL_thingy').then(function(response)</a> {<br/>          if (response.status != 200) {<br/>            window.alert("Oopsie Daisy");<br/>            return;<br/>          }</span><span id="f612" class="lo kh if lk b fv lt lq l lr ls">response.json().then(function(data) {<br/>            </span></pre><h1 id="bd9f" class="kg kh if bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">第三步:解析数据</h1><p id="afd6" class="pw-post-body-paragraph jc jd if je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">我们现在有了某种形式的数据。我们在这里的最终目标，是得到一些书名，或任何东西，显示在我们的侧面板。在这样做时，我们可能会面临几个问题:</p><h2 id="fb59" class="lo kh if bd ki lu lv lw km lx ly lz kq jn ma mb ku jr mc md ky jv me mf lc mg dt translated">问题:</h2><p id="a8ce" class="pw-post-body-paragraph jc jd if je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">每个按钮对应于我们数据中的一本书。每个按钮里面都有一个书名。我们不想使用链接，因为它会将我们导航到一个新的页面。相反，我们希望将它显示在右侧的内容区域。如果我们使用链接，我们可以简单地将链接存储在数据文件中。当用户点击一个链接时，我们将提取那段数据，访问url并重定向用户。但是我们不想那样做。为了解决这个问题，我们需要动态地为每个按钮创建id，然后在按钮id中存储关于每本书的数据，以便我们可以在内容区域访问和显示它。我们可以在解析数据时使用for循环来实现这一点。</p><p id="6b48" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在下面的例子中，我将使用我们的用户Bill按作者而不是日期搜索的场景，因为这样更有趣。</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="7294" class="lo kh if lk b fv lp lq l lr ls">let input = document.getElementById('input');<br/>            let submit = document.getElementById('submitBtn');<br/>            submit.onclick = searchData;</span><span id="74e6" class="lo kh if lk b fv lt lq l lr ls">function searchData () {<br/>              let currentBook = [];<br/>              let input = document.getElementById('input');<br/>              for (var i = 0; i &lt; books.length; i++) {<br/>                let val3 = input.value;<br/>                let val2 = val3.toLowerCase();<br/>                let value = val2.replace(/ /g, '');<br/>                let text3 = books[i].author;<br/>                let text2 = text3.toLowerCase();<br/>                let text = text2.replace(/ /g, '');<br/>                console.log(text.indexOf(value) &gt;= 0);<br/>                console.log(text);<br/>                console.log(value);<br/>                if (text.indexOf(value) &gt;= 0) {<br/>                  currentBook.push([books[i], i]);<br/>                }</span><span id="87e6" class="lo kh if lk b fv lt lq l lr ls">}</span></pre><p id="794c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我在这里所做的，是试着去想一个用户可能会做什么。比尔可能想要一本劳拉·英格拉姆博士的书。但是，可怜的比尔，他的记忆正在衰退……他所能记得的只有“劳拉”。因此，他通过在输入中提交“Laura”来搜索作者。上面所做的，是将输入转换成小写，然后删除输入中的任何空格。然后对于当前的API条目，我对作者做同样的事情。这样，如果Bill搜索“Laura ”,实际作者被列为“dr . Laura Ingram ”, JavaScript实际上是在比较这两个字符串:</p><p id="e495" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">“劳拉”和“劳拉博士”。</p><p id="c6e4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果我们没有这样做，那就是比较:</p><p id="2889" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从“劳拉”到“劳拉·英格拉姆博士”，</p><p id="497e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用大写字母和额外的空格来匹配结果可能会更困难。我们想比较苹果和苹果，而不是苹果和橘子。现在我们有两个相似的字符串，我们这样做:</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="7a14" class="lo kh if lk b fv lp lq l lr ls">if (text.indexOf(value) &gt;= 0) {<br/>                  currentBook.push([books[i], i]);<br/>                }</span></pre><p id="4adb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们有了这两个字符串，我们要做的是查看当前可迭代的图书作者是否包含用户输入的子字符串。因为“dr.lauraingram”确实有子字符串“laura ”,所以它会匹配。现在，再一次，这可能会产生一系列我们必须解决的其他问题，比如很多结果不是比尔想要的，但我们不要忘记，是比尔的错，是他的记忆问题让我们陷入了这场混乱！继续前进…</p><p id="5661" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">无论如何，在这一点上，我们应该有Bill正在搜索的书，我们正在显示它，并且在侧栏中显示任何其他匹配。但是请记住，我们希望以某种方式将书的内容放在按钮Id中。</p><p id="ed31" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们刚刚将所有匹配的书籍推送到一个名为currentAuthor的数组中。让我们用一个for循环来分析这个数组，并使用反勾号来创建按钮。然后我们将使用模板表达式将ID插入到按钮中。</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="f73d" class="lo kh if lk b fv lp lq l lr ls">for (var i = 0; i &lt; currentBook.length; i++) {<br/>                currentBook[i] = `<br/>         &lt;button id="id_${currentBook[i][1]}" class="btn7"&gt;<br/>           ${currentBook[i][0].author}-${currentBook[i][0].title}<br/>         &lt;/button&gt;<br/>                `;<br/>                document.getElementById('dynamicSideContent').innerHTML += currentQuote[i];<br/>              }<br/>            }</span></pre><p id="8584" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以，我在这里所做的是循环通过当前的书。然后，对于数组中的每个条目，我用一个模板表达式给它赋一个新值。模板表达式只包含一个带有ID的按钮、一个类和按钮内的文本:</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="f285" class="lo kh if lk b fv lp lq l lr ls">&lt;button id="id_${currentBook[i][1]}" class="btn7"&gt;<br/>  ${currentBook[i][0].author}-${currentBook[i][0].title}<br/>&lt;/button&gt;</span></pre><p id="3dae" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，如果你注意到了，当我循环遍历我的初始book数组时，我将匹配的books“books[I]”，但是我也将迭代号“I”，都推到了一个数组中。因为每个迭代编号都是唯一的，所以我可以把它作为我的按钮ID的一部分，我就是这样做的。模板表达式中定义的按钮是:</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="434a" class="lo kh if lk b fv lp lq l lr ls">id_${currentBook[i][1]}</span></pre><p id="08b8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是，这意味着每个图书ID实际上将是“id_1”、“ID _ 2”…等等。</p><p id="5d23" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">还有一点需要指出的是，班级是“btn7”。因为我们不能在JavaScript中访问这些ID，所以我们实际上将首先使用JQuery来访问该类，然后在访问该类之后获取ID。我们将简单地在每次点击按钮时都这样做。</p><p id="8a82" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">伪代码应该是，“如果一个btn7类的按钮被点击，做一些事情”。</p><p id="c9ba" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在JQuery的帮助下，我们可以这样写:</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="6e15" class="lo kh if lk b fv lp lq l lr ls">$(document).on('click', '.btn7', function () {<br/>              let currentBook = [];<br/>              let id = this.id;<br/>              let currentId = id.split("_");<br/>              let idNumber = parseInt(currentId[1]);<br/>              let disregard = parseInt(currentId[0]);<br/>              for (var i = 0; i &lt; books.length; i++) {<br/>                if(i == idNumber ) {<br/>                  currentBook.push(books[i]);<br/>                }<br/>              }</span></pre><p id="0c8b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我在这里所做的就是。我们监听任何点击“btn7”类按钮的时间。我们知道button有一个id，所以我们用“this.id”访问它，并将它赋给一个名为“ID”的变量。然后，我们拆分ID字符串:</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="5ead" class="lo kh if lk b fv lp lq l lr ls">let currentId = id.split("_");</span></pre><p id="11d8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的id都是以“Id”开头，后面跟着下划线，然后是数字。string.split()会把它变成一个数组，我们现在不需要id，或者下划线…我们只需要数字。我们通过将currentID变量转换成一个数字来得到它</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="3064" class="lo kh if lk b fv lp lq l lr ls">let idNumber = parseInt(currentId[1]);</span></pre><p id="b578" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，在我们的for循环中，我们查看idNumber是否匹配当前图书的迭代。如果有匹配的，那就是我们想要的。</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="daf8" class="lo kh if lk b fv lp lq l lr ls">for (var i = 0; i &lt; books.length; i++) {<br/>                if(i == idNumber ) {<br/>                  currentBook.push(books[i]);<br/>                }</span></pre><p id="f89f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当我们最初搜索数组时，我们保存了那个索引值，然后我们再次使用它来确保我们匹配用户点击的动态按钮。</p><p id="9542" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在Bill点击了他想要的东西，我们需要在我们的内容区域显示它。我们将使用之前创建的相同的模板表达式格式，并将其发送到HTML。</p><pre class="kb kc kd ke fq lj lk ll lm aw ln dt"><span id="b17b" class="lo kh if lk b fv lp lq l lr ls">for (var i = 0; i &lt; currentBook.length; i++) {<br/>                currentBook[i] = `<br/>                &lt;span class="container"&gt;<br/>                &lt;h1 class="bookTitle"&gt;${currentBook[i].author} - ${currentBook[i].title}&lt;/h1&gt;<br/>                &lt;p class="synopsis"&gt;${currentBook[i].text}&lt;/p&gt;<br/>                &lt;/span&gt;<br/>                `<br/>              document.getElementById('content').innerHTML += currentBook[i];<br/>              }</span></pre><p id="6f53" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此时，我们只是用for循环解析刚刚创建的数组。除非我们还需要对这些数据做些什么，否则我们不需要再次创建ID，但是如果需要的话，我们可以再次这样做。在这里，我们只需点击一下按钮，将匹配的书籍放到主显示屏上。</p><p id="c7a5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">同样，有很多很多方法可以做到这一点，可能有很多比我的方法更好更简单，但我认为这至少是朝着正确方向迈出的一步。如果你有任何反馈，请告诉我。谢谢！</p></div></div>    
</body>
</html>