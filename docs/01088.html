<html>
<head>
<title>Informative Alerts with Serverless Slack Unfurling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器松弛展开的信息警报</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/informative-alerts-with-serverless-slack-unfurling-acb6457e3a59?source=collection_archive---------14-----------------------#2018-02-02">https://medium.com/hackernoon/informative-alerts-with-serverless-slack-unfurling-acb6457e3a59?source=collection_archive---------14-----------------------#2018-02-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="edfe" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">了解如何使用Node.js、Serverless.js和AWS Lambda将重要信息附加到松弛消息中</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/cc1e9c347ef82eab1d26b038937a01d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ykhC6uHPcdKhX1ZDYcncQ.png"/></div></div></figure><p id="5c57" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">当你复制和粘贴一个链接时,会显示大量的细节。继续粘贴<a class="ae kr" href="https://engineering.opsgenie.com/4-advantages-of-using-java-with-aws-lambda-21c0dc539de3" rel="noopener ugc nofollow" target="_blank">一个来自媒体</a>的链接。您会看到类似这样的内容:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ks"><img src="../Images/5c7eeea02271440e0f1c19247cbc2a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M_YyzQwc-ESWAaNUbo82cw.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Slack attaches details to your messages. This is called unfurling.</figcaption></figure><p id="32cd" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">这在Slack中被称为“链接展开”。对于一些消息，Slack会自动完成这项工作(经典的展开)，并附上一些非常漂亮的细节，比如“阅读时间”。好消息是，你也可以这样做你的链接！当您需要更多信息或需要从需要用户批准/身份验证的受保护源中检索数据时，这尤其有用。在这种情况下，您需要稍微动手，构建自己的Slack应用程序。</p><p id="d114" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">在这篇博客文章中，您将通过一个真实的例子一步一步地学习如何构建自己的Slack展开应用程序。当您共享OpsGenie警报的链接时，我们会将详细信息附加到您的OpsGenie警报中。</p><p id="40ab" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">对于那些不熟悉的人来说，<a class="ae kr" href="https://www.opsgenie.com/?utm_source=medium&amp;utm_medium=hackernoon" rel="noopener ugc nofollow" target="_blank"> OpsGenie </a>是一款面向DevOps和ITOps团队的事件和随叫随到管理解决方案。我们将在这个例子中使用OpsGenie，因为我们有使用它的集成和API的经验。我们还认为，当您复制和粘贴链接时，查看警报详细信息非常有用，可以减少应用程序之间的上下文切换。</p><h2 id="7e00" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">设置您的环境</h2><p id="42de" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">在我们深入开发细节之前，让我们先准备好您的开发环境。首先，您需要AWS、Slack和OpsGenie帐户来运行这个项目。</p><p id="d467" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我们为这个项目选择了无服务器(AWS Lambda)计算服务，因为它的价格是按触发付费的，我们不需要关心维护。对于这种可能有少量请求的应用程序来说，这很有意义。</p><p id="e9e5" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我们将使用Lambda，AWS的API网关服务，Node.js作为语言，Serverless.js用于部署项目。</p><p id="39c6" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我将跳过npm和Node.js安装。你可以谷歌一下——:D，不要忘记安装Node.js v6.10或更高版本，因为这是我们将在AWS Lambda中使用的版本，因为它是最新支持的版本。要安装Serverless.js，请运行:</p><pre class="jk jl jm jn fq lx ly lz ma aw mb dt"><span id="1647" class="kx ky hu ly b fv mc md l me mf">npm install -g serverless</span></pre><h2 id="b428" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">松弛展开流是如何工作的？</h2><p id="9761" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">当我们完成了初始设置，是时候了解这个项目的流程了。通过跟踪图上的数字，您可以了解我们的应用程序流程是如何工作的。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mg"><img src="../Images/94b3b35fe9aa8073014c52842ba8fd2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRcHUbu2cuxk3zwLJnA2Fw.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Application flow</figcaption></figure><p id="dd6c" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">这里一个重要的细节是Slack的Events API。我们使用这个API在发生新消息或向消息添加pin等事件时得到通知。</p><h2 id="d37b" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">创建您的Slack应用程序</h2><p id="e1d7" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">现在，是时候深入研究Slack应用程序部分了。我们将建立一个内部的松散集成。内部集成就像常规的Slack应用程序一样，只是它们只能安装在你的工作空间中；因此，您不需要实现<a class="ae kr" href="https://api.slack.com/docs/slack-button" rel="noopener ugc nofollow" target="_blank"> OAuth认证流程</a>。这更容易，更适合我们的用例。</p><p id="012b" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">首先进入https://api.slack.com/apps<a class="ae kr" href="https://api.slack.com/apps" rel="noopener ugc nofollow" target="_blank">的</a>链接，点击“<em class="mh">创建新应用</em>按钮。然后，您将为您的应用程序命名，并选择您希望应用程序存在的工作区。不要担心，您可以稍后更改这些细节。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mi"><img src="../Images/c49c073205561a246d2fe607a486744c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9PDs-HvgL9iGlDrKNHT_uA.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Create your new Slack app!</figcaption></figure><p id="98b2" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">目前就这些，一旦我们将功能部署到AWS，我们将再次访问这个页面。</p><h2 id="60f9" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">从OpsGenie获取API密钥</h2><p id="43d6" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated"><a class="ae kr" href="https://app.opsgenie.com/customer/register?utm_source=medium&amp;utm_medium=hackernoon" rel="noopener ugc nofollow" target="_blank">如果您还没有帐户，请在OpsGenie </a>中申请一个新帐户。在集成- &gt;下创建一个新的API集成。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mj"><img src="../Images/f3a9b15fbdacf8e0a39ddb7b02a99a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sc-rQ_ts8FXgAUBTBgnYuA.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Create an API integration in OpsGenie</figcaption></figure><p id="eeca" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">这个函数的一个重要提示是，我们不需要这个API键来更新OpsGenie中的配置或发送通知。因此，我们将集成配置为只读访问并禁止通知。</p><h2 id="da8b" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">创建你的Lambda函数</h2><p id="6fcc" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">创建Lambda函数最简单的方法是克隆下面的链接库，并根据需要修改代码。然后，只需安装依赖项。</p><pre class="jk jl jm jn fq lx ly lz ma aw mb dt"><span id="abc4" class="kx ky hu ly b fv mc md l me mf">git clone <a class="ae kr" href="https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling" rel="noopener ugc nofollow" target="_blank">https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling</a></span><span id="3cb4" class="kx ky hu ly b fv mk md l me mf">cd serverless-opsgenie-slack-alert-unfurling</span><span id="11ae" class="kx ky hu ly b fv mk md l me mf">npm install</span></pre><p id="5839" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">如果您想从头开始或构建自己的代码，您有三种选择:</p><ul class=""><li id="84f2" class="ml mm hu jx b jy jz kb kc ke mn ki mo km mp kq mq mr ms mt dt translated">使用这个项目并替换逻辑，</li><li id="a659" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">使用AWS Lambda提供的蓝图之一，或者使用AWS CodeStart为更大的项目提供更完整的设置，</li><li id="3e7a" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">运行以下无服务器命令创建新的Lambda函数:</li></ul><pre class="jk jl jm jn fq lx ly lz ma aw mb dt"><span id="bea4" class="kx ky hu ly b fv mc md l me mf">serverless create — template aws-nodejs — path my-service</span></pre><p id="b05a" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">现在，让我们看看代码的主要构建块。除了从这里看，你还可以看看GitHub上的<a class="ae kr" href="https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling/blob/master/handler.js" rel="noopener ugc nofollow" target="_blank">这~100行代码</a>。</p><p id="5848" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">流程是这样的:</p><ul class=""><li id="bce9" class="ml mm hu jx b jy jz kb kc ke mn ki mo km mp kq mq mr ms mt dt translated">检查我们是否向Lambda函数传递了正确的密钥(松弛验证令牌、松弛访问令牌-API令牌和OpsGenie API密钥)</li><li id="d2f2" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">通过比较我们拥有的验证令牌和从请求中收到的令牌，验证请求来自Slack</li><li id="199e" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">检查事件负载和我们收到的事件的类型。<br/>如果事件为；<br/>-"<em class="mh">URL _ verification</em>"事件:从JSON负载发回<em class="mh"> challenge </em>值，因为该事件意味着Slack正在检查您的端点的健康状况<br/> - " <em class="mh"> event_callback </em>"事件:运行逻辑</li></ul><p id="f2c6" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">现在，我们已经讨论了主要的构建模块，让我们也来讨论一下当接收到event_callback时运行的逻辑。我们使用Slack和OpsGenie Node.js SDKs来避免在访问API时编写样板代码。逻辑部分包括以下步骤:</p><ul class=""><li id="3199" class="ml mm hu jx b jy jz kb kc ke mn ki mo km mp kq mq mr ms mt dt translated">一条消息可以包含来自我们注册域名的多个链接(在我们的例子中是app.opsgenie.com)。松弛事件API以数组的形式发送这些链接。我们迭代这些链接(<em class="mh">有效负载</em>中的event.links)并为每个链接运行<em class="mh">messageAttachmentFromLink</em>函数</li><li id="2064" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">首先，我们使用一个简单的正则表达式从这样的链接中提取alertId如果您愿意，您的链接可以支持其他大小写</li></ul><pre class="jk jl jm jn fq lx ly lz ma aw mb dt"><span id="48f5" class="kx ky hu ly b fv mc md l me mf">https://app.opsgenie.com/alert/V2#/show/df2d5224-6df3-4905-a98d-c08c9388f3b5-1516805551907/details</span></pre><ul class=""><li id="fe16" class="ml mm hu jx b jy jz kb kc ke mn ki mo km mp kq mq mr ms mt dt translated">使用OpsGenie中的警报ID检索警报详细信息</li><li id="8280" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">使用我们获得的详细信息构建我们的松弛消息附件</li><li id="7d4e" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">使用Slack API更新包含必要附件的Slack消息</li></ul><p id="fc72" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我们了解了我们的功能是如何工作的。但是，我建议你还是继续阅读代码，因为这对大多数开发者来说更有意义。</p><h2 id="00eb" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">部署Lambda函数的第一个版本</h2><p id="19d7" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">在创建Slack应用程序、OpsGenie集成和编写我们的函数之后，现在是时候部署我们的函数了。在这一步，我们将把我们的函数放在AWS Lambda上，但是由于我们仍然没有一个API端点来告诉Slack发出请求，所以我们还不能在我们的工作区中安装我们的应用程序。这意味着我们也没有安装应用程序后会得到的Slack API密钥。</p><p id="ea60" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">一旦我们完成了功能部署，我们将从API Gateway service获得一个HTTPS端点，并使用它来完成我们在Slack中的配置。然后，我们将通过设置Slack API键来更新Slack应用程序的配置，并再次部署应用程序。</p><p id="5d14" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">一步一步来。所以在这一步，你应该从Slack app中获取验证令牌，并粘贴到<em class="mh"> serverless.yml </em>文件中的<em class="mh">Slack _ verification _ token</em>config中。我们将使用这个令牌通过与收到的令牌进行比较来验证请求来自Slack。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mz"><img src="../Images/1cba61963b0340fe7d2d7b2dbefefabb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nK1oBL_XWmEi2XCBAMVCfA.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Slack verification token can be found under <strong class="bd na"><em class="nb">Basic information -&gt; App credentials</em></strong></figcaption></figure><p id="06ad" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我们还有OpsGenie API密钥，让我们也将它粘贴到我们的配置中。我们的配置将如下所示(唯一缺少的是<em class="mh"> slack_access_token </em>，因为我们还没有在工作区中安装应用程序):</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nc"><img src="../Images/397711f32989bbf8605109a56cf1dce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpgrdGGUnes5fY2Tzped2Q.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Our config before we deploy first time</figcaption></figure><p id="58da" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">现在，我们可以部署。转到项目的主文件夹，运行部署命令:</p><pre class="jk jl jm jn fq lx ly lz ma aw mb dt"><span id="65cf" class="kx ky hu ly b fv mc md l me mf">serverless deploy</span></pre><p id="30de" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">所有这些都将由<em class="mh"> serverless.js处理。</em> Serverless使用AWS CloudFormation来提升您的堆栈。您也可以访问CloudFormation了解更多信息。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nd"><img src="../Images/e5ee010d1751fe9ee6d34493bfb3a528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TqmYHsLbNJLJut6aX4PnWQ.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">CloudFormation Stack Serverless.js created</figcaption></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ne"><img src="../Images/247f03ea2d194d497d061028dc449b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N4vs7tbUJqKsSjeH3yQLrQ.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">After you run <strong class="bd na">serverless deploy </strong>command</figcaption></figure><p id="d921" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">运行命令并完成堆栈创建后，您将在终端中看到一个HTTP端点。抄下来继续下一部分！</p><h2 id="9c38" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">配置松弛应用程序</h2><p id="00df" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">您拥有API网关端点。Slack将使用这个API端点来发送事件细节。要将此事告知Slack，请转到<em class="mh">事件订阅</em>选项卡。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nf"><img src="../Images/60e9f3ddb5b6ebfe8a35e1be985e667c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ljy_SgQQCrexro4c36YFDg.png"/></div></div></figure><p id="1399" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">启用<em class="mh">事件</em>并将您获得的端点粘贴到“请求URL”输入中。此时，Slack将向您的端点发出请求，以确保它能够工作。不用担心，我们的代码知道如何处理这个有效载荷，并能返回正确的响应。</p><p id="12b3" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">在你获得“<em class="mh">验证</em>标志后，现在是时候订阅一些活动了。Slack只会发送您订阅的事件。在我们的例子中，当一个链接包含app.opsgenie.com的域时，为了调用我们的端点，我们需要订阅链接共享事件。</p><p id="95d3" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">这一页的最后一步是告诉Slack你想要监听哪些域。在App展开域名部分<em class="mh">下添加<em class="mh">app.opsgenie.com</em>域名。</em></p><p id="918b" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">现在，让我们从侧边栏切换到<em class="mh"> OAuth &amp; Permissions </em>页面。在这个页面中，你需要确保你有<em class="mh">链接:读</em>和<em class="mh">链接:写</em>范围。读范围是Slack向我们发送事件所必需的，写范围是我们用附件更新消息所必需的。用户需要在安装我们的应用程序时批准这一点。</p><h2 id="5c46" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">在你的工作区安装你的Slack应用</h2><p id="a384" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">现在，是时候安装应用程序并获得<strong class="jx hv"> OAuth访问令牌</strong>来访问Slack API了。进入<strong class="jx hv">安装App </strong>页面并安装:)</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ng"><img src="../Images/8ad99054483293e6ef8f4e6e9ac2047a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUAanFOXl3GBbnPiYO5e4Q.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Click Install App to Workspace</figcaption></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nh"><img src="../Images/ca8c6b5ea8f7d58775a1bfb708ea8cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJxUgIxZwVzc26jYU7Q0Ag.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Authorize the app</figcaption></figure><p id="b7a2" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">授权应用程序后，您离完成设置只有一步之遥！</p><h2 id="06a2" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">更新您的函数并再次部署</h2><p id="4f88" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">在Slack重定向你的页面中安装之后，你会看到<strong class="jx hv"> OAuth访问令牌</strong>。复制粘贴到<em class="mh"> serverless.yml </em>文件的<em class="mh"> slack_access_token </em>配置中。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/a612b0881e0d8248bc8d4d397f976df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IRXSndcrCo0I0ZxbMZTKmg.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">OAuth Access Token we need to access Slack API</figcaption></figure><p id="a6a2" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">然后再次部署应用程序，第二次运行部署命令:</p><pre class="jk jl jm jn fq lx ly lz ma aw mb dt"><span id="db53" class="kx ky hu ly b fv mc md l me mf">serverless deploy</span></pre><p id="eea3" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">就是这样！⛱</p><h2 id="ef21" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">试试看有没有用！</h2><p id="7362" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">我们需要一个OpsGenie警报来测试我们的应用程序。您可以通过键入<em class="mh">/精灵警报“测试我的警报”</em>命令或仅使用web界面从Slack创建一个。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nj"><img src="../Images/56db5e5adc3302a2238500bad7b6650a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nepqotcc0qg8EM9twn5sYg.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Create a new OpsGenie alert</figcaption></figure><p id="9f04" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">单击警报详细信息，在浏览器上，您将看到一个类似于以下内容的端点:</p><pre class="jk jl jm jn fq lx ly lz ma aw mb dt"><span id="f068" class="kx ky hu ly b fv mc md l me mf">https://app.opsgenie.com/alert/V2#/show/df2d5224-6df3-4905-a98d-c08c9388f3b5-1516805551907/details</span></pre><p id="349b" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">复制这个链接并粘贴到Slack，享受你的工作！</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nk"><img src="../Images/8d46a0816621caaaff6b2afeeb84d08d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ED5-QjKKY9KNzStSDrR1hQ.gif"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Enjoy your work!</figcaption></figure><p id="0ef4" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">代码可在此库中找到:<br/><a class="ae kr" href="https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling" rel="noopener ugc nofollow" target="_blank">https://github . com/serhatcan/server less-ops genie-slack-alert-unfurling</a></p><h2 id="df7d" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated">进一步的改进和提示</h2><p id="7141" class="pw-post-body-paragraph jv jw hu jx b jy ls iv ka kb lt iy kd ke lu kg kh ki lv kk kl km lw ko kp kq hn dt translated">您可以做一些事情来增强这种集成:</p><ul class=""><li id="4c20" class="ml mm hu jx b jy jz kb kc ke mn ki mo km mp kq mq mr ms mt dt translated">使用KMS来安全地管理您的密钥——不建议对密钥使用环境变量</li><li id="3cae" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">用更多细节改进松弛消息，可能添加按钮！</li><li id="5217" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated">如果你正在考虑处理更多的事件，并且想要隐藏一些复杂性，你可以使用<a class="ae kr" href="https://github.com/slackapi/node-slack-events-api" rel="noopener ugc nofollow" target="_blank"> Slack Events API模块用于节点。</a></li></ul></div><div class="ab cl nl nm hc nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="hn ho hp hq hr"><p id="2601" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">Slack有<a class="ae kr" href="https://api.slack.com/docs/message-link-unfurling" rel="noopener ugc nofollow" target="_blank">很好的文档</a>和<a class="ae kr" href="https://github.com/slackapi/sample-app-unfurls" rel="noopener ugc nofollow" target="_blank">在Github </a>上展示的很好的样本。遵循这些，你就可以让你的应用进入下一步了！</p><h2 id="d0cd" class="kx ky hu bd kz la lb lc ld le lf lg lh ke li lj lk ki ll lm ln km lo lp lq lr dt translated"><strong class="ak">参考文献及相关链接</strong></h2><ul class=""><li id="2549" class="ml mm hu jx b jy ls kb lt ke ns ki nt km nu kq mq mr ms mt dt translated"><a class="ae kr" href="https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling" rel="noopener ugc nofollow" target="_blank">https://github . com/serhatcan/server less-ops genie-slack-alert-unfurling</a></li><li id="6874" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated"><a class="ae kr" href="https://api.slack.com/docs/message-link-unfurling" rel="noopener ugc nofollow" target="_blank">https://api.slack.com/docs/message-link-unfurling</a></li><li id="28a7" class="ml mm hu jx b jy mu kb mv ke mw ki mx km my kq mq mr ms mt dt translated"><a class="ae kr" href="https://github.com/slackapi/sample-app-unfurls" rel="noopener ugc nofollow" target="_blank">https://github.com/slackapi/sample-app-unfurls</a></li></ul><p id="e285" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">感谢您读到这里！</p><p id="49b7" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">如果你喜欢这个教程，别忘了👏为了表示你的支持😃</p></div></div>    
</body>
</html>