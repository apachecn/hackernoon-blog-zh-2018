<html>
<head>
<title>Network Infrastructure Weathermap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络基础设施天气图</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/network-infrastructure-weathermap-5afedbfa686?source=collection_archive---------11-----------------------#2018-02-07">https://medium.com/hackernoon/network-infrastructure-weathermap-5afedbfa686?source=collection_archive---------11-----------------------#2018-02-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/fcfa381e95105af8854ee5a00477c884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_P27uc30XHgkAjBChqfWA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Network Weathermap</figcaption></figure><p id="67d2" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">收集指标的主要目的是存储它们以供长期使用，并创建图表来调试问题或识别趋势。然而，监视您的系统并不足以确定问题和异常的根本原因。有必要对你的网络<strong class="ji hv">主干</strong>有一个高层次的概述。<strong class="ji hv">气象图</strong>是<strong class="ji hv">网络运营中心</strong> ( <strong class="ji hv"> NOC </strong>)的完美选择。在这篇文章中，我将向你展示如何只用开源工具来构建一个。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ke"><img src="../Images/6fcef8c1615e6077da59857956c9e1da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A6E25joDjeD7uEqs."/></div></div></figure><p id="ad2a" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv"> Icinga 2 </strong>将收集关于您主干的指标，将检查结果指标和性能数据写入<strong class="ji hv"> InfluxDB </strong>(从<a class="ae kj" href="https://www.icinga.com/2016/08/31/icinga-2-meets-influxdb/" rel="noopener ugc nofollow" target="_blank"> Icinga 2.5 </a>开始支持)。以地图形式在<strong class="ji hv"> Grafana </strong>中可视化这些指标。</p><p id="9d04" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">首先，在<em class="kk"> hosts.conf </em>文件中添加您想要的主机配置:</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kl km l"/></div></figure><p id="d7f7" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">注意:<em class="kk">城市</em> &amp; <em class="kk">国家</em>属性将用于创建天气图。</p><p id="e360" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">要在Icinga 2安装上启用<strong class="ji hv"> InfluxDBWriter </strong>，请键入以下命令:</p><blockquote class="kn ko kp"><p id="be64" class="jg jh kk ji b jj jk jl jm jn jo jp jq kq js jt ju kr jw jx jy ks ka kb kc kd hn dt translated">icinga2功能启用influxdb</p></blockquote><p id="689f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在<em class="kk">/etc/icinga 2/features-enabled/InfluxDB . conf(</em><a class="ae kj" href="https://www.icinga.com/docs/icinga2/latest/doc/09-object-types/" rel="noopener ugc nofollow" target="_blank"><em class="kk">了解关于influx db配置的更多信息</em> </a> <em class="kk"> ) </em>中配置您的<strong class="ji hv"> InfluxDB </strong>主机和数据库</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kl km l"/></div></figure><p id="019b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv"> Icinga 2 </strong>会将您的所有指标转发到一个<em class="kk"> icinga2_metrics </em>数据库。包含的<em class="kk">主机</em>和<em class="kk">服务</em>模板定义了一个存储，<em class="kk">度量</em>表示一个表，通过该表，度量与定义了某些主机或服务的某些度量的标签进行分组(注意<em class="kk">城市</em> &amp; <em class="kk">国家</em>标签的用法)。</p><p id="2fea" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">保存更改后，不要忘记重启<strong class="ji hv"> Icinga 2 </strong>:</p><blockquote class="kn ko kp"><p id="5bd6" class="jg jh kk ji b jj jk jl jm jn jo jp jq kq js jt ju kr jw jx jy ks ka kb kc kd hn dt translated">服务icinga2重新启动</p></blockquote><p id="1c5d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">一旦<strong class="ji hv"> Icinga 2 </strong>启动并运行，它将开始收集数据并将其写入<strong class="ji hv"> InfluxDB </strong>:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kt"><img src="../Images/ece39cd5f6bf7925a9c0838bec8aa415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CcFdpVNE9JxWnD8v."/></div></div></figure><p id="ec16" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">一旦我们的数据到达，是时候进行可视化了。<strong class="ji hv"> Grafana </strong>广泛用于生成图形和仪表盘。为了创建一个<strong class="ji hv">天气图</strong>，我们可以使用一个名为<a class="ae kj" href="https://github.com/grafana/worldmap-panel" rel="noopener ugc nofollow" target="_blank">世界地图面板</a>的Grafana插件。确保使用<em class="kk"> grafana-cli </em>工具进行安装:</p><blockquote class="kn ko kp"><p id="bae1" class="jg jh kk ji b jj jk jl jm jn jo jp jq kq js jt ju kr jw jx jy ks ka kb kc kd hn dt translated">grafana-cli插件安装grafana-世界地图面板</p></blockquote><p id="8738" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">该插件将被安装到您的grafana插件目录中(<em class="kk"> /var/lib/grafana/plugins </em>):</p><p id="f27d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">重启<strong class="ji hv"> Grafana </strong>，导航到Grafana web界面并创建一个新的<em class="kk">数据源</em>:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/eb81bd1bf49b79c5fbafdcda00d846dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/0*8_lrv5xqMS43JM8a."/></div></figure><p id="c31e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">创建新仪表板:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kv"><img src="../Images/e9f1119477e8b6459be55488780617ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2AxYUc5UdVF-iXwD."/></div></div></figure><p id="c494" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv"> Group By </strong>子句应该是<strong class="ji hv">国家</strong>代码，还需要一个<strong class="ji hv">别名</strong>。别名的形式应该是<strong class="ji hv"> $tag_field_name </strong>。有关查询的示例，请参见下图:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kw"><img src="../Images/8e77a888b4fdf6ef2e6e84b0f7b4b784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zQoTIn9EdNtmmjh-."/></div></div></figure><p id="7e0e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在<strong class="ji hv">世界地图</strong>选项卡下，选择<strong class="ji hv">国家</strong>选项:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kx"><img src="../Images/8f11e339dbee6818d87cf0da3562b062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A7krU_fxs1kyNg0m."/></div></div></figure><p id="1013" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">最后，您应该会看到一个世界地图，圆圈代表每个主机的状态。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ky"><img src="../Images/e1f20d668421bdcbcb2277ddbebb09f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K4zTlL-Z-19E9mRa."/></div></div></figure><p id="dd83" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">字段<em class="kk">表示</em>可能的值(<strong class="ji hv"> 0 </strong> —正常，<strong class="ji hv"> 1 </strong> —警告，<strong class="ji hv"> 2 </strong> —关键，<strong class="ji hv"> 3 </strong> —未知/无法到达)</p><p id="ae7c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">注意:对于懒人，我创建了一个现成的仪表盘，你可以从GitHub导入。</p></div></div>    
</body>
</html>