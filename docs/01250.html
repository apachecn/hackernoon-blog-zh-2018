<html>
<head>
<title>Build a Secure Chat Web Application with JavaScript, Auth0 and Pusher</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript、Auth0和Pusher构建一个安全的聊天Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-a-secure-chat-web-application-with-javascript-auth0-and-pusher-ec91c61bad30?source=collection_archive---------7-----------------------#2018-02-08">https://medium.com/hackernoon/build-a-secure-chat-web-application-with-javascript-auth0-and-pusher-ec91c61bad30?source=collection_archive---------7-----------------------#2018-02-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="2f53" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安保很难。通常，当我们构建应用程序时，我们希望只允许注册用户访问应用程序。我们希望能够管理用户帐户，查看他们上次登录的时间，能够禁用可疑的帐户，并有一个仪表板来查看和管理所有这些数据。我们也可能决定支持多因素认证和社交登录。</p><p id="fee4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是安全不仅仅是困难，还需要一段时间来实现。如果有一种服务可以帮你解决这部分开发问题，那会怎么样？为什么要花几周或几个月的时间滚动你自己的授权呢？这就是Auth0大放异彩的地方。在本教程中，我将向您展示如何使用Pusher构建一个聊天应用程序，使用Auth0 Lock添加用户认证，以及从Auth0仪表板管理用户。</p><h1 id="ab6d" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated"><strong class="ak">auth 0和Pusher的介绍</strong></h1><p id="ac64" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated"><a class="ae ks" href="https://auth0.com/" rel="noopener ugc nofollow" target="_blank"> Auth0 </a>是一家专注于封装用户认证和管理的认证即服务(或身份即服务)提供商，它提供了一个SDK，允许开发人员轻松添加认证和管理用户。其用户管理控制面板支持违规检测和多因素身份认证，以及无密码登录。</p><p id="df28" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae ks" href="https://pusher.com/" rel="noopener ugc nofollow" target="_blank"> Pusher </a>的API和托管基础设施允许我们构建可扩展的、可靠的实时应用。Pusher对渠道和事件有一个基本的概念。通道提供了一种过滤数据和控制对不同信息流的访问的方式，而事件是在推送系统中打包消息的主要方法，并形成所有通信的基础。</p><h1 id="af82" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated"><strong class="ak">构建应用</strong></h1><p id="ce39" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我们将建立一个聊天应用程序，允许用户互相交流，每个人都能看到其他人的消息。它的工作方式类似于Slack中的通道工作方式:每个人只有一个通道进行交流。</p><p id="c7b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我们将要建造的:</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/a521a5d8ee86de364a79529c4ddd4b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cmxOZa0XSyuN5GSh_inXJA.gif"/></div></div><figcaption class="lf lg fg fe ff lh li bd b be z ek">Final App</figcaption></figure><h2 id="af35" class="lj jq hu bd jr lk ll lm jv ln lo lp jz jc lq lr kd jg ls lt kh jk lu lv kl lw dt translated"><strong class="ak">设置后端</strong></h2><p id="f5ba" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我们将从构建后端开始，这将有助于接收和广播聊天消息，提供静态文件，并设置Auth0和Pusher。</p><p id="c2f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，你需要注册一个Pusher和Auth0账户。去<a class="ae ks" href="https://pusher.com/" rel="noopener ugc nofollow" target="_blank">pusher.com</a>和<a class="ae ks" href="https://auth0.com" rel="noopener ugc nofollow" target="_blank">auth0.com</a>注册一个账户。要使用Pusher API，我们必须从仪表板注册并创建一个Pusher应用程序。我们可以创建尽可能多的应用程序，每个应用程序都将获得一个应用程序id和密钥，我们将使用它们在客户端或服务器端代码上初始化Pusher实例。</p><h2 id="814a" class="lj jq hu bd jr lk ll lm jv ln lo lp jz jc lq lr kd jg ls lt kh jk lu lv kl lw dt translated"><strong class="ak">创建新的推销商账户</strong></h2><p id="ba80" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">要创建新的Pusher应用程序，请单击<strong class="it hv">您的应用程序</strong>侧菜单，然后单击抽屉下方的<strong class="it hv">创建新应用程序</strong>按钮。这将打开设置向导。</p><p id="5961" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.输入应用程序的名称。在这种情况下，我称之为“聊天”。<br/> 2。选择一个集群。<br/> 3。如果您希望拥有不同的开发、试运行和生产实例，请选择“为多个环境创建应用程序”选项。<br/> 4。选择<strong class="it hv"> Vanilla JS </strong>作为前端，选择<strong class="it hv"> NodeJS </strong>作为后端。<br/> 5。点击“创建应用程序”按钮设置应用程序实例，完成整个过程。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lx"><img src="../Images/97b5c581afcbb281deb0b531a9863386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HqGYSTP0Yu8xGuL32DUCig.png"/></div></div><figcaption class="lf lg fg fe ff lh li bd b be z ek">Create new app on Pusher</figcaption></figure><p id="8bb1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为我们正在使用Express在Node中构建后端，所以让我们初始化一个新的Node应用程序并安装所需的依赖项。运行以下命令:</p><p id="540f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.<strong class="it hv"> npm init </strong>并选择默认选项<br/> 2。<strong class="it hv"> npm i —保存body-parser express pusher </strong>安装express和pusher节点包</p><p id="91ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">添加一个名为<em class="ly"> server.js </em>的新文件，该文件将包含认证Pusher客户端的逻辑，并呈现我们稍后将添加的静态文件。该文件将包含以下内容:</p><pre class="ku kv kw kx fq lz ma mb mc aw md dt"><span id="a379" class="lj jq hu ma b fv me mf l mg mh">var express = require(‘express’);<br/>var bodyParser = require(‘body-parser’);<br/>var Pusher = require(‘pusher’);</span><span id="6c4b" class="lj jq hu ma b fv mi mf l mg mh">var app = express();<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: false }));</span><span id="b114" class="lj jq hu ma b fv mi mf l mg mh">var pusher = new Pusher({ appId: APP_ID, key: APP_KEY, secret: APP_SECRET, cluster: eu });</span><span id="c4c0" class="lj jq hu ma b fv mi mf l mg mh">app.post(‘/pusher/auth’, function(req, res) {<br/>    var socketId = req.body.socket_id;<br/>    var channel = req.body.channel_name;<br/>    var auth = pusher.authenticate(socketId, channel);<br/>    res.send(auth);<br/>});</span><span id="8c68" class="lj jq hu ma b fv mi mf l mg mh">app.post(‘/message’, function(req, res) {<br/>    var message = req.body.message;<br/>    var name = req.body.name;<br/>    pusher.trigger( ‘private-chat’, ‘message-added’, { message, name });<br/>    res.sendStatus(200);<br/>});</span><span id="38cf" class="lj jq hu ma b fv mi mf l mg mh">app.get(‘/’,function(req,res){<br/>    res.sendFile(‘/public/index.html’, {root: __dirname });<br/>});</span><span id="6a2c" class="lj jq hu ma b fv mi mf l mg mh">app.use(express.static(__dirname + ‘/public’));</span><span id="34de" class="lj jq hu ma b fv mi mf l mg mh">var port = process.env.PORT || 5000;<br/>app.listen(port, function () {<br/>    console.log(`app listening on port ${port}!`)<br/>});</span></pre><p id="06c6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们通过传入一个包含我们的应用ID和密钥的详细信息的对象来实例化Pusher，这些信息可以在Pusher仪表盘的<strong class="it hv">应用密钥</strong>选项卡中找到。Pusher还提供了一种机制，用于在订阅时向通道认证用户。为此，我们在服务器上公开一个端点，该端点将验证请求并以成功或失败做出响应。这个端点将被Pusher客户端库调用，并且可以被命名为任何名称。我们在Pusher上使用这个端点的默认名称，即<em class="ly"> /pusher/auth </em>。第<em class="ly">行var auth = pusher . authenticate(socket id，channel)；</em>Pusher对客户端进行认证，并向主叫客户端返回一个认证码。</p><p id="8ce6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了允许这个文件在我们启动npm时运行，我们用以下值更新了<strong class="it hv"> package.json </strong>:</p><pre class="ku kv kw kx fq lz ma mb mc aw md dt"><span id="f763" class="lj jq hu ma b fv me mf l mg mh">“scripts”: {<br/> “start”: “node server.js”,<br/> “test”: “echo \”Error: no test specified\” &amp;&amp; exit 1"<br/>}</span></pre><p id="79c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">创建认证0客户端</strong> <br/>创建认证0客户端</p><p id="97a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.从侧面菜单中选择<strong class="it hv">客户端</strong>。<br/> 2。在新页面上，点击<strong class="it hv">创建客户端</strong>按钮<br/> 3。输入应用程序的名称并选择<strong class="it hv">单页应用程序</strong>作为选项<br/> 4。点击<strong class="it hv">创建</strong>按钮创建客户端。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff mj"><img src="../Images/e309846babb463ddf36a841f44cd8756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dcpj2R9DAGOXPQnjLkHSxQ.png"/></div></div></figure><p id="e08c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Auth0客户端为我们提供了客户端Id和密码，我们将使用它们从代码中与Auth0进行交互。在“设置”选项卡上，我们可以看到名称、客户端Id、密码、客户端类型等等。我想为我的域<a class="ae ks" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> <em class="ly">启用CORS http://localhost:5000</em></a>，设置注销URL和用户通过Auth0认证后重定向到的URL。用<a class="ae ks" href="http://localhost:5000**" rel="noopener ugc nofollow" target="_blank">T5更新以下设置http://localhost:5000T7】</a></p><p id="77e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.允许的回调URL<br/>2。允许的注销网址<br/> 3。允许原产地(CORS)</p><h2 id="6312" class="lj jq hu bd jr lk ll lm jv ln lo lp jz jc lq lr kd jg ls lt kh jk lu lv kl lw dt translated"><strong class="ak">构建前端</strong></h2><p id="1eab" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">随着后端一切就绪，我们构建将促进消息传递的网页。创建一个名为<strong class="it hv"> public </strong>的文件夹，其中包含html和javascript文件。创建两个新文件<strong class="it hv"> style.css </strong>和<strong class="it hv">index.html</strong>，内容如下:</p><p id="be50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> style.css </strong></p><pre class="ku kv kw kx fq lz ma mb mc aw md dt"><span id="21dd" class="lj jq hu ma b fv me mf l mg mh"><a class="ae ks" href="http://twitter.com/import" rel="noopener ugc nofollow" target="_blank">@import</a> url("<a class="ae ks" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="noopener ugc nofollow" target="_blank">http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css</a>");<br/>    .chat<br/>    {<br/>        list-style: none;<br/>        margin: 0;<br/>        padding: 0;<br/>    }<br/>    .chat li<br/>    {<br/>        margin-bottom: 10px;<br/>        padding-bottom: 5px;<br/>        border-bottom: 1px dotted #B3A9A9;<br/>    }<br/>    .chat li.left .chat-body<br/>    {<br/>        margin-left: 60px;<br/>    }<br/>    .chat li.right .chat-body<br/>    {<br/>        margin-right: 60px;<br/>    }<br/>    <br/>    .chat li .chat-body p<br/>    {<br/>        margin: 0;<br/>        color: #777777;<br/>    }<br/>    .panel .slidedown .glyphicon, .chat .glyphicon<br/>    {<br/>        margin-right: 5px;<br/>    }<br/>    .body-panel<br/>    {<br/>        overflow-y: scroll;<br/>        height: 250px;<br/>    }<br/>    ::-webkit-scrollbar-track<br/>    {<br/>        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);<br/>        background-color: #F5F5F5;<br/>    }<br/>    ::-webkit-scrollbar<br/>    {<br/>        width: 12px;<br/>        background-color: #F5F5F5;<br/>    }<br/>    ::-webkit-scrollbar-thumb<br/>    {<br/>        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);<br/>        background-color: #555;<br/>    }</span></pre><p id="36b6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">index.html</strong></p><pre class="ku kv kw kx fq lz ma mb mc aw md dt"><span id="c516" class="lj jq hu ma b fv me mf l mg mh">&lt;!-- template from <a class="ae ks" href="http://bootsnipp.com/snippets/6eWd" rel="noopener ugc nofollow" target="_blank">http://bootsnipp.com/snippets/6eWd</a> --&gt;<br/>    &lt;!DOCTYPE html&gt;<br/>    &lt;html&gt;<br/>    &lt;head&gt;<br/>        &lt;!-- Latest compiled and minified CSS --&gt;<br/>        &lt;link rel="stylesheet" href="<a class="ae ks" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css</a>" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"&gt;<br/>        &lt;!-- Optional theme --&gt;<br/>        &lt;link rel="stylesheet" href="<a class="ae ks" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css</a>" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"&gt;<br/>        &lt;script<br/>            src="<a class="ae ks" href="https://code.jquery.com/jquery-2.2.4.min.js" rel="noopener ugc nofollow" target="_blank">https://code.jquery.com/jquery-2.2.4.min.js</a>"<br/>            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="<br/>            crossorigin="anonymous"&gt;&lt;/script&gt;<br/>        &lt;!-- Latest compiled and minified JavaScript --&gt;<br/>        &lt;script src="<a class="ae ks" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js</a>" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"&gt;&lt;/script&gt;<br/>        &lt;link rel="stylesheet" href="style.css"&gt;<br/>        &lt;script src="<a class="ae ks" href="https://cdn.auth0.com/js/lock/10.18.0/lock.min.js" rel="noopener ugc nofollow" target="_blank">https://cdn.auth0.com/js/lock/10.18.0/lock.min.js</a>"&gt;&lt;/script&gt;<br/>        &lt;script src="<a class="ae ks" href="https://js.pusher.com/4.0/pusher.min.js" rel="noopener ugc nofollow" target="_blank">https://js.pusher.com/4.0/pusher.min.js</a>"&gt;&lt;/script&gt;<br/>        &lt;script src="index.js"&gt;&lt;/script&gt;<br/>    &lt;/head&gt;<br/>    &lt;body&gt;<br/>        &lt;div class="container"&gt;<br/>        &lt;div class="row form-group"&gt;<br/>            &lt;div class="col-xs-12 col-md-offset-2 col-md-8 col-lg-8 col-lg-offset-2"&gt;<br/>                &lt;div class="panel panel-primary"&gt;<br/>                    &lt;div class="panel-heading"&gt;<br/>                        &lt;span class="glyphicon glyphicon-comment"&gt;&lt;/span&gt; &lt;span id="username"&gt;&lt;/span&gt;<br/>                        &lt;div class="btn-group pull-right"&gt;<br/>                            &lt;button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown"&gt;<br/>                                &lt;span class="glyphicon glyphicon-chevron-down"&gt;&lt;/span&gt;<br/>                            &lt;/button&gt;<br/>                            &lt;ul class="dropdown-menu slidedown"&gt;<br/>                                &lt;li&gt;&lt;a&gt;&lt;span class="glyphicon glyphicon-refresh"&gt;<br/>                                &lt;/span&gt;Refresh&lt;/a&gt;&lt;/li&gt;<br/>                                &lt;li&gt;&lt;a&gt;&lt;span class="glyphicon glyphicon-ok-sign"&gt;<br/>                                &lt;/span&gt;Available&lt;/a&gt;&lt;/li&gt;<br/>                                &lt;li&gt;&lt;a&gt;&lt;span class="glyphicon glyphicon-remove"&gt;<br/>                                &lt;/span&gt;Busy&lt;/a&gt;&lt;/li&gt;<br/>                                &lt;li&gt;&lt;a&gt;&lt;span class="glyphicon glyphicon-time"&gt;&lt;/span&gt;<br/>                                    Away&lt;/a&gt;&lt;/li&gt;<br/>                                &lt;li class="divider"&gt;&lt;/li&gt;<br/>                                &lt;li&gt;&lt;a id="logout"&gt;&lt;span class="glyphicon glyphicon-off"&gt;&lt;/span&gt;<br/>                                    Sign Out&lt;/a&gt;&lt;/li&gt;<br/>                            &lt;/ul&gt;<br/>                        &lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div class="panel-body body-panel"&gt;<br/>                        &lt;ul class="chat"&gt;<br/>                            <br/>                        &lt;/ul&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div class="panel-footer clearfix"&gt;<br/>                        &lt;textarea id="message" class="form-control" rows="3"&gt;&lt;/textarea&gt;<br/>                        &lt;span class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-xs-12" style="margin-top: 10px"&gt;<br/>                            &lt;button class="btn btn-warning btn-lg btn-block" id="btn-chat"&gt;Send&lt;/button&gt;<br/>                        &lt;/span&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>    &lt;script id="new-message" type="text/template"&gt;<br/>        &lt;li id="{{id}}" class="right clearfix"&gt;<br/>            &lt;div class="chat-body clearfix"&gt;<br/>                &lt;div class="header"&gt;<br/>                    &lt;small class="text-muted"&gt;{{name}}&lt;/small&gt;<br/>                &lt;/div&gt;<br/>                &lt;p&gt;<br/>                    {{body}}<br/>                &lt;/p&gt;<br/>            &lt;/div&gt;<br/>        &lt;/li&gt;<br/>    &lt;/script&gt;<br/>    &lt;/body&gt;<br/>    &lt;/html&gt;</span></pre><p id="527f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该文件使用了来自<a class="ae ks" href="http://bootsnipp.com/snippets/6eWd" rel="noopener ugc nofollow" target="_blank"> bootsnip </a>的模板，还包含了一个对auth 0 Lock<em class="ly">&lt;script src = "</em><a class="ae ks" href="https://cdn.auth0.com/js/lock/10.18.0/lock.min.js" rel="noopener ugc nofollow" target="_blank"><em class="ly">https://cdn.auth0.com/js/lock/10.18.0/lock.min.js</em></a><em class="ly">"&gt;&lt;/script&gt;</em>的脚本引用。<a class="ae ks" href="https://auth0.com/docs/libraries#lock-login-signup-widgets" rel="noopener ugc nofollow" target="_blank"> Lock </a>是一个嵌入式身份验证小工具，提供登录所需的一组标准行为和一个可定制的用户界面。它提供了一种简单的方式，以非常少的配置与Auth0集成。</p><p id="e6b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们希望允许用户在进入应用程序时登录，并在通过身份验证后发送消息。添加一个新文件<strong class="it hv"> index.js </strong>，内容如下:</p><pre class="ku kv kw kx fq lz ma mb mc aw md dt"><span id="d42b" class="lj jq hu ma b fv me mf l mg mh">$(document).ready(function(){<br/> // Initiating our Auth0Lock<br/> let lock = new Auth0Lock(<br/> ‘CLIENT_ID’,<br/> ‘CLIENT_DOMAIN’,//example: lotus.auth0.com<br/> {<br/> auth: {<br/> params: {<br/> scope: ‘openid profile’<br/> } <br/> },<br/> autoclose: true,<br/> closable: false,<br/> rememberLastLogin: true<br/> }<br/> );<br/> <br/> let profile = JSON.parse(localStorage.getItem(‘profile’));<br/> let isAuthenticated = localStorage.getItem(‘isAuthenticated’);<br/> <br/> function updateValues(userProfile, authStatus) {<br/> profile = userProfile;<br/> isAuthenticated = authStatus;<br/> }<br/> <br/> if(!isAuthenticated &amp;&amp; !window.location.hash){<br/> lock.show();//show Lock widget<br/> }<br/> <br/> // Listening for the authenticated event<br/> lock.on(“authenticated”, function(authResult) {<br/> // Use the token in authResult to getUserInfo() and save it to localStorage<br/> lock.getUserInfo(authResult.accessToken, function(error, profile) {<br/> if (error) {<br/> // Handle error<br/> return;<br/> }<br/> <br/> localStorage.setItem(‘accessToken’, authResult.accessToken);<br/> localStorage.setItem(‘profile’, JSON.stringify(profile));<br/> localStorage.setItem(‘isAuthenticated’, true);<br/> updateValues(profile, true);<br/> $(“#username”).html(profile.name);<br/> });<br/> });<br/> });</span></pre><p id="c1e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们通过传递应用程序的客户端Id来初始化锁，你的用户域以你的用户名开始，后跟<em class="ly"> .auth0.com </em>或<em class="ly">{你的_选择的_区域}.auth0.com </em>，例如<em class="ly">lotus.eu.auth0.com</em>。小部件是可配置的，我们可以发送配置选项，如<strong class="it hv">可关闭</strong>、<strong class="it hv">自动关闭</strong>和<strong class="it hv">授权</strong>。在<strong class="it hv"> auth </strong>选项中，我们告诉它返回<strong class="it hv"> openid </strong>和<strong class="it hv"> profile </strong>声明。</p><p id="6947" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们检查用户是否通过了身份验证，如果没有，就显示小部件。一旦用户通过身份验证，Lock就会发出我们已经订阅的“通过身份验证”事件。当它被引发时，我们将用户配置文件和其他凭证存储到localStorage，并设置要在页面上显示的用户名。一旦用户通过身份验证，我们希望连接到Pusher并发送消息。使用以下代码更新index.js:</p><pre class="ku kv kw kx fq lz ma mb mc aw md dt"><span id="11a9" class="lj jq hu ma b fv me mf l mg mh">if(!isAuthenticated &amp;&amp; !window.location.hash){<br/>  lock.show();<br/> }<br/> else{<br/> <br/> // Enable pusher logging — don’t include this in production<br/> Pusher.logToConsole = true;<br/> <br/> var pusher = new Pusher(‘APP_SECRET’, {<br/>  cluster: ‘e.g eu’,<br/>  encrypted: false<br/> });<br/> <br/> var channel = pusher.subscribe(‘private-chat’);<br/>  channel.bind(‘message-added’, onMessageAdded); <br/> }<br/> <br/> function onMessageAdded(data) {<br/>  let template = $(“#new-message”).html();<br/>  template = template.replace(“{{body}}”, data.message);<br/>  template = template.replace(“{{name}}”, data.name);<br/> <br/>  $(“.chat”).append(template);<br/> }</span></pre><p id="05cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Pusher使用<strong class="it hv"> APP_SECRET </strong>和<strong class="it hv">集群</strong>进行初始化，您可以从Pusher上的APP仪表板中获得这些信息。我们订阅了一个叫做<em class="ly">私人聊天</em>的频道。Pusher有3种类型的渠道:公共渠道、私人渠道和在线渠道。私有和在线频道让您的服务器控制对您正在广播的数据的访问。存在通道进一步强制订阅者在订阅时注册用户信息。私有频道以<em class="ly"> private- </em>开始命名，并在订阅时在服务器中进行认证。</p><p id="9339" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我们希望在用户单击发送时向他们发送消息，并在他们选择注销时注销他们。用下面的代码更新<strong class="it hv"> index.js </strong></p><pre class="ku kv kw kx fq lz ma mb mc aw md dt"><span id="1ab5" class="lj jq hu ma b fv me mf l mg mh">$(‘#btn-chat’).click(function(){<br/>  const message = $(“#message”).val();<br/>  $(“#message”).val(“”);<br/>  //send message<br/>  $.post( “<a class="ae ks" href="http://localhost:5000/message" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/message</a>”, { message, name: profile.name } );<br/> }); <br/> <br/>  $(“#logout”).click((e) =&gt; {<br/>  e.preventDefault();<br/>  logout();<br/> });<br/> <br/> function logout(){<br/>   localStorage.clear();<br/>   isAuthenticated = false;<br/>   lock.logout({ <br/>   returnTo: “<a class="ae ks" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a>” <br/>  });<br/> }</span></pre><p id="b71f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当用户单击send按钮时，我们获取消息并将其放入一个具有用户概要名称的对象中，然后将其发送到服务器上的<em class="ly"> /message </em>端点。当点击logout按钮时，它调用logout函数来清除存储在localStorage中的数据，并调用<em class="ly"> lock.logout() </em>让用户在Auth0上注销，并将他们重定向回我们的网站。通过所有这些添加，index.js应该包含以下内容:</p><pre class="ku kv kw kx fq lz ma mb mc aw md dt"><span id="4f99" class="lj jq hu ma b fv me mf l mg mh">$(document).ready(function(){<br/>   // Initiating our Auth0Lock<br/>   let lock = new Auth0Lock(<br/>    ‘CLIENT_ID’,<br/>    ‘CLIENT_DOMAIN’,<br/>    {<br/>      auth: {<br/>      params: {<br/>       scope: ‘openid profile’<br/>      } <br/>    },<br/>   autoclose: true,<br/>   closable: false,<br/>   rememberLastLogin: true<br/>  });<br/> <br/>  // Listening for the authenticated event<br/>  lock.on(“authenticated”, function(authResult) {<br/>  // Use the token in authResult to getUserInfo() and save it to   localStorage<br/>  lock.getUserInfo(authResult.accessToken, function(error, profile) {<br/>  if (error) {<br/>   // Handle error<br/>   console.log(error);<br/>   return;<br/>  }<br/> <br/>   localStorage.setItem(‘accessToken’, authResult.accessToken);<br/>   localStorage.setItem(‘profile’, JSON.stringify(profile));<br/>   localStorage.setItem(‘isAuthenticated’, true);<br/>   updateAuthenticationValues(profile, true);<br/>   $(“#username”).html(profile.name);<br/>  });<br/> });<br/> <br/> let profile = JSON.parse(localStorage.getItem(‘profile’));<br/> let isAuthenticated = localStorage.getItem(‘isAuthenticated’);<br/> <br/> function updateAuthenticationValues(userProfile, authStatus) {<br/>  profile = userProfile;<br/>  isAuthenticated = authStatus;<br/> }<br/> <br/> $(“#logout”).click((e) =&gt; {<br/>  e.preventDefault();<br/>  logout();<br/> });<br/> <br/> function logout(){<br/>  localStorage.clear();<br/>  isAuthenticated = false;<br/>  lock.logout({ <br/>   returnTo: “<a class="ae ks" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a>” <br/>  });<br/> }<br/> <br/> function onMessageAdded(data) {<br/>  let template = $(“#new-message”).html();<br/>  template = template.replace(“{{body}}”, data.message);<br/>  template = template.replace(“{{name}}”, data.name);<br/> <br/>  $(“.chat”).append(template);<br/> }<br/> <br/> if(!isAuthenticated &amp;&amp; !window.location.hash){<br/>  lock.show();<br/> }<br/> else{<br/>  if(profile){<br/>  $(“#username”).html(profile.name);<br/> }<br/> <br/> // Enable pusher logging — don’t include this in production<br/> Pusher.logToConsole = true;<br/> <br/> var pusher = new Pusher(‘APP_SECRET’, {<br/>  cluster: ‘eu’,<br/>  encrypted: false<br/> });<br/> <br/> var channel = pusher.subscribe(‘private-chat');<br/> channel.bind(‘message-added’, onMessageAdded);<br/> <br/> $(‘#btn-chat’).click(function(){<br/>  const message = $(“#message”).val();<br/>  $(“#message”).val(“”);<br/>  //send message<br/>  $.post( “<a class="ae ks" href="http://localhost:5000/message" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/message</a>”, { message, name: profile.name } );<br/>  }); <br/>  }<br/> });</span></pre><p id="c947" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要测试该应用程序，请在终端上运行“npm start ”,并在两个不同的浏览器上打开<a class="ae ks" href="http://localhost:5000`" rel="noopener ugc nofollow" target="_blank"><em class="ly">http://localhost:5000</em></a><em class="ly"/>。下面是它的运行过程:</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/a521a5d8ee86de364a79529c4ddd4b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cmxOZa0XSyuN5GSh_inXJA.gif"/></div></div></figure><h1 id="1f36" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">包裹</h1><p id="d634" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">这是一个应用程序，展示如何使用Pusher实时发送消息并保护通道，使用Auth0添加用户验证和帐户管理，并使用Auth0 Lock轻松集成到Auth0。在你的控制台上，你可以看到用户、登录和新注册的总数。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff mk"><img src="../Images/8af9a31b886c85f054beea0a8deda257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oNaJ27ctBS3JCvpPxxARTA.png"/></div></div></figure><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff ml"><img src="../Images/8e6a9045e654799fd7c7659e03ab7b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UmhZVn0xgIz1Nn6rBnhVNQ.png"/></div></div></figure><p id="c173" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您单击**用户* *侧菜单时，您还可以看到您的所有用户。在此页面上，您可以看到您的用户列表及其登录模式。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff mm"><img src="../Images/cadc8dee64ea36fe5b16bb9d1e39877a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sz88Qp6COzGRM4WDVs85Uw.png"/></div></div></figure><p id="59b6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">选择一个用户会将您带到一个更详细的页面，在这里您可以对帐户采取各种操作，例如，阻止帐户或发送验证电子邮件。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff mn"><img src="../Images/c0be4b3afc1604e8ecf1bed450e01b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*88j84upEP3CcRAgUTSE0cQ.png"/></div></div></figure><p id="205d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同样在Pusher上，你可以进入你的应用仪表板，在<strong class="it hv"> Stats </strong>下，在那里你会看到关于你的应用的统计数据，比如连接频率和通过该应用发送的消息数量。这两种技术的结合使得构建实时安全的应用程序变得更快更容易。你可以在<a class="ae ks" href="https://github.com/pmbanugo/Pusher-Auth0-ChatApp" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到代码。</p></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><p id="1d3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ly">此文最初发表于</em> <a class="ae ks" href="https://blog.pusher.com/build-secure-chat-web-app-javascript-auth0-pusher/" rel="noopener ugc nofollow" target="_blank"> <em class="ly">推手</em> </a></p></div></div>    
</body>
</html>