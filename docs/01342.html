<html>
<head>
<title>Apply Coursera Control of Mobile Robots with ROS and ROSbots — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ROS和ROSbots应用Coursera控制移动机器人—第1部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/apply-coursera-control-of-mobile-robots-with-ros-and-rosbots-part-1-777a51f63617?source=collection_archive---------6-----------------------#2018-02-12">https://medium.com/hackernoon/apply-coursera-control-of-mobile-robots-with-ros-and-rosbots-part-1-777a51f63617?source=collection_archive---------6-----------------------#2018-02-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/502dfe52f10b0e72c9fd5742e06c2081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-00qk0KUPHLuGTxn7tpjGw.jpeg"/></div></div></figure><blockquote class="jc jd je"><p id="c48c" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">(2020年3月28日更新—由于ROS商标问题，我们现在是</strong><a class="ae ke" href="https://www.hadabot.com" rel="noopener ugc nofollow" target="_blank"><strong class="ji hv">【hada bot</strong></a><strong class="ji hv">。查看新的</strong><a class="ae ke" href="https://www.hadabot.com" rel="noopener ugc nofollow" target="_blank"><strong class="ji hv">hada bot</strong></a><strong class="ji hv">机器人套件！！)</strong></p></blockquote><p id="815b" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">ROSbots是一个面向创客的ROS + OpenCV机器人套件。我们最近<a class="ae ke" rel="noopener" href="/@rosbots/ros-opencv-robot-kit-for-makers-7e22d91b4fd7">推出了基于Raspberry Pi 3的ROSbots版机器人套件</a>。</p><p id="4f10" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">该套件包括一个摄像头、车轮编码器、两个可充电锂电池电源，甚至还有一个Arduino兼容的UNO板，用于硬件PWM、中断和ADC支持。</p><p id="31c5" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">硬件很有趣，但更重要的是，我们想用硬件来应用机器人概念。这需要学习软件和知识，用现代软件工具如<a class="ae ke" href="https://www.rosbots.com/" rel="noopener ugc nofollow" target="_blank"> ROS </a>和<a class="ae ke" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank"> OpenCV </a>来实现这些机器人概念。</p><p id="df5d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">作为一个多部分系列的第一篇文章，我们计划发布从<a class="ae ke" href="https://www.coursera.org/learn/mobile-robot" rel="noopener ugc nofollow" target="_blank"> Coursera移动机器人控制</a>课程中学到的概念，并将它们应用到使用ROS的ROSbots机器人上。《移动机器人控制》课程为理解移动机器人控制理论奠定了基础——如何可预测地控制你的机器人，以及如何使用传感器数据来估计姿态并让你的机器人了解周围环境。</p><p id="4ae6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">(2018年3月24日更新:<a class="ae ke" rel="noopener" href="/@rosbots/unicycle-to-differential-drive-courseras-control-of-mobile-robots-with-ros-and-rosbots-part-2-6d27d15f2010">该系列的第二部分——我们谈论独轮车和差动驱动机器人模型</a>——已经出版。)</p><p id="6fe4" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">完成我们的多部分系列后，您将对机器人控制理论和ROS有一个工作理解。</p><p id="31a8" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated"><em class="jh">(关注@rosbots获取更新。关注我们的</em><a class="ae ke" href="https://www.instagram.com/rosbots/" rel="noopener ugc nofollow" target="_blank"><em class="jh">insta gram</em></a><em class="jh">和</em> <a class="ae ke" href="https://www.facebook.com/hackrosbots" rel="noopener ugc nofollow" target="_blank"> <em class="jh">脸书</em> </a> <em class="jh">吧！)</em></p><p id="27b6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">如果你有自己的<a class="ae ke" href="https://www.rosbots.com/purchase" rel="noopener ugc nofollow" target="_blank"> ROSbots机器人</a>，我们欢迎你跟随。动手使用你自己的ROSbots工具包会给我们写的东西增添更多的色彩，而不仅仅是阅读这篇文章。</p><p id="3ac1" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在本帖中，我们将准备实施移动机器人控制第一周中描述的控制模型。具体来说，我们将在本帖中做以下工作:</p><ol class=""><li id="0d43" class="ki kj hu ji b jj jk jn jo kf kk kg kl kh km kd kn ko kp kq dt translated">了解ROBbots机器人上的L9110电机驱动器如何工作。</li><li id="5885" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">浏览Arduino草图代码，该代码实现了一个ROS节点来驱动L9110旋转车轮。</li><li id="bb61" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">编译并上传ROS-Arduino草图到我们的ROS bot的UNO板上，并在ROS bot的主大脑上运行ROS节点——即它的Raspberry Pi。</li><li id="7eb2" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">给你一个ROS的信息系统如何工作的实际感受——使用一些内置的ROS工具来控制我们的马达。</li></ol><p id="cab1" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们希望你了解一点电子学，玩过Arduinos，有一些软件编程经验，并且熟悉电子学和编码术语。</p><p id="3a2e" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">如果你是一个优秀的自上而下的学习者，那么你不需要学习移动机器人控制课程，也不需要了解移动机器人。但如果你两者都做到了，那肯定是有益于智力的。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><h1 id="bd86" class="ld le hu bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma dt translated">关于L9110电机驱动器</h1><p id="440c" class="pw-post-body-paragraph jf jg hu ji b jj mb jl jm jn mc jp jq kf md jt ju kg me jx jy kh mf kb kc kd hn dt translated">L9110电机驱动器有两个通道，可以说它有能力控制两个电机。</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/4f6749ff7c1e9f9105dc9ffeb8378ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IKoZzRGnwiSHEqdhxoRqww.jpeg"/></div></div><figcaption class="mk ml fg fe ff mm mn bd b be z ek">L9110 mounted on the ROSbots (now <a class="ae ke" href="https://www.hadabot.com" rel="noopener ugc nofollow" target="_blank">Hadabot</a>) robot and another one shown right side up.</figcaption></figure><p id="25ed" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">每个通道有2个输入控制引脚IA和IB，它们“驱动”连接到ROSbots机器人电机的2个输出引脚OA和OB。因此总共有4个输入引脚和4个输出引脚。</p><p id="c637" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">一个通道A有一组IA/IB/OA/OB引脚(连接到我们的左电机/车轮)，另一个通道B有一组IA/IB/OA/OB引脚(连接到右电机/车轮)。</p><p id="3840" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">IA是我们PWM调制电机速度的值。IB引脚控制电机方向。</p><p id="0746" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">L9110引脚表总结了输入/输出行为:</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/9a518cc14252d948a68cdc4a9f1649cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-VPUKnptav6oLoGFP9OJA.png"/></div></div><figcaption class="mk ml fg fe ff mm mn bd b be z ek">L9110 input and output pin table</figcaption></figure><p id="c8cb" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">想要用你的ROSbots机器人做一个快速演示吗？</p><ol class=""><li id="a736" class="ki kj hu ji b jj jk jn jo kf kk kg kl kh km kd kn ko kp kq dt translated">将连接到A-IA的电线，特别是ROSbots试验板上的G-6，插入试验板(VCC)顶行的任何孔中。</li><li id="95c4" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">将连接到A-IB(特别是G-5)的电线插入试验板(GND)底排的任何孔中。</li><li id="37cd" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">左轮将向前旋转。</li><li id="39c9" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">现在交换连接——从G-6到GND，从G5到VCC，现在左轮将向后旋转。</li></ol><figure class="mg mh mi mj fq iv"><div class="bz el l di"><div class="mp mq l"/></div></figure></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><p id="1d3e" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们将通过编写支持ROS的Arduino草图，在我们的ROSbots机器人上驱动带有UNO板的L9110。</p><p id="eedf" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated"><a class="ae ke" href="https://github.com/ROSbots/rosbots_driver/tree/master/platformio/rosbots_firmware/examples/motor_driver/src/main.cpp" rel="noopener ugc nofollow" target="_blank"> main.cpp的草图代码可以在rosbots_driver Github repo </a>中找到(别忘了星随！).</p><p id="ee08" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">让我们跳过一堆特定于ROS的代码，从第16行开始直接跳到这个代码块。</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/ea05d8bc1d19cdec2ec5e1f9e0c7b701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*0HJK5axWy3vYfSCrsGoYHQ.png"/></div></figure><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/ee53bc3b7201ce90cb7072a6e3d7d7f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*pXKrZ1BmQ7_ZDClppqJGig.jpeg"/></div></figure><p id="54af" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">注意，右滚轮的IA (PWM)和IB(方向)引脚分别连接到UNO板上的引脚5和4；左轮的IA和IB连接到针脚6和7。</p><p id="61ba" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">接下来，让我们看看实际驱动销转动轮子的代码块。</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/9369433c895d847ba7568f29ea27c6a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*La9Dl_cMDfNPFoX3gJcROw.png"/></div></div><figcaption class="mk ml fg fe ff mm mn bd b be z ek">Ignore the debug code in the comments</figcaption></figure><p id="613f" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在<em class="jh">转轮(…) </em>功能中，我们将输入变量<em class="jh"> wheel_power </em>箝位在-1.0(全倒车)和1.0(全前进)之间。这将调制输出到相应L9110的IA引脚(又名<em class="jh"> pwm_pin </em>)的PWM电压和输出到IB引脚(又名<em class="jh"> fr_pin </em>，如fwd-reverse)的数字电压。</p><p id="c8d6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated"><em class="jh"> analogWrite(…) </em>期间的简单数学运算根据<em class="jh"> wheel_power </em>符号指定的方向线性调整PWM脉冲宽度——正表示正向，负表示反向。</p><p id="3692" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">随着<em class="jh"> wheel_power </em>从-1.0变为1.0，你可以看到<em class="jh"> pwm_pin </em>和<em class="jh"> fr_pin </em>从完全后退、停止到完全前进的转变，如本文开头的L9110 pin表所述。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><p id="e462" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">让我们编译并上传这个草图代码到我们的UNO板上，看看它是如何工作的。</p><p id="9f48" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">ROSbots使用<a class="ae ke" href="http://platformio.org/" rel="noopener ugc nofollow" target="_blank"> platformio </a>编译并上传ROS-Arduino草图代码到UNO板上。</p><ol class=""><li id="85f6" class="ki kj hu ji b jj jk jn jo kf kk kg kl kh km kd kn ko kp kq dt translated">我们假设你已经用这些指令设置好了你的<a class="ae ke" href="https://github.com/ROSbots/rosbots_setup_tools" rel="noopener ugc nofollow" target="_blank"> ROSbots机器人。</a></li><li id="7c2a" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">SSH到您的ROSbots的树莓Pi中——我们将完成RPi的剩余步骤。</li><li id="ddac" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">在您的RPi终端中运行以下命令(随意直接剪切-粘贴):<code class="eh mu mv mw mx b">~/$ upload_firmware ~/gitspace/rosbots_driver/platformio/rosbots_firmware/examples/motor_driver</code>(全部一行)</li></ol><p id="39d1" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">成功？？</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><p id="ad10" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在我们的RPi上，键入<code class="eh mu mv mw mx b">rosnode list</code>以获得正在运行的ROS节点列表——您应该看到以下内容:</p><pre class="mg mh mi mj fq my mx mz na aw nb dt"><span id="74af" class="nc le hu mx b fv nd ne l nf ng">/rosout<br/>/uno_serial_node</span></pre><p id="1ba1" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">键入<code class="eh mu mv mw mx b">rostopic list</code>以获取正在发布或订阅的ROS主题列表——您应该会看到以下内容:</p><pre class="mg mh mi mj fq my mx mz na aw nb dt"><span id="3446" class="nc le hu mx b fv nd ne l nf ng">/diagnostics<br/>/rosout<br/>/rosout_agg<br/>/wheel_power_left<br/>/wheel_power_right</span></pre><p id="5a6c" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">什么是ROS节点和主题？这一切意味着什么？</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><p id="0584" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">受<a class="ae ke" href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" rel="noopener ugc nofollow" target="_blank">发布者/订阅者分布式消息架构</a>的启发，ROS被设置为一组独立的进程，称为ROS节点，它们通过消息相互通信。一个ROS节点可以运行读取Pi摄像机的进程，然后在“foo”主题通道上以“image”消息类型发布图像。另一个负责检测传入图像中的猫的ROS节点将订阅“foo”主题频道。像标准的发布/订阅模型一样，发布者和订阅者不关心谁订阅了或者谁在发布上游和下游。</p><p id="29dd" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">总之，任何ROS节点都可以是通过称为ROS主题的命名通道传递的特定消息类型的发布者和/或订阅者。</p><p id="fa74" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在我们的示例中，我们编写了一些Arduino草图代码，作为订阅两个主题的ROS节点— <em class="jh"> wheel_power_right </em>和<em class="jh"> wheel_power_left </em>。这些通道上的消息将是<em class="jh"> Float32 </em>类型(与上面假设的例子中的“图像”相对)。</p><p id="f58b" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">看看你编译并上传的这段Arduino草图代码:</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div class="fe ff nh"><img src="../Images/72ba4d08baedf08b539f2a00912a22ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d-nLGMhCp1d4XWTM39CI9g.png"/></div></figure><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div class="fe ff nh"><img src="../Images/27028e771c9a7ff7eecce72cf7ff96f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eE9UIRqvdgUHya_UGBoPJA.png"/></div></figure><p id="2795" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">你会注意到，我们的UNO板订阅了两个主题频道——<em class="jh">wheel _ power _ right</em>和<em class="jh">wheel _ power _ left</em>——这两个代码块。</p><p id="4f9d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">当我们得到关于这些主题的消息时，我们分别调用<em class="jh"> rightWheelCb(…) </em>和<em class="jh"> leftWheelCb(…) </em>回调。如果您还记得，那个回调实现了驱动L9110输入引脚的代码。</p><p id="888e" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">如果您记得键入了<code class="eh mu mv mw mx b">rostopic list</code>，那么会列出主题名称<em class="jh"> wheel_power_right </em>和<em class="jh"> wheel_power_left </em>。</p><p id="492a" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">生活是美好的。对吗？</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><p id="10fb" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们的草图代码在我们的UNO板上。但是我们的UNO板如何与运行在Raspberry Pi上的ROS系统的其余部分通信呢？</p><p id="63f6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">UNO板通过USB连接到我们的RPi，并通过串口与之通信。这一切都很好，除了ROS不直接谈论“串口”！？</p><p id="b279" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">如果您再次回忆，当您键入<code class="eh mu mv mw mx b">rosnode list</code>时，您会看到一个<em class="jh"> /uno_serial_node </em>被列为正在运行的ROS节点之一。为了让ROS能够与“串行端口”对话，我们需要一个桥，将ROS消息序列化为发送到UNO进行处理的串行端口数据包。这个桥应用程序是ROS节点，称为<a class="ae ke" href="http://wiki.ros.org/rosserial" rel="noopener ugc nofollow" target="_blank">rosserial</a>——我们将该节点命名为<em class="jh"> /uno_serial_node </em>。</p><p id="c9c1" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated"><em class="jh"> /uno_serial_node </em>的工作是打开一个到uno板的串口连接，然后序列化/反序列化往返于UNO板的ROS消息。</p><p id="d2f8" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">键入<code class="eh mu mv mw mx b">rostopic info /wheel_power_left</code>，您将看到<em class="jh"> /uno_serial_node </em>作为订户。为什么不说我们的UNO代码？</p><p id="5e39" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">请记住，我们的UNO板不能直接与ROS系统对话——它只能通过串口与<em class="jh"> /uno_serial_node </em>对话。我们的uno代码确实向<em class="jh"> /uno_serial_node </em>指定它想要订阅<em class="jh"> /wheel_power_left </em>主题，并且<em class="jh"> /uno_serial_node </em>代表UNO订阅该主题。你可以认为rosserial<em class="jh">/uno _ serial _ node</em>是ROS世界和Arduino Sketch世界之间的中介。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><p id="1628" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">OK—UNO是主题<em class="jh"> /wheel_power_left </em>和<em class="jh"> /wheel_power_right </em>的订阅者(通过rosserial<em class="jh">/UNO _ serial _ node</em>)，这些主题将根据收到的<em class="jh"> Float32 </em>消息驱动车轮。但是谁是发布者呢？</p><p id="da0f" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">暂时没有。相反，我们将使用ROS <code class="eh mu mv mw mx b">rostopic</code>工具在这些主题频道上手动发布一些ROS消息来推动车轮。</p><p id="3959" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在RPi bash终端中:</p><ol class=""><li id="1d84" class="ki kj hu ji b jj jk jn jo kf kk kg kl kh km kd kn ko kp kq dt translated">从任何目录，没关系，输入(或剪切-粘贴)<code class="eh mu mv mw mx b">rostopic pub -1 /wheel_power_left std_msgs/Float32 '{data: 1.0}'</code>——你的左轮应该向前旋转</li><li id="8944" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">键入(或剪切-粘贴)<code class="eh mu mv mw mx b">rostopic pub -1 /wheel_power_left std_msgs/Float32 '{data: 0.0}'</code>——你的左轮应该停下来</li><li id="b3be" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">键入(或剪切-粘贴)<code class="eh mu mv mw mx b">rostopic pub -1 /wheel_power_left std_msgs/Float32 '{data: -1.0}'</code>——你的左轮应该向后旋转</li><li id="ceee" class="ki kj hu ji b jj kr jn ks kf kt kg ku kh kv kd kn ko kp kq dt translated">键入(或剪切-粘贴)<code class="eh mu mv mw mx b">rostopic pub -1 /wheel_power_left std_msgs/Float32 '{data: -0.5}'</code>——你的左轮应该向后转得慢一些。</li></ol><p id="63e5" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated"><code class="eh mu mv mw mx b">rostopic pub</code>命令告诉ROS我们想要发布。如果你输入<code class="eh mu mv mw mx b">rostopic pub --help</code>，你会看到几个选项。<code class="eh mu mv mw mx b">-1</code>选项表示只发布一次消息，而不是连续发布。下一个选项是主题频道名称。<code class="eh mu mv mw mx b">std_msgs/Float32</code>是消息类型。<code class="eh mu mv mw mx b">'{data: 1.0}'</code>是实际有效载荷数据。它采用了类似JSON的花括号语法，因为ROS将消息概括为数据结构。所以<em class="jh"> Float32 </em> ROS消息类型是从<em class="jh">STD _ msgs</em>T23的一堆标准<a class="ae ke" href="http://wiki.ros.org/std_msgs" rel="noopener ugc nofollow" target="_blank"> ROS包中定义的(注意<em class="jh"> Float32 </em>在链接中列出)。</a><a class="ae ke" href="http://docs.ros.org/api/std_msgs/html/msg/Float32.html" rel="noopener ugc nofollow" target="_blank"> <em class="jh"> Float32 </em>消息类型</a> <em class="jh"> </em>实际上是一个实体的数据结构，一个32位浮点。</p><figure class="mg mh mi mj fq iv"><div class="bz el l di"><div class="ni mq l"/></div></figure><p id="f5ec" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">祝贺您——您刚刚成功发布了关于某个主题的第一组ROS消息，并编写了代码来实现订阅和处理该消息的ROS节点。随意对右轮做同样的练习。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><h1 id="abff" class="ld le hu bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma dt translated"><strong class="ak"> <em class="nj">有疑问？</em> </strong></h1><p id="28ff" class="pw-post-body-paragraph jf jg hu ji b jj mb jl jm jn mc jp jq kf md jt ju kg me jx jy kh mf kb kc kd hn dt translated">如果你有问题，在<a class="ae ke" href="https://answers.ros.org/questions/" rel="noopener ugc nofollow" target="_blank">answers.ros.org</a>上发表，主题为“ROSbots问题:<em class="jh">无论你的问题是什么</em>”，并在帖子上贴上“rosbots”的标签。我们将密切关注论坛，并做出相应的回应。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><p id="12d0" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">所有这些与Coursera的移动机器人控制课程有什么关系？</p><p id="1725" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们正在有效地构建部件，以将本课程第1周中描述的<a class="ae ke" rel="noopener" href="/@rosbots/unicycle-to-differential-drive-courseras-control-of-mobile-robots-with-ros-and-rosbots-part-2-6d27d15f2010">独轮车模型转变为差动驱动机器人模型</a>。然后，我们将添加来自机器人车轮编码器的反馈，以实现车轮速度的PID控制器，这将使我们能够估计机器人的姿态——位置和方向。</p><p id="1503" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">本系列的最后一篇文章将完全实现课程中描述的编码项目。但是代替使用Matlab，我们将使用ROS和我们的ROSbots机器人！</p><p id="7d63" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">关注@ rosbots on Medium获取更新。也请在<a class="ae ke" href="https://www.instagram.com/rosbots/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>和<a class="ae ke" href="https://www.facebook.com/hackrosbots" rel="noopener ugc nofollow" target="_blank">脸书</a>上关注我们！</p><p id="7adc" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">请在此自由发表评论。但是如果你有技术问题，请在answers.ros.org发布(主题为“机器人问题:<em class="jh"> blahblah </em>”，标签为“机器人”)。</p><p id="c5ea" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">如果您想合作，或者只是打个招呼，请不要犹豫，直接与一般反馈联系。如果您还没有这样做，请在这里<a class="ae ke" href="https://www.rosbots.com/purchase" rel="noopener ugc nofollow" target="_blank">购买您自己的机器人来跟进。</a></p><p id="2a0f" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">谢谢！<br/>杰克“机器人制造商”</p></div></div>    
</body>
</html>