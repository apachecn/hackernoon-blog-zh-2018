<html>
<head>
<title>Import your Medium Feed into React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的媒体提要导入React</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/import-your-medium-feed-into-react-ceadbaf785c7?source=collection_archive---------10-----------------------#2018-02-12">https://medium.com/hackernoon/import-your-medium-feed-into-react-ceadbaf785c7?source=collection_archive---------10-----------------------#2018-02-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="3769" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">React博客系列:第三部分</h2></div><p id="43c1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">本文是用React创建博客的每周系列文章的第三部分，是前几部分创建的代码的扩展。</p><h2 id="fc14" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">React博客系列</h2><p id="f828" class="pw-post-body-paragraph jj jk hu jl b jm la iv jo jp lb iy jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated"><a class="ae lf" rel="noopener" href="/front-end-hacking/building-a-website-with-react-and-bulma-d655214bff2a"> <strong class="jl hv">第一部分:</strong>用React和布尔玛</a> <br/> <a class="ae lf" rel="noopener" href="/@aaron.klaser/building-a-blog-with-react-and-contentful-fd538f68f6fb"> <strong class="jl hv">建立一个网站第二部分:</strong>用React和Contentful建立一个博客</a> <br/> <strong class="jl hv">第三部分:</strong>将你的媒体提要导入React <br/> <a class="ae lf" rel="noopener" href="/@aaron.klaser/adding-redux-to-a-react-blog-97f5fea606c2"> <strong class="jl hv">第四部分:</strong>向React博客添加一个Redux</a><br/><a class="ae lf" href="https://hackernoon.com/replacing-redux-thunks-with-redux-sagas-4aa306854925" rel="noopener ugc nofollow" target="_blank"><strong class="jl hv">第五部分:</strong>用Redux Sagas替换Redux Thunks</a><br/></p></div><div class="ab cl lh li hc lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hn ho hp hq hr"><p id="7c12" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你还没有在medium上写博客，你应该写。太简单了。</p><p id="f853" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">本周我们将在我们的网站上添加一个feed，这样我们就有了一个另类的博客。</p><p id="f9e0" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先，让我们看看什么是中等饲料。我们可以通过添加<strong class="jl hv">将内容转换成JSON格式？format=json </strong>到url的末尾。这是我的饲料。</p><p id="b1b7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae lf" href="https://medium.com/@aaron.klaser/latest?format=json" rel="noopener">https://medium.com/@aaron.klaser/<strong class="jl hv">最新？格式= JSON</strong>T34】</a></p><p id="30a8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将返回一大块JSON，但是我们只关心<code class="eh lo lp lq lr b">payload.references.Post</code></p><blockquote class="ls lt lu"><p id="108b" class="jj jk lg jl b jm jn iv jo jp jq iy jr lv jt ju jv lw jx jy jz lx kb kc kd ke hn dt translated">我认为公平地说，这实际上不是一个“feed”，这基本上是Medium用来在我的Medium个人资料上显示我最新帖子的<strong class="jl hv">预览</strong>的内容，而不是完整的帖子本身。Medium提供了一个RSS提要，它像传统的博客提要一样包含更多的信息，但是它不能返回任何JSON，只能返回XML。我喜欢在Medium上预览我的Medium文章的链接，这是一个额外的好处，因为不必解析XML。但是，如果您想使用实际的媒体提要，这些概念几乎是相同的，您可以使用url <code class="eh lo lp lq lr b"><a class="ae lf" rel="noopener" href="/@aaron.klaser">https://medium.com/<strong class="jl hv">feed/</strong>@aaron.klaser</a></code></p></blockquote><p id="7cbc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是我们需要一页纸来把它放上去。我<a class="ae lf" rel="noopener" href="/front-end-hacking/building-a-website-with-react-and-bulma-d655214bff2a">已经有一个标签在导航</a>我们只需要创建一个页面把它放在上面。基本设置遵循了我上一篇文章中的许多步骤，所以我将快速浏览一下基本页面设置。</p><p id="9dc5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在<strong class="jl hv"> app </strong>文件夹中，创建一个名为<code class="eh lo lp lq lr b">Medium.js</code>的文件</p><pre class="ly lz ma mb fq mc lr md me aw mf dt"><span id="f2c5" class="kf kg hu lr b fv mg mh l mi mj">import React from 'react'<br/>import PageHeader from './components/PageHeader'<br/>import PageContent from './components/PageContent'<br/>import axios from 'axios'</span><span id="d527" class="kf kg hu lr b fv mk mh l mi mj">class Medium extends React.Component {</span><span id="47df" class="kf kg hu lr b fv mk mh l mi mj">  state = {<br/>    posts: []<br/>  }</span><span id="b3c5" class="kf kg hu lr b fv mk mh l mi mj">  componentDidMount() {<br/>    this.fetchPosts().then(this.setPosts)<br/>  }</span><span id="1051" class="kf kg hu lr b fv mk mh l mi mj">  fetchPosts = () =&gt; axios.get(`https://cors.now.sh/https://us-central1-aaronklaser-1.cloudfunctions.net/medium?username=@aaron.klaser`)</span><span id="84dc" class="kf kg hu lr b fv mk mh l mi mj">  setPosts = response =&gt; {<br/>    this.setState({<br/>      posts: response<br/>    })<br/>  }</span><span id="9827" class="kf kg hu lr b fv mk mh l mi mj">  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;PageHeader color="is-dark" title="Medium"&gt;<br/>          Medium is where I ramble and rant and tell stories. I orginally was going to use it as a coding blog, I don't like having to use Gist for all my code snippets. So I created this site.<br/>          &lt;br /&gt;&lt;br /&gt;<br/>          &lt;a className="button is-inverted is-outlined" href="https://medium.com/@aaron.klaser" target="_blank"&gt;<br/>            View My Medium<br/>            &lt;span className="icon" style={{ marginLeft: 5 }}&gt;<br/>              &lt;i className="fab fa-lg fa-medium"&gt;&lt;/i&gt;<br/>            &lt;/span&gt;<br/>          &lt;/a&gt;<br/>        &lt;/PageHeader&gt;<br/>        &lt;PageContent&gt;<br/>          &lt;pre&gt;{JSON.stringify(this.state.posts, null, 2)}&lt;/pre&gt;<br/>        &lt;/PageContent&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span><span id="4a40" class="kf kg hu lr b fv mk mh l mi mj">export default Medium</span></pre><p id="c913" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后设置此页面的路由，并更新“媒体”项以指向此页面。</p><h2 id="665f" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">这不容易弄清楚</h2><p id="e336" class="pw-post-body-paragraph jj jk hu jl b jm la iv jo jp lb iy jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">因此，当我们在本地构建这个中型块时，cors的本地主机。您可以告诉fetch运行no cors模式，但是您会得到一个没有数据的不透明响应。我发现我可以通过一个express服务器运行所有的东西来解决这个问题，但是我不希望我的网站需要一个后端。我也试着在cors-anywhere和cors.now中运行它。它们只是被屏蔽了，老实说是有原因的。</p><h1 id="c557" class="ml kg hu bd kh mm mn mo kl mp mq mr kp ja ms jb ks jd mt je kv jg mu jh ky mv dt translated">拯救世界的无服务器架构</h1><p id="e155" class="pw-post-body-paragraph jj jk hu jl b jm la iv jo jp lb iy jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">我可以用Firebase云函数帮我打电话来解决这个问题。然而，firebase仍然抛出cors错误，但它们不会被<strong class="jl hv"> cors.now </strong>阻止。</p><p id="4b18" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我的函数看起来像这样，很难看，但我让它工作了，我继续前进。</p><blockquote class="ls lt lu"><p id="2a0d" class="jj jk lg jl b jm jn iv jo jp jq iy jr lv jt ju jv lw jx jy jz lx kb kc kd ke hn dt translated">Medium返回一个奇怪的前缀<code class="eh lo lp lq lr b"> to prevent JSON</code> Hacking (:P)，所以我们将删除它并返回我们的数据。</p></blockquote><pre class="ly lz ma mb fq mc lr md me aw mf dt"><span id="ba93" class="kf kg hu lr b fv mg mh l mi mj">const functions = require('firebase-functions');<br/>var request = require('request');</span><span id="0a88" class="kf kg hu lr b fv mk mh l mi mj">exports.medium = functions.https.onRequest((req, res) =&gt; {<br/>  if(!req.query.username) {<br/>    return res.status(400).send('Error: You need to include query param ?username=@yourUsername');<br/>  }</span><span id="ba82" class="kf kg hu lr b fv mk mh l mi mj">  const url = `https://medium.com/${req.query.username}/latest?format=json`;</span><span id="3564" class="kf kg hu lr b fv mk mh l mi mj">  return request(url,(error, response, body) =&gt; {<br/>    const prefix = `])}while(1);&lt;/x&gt;`<br/>    const strip = payload =&gt; payload.replace(prefix, ``)<br/>    res.send(JSON.parse(strip(body)));<br/>  });<br/>})</span></pre><p id="cb00" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我已经在<strong class="jl hv"> firebase函数</strong>中设置了一个端点，你可以使用<strong class="jl hv">或者尝试创建自己的端点。我甚至可能会写一篇关于它的文章，因为事实证明它很酷。</strong></p><p id="6a78" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh lo lp lq lr b">https://cors.now.sh/https://us-central1-aaronklaser-1.cloudfunctions.net/medium?username=<strong class="jl hv">@yourUsername</strong></code></p><p id="e971" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">只需更新您的用户名，您应该会在pre块中看到您的json。</p><figure class="ly lz ma mb fq mx fe ff paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="fe ff mw"><img src="../Images/2e3801036f434d2f5c65954db9fc2763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ys_HSGPBB5pJWsCX2fnUw.png"/></div></div></figure><h1 id="f901" class="ml kg hu bd kh mm mn mo kl mp mq mr kp ja ms jb ks jd mt je kv jg mu jh ky mv dt translated">为我们的帖子提取数据</h1><p id="1d1b" class="pw-post-body-paragraph jj jk hu jl b jm la iv jo jp lb iy jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">有一种简单的方法，但是很脏，然后有一种困难的方法，但是很干净。</p><h2 id="5663" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">简单的方法:</h2><p id="4957" class="pw-post-body-paragraph jj jk hu jl b jm la iv jo jp lb iy jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">使用Object.values()将Posts节点转换为对象数组。这将使用我们的数据，但它是我们所有的数据，我们不能在我们的媒体上传播(我们将很快建立)</p><pre class="ly lz ma mb fq mc lr md me aw mf dt"><span id="777e" class="kf kg hu lr b fv mg mh l mi mj">setPosts = (<strong class="lr hv">{data}</strong>) =&gt; {<br/>  this.setState({<br/>    posts: <strong class="lr hv">Object.values(data.payload.references.Post)</strong><br/>  })<br/>}</span></pre><p id="091c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但当你运行应用程序时，你会看到前块有提取后的数据，但也有大量你不需要的数据。艰难的方式解决了这个问题。</p><h2 id="61e7" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><strong class="ak">敬酒不吃吃罚酒:</strong></h2><p id="fc43" class="pw-post-body-paragraph jj jk hu jl b jm la iv jo jp lb iy jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated"><em class="lg">(推荐)</em>让我们提取帖子中唯一需要的数据。这将是:<strong class="jl hv">创建日期，图像，标题，副标题，描述，</strong>和<strong class="jl hv">网址</strong>回到媒体上的帖子。</p><pre class="ly lz ma mb fq mc lr md me aw mf dt"><span id="207b" class="kf kg hu lr b fv mg mh l mi mj">setPosts = ({<strong class="lr hv">data</strong>}) =&gt; {</span><span id="e727" class="kf kg hu lr b fv mk mh l mi mj">  <strong class="lr hv">const { Post } = data.payload.references</strong></span><span id="8aef" class="kf kg hu lr b fv mk mh l mi mj"><strong class="lr hv">  const posts = Object.values(Post).map(({ id, title, createdAt, virtuals, uniqueSlug }) =&gt; Object.assign({},{<br/>      title,<br/>      createdAt,<br/>      subtitle: virtuals.subtitle,<br/>      image: virtuals.previewImage.imageId ? `https://cdn-images-1.medium.com/max/800/${virtuals.previewImage.imageId}` : null,<br/>      url: `https://medium.com/@aaron.klaser/${uniqueSlug}`<br/>    })<br/>  )</strong></span><span id="5330" class="kf kg hu lr b fv mk mh l mi mj">  this.setState({<br/>    posts<br/>  })<br/>}</span></pre><p id="c230" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，当我们运行我们的应用程序时，它应该只打印出我们需要的来自JSON的巨大blob的五个字段，所有这些都准备好在我们将要构建的MediumItem对象中展开…</p><figure class="ly lz ma mb fq mx fe ff paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="fe ff ne"><img src="../Images/da8551f81d8e7cc9cb6cd14e259f12dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nflbvxdkEovhfjtOwwNlFw.png"/></div></div></figure><p id="d95e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在！</p><h1 id="870e" class="ml kg hu bd kh mm mn mo kl mp mq mr kp ja ms jb ks jd mt je kv jg mu jh ky mv dt translated">构建媒体组件</h1><p id="083f" class="pw-post-body-paragraph jj jk hu jl b jm la iv jo jp lb iy jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">在我们的应用程序文件夹中，创建一个中型文件夹，并在其中创建MediumItem.js</p><p id="1558" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将看起来类似于我们的博客项目，但由于medium没有给我们内容，我们不需要像博客那样的MediumPost，所以我们不会有任何共享项目，我们将把它们都放在这个组件中。</p><pre class="ly lz ma mb fq mc lr md me aw mf dt"><span id="aee5" class="kf kg hu lr b fv mg mh l mi mj">import React from 'react'<br/>import moment from 'moment'</span><span id="62cf" class="kf kg hu lr b fv mk mh l mi mj">const MediumItem = ({title, createdAt, subtitle, image, url}) =&gt; (<br/>  &lt;div className="box is-paddingless card"&gt;<br/>    { image<br/>    ? (&lt;div className="card-image"&gt;<br/>         &lt;figure className="image"&gt;<br/>           &lt;img src={image} /&gt;<br/>         &lt;/figure&gt;<br/>       &lt;/div&gt;)<br/>     : "" }<br/>    &lt;div className="card-content"&gt;<br/>      &lt;div className="media"&gt;<br/>        &lt;div className="media-content" style={{ overflow: 'inherit' }}&gt;<br/>        &lt;p className="title is-4"&gt;{title}&lt;/p&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>    &lt;div className="content"&gt;<br/>      { subtitle }<br/>    &lt;/div&gt;<br/>    &lt;nav className="level"&gt;<br/>      &lt;div className="level-left"&gt;<br/>        &lt;div className="tags has-addons"&gt;<br/>          &lt;span className="tag is-primary"&gt;{moment(createdAt).format('MMM Do')}&lt;/span&gt;<br/>          &lt;span className="tag"&gt;{moment(createdAt).format('YYYY')}&lt;/span&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="level-right"&gt;<br/>        &lt;a className="button is-small is-link is-outlined" target="_blank" href={url}&gt;<br/>          Read on Medium<br/>        &lt;/a&gt;<br/>      &lt;/div&gt;<br/>    &lt;/nav&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;<br/>)</span><span id="1d08" class="kf kg hu lr b fv mk mh l mi mj">export default MediumItem</span></pre><p id="52a6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">它应该看起来像这样</p><figure class="ly lz ma mb fq mx fe ff paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="fe ff nf"><img src="../Images/70488bbd8fb9afcb1be9c2b18544852f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Q8swqqgBa-7PFo1Tbk97w.png"/></div></div></figure><p id="adaa" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这就是你要的，孩子们！现在，您的博客中有了一个链接回您的中型文章的中型提要。开始鼓掌！！</p><h1 id="b2f0" class="ml kg hu bd kh mm mn mo kl mp mq mr kp ja ms jb ks jd mt je kv jg mu jh ky mv dt translated">让我们回顾一下</h1><ul class=""><li id="8f45" class="ng nh hu jl b jm la jp lb js ni jw nj ka nk ke nl nm nn no dt translated">我们为我们的媒体提要建立了一个页面</li><li id="f7cc" class="ng nh hu jl b jm np jp nq js nr jw ns ka nt ke nl nm nn no dt translated">我们链接到无服务器功能来检索我们的媒体馈送</li><li id="02ed" class="ng nh hu jl b jm np jp nq js nr jw ns ka nt ke nl nm nn no dt translated">我们从我们的媒体内容中提取了我们需要的数据</li><li id="ccd9" class="ng nh hu jl b jm np jp nq js nr jw ns ka nt ke nl nm nn no dt translated">我们设置了一个简单的媒体组件。</li></ul><blockquote class="ls lt lu"><p id="6ef7" class="jj jk lg jl b jm jn iv jo jp jq iy jr lv jt ju jv lw jx jy jz lx kb kc kd ke hn dt translated">接下来— <a class="ae lf" rel="noopener" href="/@aaron.klaser/adding-redux-to-a-react-blog-97f5fea606c2">向React博客添加Redux</a></p></blockquote></div></div>    
</body>
</html>