<html>
<head>
<title>Chroot: the magical healing powers of the original Linux virtualization tool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Chroot:原始Linux虚拟化工具的神奇治愈能力</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/chroot-the-magical-healing-powers-of-the-original-linux-virtualization-tool-9aa4c3928711?source=collection_archive---------11-----------------------#2018-02-12">https://medium.com/hackernoon/chroot-the-magical-healing-powers-of-the-original-linux-virtualization-tool-9aa4c3928711?source=collection_archive---------11-----------------------#2018-02-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="66e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文节选自我的</em> <a class="ae jq" href="https://www.manning.com/books/linux-in-action?a_aid=bootstrap-it&amp;a_bid=4ca15fc9" rel="noopener ugc nofollow" target="_blank"> <em class="jp">曼宁书，Linux在行动</em> </a> <em class="jp">第六章和第九章。除了这本书，你还可以通过</em> <a class="ae jq" href="https://www.manning.com/livevideo/linux-in-motion?a_aid=bootstrap-it&amp;a_bid=0c56986f&amp;chan=motion1" rel="noopener ugc nofollow" target="_blank"> <em class="jp">学习Linux in Motion</em></a><em class="jp">——这是一门混合课程，由两个多小时的视频和大约40%的Linux in Action文本组成。</em></p><p id="88e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您知道您所支持的人选择的密码可能不足以保护您的基础设施免受严重攻击。即使是少数例外，也可能在多个服务器和帐户上被重用。你乞求和唠叨，但这是一场失败的战斗。</p><p id="49c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是一切并没有完全失去。使用KeePass2或LastPass这样的好的<br/>密码库可以很大程度上解决跟踪<br/>足够复杂的密码的问题。过度使用<br/>密码的问题至少可以通过实现像Kerberos这样的单点登录<br/>解决方案来缓解。好的。不是<em class="jp">像</em> Kerberos，而是<em class="jp"> Kerberos </em>。</p><p id="7016" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，愚蠢的错误总是会发生。</p><p id="b8bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么，对于一两个非常在意为他们访问的每台服务器设计好的、强有力的密码的用户来说，会发生什么呢？当然，他们时不时会忘记密码。如果有另一个拥有sudo power的管理员可以登录到服务器并运行passwd为用户创建一个新密码，这就不是问题了。</p><pre class="jr js jt ju fq jv jw jx jy aw jz dt"><span id="e172" class="ka kb hu jw b fv kc kd l ke kf">$ sudo  passwd username<br/>[sudo] password for yourname:<br/>Enter new UNIX password:<br/>Retype new UNIX password:<br/>passwd: password updated successfully</span></pre><p id="b522" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是如果你不幸而健忘的用户是那台机器上唯一拥有帐户的管理员，你就有麻烦了。除了你没有。ch root——所有Linux虚拟化的始祖——将拯救你的一天。</p><p id="2701" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里有一种方法可能行得通。使用实时启动驱动器来启动被锁定的服务器。</p><figure class="jr js jt ju fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="fe ff kg"><img src="../Images/248461f09c7d6710d012a48aa38ce313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zH8RDUKITlGOFF33ZmdwtA.png"/></div></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">Steps for creating a Linux live boot USB</figcaption></figure><p id="ef61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后打开一个终端并运行lsblk来确定您的根分区在服务器硬盘上的位置，并将根分区挂载到一个临时目录。</p><pre class="jr js jt ju fq jv jw jx jy aw jz dt"><span id="3e82" class="ka kb hu jw b fv kc kd l ke kf"># mkdir /run/mountdir/<br/># mount /dev/sdb1 /run/mountdir/</span></pre><p id="fa31" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后你低声说出咒语，你就进去了:</p><pre class="jr js jt ju fq jv jw jx jy aw jz dt"><span id="9032" class="ka kb hu jw b fv kc kd l ke kf"># chroot /run/mountdir/<br/>root@ubuntu:/#</span></pre><p id="186c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就够了。此时，您可以自由地运行命令，就好像您正在运行物理硬盘一样。使用passwd为您的管理员提供一个新密码来替换丢失的密码，并在键入exit关闭chroot会话后，重新启动机器(没有live-boot USB)。现在一切都应该没问题了。</p><blockquote class="ks kt ku"><p id="ede9" class="ir is jp it b iu iv iw ix iy iz ja jb kv jd je jf kw jh ji jj kx jl jm jn jo hn dt translated">加密还是不加密</p><p id="c900" class="ir is jp it b iu iv iw ix iy iz ja jb kv jd je jf kw jh ji jj kx jl jm jn jo hn dt translated">使用ecryptfs或dm-crypt之类的工具对存储驱动器上的数据进行加密，可以大大降低数据受损的可能性。但另一方面，许多救援和恢复操作，如上面的chroot技巧，在加密卷上根本不起作用。</p><p id="1537" class="ir is jp it b iu iv iw ix iy iz ja jb kv jd je jf kw jh ji jj kx jl jm jn jo hn dt translated">在安全性和可访问性之间取得平衡并不是一门精确的科学。例如，许多管理员会让本地服务器和桌面工作站不加密——因为它们至少受到上锁的办公室门的保护——但坚持移动设备要加密。</p></blockquote><h2 id="fa55" class="ka kb hu bd ky kz la lb lc ld le lf lg jc lh li lj jg lk ll lm jk ln lo lp lq dt translated">恢复锁定的虚拟机</h2><p id="dc3f" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">你可以使用chroot的魔法来清理各种各样的垃圾。被锁定在本地服务器(或LXC容器)之外？请随意打开chroot shell来禁用甚至重新配置您的防火墙。</p><p id="998c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，在物理机上完成这项工作应该很简单。但这是它在LXC容器上的工作方式。</p><p id="3ef6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，停止容器，然后对rootfs目录<br/>运行chroot，该目录位于LXC容器(var/lib/lxc/<br/>your-container-name/)使用的目录层次结构中。您将得到的命令提示符将允许您执行命令，就像容器实际上正在运行一样。现在禁用ufw，或者，如果您愿意，运行必要的命令来修复问题，然后退出chroot shell。当您再次启动容器备份时，您现在应该可以进行SSH访问了。</p><pre class="jr js jt ju fq jv jw jx jy aw jz dt"><span id="9275" class="ka kb hu jw b fv kc kd l ke kf"># lxc-stop -n your-container-name<br/># chroot /var/lib/lxc/your-container-name/rootfs/<br/># ufw disable<br/># exit<br/># lxc-start -d -n your-container-name</span></pre><p id="cc11" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文摘自我的</em> <a class="ae jq" href="https://www.manning.com/books/linux-in-action?a_aid=bootstrap-it&amp;a_bid=4ca15fc9" rel="noopener ugc nofollow" target="_blank"> <em class="jp">曼宁《Linux在行动》一书</em> </a> <em class="jp">。还有更多有趣的</em> <a class="ae jq" href="https://bootstrap-it.com/index.php/books/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">这来自</em> </a> <em class="jp">，包括一个名为</em><a class="ae jq" href="https://www.manning.com/livevideo/linux-in-motion?a_aid=bootstrap-it&amp;a_bid=0c56986f&amp;chan=motion1" rel="noopener ugc nofollow" target="_blank"><em class="jp">Linux in Motion</em></a><em class="jp">的混合课程，它由两个多小时的视频和大约40%的Linux in Action文本组成。谁知道呢……你可能也会喜欢我最近出版的《在一个月的午餐中学习亚马逊网络服务》。</em></p></div></div>    
</body>
</html>