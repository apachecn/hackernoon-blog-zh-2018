<html>
<head>
<title>Continuous delivery of react app with Jenkins and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Jenkins和Docker一起持续交付react应用</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/continuous-delivery-of-react-app-with-jenkins-and-docker-8a1ae1511b86?source=collection_archive---------0-----------------------#2018-02-18">https://medium.com/hackernoon/continuous-delivery-of-react-app-with-jenkins-and-docker-8a1ae1511b86?source=collection_archive---------0-----------------------#2018-02-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="d4aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是文章的第二部分——从头开始反应应用程序。我将向你展示如何创建一个CD过程，让你的应用从头开始变得更好。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/7ce4bd8fc485d47f20e98829e14b0fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DpUVWTopUJr6ZvmPiapLCw.png"/></div></div></figure></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><p id="9713" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们开始之前，我会把有用的链接。</p><p id="fe2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">文章第一部分:</p><div class="ki kj fm fo kk kl"><a rel="noopener follow" target="_blank" href="/@evheniybystrov/react-app-from-scratch-d694300d1631"><div class="km ab ej"><div class="kn ab ko cl cj kp"><h2 class="bd hv fv z el kq eo ep kr er et ht dt translated">从头开始反应应用程序</h2><div class="ks l"><h3 class="bd b fv z el kq eo ep kr er et ek translated">这是教程的第一部分，我将展示如何从头开始创建react应用程序。</h3></div><div class="kt l"><p class="bd b gc z el kq eo ep kr er et ek translated">medium.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz jz kl"/></div></div></a></div><p id="13d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其他我的文章—如何开始使用Docker:</p><div class="ki kj fm fo kk kl"><a href="https://hackernoon.com/making-right-things-using-docker-7296cf0f6c6e" rel="noopener  ugc nofollow" target="_blank"><div class="km ab ej"><div class="kn ab ko cl cj kp"><h2 class="bd hv fv z el kq eo ep kr er et ht dt translated">使用Docker做正确的事情</h2><div class="ks l"><h3 class="bd b fv z el kq eo ep kr er et ek translated">在这篇文章中，我想展示如何使用docker进行开发和测试。为了表明现在是时候从…</h3></div><div class="kt l"><p class="bd b gc z el kq eo ep kr er et ek translated">hackernoon.com</p></div></div><div class="ku l"><div class="la l kw kx ky ku kz jz kl"/></div></div></a></div><p id="8858" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你的项目是开源的，你可以使用Travis CI。你只需要像这样创建<a class="ae lb" href="https://github.com/evheniy/react-app/blob/master/.travis.yml" rel="noopener ugc nofollow" target="_blank"> .travis.yml </a>:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="1b31" class="lh li hu ld b fv lj lk l ll lm">language: node_js<br/>node_js:  <br/>  - "8"  <br/>  - "9"<br/>script:  <br/>  - npm test</span></pre><p id="3f14" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并查看结果:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ln"><img src="../Images/48afeb23a64621d20dc8e183b696ee57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xFHGL8QtSBa9ezvauEYl5g.png"/></div></div></figure><p id="0dc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是我想向您展示如何从头开始创建CI/CD环境。</p><p id="e7ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用<a class="ae lb" href="https://jenkins.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">詹金斯</strong> </a>与<a class="ae lb" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> Docker </strong> </a> <strong class="it hv">。</strong>詹金斯在<a class="ae lb" href="https://hub.docker.com/r/jenkins/jenkins/" rel="noopener ugc nofollow" target="_blank"> docker hub </a>上有官方图片。</p><p id="9170" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你能在github上找到的所有配置:<a class="ae lb" href="https://github.com/evheniy/react-app/tree/master/jenkins" rel="noopener ugc nofollow" target="_blank">https://github.com/evheniy/react-app/tree/master/jenkins</a></p></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><h2 id="898f" class="lh li hu bd lo lp lq lr ls lt lu lv lw jc lx ly lz jg ma mb mc jk md me mf mg dt translated">詹金斯</h2><p id="b85a" class="pw-post-body-paragraph ir is hu it b iu mh iw ix iy mi ja jb jc mj je jf jg mk ji jj jk ml jm jn jo hn dt translated">要使用docker hub的官方映像运行Jenkins，我们需要运行下一个命令:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="c180" class="lh li hu ld b fv lj lk l ll lm">docker run --name jenkins -p 8080:8080 jenkins</span></pre><p id="5d92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，如果我们需要更新图像或重启容器，我们需要存储我们的数据。因此，我们需要将卷映射到主机:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="db36" class="lh li hu ld b fv lj lk l ll lm">docker run -p 8080:8080 -v $PWD/jenkins:/var/jenkins_home jenkins</span></pre><p id="4e57" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将不仅使用docker来运行Jenkins。使用docker，我们可以运行docker registry，并且可以为react应用程序测试和创建图像。</p><h2 id="a559" class="lh li hu bd lo lp lq lr ls lt lu lv lw jc lx ly lz jg ma mb mc jk md me mf mg dt translated">登记处</h2><p id="acae" class="pw-post-body-paragraph ir is hu it b iu mh iw ix iy mi ja jb jc mj je jf jg mk ji jj jk ml jm jn jo hn dt translated">要使用docker hub上的docker映像运行<a class="ae lb" href="https://hub.docker.com/_/registry/" rel="noopener ugc nofollow" target="_blank"> docker注册表</a>,请运行:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="df97" class="lh li hu ld b fv lj lk l ll lm">docker run -d -p 5000:5000 --restart always --name registry registry</span></pre><p id="b5d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要将新映像推送到注册表，请使用以下命令:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="9de6" class="lh li hu ld b fv lj lk l ll lm">docker pull ubuntu<br/>docker tag ubuntu localhost:5000/ubuntu<br/>docker push localhost:5000/ubuntu</span></pre><h2 id="4574" class="lh li hu bd lo lp lq lr ls lt lu lv lw jc lx ly lz jg ma mb mc jk md me mf mg dt translated">Docker撰写</h2><p id="0f6e" class="pw-post-body-paragraph ir is hu it b iu mh iw ix iy mi ja jb jc mj je jf jg mk ji jj jk ml jm jn jo hn dt translated">要用Jenkins运行注册表，我将使用docker-compose。</p><p id="1594" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但在我为詹金斯创建Dockerfile之前。我们需要它在docker内部运行docker。</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="6a01" class="lh li hu ld b fv lj lk l ll lm">touch Dockerfile</span></pre><p id="14b6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并放上:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="a561" class="lh li hu ld b fv lj lk l ll lm"><strong class="ld hv">FROM </strong>jenkins<strong class="ld hv">/</strong>jenkins:lts<br/><br/><strong class="ld hv">USER </strong>root</span></pre><p id="82ab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，我使用詹金斯的最新图像，并运行它作为根。</p><p id="ece5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们准备使用docker-compose。</p><p id="f756" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们用一个命令创建<a class="ae lb" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">docker-compose</strong></a>文件来运行Jenkins和docker库:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="139f" class="lh li hu ld b fv lj lk l ll lm">touch <!-- -->docker-compose.yml</span></pre><p id="95ad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有一个。因为我们需要在docker中运行docker，所以我们需要添加更多的卷。但是首先运行命令:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="b2d9" class="lh li hu ld b fv lj lk l ll lm">which docker</span></pre><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mm"><img src="../Images/a4d236ebd7b6daf8f9660a9be4c0612e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M6qVKIS7qWkcW7t9jDnZ3g.png"/></div></div></figure><p id="48a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并输入下一个代码:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="fefb" class="lh li hu ld b fv lj lk l ll lm"><strong class="ld hv">version: </strong>'3'<br/><br/><strong class="ld hv">services:<br/><br/>  jenkins:<br/>    build: </strong>.<br/>    <strong class="ld hv">container_name: </strong>jenkins<br/>    <strong class="ld hv">privileged: </strong>true<br/>    <strong class="ld hv">restart: </strong>always<br/>    <strong class="ld hv">ports:<br/>      </strong>- 8080:8080<br/>    <strong class="ld hv">volumes:<br/>      </strong>- ./jenkins_home:/var/jenkins_home<br/>      - /var/run/docker.sock:/var/run/docker.sock<br/>      - <strong class="ld hv"><em class="mn">/usr/local/bin/docker</em></strong>:/usr/bin/docker<br/><br/>  <strong class="ld hv">registry:<br/>    image: </strong>registry<br/>    <strong class="ld hv">container_name: </strong>registry<br/>    <strong class="ld hv">restart: </strong>always<br/>    <strong class="ld hv">ports:<br/>      </strong>- 5000:5000</span></pre><p id="e05f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要运行它，请使用</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="3f7e" class="lh li hu ld b fv lj lk l ll lm">docker-compose up -d</span></pre><p id="762b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并停止:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="6ca8" class="lh li hu ld b fv lj lk l ll lm">docker-compose stop</span></pre><p id="92c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">把所有东西都拿下来(用卷):</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="daab" class="lh li hu ld b fv lj lk l ll lm">docker-compose down --volumes</span></pre><p id="3566" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者，如果您想要删除docker图像:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="31e4" class="lh li hu ld b fv lj lk l ll lm">docker-compose down --rmi all</span></pre><p id="ddaf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，让我们运行它，并配置詹金斯使用管道。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mm"><img src="../Images/b6c2a063b411c15e87f3f7679378fe3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XdRW6KWJ6OxuNRYVH6vXxg.png"/></div></div></figure><p id="19fd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">打开<a class="ae lb" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080/ </a>:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mo"><img src="../Images/a722118e547a5f4f7208698355ea6ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fu14EaLjh0gJN0eMTcRkdQ.png"/></div></div></figure><p id="170c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要查看刚刚运行的密码(我们只需要一次):</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="6b84" class="lh li hu ld b fv lj lk l ll lm">docker exec jenkins <strong class="ld hv">cat /var/jenkins_home/secrets/initialAdminPassword</strong></span></pre><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mm"><img src="../Images/30b4e904e85639de189fadbe5114277b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AsOCh9GUhE_iOrHHuUISwA.png"/></div></div></figure><p id="7873" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并在第页输入:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mo"><img src="../Images/a9a1335c77bf9a0087607bb7f8cd96d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6BL5g3_tznixfWspITrew.png"/></div></div></figure><p id="413f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我们第一次运行，我们看到配置页面:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mo"><img src="../Images/f8f6e8952a6184907e500d580a623ffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XRY8ViG6vauhTDw9myGw5g.png"/></div></div></figure><p id="d3dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我选择第二点并检查下一个插件:</p><div class="jq jr js jt fq ab cb"><figure class="mp ju mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/46306bda8cca68d5d33a8369c66ea28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*XO3rMIAyQISe1hlC6rtFqg.png"/></div></figure><figure class="mp ju mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/4d5b9cb14036cc59da7b3655c02242ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*X44RPs-GWPPHu8UhSUyuGA.png"/></div></figure><figure class="mp ju mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/b6fece4a075baa000dec144314d338c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*2YYfQX7TZXRBcEZAX2FKxg.png"/></div></figure></div><div class="ab cb"><figure class="mp ju mv mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/a354215294dc3be30bc0123ce4202b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*R99ejeCnO6yPoR39gK1N1A.png"/></div></figure><figure class="mp ju mv mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/78190ea16d6cdfe9386cf8b17b63dcaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*JO6pz7pWQ3m2iZFpXCEyvw.png"/></div></figure></div><p id="eb9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击<strong class="it hv">安装</strong>并等待:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/bed3fe7e4c8cda9d87bb3b71ca680580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omOcVWVUZJJ_FGhKdNH2CQ.png"/></div></div></figure><p id="7b39" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你查一下目录，我们有很多詹金斯的文件:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mm"><img src="../Images/37dbfa1a75b2468a220be699f1f4c441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X6IdCoWjOCit56dfVNxweQ.png"/></div></div></figure><p id="42ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">需要创建新用户后:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/f3edb3a76f2bb361b0a516193c6bc16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1iPYYXtgSr816YD-dM07xw.png"/></div></div></figure><p id="76e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">仅此而已。詹金斯准备好了。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/4021aeb3655fa611e2eb93ac7525493e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ojs_xnN-WLRdTv3C6-gTLQ.png"/></div></div></figure><p id="87ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们需要创建一个新的构建。您可以从起始页开始:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/dbdce2d713bba05b2e98c592130933e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PmPE79HWR_LeSAlZbNT2cg.png"/></div></div></figure><p id="d40e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一步，我们需要输入名称并选择构建配置的类型:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ln"><img src="../Images/47d053f0b44b65c27dd905927d9461c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Rlj1EtG8okMeZCEX4BrjQ.png"/></div></div></figure><p id="2ce2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我使用多分支管道配置。</p><p id="783e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来我们需要配置我们的构建(名称，访问github)</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ln"><img src="../Images/3ede4eede9c9b4d643d1cd4f9ed65dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qG46Pa5s-iWIHTrKRGcjA.png"/></div></div></figure><p id="6171" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以及其他一些配置，如清理和扫描时间。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ln"><img src="../Images/5949027d02b32f69415f3b1cf50c8269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e3HfANolbwCADMFy7CRCHA.png"/></div></div></figure><p id="88f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我为react-app制作时，我使用了相同的github repo(【https://github.com/evheniy/react-app】T4)</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/6b3f44e0bffffb9b747d0866cdabf327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8wSCRbuSsjWmn2cWHaSENQ.png"/></div></div></figure><p id="5c7a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">詹金斯扫描后</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ln"><img src="../Images/482f243847bd5ab709409a7dea3093cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_vzLlNxqlHzbl7jEeCEcg.png"/></div></div></figure><h2 id="cdb0" class="lh li hu bd lo lp lq lr ls lt lu lv lw jc lx ly lz jg ma mb mc jk md me mf mg dt translated">配置</h2><p id="c46e" class="pw-post-body-paragraph ir is hu it b iu mh iw ix iy mi ja jb jc mj je jf jg mk ji jj jk ml jm jn jo hn dt translated">下一步是创建Jenkinsfile、Dockerfile、Dockerfile.test并保存在github上:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="85c2" class="lh li hu ld b fv lj lk l ll lm">node {<br/>  try {<br/>    stage('Checkout') {<br/>      checkout scm<br/>    }<br/>    stage('Environment') {<br/>      sh 'git --version'<br/>      echo "Branch: ${env.BRANCH_NAME}"<br/>      sh 'docker -v'<br/>      sh 'printenv'<br/>    }<br/>    stage('Build Docker test'){<br/>     sh 'docker build -t react-test -f Dockerfile.test --no-cache .'<br/>    }<br/>    stage('Docker test'){<br/>      sh 'docker run --rm react-test'<br/>    }<br/>    stage('Clean Docker test'){<br/>      sh 'docker rmi react-test'<br/>    }<br/>    stage('Deploy'){<br/>      if(env.BRANCH_NAME == 'master'){<br/>        sh 'docker build -t react-app --no-cache .'<br/>        sh 'docker tag react-app localhost:5000/react-app'<br/>        sh 'docker push localhost:5000/react-app'<br/>        sh 'docker rmi -f react-app localhost:5000/react-app'<br/>      }<br/>    }<br/>  }<br/>  catch (err) {<br/>    throw err<br/>  }<br/>}</span></pre><p id="7a48" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Dockerfile </strong></p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="f760" class="lh li hu ld b fv lj lk l ll lm"># Extending image<br/><strong class="ld hv">FROM </strong>node:carbon<br/><br/><strong class="ld hv">RUN </strong>apt-get update<br/><strong class="ld hv">RUN </strong>apt-get upgrade <strong class="ld hv">-</strong>y<br/><strong class="ld hv">RUN </strong>apt-get <strong class="ld hv">-</strong>y install autoconf automake libtool nasm make pkg-config git apt-utils<br/><br/># Create app directory<br/><strong class="ld hv">RUN </strong>mkdir <strong class="ld hv">-</strong>p <strong class="ld hv">/</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<br/><strong class="ld hv">WORKDIR /</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<br/><br/># Versions<br/><strong class="ld hv">RUN </strong>npm <strong class="ld hv">-</strong>v<br/><strong class="ld hv">RUN </strong>node <strong class="ld hv">-</strong>v<br/><br/># Install app dependencies<br/><strong class="ld hv">COPY </strong>package.json <strong class="ld hv">/</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<strong class="ld hv">/<br/>COPY </strong>package-lock.json <strong class="ld hv">/</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<strong class="ld hv">/<br/><br/>RUN </strong>npm install<br/><br/># Bundle app source<br/><strong class="ld hv">COPY </strong>. <strong class="ld hv">/</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<br/><br/># Port to listener<br/><strong class="ld hv">EXPOSE </strong>3000<br/><br/># Environment variables<br/><strong class="ld hv">ENV </strong><em class="mn">NODE_ENV </em>production<br/><strong class="ld hv">ENV </strong><em class="mn">PORT </em>3000<br/><strong class="ld hv">ENV </strong><em class="mn">PUBLIC_PATH </em>"/"<br/><br/><strong class="ld hv">RUN </strong>npm run start:build<br/><br/># Main command<br/><strong class="ld hv">CMD </strong>[ "npm", "run", "start:server" ]</span></pre><p id="8f28" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Dockerfile.test </strong></p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="b5dd" class="lh li hu ld b fv lj lk l ll lm"># Extending image<br/><strong class="ld hv">FROM </strong>node:carbon<br/><br/><strong class="ld hv">RUN </strong>apt-get update<br/><strong class="ld hv">RUN </strong>apt-get upgrade <strong class="ld hv">-</strong>y<br/><strong class="ld hv">RUN </strong>apt-get <strong class="ld hv">-</strong>y install autoconf automake libtool nasm make pkg-config git apt-utils<br/><br/># Create app directory<br/><strong class="ld hv">RUN </strong>mkdir <strong class="ld hv">-</strong>p <strong class="ld hv">/</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<br/><strong class="ld hv">WORKDIR /</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<br/><br/># Versions<br/><strong class="ld hv">RUN </strong>npm <strong class="ld hv">-</strong>v<br/><strong class="ld hv">RUN </strong>node <strong class="ld hv">-</strong>v<br/><br/># Install app dependencies<br/><strong class="ld hv">COPY </strong>package.json <strong class="ld hv">/</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<strong class="ld hv">/<br/>COPY </strong>package-lock.json <strong class="ld hv">/</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<strong class="ld hv">/<br/><br/>RUN </strong>npm install<br/><br/># Bundle app source<br/><strong class="ld hv">COPY </strong>. <strong class="ld hv">/</strong>usr<strong class="ld hv">/</strong>src<strong class="ld hv">/</strong>app<br/><br/># Environment variables<br/><strong class="ld hv">ENV </strong><em class="mn">NODE_ENV </em>test<br/><br/># Main command<br/><strong class="ld hv">CMD </strong>[ "npm", "test" ]</span></pre><p id="9973" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重新扫描后，詹金斯检查了一下:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ln"><img src="../Images/f31e2907340c83992093d7630c1c96cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eorMrHLE5QRUzwWGrovKOA.png"/></div></div></figure><p id="bf21" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和日志:</p><div class="jq jr js jt fq ab cb"><figure class="mp ju mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/abda0cb1207ce60118ae4dfe825b984c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*GwJMkLobtNKVUnzzLKpmMA.png"/></div></figure><figure class="mp ju mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/406c7c99e46f13a88eb5fddf5e06139b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*HhTuIrlmuyttTfVn4aXEFQ.png"/></div></figure><figure class="mp ju mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/545f371c29fa81976728657db58b40fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*cH5Ll-Rrzb_khh1l-qaWFg.png"/></div></figure></div><p id="5f2b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们看到很多有趣的信息。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ln"><img src="../Images/2c28646c6bb6bc84f138b51892e67e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wO0OwQdCLwCNbh5TjOmKpA.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mx"><img src="../Images/53115cd8fd131694c11d12cac74d761a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auAeKt8bNa9hyA6pqHyh1w.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mx"><img src="../Images/c409da4d08ef70bb434680f2ed84def7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZYwDixSe3ekEitokIV3xrA.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mx"><img src="../Images/b365caad7da76a061bf1cf446535d261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4QWJrcicvgnPycPkeFrhg.png"/></div></div></figure><p id="6d3b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们可以检查我们的图像存储在我们的注册表中。运行命令:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="3968" class="lh li hu ld b fv lj lk l ll lm">docker pull localhost:5000/react-app</span></pre><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mm"><img src="../Images/c64375f38749e1eff312a473c0c77c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hLDUuFFvJtcFPDjmKsEzlQ.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mm"><img src="../Images/5a9b587993ee0a61f550bcc7f0e632ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCj1V9a2_9dX9YIdKR-zQg.png"/></div></div></figure><p id="cdab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，您可以在生产服务器上运行该映像。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mm"><img src="../Images/01258712dc077458109a63f76fe14fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64GuhQmIJER5e92yn-HTeA.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mx"><img src="../Images/e276059aae07928b431ad85a6b211f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v06S9q58HQ9j8kuauYF-Ng.png"/></div></div></figure></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><p id="5dcf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，我为运行Jenkins和Docker registry创建了docker compose文件。我创建了Jenkinsfile和Dockerfile来测试和发布我们的应用程序。</p><p id="2be9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在接下来的文章中，我将展示如何使用SSR、模块化结构、webpack优化、混沌猴、测试和代码覆盖…</p></div></div>    
</body>
</html>