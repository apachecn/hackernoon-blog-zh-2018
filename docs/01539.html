<html>
<head>
<title>Ethereum Smart Contracts for Beginners: From Zero to End-to-End DApp</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初学者以太坊智能合约:从零到端到端DApp</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ethereum-smart-contracts-from-zero-to-end-to-end-dapp-ebae43cdf859?source=collection_archive---------2-----------------------#2018-02-18">https://medium.com/hackernoon/ethereum-smart-contracts-from-zero-to-end-to-end-dapp-ebae43cdf859?source=collection_archive---------2-----------------------#2018-02-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/a6a6980b9c0ca82685567e1dee05bcf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSJARu-MU8p-W1_xMIgDHQ.jpeg"/></div></div></figure><p id="8f7c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">48小时前，我走进<a class="ae ka" href="https://ethdenver.com/" rel="noopener ugc nofollow" target="_blank"> ETHDenver </a>，对以太坊智能合约开发几乎一无所知，带着一个端到端的DApp离开。</p><p id="fd94" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我有很多关于智能合约的问题——它是什么/创建智能合约的过程/标准构建工具/与智能合约交互的方式。我想在这里分享我的一些心得，希望它能对其他想了解这个过程的开发人员有所帮助。</p><h1 id="8abf" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">在开始之前</h1><p id="815d" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">确保在您的机器上安装了<a class="ae ka" href="https://nodejs.org/en/blog/release/v8.0.0/" rel="noopener ugc nofollow" target="_blank">节点≥ 8 </a>。这将使将来编写我们的async/await功能更加容易。</p><p id="6321" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你愿意跟随完整的代码:<a class="ae ka" href="https://github.com/qimingfang/shares-contract" rel="noopener ugc nofollow" target="_blank">https://github.com/qimingfang/shares-contract</a></p><h1 id="9390" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是智能合同？</h1><p id="100c" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">如果你有面向对象的编程背景，可以这样想:</p><ul class=""><li id="3739" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">智能合同==类</li><li id="d27c" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">当您向公众<a class="ae ka" href="https://hackernoon.com/tagged/blockchain" rel="noopener ugc nofollow" target="_blank">区块链</a>“部署”智能合约时，您将获得智能合约的一个地址(在区块链)，类似于<code class="eh ls lt lu lv b">new Object()</code>的返回值是一个地址(在内存中)</li><li id="ec0d" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">我们可以编写代码，通过调用方法来与“活”智能合约的特定实例进行交互。读取方法是快速的；写方法需要一段时间，因为我们需要等待下一个块被挖掘。</li><li id="b2b8" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">契约可以遵循标准(比如OO接口)，比如ERC-20标准。遵循该标准的契约必须实现所需的方法。</li></ul><h1 id="e041" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">设置松露</h1><p id="efb8" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><a class="ae ka" href="https://github.com/trufflesuite/truffle" rel="noopener ugc nofollow" target="_blank"> Truffle </a>是一个开发<a class="ae ka" href="https://hackernoon.com/tagged/ethereum" rel="noopener ugc nofollow" target="_blank">以太坊</a>智能合约的框架。它提供了一个很好的文件结构布局、测试、控制台、调试和一些工具。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="b5c3" class="me kc hu lv b fv mf mg l mh mi">npm install -g truffle</span></pre><p id="3e62" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">启动一个新的松露项目简单明了。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="3b87" class="me kc hu lv b fv mf mg l mh mi">$ mkdir shares<br/>$ cd shares<br/>$ truffle init</span></pre><p id="61bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您会注意到truffle为您设置了3个目录:</p><ul class=""><li id="38b9" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated"><strong class="je hv">合同— </strong>这是智能合同的发展方向。您会注意到已经有了一个<code class="eh ls lt lu lv b">Migrations.sol</code>文件。这是稍后运行迁移(部署您的智能合同)所必需的。</li><li id="ff03" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><strong class="je hv">迁移</strong> —这是您编写迁移的地方。迁移用于部署您的智能合同。</li><li id="5268" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><strong class="je hv">测试</strong> —合同的摩卡风格测试</li></ul><p id="6650" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">还有一个truffle.config文件。这用于配置环境(使用哪个RPC节点)。是的，您可以使用Truffle将您的智能合约部署到mainnet和testnet。</p><h1 id="6792" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">在Solidity中编写智能合同</h1><p id="2885" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">这里是一个裸骨<em class="mj"> hello world </em>风格的智能合约。这是无耻地从<a class="ae ka" href="https://github.com/uport-project/demo/blob/9e030e70bafb363cac720fbc26b97faec941f69a/src/contract/Shares.sol" rel="noopener ugc nofollow" target="_blank"> uport-demo </a> repo中摘取的。</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mk ml l"/></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">contracts/shares.sol</figcaption></figure><p id="d2b2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个契约是对一个<code class="eh ls lt lu lv b">mapping (address =&gt; uint)</code>对象的包装。你可以把Solidity中的一个<code class="eh ls lt lu lv b">mapping</code>想象成一个Map &lt;地址，Java中的Int &gt;，Swift中的NSDictionary。</p><p id="d4a0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个契约公开了两个公共方法:一个getter和一个setter。很简单，对吧？</p><h1 id="626a" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">测试智能合约</h1><p id="5211" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">将合同部署到mainnet / testnet进行测试不仅很慢，而且它是不可变的，可能会花费您相当多的钱。因此，在开发智能合同时采用TDD非常重要。</p><p id="ae7a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将使用<a class="ae ka" href="http://chaijs.com/" rel="noopener ugc nofollow" target="_blank"> chai </a>来测试这个联系，因为chai为我们提供了很多很好的语法来断言事物是相等的。我们可以利用可读性更好的hamcrest风格<code class="eh ls lt lu lv b">a.should.be.equal(b)</code>，而不是直接从node.js导入<code class="eh ls lt lu lv b">assert</code>，并断言与junit风格<code class="eh ls lt lu lv b">assert.equal(a, b)</code>相等。</p><p id="7a5a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，让我们安装一些依赖项</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="d766" class="me kc hu lv b fv mf mg l mh mi">$ npm init<br/>$ npm install --save-dev --save-exact chai chai-as-promised chai-bignumber</span></pre><p id="5a4c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后我们创建两个测试</p><ul class=""><li id="4c89" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">测试合同创建是否正确</li><li id="507b" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">测试updateShares和getShares是否按预期工作</li></ul><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mk ml l"/></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">test/shares.test.js</figcaption></figure><p id="5a0d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">运行<code class="eh ls lt lu lv b">truffle test</code>以确保您看到测试通过。</p><h1 id="7670" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">部署到当地区块链</h1><p id="b2cb" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">智能合同已经编写并经过测试。我们对其业务逻辑和正确性充满信心。现在是时候将它部署到本地区块链上进行测试了。</p><p id="c5f8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，让我们用<a class="ae ka" href="http://truffleframework.com/ganache/" rel="noopener ugc nofollow" target="_blank"> ganache </a>设置一个本地区块链(下载并安装)。Ganache预装了10个测试帐户(每个帐户有100个ETH)。还要注意RPC服务器URL。我们很快就会需要它。</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mq"><img src="../Images/2a657c8010ae11d61b8da339711e139b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cApmJQCnFBpYRJ_47emIg.png"/></div></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">Ganache</figcaption></figure><p id="ee0c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们需要创建一个迁移</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mk ml l"/></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">migrations/2_deploy_contracts.js</figcaption></figure><p id="1147" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我们需要将ganache添加到我们的块菌配置中。<code class="eh ls lt lu lv b">port</code>应该对应来自ganache的端口号。</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mk ml l"/></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">truffle.js</figcaption></figure><p id="fdc2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">准备好将合同部署到您的加纳切当地区块链了吗？</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="b889" class="me kc hu lv b fv mf mg l mh mi">$ truffle migrate --network development</span></pre><p id="38c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您应该开始看到合同出现在<code class="eh ls lt lu lv b">Transactions</code>选项卡下。</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/8ff51aec4a21d494088bb67e677c9dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IrDd4MMb9l2fkN8jhs6L1g.png"/></div></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">Ganache showing contract deployment</figcaption></figure><h1 id="8d83" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">部署到Rinkeby测试网上</h1><p id="e2af" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">当您可以将合同部署到公共区块链时，它们会更有用。为了连接到一个测试网，我们需要运行另一个指向以太坊测试网的RPC客户端(我们将使用Rinkeby，但是还有一些测试网可用)。</p><p id="4758" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，你需要<a class="ae ka" href="https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Mac" rel="noopener ugc nofollow" target="_blank">和</a>。</p><p id="e697" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，您需要使用geth创建一些Rinkeby帐户</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="293a" class="me kc hu lv b fv mf mg l mh mi">geth --rinkeby account new</span></pre><p id="52b8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">列出您的Rinkeby geth帐户，以确保您能够创建一个帐户。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="37a2" class="me kc hu lv b fv mf mg l mh mi">geth --rinkeby account list</span></pre><p id="6a77" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦完成，你将需要一些测试。你可以按照这个水龙头上的说明，去找ETH做一些测试。</p><p id="7256" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦交易被确认，您应该能够在rinkeby etherscan UI上看到它。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="e59f" class="me kc hu lv b fv mf mg l mh mi"><a class="ae ka" href="https://rinkeby.etherscan.io/address/" rel="noopener ugc nofollow" target="_blank">https://rinkeby.etherscan.io/address/</a>&lt;your address here&gt;</span></pre><p id="e5c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要在Rinkeby上部署契约，您需要启动geth并将其指向rinkeby网络。你需要打开你刚刚创建的钱包(用水龙头里的ETH ),这样松露就可以和它互动了。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="032b" class="me kc hu lv b fv mf mg l mh mi">./build/bin/geth --rinkeby --rpc --rpcapi db,eth,net,web3,personal --unlock="&lt;your address here&gt;"</span></pre><p id="f4c3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如，对我来说，它看起来像这样</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="5516" class="me kc hu lv b fv mf mg l mh mi">./build/bin/geth --rinkeby --rpc --rpcapi db,eth,net,web3,personal --unlock="0xcfd31d9ffb5bc1b1f4b7af99cd4792f2b11da185"</span></pre><p id="960c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你需要等待geth在网络上同步块。在同步的同时，让我们为Rinkeby设置另一个松露环境。</p><p id="522f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保将<code class="eh ls lt lu lv b">from</code>字段替换为您帐户的公钥。气体的选择有点武断。只要选择一个足够高的数字，不超过块气体限制。</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mk ml l"/></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">truffle.js</figcaption></figure><p id="1a5b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里是你如何找出什么是块气体极限</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ms"><img src="../Images/20c98e1562f5902639541163a49841b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nt_Bv3T__npCiwmEwQXdtw.png"/></div></div></figure><p id="3757" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您的geth可能仍在同步。与此同时，我们可以看看松露控制台，并获得对web3的介绍。</p><p id="1a21" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">web3是一个js库(通常嵌入HTML的客户端),用于与智能合约接口。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="8e7d" class="me kc hu lv b fv mf mg l mh mi">$ truffle console --network rinkeby<br/>$ truffle(rinkeby)&gt; truffle(rinkeby)&gt; web3.eth.getBlock('latest')</span></pre><p id="8cda" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，您将看到geth客户端报告的最新块。它有很多我们听说过的内容，比如gasLimit、nonce(用于挖掘)、括号(用于形成链)等。很棒的东西。</p><p id="7f22" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击这里，你可以在web3 <a class="ae ka" href="https://github.com/ethereum/wiki/wiki/JavaScript-API" rel="noopener ugc nofollow" target="_blank">上找到更多文档。</a></p><h1 id="efd4" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">等待geth同步</h1><p id="3384" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">…缓冲…</p><h1 id="9557" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Geth完成同步—部署！🎉</h1><p id="26b4" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">好了，是时候在Rinkeby上运行迁移了！</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="fdc6" class="me kc hu lv b fv mf mg l mh mi">$ truffle migrate --network rinkeby</span></pre><p id="c4fb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">随着契约的部署，您会注意到在幕后，它实际上在Rinkeby testnet上生成契约创建事务。</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/1ed27cd21367bc72d01f20fc33c0b9ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IgEnCSYen2eKdGaMHvb11w.png"/></div></div></figure><p id="2b35" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当您运行迁移时，您应该在terminal中看到一个契约地址，它指向我们的shares契约实例。您也可以在<a class="ae ka" href="https://rinkeby.etherscan.io/address/0xa8cfeebf26c6a04483b047aeff7b9da99d9d31ff#code" rel="noopener ugc nofollow" target="_blank"> etherscan </a>上查看这份合同。</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/36de1a1ece049b48711124e2da6c4399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*7k_PAioDrqeL24q7AuDy6w.png"/></div></figure><h1 id="50fc" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Web3.js —前端</h1><p id="24ea" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">既然我们的合同已经部署，我们现在可以使用一个简单的web DApp与它进行交互:</p><ol class=""><li id="8e6f" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz mv lk ll lm dt translated">在中包含web3.js脚本</li><li id="7951" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">用本地geth实例化web3实例</li><li id="6a45" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">用abi文件实例化契约(这是编译契约时出现的接口文件。您可以通过查看<code class="eh ls lt lu lv b">/build/contracts/shares.json</code>中编译的json来找到这一点</li><li id="83c6" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">使用(3)中的接口找到特定的已部署契约</li><li id="2868" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">相应地调用契约接口的函数</li></ol><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mk ml l"/></div></figure><p id="fd45" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">每次你点击购买按钮，交易的url将被发送到控制台。您可以点击网址观看您的交易完成。完成后，您可以刷新页面，并看到共享数量增加。</p><p id="d468" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此处完成代码:【https://github.com/qimingfang/shares-contract T4】</p><h1 id="1371" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论/学习</h1><p id="2668" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在我看来，尽管被广泛采用，但是在solidity开发空间中仍然缺少很多工具。我注意到的一些(技术性和非技术性的)事情:</p><ol class=""><li id="33aa" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz mv lk ll lm dt translated">调试很困难— <code class="eh ls lt lu lv b">truffle debug</code>对我来说并不奏效。</li><li id="bcff" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">除了通过<code class="eh ls lt lu lv b">truffle console</code>之外，在本地测试网上测试合同并不容易。这类似于通过进入node而不是使用Postman或其他HTTP客户端来测试node.js应用程序。</li><li id="5b18" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">没有简单的方法来保证你的合同是正确的。您可以编写测试并测试每一条代码路径，但这在开发领域很少发生。用契约界面测试web用户界面更加棘手。现在的标准是使用审计过的合同作为基础。Open-Zeppelin 的设置非常简单。</li><li id="f544" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">除了坚固性，还有各种其他的<a class="ae ka" href="https://github.com/iurimatias/embark-framework/" rel="noopener ugc nofollow" target="_blank">框架</a>(和<a class="ae ka" href="https://github.com/ethereum/vyper" rel="noopener ugc nofollow" target="_blank">语言</a>)可供选择。这进一步增加了风险；你不仅要编写正确的智能契约，框架还要将它们正确地编译成以太坊字节码。</li><li id="8da5" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">合同是不可改变的。关于如何升级这些合同，我从专家那里得到了各种各样的意见。<a class="ae ka" href="https://blog.zeppelin.solutions/proxy-libraries-in-solidity-79fbe4b970fd" rel="noopener ugc nofollow" target="_blank">代理</a>似乎是现在做这件事的标准方式，它需要和开发合同本身一样多的审计/严格性。想象一下每次部署rest-api服务器时都要进行完整的代码审计。那太疯狂了！</li><li id="1a6d" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz mv lk ll lm dt translated">目前，许多工作都是在协议层面上完成的。我不认为这是巧合。由于其他协议将建立在基础协议之上，目前协议正在产生巨大的网络效应。在区块链工作的一个很酷的事情是，没有人知道基于<em class="mj">正确</em>协议的激励模型(通货膨胀、参与等)，这将导致巨大的网络效应。当然，如果你最终为一个杀手级用例构建了一个杀手级应用，你可能会回头为这个杀手级应用定义一个协议。</li></ol><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mw ml l"/></div></figure></div></div>    
</body>
</html>