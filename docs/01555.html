<html>
<head>
<title>How we brought down the size of our app from 31 MB to 2.6 MB and what it taught us</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何将应用程序的大小从31 MB缩减到2.6 MB，以及它教会了我们什么</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-we-brought-down-the-size-of-our-app-from-31-mb-to-2-6-mb-and-what-it-taught-us-3a75963317f9?source=collection_archive---------4-----------------------#2018-02-19">https://medium.com/hackernoon/how-we-brought-down-the-size-of-our-app-from-31-mb-to-2-6-mb-and-what-it-taught-us-3a75963317f9?source=collection_archive---------4-----------------------#2018-02-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="5bec" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated"><strong class="ak"><em class="jj">TL；当涉及到你的产品质量时，不要固执己见。</em>T3】</strong></h2></div><p id="7e96" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">四周前，我在Play Store发布了我的第一个应用<a class="ae kg" href="https://goo.gl/nvjNRc" rel="noopener ugc nofollow" target="_blank">。在谈到故事的细节之前，先介绍一下背景。</a></p><p id="a767" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我是政府工程学院计算机系四年级学生<strong class="jm hv">伊尔沙德</strong>。在过去的几年里，我一直致力于编程和应用程序开发。</p><p id="274e" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">故事开始于大约5个月前；当有一天，大二的<strong class="jm hv">阿图尔·奈尔</strong>跟我说，他想学Android应用开发。</p><p id="c4a4" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">学习任何东西的最好方法实际上就是去做。我的建议是先做一个简单的Android应用，然后在这个过程中学习。我加入了一个应用程序的陈词滥调。</p><blockquote class="kh ki kj"><p id="5119" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated"><strong class="jm hv">一个老生常谈的想法……</strong></p></blockquote><p id="c63c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">一个应用程序，只显示其他WhatsApp用户的最近状态，并可以选择分享和保存。<br/>用户可以向WhatsApp发布超过30秒的视频。<br/>用户可以通过添加定制的可视化和图像来发布音频状态。<br/> NB: <em class="kk"> WhatsApp状态功能当时还年轻。所以这听起来是个好主意。</em></p><blockquote class="kh ki kj"><p id="6df4" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated"><strong class="jm hv">于是我们开始制作！</strong></p></blockquote><p id="be57" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这是我那天画的整个应用程序的草图。</p><p id="ab8b" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><em class="kk">(我们代号it项目吉祥物；不知道为什么</em>😂<em class="kk"> ) </em></p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="fe ff ko"><img src="../Images/74aa48bec881bb7c6834a64705933198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X8rrC9wzupB96YTqpbv91g.jpeg"/></div></div><figcaption class="la lb fg fe ff lc ld bd b be z ek"><strong class="bd le"><em class="jj">Excuse my bad doodling skills combined with terrible handwriting 😁</em></strong></figcaption></figure><blockquote class="kh ki kj"><p id="ccfa" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated"><strong class="jm hv">又发生了什么？</strong></p></blockquote><p id="0a27" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">嗯，我们把任务分成三份。</p><ol class=""><li id="8b14" class="lf lg hu jm b jn jo jq jr jt lh jx li kb lj kf lk ll lm ln dt translated">"最近"</li><li id="cd0b" class="lf lg hu jm b jn lo jq lp jt lq jx lr kb ls kf lk ll lm ln dt translated">"视频状态"</li><li id="fb16" class="lf lg hu jm b jn lo jq lp jt lq jx lr kb ls kf lk ll lm ln dt translated">"音频状态"</li></ol><p id="ab02" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我最初的兴奋和热情使我在2-3天内建立了“最近”功能，因为这对我们来说是一个相当简单和熟悉的任务。</p><p id="639a" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">然后我开始协助Atul开发视频状态功能。由于我还有其他几个项目，大部分时间我只研究Android视频库之类的东西，而他则尝试一些实际的代码。</p><blockquote class="kh ki kj"><p id="c19a" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated"><strong class="jm hv">“视频状态”功能完成..但是等等… </strong></p></blockquote><p id="fda1" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">是的，他是一个很好的学习者，在一周内，他给我发了一个apk，有我们谈论的视频分割功能！一切都很顺利，但只有一个问题！</p><blockquote class="kh ki kj"><p id="ae27" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated"><strong class="jm hv">apk大小31 mb，我根本不接受。</strong></p></blockquote><p id="fd20" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我们决定使用著名的<a class="ae kg" href="https://www.ffmpeg.org/" rel="noopener ugc nofollow" target="_blank"> ffmpeg </a>库进行视频处理。最简单的方法是通过编写命令来使用著名的<a class="ae kg" href="https://github.com/WritingMinds/ffmpeg-android" rel="noopener ugc nofollow" target="_blank"> Ffmpeg-Android </a>库。我们使用最初的<a class="ae kg" href="https://github.com/WritingMinds/ffmpeg-android/releases/tag/v0.3.4" rel="noopener ugc nofollow" target="_blank">预建库</a>，它本身超过27 mb。这导致了apk的巨大规模</p><p id="4419" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我告诉他，我们应该努力，尽可能减少它。</p><p id="9796" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">经过更多的研究，谷歌搜索和几个星期后，他又来找我，apk大小现在是<strong class="jm hv"> <em class="kk"> 18 mb </em> </strong>！。这款应用的工作原理和以前一模一样。他遵循<a class="ae kg" href="https://github.com/WritingMinds/ffmpeg-android-java/issues/66" rel="noopener ugc nofollow" target="_blank">这个</a>并且只包含了armv7版本的ffmpeg，这有助于将应用大小减少一半。</p><p id="5ed5" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">所以我说好吧。这很好！但是还不够好！我告诉他…</p><blockquote class="lt"><p id="0140" class="lu lv hu bd lw lx ly lz ma mb mc kf ek translated">“应用程序大小应小于5 MB。否则，人们不会下载它，因此，我们不会发布它。”</p></blockquote><p id="bfc7" class="pw-post-body-paragraph jk jl hu jm b jn md iv jp jq me iy js jt mf jv jw jx mg jz ka kb mh kd ke kf hn dt translated">我对此很固执。我向他展示了Play Store中的一些视频编辑器应用程序，它们只占用不到5 MB的空间，我说<em class="kk">“如果他们能做到的话；为什么我们不能？”</em></p><p id="a7a4" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">所以我们又开始了，但是这个项目拖了很久，因为我们都忙于学术和考试。</p><blockquote class="kh ki kj"><p id="09d3" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated">有一天，他给我发信息说他把它的容量降到了10 MB以下！(我告诉过你这家伙不错)</p></blockquote><p id="d794" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">好的，这就够了..但是<strong class="jm hv"> <em class="kk">我很固执</em> </strong> <em class="kk">。我研究了一些本地开发的东西和方法来为Android编译我们自己的ffmpeg，只有基本的特性。没有一件事做得好。</em></p><p id="f497" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">时间过得很慢，日子一天天过去。有一天，他告诉我一个好消息</p><blockquote class="kh ki kj"><p id="5a21" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated">他做到了2.6 MB！(比最初的小12倍！！！)</p></blockquote><p id="32fa" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">他也很固执！..他在互联网上彻底研究了这个问题，找到了正确的解决方案。基本上他找了个原生C++编译。所以文件的ffmpeg与最少的功能，包括我们想要的功能。它是4 MB。然后他把它压缩成只需要2 MB的aar。下面是对1.2版apk文件的分析。</p><p id="fe53" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><em class="kk">(哎呀..其实就是</em><strong class="jm hv"><em class="kk">2.9 MB</em></strong><em class="kk"/><strong class="jm hv"><em class="kk">现在</em> </strong> <em class="kk">最新更新后包括支持WhatsApp for Business) </em></p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/b1b751a1a4cbdba18bde8c708d1efce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*9QMd5hA0Rm6dvvGgsuq9QQ.png"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">Package analysis of WhatSaga version 1.2.0</figcaption></figure><p id="acba" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我们还使用了proguard minify和drawable optimisation等功能，这样其他资源就不会占用太多空间。事情进展得更快了，我们没有等到创建“音频状态”功能*。我们在几天内就在Play Store上发布了我们的应用程序！！</p><p id="fded" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我们把它命名为<strong class="jm hv"> WhatSaga，<em class="kk"> ( </em> </strong> <em class="kk">因为这个名字很像WhatsApp，而</em> <strong class="jm hv"> <em class="kk"> Saga </em> </strong> <em class="kk">的意思是</em> <strong class="jm hv"> <em class="kk">更长的故事</em> </strong> <em class="kk">这是我们的主要特色！。)</em>如果你是好奇型的，一定要看看我们的应用:<a class="ae kg" href="https://goo.gl/nvjNRc" rel="noopener ugc nofollow" target="_blank">https://goo.gl/nvjNRc</a></p><blockquote class="kh ki kj"><p id="5bf0" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated"><strong class="jm hv">“好的。所以呢？”</strong></p></blockquote><p id="6517" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">让我们来看看我写这篇文章的原因。想象一下，如果我不固执的话！我可能会满足于10-15mb的解决方案，甚至更糟。这与2.6兆字节的相比是很糟糕的</p><p id="8828" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">你可能会问，在用户拥有千兆字节内存和带宽的现代手机中，应用程序的大小真的如此重要吗？</p><blockquote class="kh ki kj"><p id="83c1" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated"><strong class="jm hv">答案是肯定的！。应用程序大小比你想象的更重要。</strong></p></blockquote><p id="4a90" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果你有两个应用程序在相同的用户界面上做同样的事情，其中一个比另一个稍微重3-4 MBs，你会选择哪一个？答案显然是较轻的那个。<strong class="jm hv">更少的应用程序大小= &gt;更多快乐的用户</strong></p><blockquote class="kh ki kj"><p id="20c1" class="jk jl kk jm b jn jo iv jp jq jr iy js kl ju jv jw km jy jz ka kn kc kd ke kf hn dt translated">那么，我从中学到了什么？</p></blockquote><h2 id="0296" class="mj mk hu bd ml mm mn mo mp mq mr ms mt jt mu mv mw jx mx my mz kb na nb nc nd dt translated">要固执！</h2><p id="4467" class="pw-post-body-paragraph jk jl hu jm b jn ne iv jp jq nf iy js jt ng jv jw jx nh jz ka kb ni kd ke kf hn dt translated">耶！！对你正在制作的任何东西的质量要固执己见。无论是<strong class="jm hv">设计、</strong> <strong class="jm hv">执行时间</strong>还是<strong class="jm hv">视觉质量</strong> <strong class="jm hv">和外观、</strong>任何东西；固执己见，把自己和团队推向极限。在你的产品达到你想要的质量之前，不要放弃。</p><p id="3215" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果你已经读到这里，感谢你阅读这篇很长的文章。这是我第一篇关于媒体的文章，所以请原谅我的错误，并给我反馈和建议:)。<a class="ae kg" href="http://twitter.com/irshadshalu" rel="noopener ugc nofollow" target="_blank">考虑在twitter上关注我，了解我即将发表的文章的更多更新</a>。谢谢大家！！</p><p id="1657" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果你想了解完美主义的一个极端版本，请查看<a class="ae kg" href="https://www.cultofmac.com/421893/why-the-ipad-has-never-shipped-with-a-calculator-app/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm hv">为什么iPad从来没有附带计算器应用</strong> </a></p></div></div>    
</body>
</html>