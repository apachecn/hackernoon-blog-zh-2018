<html>
<head>
<title>Start testing with Capybara</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始用水豚测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/start-testing-with-capybara-f3ce82b44c4a?source=collection_archive---------44-----------------------#2018-02-19">https://medium.com/hackernoon/start-testing-with-capybara-f3ce82b44c4a?source=collection_archive---------44-----------------------#2018-02-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="df90" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Capybara是一个基于网络的自动化框架工具，用于测试Rails应用。它帮助你创建<strong class="it hv">功能测试</strong>，模拟用户如何通过浏览器与你的应用程序交互。</p><p id="b2a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一个通过浏览器测试应用程序的极好工具！</p><p id="bab4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">水豚</strong>不与网站互动，它只是你和网络驱动之间的一层。为此，您可以使用<strong class="it hv"> Selenium </strong> web驱动程序或水豚支持的任何其他驱动程序。</p><h1 id="93c9" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">配置水豚</h1><p id="bfd3" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated"><strong class="it hv">水豚</strong>可以很容易地与Rails中使用的通用测试框架集成。它通常与<a class="ae ks" href="https://kolosek.com/rails-rspec-setup/" rel="noopener ugc nofollow" target="_blank"> RSpec </a>一起用于写特性，但不常用于<a class="ae ks" href="https://kolosek.com/rspec-controller-test/" rel="noopener ugc nofollow" target="_blank">控制器测试</a>。</p><p id="353f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在开始之前，您需要将以下gem添加到您的<a class="ae ks" href="https://kolosek.com/rails-bundle-install-and-gemfile/" rel="noopener ugc nofollow" target="_blank">gem文件</a>中的:test组，并运行<code class="eh kt ku kv kw b">bundle install</code>:</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="ddaf" class="lf jq hu kw b fv lg lh l li lj">group :test do<br/>  gem 'capybara'<br/>  gem 'selenium-webdriver'<br/>end</span></pre><h1 id="0e9b" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">用水豚测试</h1><p id="477c" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">水豚配备了一种用户友好的DSL语言，它提供了提取信息、输入数据、测试或点击的帮助方法。</p><blockquote class="lk ll lm"><p id="6445" class="ir is ln it b iu iv iw ix iy iz ja jb lo jd je jf lp jh ji jj lq jl jm jn jo hn dt translated">默认情况下，水豚只会定位可见元素。这是因为真正的用户无法与不可见的元素进行交互。你可以在<a class="ae ks" href="http://www.rubydoc.info/github/teamcapybara/capybara/master#the-dsl" rel="noopener ugc nofollow" target="_blank"> rubydoc.info </a> <em class="hu">了解更多。</em></p></blockquote><h1 id="ca6e" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">常见DSL选项</h1><p id="eded" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">这里我们将介绍最常用的与web应用程序中的元素交互的DSL动作:</p><ul class=""><li id="3b99" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated"><strong class="it hv">找到</strong>特定元素并操纵它们:</li></ul><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="9bb5" class="lf jq hu kw b fv lg lh l li lj">find_field('field_name').value<br/>find_field(id: 'field_id').value<br/>find_link('link_name', visible: all).visible? find_button('button_name').click</span></pre><p id="aca2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想操作你的元素，这是每个优秀的程序员都应该知道的最重要的功能之一。你可以用它来找到你的链接、按钮和字段，检查它们是否对用户可见，或者点击它们。在引发错误之前，总是等待页面上出现一个元素。</p><ul class=""><li id="2af7" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated">通过<strong class="it hv">以下链接和按钮</strong>与网络应用程序交互:</li></ul><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="231d" class="lf jq hu kw b fv lg lh l li lj">click_link('link_id')<br/>click_link('link_text')<br/>click_button('button_name')<br/>click_on('link_text') # clicks on either link or button</span></pre><p id="1c1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您想要访问链接或按钮时，请始终使用这些选项之一。您可以通过使用id、标题、标签中的文本或元素的值来实现这一点。</p><ul class=""><li id="bd83" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated">与<strong class="it hv">表单元素</strong>交互:</li></ul><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="7cf1" class="lf jq hu kw b fv lg lh l li lj">fill_in('Title', :with =&gt; 'Example')<br/>choose('radio_button')<br/>check('checkbox') uncheck('checkbox')<br/>attach_file('image', 'image_path') # upload a file<br/>select('option', from: 'select_box') # select from dropdown</span></pre><p id="7c93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每当你想填写你的表格时，你应该使用这些可能性之一。根据元素的类型，当前值为:id、名称或相关的标签元素。唯一的例外是attach_file，它只能接受id和名称。</p><ul class=""><li id="c509" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated"><strong class="it hv">浏览槽页</strong>,使用:</li></ul><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="2524" class="lf jq hu kw b fv lg lh l li lj">visit('url_name')</span></pre><p id="6031" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以使用这个简单的命令轻松地浏览页面，或者仅使用以下命令访问当前页面:</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="7c1f" class="lf jq hu kw b fv lg lh l li lj">expect(page).to have_current_path(path_name)</span></pre><ul class=""><li id="79db" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated"><strong class="it hv">查询</strong>页面中是否存在某些元素:</li></ul><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="6923" class="lf jq hu kw b fv lg lh l li lj">expect(page).to have_selector('table tr')<br/>expect(page).to have_content('content_name')</span></pre><ul class=""><li id="8cbd" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated">使用<strong class="it hv">范围</strong>将某些操作限制在页面的特定区域内:</li></ul><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="e74a" class="lf jq hu kw b fv lg lh l li lj"># within(:xpath, 'actual_xpath') do<br/>  fill_in 'Title', with: 'Example'<br/>end</span></pre><p id="d58d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您想只在特定区域使用动作或使用这些特殊方法时，请使用<code class="eh kt ku kv kw b">within</code>方法:<code class="eh kt ku kv kw b">within_fieldset</code>用于特定字段集，<code class="eh kt ku kv kw b">within_table</code>用于特定表格。</p><ul class=""><li id="c078" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated"><strong class="it hv">用以下方法调试</strong>:</li></ul><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="d8f2" class="lf jq hu kw b fv lg lh l li lj">save_and_open_page # current snapshot of the page save_sceenshot('screenshot_name.png')<br/>save_and_open_screenshot # saves and automatically opens the screenshot</span></pre><p id="227b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您想要保存页面的快照时，只需将其中一行添加到您的代码中，或者您也可以使用以下命令来检索元素的当前状态:</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="c881" class="lf jq hu kw b fv lg lh l li lj">print page_name.html</span></pre><h1 id="daa8" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">火柴人</h1><p id="1857" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">当试图使用DSL或XPath查找元素时，通常会有两个或更多的<strong class="it hv">匹配</strong>。您可以使用以下方式自定义水豚查找元素的方式:</p><ul class=""><li id="41ef" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated"><strong class="it hv"> Capybara.exact </strong> —查找元素的精确匹配。</li><li id="35e4" class="lr ls hu it b iu ma iy mb jc mc jg md jk me jo lw lx ly lz dt translated"><strong class="it hv"> Capybara.match </strong> —控制多个元素匹配时Capybara的行为。</li></ul><p id="9daf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了避免在找到多个匹配时出现<strong class="it hv">模糊匹配</strong>错误，您应该考虑使用水豚支持的以下匹配策略:</p><ul class=""><li id="7e3d" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated"><strong class="it hv">:第一个</strong> —这将简单地选择第一个匹配的元素。</li><li id="e231" class="lr ls hu it b iu ma iy mb jc mc jg md jk me jo lw lx ly lz dt translated"><strong class="it hv">:一个</strong> —如果发现一个以上的元素，这将引发一个错误。</li><li id="8f73" class="lr ls hu it b iu ma iy mb jc mc jg md jk me jo lw lx ly lz dt translated"><strong class="it hv"> :prefer_exact </strong> —查找所有匹配的元素，但只返回第一个完全匹配的元素，其余的被丢弃。</li><li id="a663" class="lr ls hu it b iu ma iy mb jc mc jg md jk me jo lw lx ly lz dt translated"><strong class="it hv">:智能</strong>——如果<strong class="it hv"> Capybara.exact </strong>设置为<strong class="it hv">真</strong>，它将表现为<strong class="it hv">:一个</strong>。否则，它将试图找到确切的元素。如果找到多个元素，将再次引发错误。如果没有找到元素，则执行新的搜索。</li></ul><h1 id="7e6e" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">JavaScript和异步调用</h1><p id="92d2" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated"><strong class="it hv">异步JavaScript </strong>允许你与页面上还不存在的元素进行交互。当使用JavaScript在页面上创建新元素时，可能会发生这种情况:</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="2066" class="lf jq hu kw b fv lg lh l li lj">click_link('test')<br/>click_link('foo')</span></pre><p id="7214" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你点击“测试”链接，它将触发一个异步过程，这将显示“foo”链接。单击“foo”很可能会引发一个错误，因为该链接还不存在。</p><p id="13ed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">水豚可以通过等待一段时间来解决这个问题。您可以通过<code class="eh kt ku kv kw b">Capybara.default_max_wait_time</code>调整默认等待时间(默认为2秒)。</p><h1 id="d717" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">水豚和RSpec</h1><p id="1ca5" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">将<strong class="it hv">水豚与RSpec </strong>一起使用，就像在<code class="eh kt ku kv kw b">rspec_helper.rb</code>文件中添加<code class="eh kt ku kv kw b">require 'capybara/rails'</code>一样简单。要做到这一点，你需要预先安装<a class="ae ks" href="https://kolosek.com/rails-rspec-setup/" rel="noopener ugc nofollow" target="_blank">RSpec</a>。</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="3429" class="lf jq hu kw b fv lg lh l li lj">describe 'users' do<br/>  let! :each do<br/>    @user = FactoryGirl.create(:user)<br/>    login_as(@user)<br/>  end</span><span id="ccfa" class="lf jq hu kw b fv mf lh l li lj">  describe GET user#edit' do<br/>    it 'should update user' do<br/>      visit edit_user_path(@user)<br/>      within('#edit_user_path') do<br/>        fill_in 'email', with: '<a class="ae ks" href="https://kolosek.com/cdn-cgi/l/email-protection" rel="noopener ugc nofollow" target="_blank">[email protected]</a>'<br/>      end<br/>      click_button 'Save'<br/>      find_button('Save').click<br/>      expect(page).to have_content 'Success'<br/>    end<br/> end<br/>end</span></pre><p id="1bbf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一个简单的例子，展示了如何通过编辑用户来同时使用Capybara和RSpec。</p><p id="ec01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">希望这篇文章能帮助你理解啮齿动物水豚会对你的测试环境造成什么影响！</p><p id="73e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">订阅，敬请关注即将到来的文章！</strong></p></div><div class="ab cl mg mh hc mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hn ho hp hq hr"><p id="38d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ln">原载于2018年2月19日</em><a class="ae ks" href="https://kolosek.com/rails-capybara-setup/" rel="noopener ugc nofollow" target="_blank"><em class="ln">kolosek.com</em></a><em class="ln">。</em></p></div></div>    
</body>
</html>