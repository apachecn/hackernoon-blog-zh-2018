<html>
<head>
<title>Heroku’s handshake with mlab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Heroku和mlab的握手</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/herokus-handshake-with-mlab-7fea651fa8c2?source=collection_archive---------26-----------------------#2018-02-22">https://medium.com/hackernoon/herokus-handshake-with-mlab-7fea651fa8c2?source=collection_archive---------26-----------------------#2018-02-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/84d489f3f5c45f9db55f739007a6400f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*etPIUGEIegJtbaRqYVarCQ.jpeg"/></div></div></figure><p id="b80c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">平台即服务(PaaS)节省了我们设置虚拟服务器所需的时间，使可扩展性更容易，并减少了设置服务器的成本。</p><p id="a920" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最初，在云中设置服务器需要连接和配置所有类型的组件，但无服务器、Docker、Heroku等的引入使我们可以只关注应用程序。</p><p id="1bec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将把我们的MongoDB云服务(mlab)与我们的PaaS(Heroku)合并。这很重要，因为在使用PaaS时，它允许我们专注于开发和管理我们的应用程序，而不会被维护基础设施的想法所干扰。</p><p id="55f1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要成功完成这一过程，我们需要:</p><ul class=""><li id="51ca" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">Heroku CLI </li><li id="8556" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated"><a class="ae kj" href="https://git-scm.com/download/win" rel="noopener ugc nofollow" target="_blank">饭桶痛击</a>(当然)</li><li id="0694" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated"><a class="ae kj" href="https://www.mlab.com/login/?r=%2Fdatabases%2Fheroku_3wwgk424#users" rel="noopener ugc nofollow" target="_blank">一个mlab账户</a></li><li id="7b63" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated"><a class="ae kj" href="https://id.heroku.com/login" rel="noopener ugc nofollow" target="_blank">一个Heroku账号</a></li></ul><p id="c78b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们已经做好了一切准备，我们可以在我们的Heroku帐户上创建一个新的应用程序。为了这个项目，应用程序的名称是' mediumapp11 '。</p><p id="6be0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我们在mlab上创建一个名为“mediumapp11”的数据库。当我们的数据库启动并运行后，我们可以添加一个数据库用户，然后我们会在上面看到我们的MongoDB URI。这将帮助我们从本地主机连接到数据库。</p><p id="931a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们会有这种性质的东西:</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="120a" class="ky kz hu ku b fv la lb l lc ld">mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;<a class="ae kj" href="http://twitter.com/ds041678" rel="noopener ugc nofollow" target="_blank">@ds0*1*7</a>*.mlab.com:41678/mediumapp11</span></pre><p id="e89f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其中,“dbuser”标记是您创建的用户的用户名,“dbpassword”是该用户的密码。</p><p id="1ee4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在我们的本地主机上，我们可以创建一个“mediumapp11”文件夹，然后执行以下操作:</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="0672" class="ky kz hu ku b fv la lb l lc ld">heroku addons:add mongolab --app mediumapp11</span></pre><p id="f0ff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">“mediumapp11”所在的位置会显示您的应用程序名称。当这个完成后，我们应该在Heroku项目中找到mlab插件。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff le"><img src="../Images/aeecf2f8cba376c0c7210044b2a67ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*9VwACTUCoixVQkuCiVQuWQ.png"/></div></div></figure><p id="69b7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们终于可以创建一个“mediumapp11.js”文件了。我们将需要mongoose依赖来定义我们的模式和http。</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="5d9c" class="ky kz hu ku b fv la lb l lc ld">const mongoose = require('mongoose');</span><span id="4732" class="ky kz hu ku b fv lf lb l lc ld">const http = require('http');</span><span id="243e" class="ky kz hu ku b fv lf lb l lc ld">const Schema = mongoose.Schema;</span></pre><p id="7a46" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们可以定义我们的模式，创建一个文档，它是我们模型的实例，然后指定我们从mlab获得的URI。</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="9a84" class="ky kz hu ku b fv la lb l lc ld">let Team = mongoose.model('Team', TeamSchema);</span><span id="b542" class="ky kz hu ku b fv lf lb l lc ld">let db = mongoose.connection;</span><span id="8aeb" class="ky kz hu ku b fv lf lb l lc ld">let dbUrl = 'mongodb://mediumapp11:mediumapp11<a class="ae kj" href="http://twitter.com/ds041678" rel="noopener ugc nofollow" target="_blank">@ds041678</a>.mlab.com:41678/mediumapp11';</span></pre><p id="cd4f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我们可以监听错误，如果没有错误，我们就连接到我们的URI并保存一个特定的文档。</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="aa1e" class="ky kz hu ku b fv la lb l lc ld">db.on('error', function () {console.log('error');});</span><span id="b6e4" class="ky kz hu ku b fv lf lb l lc ld">mongoose.connect(dbUrl, function (err) {</span><span id="ae2c" class="ky kz hu ku b fv lf lb l lc ld">if (err) {  return console.log('there was a problem' + err);  }</span><span id="e36f" class="ky kz hu ku b fv lf lb l lc ld">console.log('connected!');</span><span id="da3b" class="ky kz hu ku b fv lf lb l lc ld">var team = new Team({ name: 'Jehovah'  });</span><span id="b013" class="ky kz hu ku b fv lf lb l lc ld">team.save(function (error, data) {</span><span id="8550" class="ky kz hu ku b fv lf lb l lc ld">if (error) {console.log(error);} </span><span id="a33a" class="ky kz hu ku b fv lf lb l lc ld">db.close();</span><span id="ccd8" class="ky kz hu ku b fv lf lb l lc ld">process.exit();</span><span id="aaca" class="ky kz hu ku b fv lf lb l lc ld">});</span><span id="993b" class="ky kz hu ku b fv lf lb l lc ld">});</span></pre><p id="8e46" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们应该确保用“mediumapp11”替换了“<dbuser>”，用“mediumapp11”替换了“<dbpassword>”，然后我们就可以运行应用程序了</dbpassword></dbuser></p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="ed6f" class="ky kz hu ku b fv la lb l lc ld">node mediumapp11.js</span></pre><p id="37b8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们现在可以刷新我们的mlab，然后转到文档，然后我们会发现我们的文档已保存。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ca"><img src="../Images/3459e06b3dd632ff0105e8acbd155beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RO_C2lzCw9nYehAfDnRSA.png"/></div></div></figure><p id="e1b5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你知道了什么，请告诉我👏👏👏。</p></div></div>    
</body>
</html>