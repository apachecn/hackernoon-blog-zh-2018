<html>
<head>
<title>Public IPFS Node behind NGINX Reverse Proxy &amp; How-to communicate with it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NGINXåå‘ä»£ç†èƒŒåçš„å…¬å…±IPFSèŠ‚ç‚¹&amp;å¦‚ä½•ä¸ä¹‹é€šä¿¡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/public-ipfs-node-behind-nginx-reverse-proxy-5682747f174b?source=collection_archive---------6-----------------------#2018-02-24">https://medium.com/hackernoon/public-ipfs-node-behind-nginx-reverse-proxy-5682747f174b?source=collection_archive---------6-----------------------#2018-02-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7b1a4dc523718336e30d488c8c9b5cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lGh_L0ldPWz1kFMcKvj4Qw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae jg" href="https://en.wikipedia.org/wiki/InterPlanetary_File_System" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/InterPlanetary_File_System</a></figcaption></figure><p id="3f02" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">ç”¨<strong class="jj hv">ä»¥å¤ªåŠ</strong>å’Œ<strong class="jj hv"> IPFS </strong>è¿›è¡Œå®éªŒï¼Œåœ¨è®¾ç½®<a class="ae jg" href="https://cryptoblox.co" rel="noopener ugc nofollow" target="_blank">https://cryptoblox.co</a>çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æƒ³æ‰“å¼€ä¸€ä¸ªIPFSçš„å…¬å…±èŠ‚ç‚¹ï¼Œä»¥ä¾¿ä»»ä½•äººä»ä»»ä½•åœ°æ–¹ä¸Šä¼ æ–‡ä»¶åˆ°IPFSâ€”â€”é€šè¿‡<strong class="jj hv"> CryptoBLOX </strong>ã€‚</p><p id="4ae1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">ä½¿ç”¨<a class="ae jg" href="https://github.com/ipfs/js-ipfs" rel="noopener ugc nofollow" target="_blank"> js-ipfs </a>ï¼Œæˆ‘èƒ½å¤Ÿå‘å…¬ä¼—å¼€æ”¾ä¸€ä¸ªipfsèŠ‚ç‚¹ï¼Œç„¶è€Œï¼Œæˆ‘å¶ç„¶å‘ç°äº†ä¸€ä¸ªé—®é¢˜:ipfs-apiç›®å‰ä¸æ”¯æŒ<strong class="jj hv"/><strong class="jj hv">HTTPS</strong>â€”â€”å°½ç®¡ä½¿ç”¨äº†<a class="ae jg" href="https://github.com/multiformats/multiaddr" rel="noopener ugc nofollow" target="_blank">å¤šåœ°å€</a>æ ¼å¼ã€‚ä¹Ÿè®¸å°†æ¥ä¼šæœ‰è®¡åˆ’ï¼Œä½†ç›®å‰è¿˜ä¸æ”¯æŒã€‚</p><p id="61f9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">æ˜¾ç„¶ï¼Œä½ ä¸èƒ½åœ¨åŒä¸€ä¸ªç½‘ç«™ä¸Šæ··åˆä½¿ç”¨HTTPå’ŒHTTPS(æ··åˆå†…å®¹æ‹¦æˆª)ã€‚</p><p id="dcd6" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">å› æ­¤ï¼Œæˆ‘å¿…é¡»è®¾ç½®<strong class="jj hv"> NGINX </strong>ä½œä¸ºæˆ‘æ­£åœ¨è¿è¡Œçš„<strong class="jj hv"> jsipfså®ˆæŠ¤è¿›ç¨‹</strong>çš„<strong class="jj hv">åå‘ä»£ç†</strong>ã€‚</p></div><div class="ab cl kf kg hc kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hn ho hp hq hr"><h1 id="ed53" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated"><strong class="ak">å®‰è£…å’Œè®¾ç½®JS-IPFSå®ˆæŠ¤è¿›ç¨‹</strong></h1><figure class="ll lm ln lo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lk"><img src="../Images/68c12130b25168ac5bd8f1b6613af6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bxLe5kBt0Oj7iQZTE2KNfQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae jg" href="https://github.com/ipfs/js-ipfs" rel="noopener ugc nofollow" target="_blank">https://github.com/ipfs/js-ipfs</a></figcaption></figure><p id="39f4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">é¦–å…ˆï¼Œæˆ‘å®‰è£…äº†IPFS:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="ea81" class="lu kn hu lq b fv lv lw l lx ly">npm install ipfs --global</span></pre><p id="d61a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">æˆ‘å†³å®šä»<strong class="jj hv"> CLI </strong>ä¸­ä½¿ç”¨å®ƒï¼Œå› æ­¤æˆ‘è¿è¡Œäº†ä»¥ä¸‹å‘½ä»¤(æ¥è‡ªjs-ipfs-apiæ–‡æ¡£ï¼Œå·²ç¼–è¾‘) :</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="1c51" class="lu kn hu lq b fv lv lw l lx ly"># Show the ipfs config API port to check it is correct<br/>&gt; jsipfs config Addresses.API<br/>/ip4/127.0.0.1/tcp/5001<br/># Set it if it does not match the above output<br/>&gt; jsipfs config Addresses.API /ip4/<strong class="lq hv">127.0.0.1</strong>/tcp/5001<br/># Restart the daemon after changing the config<br/><br/># Run the daemon<br/>&gt; jsipfs daemon</span></pre><p id="1ae4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">åœ¨æˆ‘çš„èŠ‚ç‚¹ã€‚JSæœåŠ¡å™¨(åœ¨æœ¬åœ°è¿è¡Œ<strong class="jj hv"/>)æˆ‘å®šæœŸè®¾ç½®å®ƒ:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="34ea" class="lu kn hu lq b fv lv lw l lx ly">var ipfs = ipfsAPI('localhost', '5001', {protocol: 'http'})</span></pre><p id="bdb8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘æƒ³è®©å®ƒä½œä¸ºåˆæ³•çš„<strong class="jj hv">å®ˆæŠ¤è¿›ç¨‹</strong>è¿è¡Œâ€”â€”é‡å¯åé‡å¯ï¼Œå´©æºƒåé‡å¯ï¼Œç­‰ç­‰ã€‚</p><p id="989e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">ä½¿ç”¨<strong class="jj hv"> systemctl </strong>æˆ‘èƒ½å¤Ÿå®ç°ä»¥ä¸‹åŠŸèƒ½:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="ced1" class="lu kn hu lq b fv lv lw l lx ly">vim /lib/systemd/system/jsipfs.service</span></pre><p id="5787" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="cc21" class="lu kn hu lq b fv lv lw l lx ly">[Unit]<br/>Description=JSIPFS Daemon Client<br/>[Service]<br/>ExecStart=/root/.nvm/versions/node/v8.9.1/bin/node /root/.nvm/versions/node/v8.9.1/bin/jsipfs daemon<br/>Restart=always<br/>RestartSec=30<br/>Type=simple<br/>User=root<br/>Group=root<br/>[Install]<br/>WantedBy=multi-user.target</span></pre><p id="e3fe" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="lz">æ³¨æ„ï¼ŒæœåŠ¡é…ç½®æ–‡ä»¶éœ€è¦</em> <strong class="jj hv"> <em class="lz">åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„</em> </strong> <em class="lz">ã€‚</em></p><p id="fdd1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">ç°åœ¨è¿è¡Œ:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="3bba" class="lu kn hu lq b fv lv lw l lx ly">systemctl daemon-reload</span><span id="d859" class="lu kn hu lq b fv ma lw l lx ly">systemctl start jsipfs</span><span id="be87" class="lu kn hu lq b fv ma lw l lx ly"># To see the last lines written to stdout / stderr by the process<br/>journalctl -u jsipfs -n50</span></pre></div><div class="ab cl kf kg hc kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hn ho hp hq hr"><h1 id="2541" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">å°†nginxè®¾ç½®ä¸ºåå‘ä»£ç†</h1><figure class="ll lm ln lo fq iv fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/ad1d8741f777ffa6f3bcddc16cad73a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*P9PdkCzC2vBU1leyoK0hHg.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae jg" href="https://nginx.com" rel="noopener ugc nofollow" target="_blank">https://nginx.com</a></figcaption></figure><p id="fc96" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œä¸ºäº†å¾—åˆ°ä¸€ä¸ª<strong class="jj hv"> SSL </strong>è¯ä¹¦ï¼Œæˆ‘ä½¿ç”¨äº†<strong class="jj hv"> Let's Encrypt </strong>ï¼Œæˆ‘å‘ç°è¿™ä¸ªè¯ä¹¦éå¸¸æœ‰ç”¨ï¼Œéå¸¸æ–¹ä¾¿ï¼Œå‡ åˆ†é’Ÿå°±å¯ä»¥è®¾ç½®å¥½ã€‚</p><p id="9e14" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">ç®€å•è·‘æ­¥:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="aff3" class="lu kn hu lq b fv lv lw l lx ly">sudo certbot --nginx -d cryptoblox.co</span></pre><p id="62f4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">åœ¨nginxä¸Šè®¾ç½®SSLï¼Œå¹¶æ·»åŠ ä¸€ä¸ªä»HTTPåˆ°HTTPSçš„<strong class="jj hv">é‡å®šå‘</strong>ï¼Œä¸éœ€è¦æ›´å¤šæ“ä½œã€‚</p><p id="96b2" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">ç»§ç»­ç¼–è¾‘nginx <strong class="jj hv">é…ç½®</strong>(<em class="lz">/etc/nginx/sites-available/default</em>)â€”åœ¨åŸå§‹æœåŠ¡å™¨åˆå§‹åŒ–åæ·»åŠ ä»¥ä¸‹ä»£ç ç‰‡æ®µ:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="3010" class="lu kn hu lq b fv lv lw l lx ly">server {<br/>    listen [::]:5002 ssl ipv6only=on; # managed by Certbot<br/>    listen 5002 ssl; # managed by Certbot<br/>    ssl_certificate /etc/letsencrypt/live/cryptoblox.co/fullchain.pem; # managed by Certbot<br/>    ssl_certificate_key /etc/letsencrypt/live/cryptoblox.co/privkey.pem; # managed by Certbot<br/>    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot<br/>    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot<br/>    server_name cryptoblox.co;</span><span id="f5df" class="lu kn hu lq b fv ma lw l lx ly">location / {<br/>        proxy_pass <a class="ae jg" href="http://localhost:5001" rel="noopener ugc nofollow" target="_blank">http://localhost:5001</a>;<br/>        proxy_set_header Host $host;<br/>        proxy_cache_bypass $http_upgrade;<br/>     }<br/>}</span></pre><p id="959d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">ç°åœ¨åªéœ€é‡å¯nginx å°±å¯ä»¥äº†ï¼</p></div><div class="ab cl kf kg hc kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hn ho hp hq hr"><h1 id="8a6e" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">ä¸å…¬å…±IPFSèŠ‚ç‚¹é€šä¿¡</h1><figure class="ll lm ln lo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mc"><img src="../Images/930273999aaf79f29083f5e8a6d89896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_oUW9xcJ1A9eKcQW_nJCw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae jg" href="https://github.com/ipfs/js-ipfs-api" rel="noopener ugc nofollow" target="_blank">https://github.com/ipfs/js-ipfs-api</a></figcaption></figure><p id="962a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">åœ¨<strong class="jj hv">å®¢æˆ·ç«¯</strong>ï¼Œåœ¨è¦æ±‚<a class="ae jg" href="https://github.com/ipfs/js-ipfs-api" rel="noopener ugc nofollow" target="_blank"> js-ipfs-api </a>åï¼Œæˆ‘ç®€å•åœ°ç”¨ä»¥ä¸‹æ–¹å¼åˆå§‹åŒ–å®ƒ:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="15c5" class="lu kn hu lq b fv lv lw l lx ly">var ipfsApi = ipfsAPI('cryptoblox.co', '5002', {protocol : "https"})</span></pre><p id="292c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">æˆ–è€…ï¼Œå¦‚æœæ‚¨éœ€è¦ä»–ä»¬çš„CDN:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="cd7e" class="lu kn hu lq b fv lv lw l lx ly">var ipfsApi = window.IpfsApi('cryptoblox.co', '5002', {protocol : "https"})</span></pre><p id="0822" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">ç„¶åï¼Œä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥å—ä¸€ä¸ª<strong class="jj hv">æ–‘ç‚¹</strong>ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°<strong class="jj hv"> IPFS </strong>:</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="9bf9" class="lu kn hu lq b fv lv lw l lx ly">async function saveToIPFSToBytes32(blob) {<br/>  var fileReader = await loadFileReader(blob);<br/>  var buff = Buffer.from(fileReader.result);<br/>  var result = await ipfsApi.add(buff, { progress: (prog) =&gt; {} });<br/>  return ipfsHashToBytes32(result[0].hash);<br/>}</span></pre><p id="92ca" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">è¯·æ³¨æ„ï¼Œæ–‡ä»¶ä¿å­˜åœ¨æ‚¨çš„èŠ‚ç‚¹<strong class="jj hv">æœ¬åœ°</strong>ä¸Šï¼Œç›´åˆ°å…¶ä»–äºº<strong class="jj hv">è¯·æ±‚</strong>å®ƒä»¬ï¼Œå› æ­¤åœ¨ä¸Šä¼ å®ƒä»¬ä¹‹åï¼Œæˆ‘ä»¬<strong class="jj hv">ç«‹å³å‘<a class="ae jg" href="https://ipfs.io" rel="noopener ugc nofollow" target="_blank">https://ipfs . io</a>T16ã€‘å…¨å±€</strong>ç½‘å…³å‘é€è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ–‡ä»¶æ•£åˆ—ã€‚</p><p id="0a1f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">å°±è¿™æ ·ï¼Œç°åœ¨ä½ å¯ä»¥é€šè¿‡<strong class="jj hv"> HTTPS </strong>ä¸ä½ çš„<strong class="jj hv">å…¬ä¼—</strong> IPFSèŠ‚ç‚¹äº¤æµäº†ã€‚</p><p id="f54d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">å¸Œæœ›å®ƒèƒ½å¸®åŠ©é‚£äº›è‡´åŠ›äºè®©äº’è”ç½‘æ›´åŠ åˆ†æ•£åŒ–çš„äººğŸ‘¼</p></div></div>    
</body>
</html>