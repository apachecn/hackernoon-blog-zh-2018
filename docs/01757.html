<html>
<head>
<title>What I learnt from building 3 high traffic web applications on an embedded key value store.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我从在嵌入式键值存储上构建3个高流量web应用程序中学到了什么。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/what-i-learnt-from-building-3-high-traffic-web-applications-on-an-embedded-key-value-store-68d47249774f?source=collection_archive---------0-----------------------#2018-02-25">https://medium.com/hackernoon/what-i-learnt-from-building-3-high-traffic-web-applications-on-an-embedded-key-value-store-68d47249774f?source=collection_archive---------0-----------------------#2018-02-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/f976f0a0fc626d1648e0f017d476ee3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_sXlAxit3i2M-FFaK_OQVg.png"/></div></div></figure><p id="1294" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我成长于所有web应用程序都必须建立在适当的架构之上的潮流中，通常涉及一个经过良好测试的稳定的sql数据库，如postgres，或者在某些情况下，一个nosql数据库，如mongodb。原因很简单:</p><ul class=""><li id="8756" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">它们可以被缩放，缩放，缩放。当你的应用程序在一夜之间拥有第一个10亿用户时，这一点非常重要。</li><li id="eec3" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">SQL是访问数据的最佳方式。您总是需要一个复杂的消息层来访问这些数据。</li><li id="b99b" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">如果不使用sql，您将如何执行连接？你将如何在复杂的搜索中构建？你将如何防止你的代码变得过于复杂，以至于掉下来砸死你的猫？</li></ul><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/7d7a075277f608e674a55514d2f840ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*UZfVU70VqwzFbbp50mRarQ.png"/></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Your cat is scared of your code.</figcaption></figure><ul class=""><li id="4646" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">为什么要构建这样一个应用程序，它不需要雇用有经验的数据库管理员来创建复杂的模式和执行非常重要和复杂的数据库维护任务。</li></ul><p id="613b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2015年，我偶然发现了golang <a class="ae kx" href="https://github.com/boltdb/bolt" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> BoltDB数据库库</strong> </a>，并首次用于基本的服务器端应用中保存状态。然后偶然发现了<a class="ae kx" href="https://github.com/blevesearch/bleve" rel="noopener ugc nofollow" target="_blank">T5】bleve searchT7】，恍然大悟。大多数数据库提供的最基本的东西是存储，以及对存储数据的灵活搜索。有了boltdb，我可以高效地存储我的数据，有了bleve，我可以用有趣的方式搜索和访问我的数据。</a></p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/f01be98a36e22ba66f4f6513faf2f2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:128/format:webp/1*CAgNR4s10WtvV4CG9AFFQg.png"/></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">blevesearch</figcaption></figure><p id="cff4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在此基础上，我在boltDB和blevesearch上构建并推出了<a class="ae kx" href="http://calabarpages.com" rel="noopener ugc nofollow" target="_blank"> Calabar黄页</a>，然后当我看到它在生产中的运行和扩展是如此顺利时，我继续在badger DB(bolt DB的一个更快的替代方案)和blevesearch上构建了<a class="ae kx" href="https://shop440.com" rel="noopener ugc nofollow" target="_blank">shop 440</a>(Shopify和Aliexpress的合并)用于索引。</p><h1 id="cc04" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">我学到了什么:</h1><h1 id="18a2" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">关键价值存储速度很快</h1><p id="9d08" class="pw-post-body-paragraph jc jd hu je b jf lx jh ji jj ly jl jm jn lz jp jq jr ma jt ju jv mb jx jy jz hn dt translated">首先，NoSQL键值存储很快，比类似的关系数据库快得多。它的速度来自于它的简单。键值数据库使用一个主键存储数据记录。该键表示记录是唯一可识别的，并且可以直接访问。除此之外，由开发人员来设计访问数据的复杂性。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/722b2a6b73035e1ed85fb7b9dd97e4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*zTzSNjtU-kudy78iZss1vw.png"/></div></figure><p id="180d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此外，因为我使用的键值存储是嵌入式数据库，所以我能够去掉更多已建立的数据库中的一些处理。在mongoDB这样的数据库中，<strong class="je hv">大量的资源和延迟用于序列化数据，并通过网络将其传递给客户端应用程序，然后客户端应用程序对其进行反序列化和解码</strong>。这是一种资源浪费，尤其是当客户机和数据库运行在同一台服务器上，而不是运行在不同的服务器上时，在这种情况下，客户机和数据库可以通过http进行通信。嵌入式数据库消除了所有这些额外的序列化甚至tcp传输成本。</p><h1 id="20e8" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">出色的可扩展性—一致性如何？</h1><p id="f1ea" class="pw-post-body-paragraph jc jd hu je b jf lx jh ji jj ly jl jm jn lz jp jq jr ma jt ju jv mb jx jy jz hn dt translated">其次，NoSQL键值数据库也是高度可伸缩的。这也是其简单性的一个功能。与关系数据库不同，NoSQL键值数据库不必垂直扩展。它可以在几台机器或设备上扩展几个数量级，而不需要重大的重新设计。从财务上来说，这也是一个很大的优势。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff md"><img src="../Images/d48cd8cdb8e2efaba27f92130fd8fcf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*seBbyRHICKfN87y7zq8I4A.png"/></div></figure><p id="da91" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是在我的例子中，由于使用了嵌入式键值存储，大多数扩展都是垂直进行的，甚至持续了很长时间。目前，即使数据库大小接近1tb，应用程序仍然保持强劲。对于badger，我想出了一个拥有多个badger数据库的策略，每个数据库代表一个集合。这样，如果我需要将系统扩展到单台服务器之外，我可以将每个单独的数据库及其相应的程序逻辑隔离到一个单独的微服务中。(以后我会多写这方面的内容。)</p><h1 id="0f9c" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">节省时间和精力</h1><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff me"><img src="../Images/62f6a02f3820e8876eeac09df4b97626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*U-XNO_Q3wVffyYxpEVpfvA.png"/></div></figure><p id="e60c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">扩展关系数据库解决方案通常意味着成本不成比例地增加；改变数据库模式也需要时间和精力(以及服务器停机时间)。相比之下，键值数据库使价格曲线保持线性，而不是指数曲线，它被设计成在没有任何预定义模式的情况下处理数据。一些(不是全部)关键值数据库，像其他NoSQL数据库一样，也是为“<strong class="je hv">最终一致性</strong>而设计的。这意味着数据会在不同机器上的副本之间“在某个时间点”同步，但不会立即同步。</p><h1 id="5a91" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">无模式的行和列</h1><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mf"><img src="../Images/10e8935702591b364d7e1ab627f0bb15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57qoZRSyu6H4zQHs8p3qJQ.png"/></div></div></figure><h1 id="d931" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">嵌入式键值存储的案例</h1><p id="85c7" class="pw-post-body-paragraph jc jd hu je b jf lx jh ji jj ly jl jm jn lz jp jq jr ma jt ju jv mb jx jy jz hn dt translated">据https://www.sqlite.org/whentouse.html的<a class="ae kx" href="https://www.sqlite.org/whentouse.html" rel="noopener ugc nofollow" target="_blank"/></p><blockquote class="mg mh mi"><p id="5f10" class="jc jd mj je b jf jg jh ji jj jk jl jm mk jo jp jq ml js jt ju mm jw jx jy jz hn dt translated">SQLite非常适合作为大多数中低流量网站(也就是说，大多数网站)的数据库引擎。SQLite能够处理的网络流量取决于网站使用其数据库的程度。一般来说，任何一个每天点击数少于100K的站点都应该可以很好地使用SQLite。100，000次点击/天的数字是一个保守的估计，而不是一个硬性的上限。SQLite已经被证明可以处理10倍的流量。</p><p id="889a" class="jc jd mj je b jf jg jh ji jj jk jl jm mk jo jp jq ml js jt ju mm jw jx jy jz hn dt translated">当然，SQLite网站(<a class="ae kx" href="https://www.sqlite.org/" rel="noopener ugc nofollow" target="_blank">https://www.sqlite.org/</a>)本身也使用SQLite，在撰写本文时(2015年)，它每天处理大约40万到50万个HTTP请求，其中大约15-20%是触及数据库的动态页面。动态内容使用<a class="ae kx" href="https://www.sqlite.org/np1queryprob.html" rel="noopener ugc nofollow" target="_blank">每个网页大约200条SQL语句</a>。这种设置运行在一个单独的虚拟机上，该虚拟机与另外23个虚拟机共享一个物理服务器，但仍然在大多数时间将平均负载保持在0.1以下。</p></blockquote><p id="f41e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">像badger这样的大多数嵌入式键值存储都比sqlite更高效，性能更好，所以这可以显示如果sqlite每天可以处理这么多的点击量，那么嵌入式键值存储还有多大的潜力。</p><p id="ac2d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此外，使用嵌入式键值存储以及像编译语言<a class="ae kx" href="https://hackernoon.com/tagged/golang" rel="noopener ugc nofollow" target="_blank"> Golang </a>中的Blevesearch这样的嵌入式索引引擎，意味着您可以真正部署单个二进制文件，没有外部依赖性，也不需要后期部署设置。</p><h1 id="13a0" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">简单地</h1><p id="86e2" class="pw-post-body-paragraph jc jd hu je b jf lx jh ji jj ly jl jm jn lz jp jq jr ma jt ju jv mb jx jy jz hn dt translated">嵌入式键值存储为您提供了nosql <a class="ae kx" href="https://hackernoon.com/tagged/database" rel="noopener ugc nofollow" target="_blank">数据库</a>的所有优势，但它的不足之处在于搜索，因为您只能通过关键字和关键字的前缀来查询项目。但当与golang中的blevesearch或elasicsearch和lucene等索引引擎配合使用时，这两个引擎将为您提供一个非常强大的数据库，在一个非常节省资源的包中提供全文搜索、基于位置的搜索等功能，并且扩展性很好。</p><p id="d416" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我相信这一对应该比现在更受欢迎，并且在降低服务器费用方面大有作为，特别是对于那些从来没有期待facebook级别规模的应用程序。</p><figure class="kp kq kr ks fq iv"><div class="bz el l di"><div class="mn mo l"/></div></figure></div></div>    
</body>
</html>