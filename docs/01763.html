<html>
<head>
<title>Raschietto: a simple library for web scraping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Raschietto:一个简单的网页抓取库</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/raschietto-a-simple-library-for-web-scraping-46957c6aa5b7?source=collection_archive---------6-----------------------#2018-02-25">https://medium.com/hackernoon/raschietto-a-simple-library-for-web-scraping-46957c6aa5b7?source=collection_archive---------6-----------------------#2018-02-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="3553" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我经常发现自己需要从一个没有API或RSS提要的网站获取数据。有许多不同的网页抓取库，但我不满意，我想要的东西能够:</p><ul class=""><li id="3938" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated"><strong class="it hv">使用CSS选择器</strong>。我在<a class="ae jp" href="https://matteo.ronchetti.xyz/#resume" rel="noopener ugc nofollow" target="_blank">做过全栈开发人员</a>，所以比起XPath，我更喜欢使用CSS选择器。</li><li id="25a5" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated"><strong class="it hv">几乎不需要多长时间就能制造出工作刮刀</strong>。大多数时候我不需要非常复杂或先进的东西，我只需要非常快速地制作一个简单的刮刀。</li></ul><p id="2180" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这促使我创建了一个名为<a class="ae jp" href="https://github.com/matteo-ronchetti/raschietto" rel="noopener ugc nofollow" target="_blank"> Raschietto </a>(意大利语中scraper的意思)的简单刮库。以下是它的主要特点:</p><ul class=""><li id="fbfa" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">CSS选择器</li><li id="a400" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">HTML页面的单行获取和解析</li><li id="907e" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">用于匹配页面中元素的简单且可扩展的方法</li><li id="72f9" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">针对常见任务的预构建匹配器(例如提取链接和图像)</li></ul><p id="ca36" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该库目前处于测试阶段(但足够稳定)，并且只支持Python3(添加Python2支持相当简单)。</p><p id="12ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我分享这个库是因为我认为它可以加速构建简单的刮刀的过程，并且因为它的小代码库(&lt;170 lines of code) can be useful for learning purpose.</p><p id="4be9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">You can install it with:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="4930" class="kn ko hu kj b fv kp kq l kr ks">pip install raschietto</span></pre><h1 id="3f16" class="kt ko hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">Scraping arXiv</h1><p id="8813" class="pw-post-body-paragraph ir is hu it b iu lq iw ix iy lr ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">As an example to learn how to use <a class="ae jp" href="https://hackernoon.com/tagged/raschietto" rel="noopener ugc nofollow" target="_blank"> raschietto </a>)为了展示它的能力，我将指导你完成一个arXiv网页的刮削。请注意，arXiv有一个非常好的RSS提要，所以它的数据可以很容易地访问，不需要抓取，但我们仍然会出于教育目的抓取它。</p><p id="29a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将重点关注包含最新机器学习论文的页面。</p><figure class="ke kf kg kh fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lv"><img src="../Images/0cf8aa6e10466745d01572137db75925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_h0iSLkumYiHdgVceh4fw.jpeg"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">The page with Chrome dev tools opened</figcaption></figure><p id="a878" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为起点，我们从获取最新论文的标题开始。由于raschietto使用CSS选择器，这个任务是非常容易的。使用Chrome，我们可以复制CSS选择器，使用开发工具选择特定的元素。只需将鼠标放在想要的元素上(在DOM视图中)&gt;右键单击&gt;复制&gt;复制选择器</p><figure class="ke kf kg kh fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mh"><img src="../Images/a7d3f2bec42513bd8db6a1e56bd5b9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pIb7ypjyDsiBQdfq5wxhXQ.jpeg"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">How to get a CSS selector with Chrome dev tools</figcaption></figure><p id="d9f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们得到以下选择器:</p><p id="76cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"># dl page &gt; dl &gt; DD:n-child(2)&gt; div &gt; div . list-title . math jax</p><p id="0ce5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该选择器特定于该标题元素，因此它不会选择其他标题元素。通过查看页面的HTML代码，我们可以修改它以获得一个更简单的选择器，它将选择所有需要的元素:</p><p id="80d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">。meta。列表标题</p><p id="a540" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们不确定选择器的正确性，我们可以使用控制台(在开发工具中)来测试它</p><figure class="ke kf kg kh fq lw fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/655a243541a73ecb36991faa5f4b6086.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*jh3koVnT-KhFsOz5KdqaMQ.jpeg"/></div></figure><p id="8834" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">用raschietto获取论文标题的代码简单明了</p><figure class="ke kf kg kh fq lw"><div class="bz el l di"><div class="mj mk l"/></div></figure><p id="3c13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们使用两个raschietto组件:</p><ul class=""><li id="30c7" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">Raschietto是一个包含该库所有主要功能的类。在这个例子中，我们用它来获取和解析一个HTML页面</li><li id="5fa1" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated"><strong class="it hv"> Matcher </strong>是一个封装了匹配逻辑的类。默认情况下，它返回匹配元素的内部文本，我们将在后面看到如何改变这种行为。</li></ul><p id="b268" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们现在得到一个标题列表，所有标题都以“Title:”开头，为了删除前7个字符，我们可以使用Matcher类的映射功能</p><figure class="ke kf kg kh fq lw"><div class="bz el l di"><div class="mj mk l"/></div></figure><p id="066f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们所做的唯一改变是将映射参数添加到我们的匹配器中。这个函数有两个参数:匹配的元素和包含的页面。我们使用Raschietto函数将匹配的元素映射到它的内部文本，然后使用python切片来删除前7个字符，获得清理后的标题列表。</p><p id="63fe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们现在希望做一些更高级的事情:我们希望匹配每篇论文的标题和作者列表。为此，我们需要:</p><ol class=""><li id="2cbe" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo ml jw jx jy dt translated">匹配所有的”。元”元素</li><li id="4651" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo ml jw jx jy dt translated">对于每个匹配的元素，获取包含的论文标题</li><li id="db43" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo ml jw jx jy dt translated">对于每个匹配的元素，获取包含的作者列表</li></ol><p id="e74a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Matcher类的映射功能使得这个任务非常简单，我们只需要匹配所有的。元”元素，并将它们映射到包含标题和作者列表的<em class="mm">字典</em>。</p><figure class="ke kf kg kh fq lw"><div class="bz el l di"><div class="mj mk l"/></div></figure><p id="1855" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">只用几行代码，我们就创建了一个漂亮的刮刀！</p><p id="416a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当然，这对我们来说还不够:我们还想获得论文的链接。由于arXiv页面的结构，这似乎有问题。</p><figure class="ke kf kg kh fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mn"><img src="../Images/cb7f07e76f8f57f07fafa3ff5cb236a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rc2uirEVsEZTE8YGYhKAzQ.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">I’m terrible at drawing</figcaption></figure><p id="d24f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">标题和链接包含在不同的元素中，使用它们的第一个公共父元素是没有用的，因为它包含了所有的论文元素。要获得链接，我们必须:</p><ol class=""><li id="96f0" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo ml jw jx jy dt translated">匹配的”。元”元素</li><li id="c7a1" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo ml jw jx jy dt translated">选择其父元素(“dd”元素)</li><li id="738d" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo ml jw jx jy dt translated">选择“dd”元素之前的元素(因此我们得到“dt”元素)</li><li id="8f5e" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo ml jw jx jy dt translated">匹配链接到“https://arxiv.org/abs/ <paper id="">”的“a”元素</paper></li><li id="aeef" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo ml jw jx jy dt translated">从匹配的链接中提取<em class="mm"> href </em></li></ol><p id="ed82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们已经完成了步骤1。为了实现步骤2和3，我们可以利用传递给映射函数的“el”参数是<a class="ae jp" href="http://lxml.de/index.html" rel="noopener ugc nofollow" target="_blank">lxml</a><a class="ae jp" href="http://lxml.de/api/lxml.html.HtmlElement-class.html" rel="noopener ugc nofollow" target="_blank">html element</a>的实例这一事实，因此我们可以使用lxml方法通过选择<em class="mm"> el </em>的父元素的前一个元素来获取“dt”元素。</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="c8f9" class="kn ko hu kj b fv kp kq l kr ks">dt = el.getparent().getprevious()</span></pre><p id="4f6c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了完成步骤4和5，我们可以使用一个预构建的匹配器来匹配链接，从每个链接中提取<em class="mm"> href </em>，并使每个url成为绝对url(例如，它将“/abs/1802.08246”映射到绝对URL“https://arxiv . org/ABS/1802.08246”)。抓取时匹配链接很常见，所以我在raschietto库中包含了这个匹配器。这个匹配器还有一个参数<em class="mm"> startswith </em>，当指定时，它将告诉匹配器只保留以给定字符串开头的结果。使用这个匹配器，我们任务的代码非常短:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="75eb" class="kn ko hu kj b fv kp kq l kr ks">link_matcher = Matcher.link(".list-identifier &gt; a", startswith="https://arxiv.org/abs/")</span></pre><p id="6fc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经过这些改动，我们得到了arXiv刮刀的最终版本</p><figure class="ke kf kg kh fq lw"><div class="bz el l di"><div class="mj mk l"/></div></figure><p id="2bc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，我们将<em class="mm">页面</em>参数传递给了<em class="mm"> link_matcher </em>，让它知道元素的源url(否则就不可能使url成为绝对的)</p><h1 id="f7eb" class="kt ko hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">结论</h1><p id="6010" class="pw-post-body-paragraph ir is hu it b iu lq iw ix iy lr ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">只用了15行优雅的代码(空行不算)，我们开发了一个能够从网页中提取信息的工作刮刀。我们能够轻松地将匹配的元素分组，克服“没有有用的公共父元素”的问题，并从每个元素中提取所需的信息，而无需编写大量代码。</p><p id="7220" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我真心希望你喜欢这个小图书馆。如果你对此有任何问题，欢迎在评论中提问。如果您想合作开发该库，请随时联系我:)</p></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><p id="7b9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在我的网站<a class="ae jp" href="https://matteo.ronchetti.xyz" rel="noopener ugc nofollow" target="_blank">https://Matteo . ronche tti . XYZ</a>上找到更多关于我、我的所有项目和我的所有帖子的信息</p><figure class="ke kf kg kh fq lw"><div class="bz el l di"><div class="mv mk l"/></div></figure><figure class="ke kf kg kh fq lw"><div class="bz el l di"><div class="mv mk l"/></div></figure></div></div>    
</body>
</html>