<html>
<head>
<title>Tips for using ESLint in a legacy codebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在遗留代码库中使用ESLint的技巧</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/tips-for-using-eslint-in-a-legacy-codebase-b56c62cfaf98?source=collection_archive---------25-----------------------#2018-02-27">https://medium.com/hackernoon/tips-for-using-eslint-in-a-legacy-codebase-b56c62cfaf98?source=collection_archive---------25-----------------------#2018-02-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/0658f0351e15c343659ae035a13de33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pyOJtQkn_cheoG33C9rmIg.png"/></div></div></figure><p id="c1da" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ESLint是一个非常棒的工具，它可以帮助检测代码库中有问题的模式，并强制执行编码约定。对于任何试图维护高质量<a class="ae ka" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>代码库的团队来说，这是一个必备的工具。</p><p id="5456" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然而，当您第一次向遗留代码库介绍ESLint时，很难不被它抛出的大量错误所淹没。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="15c7" class="kk kl hu kg b fv km kn l ko kp">$ eslint .</span><span id="0dc5" class="kk kl hu kg b fv kq kn l ko kp">✖ 20983 problems (20983 errors, 0 warnings)</span><span id="01c1" class="kk kl hu kg b fv kq kn l ko kp">19032 errors, 0 warnings potentially fixable with the ` — fix` option.</span></pre><p id="5602" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">可以理解的是，旧代码在编写时没有考虑ESLint规则，但是当任何新代码中的错误被淹没在所有这些噪音中时，这就成了一个问题。在这篇博文中，我将介绍一些可以帮助你显著减少错误数量的技巧。</p><h1 id="2833" class="kr kl hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">自动修复</h1><p id="adf7" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">ESLint有一个非常有用的<a class="ae ka" href="https://eslint.org/docs/user-guide/command-line-interface#--fix" rel="noopener ugc nofollow" target="_blank">实用程序</a>，可以自动修复大多数错误。什么可以固定，什么不可以固定，取决于规则本身。这对于减少错误数量的影响取决于所使用的代码库和配置。如果您注意到在上面的shell代码片段中，出现了<code class="eh lt lu lv kg b">20983</code>错误，<code class="eh lt lu lv kg b">19032</code>可以被自动修复！让我们这样做:</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="333b" class="kk kl hu kg b fv km kn l ko kp">$ eslint — fix .</span><span id="9ec6" class="kk kl hu kg b fv kq kn l ko kp">✖ 1700 problems (1700 errors, 0 warnings)</span></pre><p id="a176" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh lt lu lv kg b">1700</code>错误听起来比<code class="eh lt lu lv kg b">20983</code>容易处理得多！</p><h1 id="117f" class="kr kl hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">指定环境和全局</h1><p id="f4a5" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">除了本地js对象(Date、parseInt等)之外，每个JS环境(Browser、Nodejs等)都有自己的一组主机/全局对象(window、process、setTimeout等)。ESLint没有假设一个环境，所以你可能会看到像<code class="eh lt lu lv kg b">'window' is not defined</code>或<code class="eh lt lu lv kg b">'setTimeout' is not defined</code>这样的错误。通过<a class="ae ka" href="https://eslint.org/docs/user-guide/configuring#specifying-environments" rel="noopener ugc nofollow" target="_blank">指定环境</a>，可以修复这些错误。</p><p id="541a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">直到几年前，向web代码库添加依赖项的最常见方式是使用<code class="eh lt lu lv kg b">&lt;script&gt;</code>标签，它们使用全局变量来公开它们的API，比如用<code class="eh lt lu lv kg b">$</code>表示jQuery，<code class="eh lt lu lv kg b">_</code>表示下划线等等。您可能会看到类似<code class="eh lt lu lv kg b">'$' is not defined</code>或<code class="eh lt lu lv kg b">'moment' is not defined</code>的错误。这些错误可以通过<a class="ae ka" href="https://eslint.org/docs/user-guide/configuring#specifying-globals" rel="noopener ugc nofollow" target="_blank">指定全局</a>来修复。</p><h1 id="ccb5" class="kr kl hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">禁用规则</h1><p id="1fd3" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">这应该是最后一招，在我们开始禁用左右两侧的规则之前，让我们来了解一下可以禁用规则的不同级别:</p><h2 id="df25" class="kk kl hu bd ks lw lx ly kw lz ma mb la jn mc md le jr me mf li jv mg mh lm mi dt translated">线路电平</h2><p id="c707" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">这将禁用线路的规则</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="20a8" class="kk kl hu kg b fv km kn l ko kp">alert(‘foo’); <em class="mj">// eslint-disable-line no-alert, quotes, semi</em></span><span id="35f0" class="kk kl hu kg b fv kq kn l ko kp"><em class="mj">// eslint-disable-next-line no-alert, quotes, semi</em></span><span id="bdb5" class="kk kl hu kg b fv kq kn l ko kp">alert(‘foo’);</span></pre><h2 id="09dc" class="kk kl hu bd ks lw lx ly kw lz ma mb la jn mc md le jr me mf li jv mg mh lm mi dt translated">气泡水准仪</h2><p id="f745" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">这将禁用多行规则</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="3e93" class="kk kl hu kg b fv km kn l ko kp"><em class="mj">/* eslint-disable no-alert, no-console */</em></span><span id="a624" class="kk kl hu kg b fv kq kn l ko kp">alert(‘foo’);</span><span id="4b22" class="kk kl hu kg b fv kq kn l ko kp">console.log(‘bar’);</span><span id="dbc8" class="kk kl hu kg b fv kq kn l ko kp"><em class="mj">/* eslint-enable no-alert, no-console */</em></span></pre><h2 id="15fb" class="kk kl hu bd ks lw lx ly kw lz ma mb la jn mc md le jr me mf li jv mg mh lm mi dt translated">文件级别</h2><p id="f953" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">这将禁用整个文件的规则</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="d41c" class="kk kl hu kg b fv km kn l ko kp"><em class="mj">/* eslint-disable no-alert */</em></span><span id="1717" class="kk kl hu kg b fv kq kn l ko kp">alert(‘foo’);</span></pre><h2 id="f37c" class="kk kl hu bd ks lw lx ly kw lz ma mb la jn mc md le jr me mf li jv mg mh lm mi dt translated">目录级别</h2><p id="2639" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">这将禁用目录的规则。这是通过在该目录中创建一个新的配置文件来完成的。一个项目中可以有多个ESLint配置文件。最接近的配置文件将覆盖外层目录中定义的配置文件。</p><p id="702f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当您只需要禁用特定目录中的一些规则，但仍然需要为代码库的其余部分启用这些规则时，此功能非常有用。例如，如果您启用了<a class="ae ka" href="https://eslint.org/docs/rules/no-magic-numbers" rel="noopener ugc nofollow" target="_blank">无幻数</a>规则，并且因为在断言中使用幻数而看到来自<code class="eh lt lu lv kg b">tests/</code>目录的许多错误，您可以在<code class="eh lt lu lv kg b">tests/</code>目录中创建的配置文件中禁用该规则。</p><p id="cbc7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击了解有关该功能<a class="ae ka" href="https://eslint.org/docs/user-guide/configuring#configuration-cascading-and-hierarchy" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><h2 id="d9f9" class="kk kl hu bd ks lw lx ly kw lz ma mb la jn mc md le jr me mf li jv mg mh lm mi dt translated">项目级别</h2><p id="d66e" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">如果您在根配置文件中禁用规则，那么您可以禁用整个代码库的规则。通常这种方法在你使用一个<a class="ae ka" href="https://eslint.org/docs/user-guide/configuring#using-a-shareable-configuration-package" rel="noopener ugc nofollow" target="_blank">共享配置</a>比如<a class="ae ka" href="https://www.npmjs.com/package/eslint-config-airbnb" rel="noopener ugc nofollow" target="_blank"> eslint-config-airbnb </a>或者<a class="ae ka" href="https://www.npmjs.com/package/eslint-config-standard" rel="noopener ugc nofollow" target="_blank"> eslint-config-standard </a>等并且想要添加你自己的覆盖时使用。</p><h2 id="b51a" class="kk kl hu bd ks lw lx ly kw lz ma mb la jn mc md le jr me mf li jv mg mh lm mi dt translated">关于禁用规则的思考</h2><p id="c9bd" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">在项目级别禁用规则是非常容易的，但是这样做意味着任何新编写的代码都不会根据这些规则进行检查。</p><p id="458a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在行级别禁用是最好的，因为只有那些行受到影响，但这可能非常繁琐，因为我们可能需要对数千行执行此操作。</p><p id="123f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">根据出错文件的数量，最好在文件或目录级别禁用。这比在行级别禁用更容易，对新代码的影响也比在项目级别禁用小。</p><p id="e2af" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果有一个<a class="ae ka" href="https://hackernoon.com/tagged/tool" rel="noopener ugc nofollow" target="_blank">工具</a>可以检查代码库并为受影响的代码行添加<code class="eh lt lu lv kg b">eslint-disable-line</code>注释，那就太好了，但是我不知道这样的工具是否存在。</p><h1 id="542d" class="kr kl hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">结论</h1><p id="2234" class="pw-post-body-paragraph jc jd hu je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">使用上述步骤，可以修复或禁用代码库中的所有错误。任何新的错误都只是因为新编写的代码，只要我们一看到它们就可以修复。我们可以根据可用带宽分配一些时间来检查被禁用的错误，并逐步修复它们。</p><p id="670b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">感谢阅读！如果你喜欢这个，你可能也会喜欢:<a class="ae ka" href="http://www.sheshbabu.com/posts/speed-up-your-code-reviews-using-eslint-and-prettier/" rel="noopener ugc nofollow" target="_blank">使用ESLint和更漂亮的工具加速你的代码审查</a></p><p id="efc5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最初发表于sheshbabu.com的<a class="ae ka" href="http://www.sheshbabu.com/posts/tips-for-using-eslint-in-a-legacy-codebase/" rel="noopener ugc nofollow" target="_blank"/></p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="mk ml l"/></div></figure></div></div>    
</body>
</html>