<html>
<head>
<title>How To Measure Particulate Matter With a Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用树莓Pi测量颗粒物</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-measure-particulate-matter-with-a-raspberry-pi-75faa470ec35?source=collection_archive---------6-----------------------#2018-02-28">https://medium.com/hackernoon/how-to-measure-particulate-matter-with-a-raspberry-pi-75faa470ec35?source=collection_archive---------6-----------------------#2018-02-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/15c18d5f8c2ffb4ed6f00a6910d7bf98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EtjxuLZl6FeUOkaE4xSb-w.jpeg"/></div></div></figure><div class=""/><p id="8bea" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们定期测量学校空气中的颗粒物。特别是在二月和五月之间，东南亚这里的数值非常高，因为在这段时间很少下雨，非常干燥和炎热，许多草地和田地被烧毁。所有这些都对空气质量有负面影响。今天我将向大家展示如何用<a class="ae ka" href="https://amzn.to/2t1hgK8" rel="noopener ugc nofollow" target="_blank">树莓皮</a>测量颗粒物。不过，我想先简单评论一下这个问题:什么是颗粒物，我们要测量什么？</p><h1 id="5df1" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是颗粒物？</h1><p id="ee2a" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">可以相当粗略地说，微尘是空气中非常小的颗粒。PM10和PM2.5是有区别的。PM10是空气中小于10 m的所有颗粒，而PM2.5是小于2.5 m的所有颗粒。颗粒越小，即所有小于2.5 m的颗粒，对健康越危险，因为它们可以渗透到肺泡中。</p><p id="e1de" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://en.wikipedia.org/wiki/Particulates" rel="noopener ugc nofollow" target="_blank">世卫组织</a>推荐以下限值:</p><ul class=""><li id="2510" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">年平均PM10 20克/平方米</li><li id="6d8c" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">年均PM2,5每年10克/平方米</li><li id="587a" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">日平均PM10 50克/平方米，不含可能超标的许可天数。</li><li id="5982" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">日平均pm 2.5 25g/m，没有可能超标的许可日。</li></ul><p id="91f9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些数值低于大多数国家设定的限值。在欧盟，PM10允许的年平均值为40克/平方米。</p><h1 id="4f97" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是空气质量指数？</h1><p id="b413" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">空气质量指数可以根据空气中的微粒来计算。它表明空气的好坏程度。可惜这里没有统一的标准，因为不同国家对此的计算方式不同或者尺度不同。维基百科关于<a class="ae ka" href="https://en.wikipedia.org/wiki/Air_quality_index" rel="noopener ugc nofollow" target="_blank">空气质量指数</a>的文章提供了一个很好的概述。在我们学校，我们以EPA ( <a class="ae ka" href="https://en.wikipedia.org/wiki/United_States_Environmental_Protection_Agency" rel="noopener ugc nofollow" target="_blank">美国环境保护局</a>)建立的分类为指导。</p><figure class="lt lu lv lw fq hw fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/477adb5679973f9ef8afa395fcde03f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/0*lNFcOVXyKVXuRz05.png"/></div></figure><p id="e67b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">关于颗粒物和空气质量指数的简要概述到此为止。</p><h1 id="f3d4" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">测量颗粒物我们需要什么？</h1><p id="85c2" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">实际上，只需要两件事:</p><ul class=""><li id="2b7f" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">一个<a class="ae ka" href="https://amzn.to/2t1hgK8" rel="noopener ugc nofollow" target="_blank">树莓派</a>(每个型号都可以，最好是带WiFi的型号)</li><li id="2cff" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><a class="ae ka" href="https://amzn.to/2MIBvFs" rel="noopener ugc nofollow" target="_blank">微粒传感器SDS011 </a></li></ul><figure class="lt lu lv lw fq hw fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/9e88e442e75c06b51db2e5cb8535a4aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*4OHSuvKQuN6itoY0.jpg"/></div></figure><p id="799b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就是这样:)</p><p id="69a6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">无论是谁选择了Raspberry Pi Zero W，都需要一根适配器电缆连接到标准USB端口，因为Zero只有Micro-USB。传感器最好在速卖通购买。那里大约是17-20美元。该传感器带有一个串行接口的USB适配器。</p><h1 id="4b99" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">装置</h1><p id="1748" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">对于我们的Raspberry Pi，我们下载相应的Raspbian Lite图像并将其写入Micro-SD卡。这里记载的<a class="ae ka" href="https://www.raspberrypi.org/documentation/installation/installing-images/README.md" rel="noopener ugc nofollow" target="_blank">就是以</a>为例。在这一点上，我不打算设置WLAN连接。网上有很多教程。</p><p id="7b77" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您想在引导后启用SSH，您需要在引导分区中创建一个名为<code class="eh ly lz ma mb b">ssh</code>的空文件。Raspberry Pis的IP可以通过您自己的路由器/ DHCP服务器获得。然后，您可以通过SSH登录(默认密码是raspberry):</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="c701" class="mg kc if mb b fv mh mi l mj mk">$ ssh pi@192.168.1.5</span></pre><p id="af8a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，我们需要在Pi上安装一些包:</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="8be7" class="mg kc if mb b fv mh mi l mj mk">$ sudo apt install git-core python-serial python-enum lighttpd</span></pre><p id="4048" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在开始之前，我们需要知道USB适配器连接到哪个串行端口。<code class="eh ly lz ma mb b">dmesg</code>帮助我们:</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="6d76" class="mg kc if mb b fv mh mi l mj mk">$ dmesg <br/>[ 5.559802] usbcore: registered new interface driver usbserial <br/>[ 5.559930] usbcore: registered new interface driver usbserial_generic <br/>[ 5.560049] usbserial: USB Serial support registered for generic <br/>[ 5.569938] usbcore: registered new interface driver ch341 <br/>[ 5.570079] usbserial: USB Serial support registered for ch341-uart <br/>[ 5.570217] ch341 1–1.4:1.0: ch341-uart converter detected <br/>[ 5.575686] usb 1–1.4: ch341-uart converter now attached to ttyUSB0</span></pre><p id="9e15" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在最后一行你可以看到我们的界面:<em class="ml"> ttyUSB0 </em>。我们现在需要两样东西:一个读取数据并将其保存在JSON文件中的小Python脚本，然后我们将创建一个读取并显示数据的小HTML页面。</p><h1 id="afd7" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">在树莓Pi上读取数据</h1><p id="c6de" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们首先创建一个传感器实例，然后在30秒内每5分钟读取一次传感器。这些值当然可以调整。在测量间隔期间，我们将传感器置于睡眠模式，以延长其寿命(根据制造商的说法，寿命约为。8000小时)。</p><p id="1977" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们可以使用以下命令下载脚本:</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="9aa7" class="mg kc if mb b fv mh mi l mj mk">$ wget -O /home/pi/aqi.py <a class="ae ka" href="https://raw.githubusercontent.com/zefanja/aqi/master/python/aqi.py" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/zefanja/aqi/master/python/aqi.py</a></span></pre><p id="511f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了让脚本运行时不出错，还需要做两件小事:</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="7f11" class="mg kc if mb b fv mh mi l mj mk">$ sudo chown pi:pi /var/www/html/ <br/>$ echo [] &gt; /var/www/html/aqi.json</span></pre><p id="a7a0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在您可以启动脚本了:</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="ba07" class="mg kc if mb b fv mh mi l mj mk">$ chmod +x aqi.py<br/>$ ./aqi.py<br/>PM2.5:55.3, PM10:47.5<br/>PM2.5:55.5, PM10:47.7<br/>PM2.5:55.7, PM10:47.8<br/>PM2.5:53.9, PM10:47.6<br/>PM2.5:53.6, PM10:47.4<br/>PM2.5:54.2, PM10:47.3<br/>…</span></pre><h1 id="41b0" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">自动运行脚本</h1><p id="3d83" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">因此，我们不必每次都手动启动脚本，我们可以让它在每次重启Raspberry Pi时启动cronjob。为此，请打开crontab文件</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="aa9a" class="mg kc if mb b fv mh mi l mj mk">$ crontab -e</span></pre><p id="74f1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并在结尾处添加以下一行:</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="a1f7" class="mg kc if mb b fv mh mi l mj mk">@reboot cd /home/pi/ &amp;&amp; ./aqi.py</span></pre><p id="2590" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们的脚本在每次重启时都会自动启动。</p><h1 id="0686" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">用于显示测量值和AQI的HTML页面</h1><p id="fdc8" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们已经安装了一个轻量级的web服务器。所以我们必须将我们的HTML、Javascript和CSS文件保存在目录<strong class="je ig"> <em class="ml"> /var/www/html/ </em> </strong>中，以便我们可以从另一台计算机/智能手机中访问这些数据。使用接下来的三个命令，我们只需下载相应的文件:</p><pre class="lt lu lv lw fq mc mb md me aw mf dt"><span id="c180" class="mg kc if mb b fv mh mi l mj mk">$ wget -O /var/www/html/index.html <a class="ae ka" href="https://raw.githubusercontent.com/zefanja/aqi/master/html/index.html" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/zefanja/aqi/master/html/index.html</a><br/>$ wget -O /var/www/html/aqi.js <a class="ae ka" href="https://raw.githubusercontent.com/zefanja/aqi/master/html/aqi.js" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/zefanja/aqi/master/html/aqi.js</a><br/>$ wget -O /var/www/html/style.css <a class="ae ka" href="https://raw.githubusercontent.com/zefanja/aqi/master/html/style.css" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/zefanja/aqi/master/html/style.css</a></span></pre><p id="fdfe" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">主要工作在Javascript文件中完成，它打开我们的JSON文件，获取最后一个值，并基于该值计算AQI。然后根据EPA的比例尺调整背景颜色。</p><p id="299b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您只需在浏览器中打开树莓派的地址，查看当前的颗粒物值，例如<a class="ae ka" href="http://192.168.1.5:" rel="noopener ugc nofollow" target="_blank"> http://192.168.1.5: </a></p><figure class="lt lu lv lw fq hw fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/05975e9043925d128c84629585a66287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*BsX0Wqb-f-ZeJZ9r.png"/></div></figure><p id="8568" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该页面非常简单，可以扩展，例如用图表显示过去几个小时的历史记录等。欢迎拉取请求:)</p><p id="30dc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完整的<a class="ae ka" href="https://github.com/zefanja/aqi" rel="noopener ugc nofollow" target="_blank">源代码在Github </a>上。</p><h1 id="8359" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="642a" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">花相对少的钱，我们现在可以用树莓皮测量颗粒物。无论是永久安装在室外还是作为移动测量设备，都有许多可能的应用。在我们学校，两者都在使用。一方面，有一个传感器日夜测量室外数值，还有一个移动传感器检查教室空调过滤器的有效性。</p><p id="dd9e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<a class="ae ka" href="http://luftdaten.info" rel="noopener ugc nofollow" target="_blank"> http://luftdaten.info </a>有另一种可能性来建造一个类似的传感器。软件交付后即可使用，测量设备更加紧凑，因为没有使用Raspberry Pi。伟大的工程！</p><p id="5fad" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">微粒传感器是一个学生可以在计算机科学课堂或研讨会上很好完成的项目！</p><p id="5eb8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">你用一个</strong> <a class="ae ka" href="https://openschoolsolutions.org/shutdown-servers-case-power-failure%e2%80%8a-%e2%80%8aups-nut-co/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig">树莓</strong> </a> <strong class="je ig">做什么？</strong></p></div><div class="ab cl mn mo hc mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hn ho hp hq hr"><p id="e6cb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ml">原载于</em><a class="ae ka" href="https://openschoolsolutions.org/measure-particulate-matter-with-a-raspberry-pi/" rel="noopener ugc nofollow" target="_blank"><em class="ml">openschoolsolutions.org</em></a><em class="ml">。</em> <strong class="je ig"> <em class="ml">注册</em> </strong> <em class="ml">订阅我们的时事通讯，获取免费的PDF格式的开源应用程序，供您的课堂使用，或者在Twitter上关注</em><a class="ae ka" href="https://twitter.com/OpenSchoolZ" rel="noopener ugc nofollow" target="_blank"><em class="ml">@ OpenSchoolZ</em></a><em class="ml">。</em></p></div></div>    
</body>
</html>