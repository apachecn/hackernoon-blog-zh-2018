<html>
<head>
<title>Tutorial: collecting and analyzing Docker container logs with Sumo Logic (for free)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:用Sumo逻辑收集和分析Docker容器日志(免费)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/tutorial-collecting-and-analyzing-docker-container-logs-with-sumo-logic-for-free-19dae730a8d5?source=collection_archive---------8-----------------------#2018-03-02">https://medium.com/hackernoon/tutorial-collecting-and-analyzing-docker-container-logs-with-sumo-logic-for-free-19dae730a8d5?source=collection_archive---------8-----------------------#2018-03-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a023" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当谈到Docker的强大日志分析选项时，有许多商业选项，但它们可能相当昂贵。我将分享一个提供免费层而不牺牲功能的版本。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/30ac386973a5b82be1d9bdaa12f36389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*jjktfT-iVPDWjobD85CFLA.png"/></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><p id="8ab8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Docker内置了一个名为<code class="eh ke kf kg kh b"><a class="ae ki" href="https://docs.docker.com/config/containers/logging/json-file/" rel="noopener ugc nofollow" target="_blank">json-file</a></code>的日志驱动。容器日志被格式化为JSON，并被写入每个容器的文本文件中。您可以使用<code class="eh ke kf kg kh b"><a class="ae ki" href="https://docs.docker.com/engine/reference/commandline/logs/" rel="noopener ugc nofollow" target="_blank">docker logs</a></code>命令以纯文本的形式查看日志。唯一可用的过滤选项是<code class="eh ke kf kg kh b">since</code>和<code class="eh ke kf kg kh b">until</code>。您可以将输出通过管道传输到<code class="eh ke kf kg kh b">grep</code>来进行关键字搜索，与纯文本文件日志一样。</p><p id="c7ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您想要查看单个容器的日志并即时调试问题时，这已经足够好了。对于任何更复杂的事情(例如解析、过滤和排序)，您将需要一个真正的日志收集和分析工具。</p><p id="8fbd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有多种选择。有些是有偿的。有些是免费开源的，但是DIY。不过，有一款软件结合了商业SaaS平台的强大和便利，以及面向小型项目和业余爱好者的免费入门级计划— <a class="ae ki" href="https://www.sumologic.com/" rel="noopener ugc nofollow" target="_blank"> Sumo Logic </a>。</p><p id="bd60" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Sumo Logic提供0.5 GB/天(15GB/月)日志数据接收的免费计划。如果你对容器日志的内容和频率有所了解，你将能够扩展数据限额并免费获得专业SaaS日志收集和分析平台<strong class="it hv">的能力</strong>。</p><p id="df23" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们开始吧！</p><h1 id="f942" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">设置</h1><p id="90d3" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">使用<a class="ae ki" href="https://www.sumologic.com/" rel="noopener ugc nofollow" target="_blank"> Sumo Logic </a>注册免费试用。你必须使用你的“工作”电子邮件地址。Gmail之类的消费者邮箱就不行了。</p><p id="01fd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<strong class="it hv">管理&gt;安全&gt;访问密钥</strong>下，点击右上角的<strong class="it hv"> + </strong>图标添加新密钥:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lm"><img src="../Images/25b11705ebd41d1c38001f4a1a8e5bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U-ja9KTg3jq26mbMH02ZdA.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Sumo Logic Access Keys screen</figcaption></figure><p id="f1a5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">勾选<strong class="it hv">访问密钥标签</strong>并点击生成密钥。复制并把你的钥匙存放在安全的地方。您将在启动Sumo Logic Docker收集器容器时使用这些。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lv"><img src="../Images/aa0ac004b2409a4c90b4056affc7fa49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DEDVQKYmql3sf_9HGYbbZA.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Sumo Logic Access ID and Access Key screen</figcaption></figure><p id="45be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Docker主机上启动收集器容器</p><pre class="jq jr js jt fq lw kh lx ly aw lz dt"><span id="fbfc" class="ma kk hu kh b fv mb mc l md me">$ docker run -d -v /var/run/docker.sock:/var/run/docker.sock --name=sumo-logic-collector --restart=always sumologic/collector:latest &lt;AccessID&gt; &lt;AccessKey&gt;</span></pre><p id="f92c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">用之前记录的值替换<code class="eh ke kf kg kh b">&lt;AccessID&gt;</code>和<code class="eh ke kf kg kh b">&lt;AccessKey&gt;</code>。</p><p id="7e38" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">给收集器一分钟时间进行初始化，然后转到管理<strong class="it hv">数据&gt;收集</strong>以确认它显示在您的帐户和日志数据中。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mf"><img src="../Images/5116f277f4409698836f77bb82012382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXyy7z2s8IY-sznqZ7k-Zw.png"/></div></div></figure><p id="eab6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">收集器容器将传输两个数据源:</p><ul class=""><li id="6918" class="mg mh hu it b iu iv iy iz jc mi jg mj jk mk jo ml mm mn mo dt translated"><strong class="it hv">Docker-stats</strong>—CPU/内存/网络/等。容器统计</li><li id="5719" class="mg mh hu it b iu mp iy mq jc mr jg ms jk mt jo ml mm mn mo dt translated"><strong class="it hv">码头日志</strong> —实际集装箱日志</li></ul><p id="cd60" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果收集器没有出现在Sumo逻辑中，则检查收集器容器日志以寻找线索:</p><pre class="jq jr js jt fq lw kh lx ly aw lz dt"><span id="d6c0" class="ma kk hu kh b fv mb mc l md me">$ docker logs sumologic-collector</span><span id="7aaa" class="ma kk hu kh b fv mu mc l md me">Running SumoLogic Collector...</span><span id="6219" class="ma kk hu kh b fv mu mc l md me">wrapper  | --&gt; Wrapper Started as Console<br/>wrapper  | Java Service Wrapper Standard Edition 64-bit 3.5.13<br/>wrapper  |   Copyright (C) 1999-2011 Tanuki Software, Ltd. All Rights Reserved.<br/>wrapper  |     <a class="ae ki" href="http://wrapper.tanukisoftware.com" rel="noopener ugc nofollow" target="_blank">http://wrapper.tanukisoftware.com</a><br/>wrapper  |   Licensed to Sumo Logic Inc. for Collector<br/>wrapper  |<br/>wrapper  | Launching a JVM...<br/>jvm 1    | WrapperManager: Initializing...<br/>jvm 1    |    . .       . .       . .    .       . .<br/>jvm 1    | .+'|=|`+. .+'| |`+. .+'|=|`+.=|`+. .+'|=|`+.<br/>jvm 1    | |  | `+.| |  | |  | |  | `+ | `+ | |  | |  |<br/>jvm 1    | |  | .    |  | |  | |  |  | |  | | |  | |  |<br/>jvm 1    | `+.|=|`+. |  | |  | |  |  | |  | | |  | |  |<br/>jvm 1    | .    |  | |  | |  | |  |  | |  | | |  | |  |<br/>jvm 1    | |`+. |  | |  | |  | |  |  | |  | | |  | |  |<br/>jvm 1    | `+.|=|.+' `+.|=|.+' `+.|  |.|  |+' `+.|=|.+'<br/>jvm 1    | Sumo Logic Collector Version 19.209-26<br/>jvm 1    | Sumo Logic Build Hash fa2afe3<br/>jvm 1    | current folder:/opt/SumoCollector<br/>jvm 1    |   * See /opt/SumoCollector/./logs for more details.<br/>jvm 1    |   * Connecting to <a class="ae ki" href="https://collectors.sumologic.com." rel="noopener ugc nofollow" target="_blank">https://collectors.sumologic.com.</a><br/><strong class="kh hv">jvm 1    |  * ERROR: Registration failed: Your Sumo Logic credentials could not be verified. Make sure the token or accessKey/ID is valid and your user account has permissions to manage Collectors. (error key: collectors.unauthorized)<br/></strong>jvm 1    | Collector exiting...<br/>wrapper  | &lt;-- Wrapper Stopped</span></pre><p id="3be6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">默认情况下，日志时间戳使用UTC时区。必要时，您可以在设置(<strong class="it hv">编辑</strong>链接)中进行调整。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mv"><img src="../Images/e16c84da213d238b991ecc3d501ca102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOGWrlMXaRGBeTk-sfsnKw.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Switching collector timezone</figcaption></figure><p id="e3d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">参见官方<a class="ae ki" href="https://github.com/SumoLogic/sumologic-collector-docker" rel="noopener ugc nofollow" target="_blank">sumologic-collector-docker</a>repo，了解更多配置选项和文档。</p><h1 id="bff6" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">Sumo Logic中的Docker stats仪表板</h1><p id="e075" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">让我们从一些现成的漂亮的仪表板和图表开始。</p><p id="b8ed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Sumo Logic在<strong class="it hv">应用程序目录</strong>中有一个“Docker应用程序”。继续将它添加到您的库中。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mw"><img src="../Images/62437e4ecc5f2c74589f18143ab851c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMs18RDCEgRhxmyMzfuoFw.png"/></div></div></figure><p id="2398" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将日志的<strong class="it hv">来源类别</strong>设置为<strong class="it hv"> docker </strong></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mx"><img src="../Images/4674bd49b85cbac435d397ad5e0ee817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dnPzLbCZEDjv0-dMpLgnxg.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Set the <strong class="bd my">Source Category</strong> for logs to <strong class="bd my">docker</strong></figcaption></figure><p id="817c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦安装了应用程序并收集了一些数据，您将看到一些很好的容器统计图表。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mz"><img src="../Images/240ca505257706d136f5ce9e6765990d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wRgVL-YvGKhhULn29ONiLg.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Docker Overview dashboard</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff na"><img src="../Images/f29daf632b96e4e92c9b326d68381bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5S3EneLWK7hhds_9SGDbQ.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Docker CPU Performance dashboard</figcaption></figure><h1 id="0588" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">搜索和分析容器日志</h1><p id="36fb" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">现在让我们看看如何在Sumo逻辑中获得实际的容器日志。</p><p id="e44f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用右上角的“<strong class="it hv"> +新建</strong>”按钮创建一个新的<strong class="it hv">日志搜索</strong>(您也可以使用<strong class="it hv"> alt+s </strong>键盘快捷键来完成此操作)</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff nb"><img src="../Images/ba66cfe45469c3dedb1e7e91b9b43e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qCSXMwW-0iR5snl4oRagEg.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Create a new Log Search</figcaption></figure><p id="4b4e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要仅查看容器日志，请使用<code class="eh ke kf kg kh b">_source=Docker-logs</code>过滤器。您还可以按收集器名称、源主机等缩小搜索范围。Sumo逻辑将自动建议过滤器选项和可用值。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff na"><img src="../Images/b7e05a73c3e91fb12902a784adef1730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQ3bsL6yexMe5INDejWVNA.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Search container logs</figcaption></figure><p id="10f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要查看特定容器的日志—添加<code class="eh ke kf kg kh b">_sourcename</code>过滤器，例如</p><pre class="jq jr js jt fq lw kh lx ly aw lz dt"><span id="add4" class="ma kk hu kh b fv mb mc l md me">_source=Docker-logs<br/>AND _sourcename = "plex-server"</span></pre><p id="5b41" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要搜索特定的日志消息或关键字，要么手动将其添加到搜索查询中作为<code class="eh ke kf kg kh b">AND &lt;keyword&gt;</code>过滤器，要么突出显示它并使用下拉列表中的选项。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff nc"><img src="../Images/4aff30592e290c4122b07c22e9c2b5e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QiYwWdvrcWI82xA3_aHxoQ.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Filter logs by keyword</figcaption></figure><p id="fa74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">轻松点。现在我们只查看我们感兴趣的特定消息。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff nd"><img src="../Images/82987139a07cf1cf38e761b4aa992b9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xihhmR0-MQF_qiJIVfD1CA.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Filter logs by keyword: results</figcaption></figure><p id="3aaa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦我们深入到我们感兴趣的消息实例，我们可能想看看当时日志中还捕获了什么。相扑逻辑也让这变得非常容易。点击消息下的任何过滤器，选择围绕消息的<strong class="it hv">和时间范围</strong>:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff ne"><img src="../Images/7de320800fe28e984d8ec41fc0b32bc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wurAKFstrZDI7gs8TmdQgQ.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Finding surrounding messages for a particular log event</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff nf"><img src="../Images/9d59a791b3506513ca5d3e22088171a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qeSjrGdzgibC8_ab1MCoig.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Surrounding log messages within a specific timeframe</figcaption></figure><p id="aef5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">相扑逻辑还可以做更多的事情。查看<a class="ae ki" href="https://help.sumologic.com/" rel="noopener ugc nofollow" target="_blank">文档</a>和视频教程，可在<a class="ae ki" href="https://www.youtube.com/user/sumologic/playlists" rel="noopener ugc nofollow" target="_blank"> YouTube </a>和应用程序中找到。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff ng"><img src="../Images/77f1d88669bbd1d069de9922f8f92f7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s2uwygG5D-RjE2M40uvQDA.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Learning materials in Sumo Logic</figcaption></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><p id="f1ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">免责声明:我与Sumo Logic没有任何关系，也没有从他们或任何撰写这篇文章的人那里获得任何形式的报酬。我在寻找一个适合自己需求的解决方案，发现相扑非常适合它。</p><p id="896c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">我希望你喜欢阅读，并发现本教程有用。<br/>如果是这样全部鼓掌50次！这有助于其他人发现媒体上的内容。</strong></p></div></div>    
</body>
</html>