<html>
<head>
<title>MarketStore, the financial time series database, is now open source</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">金融时间序列数据库MarketStore现在是开源的</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/marketstore-the-financial-time-series-database-is-now-open-source-fd04343f439?source=collection_archive---------4-----------------------#2018-03-05">https://medium.com/hackernoon/marketstore-the-financial-time-series-database-is-now-open-source-fd04343f439?source=collection_archive---------4-----------------------#2018-03-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/ae2a07d4aa4deadb0ce1f1640580cf15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pXKwrTMBBr6BZvxsmyAa5Q.jpeg"/></div></div></figure><p id="36ca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们很高兴地宣布<a class="ae ka" href="https://github.com/alpacahq/marketstore" rel="noopener ugc nofollow" target="_blank"> MarketStore </a>现已开源！<a class="ae ka" href="https://hackernoon.com/tagged/marketstore" rel="noopener ugc nofollow" target="_blank"> MarketStore </a>是针对纯<a class="ae ka" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>编写的金融时间序列数据优化的数据库服务器，由<a class="ae ka" href="https://alpaca.markets/" rel="noopener ugc nofollow" target="_blank">羊驼</a>设计开发。您可以将它视为一个可扩展的<a class="ae ka" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank"> DataFrame </a>服务，可以从系统中的任何地方访问，具有更高的可伸缩性。</p><p id="efaa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它从头开始设计，旨在解决处理大量金融市场数据的可扩展性问题，这些数据用于算法交易回溯测试、绘制图表和分析跨越多年的价格历史，包括所有美国股票或爆炸式加密货币空间的分笔成交点水平。如果您正在努力管理大量的<a class="ae ka" href="https://support.hdfgroup.org/HDF5/" rel="noopener ugc nofollow" target="_blank"> HDF5 </a>文件，这是您问题的完美解决方案。</p><h1 id="f027" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">问题是</h1><p id="8c85" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">几年前，羊驼开始开发<a class="ae ka" href="http://algo.alpaca.ai/" rel="noopener ugc nofollow" target="_blank">羊驼算法</a>，它可以帮助散户将自己的想法转化为交易算法，而无需编写任何代码。该平台训练了一个深度学习模型，以利用每个模型的历史价格数据捕捉交易想法，并快速进行回溯测试。然后，您可以打开algo to live模式，这将执行与回溯测试相同的计算。</p><p id="4d2c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后是<a class="ae ka" href="https://scan.alpaca.ai/" rel="noopener ugc nofollow" target="_blank"> AlpacaScan </a>，它为所有美国股票提供预建的算法结果，并提供快速回溯测试结果。以时间序列的方式对8000个符号运行复杂的逻辑不是一件容易的事情。</p><p id="d801" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这样做的过程中，我们发现访问十多年来具有数千个符号的分笔成交点级别的历史价格数据是系统的性能瓶颈，也是用户体验的痛点。我们的大部分应用层都是使用PyData库(包括Pandas <a class="ae ka" href="https://hackernoon.com/tagged/dataframe" rel="noopener ugc nofollow" target="_blank"> DataFrame </a>)用python编写的，但这些库更侧重于计算和分析，很明显，有必要改进对不同部分的大量数据的快速访问。</p><h1 id="8260" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">解决方案</h1><p id="999a" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">当时，处理金融市场时间序列数据的最简单方法是将DataFrame存储在HDF5中。对于小型用例来说，这是事实上的存储格式，但是由于可伸缩性的原因，它不适合我们的情况。</p><p id="8571" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后我们坐在一起，探讨这种可能性。这个想法很快出现，我们需要某种数据库来按需提供数据框架。它应该是一个基于HTTP的API服务，易于访问，在磁盘上存储万亿字节的价格数据，在文件系统上提供简单的数据管理，能够每秒更新10k+符号价格，并以亚秒延迟响应10k+客户端。</p><p id="11c7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在github中寻找可能的解决方案，有许多时间序列数据库，但主要用于通用时间序列数据，针对物联网传感器数据或系统监控指标，并为JSON设计。特别是金融时间序列数据有不同的需求，其中数据非常密集，更加结构化，并且需要长历史。我们找不到这种特定使用情形的最佳解决方案。很明显，不仅仅是我们，任何处理金融时间序列数据的人都需要这个解决方案。在越来越多的人编写自动化交易系统或分析这种数据的未来时代，非常高效地处理这些数据是不可避免的。数据库服务器应该写得干净利落，并且可以重复使用，以便有朝一日开放源代码，供所有人使用。</p><p id="fd75" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是我们如何开始开发MarketStore的，这是一个专为金融时间序列数据设计的纯Go数据库。我们设计了一个真正的数据库架构。Luke是成功的MPP数据库<a class="ae ka" href="https://greenplum.org/" rel="noopener ugc nofollow" target="_blank"> Greenplum </a>的联合创始人之一兼首席技术官，他加入了对话并设计了存储层。Hitoshi曾经为Greenplum和<a class="ae ka" href="https://pivotal.io/" rel="noopener ugc nofollow" target="_blank"> Pivotal </a>工作，作为Greenplum的架构师和<a class="ae ka" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>的主要贡献者，他开发了围绕查询和插件架构的代码库。</p><h1 id="61e9" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">特征</h1><ul class=""><li id="7682" class="le lf hu je b jf kz jj la jn lg jr lh jv li jz lj lk ll lm dt translated"><strong class="je hv">基于HTTP的API，带有MessagePack二进制序列化</strong> <br/>许多传统数据库都有自己专有的有线协议。然而，在这个云时代，遵循MarketStore的基于HTTP的标准API更有意义。HTTP主要是基于文本的，但为了提高效率，MarketStore使用MessagePack作为数据序列化格式，这允许服务器和客户端之间的最佳数据交换。</li><li id="043b" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><strong class="je hv">用于优化读写的时间索引行定向存储格式</strong> <br/>存储在MarketStore中的所有内容都被假定为时间序列。可以通过与行相关联的时间戳在精确的字节偏移量处对行进行寻址。在许多分析数据库中，数据是面向列的，以优化读取；MarketStore的要求是同时连续写入数千个符号，并且更新量很小，但是时间索引数据结构允许优化读取。</li><li id="aac7" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><strong class="je hv">利用文件系统漏洞在考虑市场开放时间的情况下使文件大小最小</strong> <br/>现代文件系统在文件中提供了漏洞，这意味着您可以提前分配文件字节，而不用实际占用底层磁盘。换句话说，就是虚拟分配。因为MarketStore在许多情况下都知道每个文件有多大，所以它首先分配文件并填充漏洞以优化存储使用。</li><li id="ad31" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><strong class="je hv">不同时间分辨率的时间聚合，具有单一真实来源</strong> <br/>金融时间序列数据库中最常见的操作是时间聚合。有了1分钟棒线数据，您可能想要下采样到1小时或1天棒线。这是通过<a class="ae ka" href="https://github.com/alpacahq/marketstore/tree/master/contrib/ondiskagg" rel="noopener ugc nofollow" target="_blank">触发插件系统</a>完成的，在写入底层时，您将获得预聚合的下采样数据。预聚合数据为许多用例提供了更高的查询性能。</li><li id="0a95" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><strong class="je hv">支持不同资产类别和市场的定制插件</strong> <br/>不同的上游数据源，以及不同类型的资产类别，在数据集成方面有不同的需求。MarketStore的核心引擎在金融市场数据的常见工作方面做得最好，它提供定制插件支持来解决每个不同的用例。</li><li id="5b30" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><strong class="je hv">时区支持</strong> <br/>时区是面向时间的应用程序中最令人头疼的问题之一。MarketStore支持系统范围的时区，以适应不同的市场。例如，在Alpaca，美国股票市场数据使用东部时间，并在东部时间边界汇总1日棒线，而加密和外汇数据在UTC汇总。</li></ul><h1 id="8984" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">客户支持</h1><p id="d3ae" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">有原生的<a class="ae ka" href="https://github.com/alpacahq/marketstore/blob/master/frontend/client/client.go" rel="noopener ugc nofollow" target="_blank"> Go </a>和<a class="ae ka" href="https://github.com/alpacahq/pymarketstore" rel="noopener ugc nofollow" target="_blank"> Python </a>客户端，它们都表现得非常好。Python客户端可以轻松地将服务器响应转换成数据帧，您会发现这与从本地磁盘读取数据几乎没有什么不同，而且具有更高的可伸缩性。</p><h1 id="8c82" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">数据摄取</h1><p id="5dde" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">数据库软件中的一个常见挑战是数据导入层。我们的财务数据系统也不例外。不同的资产类别具有不同的特征，每个上游数据提供商提供不同的数据格式。为了解决这个问题，MarketStore为数据摄取层提供了插件系统。它带有默认插件，用于从<a class="ae ka" href="https://docs.gdax.com/#get-historic-rates" rel="noopener ugc nofollow" target="_blank"> GDAX API </a>和<a class="ae ka" href="https://github.com/alpacahq/slait" rel="noopener ugc nofollow" target="_blank"> Slait </a>获取数据，这是我们的另一个开源产品。我们将在另一篇文章中讨论Slait。使用<a class="ae ka" href="https://github.com/alpacahq/marketstore/tree/master/contrib/gdaxfeeder" rel="noopener ugc nofollow" target="_blank"> GDAX插件</a>，你可以从启动MarketStore的那一刻起，立即开始消费和存储比特币、以太坊、比特币现金和莱特币数据。</p><p id="6e6e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于它是一个插件架构，您可以根据自己的需要编写自己的数据摄取。此外，Go和Python客户端支持从远程写入数据。</p><h1 id="8506" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">有效性</h1><p id="ef89" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">MarketStore现在是GitHub上的一个开源项目，已经可以生产了。鉴于Go中构建系统的简易性，自行构建它是相当简单的。为了方便访问，每个版本都有一个Docker容器。</p><p id="e4ce" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在羊驼内部，从我们的交易管理系统到深度学习建模再到制图，几乎所有的应用程序在开发和生产中都使用MarketStore作为后端。</p><p id="cbfc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们希望开源MarketStore可以帮助更多在类似领域工作的人，并为社区做出贡献。羊驼的使命始终是帮助个人在金融市场中拥有更多技术力量，这不仅仅意味着我们的最终产品。通过以这种方式提供技术，我们希望帮助每个人。</p><h1 id="9253" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">现在就试试吧！</h1><p id="b76c" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">今天就试试吧，让我们知道什么适合你，什么不适合。我们也非常乐意在特性开发和文档方面得到帮助。这里会有更多关于MarketStore使用细节的帖子。</p><figure class="ls lt lu lv fq iv"><div class="bz el l di"><div class="lw lx l"/></div></figure></div><div class="ab cl ly lz hc ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hn ho hp hq hr"><figure class="ls lt lu lv fq iv fe ff paragraph-image"><a href="https://medium.com/automation-generation"><div class="fe ff mf"><img src="../Images/4d7d212ef68dd071daeaae0916d72f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgwdHnaQXAnW0LtrVSpdMA.png"/></div></a></figure><h2 id="0a5c" class="mg kc hu bd kd mh mi mj kh mk ml mm kl jn mn mo kp jr mp mq kt jv mr ms kx mt dt translated">请关注<a class="ae ka" rel="noopener" href="/@alpacahq">羊驼</a>和<a class="ae ka" href="https://medium.com/automation-generation" rel="noopener">自动化生成</a>关于金融市场、算法交易、技术的新帖子。</h2><h2 id="175e" class="mg kc hu bd kd mh mi mj kh mk ml mm kl jn mn mo kp jr mp mq kt jv mr ms kx mt dt translated">你可以找到我们<a class="ae ka" href="https://twitter.com/AlpacaHQ" rel="noopener ugc nofollow" target="_blank">@羊驼HQ </a>，如果你用twitter的话。</h2><figure class="ls lt lu lv fq iv fe ff paragraph-image"><a href="https://medium.com/automation-generation"><div class="fe ff mu"><img src="../Images/cdfe4e1b3df7ff7b28e2474ff8dfef1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xnDRs1aVpqUjToFRmk5Zw.png"/></div></a></figure></div><div class="ab cl ly lz hc ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hn ho hp hq hr"><p id="0589" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你是一名黑客，并且可以创建一些在金融市场中工作的很酷的东西，请查看我们的项目"<a class="ae ka" href="https://alpaca.markets/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=strategy_list&amp;utm_content=part1" rel="noopener ugc nofollow" target="_blank">Commission Free Stock Trading API</a>",在那里我们免费提供简单的REST交易API和实时市场数据。</p><p id="10b0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">经纪服务由FINRA/SIPC成员羊驼证券有限责任公司(<a class="ae ka" href="https://alpaca.markets/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=strategy_list&amp;utm_content=part1" rel="noopener ugc nofollow" target="_blank">羊驼市场</a>)提供。羊驼证券有限责任公司是AlpacaDB，Inc .的全资子公司。</p><figure class="ls lt lu lv fq iv"><div class="bz el l di"><div class="mv lx l"/></div></figure></div></div>    
</body>
</html>