<html>
<head>
<title>How to Build a Realtime Trade Platform with JavaScript and Pusher</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript和Pusher构建实时交易平台</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-a-realtime-trade-platform-with-javascript-and-pusher-1f7275e396e?source=collection_archive---------19-----------------------#2018-03-06">https://medium.com/hackernoon/how-to-build-a-realtime-trade-platform-with-javascript-and-pusher-1f7275e396e?source=collection_archive---------19-----------------------#2018-03-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/e73f8885f7b5cc6e681d81dcd3fa7ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HUQfth0rXbyg-j_kUyYrcw.png"/></div></div></figure><blockquote class="jc jd je"><p id="3bc6" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">披露:<a class="ae ke" href="https://goo.gl/52hnDL" rel="noopener ugc nofollow" target="_blank">为开发者提供实时API的Pusher </a>，此前曾赞助过黑客Noon。</p></blockquote><p id="9d84" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">股票市场数据变得更有价值，因为它本质上为寻求分析和统计的交易者提供了一个机会。</p><p id="6fed" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在本教程中，我们将构建一个描绘股票市场体验的交易平台，在这里，价格交易可以在<a class="ae ke" href="https://hackernoon.com/tagged/realtime" rel="noopener ugc nofollow" target="_blank">实时</a>中可视化。这将使用<a class="ae ke" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>、Chart.js和由<a class="ae ke" href="https://goo.gl/52hnDL" rel="noopener ugc nofollow" target="_blank"> Pusher </a>支持的实时功能来构建。</p><p id="dfd8" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">Pusher是一个专门为开发人员构建实时基础设施的平台，目的是尽可能高效地构建实时应用程序。我们将利用Pusher的强大功能，直接从服务器在我们的图表上显示更新的价格，并添加一个额外的功能来显示描述价格的表格，如下所示:</p><h1 id="e232" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">入门指南</h1><p id="bf7b" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">如前所述，Pusher将用于轻松交付我们的图表按指定运行所需的实时功能。如果没有Pusher的账号，可以<a class="ae ke" href="https://pusher.com/signup" rel="noopener ugc nofollow" target="_blank">免费注册</a>。完成后，继续从您的仪表板创建一个新的应用程序。不要忘记记下您的<strong class="ji hv"> app_id </strong>、<strong class="ji hv"> key </strong>、<strong class="ji hv"> secret </strong>和<strong class="ji hv"> cluster </strong>，因为您将需要在本教程的后面使用它们。</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/1a8edf6d43c61743595a6927c79dd2ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Slmy88s-T6ZoGQVF.png"/></div></div></figure><h1 id="4383" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">设置应用程序</h1><p id="712d" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">现在我们已经设置了一个帐户并获得了必要的凭证，我们需要为我们的应用程序设置一个服务器和视图。这是为了确保我们的应用程序和<a class="ae ke" href="https://pusher.com/" rel="noopener ugc nofollow" target="_blank">推动器</a>之间的通信。如果你还没有在你的机器上安装Node和npm，请点击这里从<a class="ae ke" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">下载它们以便跟进。否则，继续以任何名称创建新目录，并运行以下命令:</a></p><pre class="lm ln lo lp fq lq lr ls lt aw lu dt"><span id="a082" class="lv kj hu lr b fv lw lx l ly lz">npm init -y</span></pre><p id="5162" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">会问你一堆问题，然后会为你创建一个package.json文件。用以下内容更新文件:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="73c4" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">现在，编辑上面的文件，添加脚本来启动我们的本地服务器，我们将设置它。</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="8bfd" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们需要安装Pusher SDK和<code class="eh mc md me lr b">serve</code>来帮助我们启动客户端应用程序:</p><pre class="lm ln lo lp fq lq lr ls lt aw lu dt"><span id="b21b" class="lv kj hu lr b fv lw lx l ly lz">## Pusher<br/>npm install --save pusher</span><span id="8715" class="lv kj hu lr b fv mf lx l ly lz">## Serve<br/>npm install --save-dev serve</span></pre><p id="39a5" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们还需要一些现有的虚拟数据，以便对股票交易和价格变化进行适当的模拟。出于这个原因，我下载了一个以前股票历史的数据样本，我们可以玩玩。下面是<code class="eh mc md me lr b">stock.json</code>的删节版。你可以在这里找到完整的文件<a class="ae ke" href="https://github.com/christiannwamba/pusher-stock/blob/master/stock.json" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="e865" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">接下来，我们需要创建我们的项目文件。在项目文件夹中添加以下文件，并将其留空。我们将一边走一边填充内容:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><h1 id="cff3" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">创建简单的服务器</h1><p id="f06e" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">在<code class="eh mc md me lr b">server.js</code>内，导入<code class="eh mc md me lr b">stock``.json</code>文件，并使用从应用仪表板获取的所需凭证初始化推送器。</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="e87e" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">为了让我们的客户接收实时负载，我们需要使用Pusher从我们的服务器发出这些负载:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="fc9b" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">每两秒钟，我们就在JSON文件中查询<code class="eh mc md me lr b">GOOG</code>股票价格，并使用推送器的<code class="eh mc md me lr b">trigger</code>方法将这个价格和一些其他有效负载(如股票名称)一起作为JSON发出。该方法将通道、事件和负载作为参数。</p><p id="1a0d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">运行以下命令启动服务器:</p><pre class="lm ln lo lp fq lq lr ls lt aw lu dt"><span id="0abb" class="lv kj hu lr b fv lw lx l ly lz">npm run serve</span></pre><h1 id="d2bf" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">构建客户端应用程序</h1><p id="7c37" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">首先，用以下内容更新您的<code class="eh mc md me lr b">index.html</code>:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="3c95" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">您有一个<code class="eh mc md me lr b">canvas</code>,在这里您将启动图表以及一个简单的表格来显示实时更新的当前价格。我们还包括了Pusher和Chart SDK，我们将很快使用它们。</p><p id="4304" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated"><strong class="ji hv"> App类</strong>为了接收服务器发来的有效载荷，我们需要订阅服务器发出的Pusher事件。为了可视化它，您需要创建一个图表，并使用从服务器接收的有效负载不断更新它的数据点。我们将需要几个函数:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="a7a5" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们刚刚创建了方法体。下一步是开始一个接一个地实现它们的功能。</p><p id="362e" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">首先，让我们初始化Pusher</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="ee40" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">仅出于调试目的，我们将<code class="eh mc md me lr b">Pusher.logToConsole</code>设置为<code class="eh mc md me lr b">true</code>，以便查看记录到控制台的实时活动。请记住在生产中删除它，这样就不会让用户的控制台被调试日志弄得臃肿不堪。</p><p id="ebea" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">接下来，我们创建一个<code class="eh mc md me lr b">Pusher</code>的实例。构造函数在我们之前包含的<code class="eh mc md me lr b">pusher-js</code>文件中可用。</p><p id="4894" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">请记住，服务器仍在发送数据。我们需要订阅它，并开始使用传入的数据:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="88dc" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">Pusher上的<code class="eh mc md me lr b">subscribe</code>方法获取我们需要订阅的频道，并返回订阅。然后，我们可以使用<code class="eh mc md me lr b">bind</code>绑定到这个订阅，并向它传递事件的名称和一个回调函数。</p><p id="d135" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在这种情况下，我们调用<code class="eh mc md me lr b">updateChartData</code>并传递数据给它来不断更新图表。我们在名为<code class="eh mc md me lr b">chart</code>的构造函数中创建一个实例变量。我们还调用了<code class="eh mc md me lr b">initializeChart</code>方法来在构造函数中设置图表。在我们看到更新图表逻辑之前，让我们看看这个图表是如何初始化的:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="8603" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">这可能看起来令人不知所措，但仔细观察就会发现，我们只是在定义一个图表，并描述它应该预期什么样的数据，它应该如何标记数据，以及它应该是什么样子。</p><p id="f7da" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">现在，update chart方法使用chart实例在每次数据从Pusher服务器进入时更新图表。</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="a335" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">您可以使用以下命令启动客户端应用程序:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="bec6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">这将在端口5200上启动web应用程序。打开你的浏览器</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mg"><img src="../Images/35e607b14e87d3b00151f0ca899c15dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A9nvEjt4FtbMlzq8.gif"/></div></div></figure><h1 id="ab8b" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">实时报价机</h1><p id="21f7" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">目前，由于Pusher的功能，我们能够用服务器发送的有效载荷实时更新图表。让我们继续添加另一个特性来在表上显示价格。</p><p id="21f9" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们将选择一个随机价格设置为阈值，以确定从服务器接收价格时价格是上升还是下降。这些价格的变化会用不同的颜色表示，因为它可以在任何股票市场图表中获得。</p><p id="3a12" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">记得我们在<code class="eh mc md me lr b">index.html</code>中有以下表格:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="3c4f" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">为了完成这项工作，我们将编辑<code class="eh mc md me lr b">updateChartData()</code>方法，并创建一个名为<code class="eh mc md me lr b">flashColor``()</code>的新方法。新方法将用于根据价格的变化来改变颜色。</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="946f" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">不要忘记在构造函数中包含阈值价格，如下所示:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="f700" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">对于视觉提示，这里有一个函数，它会在每次超过阈值时改变价格文本的颜色:</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="b465" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">就是这样:</p><p id="c953" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">从图表中可以看出，价格的绿色表示价格已经超过阈值，而红色表示价格降低，蓝色表示价格与阈值完全相同。</p><h1 id="93b9" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">结论</h1><p id="9edd" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">从本教程中，我们看到了如何建立一个类似股票市场的平台，价格的变化是实时更新的。这可以在任何图表库的基础上构建和使用。如果您遗漏了什么，可以在GitHub上找到完整的代码。您可以在这里<a class="ae ke" href="https://github.com/christiannwamba/pusher-stock" rel="noopener ugc nofollow" target="_blank">找到它</a>，请随时提交拉动请求。</p><blockquote class="jc jd je"><p id="a69e" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这篇文章最初出现在<a class="ae ke" href="https://blog.pusher.com/realtime-trade-platform-javascript-pusher/" rel="noopener ugc nofollow" target="_blank"> Pusher博客</a>上。</p></blockquote><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="mh mb l"/></div></figure></div></div>    
</body>
</html>