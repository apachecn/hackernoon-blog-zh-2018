<html>
<head>
<title>Handling Android Back Button in Ionic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Ionic中处理Android后退按钮</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/handling-android-back-button-in-ionic-33f7cfbba4b9?source=collection_archive---------6-----------------------#2018-03-07">https://medium.com/hackernoon/handling-android-back-button-in-ionic-33f7cfbba4b9?source=collection_archive---------6-----------------------#2018-03-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="6749" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">总结</strong>:这是一个在Ionic 2和Ionic 3中处理Android后退键的综合方法。后退按钮的行为会像Instagram一样:它会关闭侧边菜单或任何推送的页面，还会在最近使用的标签页之间循环。</p><p id="95e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意</strong>:如果你是高级用户，只想看看结果，可以从<a class="ae jp" href="https://github.com/ourarash/ionic3-android-back-button" rel="noopener ugc nofollow" target="_blank">我的github </a>克隆演示项目。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/9a2463f073fba30e45c79d60cde53312.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*0BNfmYnSgP0-MZ5C2JQcFg.gif"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Handling Android Back Button in Ionic</figcaption></figure><h2 id="e07e" class="kg kh hu bd ki kj kk kl km kn ko kp kq jc kr ks kt jg ku kv kw jk kx ky kz la dt translated">介绍</h2><p id="15ca" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">处理Android后退按钮的问题已经在几个地方解决了，比如这里的<a class="ae jp" href="https://stackoverflow.com/questions/42151944/ionic-2-how-to-handle-the-hardware-back-button-which-checks-confirmation-of-exi" rel="noopener ugc nofollow" target="_blank"/>。但是我没有发现任何一个是全面完整的。我需要一种方法来完成以下任务:</p><ul class=""><li id="5817" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">关闭打开的侧菜单</li><li id="4dca" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">关闭可能已经在任何选项卡页面的导航控制器上推送的任何页面</li><li id="396b" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">如果菜单是关闭的，并且没有推送的页面，它应该把用户带回前一个最近使用的标签。</li><li id="bfd3" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">如果没有以前最近使用的标签，一个警告框会询问用户是否要退出。</li></ul><p id="ae08" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，我将快速解释如何执行上述操作。</p><h2 id="298f" class="kg kh hu bd ki kj kk kl km kn ko kp kq jc kr ks kt jg ku kv kw jk kx ky kz la dt translated">计划概要</h2><p id="c191" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">我们将执行以下操作:</p><ul class=""><li id="edc5" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">我们创建了一个名为<strong class="it hv"> backbuttonService </strong>的新服务，这样每个标签页都可以将其navCtrl注册到这个服务的堆栈中。堆栈将用于环绕最近使用的选项卡</li><li id="4b20" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">我们将创建一个函数来挂钩到<strong class="it hv"> app.component.ts </strong>文件中的后退按钮。</li><li id="b78d" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">在钩子函数中，我们在<strong class="it hv"> backbuttonService </strong>的堆栈中检查菜单、navCtrl上的任何推送页面。</li><li id="489d" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">我们还编写了一个函数，以编程方式在选项卡之间切换。</li></ul><h2 id="bdfd" class="kg kh hu bd ki kj kk kl km kn ko kp kq jc kr ks kt jg ku kv kw jk kx ky kz la dt translated">入门指南</h2><p id="e4a5" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">您可以通过在命令行中运行以下命令来创建一个新的ionic 3项目，接受默认选项并将cd放入backbutton文件夹:</p><pre class="jr js jt ju fq lu lv lw lx aw ly dt"><span id="6951" class="kg kh hu lv b fv lz ma l mb mc">ionic start backbutton sidemenu</span></pre><h2 id="40fc" class="kg kh hu bd ki kj kk kl km kn ko kp kq jc kr ks kt jg ku kv kw jk kx ky kz la dt translated">创建新的选项卡页面</h2><p id="4436" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">现在，向该项目添加三个选项卡页面:</p><pre class="jr js jt ju fq lu lv lw lx aw ly dt"><span id="ad86" class="kg kh hu lv b fv lz ma l mb mc">ionic generate page page1 --no-module<br/>ionic generate page page2 --no-module<br/>ionic generate page page3 --no-module</span></pre><p id="e875" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您需要将这些页面添加到<strong class="it hv">app . module . ts。</strong>将以下内容添加到文件的开头:</p><pre class="jr js jt ju fq lu lv lw lx aw ly dt"><span id="7964" class="kg kh hu lv b fv lz ma l mb mc">import { Page1Page } from '../pages/page1/page1';<br/>import { Page2Page } from '../pages/page2/page2';<br/>import { Page3Page } from '../pages/page3/page3';</span></pre><p id="5b29" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另外，将它们添加到同一个文件中的声明和entryComponents:</p><pre class="jr js jt ju fq lu lv lw lx aw ly dt"><span id="6e56" class="kg kh hu lv b fv lz ma l mb mc">declarations: [<br/>MyApp,<br/>HomePage,<br/>ListPage,<br/>Page1Page,  // Add this line!<br/>Page2Page,  // Add this line!  <br/>Page3Page,  // Add this line!<br/>],</span><span id="2dab" class="kg kh hu lv b fv md ma l mb mc">...</span><span id="7de3" class="kg kh hu lv b fv md ma l mb mc">entryComponents: [<br/>MyApp,<br/>HomePage,<br/>ListPage,<br/>Page1Page,  // Add this line!<br/>Page2Page,  // Add this line!<br/>Page3Page,  // Add this line!<br/>],</span></pre><p id="7c9a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">创建新服务:BackbuttonService </strong></p><p id="38ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在src下创建一个新文件夹和文件:</p><pre class="jr js jt ju fq lu lv lw lx aw ly dt"><span id="3465" class="kg kh hu lv b fv lz ma l mb mc">src/services/backbutton.service.ts</span></pre><p id="c289" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意</strong>:你可以从<a class="ae jp" href="https://github.com/ourarash/ionic3-android-back-button/blob/master/src/services/backbutton.service.ts" rel="noopener ugc nofollow" target="_blank">我的github </a>获取，而不是在这里复制完整的文件。</p><p id="0c66" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个文件有两个简单的函数，用于选项卡页面的推送和弹出，这样我们就可以跟踪最近使用的选项卡页面。</p><p id="e5ed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您还需要在<strong class="it hv"> app.module.ts </strong>中注册服务:</p><pre class="jr js jt ju fq lu lv lw lx aw ly dt"><span id="5c5f" class="kg kh hu lv b fv lz ma l mb mc">import { BackbuttonService } from "../services/backbutton.service";<br/>...<br/> providers: [<br/>StatusBar,<br/>SplashScreen,<br/>BackbuttonService, // Add this line!<br/>]</span></pre><p id="1e9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">为选项卡创建一个全局变量:</strong></p><p id="e487" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建一个名为<strong class="it hv">的新文件。你可以把它放在任何地方。我选择放在src/app下。它包含以下内容:</strong></p><pre class="jr js jt ju fq lu lv lw lx aw ly dt"><span id="6e3b" class="kg kh hu lv b fv lz ma l mb mc">//Enum variable for tab <br/>export var EN_TAB_PAGES = {<br/>EN_TP_HOME: 0,<br/>EN_TP_PLANET:1,<br/>EN_TP_STAR: 2,<br/>EN_TP_LENGTH: 3,<br/>}</span><span id="3a94" class="kg kh hu lv b fv md ma l mb mc">//A global variable <br/>export var Globals = {</span><span id="fab3" class="kg kh hu lv b fv md ma l mb mc">//Nav ctrl of each tab page<br/>navCtrls : new Array(EN_TAB_PAGES.EN_TP_LENGTH),</span><span id="04ea" class="kg kh hu lv b fv md ma l mb mc">tabIndex:0, //Index of the current tab<br/>tabs: &lt;any&gt;{}, //Hook to the tab object<br/>}</span></pre><h2 id="d93c" class="kg kh hu bd ki kj kk kl km kn ko kp kq jc kr ks kt jg ku kv kw jk kx ky kz la dt translated">向app.component.ts添加钩子函数</h2><p id="58aa" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">我们向该文件添加了三个函数:</p><ul class=""><li id="701a" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated"><strong class="it hv"> registerBackButton </strong>:挂钩Cordova处理Android返回按钮的功能。它首先检查侧菜单是否打开，如果打开，则关闭菜单。</li><li id="182c" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated"><strong class="it hv"> showAlert </strong>:显示一个警告，询问用户是否确定要退出</li><li id="9f20" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated"><strong class="it hv"> switchTab </strong>:以编程方式在标签之间切换</li></ul><p id="f9f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于改动比较长，我就不在这里复制了，不过你可以在<a class="ae jp" href="https://github.com/ourarash/ionic3-android-back-button/blob/master/src/app/app.component.ts" rel="noopener ugc nofollow" target="_blank"> my github </a>上看到详细的改动。</p><h2 id="e882" class="kg kh hu bd ki kj kk kl km kn ko kp kq jc kr ks kt jg ku kv kw jk kx ky kz la dt translated">将每个标签页推入堆栈</h2><p id="b406" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">每当我们打开一个新的标签页，我们应该把它推到堆栈中。如果它已经存在于堆栈中，我们删除它并再次添加它。这将产生Instagram效果，我们在最近使用的标签周围打圈，但我们不会浏览同一个标签两次。为此，我们在每个标签页中注入<strong class="it hv"> backbuttonService </strong>并使用它。</p><p id="b61a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在每个选项卡页面中添加以下内容:</p><pre class="jr js jt ju fq lu lv lw lx aw ly dt"><span id="ed51" class="kg kh hu lv b fv lz ma l mb mc">import { BackbuttonService } from '../../services/backbutton.service';<br/>import { EN_TAB_PAGES } from "../../app/app.config";</span><span id="5c47" class="kg kh hu lv b fv md ma l mb mc">...</span><span id="bfa6" class="kg kh hu lv b fv md ma l mb mc">//Inject the service<br/>constructor(public navCtrl: NavController, <br/>public navParams: NavParams,<br/>private backbuttonService: BackbuttonService,</span><span id="7ad9" class="kg kh hu lv b fv md ma l mb mc">) {}</span><span id="51a6" class="kg kh hu lv b fv md ma l mb mc">...</span><span id="3a83" class="kg kh hu lv b fv md ma l mb mc">ionViewWillEnter() {<br/>   this.backbuttonService.pushPage(EN_TAB_PAGES.EN_TP_HOME,  <br/>   this.navCtrl);<br/>}</span></pre><p id="8fc4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在上面的代码中，请注意，对于每个选项卡页面，您应该使用它自己的EN_TAB_PAGES值。</p><p id="678b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！如果你喜欢这个教程，请分享并鼓掌。我真的很感激！</p><p id="325b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另外，对于正确处理Android后退按钮的生产级Ionic应用程序，请检查我的以下应用程序:</p><ul class=""><li id="8e19" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">比特币疯狂:<a class="ae jp" href="http://bitcoincrazyness.com" rel="noopener ugc nofollow" target="_blank">http://bitcoincrazyness.com</a></li><li id="827b" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">plus one Social:<a class="ae jp" href="http://okPlusOne.com" rel="noopener ugc nofollow" target="_blank">http://okPlusOne.com</a></li></ul></div></div>    
</body>
</html>