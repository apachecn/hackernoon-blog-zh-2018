<html>
<head>
<title>No more running around the block: Lambda-S3 thumbnailer, nailed by SLAppForge Sigma!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要再在街区里跑来跑去:拉姆达-S3钉书人，被斯拉普佛格·适马钉上了！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/no-more-running-around-the-block-lambda-s3-thumbnailer-nailed-by-slappforge-sigma-591622538c65?source=collection_archive---------30-----------------------#2018-03-09">https://medium.com/hackernoon/no-more-running-around-the-block-lambda-s3-thumbnailer-nailed-by-slappforge-sigma-591622538c65?source=collection_archive---------30-----------------------#2018-03-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="3722" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你还没有注意到，我最近一直在喋喋不休地谈论我在试图开始使用<a class="ae jp" href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example.html" rel="noopener ugc nofollow" target="_blank">官方AWS lambda-S3示例</a>时遇到的T2陷阱。虽然大多数这些愚蠢的错误都归咎于我自己的懒惰、过度自信和缺乏对细节的关注，但我个人认为，与一家领先的无服务器提供商合作不应该那么困难。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/8fe9a8fb31d1d9c6700ad89725d8e7ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/0*eSHdtlsCRjFNVWfy."/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek"><a class="ae jp" href="https://previews.123rf.com/images/inspirestock/inspirestock1402/inspirestock140202784/26145257-businessman-banging-his-head-against-the-wall.jpg" rel="noopener ugc nofollow" target="_blank">(https://previews.123rf.com/images/inspirestock/inspirestock1402/inspirestock140202784/26145257-businessman-banging-his-head-against-the-wall.jpg</a>)</figcaption></figure><p id="8fe9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在<a class="ae jp" href="https://slappforge.com/" rel="noopener ugc nofollow" target="_blank"> SLAppForge </a>的团队也是如此。我们建造了<a class="ae jp" href="https://sigma.slappforge.com/" rel="noopener ugc nofollow" target="_blank">适马</a>让它成为现实。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff kc"><img src="../Images/4b5578c9988bba79c05665376d117f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0GFjnNtcL3TGB3TjIOlgfw.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Sigma</figcaption></figure><p id="ac45" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们看看适马能做什么，让你的无服务器生活变得简单。</p><p id="7cb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">适马已经有了S3图钉样本的现成版本。根据<a class="ae jp" href="https://github.com/slappforge/s3-thumbnail-generator/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">自述文件</a>，如果你敢的话，部署它应该只需要几分钟。</p><p id="ae5f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这次讨论中，让我们采取一种更实际的方法:从最初的<a class="ae jp" href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example-deployment-pkg.html#Node.js" rel="noopener ugc nofollow" target="_blank">缩略图样本</a>中抓取代码，将其粘贴到适马，然后<a class="ae jp" href="https://docs.slappforge.com/first_project.html" rel="noopener ugc nofollow" target="_blank">将其部署到AWS</a>——上次我尝试的时候，正是这种方法让我<a class="ae jp" href="https://dzone.com/articles/running-around-the-block-a-dummys-first-encounter" rel="noopener ugc nofollow" target="_blank">在模块</a>中跑来跑去。</p><p id="963f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@janaka_bandara/sigma-the-new-kid-on-the-serverless-block-48b0fa02ad2b">正如你可能知道的</a>，适马代表你管理许多关于你的应用的“幕后”事务——包括功能许可、<a class="ae jp" href="https://docs.slappforge.com/concepts/triggers.html" rel="noopener ugc nofollow" target="_blank">触发配置</a>和相关的<a class="ae jp" href="https://docs.slappforge.com/concepts/resources.html" rel="noopener ugc nofollow" target="_blank">资源</a>。这依赖于代码中遵循的特定语法准则，幸运的是，这些准则非常简单和普通。所以我们所要做的就是抓取原始源代码，粘贴到适马，做一些调整和<a class="ae jp" href="https://docs.slappforge.com/concepts/operations.html" rel="noopener ugc nofollow" target="_blank">拖放配置</a>之类的东西——适马会理解并处理剩下的。</p><p id="3bf8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你还没有，现在是注册适马T10的好时机，这样我们就可以开始用无服务器的美妙来激励你。(撇开恭维不谈，你真的需要一个适马账户才能访问ide。)看看<a class="ae jp" href="https://docs.slappforge.com/getting_started.html" rel="noopener ugc nofollow" target="_blank">这个小指南</a>就能上手了。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff ki"><img src="../Images/141eba8979b65addd4904d1fc84b3151.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/0*KWha9kqJ7ZB3NW0J.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Sigma: create an account</figcaption></figure><p id="8999" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你进入，只要从AWS docs 复制<a class="ae jp" href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example-deployment-pkg.html#Node.js" rel="noopener ugc nofollow" target="_blank"> S3的缩略图样本代码，然后把它塞给适马。</a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff kj"><img src="../Images/92d33a12f1c5c56cc4eb64645de1ac5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Dhcl6zZS-KUu8wTC.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">S3 thumbnail sample code from AWS docs, pasted into Sigma</figcaption></figure><p id="396d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">原本会相当平淡乏味的编辑器，现在会开始显示一些有趣的东西；尤其是在<a class="ae jp" href="https://docs.slappforge.com/basic_functionalities.html#Editor" rel="noopener ugc nofollow" target="_blank">编辑区</a>的左边界。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff kk"><img src="../Images/9f5353de19d516f1a6728d922559b9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:216/format:webp/0*hxQdm9hVY3gqUJbr.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Code comes to life: operation and trigger indicators on left border</figcaption></figure><p id="fdb3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">顶部的闪电符号(对着突出显示<code class="eh kl km kn ko b">event</code>变量的函数头)表示一个<a class="ae jp" href="https://docs.slappforge.com/concepts/triggers.html" rel="noopener ugc nofollow" target="_blank"> <em class="kh">触发器</em></a>；函数的调用(入口)点。虽然这不是函数本身的一部分，但它仍然应该正确配置，具有必要的源(S3桶)、目的地(lambda函数)和权限。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff kp"><img src="../Images/62781a520ac7ca7c5017ebe22fa5ab20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/0*w92XUskouNSJaL9L.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Trigger indicator: still red (unconfigured)</figcaption></figure><p id="5091" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好的一点是，有了适马，你只需要注明<a class="ae jp" href="https://docs.slappforge.com/components/aws/s3.html#s3-as-a-trigger" rel="noopener ugc nofollow" target="_blank">来源(S3桶)配置</a>；适马会处理剩下的事情。</p><p id="7a12" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此时闪电标志为红色，表示<a class="ae jp" href="https://docs.slappforge.com/concepts/triggers.html#define-trigger" rel="noopener ugc nofollow" target="_blank"> a触发器尚未配置</a>。只需将一个<a class="ae jp" href="https://docs.slappforge.com/components/aws/s3.html" rel="noopener ugc nofollow" target="_blank"><em class="kh">【S3】</em>条目</a>从左窗格拖到上面的行(函数头)上，向适马表明这个lambda应该由一个<a class="ae jp" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/notification-content-structure.html" rel="noopener ugc nofollow" target="_blank"> S3事件</a>触发。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff kq"><img src="../Images/4c9ecf9b79c8e647481ba2ca452ed92e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0U722mFaylUFJ031.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Dragging a S3 entry</figcaption></figure><p id="0403" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">只要你做了拖放操作，适马就会问你关于拼图中缺失的部分:即应该是lambda 的触发点的<a class="ae jp" href="https://docs.slappforge.com/components/aws/s3.html#set-bucket" rel="noopener ugc nofollow" target="_blank"> S3桶，以及应该触发它的操作的性质；在我们的例子中，它是图像文件的</a><a class="ae jp" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html#supported-notification-event-types" rel="noopener ugc nofollow" target="_blank">“对象创建”事件</a>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff kr"><img src="../Images/fe990b2ddabd2e8be3e63dc82833d76d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/0*YgUJWHeAeeF4QVcp.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">S3 trigger pop-up</figcaption></figure><p id="7823" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在指定源时段时，适马为您提供了两种选择:您可以</p><ul class=""><li id="0f83" class="ks kt hu it b iu iv iy iz jc ku jg kv jk kw jo kx ky kz la dt translated">通过下拉列表(<em class="kh">现有桶</em>选项卡)选择一个现有桶，或</li><li id="2e1c" class="ks kt hu it b iu lb iy lc jc ld jg le jk lf jo kx ky kz la dt translated">通过<em class="kh"> New bucket </em>选项卡定义一个新的Bucket名称，这样适马将重新创建它作为项目部署的一部分。</li></ul><p id="7125" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于“图像文件”类别涉及几种文件类型，我们需要为lambda定义多个触发器，每个触发器对应一种不同的文件类型。(不幸的是，S3触发器<a class="ae jp" href="https://stackoverflow.com/questions/33107809/using-a-wildcard-on-s3-event-notification-prefix" rel="noopener ugc nofollow" target="_blank">还不支持文件名前缀/后缀的模式</a>；如果他们这样做了，我们只需要一个扳机就能逃脱！)因此，让我们首先为JPG文件定义一个触发器，方法是选择“对象已创建”作为事件并输入。png "作为后缀，并拖放和配置另一个触发器与"。jpg”作为后缀——你猜对了，是JPG文件。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lg"><img src="../Images/d5621fd8e16f7857f2748db2aefc3768.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/0*PVHfa1dMxcoJDbQj.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">S3 trigger for PNG files</figcaption></figure><p id="63b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您为第二个触发器选择bucket时，有一件小事需要记住:即使您为第一个触发器输入了一个新的bucket名称，您也必须为第二个触发器从“Existing bucket”选项卡中选择相同的、已经定义的Bucket，而不是再次提供Bucket名称作为“new”Bucket。原因是适马跟踪每个新定义的资源(因为它必须在部署时创建存储桶),如果您定义一个新的存储桶两次，适马会感到“困惑”,部署可能不会按计划进行。为了减少歧义，当我们在现有的存储桶列表下显示新定义的存储桶时，我们将新定义的存储桶标记为“(New)”(比如用<code class="eh kl km kn ko b">my-new-bucket (New)</code>表示新添加的<code class="eh kl km kn ko b">my-new-bucket</code>)——至少现在是这样，直到我们找到更好的选择；如果你有一个很酷的想法，请随时加入<a class="ae jp" href="https://github.com/slappforge/sigma/issues" rel="noopener ugc nofollow" target="_blank">！</a>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/68f6e1fab388f5686cd4b1a4b0b5eecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/0*MCeu1NSXm-TrZqKP.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Selecting our new S3 bucket, from the existing buckets list</figcaption></figure><p id="0fc4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在两个触发器都准备好了，我们可以继续进行<a class="ae jp" href="https://docs.slappforge.com/concepts/operations.html" rel="noopener ugc nofollow" target="_blank"> <em class="kh">操作</em> </a>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff li"><img src="../Images/7f581e4b353939cc63f5ef6dd59cfac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/0*777HopP4DnT5xo2v.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">S3 trigger list pop-up with both triggers configured</figcaption></figure><p id="85d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可能已经注意到了编辑器左窗格上的两个S3图标，在触发指示器的下方，正对着<code class="eh kl km kn ko b">s3.getObject</code>和<code class="eh kl km kn ko b">s3.putObject</code>调用。两个操作的参数块也将突出显示。这表明适马已经识别了API调用，并且可以通过自动生成必要的附加功能来帮助你(比如执行权限)。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/2d300a2e547094aa176dd160220ade02.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/0*oW1A6FNk2JEqVY7y.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">A S3 operation, highlighted</figcaption></figure><p id="0734" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击第一个图标(对着<code class="eh kl km kn ko b">s3.getObject</code>，打开操作编辑弹出窗口。我们在这里所要做的就是为<strong class="it hv">桶</strong>参数选择正确的桶名(同样，确保您在“现有”选项卡上选择“(新)”前缀的桶，而不是在“新”选项卡上重新输入桶名)并点击<strong class="it hv">更新</strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lk"><img src="../Images/305a43f042d0248c569f9ba974b7ec8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/0*OBI6bpZvLv_7qTif.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">S3 getObject operation pop-up</figcaption></figure><p id="76ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同样，使用第二个图标(<code class="eh kl km kn ko b">s3.putObject</code>)，选择一个目的地存储桶。因为我们还没有添加或使用目的地存储桶定义，这里您将向适马添加一个新的存储桶定义；因此，您可以选择一个现有的存储桶或命名一个新的存储桶，就像第一个触发器的情况一样。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/cfc06112dc567e56b80a18a51c1a5688.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/0*2NdFqBFZocUGynyE.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">S3 putObject operation pop-up</figcaption></figure><p id="8e14" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有一步:添加依赖项。</p><p id="bd0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然适马为您提供了向项目添加第三方依赖项的超酷功能，但它确实需要在构建时知道依赖项的名称和版本。由于我们复制并粘贴了一个外来的代码块到编辑器中，我们应该单独告诉适马代码中使用的依赖项，这样它就可以将它们与我们的项目源代码捆绑在一起。只需点击工具栏上的“添加依赖关系”按钮，搜索依赖关系并点击“添加”，所有添加的依赖关系(以及两个默认设置，<code class="eh kl km kn ko b">aws-sdk</code>和<code class="eh kl km kn ko b">@slappforge/slappforge-sdk</code>)都会出现在<strong class="it hv">添加依赖关系</strong>按钮下的依赖关系下拉列表中。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lm"><img src="../Images/998794ac45f1f570c9a923a68eb6144c.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/0*Z2S0cvC_2LArQaPu.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">“Add Dependency” button with dependencies drop-down</figcaption></figure><p id="8213" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的例子中，保持<a class="ae jp" href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example-deployment-pkg.html#Node.js" rel="noopener ugc nofollow" target="_blank">原始AWS示例指南</a>，我们必须添加<code class="eh kl km kn ko b"><a class="ae jp" href="https://www.npmjs.com/package/async" rel="noopener ugc nofollow" target="_blank">async</a></code>(用于瀑布式执行流)和<code class="eh kl km kn ko b"><a class="ae jp" href="https://www.npmjs.com/package/gm" rel="noopener ugc nofollow" target="_blank">gm</a></code>(用于<a class="ae jp" href="http://www.graphicsmagick.org/" rel="noopener ugc nofollow" target="_blank"> GraphicsMagick </a>)依赖项。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff ln"><img src="../Images/ef11edde9fe436365c3a449ee2846ea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tQfEaYnYcEuO-Lpl.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Adding async dependency</figcaption></figure><p id="7061" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">搞定了。</p><p id="e603" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在剩下的就是点击IDE工具栏上的<strong class="it hv">部署</strong>按钮，让轮子开始运动！</p><p id="8451" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，适马会将应用程序源代码保存(提交)到你的GitHub repo中。因此，当适马向你索要提交信息时，一定要提供一条漂亮的提交信息:)你也可以选择自己最喜欢的回购协议名称，如果它不存在，适马将会创建一个。(然而，当遇到“空”回购(即没有主分支的回购)时，适马有一个已知的故障，所以如果你有一个全新的回购，请确保你在主分支上至少有一个提交；最简单的方法是创建一个自述文件，只需在回购创建时点击即可<a class="ae jp" href="https://developer.github.com/changes/2012-09-28-auto-init-for-repositories/" rel="noopener ugc nofollow" target="_blank">轻松完成。)</a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lo"><img src="../Images/8e6b08415fa8241d11ee9bea2e630c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/0*a0vaoye-4KalrQ8_.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Committing your code</figcaption></figure><p id="44b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">保存完成后，适马将自动构建您的项目，并打开一个部署摘要弹出窗口，显示它将部署到您的AWS帐户的关于您的全新S3缩略图生成器的所有内容。有些名称看起来有些混乱，但是它们通常反映了部署资源的类型和名称(例如，<code class="eh kl km kn ko b">s3MyAwesomeBucket</code>可能代表一个名为<code class="eh kl km kn ko b">my-awesome-bucket</code>的新S3存储桶)。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff lp"><img src="../Images/199a80a9c64b66d764bf5a4945603aad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j4IboUf79WZWw0y3.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Build in progress!</figcaption></figure><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lq"><img src="../Images/66315eed08eecd2e4416eaadea1f557c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/0*dD6XYmxHp4qp6qlr.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Deployment changes summary</figcaption></figure><p id="9e63" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看列表(如果你敢)并点击<strong class="it hv">执行</strong>。部署机制将启动，显示一个实时的进度条(以及一个日志视图，显示项目的底层<a class="ae jp" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacks.html" rel="noopener ugc nofollow" target="_blank"> CloudFormation栈</a>中发生的变化)。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lr"><img src="../Images/6e84340fa9cc6b050271863aaa96e433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/0*JQ57Cl8_kdxdPXlJ.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Deployment in progress!</figcaption></figure><p id="3584" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦部署完成，您期待已久的缩略图生成器lambda就可以进行测试了！只需上传一个JPG或PNG文件到你选择的源桶中(通过<a class="ae jp" href="https://s3.console.aws.amazon.com/s3/home" rel="noopener ugc nofollow" target="_blank"> S3控制台</a>，或者通过<code class="eh kl km kn ko b"><a class="ae jp" href="https://docs.aws.amazon.com/cli/latest/reference/s3/cp.html" rel="noopener ugc nofollow" target="_blank">aws s3 cp</a></code>，如果你更像我的话)，你会惊奇地发现在几秒钟内你的目标桶中会弹出缩略图！</p><p id="48e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您在目的地桶中没有看到任何有趣的东西(在短暂的等待之后)，您将能够通过检查lambda的<a class="ae jp" href="https://console.aws.amazon.com/cloudwatch/home#logs:" rel="noopener ugc nofollow" target="_blank">执行日志</a>来检查出了什么问题，就像在任何其他lambda的情况下一样；我们知道回到AWS控制台来做这件事是很痛苦的，我们希望很快找到一个更酷的替代品。</p><p id="cd5f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想把生成的缩略图公开(就像我上一篇文章说的，私有缩略图有什么用？)，你不用跑来跑去看IAM文档，更新IAM角色，揪头发；只需点击<code class="eh kl km kn ko b">s3.putObject</code>调用对应的S3操作编辑图标，从下拉列表中选择要应用到对象参数的<strong class="it hv"> ACL作为<code class="eh kl km kn ko b">public-read</code>，然后点击<strong class="it hv">部署</strong>以经历另一个保存-构建-部署循环。(我们已经在努力加快这些“小变化”的部署，所以现在请耐心等待:)</strong></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/0a5b2ed430f2894c0542071a03b9e1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/0*CxG2pJueDCMKBQGn.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Making thumbnails public: S3 putObject operation edit pop-up</figcaption></figure><p id="7fb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦新的部署完成，为了查看任何新生成的缩略图，您只需将URL <code class="eh kl km kn ko b">http://&lt;bucketname&gt;.s3.amazonaws.com/resized-&lt;original image name&gt;</code>输入您最喜欢的网络浏览器，然后按enter键！</p><p id="2636" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哦，如果你遇到任何不寻常的事情——提交/构建/部署失败、不寻常的错误或适马本身的错误——别忘了通过Slack 通知我们——或者在我们的<a class="ae jp" href="https://github.com/slappforge/sigma/issues" rel="noopener ugc nofollow" target="_blank">公共问题追踪器</a>上发布问题；您可以在IDE中使用“帮助”→“报告问题”菜单项来完成此操作。同样的道理也适用于你希望在未来的适马中看到的任何改进或很酷的特性:更快的构建和部署，下载构建/部署工件的能力，一套闪亮的新主题，等等。请告诉我们，我们会将它添加到我们的待办事项中，并在不久的将来尝试一下！</p><p id="f8e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好了，伙计们，是时候回去了，<a class="ae jp" href="https://sigma.slappforge.com/#/project" rel="noopener ugc nofollow" target="_blank">开始和适马</a>玩了，我要写下一篇博文了！</p><p id="586c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请继续关注SLAppForge的更多内容！</p></div><div class="ab cl lt lu hc lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hn ho hp hq hr"><p id="50f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kh">原载于2018年3月9日</em><a class="ae jp" href="http://randomizd.blogspot.com/2018/03/no-more-running-around-block-lambda-s3.html" rel="noopener ugc nofollow" target="_blank"><em class="kh">randomizd.blogspot.com</em></a><em class="kh">。</em></p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ma mb l"/></div></figure></div></div>    
</body>
</html>