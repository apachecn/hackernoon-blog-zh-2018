<html>
<head>
<title>Microservices for Startups — An Interview with Sam Stagg and Pawel Ledwoń of Pusher</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初创企业的微服务Pusher的Sam Stagg和Pawel Ledwon访谈</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/microservices-for-startups-an-interview-with-sam-stagg-and-pawel-ledwon%CC%81-of-pusher-5cfb332849b7?source=collection_archive---------35-----------------------#2018-03-09">https://medium.com/hackernoon/microservices-for-startups-an-interview-with-sam-stagg-and-pawel-ledwon%CC%81-of-pusher-5cfb332849b7?source=collection_archive---------35-----------------------#2018-03-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="437f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">这次采访是为我们的</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">创业微服务</em> </a> <em class="jp">电子书做的。一定要去看看关于微服务的实用建议。感谢Sam和Pawel的时间和投入！</em></p><p id="4b10" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" href="https://twitter.com/swstagg?lang=en" rel="noopener ugc nofollow" target="_blank"> <em class="jp">山姆·斯塔格</em> </a> <em class="jp">是</em> <a class="ae jq" href="https://goo.gl/jMyqfG" rel="noopener ugc nofollow" target="_blank"> <em class="jp">推手</em> </a> <em class="jp">的工程副总裁。</em><a class="ae jq" href="https://twitter.com/pawel_ledwon?lang=en" rel="noopener ugc nofollow" target="_blank"><em class="jp"/></a><em class="jp">是平台领导在推焦。Pusher的实时通信和协作API允许开发人员构建应用内通知、活动流、聊天、仪表盘、协作工具以及多人游戏等功能。</em></p><p id="76bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于上下文，您的工程团队有多大？您是否正在使用微服务，能否概述一下您是如何使用它们的？</p><p id="57c1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们团队有25名工程师。核心Pusher产品是一个可靠且易于使用的通信和协作API和支持平台，为开发人员提供构建可扩展的交互式应用程序所需的一切。这不是基于微服务的。</p><p id="ce86" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们在第二代平台中使用微服务，该平台支持我们的新产品和测试产品套件。Chatkit 和<a class="ae jq" href="https://pusher.com/textsync" rel="noopener ugc nofollow" target="_blank"> TextSync </a>是这一努力的早期成果。</p><p id="3c16" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">你是从整体式开始，后来采用微服务的吗？如果是，采用微服务的动机是什么？你是如何评估权衡的？如果没有，你是直接从微服务入手的吗？为什么？</strong></p><p id="3cd2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如上所述，我们的核心产品不使用微服务，但它也不是一个整体。这是一组高度集中的服务，相互耦合，但并不紧密到我们不遵守服务边界的程度。然而，服务边界主要是出于性能和可伸缩性的原因而定义的，而不是由业务域定义的。</p><p id="0ae6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">核心产品也是一个架构上的壮举，证明你可以构建一个高度可靠的、可伸缩的和高性能的产品，像Pusher一样，它由一个为性能而非稳定性优化的消息总线(Redis)和一个“慢”动态语言的事件驱动框架(EventMachine &amp; Ruby)组成。</p><p id="bd00" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管我们对核心产品的这种架构很满意，但是我们使用的堆栈对于扩展到未来的产品开发来说是一个死胡同。鉴于Pusher的持续商业增长，改变架构就像是在发射过程中改变火箭的引擎。</p><p id="c278" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，当我们决定在新产品开发上投入工程时间时，我们决定我们还需要一个新的平台。这个新平台将帮助我们开发新产品，并缩短新产品试验的上市时间。微服务似乎是一个不错的选择，因为基于微服务的良好架构允许您快速部署新功能，如果成功，这些新功能可以自然扩展，如果失败，则优雅地退出。</p><p id="b919" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为一个团队/工程组织，你是如何处理微服务这个话题的？是否围绕微服务的定义进行了讨论？</p><p id="1e04" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们倾向于灵活定义微服务，因为我们将微服务视为一种哲学基础或平台，而不是教条的“唯一正确的方式”我们认为这些基础微服务原则是:</p><p id="5688" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">●开发基础设施自动化和工具。</p><p id="0550" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">●使用虚拟化和容器化的基础设施。</p><p id="13ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">●构建分布式容错系统。</p><p id="aeed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">●将独立的服务部署为组件。</p><p id="18b1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们发现这比定义服务的规模或功能限制更有用。</p><p id="d9e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">在采用微服务后，你是否改变了团队的组织或运营方式？</strong></p><p id="481b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们试图组织我们的团队来利用康威定律(组织被限制生产反映组织通信结构的系统)。因此，我们有一个为平台构建核心共享服务的小团队，而支持特定产品的服务是由构建产品的团队构建的。</p><p id="e44d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">在技术选择上有多少自由？你们是否都同意坚持使用一个堆栈，或者是否有尝试新堆栈的灵活性？你是如何做出那个决定的？</strong></p><p id="de73" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管我们对实验持开放态度，但我们的堆栈看起来很保守。团队用Go编写大部分代码。他们经常使用关系数据库。在我们的规模上，技术多样性带来了巨大的代价。如果我们想引入第二种编程语言，至少需要一年的时间才能让它与我们内部的围棋生态系统相媲美。自从我们开始在新平台上工作以来，我们已经开发了大量的工具和经验。从零开始会给产品团队带来巨大的成本。</p><p id="9502" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以想象在未来扩大我们的堆栈。然而，首先我们需要在组织(更多工程师)或基础设施(更多流量)方面有所增长。技术多样性促进创造力，如果做得好，还能提高效率。</p><p id="f68e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你如何确定服务边界？你团队中的讨论是什么样的？你能举些例子吗？您从规模调整服务中学到了什么？</p><p id="4ea6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用我们新平台的每个产品都是由独立团队开发的独立服务。在它们之间划出界限以减少协调是有意义的。产品团队可以自由设计他们的内部系统来满足他们的需求。</p><p id="9e70" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该平台由一组运行在产品服务前面的服务组成。该平台由三个团队维护。我们有一个团队负责基础设施(Kubernetes和外设)，一个团队负责服务(我们的前端代理、认证、速率限制等)。)和一个用于分析。</p><p id="0689" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们没有一套针对开发人员的指导方针。大多数情况下，我们引入边界有两个原因:(1)当分离出一个依赖关系使得对组件进行推理变得更容易时，以及(2)当它提高系统的可伸缩性和可用性时。</p><p id="c588" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">服务的扩散对于小团队来说是个大问题。我们倾向于从一个较小的较大组件集合开始，只在需要的时候重构它们。</p><p id="99e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对你的开发过程有什么影响？您的运营和部署流程？出现了哪些挑战，你是如何解决的？你能举些例子吗？</strong></p><p id="8336" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的大部分挑战来自于转向Kubernetes。和我们原来的栈完全不一样。</p><p id="f7d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，这也无助于项目的年轻和缺乏工具，尤其是在部署领域。</p><p id="74ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对你的测试方式有什么影响？在这方面有什么经验教训或建议？你能举些例子吗？</strong></p><p id="e913" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">包含许多服务的测试系统总是有问题。测试套件中的依赖管理仍然很笨拙。我希望随着云原生生态系统的成长，社区将开发针对此类架构的新测试框架。</p><p id="c6d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在新的平台上，我们倾向于验收和集成测试。单元测试对于某些抽象仍然有用，但是对于面向用户的特性，它们很难模仿或跳过系统的重要部分。</p><p id="94c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对安全性和控制数据访问有何影响？在这方面有什么经验教训或建议？你能举些例子吗？</strong></p><p id="6015" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">迁移到新平台对安全性帮助很大。我们有几个所有产品通用的安全层。服务可以提供额外的本地保护。</p><p id="5c3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Kubernetes允许我们对集群实施粒度访问控制，并实施网络策略。最重要的是，我们使用服务网格来保护应用程序级别的通信。</p><p id="9c4f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还发现实现安全认证很棘手。大量文章描述了JSON Web令牌的问题。该平台的第一个重大决策是将一个通用令牌验证系统集成到我们的前端代理中。这样，产品团队不需要实现认证逻辑。服务不知道我们客户的API密钥，这消除了一个重要的攻击媒介。</p><p id="92f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">您是否遇到过在微服务架构中管理数据一致性的问题？如果是的话，你能描述一下这些问题以及你是如何着手解决的吗？</strong></p><p id="8e91" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">像Pusher face这样的公司有一个特殊的问题——开发人员需要在至少12个SDK中实现每个功能。这是一个工作乘数，开发新特性的时间与SDK的数量成正比。我们必须通过避免任何复杂的协调逻辑来为我们的客户保持简单。</p><p id="d17b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">缺乏数据一致性增加了复杂性。我们通过确保客户端使用的API通过简单的端点提供一致的信息来保持我们的客户端库精简。</p><p id="9a97" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中一个问题是恢复中断的订阅。例如，订阅了聊天的客户端失去连接5分钟。当它返回时，客户端需要检索错过的消息并重新建立订阅。这似乎是一个微不足道的问题，但很难找到在推进者规模下工作的开箱即用的解决方案。</p><p id="9825" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们在订阅实现中发现了一个模式——服务结合了主数据存储(如关系数据库)和消息总线(如Redis)进行实时更新。因为大多数消息总线提供有限的缓冲能力，所以客户端有时需要在恢复订阅之前联系主存储。因为这种设计非常普遍，所以我们实现了一个抽象，我们称之为“可恢复订阅”</p><p id="a738" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">可恢复订阅协调主存储和消息总线，为客户端提供简单、一致的API。它们可以防止由于拥有两个不相交的数据源而导致的数据丢失和重复。对于现有的开源项目或托管解决方案，对主存储和消息总线的要求足够低。</p><p id="a56d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">再次感谢Sam和Pawel的时间和投入！这次采访是为我们的</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">创业微服务</em> </a> <em class="jp">电子书做的。一定要去看看关于微服务的实用建议。</em></p></div><div class="ab cl jr js hc jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hn ho hp hq hr"><p id="86bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文原载于buttercms.com</em><a class="ae jq" href="https://buttercms.com/blog/microservices-for-startups-an-interview-with-sam-stagg-and-pawel-ledwon-of-pusher" rel="noopener ugc nofollow" target="_blank"><em class="jp"/></a><em class="jp">。这是《创业公司的微服务》一书</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> <em class="jp">采访系列的一部分。<em class="jp">注册后，新章节一发布，你就会收到电子邮件。</em></em></strong></a></p><p id="156a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢这篇文章，请在下面鼓掌，帮助它传播！更多类似的内容，请关注我们的 <a class="ae jq" href="https://twitter.com/ButterCMS" rel="noopener ugc nofollow" target="_blank"> <em class="jp">推特</em> </a> <em class="jp">和</em> <a class="ae jq" href="https://buttercms.com/blog/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">订阅我们的博客</em> </a> <em class="jp">。</em></p><p id="e56b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想在你的网站上添加一个博客或者内容管理系统，而不是用Wordpress， <a class="ae jq" href="https://buttercms.com/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">你应该试试黄油内容管理系统</em> </a> <em class="jp">。</em></p></div></div>    
</body>
</html>