<html>
<head>
<title>PostgreSQL vs MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL vs MongoDB</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/https-medium-com-cn007b-postgresql-vs-mongodb-6d8bdb7c1697?source=collection_archive---------1-----------------------#2018-03-10">https://medium.com/hackernoon/https-medium-com-cn007b-postgresql-vs-mongodb-6d8bdb7c1697?source=collection_archive---------1-----------------------#2018-03-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/58c9a3c410a4eb7f9b1dd69b1825f760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cpUX8aLyX2i4lMPJJojIOg.png"/></div></div></figure><div class=""/><div class=""><h2 id="5a78" class="pw-subtitle-paragraph jc ie if bd b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ek translated">在相同数据集上测试PostgreSQL和MongoDB的读取性能</h2></div><h2 id="25b6" class="ju jv if bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">TL；博士:</h2><p id="a606" class="pw-post-body-paragraph ks kt if ku b kv kw jg kx ky kz jj la kf lb lc ld kj le lf lg kn lh li lj lk hn dt translated">我现在正忙于为<code class="eh ll lm ln lo b">web</code>项目编写新的微服务，目标是创建尽可能快的微服务。因为将使用编程语言<code class="eh ll lm ln lo b">GOlang</code>(真的相信它超级快，并且非常适合这样的任务)。在这篇文章中，我将解释为什么决定使用某个数据库。</p><p id="ad83" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">这个话题并不新鲜，您可以找到许多与这些数据库性能相关的基准测试。但是我没有找到任何关于基准的技术信息(什么，哪里，如何，多少，用了什么等等。)也没有关于数据库版本的信息(并不是我找到的每篇文章都提供这种信息),但也许有些事情已经改变了，也许一些数据库现在工作得更好了，也许我的情况与其他文章中考虑的情况有些不同，所以该轮到我对这些数据库进行基准测试了！)</p><p id="adc9" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">在我的微服务中，我需要存储两个实体(<code class="eh ll lm ln lo b">storage</code>和<code class="eh ll lm ln lo b">file</code>)和关系<code class="eh ll lm ln lo b">1 to many</code>(超级简单的情况)。<br/>在<code class="eh ll lm ln lo b">postgres</code>会有2张桌子:</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="ly lz l"/></div></figure><p id="4a58" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">并且在<code class="eh ll lm ln lo b">mongo</code>中会有嵌入数据的文档:</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="ly lz l"/></div></figure><p id="3797" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">到目前为止没什么特别的，但有趣的是<strong class="ku ig">如何接收</strong>数据。假设我们需要获得这样的信息:</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="ly lz l"/></div></figure><p id="af64" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">为了从两个数据库中接收准确的信息，我们必须在<code class="eh ll lm ln lo b">postgres</code>中运行下一个SQL查询:</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="ly lz l"/></div></figure><p id="aca3" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">而<code class="eh ll lm ln lo b">mongo</code>中的这个聚合查询:</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="ly lz l"/></div></figure><p id="99aa" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">对简单的<code class="eh ll lm ln lo b">mongo</code>查找和<code class="eh ll lm ln lo b">postgres</code>连接进行基准测试是不公平的，因为<code class="eh ll lm ln lo b">mongo</code>已经有了所有信息(作为嵌套数据),但是<code class="eh ll lm ln lo b">postgres</code>必须工作……但是我们的查询会更有趣！！！<br/>每个数据库必须执行几乎相同的操作:通过非索引字段<code class="eh ll lm ln lo b">count</code>查找数据，通过<code class="eh ll lm ln lo b">id</code>和<code class="eh ll lm ln lo b">name</code>排序，执行<code class="eh ll lm ln lo b">offset</code>和<code class="eh ll lm ln lo b">limit</code>，当mongo必须执行<code class="eh ll lm ln lo b">unwind</code>时<code class="eh ll lm ln lo b">postgres</code>必须执行join。我认为这是理所当然的！</p><h2 id="3b96" class="ju jv if bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">基准测试:</h2><p id="dfd4" class="pw-post-body-paragraph ks kt if ku b kv kw jg kx ky kz jj la kf lb lc ld kj le lf lg kn lh li lj lk hn dt translated">关于<code class="eh ll lm ln lo b">Docker</code>、<code class="eh ll lm ln lo b">PostgreSQL</code>、<code class="eh ll lm ln lo b">MongoDB</code>、<code class="eh ll lm ln lo b">GOlang</code>、数据转储、数据导入等等的所有技术信息，你都可以在<a class="ae ma" href="https://github.com/cn007b/benchmark-postgres-mongo" rel="noopener ugc nofollow" target="_blank"> github repo </a>中找到。<br/>请看一下，检查所有步骤，甚至在您的计算机上执行该基准测试，或者只是查看<a class="ae ma" href="https://github.com/cn007b/benchmark-postgres-mongo/blob/master/src/benchmark/postgres/query1.go" rel="noopener ugc nofollow" target="_blank"> postgres </a>和<a class="ae ma" href="https://github.com/cn007b/benchmark-postgres-mongo/blob/master/src/benchmark/mongo/query1.go" rel="noopener ugc nofollow" target="_blank"> mongo </a>的<code class="eh ll lm ln lo b">GOlang</code>实现。</p><h2 id="a867" class="ju jv if bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">结果:</h2><p id="a05b" class="pw-post-body-paragraph ks kt if ku b kv kw jg kx ky kz jj la kf lb lc ld kj le lf lg kn lh li lj lk hn dt translated">对我来说，在我的电脑上结果看起来像:</p><pre class="lu lv lw lx fq mb lo mc md aw me dt"><span id="a8cd" class="ju jv if lo b fv mf mg l mh mi">+-------------+-------------------+--------------------+<br/>| Benchmark # | PostgreSQL        | MongoDB            |<br/>+-------------+-------------------+--------------------+<br/>| query 1     | 8349 microseconds | 21721 microseconds |<br/>+-------------+-------------------+--------------------+</span></pre><h2 id="dd7d" class="ju jv if bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">结论:</h2><p id="8954" class="pw-post-body-paragraph ks kt if ku b kv kw jg kx ky kz jj la kf lb lc ld kj le lf lg kn lh li lj lk hn dt translated">这只是我的特殊情况，只有我的查询，只有我的计算机上的读取操作和结果…对于你的情况，你必须检查你的查询，你的数据集等。</p><p id="d6c7" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">如果您发现任何差距或错误，或者您的结果不同，请提供任何反馈。如果你有其他有趣的测试案例，请告诉我！</p><p id="9b0c" class="pw-post-body-paragraph ks kt if ku b kv lp jg kx ky lq jj la kf lr lc ld kj ls lf lg kn lt li lj lk hn dt translated">PS:我真的很喜欢mongo，我正在寻找如何加快它的速度——如果你有任何线索——请联系我！</p></div></div>    
</body>
</html>