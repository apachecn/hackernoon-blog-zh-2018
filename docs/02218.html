<html>
<head>
<title>Deployment of full-scale ELK stack to Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向Kubernetes部署全尺寸ELK堆栈</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deployment-of-full-scale-elk-stack-to-kubernetes-6f38f6c57c55?source=collection_archive---------2-----------------------#2018-03-12">https://medium.com/hackernoon/deployment-of-full-scale-elk-stack-to-kubernetes-6f38f6c57c55?source=collection_archive---------2-----------------------#2018-03-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="dab2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Elasticsearch、Logstash和Kibana，被称为<a class="ae jp" href="https://www.elastic.co/products" rel="noopener ugc nofollow" target="_blank"> ELK stack </a>或<a class="ae jp" href="https://www.elastic.co/products" rel="noopener ugc nofollow" target="_blank"> Elastic stack </a>，是日志聚合和分析的工具。由于这些devops服务是最常被请求的服务之一，我们使用<a class="ae jp" href="https://github.com/ITSvitCo/aws-k8s/tree/master/kubernetes-manifests/elasticsearch" rel="noopener ugc nofollow" target="_blank"> Github </a>上的工具自动完成了它们的部署。</p><p id="25c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">麋鹿的大概方案:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/ee75a771572119f84b2133452b78f8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpO072p2xxwL9H7LCadj_w.jpeg"/></div></div></figure><p id="02da" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些清单不包括Filebeat安装！参考<a class="ae jp" href="https://www.elastic.co/guide/en/beats/filebeat/5.5/filebeat-configuration-details.html" rel="noopener ugc nofollow" target="_blank">官方Filebeat配置文档</a>。</p><h1 id="81a5" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">配置新的ELK安装</h1><p id="41c6" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">这种安装适合AWS 部署上的<a class="ae jp" href="https://github.com/ITSvitCo/aws-k8s" rel="noopener ugc nofollow" target="_blank"> Kubernetes。默认情况下使用名称空间“elasticsearch”。Elasticsearch有两个端点:</a><a class="ae jp" href="https://github.com/ITSvitCo/aws-k8s/blob/master/kubernetes-manifests/elasticsearch/client-svc-external.yaml" rel="noopener ugc nofollow" target="_blank">外部</a>和<a class="ae jp" href="https://github.com/ITSvitCo/aws-k8s/blob/master/kubernetes-manifests/elasticsearch/client-svc.yaml" rel="noopener ugc nofollow" target="_blank">内部</a>。两个都用，或者去掉不必要的。</p><p id="c7de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.克隆https://github.com/ITSvitCo/aws-k8s库</p><p id="3e88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.创建<a class="ae jp" href="https://github.com/ITSvitCo/aws-k8s/blob/master/kubernetes-manifests/storageclass-gp2.yml" rel="noopener ugc nofollow" target="_blank"> StorageClass </a>以便允许Kubernetes供应AWS EBS卷。</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="ac5a" class="lk kd hu lg b fv ll lm l ln lo">docker run --rm -ti -v ${HOME}/.opsbox -v ${PWD}:/opsbox itsvit/opsbox kubectl apply -f kubernetes-manifests/storageclass-gp2.yml</span></pre><p id="d272" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.启动<a class="ae jp" href="https://github.com/ITSvitCo/aws-k8s/tree/master/kubernetes-manifests/elasticsearch" rel="noopener ugc nofollow" target="_blank"> HA弹性搜索集群</a>。将有2个弹性搜索大师，2个弹性搜索客户端，3个弹性搜索数据节点。</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="371c" class="lk kd hu lg b fv ll lm l ln lo">docker run --rm -ti -v ${HOME}/.opsbox -v ${PWD}:/opsbox itsvit/opsbox kubectl apply -f kubernetes-manifests/elasticsearch</span></pre><h1 id="8e75" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">自定义日志存储</h1><p id="7136" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">1.如果需要在各种索引中存储数据，应该为Logstash创建一个新的清单。例如，从现有清单中复制一份<a class="ae jp" href="https://github.com/ITSvitCo/aws-k8s/blob/master/kubernetes-manifests/elasticsearch/logstash-application.yaml" rel="noopener ugc nofollow" target="_blank">log stash-application . YAML</a></p><p id="e588" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.在输出部分设置所需的索引名称:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="319d" class="lk kd hu lg b fv ll lm l ln lo">yaml<br/> output {<br/> elasticsearch {<br/> hosts =&gt; "elasticsearch-logging.elasticsearch:9200"<br/> index =&gt; "new_index-%{+YYYY.MM.dd}"<br/> document_type =&gt; "%{[@metadata][type]}"<br/> }<br/> }</span></pre><p id="f61e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中new_index是所需的索引名称<br/> 3。运行以下命令部署新的日志存储:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="6db0" class="lk kd hu lg b fv ll lm l ln lo">docker run --rm -ti -v ${HOME}/.opsbox -v ${PWD}:/opsbox itsvit/opsbox kubectl apply -f kubernetes-manifests/elasticsearch/logstash-application.yaml</span></pre><h1 id="0f86" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">摘要</h1><p id="6cb6" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">我们成功地将该devops解决方案用作数据分析和处理系统的一部分。以下是一个运行解决方案的示例:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lp"><img src="../Images/be4d6766dec49d135fee5b27f6e2614d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wt1TYP8GtR58IU8NxBLyMQ.jpeg"/></div></div></figure><p id="479c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是定制IT Svit DevOps工具集合中的又一个简洁模块，可确保快速简单地将全周期ELK堆栈部署到Kubernetes。</p></div><div class="ab cl lq lr hc ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><p id="7254" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个故事最初发表在我公司的博客上—<a class="ae jp" href="https://itsvit.com/blog/deployment-elk-stack-kubernetes-single-command/" rel="noopener ugc nofollow" target="_blank">https://it svit . com/blog/deployment-elk-stack-kubernetes-single-command/</a></p></div></div>    
</body>
</html>