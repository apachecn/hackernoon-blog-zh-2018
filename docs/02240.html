<html>
<head>
<title>Microservices for Startups: An Interview with Stephen Blum of PubNub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创业公司的微服务:PubNub的斯蒂芬·布鲁姆访谈</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/microservices-for-startups-an-interview-with-stephen-blum-of-pubnub-8f57459d8e92?source=collection_archive---------24-----------------------#2018-03-12">https://medium.com/hackernoon/microservices-for-startups-an-interview-with-stephen-blum-of-pubnub-8f57459d8e92?source=collection_archive---------24-----------------------#2018-03-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1974" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">这次采访是为我们的</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">创业微服务</em> </a> <em class="jp">电子书做的。一定要去看看关于微服务的实用建议。感谢Stephen的时间和投入！</em></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff jr"><img src="../Images/96ada3c9db108e9a9c642a6de1803328.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/0*nXjPxa8__LOGlRQa."/></div></figure><p id="e141" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" href="https://twitter.com/stephenlb?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" rel="noopener ugc nofollow" target="_blank"> <em class="jp">斯蒂芬·布鲁姆</em> </a> <em class="jp">是</em><a class="ae jq" href="https://www.pubnub.com/" rel="noopener ugc nofollow" target="_blank"><em class="jp">pub nub</em></a><em class="jp">的创始人兼CTO。PubNub是一个安全的全球数据流网络(DSN)和易于使用的API，使其客户能够连接、扩展和管理实时应用和物联网设备。</em></p><p id="d1f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于上下文，您的工程团队有多大？</p><p id="b963" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们在PubNub有80名员工。他们大多数是软件工程师。我们有市场部、人力资源部、财务部和销售部。首先，我们为超过3.5亿台移动设备提供连接，这比美国的人口还多，每月有超过2万亿笔交易通过我们的网络进行。</p><p id="f284" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">您是否正在使用微服务，能否概述一下您是如何使用它们的？</strong></p><p id="5152" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">PubNub刚开始的时候，微服务还不存在。这不是一件事。这要追溯到2012年。那是什么？六年前。</p><p id="2780" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">微服务对我们PubNub有着巨大的潜在影响。我们可以扔掉很多代码，这很棒，比如服务发现代码。我们将能够扔掉编码，自动重试，新的IP，新的盒子来了，你的名字。所有这些都写在我们的C代码里了。当我们迁移到微服务时，这是我们将要利用的一些东西——许多自动化操作。我们的网络有一个事件驱动的架构框架，叫做PubNub Functions。PubNub Functions允许您编写几行JavaScript，部署到所有数据中心。你通过PubNub发送的每条消息都会运行几行JavaScript。这允许您操作邮件或完全阻止邮件。您还可以更改频道，以便将消息发送到不同的频道。</p><p id="9a3d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，请进入微服务和我们的部署架构。在我们的规模下，我们需要能够——我们目前每分钟路由2200万个事务——如果你把它放在一个小小的NodeJS服务器上，它会立即自我毁灭并爆炸。为了大规模处理这种负载，我们需要一种方法让流程自动伸缩。如果我们只是在袖手旁观准备了一大堆正在运行的进程来处理这种流量，我们将只是为内存的闲置容量付费。会有太多的记忆。EC2的成本每年高达60亿美元。不可能。这就是微服务真正帮助你的地方。自动让它向上旋转或向下旋转。</p><p id="4dcd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">你是从单体开始，后来采用微服务的吗？</strong></p><p id="3ca0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通常，您从一个大规模的代码库开始，然后跨服务器部署该架构。对于任何规模的多租户基础设施，您都必须使用并行分布式计算实践来做到这一点。然后你的代码库不断增长，你开始需要越来越多的团队，因为你不可能只成功地拥有一个20人的大团队。这种方法在历史上是不成功的，并且效果不好。东西碰撞。对于五人左右的sprint团队，你需要有行业标准的方法。当你有太多的人都在同一个代码库中工作时，你会看到部署中的挑战，人们不得不互相监督。因此，我们真的需要将基础设施拆分成独立的组件。我们很早就在PubNub做到了。我们的边界可以通过REST API获得。所以PubNub内的每个API都是非常RESTful的。你可以在PubNub的网络中与不同的组件进行交互。网络本身通过这些REST端点进行交互。我们以这种方式建造它是很棒的。这种方法使得我们的服务直接迁移到Kubernetes变得非常容易。</p><p id="32d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，当我们开始编写PubNub Functions基础设施时，这是几行JavaScript，可以修改网络中的消息，我们立即从微服务开始。我们只知道这必须以这种方式发生，以允许我们的自动扩展管理支持我们的规模和支持我们的客户负载量。</p><p id="7f73" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">如果是，采用微服务的动机是什么？你是如何评估权衡的？</strong></p><p id="bef4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还没有完全采用Kubernetes。我想说，我们目前只有30%的基础设施在库伯内特斯，我们正在朝着…这是我们看到的另一个好处:节约成本。我们很多计算机都是非同质的。我们的大多数服务都是网络密集型的，或者有些是CPU密集型的。如果您能把所有这些东西都塞进一个盒子里，让负载平衡好一点，您每年可能会节省数百万美元，这不是很好吗？你为什么不这么做？对我们来说，这是另一个动力，那就是节约和机会。</p><p id="a883" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为一个团队/工程组织，你是如何处理微服务这个话题的？是否围绕微服务的定义进行了讨论？</p><p id="ccbc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们从一个小团队开始，这个团队是PubNub的建筑师。我们讨论了利弊。然后我们把它带到一个更大的团队，然后开放到地板上。我们真的想强调为什么我们不想去库伯内特这样的地方？所有人。即使当你在开发并且喜欢新技术的时候，你也会有一点厌恶。你会说，“呃，也许吧，呃。”所以你试图找到迁移中的问题。非常基本的东西，所有的物流真的。我们怎么让一个在这里跑，另一个在这里跑？我们如何进行迁移？我们如何确保零停机时间，因为PubNub实际上会让电话响，如果电话不响，我们的客户就会损失收入。我们该如何应对？真的，在一天结束的时候，所有的反对意见，都是可以实现的。我们可以超越所有这些问题。是的，确保零停机时间需要一点时间。但是在这一点上，我们绝对是在向Kubernetes迈进。</p><p id="1d0d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">在采用微服务后，你是否改变了团队的组织或运营方式？</strong></p><p id="ac96" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一个团队负责一个特定的服务或一组特定的服务。</p><p id="24d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">在技术选择上有多少自由？你们是否都同意坚持使用一个堆栈，或者是否有尝试新堆栈的灵活性？你是如何做出那个决定的？</strong></p><p id="848d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们对此完全开放。我们希望继续推进可用的新开源技术，我们对团队只有几个非常公平的限制:必须在容器环境中运行，并且必须具有成本效益。</p><p id="ba24" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想确保PubNub的每个人都有机会使用他们热衷的技术，他们听说过很多，他们相信基于社区，“嘿，这甚至可以大规模使用。”</p><p id="a9f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">你有没有将一个整体的应用程序分解成更小的微服务？如果是的话，你能给我们介绍一下这个过程吗？</strong></p><p id="4122" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">幸运的是我们不需要。这有点像你在想也许不同的端点有不同的代码库类型的情况。我们已经从本质上开始了。我们在sprint团队之间分发了所有的代码和逻辑，他们能够在团队内部管理它们。</p><p id="5ccd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">您如何确定服务边界？</strong></p><p id="1a21" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是两个选项之间的选择。你有两个选择。其中一个选择是休息，就像我们说过的。因为它真的很简单，是事务性的，当发生其他事情时，它就会发生，在这种情况下，您只需要从某个位置提取一些数据，一些小的信息片段，如密钥配置和保险存储，这些类型的事情都是RESTful的，事务性的。第二种是基于事件驱动架构流的系统，其中数据是不断编织的。不需要启动请求响应会话。您可以异步传输数据获取请求和事件，从而允许系统以容错方式协同工作和通信。故障转移和重试内置于架构中，而不是为每个REST调用编写失败时重试的逻辑。</p><p id="4e66" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对您的开发、运营和部署流程有何影响？出现了哪些挑战，你是如何解决的？</strong></p><p id="f866" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">部署应在一周内不断增加；除了周四周五周六周日。避开那些日子。如果我们决定部署这些天，我们将留在周末，以确保它的工作。所以没有人想在那些日子里部署。但这一切都是为了方便，我们希望确保我们的开发人员对他们能够部署的速度感到满意。</p><p id="f440" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">[我们的部署流程]是自动构建的。所以CI/CD。所有这些都是集成的。一旦你部署了，比如说主分支，这取决于团队和它是如何设置的。但是我们都遵循一个标准流程。它必须通过所有的单元测试，集成测试，当然它必须构建。我们利用特拉维斯。我们还想除掉一些詹金斯。其他人也在努力摆脱这种状态。它必须通过所有的测试，运行，产品经理必须在staging中验证它，然后所有的绿灯都准备好了。我们在日历上放了一个变更管理。每个人都可以看到部署日历。然后我们在那个时候点击按钮，我们确保每个人都在甲板上，如果有任何问题发生。</p><p id="d539" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，我们的一些组件使用蓝/绿代码部署模型运行。如果系统本身检测到问题，这允许最近部署的新代码自动恢复到工作状态。Kubernetes在这方面很棒。</p><p id="9dd7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对你的测试方式有什么影响？在这方面有什么经验教训或建议？你能举些例子吗？</strong></p><p id="8389" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那个部署是怎么说的？这是不可改变的基础设施。我们希望保持这种方式。这种方法允许我们用一些已经改变的新逻辑部署一个全新的集群，然后运行一个测试。这是我们以前很难做到的事情。通常我们所做的是在EC2中部署到一个正在运行的集群，在某个地方的另一个帐户中，这不涉及生产。我们将部署更新的组件，并进行冒烟测试。通过这种方法，我们改变了基础设施。过了一段时间，一个集群会发生很大的变化，内容会不断变化，以至于在数据中心维护一个副本成了一场噩梦。因此，最好使用微服务方法，即在现场构建全新的基础架构，每个组件都使用配置脚本进行配置。所以没有拐杖。什么都没剩下。您有机会从干净的代码、干净的配置中测试您的升级。现在，我们可以在生产中轻松实现这一点。这是我们测试方法的最大变化。在运营和测试方法中部署基础设施的不变方法。</p><p id="0348" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对安全性和控制数据访问有何影响？</strong></p><p id="3c13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们已经在使用IPtables了。。我们已经在使用其他方法来连接和验证服务密钥。它内置于API中。我们仍然对管理命令进行加密签名和数据所有权检查。我不知道。在我看来，我们使用Kubernetes并没有改变什么。</p><p id="5ba4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">再次感谢Stephen的时间和投入！这次采访是为我们的</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">创业微服务</em> </a> <em class="jp">电子书做的。一定要去看看关于微服务的实用建议。</em></p></div><div class="ab cl jz ka hc kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hn ho hp hq hr"><p id="6df1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文原载于</em><a class="ae jq" href="https://buttercms.com/blog/microservices-for-startups-an-interview-with-stephen-blum-of-pubnub" rel="noopener ugc nofollow" target="_blank"><em class="jp">【buttercms.com】</em></a><em class="jp">摘自《创业公司的微服务</em>   <em class="jp">》一书。注册即可在新章节发布时通过电子邮件发送给您。</em></p><p id="eefa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">如果你喜欢这篇文章，请在下面的</em> <strong class="it hv"> <em class="jp"> </em> </strong> <em class="jp">帮助它传播！更多类似这样的内容，在Twitter上关注</em><a class="ae jq" href="https://twitter.com/ButterCMS" rel="noopener ugc nofollow" target="_blank"><em class="jp">ButterCMS</em></a><em class="jp">并订阅我们的</em> <a class="ae jq" href="https://buttercms.com/blog/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">博客</em> </a> <em class="jp">。</em></p><p id="e1f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想在你的网站上添加一个博客或者CMS，而又不想乱用WordPress， <a class="ae jq" href="https://buttercms.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> <em class="jp">你应该试试ButterCMS </em> </strong> </a> <em class="jp">。</em></p></div></div>    
</body>
</html>