<html>
<head>
<title>Put your chatbot where your headless CMS is</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">把你的聊天机器人放在你的无头CMS所在的地方</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/put-your-chatbot-where-your-headless-cms-is-15cf174774c6?source=collection_archive---------19-----------------------#2018-03-13">https://medium.com/hackernoon/put-your-chatbot-where-your-headless-cms-is-15cf174774c6?source=collection_archive---------19-----------------------#2018-03-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="f6b7" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">如何用Sanity、Webtask和Dialogflow在Slack中制作聊天机器人</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/7078fcf56fbd2e9422a8a469d342c1b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qO0PKZ3fNVUXv535pvssRA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Make intents for chatbots and conversational UIs a part of your content management system</figcaption></figure><p id="216f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">抬起头来！你需要掌握一些JavaScript知识来完成本教程，但是我们如何考虑将聊天机器人集成到CMS中仍然很有趣。</p><p id="9930" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">一个<a class="ae kw" href="https://en.wikipedia.org/wiki/Headless_CMS" rel="noopener ugc nofollow" target="_blank">无头内容管理系统</a>的想法是将你的内容从网页的约束中分离出来，以便在许多上下文中重用它。即使当你只想在网页上显示你的内容时，这也是有意义的，因为你可以以一种内容可以在许多页面上重用的方式来组织它，并且当更有趣的东西出现时，更容易切换你的前端代码。然而，当您设法在不同的界面中重用您的内容时，headless的真正威力就显现出来了。</p><p id="b262" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">聊天机器人已经成为科技热潮的一部分有一段时间了，随着工具和人工智能模型变得越来越完善，需求似乎也在增加。谷歌的<a class="ae kw" href="https://dialogflow.com" rel="noopener ugc nofollow" target="_blank"> Dialogflow </a>刚刚推出了对我的母语挪威语的支持，这被证明是我做一些实验的好借口。我一直在思考如何用我们在Netlife使用的无头CMS来实现聊天机器人响应，这是明智的。我想我找到了一种易于实现和维护的模式。</p><h2 id="7798" class="kx ky hu bd kz la lb lc ld le lf lg lh ki li lj lk km ll lm ln kq lo lp lq lr dt translated">总之，您需要:</h2><ol class=""><li id="19d5" class="ls lt hu kb b kc lu kf lv ki lw km lx kq ly ku lz ma mb mc dt translated">在<a class="ae kw" href="https://console.dialogflow.com" rel="noopener ugc nofollow" target="_blank">对话流</a>中设置代理</li><li id="553d" class="ls lt hu kb b kc md kf me ki mf km mg kq mh ku lz ma mb mc dt translated">在Slack 中制作一个<a class="ae kw" href="https://api.slack.com/apps" rel="noopener ugc nofollow" target="_blank">自定义app，</a><a class="ae kw" href="https://dialogflow.com/docs/integrations/slack" rel="noopener ugc nofollow" target="_blank">将其连接到Dialogflow </a></li><li id="9d42" class="ls lt hu kb b kc md kf me ki mf km mg kq mh ku lz ma mb mc dt translated">在Sanity中添加一些意图和实现模式</li><li id="073a" class="ls lt hu kb b kc md kf me ki mf km mg kq mh ku lz ma mb mc dt translated">用无服务器服务连接Sanity和Dialogflow，在本例中是<a class="ae kw" href="https://webtask.io/make" rel="noopener ugc nofollow" target="_blank"> webtask.io </a></li></ol><h1 id="3ec8" class="mi ky hu bd kz mj mk ml ld mm mn mo lh ja mp jb lk jd mq je ln jg mr jh lq ms dt translated">在对话流中制造代理和意图</h1><p id="973f" class="pw-post-body-paragraph jz ka hu kb b kc lu iv ke kf lv iy kh ki mt kk kl km mu ko kp kq mv ks kt ku hn dt translated">一旦登录到Dialogflow，选择<strong class="kb hv">创建新代理</strong>并给它一个名称，选择适当的设置(我选择了V2 API)。在我的案例中，我想做一个<a class="ae kw" href="https://hackernoon.com/tagged/chatbot" rel="noopener ugc nofollow" target="_blank">聊天机器人</a>，可以将我们公司的内部网与Slack连接起来。我以我们的参谋长命名(当然，这个角色永远不可能完全自动化)。</p><p id="d768" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">一旦你创建了一个新代理，进入<strong class="kb hv">意向</strong>并选择<strong class="kb hv">创建意向</strong>按钮。你可以把“意图”理解为“用户想要做或者已经回答的某件事情”。我的意图是得到一个关于我们如何在网上生活图书旅行的答案。给意图一个描述性的名称；我们将明智地使用这个名称来映射正确的内容。填写不同的培训短语，这些短语是您的用户会写或说的示例。)以便请求所述信息。在这种情况下，它是“我如何预订旅行”等等的变体。希望在谷歌的机器学习算法能够将用户导向这一意图之前，你不需要输入许多选项。你可以在右边栏测试它的效果。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mw"><img src="../Images/8b0e2eb600895bb044bd95e09f52df18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oG6aUOiuu10V8vxcbxf8cQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Set up an intent in Dialogflow, test it in the right hand sidebar. Here I have set up alternatives in Norwegian for the question “how do I book travel”</figcaption></figure><p id="af59" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">你可以在Dialogflow的<strong class="kb hv">回复</strong>部分写出不同的可能答案，但这有什么意思呢？相反，打开<strong class="kb hv">启用webhook调用用于此目的</strong>。这将使Dialogflow向您放在<strong class="kb hv">fulfillment</strong>部分中的任何URL发出请求。当我们在webtaks.io中设置我们的微服务时，我们将回到这一点。</p><h1 id="6955" class="mi ky hu bd kz mj mk ml ld mm mn mo lh ja mp jb lk jd mq je ln jg mr jh lq ms dt translated">二。在Slack中制作一个自定义应用程序，并将其连接到Dialogflow</h1><p id="af3f" class="pw-post-body-paragraph jz ka hu kb b kc lu iv ke kf lv iy kh ki mt kk kl km mu ko kp kq mv ks kt ku hn dt translated">如果你去Dialogflow左边栏的<strong class="kb hv">集成</strong>，你会发现它可以与许多不同的服务集成。设置将与他们中的大多数非常相似，但我们希望松弛。严格遵循松弛盒中<strong class="kb hv">设置</strong>中的说明。我说的“密切”是指你应该花时间阅读说明书并试着理解它们。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mx"><img src="../Images/f5a96bc27e621fba49a58347a958269f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6CzB0c_-Uw8vXt8qBypEAw.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Make sure that you give the Slack bot the necessary event subscriptions.</figcaption></figure><p id="2ecf" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">您的Slack-bot将需要一些身份验证和事件订阅，以便能够在Slack中读取您的查询。你可以让它听所有的对话，但我更喜欢它只回答直接或间接的信息。部分原因是我不希望机器人在谈话中意外触发，部分原因是我不希望在没有非常好的理由的情况下，在我们谈话的每一行都输入Dialogflow。</p><h1 id="d7ae" class="mi ky hu bd kz mj mk ml ld mm mn mo lh ja mp jb lk jd mq je ln jg mr jh lq ms dt translated">三。在理智中为意图和实现添加一些模式</h1><p id="5f90" class="pw-post-body-paragraph jz ka hu kb b kc lu iv ke kf lv iy kh ki mt kk kl km mu ko kp kq mv ks kt ku hn dt translated">如果你对理智还不熟悉，<a class="ae kw" href="https://sanity.io" rel="noopener ugc nofollow" target="_blank">去尝试一下</a>，十五分钟后回来。Sanity <a class="ae kw" href="https://www.sanity.io/docs/content-studio/the-schema" rel="noopener ugc nofollow" target="_blank">中的内容模式(即文档类型和输入字段)被写成带有一些简单转换的JavaScript对象</a>。我们将通过为<strong class="kb hv">意向</strong>创建一个类型并在我们的intranet-post-type中为<strong class="kb hv">完成</strong>添加一个内容字段来进行一个非常简单的设置。</p><p id="616f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">在我们为内部网撰写文章的post类型中，我添加了一个名为<strong class="kb hv">fulfillments</strong>的数组字段，它由一个简单的<strong class="kb hv">字符串</strong>字段组成。为了支持不同客户的消息，我们可以使它更复杂；例如，我们可以有一个用于<a class="ae kw" href="https://developers.google.com/actions/reference/ssml" rel="noopener ugc nofollow" target="_blank">语音接口</a>，一个用于<a class="ae kw" href="https://api.slack.com/docs/messages/builder" rel="noopener ugc nofollow" target="_blank">带附件的松弛响应</a>，一个用于<a class="ae kw" href="https://developers.facebook.com/docs/messenger-platform/send-messages/templates" rel="noopener ugc nofollow" target="_blank">脸书信使模板</a>。这一次，我们将保持简单，只用一些简单的文本响应就可以了。</p><p id="5a43" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">intent schema由一个易于在Sanity中找到的标题、一个我们将用来将其映射到Dialogflow中的<strong class="kb hv"> intentName </strong>和一个包含该intent实现的帖子的引用字段组成。让intents成为自己的类型是有意义的，因为实现可以存在于不同的类型中。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff my"><img src="../Images/a281aa5ebc5dac6a6923c8859eb4c4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16pc7IUHL4yM27aoeFFQVw.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Don’t let the Norwegian throw you off.</figcaption></figure><h1 id="cc1c" class="mi ky hu bd kz mj mk ml ld mm mn mo lh ja mp jb lk jd mq je ln jg mr jh lq ms dt translated">四。用webtask.io把这一切绑在一起</h1><p id="6c0e" class="pw-post-body-paragraph jz ka hu kb b kc lu iv ke kf lv iy kh ki mt kk kl km mu ko kp kq mv ks kt ku hn dt translated">既然我们已经用一个意图和实现建立了理智，我们准备把它连接到Dialogflow。这是无服务器功能派上用场的一个例子。我选择了<a class="ae kw" href="https://webtask.io" rel="noopener ugc nofollow" target="_blank"> webtask.io </a>，因为我以前用过它，它有一个在线编辑器，但是你可以很容易地用<a class="ae kw" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>、<a class="ae kw" href="https://stdlib.com/" rel="noopener ugc nofollow" target="_blank"> stdlib </a>、<a class="ae kw" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Functions </a>或者任何你喜欢的服务器(更少)技术复制它。在任何情况下，函数的核心将非常类似于这个要点。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="mz na l"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">The Sanity query can be read as the following: “Get all entries with the type intent that has the same string in the intent name field as the incoming intent from Dialogflow. Take the first (and in most cases only) of these entries and put it in an object; under the key “fullfullments”, list out all the referenced documents, follow the references to their entries and return a list of the strings in the fullfillment field.</figcaption></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nb"><img src="../Images/4fc9d40cada70a13325e2120f05daddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jRrpOoUI5H_cudrso-hngg.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Example of the query in work using the <a class="ae kw" href="https://www.npmjs.com/package/@sanity/vision" rel="noopener ugc nofollow" target="_blank">Vision plugin for Sanity.</a></figcaption></figure><p id="8bdb" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">这是概念代码的证明，可以受益于更多的错误处理等等。Webtask也不太喜欢ES6语法。你应该注意第13行，以及我们如何在理智中找到正确的意图。这就是为什么将Dialogflow中的intent名称与Sanity中的intent名称(即intent name)对齐很重要。在这种情况下，我也选择了随机输出完整的字符串，只是为了使一些变化成为可能。</p></div><div class="ab cl nc nd hc ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="hn ho hp hq hr"><p id="d5d2" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">如果你设法把所有这些拼凑在一起，你现在应该有一个Slack中的工作聊天机器人，它通过Dialogflow中的机器学习来解析自然语言的意图，通过与API对话的无服务器函数从你的无头CMS中找到完整的文本。现在你只需要在这个组合中的某个地方添加区块链，就可以去掉所有的时髦词汇框。接下来，我们还可以通过API等将Dialogflow中的意图直接连接到Sanity。有许多方法可以推进这一点。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff nj"><img src="../Images/40e11d8d94267d65a638b86e392d45cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/1*swOMxqXC0fbL9_sCcJ_8mw.gif"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek"><em class="nk">Figure: The Slack chatbot at work. I’m trying variations on “how do I order travel”. We can see some encoding issues, and that we need some more training. But it is amazing technology for mundane uses.</em></figcaption></figure><p id="73c1" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">这当然是设计项目的技术方面。现在真正的工作开始了，研究你的同事实际上可能想问机器人什么，并设计出有用的答案，这些答案包含在你的同事实际上想与之交流的个性中。首先，我会推荐由<a class="ae kw" href="https://twitter.com/mulegirl" rel="noopener ugc nofollow" target="_blank"> Erika Hall </a>设计的<a class="ae kw" href="https://abookapart.com/products/conversational-design" rel="noopener ugc nofollow" target="_blank"><em class="kv"/></a>对话设计。</p><p id="bde3" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">如果你尝试这样做，或者对我的设置有什么意见，我很乐意在评论区听到你的见解和问题！</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nl na l"/></div></figure></div></div>    
</body>
</html>