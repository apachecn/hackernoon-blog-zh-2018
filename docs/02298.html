<html>
<head>
<title>java.lang.Object.finalize() is finally deprecated</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">java.lang.Object.finalize()最终被弃用</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/java-lang-object-finalize-is-finally-deprecated-f99df40fa71?source=collection_archive---------6-----------------------#2018-03-14">https://medium.com/hackernoon/java-lang-object-finalize-is-finally-deprecated-f99df40fa71?source=collection_archive---------6-----------------------#2018-03-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/ef69917c7fdb64d1487de5c033c490ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/1*Sh0lqT9nxqvko1VllzyvJw.gif"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek"><a class="ae jc" href="https://giphy.com/gifs/monday-the-it-crowd-workplace-c6DIpCp1922KQ" rel="noopener ugc nofollow" target="_blank">GIPHY</a></figcaption></figure><p id="3bd7" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt kb translated">就这样，finalize()受够了自己的不可靠，走出了Object的会议室，再也没有出现过，或者说我们愿意相信。</p><p id="fa17" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">尽管很多人可能没有意识到，随着JDK 9的发布，finalize()的<strong class="jf hv">被弃用了</strong>。不信，查一下<a class="ae jc" href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#finalize--" rel="noopener ugc nofollow" target="_blank"> Java 9的文档</a>！读者应意识到<strong class="jf hv">弃用并不一定意味着移除或未来移除</strong>。这是一个指示，用于指出应该(如果可能的话)避免注释元素，并且在Java平台的未来版本中可能会移除注释元素。</p><p id="c9b4" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">目前，还不确定finalize()是否会被标记为移除。我个人不相信会被去掉，但也不确定。我所能做的就是，JDK 11的早期版本没有移除它，因为它是Java生态系统中每个类都继承的方法，我的直觉告诉我，它会一直存在下去。</p><p id="1fa4" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">然而，如果元数据是API编写者意图的任何指示，至少在编写时，它似乎不会被删除——至少在不久的将来不会。我们可以通过运行和分析以下代码的结果来得出这个结论:</p><pre class="kk kl km kn fq ko kp kq kr aw ks dt"><span id="a019" class="kt ku hu kp b fv kv kw l kx ky">/* Note that this uses language features only available in Java 10 and 11, namely, local variable type inference. The use of this feature within Lambda Expression arguments came about in Java 11 and is used in this article. Java 10 is set to be released 6 days following the publishing of this article. You may learn more about local variable type reference @ <a class="ae jc" href="http://bit.ly/VarJava" rel="noopener ugc nofollow" target="_blank">bit.ly/VarJava</a> */</span><span id="7ef7" class="kt ku hu kp b fv kz kw l kx ky">import java.lang.annotation.Annotation;</span><span id="9c69" class="kt ku hu kp b fv kz kw l kx ky">...</span><span id="1d50" class="kt ku hu kp b fv kz kw l kx ky">var annos = Object.class.getDeclaredMethod("finalize", (Class&lt;?&gt;[]) null ) .getAnnotations();</span><span id="9fd0" class="kt ku hu kp b fv kz kw l kx ky">for (var anno : annos) System.out.println(anno + "\n");</span><span id="8157" class="kt ku hu kp b fv kz kw l kx ky">Output: @java.lang.Deprecated(<strong class="kp hv">forRemoval</strong>=false, since="9")</span></pre><p id="c1f6" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我们运行这段代码的原因很明显，那就是以编程方式显示<strong class="jf hv">Java . lang . object . finalize()</strong>还没有被标记为删除。</p><blockquote class="la"><p id="2bf3" class="lb lc hu bd ld le lf lg lh li lj ka ek translated">对finalize()的反对在某种程度上可以被认为是一种仪式上的锦上添花。</p></blockquote><p id="68cd" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">追溯到2001年，在他的重磅经典<em class="lp">“Effective Java”</em>(这应该是认真的Java开发人员的必读书)的第一版中，Joshua Bloch警告了依赖finalize()的<a class="ae jc" href="https://www.amazon.com/Effective-Java-3rd-Joshua-Bloch/dp/0134685997/ref=mt_paperback?" rel="noopener ugc nofollow" target="_blank">危险。</a></p><p id="6194" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">Sun(以及后来的Oracle)一直在告诫Java开发人员使用终结化，以及为什么它几乎(如果不是完全)总是一个坏主意。开发finalize()的主要动机是能够处理代码中“不可及的对象”,比如本机资源。</p><p id="7505" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">在过去，人们可能会尝试使用finalize()，如下所示。</p><p id="4d58" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><strong class="jf hv">关于我的环境的一些说明:</strong>我将在Linux Mint MATE上使用JDK 11的早期版本。</p><h1 id="87e3" class="lq ku hu bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm dt translated">finalize()能可靠地关闭您的流吗？</h1><blockquote class="mn mo mp"><p id="ef69" class="jd je lp jf b jg jh ji jj jk jl jm jn mq jp jq jr mr jt ju jv ms jx jy jz ka hn dt translated">让我们写一个用MVC架构模式建模的电话簿。</p></blockquote><h2 id="8dff" class="kt ku hu bd lr mt mu mv lv mw mx my lz jo mz na md js nb nc mh jw nd ne ml nf dt translated"><em class="ng">首先，</em>这位<strong class="ak">模特</strong>，一个叫Contact的POJO豆。</h2><figure class="kk kl km kn fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="fe ff nh"><img src="../Images/269921cb445f4cd9654a3feb3f87fe68.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*psB2a9k0NbycRoX674cERw.png"/></div></div></figure><h2 id="dc4c" class="kt ku hu bd lr mt mu mv lv mw mx my lz jo mz na md js nb nc mh jw nd ne ml nf dt translated">第二，控制器，一个叫电话本的类。</h2><figure class="kk kl km kn fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="fe ff nm"><img src="../Images/edf5dfde56dce2e801eca96528609304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Yl9jQokXZTC8Sin6eKhDw.png"/></div></div></figure><figure class="kk kl km kn fq iv fe ff paragraph-image"><div class="fe ff nn"><img src="../Images/2edd5a3a695380fdeb8ce0d74c45fd53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*ALmz3_Gk5ceNYhtd1W9FwA.png"/></div></figure><h2 id="db86" class="kt ku hu bd lr mt mu mv lv mw mx my lz jo mz na md js nb nc mh jw nd ne ml nf dt translated">第三，视图，我们的主类，叫做Finalize。</h2><figure class="kk kl km kn fq iv fe ff paragraph-image"><div class="fe ff no"><img src="../Images/8a6f2bc4da85500f45a4c99d6ba1cc99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*X-CNB7kI5jl81f4pTKVpwg.png"/></div></figure><h2 id="e65f" class="kt ku hu bd lr mt mu mv lv mw mx my lz jo mz na md js nb nc mh jw nd ne ml nf dt translated">运行时，这是输出。</h2><figure class="kk kl km kn fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="fe ff np"><img src="../Images/157e4ed70312b89134a13da2896de4c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4nj-LMKzhssMJd4Ia-LnMw.png"/></div></div></figure><h2 id="c2ae" class="kt ku hu bd lr mt mu mv lv mw mx my lz jo mz na md js nb nc mh jw nd ne ml nf dt translated"><strong class="ak">分析。</strong></h2><p id="12e3" class="pw-post-body-paragraph jd je hu jf b jg nq ji jj jk nr jm jn jo ns jq jr js nt ju jv jw nu jy jz ka hn dt translated">花点时间查看一下代码。这里要把握的要点是，我们依赖finalize()来做一些清理工作:关闭java.io.PrintWriter流。现在请注意Finalize类的第16行和第17行。请注意，我们都将TelephoneBook的一个实例设置为null，并温和地向垃圾收集器建议现在可能是运行的好时机。回想一下，System.gc()不是垃圾收集器的直接触发器，finalize()也不是析构函数。<strong class="jf hv">都不需要运行</strong>。所有这一切的核心是，垃圾收集器将在它高兴的时候运行，而我们无法(出于我们的实际目的)控制它何时运行。</p><p id="5664" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">您是否注意到在我们的示例中，垃圾收集器运行了，finalize()被调用了？试试这个实验。删除finalize类的第16行或第17行，查看是否调用了Finalize()方法。我愿意是它没有，虽然我不能确定。对我来说，它一再没有。记住，我们不能(至少在大多数实际情况下)确定性地控制垃圾收集器何时运行。</p><blockquote class="la"><p id="b1ed" class="lb lc hu bd ld le lf lg lh li lj ka ek translated">因此，如果我们依赖finalize()来关闭我们的OutputStream，我们就是在进行草率的编程。</p></blockquote><p id="624a" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">你明白为什么finalize()不是个好主意了吗？这只是许多例子中的一个，但是消息是清楚的:<strong class="jf hv">因为我们不能保证finalize()将被调用或者确定GC何时运行，我们不能可靠地使用finalize()来完成关闭任务，比如关闭I/O流</strong>。如果我们不得不关闭一个SSLSocket呢？或者和JDBC有联系？还是JNI资源？我将留给读者的想象力(或噩梦)去思考可能导致的混乱。</p><h1 id="ced0" class="lq ku hu bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm dt translated">结束语</h1><p id="719b" class="pw-post-body-paragraph jd je hu jf b jg nq ji jj jk nr jm jn jo ns jq jr js nt ju jv jw nu jy jz ka hn dt translated">Java 9是一个期待已久的老生常谈:你不能依赖finalize()来清理。行为规范，并通过其他方式明确清理您的资源。正如所暗示的，finalize()还有其他问题，即:<strong class="jf hv">性能、死锁和挂起</strong> [1]。</p><p id="3c72" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">要更深入地理解System.gc()为什么是不好的实践，请访问:</p><div class="nv nw fm fo nx ny"><a href="https://stackoverflow.com/questions/2414105/why-is-it-bad-practice-to-call-system-gc" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab ej"><div class="oa ab ob cl cj oc"><h2 class="bd hv fv z el od eo ep oe er et ht dt translated">为什么调用System.gc()是不好的做法？</h2><div class="of l"><h3 class="bd b fv z el od eo ep oe er et ek translated">这是一个非常麻烦的问题，我觉得这是许多人反对Java的原因，尽管Java是一种非常有用的语言</h3></div><div class="og l"><p class="bd b gc z el od eo ep oe er et ek translated">stackoverflow.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om iw ny"/></div></div></a></div><blockquote class="la"><p id="1bb3" class="lb lc hu bd ld le on oo op oq or ka ek translated"><strong class="ak">像我们一样鄙视finalize()吗？还是你觉得这还是个好主意？请在下面的评论中告诉我:)</strong></p></blockquote><h1 id="72ca" class="lq ku hu bd lr ls lt lu lv lw lx ly lz ma os mc md me ot mg mh mi ou mk ml mm dt translated">想要出处？抓住这里。</h1><p id="93ef" class="pw-post-body-paragraph jd je hu jf b jg nq ji jj jk nr jm jn jo ns jq jr js nt ju jv jw nu jy jz ka hn dt translated">你需要JDK 11号，你可以在这里找到它。</p><div class="nv nw fm fo nx ny"><a href="https://github.com/afinlay5/finalize-" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab ej"><div class="oa ab ob cl cj oc"><h2 class="bd hv fv z el od eo ep oe er et ht dt translated">最终确定5/最终确定-</h2><div class="of l"><h3 class="bd b fv z el od eo ep oe er et ek translated">个人博客上的Java . lang . object . finalize()Java 11示例的Gradle源代码库…</h3></div><div class="og l"><p class="bd b gc z el od eo ep oe er et ek translated">github.com</p></div></div><div class="oh l"><div class="ov l oj ok ol oh om iw ny"/></div></div></a></div><h1 id="a2e9" class="lq ku hu bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm dt translated">再见，敲定()。不会有人想念你的。</h1><figure class="kk kl km kn fq iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/aebd8101f41b0e2f5eb19e175d9fbf9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/1*gvCHYqpdxYDuY7OSX_VzDw.gif"/></div></figure><h1 id="acbb" class="lq ku hu bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm dt translated">对Java感兴趣？加入我在脸书的Java小组:</h1><div class="nv nw fm fo nx ny"><a rel="noopener follow" target="_blank" href="/@afinlay/join-my-java-facebook-group-a32cee52a0d9"><div class="nz ab ej"><div class="oa ab ob cl cj oc"><h2 class="bd hv fv z el od eo ep oe er et ht dt translated">加入我的爪哇脸书群</h2><div class="of l"><h3 class="bd b fv z el od eo ep oe er et ek translated">对Java感兴趣？看看我的脸书小组:Java软件开发小组！</h3></div><div class="og l"><p class="bd b gc z el od eo ep oe er et ek translated">medium.com</p></div></div><div class="oh l"><div class="ow l oj ok ol oh om iw ny"/></div></div></a></div><h1 id="60db" class="lq ku hu bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm dt translated">喜欢我的内容？订阅我的邮件列表:</h1><figure class="kk kl km kn fq iv"><div class="bz el l di"><div class="ox oy l"/></div></figure><h1 id="735e" class="lq ku hu bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm dt translated">别忘了给它一个…；)</h1><figure class="kk kl km kn fq iv fe ff paragraph-image"><div class="fe ff oz"><img src="../Images/aa6894246d00ab36b926774e943189a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*gxYKNsGIyUqXmaBzQipvRA.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek"><a class="ae jc" href="http://www.iemoji.com/view/emoji/1315/skin-tones/clapping-hands-medium-light-skin-tone" rel="noopener ugc nofollow" target="_blank">IEmoji.com</a></figcaption></figure><p id="2c1b" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><strong class="jf hv">作品被引用</strong></p><p id="7728" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">[1] — <a class="ae jc" href="https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#finalize--" rel="noopener ugc nofollow" target="_blank"> JDK 9 API文档:java.lang.Object.finalize() </a></p></div></div>    
</body>
</html>