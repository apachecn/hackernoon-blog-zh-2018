<html>
<head>
<title>TotalCloud BuildBot: A Cost-Efficient &amp; Rapid Unity Build Pipeline Open Source Tool (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TotalCloud BuildBot:一个高效快速的Unity构建管道开源工具(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/totalcloud-buildbot-a-cost-efficient-rapid-unity-build-pipeline-open-source-tool-part-1-55b4d7a3ba96?source=collection_archive---------32-----------------------#2018-03-14">https://medium.com/hackernoon/totalcloud-buildbot-a-cost-efficient-rapid-unity-build-pipeline-open-source-tool-part-1-55b4d7a3ba96?source=collection_archive---------32-----------------------#2018-03-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/95b38462db0ac5fde53ab2338e5c9fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbvUNtj3oG1LznhnVZfn9Q.png"/></div></div></figure><p id="57aa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不断生成Unity构建，对于游戏开发来说，使用个人电脑不是好玩的游戏。手动生成它们要麻烦得多，因为每个构建都需要花费大量时间来配置和编译。此外，由于内存利用率高，这些构建在个人计算机上很慢，并且容易出现频繁的人为错误。</p><p id="df85" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">自动化构建管道，将它们从开发人员的机器卸载到“云”中，或者使用Travis CI或CircleCI这样的构建平台，看起来似乎是可行的。然而，由于成本较高，开发商被迫采取替代路线。</p><blockquote class="ka kb kc"><p id="4963" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">下面是我们为什么要构建BuildBot的故事，build bot是Unity builds的开源构建管道工具。</p></blockquote><h1 id="2465" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">Unity构建的时间和成本分析</h1><p id="995a" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">我们TotalCloud.io从一开始就利用Unity3D平台来构建我们的沉浸式可视化云管理平台。毫无疑问，Unity3D是一个出色的多平台游戏引擎，无论是游戏开发还是非游戏交互模拟和可视化。</p><p id="0baa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然而，解决Unity 3D的高构建时间对我们来说是一个相当大的挑战。有时，生成一个构建所花费的时间接近一个小时。有时，我们每天推进接近10个构建！现在，想象一下我们花在生成构建上的疯狂的时间。我们希望我们的开发人员尽快看到构建中的变化，而不是等待几个小时。</p><p id="261c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">更糟糕的是，随着构建时间的增加，成本也在增加。我们迫切需要一种解决方案，能够在非常短的时间内自动构建，而无需使用昂贵的构建平台。</p><p id="bec1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就像我们一样，让独立游戏开发者和小工作室远离构建平台或CI解决方案的一个重要因素是生成游戏构建的成本。不像大型游戏工作室可能利用内部构建服务器或CI服务器来持续生成他们的构建，这些独立开发者或小团队没有那种钱来挥霍在硬件和其他构建平台上。</p><blockquote class="ka kb kc"><p id="8f5e" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><strong class="je hv">因此，如果一个游戏开发者每天生成10个版本，那么每月的总成本将达到数百美元，这对他来说是一笔沉重的开支。</strong></p></blockquote><p id="261e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">除了成本和时间因素，手动生成Unity构件还有其他缺点，例如:</p><ul class=""><li id="229d" class="lk ll hu je b jf jg jj jk jn lm jr ln jv lo jz lp lq lr ls dt translated">无法处理复杂的构建管道</li><li id="68ae" class="lk ll hu je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">对环境的控制更少</li><li id="c5ce" class="lk ll hu je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">使得代码签名变得困难</li><li id="53dd" class="lk ll hu je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">减少团队协作</li></ul><p id="f950" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所有这些因素导致我们构建TotalCloud BuildBot，这是一个用于Unity builds的开源构建管道工具。</p><p id="c913" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，让我们更深入地了解一下每次构建的成本。</p><h1 id="9666" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">每次构建的成本比较:CircleCI Vs. Unity Cloud Vs. AWS</h1><p id="647b" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">让我们假设您每天生成10个构建，并且能够并行进行3个构建。这相当于每月大约300次构建。如果每个构建花费了将近30分钟，那么你每个月将消耗大约9000分钟的构建时间。现在，让我们快速比较一下不同构建平台的成本:</p><ul class=""><li id="0c94" class="lk ll hu je b jf jg jj jk jn lm jr ln jv lo jz lp lq lr ls dt translated">使用CircleCI，每月的费用在249美元到449美元之间</li><li id="7811" class="lk ll hu je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">有了Unity Cloud Build，每个月大概要花125美元购买Pro许可证，同时构建只需要几美元</li><li id="0737" class="lk ll hu je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">有了AWS，如果你在基于AMI和i3的Windows上使用EC2实例，每个月大概要花费6到7美元</li></ul><p id="7133" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这清楚地表明，使用AWS是最具成本效益的解决方案之一。</p><blockquote class="ka kb kc"><p id="9864" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">因此，我们利用AWS并构建了BuildBot，这是一个开源的按需构建管道工具，允许独立开发人员或小型团队每月生成数百个构建，其成本仅是市场上任何其他解决方案的一小部分。</p></blockquote><h1 id="c4c5" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">关于我们为什么选择AWS Spot实例和Windows AMI的更多信息</h1><p id="9a22" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">使用EC2 spot instance和Windows Base AMI和i3.large machine而不是Mac OS的原因是，在Linux中生成Unity builds是非常不可靠的，并且由于headless模式问题，大多数时候都不工作。另一方面，AWS没有Mac OS AMIs。这就给我们留下了Windows机器。</p><p id="d2ab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并且，i3.large是一个大机器，15.25 GB内存，475 SSD存储，读写能力高，CPU好，足以生成更大的builds。此外，我们将利用NNVM SSD卷来更快地生成构建，而不是使用内置的EBS卷。</p><p id="b937" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于构建机器只需要在需要时启动，我们将利用AWS Spot实例来实现成本节约。因为，在70%的折扣率下，大型spot实例每小时的费用约为0.0468美元。我们可以很容易地在机器不使用时停止它，并在新的提交可用时快速启动它。我们将在即将发布的构建管道帖子中对此进行更多讨论。现在，让我们带您了解在AWS中生成Unity builds的步骤。</p><h1 id="68e9" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">如何在AWS中生成Unity构建</h1><p id="291a" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">1.使用Windows 2016 Base AMI和i3从AWS控制台启动并连接EC2 Spot实例。对于不熟悉AWS或者想快速了解如何从AWS控制台启动i3.large实例类型的开发人员，<a class="ae ly" href="https://blog.totalcloud.io/creating-aws-ec2-spot-i3-large-instance-using-windows-ami/" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="5e66" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.在Windows计算机中，从“开始”菜单启动Powershell ISE。使用下面的Powershell脚本创建两个文件。第一个脚本是创建生成版本所需的额外SSD卷；第二个脚本是将Unity3D快速安装到Windows机器上。</p><p id="f6a4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是创建附加NNMV SSD卷的脚本。在脚本中，我们将它命名为“Jenkins Volume ”,因为它将是我们的Jenkins Build Pipeline的一部分。</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="c130" class="mi ki hu me b fv mj mk l ml mm">If (!(Test-Path D:)) {</span><span id="5b62" class="mi ki hu me b fv mn mk l ml mm">Get-Disk | Where-Object IsOffline –Eq $True | Set-Disk –IsOffline $False</span><span id="c661" class="mi ki hu me b fv mn mk l ml mm">$newdisk = @(get-disk | Where-Object partitionstyle -eq ‘raw’)</span><span id="ad48" class="mi ki hu me b fv mn mk l ml mm">$Labels = @(‘Jenkins’,’Other1',’Other2')</span><span id="e050" class="mi ki hu me b fv mn mk l ml mm">for($i = 0; $i -lt $newdisk.Count ; $i++)</span><span id="87dc" class="mi ki hu me b fv mn mk l ml mm">{</span><span id="a965" class="mi ki hu me b fv mn mk l ml mm">$disknum = $newdisk[$i].Number</span><span id="f200" class="mi ki hu me b fv mn mk l ml mm">$dl = get-Disk $disknum |</span><span id="0788" class="mi ki hu me b fv mn mk l ml mm">Initialize-Disk -PartitionStyle GPT -PassThru |</span><span id="a70a" class="mi ki hu me b fv mn mk l ml mm">New-Partition -AssignDriveLetter -UseMaximumSize</span><span id="52f8" class="mi ki hu me b fv mn mk l ml mm">Format-Volume -driveletter $dl.Driveletter -FileSystem NTFS -NewFileSystemLabel $Labels[$i] -Confirm:$false</span><span id="8b95" class="mi ki hu me b fv mn mk l ml mm">}</span><span id="1197" class="mi ki hu me b fv mn mk l ml mm">}</span></pre><p id="fa27" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是安装Unity3D引擎的脚本。</p><p id="4a31" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">页（page的缩写）s:确保将这个Powershell脚本保存在c盘中。</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="66dc" class="mi ki hu me b fv mj mk l ml mm">$uri_editor = “<a class="ae ly" href="https://download.unity3d.com/download_unity/a9f86dcd79df/Windows64EditorInstaller/UnitySetup64-2017.3.0f3.exe" rel="noopener ugc nofollow" target="_blank">https://download.unity3d.com/download_unity/a9f86dcd79df/Windows64EditorInstaller/UnitySetup64-2017.3.0f3.exe</a>" ;</span><span id="f49b" class="mi ki hu me b fv mn mk l ml mm">$uri_linux_support = “<a class="ae ly" href="https://download.unity3d.com/download_unity/a9f86dcd79df/TargetSupportInstaller/UnitySetup-Linux-Support-for-Editor-2017.3.0f3.exe" rel="noopener ugc nofollow" target="_blank">https://download.unity3d.com/download_unity/a9f86dcd79df/TargetSupportInstaller/UnitySetup-Linux-Support-for-Editor-2017.3.0f3.exe</a>" ;</span><span id="2286" class="mi ki hu me b fv mn mk l ml mm">$uri_mac_support = “<a class="ae ly" href="https://download.unity3d.com/download_unity/a9f86dcd79df/TargetSupportInstaller/UnitySetup-Mac-Support-for-Editor-2017.3.0f3.exe" rel="noopener ugc nofollow" target="_blank">https://download.unity3d.com/download_unity/a9f86dcd79df/TargetSupportInstaller/UnitySetup-Mac-Support-for-Editor-2017.3.0f3.exe</a>" ;</span><span id="c324" class="mi ki hu me b fv mn mk l ml mm">$out_editor = “C:\Users\Administrator\Documents\UnitySetup64.exe” ;</span><span id="38db" class="mi ki hu me b fv mn mk l ml mm">$out_linux_support = “C:\Users\Administrator\Documents\UnitySetup-Linux-Support.exe” ;</span><span id="2831" class="mi ki hu me b fv mn mk l ml mm">$out_mac_support = “C:\Users\Administrator\Documents\UnitySetup-Mac-Support.exe” ;</span><span id="b53f" class="mi ki hu me b fv mn mk l ml mm">$start_time = Get-Date ;</span><span id="77d9" class="mi ki hu me b fv mn mk l ml mm">$wc = New-Object System.Net.WebClient ;</span><span id="271f" class="mi ki hu me b fv mn mk l ml mm">$wc.DownloadFile($uri_editor, $out_editor) ;</span><span id="795a" class="mi ki hu me b fv mn mk l ml mm">Write-Output “Download complete, $out_editor &gt; Time taken: $((Get-Date).Subtract($start_time).Seconds)s” ;</span><span id="6bb1" class="mi ki hu me b fv mn mk l ml mm">$wc.DownloadFile($uri_linux_support, $out_linux_support) ;</span><span id="5754" class="mi ki hu me b fv mn mk l ml mm">Write-Output “Download complete, $out_linux_support &gt; Time taken: $((Get-Date).Subtract($start_time).Seconds)s” ;</span><span id="f96e" class="mi ki hu me b fv mn mk l ml mm">$wc.DownloadFile($uri_mac_support, $out_mac_support) ;</span><span id="26d8" class="mi ki hu me b fv mn mk l ml mm">Write-Output “Download complete, $out_mac_support &gt; Time taken: $((Get-Date). Subtract($start_time).Seconds)s”;</span></pre><p id="1ac4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.从c盘的Unity文件夹中查找Unity安装程序，并为Windows、Linux以及MacOS安装软件包。</p><p id="ab18" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.等待Unity安装。</p><p id="c9c3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.从Repo下载您的代码，并查找您想要编译构建的项目的路径。</p><p id="e83f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">6.创建一个BAT文件，在构建生成时自动存储它们。这是一个BAT文件的例子。确保您为相应的命令添加了正确的路径。示例:在代码的第2行使用您用来保存项目的项目路径URL(在引号内)。</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="42e5" class="mi ki hu me b fv mj mk l ml mm">C:\Development\Unity\Editor\Unity.exe -quit -batchmode -projectPath "D:\jenkins\workspace\unity-dev-build-4x"</span><span id="72f3" class="mi ki hu me b fv mn mk l ml mm">-buildWindows64Player "D:\jenkins\workspace\unity-dev-build-4x\builds\win\64\TotalCloud.exe" -buildOSXUniversalPlayer "D:\jenkins\workspace\unity-dev-build-4x\builds\osx\64\TotalCloud.app" -buildLinux64Player "D:\jenkins\workspace\unity-dev-build-4x\builds\linux\64\TotalCloud.x86_64" -logFile "D:\jenkins\workspace\unity-dev-build-4x\logs\35.txt" || EXIT /B 1</span></pre><p id="1bf2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">7.尝试生成一个新的构建，并检查新的构建是否在输出路径中可用，以及日志文件是否在它们的指定路径中。</p><p id="d39f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一定要尝试一下，并分享你的经验。T3】</p><blockquote class="ka kb kc"><p id="5b16" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><strong class="je hv">这是提供使用TotalCloud BuildBot的踏脚石的三部分系列博客的第1部分。请继续关注我们的第二篇博客，我们将提供关于如何使用BuildBot进行CI/CD管道的详细信息。</strong></p></blockquote></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><p id="21f9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kd">原载于2018年3月14日</em><a class="ae ly" href="https://blog.totalcloud.io/totalcloud-buildbot-a-cost-efficient-rapid-unity-build-pipeline-open-source-tool-part-1/" rel="noopener ugc nofollow" target="_blank"><em class="kd">blog . total cloud . io</em></a><em class="kd">。</em></p></div></div>    
</body>
</html>