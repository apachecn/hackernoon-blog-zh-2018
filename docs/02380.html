<html>
<head>
<title>Microservices for Startups: An Interview with David Calavera of Netlify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初创公司的微服务:采访Netlify的大卫·卡拉维拉</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/microservices-for-startups-an-interview-with-david-calavera-of-netlify-bd8695e3c03c?source=collection_archive---------49-----------------------#2018-03-15">https://medium.com/hackernoon/microservices-for-startups-an-interview-with-david-calavera-of-netlify-bd8695e3c03c?source=collection_archive---------49-----------------------#2018-03-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7f29" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">这次采访是为我们的</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">创业微服务</em> </a> <em class="jp">电子书做的。一定要去看看关于微服务的实用建议。感谢David的时间和投入！</em></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff jr"><img src="../Images/5271210d48ea62bb8e17d273eb37cd51.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/0*80_spF1F69_CrTfB."/></div></figure><p id="3ecd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" href="https://twitter.com/calavera" rel="noopener ugc nofollow" target="_blank"><em class="jp">David cala vera</em></a><em class="jp">是</em><a class="ae jq" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank"><em class="jp">net lify</em></a><em class="jp">的首席技术官，这是一个统一的平台，可以自动化您的代码来创建高性能、易于维护的网站和web应用程序。</em></p><p id="7ea5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于上下文，您的工程团队有多大？您是否正在使用微服务，能否概括介绍一下您是如何使用它们的？</p><p id="0cd1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">目前，工程部门由10人组成。在我们公司，我们也把工程部门的设计师和支持工程师算在内，但是他们写的代码要少一点，能力要低一点。他们帮助产品设计，内部工具等等。</p><p id="ef1d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们在CDN网络的每个节点部署了三个微服务。然后我们有我们所说的交付网络，它是API服务器和源服务器的组合。我们在每个节点中部署了两个服务，外加一个执行异步作业的后台工作器。这是从更大的应用程序中提取的服务。我们还有一个构建和部署管道。在那里，我们基本上有一个处理一切的服务，而且它相当小。所以我会说那是微服务，但只是一个。所有这些组件就是我们所说的核心服务。我们还有额外的服务，比如我们的身份服务，从一开始就是作为微服务创建的。它们在Kubernetes集群中独立运行。</p><p id="ef68" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">你是从整体开始，后来采用微服务的吗？</strong></p><p id="700d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们从一个分离的架构开始。它们本身不是微服务，而是更大的服务。例如，我们在API和源服务器之间的交付网络中部署的两个微服务现在是一个服务。CDN层也是如此，我们在CDN层开始时在边缘节点上运行一项服务，我们将该较大服务的一些逻辑提取到较小的微服务中。</p><p id="741d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为一个团队/工程组织，你是如何处理微服务这个话题的？是否围绕微服务的定义进行了讨论？</p><p id="f975" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们试图决定某个东西应该存在于微服务中还是存在于已经存在的服务中时，我们问自己的第一个问题是，这个东西是否需要与我们已经存在的服务相结合。如果没有，那么我们问自己，如果我们只需要使用那个服务，我们是否可以考虑一个独立的东西，它实际上可以自己生存。这些是主要问题。我们从经验中学到了这一点。例如，我们在边缘节点的两种服务是非常互补的。他们离不开彼此。我们目前正在讨论，如果他们需要对方，我们应该有一个服务，而不是两个。因为，在一天结束的时候，它们通过HTTP在本地主机上相互交流，但是它们也可以是一个服务，我们应该避免网络连接。</p><p id="6ea0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了应对采用微服务，您是否改变了团队的组织或运营方式？</p><p id="bdc0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是啊，肯定的。现在，我们有一些人在我们所谓的平台上全职工作，这就是CDN基础设施，以及构建和部署管道。其他工程师全职负责产品的API和源服务器。取决于你在两个团队中的哪一个，你将在一个微服务上工作或者在其他的上工作。两个团队一起工作了很多，因为中间有一些胶水，实际上需要连接平台和产品的API。我们可以看到来自平台的人员在API层实现一些东西，反之亦然，工程师正在开发产品，需要在边缘节点或部署管道中的某个微服务中实现一些东西。他们还试图以不同的身份投入到这些项目中，这取决于他们更喜欢什么。</p><p id="af4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">在技术选择上有多少自由？你们是否都同意坚持使用一个堆栈，或者是否有尝试新堆栈的灵活性？你是如何做出那个决定的？</strong></p><p id="f623" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管我们现在的堆栈中有Ruby、C++和Go，但我们正在Go中整合新的微服务。我们有一个引导模板，可以通过Go启动新的微服务。然而，正如我提到的，我们也使用其他编程语言。启动该公司的API使用Ruby on Rails。这就像是网络生活的整体概念证明。我们在CDN网络中使用Apache流量服务器作为代理缓存。这是一个很大的C++服务，可以用插件来扩展。我们用C++构建了一个自定义插件来处理路由和缓存失效。</p><p id="5da7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">你有没有把一个单一的应用程序分解成更小的微服务？如果是的话，你能给我们介绍一下这个过程吗？你是如何完成这项任务的？有哪些不可预见的问题和经验教训？</strong></p><p id="a2b6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们创建新的微服务或必须更改某些功能时，我们的核心原则之一是，无论我们做什么，都不能影响当前的生产流量，我们不能有任何停机时间。我们通常的做法是使用特征标志、断路器和分支抽象逻辑。每个组件都知道我们可以随时启用和禁用的几个功能。我们可以在运行时做到这一点，因此，如果我们想要改变基础架构中任何一层的流量模式，我们不必重启任何服务。我们还使用了一些库，允许我们在做这些特性标志分割时尽早检测到故障。根据预期的行为，这些库可以重试对新服务的相同请求，或者退回到原始服务。</p><p id="3e8e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你如何确定服务边界？你的团队内部的讨论是怎样的？你能举些例子吗？</p><p id="7daa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们努力确保我们提取到微服务中的是独立的功能或服务。一个可以独立生存并且只有一个目的的东西。例如，在原始服务器中，我们有一个服务叫做Netlify Server。它只有一个目的，那就是为网络内容服务，它不做任何其他事情。在边缘节点中，我们有一种称为缓存控制的服务。它的唯一目的是使缓存无效。它从网络接收消息以使网站缓存无效。它不做任何其他事情。</p><p id="eedc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们详细讨论了高速缓存控制器的不同实现。作为微服务，它是有意义的，但它也可以嵌入到我们在边缘部署的任何其他服务中。从功能的角度来看，这个服务和其他两个服务之间的界限是很明确的，但是它们可以协同工作。通过保持分离，我们还可以评估不同的实现，而无需修改其他两个服务中的任何一个。</p><p id="f547" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对你的开发过程有什么影响？您的运营和部署流程？出现了哪些挑战，你是如何解决的？你能举些例子吗？</strong></p><p id="2b4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们开发这些服务时，我们总是试图孤立地处理它们。除非您需要测试服务之间的边界，否则您不需要在您的计算机上运行完整的平台。在内部，每个服务都有不同的接口与不同的服务进行对话。我们总是为那些忽略网络请求的接口提供一个模拟实现，或者用特定的响应来回复某些请求。</p><p id="d0b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们发现非常有用的东西是记录来自真实网络流量的请求和响应的能力。例如，我们这样做是为了与我们使用的外部服务进行对话，如NS1或Braintree。为此，我们使用了一个名为VCR的开源项目；有不同编程语言的实现。这允许我们记录来自两个连接在一起的服务的请求和响应消息，就像它们在生产中一样，并回复它们以用于开发和测试。</p><p id="5a63" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们目前正在将所有部署集中在不同的Kubernetes集群中。我们仍然有一些使用Ansible部署的服务，但是我们正在将所有服务迁移到一个更加CI/CD友好的工作流中。我们在Kubernetes上部署的服务使用带有容器映像的蓝/绿部署系统。这也让我们对部署管道内部有了更多的了解。我们将消息发送到Slack中的部署通道，在那里人们可以看到部署何时发生。</p><p id="108e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对您的测试方式有何影响？在这方面有什么经验教训或建议？你能举些例子吗？</strong></p><p id="8faa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如我之前提到的，我们使用VCR来记录服务之间的真实交互，我们可以在测试期间重放这些交互。我们记录好的和坏的服务交互，并定期更新这些记录，以保证我们使用的外部服务没有任何变化。</p><p id="a23a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还直接测试生产中的许多东西。我们的服务因流量模式而异，有时我们无法观察生产之外的行为。我们使用功能标志、日志和指标来跟踪我们必须测试的孤立流量模式或网站。</p><p id="e125" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对安全性和控制数据访问有何影响？</strong></p><p id="4bc1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我不认为我们的安全模式从一开始就有很大变化。我们通过TLS运行一切，甚至内部服务，我们不允许生产网络中存在不安全的连接。每个服务还使用某种访问控制来允许对特定资源的请求。</p><p id="a57a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">您在微服务架构中遇到过管理数据一致性的问题吗？</strong></p><p id="ea12" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不，这不是问题。现在，只有我们的API对我们的主数据库有写权限。如果一个服务需要向那个数据库写一些东西，它需要向我们的API发送请求。一些微服务有自己的持久数据存储，它们的使用非常局限于服务。</p><p id="90f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">再次感谢David的时间和投入！这次采访是为我们的</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">创业微服务</em> </a> <em class="jp">电子书做的。一定要去看看关于微服务的实用建议。</em></p></div><div class="ab cl jz ka hc kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hn ho hp hq hr"><p id="fd02" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文原载于buttercms.com</em><a class="ae jq" href="https://buttercms.com/blog/microservices-for-startups-an-interview-with-david-calavera-of-netlify" rel="noopener ugc nofollow" target="_blank"><em class="jp"/></a><em class="jp">。这是《创业公司的微服务》一书</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">采访系列的一部分。<em class="jp">注册后，新章节一发布，你就会收到电子邮件。</em></em></a></p><p id="4799" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢这篇文章，请在下面鼓掌，帮助它传播！更多类似的内容，请关注我们的<a class="ae jq" href="https://twitter.com/ButterCMS" rel="noopener ugc nofollow" target="_blank"><em class="jp">Twitter</em></a><em class="jp">和</em> <a class="ae jq" href="https://buttercms.com/blog/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">订阅我们的博客</em> </a> <em class="jp">。</em></p><p id="d3f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想在你的网站上添加一个博客或者内容管理系统，而不是用Wordpress， <a class="ae jq" href="https://buttercms.com/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">你应该试试黄油内容管理系统</em> </a> <em class="jp">。</em></p></div></div>    
</body>
</html>