<html>
<head>
<title>Python 3.7’s new builtin breakpoint — a quick tour</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 3.7的新内置断点——快速浏览</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/python-3-7s-new-builtin-breakpoint-a-quick-tour-4f1aebc444c?source=collection_archive---------0-----------------------#2018-03-17">https://medium.com/hackernoon/python-3-7s-new-builtin-breakpoint-a-quick-tour-4f1aebc444c?source=collection_archive---------0-----------------------#2018-03-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="f442" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">与我使用过的其他语言相比，Python中的调试总是感觉有点“笨拙”。</p><p id="7e9a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大多数开发人员从标准库中导入<code class="eh jp jq jr js b">pdb</code>模块，并运行<code class="eh jp jq jr js b">pdb.set_trace()</code>,当执行时，它进入控制台中的交互式调试会话。</p><p id="a877" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种方法有一些重要的问题:</p><ol class=""><li id="c945" class="jt ju hu it b iu iv iy iz jc jv jg jw jk jx jo jy jz ka kb dt translated">写<code class="eh jp jq jr js b">import pdb; pdb.set_trace()</code>有点迟钝。一旦你输入100次，它就会进入肌肉记忆，但对于新开发者来说，这并不明显。</li><li id="b2f3" class="jt ju hu it b iu kc iy kd jc ke jg kf jk kg jo jy jz ka kb dt translated">PDB不是唯一的调试器，它也是最基本的调试器。有很多更好的选择。</li><li id="bc79" class="jt ju hu it b iu kc iy kd jc ke jg kf jk kg jo jy jz ka kb dt translated">如果你不写一个控制台应用程序，会发生什么？如果在服务器或线程任务上遇到断点，调试会话在哪里呢？</li></ol><p id="3ff1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Python 3.7实现了PEP553，这是一种在代码中插入断点的新方法。</p><h1 id="68d8" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">新的断点方法</h1><p id="6265" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated">好的，第一个断点是一个<strong class="it hv">函数</strong>而不是一个关键字。</p><p id="3fd6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，仅仅将<code class="eh jp jq jr js b">breakpoint</code>放在您想要中断的代码行上没有任何作用。你需要调用它作为一个方法，即。<code class="eh jp jq jr js b">breakpoint()</code></p><p id="e48a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">断点的默认实现将<code class="eh jp jq jr js b">import pdb</code>并调用<code class="eh jp jq jr js b">pdb.set_trace()</code>。</p><figure class="lk ll lm ln fq lo"><div class="bz el l di"><div class="lp lq l"/></div></figure><p id="d866" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在命令行上生成pdb会话。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff lr"><img src="../Images/a6974035490ea05718f72735479f52da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVrkKr5sppxSmT_qapejMg.png"/></div></div></figure><p id="12f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以这已经比当前版本的Python直观多了。</p><h1 id="ae7d" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">但是等等，还有更多</h1><p id="4d50" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated">可以使用PYTHONBREAKPOINT环境变量禁用新的断点方法。所以如果你在代码中留下断点，并且你想只执行一次而不让它们停止执行。您可以将环境值设置为0。</p><p id="8d82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jp jq jr js b">PYTHONBREAKPOINT=0 python3.7 debugger.py</code></p><p id="4b2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">再次调用同一个脚本只是完成执行并跳过调用断点。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div class="fe ff ly"><img src="../Images/addd7229294db90be2b49781e395684f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*E06kmBEOGlUcbRfLnf1PPw.png"/></div></figure><h1 id="cbea" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">但是等等，还有呢！</h1><p id="4c63" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated">环境变量<code class="eh jp jq jr js b">PYTHONBREAKPOINT</code>可以设置为可调用的<strong class="it hv">名</strong>。这可以是在另一个第三方调试器库中启动调试会话的可调用函数。</p><p id="a6af" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jp jq jr js b">pudb</code>就是这样一个库。Pudb是一个交互式控制台调试器，具有与pdb相似的键映射，但是更容易使用。<code class="eh jp jq jr js b">pudb</code>已经存在很久了，在Python 2和3中得到支持。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff lz"><img src="../Images/1d519c87a97178c283a846bb262cebad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asrPKZrt_C85fgosdI4DlQ.png"/></div></div></figure><p id="c4d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要使用<code class="eh jp jq jr js b">pudb</code>作为您的调试器，首先确保您已经安装了它，<code class="eh jp jq jr js b">pip install pudb</code>，然后将环境变量设置为<code class="eh jp jq jr js b">pudb.set_trace</code>。</p><p id="cc8a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在命令行中调用:</p><p id="85b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jp jq jr js b">PYTHONBREAKPOINT=pudb.set_trace python3.7 debugger.py</code></p><p id="e1dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">等同于用<code class="eh jp jq jr js b">import pudb; pudb.set_trace()</code>替换<code class="eh jp jq jr js b">breakpoint()</code>方法</p><p id="ac23" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">相当整洁。</p><h1 id="211c" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">远程调试和线程呢？</h1><p id="1afb" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated">这个新的断点特性打开了一个有趣的用例。</p><p id="4502" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您开发一个跨多个服务器或线程分发的应用程序时，您可以使用一个本地调试器，比如pudb。</p><p id="f926" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您部署到测试环境中时，您可能不会从cli执行。你是从gevent或WSGI等打来的。这是当您将web服务或测试环境中的环境变量更改为另一个允许远程连接的调试器时。</p><p id="ca3a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以使用的一个这样的包是<strong class="it hv"> web-pdb </strong>。Web-pdb是一个远程调试器，它在断点命中时启动Web服务器，您可以通过浏览器远程连接并交互式调试会话。</p><p id="10f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你<code class="eh jp jq jr js b">pip install web-pdb</code>然后你可以设置<code class="eh jp jq jr js b">export PYTHONBREAKPOINT=’web_pdb.set_trace’</code>现在当<code class="eh jp jq jr js b">breakpoint()</code>函数被调用时(不管它是否在后台进程中)你可以连接到本地默认端口5555上的服务，你会看到这个界面。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff lz"><img src="../Images/57c71f9355dbff775805836f242dd747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uY2KXPormfSqFt-dLJgdnA.png"/></div></div></figure><h2 id="4285" class="ma ki hu bd kj mb mc md kn me mf mg kr jc mh mi kv jg mj mk kz jk ml mm ld mn dt translated">还卡在Python 2上？</h2><p id="a870" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated"><a class="ae mo" href="https://www.pluralsight.com/courses/python-2-to-python-3" rel="noopener ugc nofollow" target="_blank">查看我在Pluralsight上关于从Python 2迁移到3的新课程。</a></p></div></div>    
</body>
</html>