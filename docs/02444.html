<html>
<head>
<title>Parallelizing Builds In Travis CI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Travis CI中并行构建</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/parallelizing-builds-in-travis-ci-9d913e5722eb?source=collection_archive---------8-----------------------#2018-03-18">https://medium.com/hackernoon/parallelizing-builds-in-travis-ci-9d913e5722eb?source=collection_archive---------8-----------------------#2018-03-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/e5310599053ad296980931f66931fb35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXxePtCOrJmCcJ54UGTOxQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Ember JS + Python</figcaption></figure><p id="e75d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">一点背景:在过去的几个月里，我一直在开源组织<a class="ae ke" href="https://github.com/fossasia" rel="noopener ugc nofollow" target="_blank"> FOSSASIA </a>中做贡献，在那里我从事一个名为<a class="ae ke" href="https://github.com/fossasia/badgeyay" rel="noopener ugc nofollow" target="_blank"> BadgeYaY </a>的项目。这是一个徽章生成器，具有简单的web用户界面，可以添加数据并生成PDF格式的可打印徽章。</p><p id="469e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><a class="ae ke" href="https://github.com/fossasia/badgeyay" rel="noopener ugc nofollow" target="_blank"> Badgeyay </a>项目现在分为两部分，Ember JS的前端和用Python编程的REST-API的后端。现在，一个具有挑战性的工作是，它应该支持非耦合架构。因此，它应该利用<strong class="ji hv">隔离的</strong>并行构建，在隔离的实例上运行前端和后端测试，即两种不同语言的测试。</p><p id="46c3" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在这篇博客中，我将讨论在我的<a class="ae ke" href="https://github.com/fossasia/badgeyay/pull/512" rel="noopener ugc nofollow" target="_blank"> Pull请求中，我如何配置Travis CI在<a class="ae ke" href="https://github.com/fossasia/badgeyay" rel="noopener ugc nofollow" target="_blank"> Badgeyay </a>的隔离并行构建中并行运行测试。</a></p><p id="6e53" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">首先，让我们了解什么是<a class="ae ke" href="https://docs.travis-ci.com/user/speeding-up-the-build/" rel="noopener ugc nofollow" target="_blank">并行Travis CI </a>构建，以及我们为什么需要它。然后我们将继续配置travis.yml文件来并行运行测试。让我们开始，一步一步了解。</p><p id="34de" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">为什么并行Travis CI构建？</p><p id="446c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">集成测试套件倾向于通过包含前端和后端的整个堆栈来测试更复杂的情况，它们同样倾向于成为最慢的部分，需要不同的时间来运行，有时甚至长达30分钟。为了加速这样的测试套件，我们可以利用Travis build matrix特性将它分成几个部分。Travis将根据环境变量决定<a class="ae ke" href="https://docs.travis-ci.com/user/build-stages/matrix-expansion/" rel="noopener ugc nofollow" target="_blank">构建矩阵</a>，并安排运行两个构建。</p><p id="6bca" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在我们的目标很明确，我们必须配置travis.yml来构建parallel-y。我们的项目需要两个构建包，Python和node_js，运行这两个构建包的构建作业将会大大加快速度。现在似乎可以使用<a class="ae ke" href="https://docs.travis-ci.com/user/customizing-the-build/" rel="noopener ugc nofollow" target="_blank"> <em class="kf">矩阵:include </em> </a>特性在一个. travis.yml文件中运行多种语言。</p><p id="d9fd" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下面是<a class="ae ke" href="https://github.com/fossasia/badgeyay" rel="noopener ugc nofollow" target="_blank"> Badgeyay </a>项目的<a class="ae ke" href="https://github.com/fossasia/badgeyay/blob/development/.travis.yml" rel="noopener ugc nofollow" target="_blank"> travis.yml </a>文件的代码片段，以便以并行方式运行构建任务。</p><pre class="kg kh ki kj fq kk kl km kn aw ko dt"><span id="4ff9" class="kp kq hu kl b fv kr ks l kt ku">sudo: required<br/>dist: trusty</span><span id="7be8" class="kp kq hu kl b fv kv ks l kt ku"># check different combinations of build flags which is able to divide builds into “jobs”.<br/>matrix:</span><span id="26f2" class="kp kq hu kl b fv kv ks l kt ku"># Helps to run different languages in one .travis.yml file<br/> include:</span><span id="8bf2" class="kp kq hu kl b fv kv ks l kt ku"># First Job in Python language.<br/> — language: python3</span><span id="fd7b" class="kp kq hu kl b fv kv ks l kt ku">apt:<br/> packages:<br/> — python-dev</span><span id="f71b" class="kp kq hu kl b fv kv ks l kt ku">python:<br/> — 3.5<br/> cache:<br/> directories:<br/> — $HOME/backend/.pip-cache/<br/> <br/> before_install:<br/> — sudo apt-get -qq update<br/> — sudo apt-get -y install python3-pip<br/> — sudo apt-get install python-virtualenv</span><span id="8528" class="kp kq hu kl b fv kv ks l kt ku">install:<br/> — virtualenv -p python3 ../flask_env<br/> — source ../flask_env/bin/activate<br/> — pip3 install -r backend/requirements/test.txt — cache-dir</span><span id="4922" class="kp kq hu kl b fv kv ks l kt ku">before_script:<br/> — export DISPLAY=:99.0<br/> — sh -e /etc/init.d/xvfb start<br/> — sleep 3</span><span id="3216" class="kp kq hu kl b fv kv ks l kt ku">script:<br/> — python backend/app/main.py &gt;&gt; log.txt 2&gt;&amp;1 &amp;<br/> — python backend/app/main.py &gt; /dev/null &amp;<br/> — py.test — cov ../ ./backend/app/tests/test_api.py</span><span id="d720" class="kp kq hu kl b fv kv ks l kt ku">after_success:<br/> — bash &lt;(curl -s <a class="ae ke" href="https://codecov.io/bash)" rel="noopener ugc nofollow" target="_blank">https://codecov.io/bash)</a></span><span id="4869" class="kp kq hu kl b fv kv ks l kt ku"># Second Job in node js language.<br/> — language: node_js<br/> node_js:<br/> — “6”</span><span id="76ad" class="kp kq hu kl b fv kv ks l kt ku">addons:<br/> chrome: stable</span><span id="ccf6" class="kp kq hu kl b fv kv ks l kt ku">cache:<br/> directories:<br/> — $HOME/frontend/.npm</span><span id="a6b0" class="kp kq hu kl b fv kv ks l kt ku">env:<br/> global:<br/> # See <a class="ae ke" href="https://git.io/vdao3" rel="noopener ugc nofollow" target="_blank">https://git.io/vdao3</a> for details.<br/> — JOBS=1</span><span id="66dd" class="kp kq hu kl b fv kv ks l kt ku">before_install:<br/> — cd frontend<br/> — npm install<br/> — npm install -g ember-cli<br/> — npm i eslint-plugin-ember@latest — save-dev<br/> — npm config set spin false</span><span id="8542" class="kp kq hu kl b fv kv ks l kt ku">script:<br/> — npm run lint:js<br/> — npm test</span></pre><p id="a244" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在，我们已经添加了travis.yml并将其推送到项目存储库。下面是并行构建作业后传递Travis CI的屏幕截图。</p><figure class="kg kh ki kj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kw"><img src="../Images/b511fd1490fe6d71d874f15383a52709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eEut_O0hqh1MFiStP66nYQ.png"/></div></div></figure><p id="89d9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">该工作的相关拉动需求为https://github.com/fossasia/badgeyay/pull/512<a class="ae ke" href="https://github.com/fossasia/badgeyay/pull/512" rel="noopener ugc nofollow" target="_blank"/></p><p id="8908" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">至此，我已经结束了关于在Travis CI中并行化构建的讨论。我写这篇文章是为了解决BadgeYaY项目中的这个问题。如果你喜欢这篇文章，可以考虑看看我在GitHub上的其他作品🙂。</p><p id="9cb1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">来源:<a class="ae ke" href="https://docs.travis-ci.com/user/customizing-the-build/" rel="noopener ugc nofollow" target="_blank"> Travis CI文档</a></p><p id="abeb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">PS:非常想要建设性的批评。🙂</p></div></div>    
</body>
</html>