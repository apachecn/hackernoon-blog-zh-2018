<html>
<head>
<title>Supercharged Unit Testing of Alexa skills with Postman and Newman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">邮差和纽曼对Alexa技能的增压单元测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/supercharged-unit-testing-of-alexa-skills-with-postman-and-newman-53e6c48214e3?source=collection_archive---------12-----------------------#2018-03-18">https://medium.com/hackernoon/supercharged-unit-testing-of-alexa-skills-with-postman-and-newman-53e6c48214e3?source=collection_archive---------12-----------------------#2018-03-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/208b3c6bd9e6d6a3e1976234728657d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*9cVPQ8azohAoaMvopR-ESw.png"/></div></figure><p id="0d09" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">最近，亚马逊一直在努力改善其Alexa智能个人助理的开发者体验。该策略技能管理<a class="ae jw" href="https://hackernoon.com/tagged/api" rel="noopener ugc nofollow" target="_blank"> API </a>的一部分，提供了测试多回合对话、实体解析、对话管理和更多现有测试工具不支持的功能。</p><p id="def4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">用Postman测试Alexa技能取代了亚马逊开发者门户提供的基本测试服务。</p><p id="0bce" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">首先，我们将使用三样东西来完成所有这些工作</p><p id="58c8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们需要三样东西来开始</p><ul class=""><li id="13f2" class="jx jy hu ja b jb jc jf jg jj jz jn ka jr kb jv kc kd ke kf dt translated"><a class="ae jw" href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a></li></ul><p id="3f51" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果你以前没有为Alexa建立技能，我会建议，在5分钟内完成<a class="ae jw" href="https://developer.amazon.com/alexa-skills-kit/alexa-skill-quick-start-tutorial" rel="noopener ugc nofollow" target="_blank">建立技能</a>，从核心原则开始。</p><p id="456c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">一旦你设置好Lambda函数并运行，我们就可以开始了。</p><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kg"><img src="../Images/28c9dc9c9cde7c7f9d6e791db7779348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mjp8Lt9yv40yDG4OWAEo1g.png"/></div></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek">Function might be looking something like this</figcaption></figure><ul class=""><li id="766e" class="jx jy hu ja b jb jc jf jg jj jz jn ka jr kb jv kc kd ke kf dt translated"><a class="ae jw" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> API网关</a></li></ul><p id="4a10" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">通过亚马逊API Gateway，我们可以为Alexa提供一致的、可扩展的编程接口，以访问后端的端点。</p><ol class=""><li id="56d0" class="jx jy hu ja b jb jc jf jg jj jz jn ka jr kb jv kt kd ke kf dt translated">首先，转到<a class="ae jw" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> AWS API网关</a>并登录控制台。</li><li id="38a4" class="jx jy hu ja b jb ku jf kv jj kw jn kx jr ky jv kt kd ke kf dt translated">首先，确保您已经从页面顶部的单选按钮中选择了“New API”。然后新建一个角色，选择“L <a class="ae jw" href="https://www.google.co.in/search?q=lambda%20execution%20role%20cloudformation&amp;ved=0ahUKEwjAntrtwvXZAhWLfZAKHT4ZCwEQsKwBCC0oADAA" rel="noopener ugc nofollow" target="_blank"> ambda执行角色</a></li><li id="1329" class="jx jy hu ja b jb ku jf kv jj kw jn kx jr ky jv kt kd ke kf dt translated">现在您需要打开Actions按钮，这次选择“Deploy API”在出现的“部署API”框中，为“部署/测试阶段”选择“[新阶段]”。对于其他三个值(阶段名称、阶段描述和部署描述)，您可以只使用单词“Test”来表示它们。值并不重要，这只是为了让您知道这个新API的用途。我们在后期需要这个。</li></ol><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kz"><img src="../Images/e330c30e6e4385e75a51614c6fb0421e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3I6gwmZt-Tx0Ey2yJJl79g.png"/></div></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek">Sample Dashboard</figcaption></figure><p id="af1c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">4.现在，从屏幕顶部的蓝框中复制调用URL。您的API已经设置好，可以开始运行了。</p><ul class=""><li id="ca0c" class="jx jy hu ja b jb jc jf jg jj jz jn ka jr kb jv kc kd ke kf dt translated">使用Postman API工具启动和运行</li></ul><ol class=""><li id="b037" class="jx jy hu ja b jb jc jf jg jj jz jn ka jr kb jv kt kd ke kf dt translated">如果你还没有这个神奇的工具，一定要下载<a class="ae jw" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>。但是等等…</li></ol><p id="49cf" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">为什么是邮递员？</strong></p><ul class=""><li id="fdfe" class="jx jy hu ja b jb jc jf jg jj jz jn ka jr kb jv kc kd ke kf dt translated">在本文中，我们将使用Postman来创建和执行针对Lambda函数的单元测试。每次你对你的Lambda进行修改时，你都应该运行你的测试来确保所有的东西都像预期的那样工作</li><li id="ae9f" class="jx jy hu ja b jb ku jf kv jj kw jn kx jr ky jv kc kd ke kf dt translated">我们有一些神奇的东西叫做<a class="ae jw" href="https://www.getpostman.com/docs/v6/postman/monitors/intro_monitors" rel="noopener ugc nofollow" target="_blank">监视器</a>，这将帮助我们节省单元测试<a class="ae jw" href="https://hackernoon.com/tagged/alexa-skills" rel="noopener ugc nofollow" target="_blank"> Alexa技能</a>的开销。</li><li id="ccdd" class="jx jy hu ja b jb ku jf kv jj kw jn kx jr ky jv kc kd ke kf dt translated">Postman帮助我们编写基于TDD的请求前脚本和请求测试脚本。是的，<a class="ae jw" href="https://www.getpostman.com/docs/v6/postman/scripts/postman_sandbox" rel="noopener ugc nofollow" target="_blank"><em class="la">Postman collections</em></a>让API测试再次变得伟大。</li><li id="66af" class="jx jy hu ja b jb ku jf kv jj kw jn kx jr ky jv kc kd ke kf dt translated">我在邮递员工作。😜</li></ul><p id="1fc8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">好了，现在你有希望成为邮递员了。</p><p id="268a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果您需要API gateway上每个请求的更多安全性，那么您可以添加<a class="ae jw" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-use-postman-to-call-api.html" rel="noopener ugc nofollow" target="_blank"> AWS签名</a>并继续。</p><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff lb"><img src="../Images/46b9b4ce5ce0896b3f1438ecb30f44ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AoXZaCpNFmXBKHHdBKJqvQ.png"/></div></div></figure><p id="bfda" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在您需要一个样本请求来开始测试。你可以从像serverless这样的服务模拟器中获得Lambda请求，也可以从亚马逊账户中的Cloudwatch日志中获得。</p><p id="f9fb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">选择body并点击“raw”单选按钮，这表示我们正在将自己的JSON数据转发给Lambda。</p><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff lc"><img src="../Images/388dc4ef956bdfb3f26b2ff1ca18c315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DqDfwXo5Lqeknwd49dxNTg.png"/></div></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek">Raw datatype</figcaption></figure><p id="143a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">输出将被嵌入<code class="eh ld le lf lg b">"SSML"</code>:表示输出的语音是用SSML 标记的文本<a class="ae jw" href="https://developer.amazon.com/docs/custom-skills/speech-synthesis-markup-language-ssml-reference.html" rel="noopener ugc nofollow" target="_blank">。这是alexa交流的一种方式。</a></p><p id="329b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">点击可以了解更多关于请求结构<a class="ae jw" href="https://developer.amazon.com/docs/smapi/account-linking-schemas.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="3dd5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在这一点上，确保并验证您可以成功地与您的Lambda通信，现在我们可以开始为这个请求创建一套测试，它将定义单元。</p><p id="ef8a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">例如，我们正在使用喜爱的颜色技能，“<code class="eh ld le lf lg b">WhatsMyColorIntent what my favorite color” </code>应该返回”<code class="eh ld le lf lg b">orange"</code></p><pre class="kh ki kj kk fq lh lg li lj aw lk dt"><span id="8c32" class="ll lm hu lg b fv ln lo l lp lq">pm.test("Body is correct", function () {<br/>    pm.response.to.have.body("orange");<br/>});</span></pre><p id="2940" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">类似地，当你想检查Alexa在用户给出响应并重新输入后是否继续该技能时，我们需要检查字段<code class="eh ld le lf lg b">shouldEndSession</code></p><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff lr"><img src="../Images/a427ad857f1f729cfe5a600416cbe9b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1w0Jdms73tJlX-bvMRuykQ.png"/></div></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek">Tests</figcaption></figure><p id="8f56" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">类似地，你可以为一个Alexa技能定义一组测试，并在每次技能发生变化时运行它。当您对请求或代码进行任何意外更改时，Postman将帮助您了解中断。</p><p id="162b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这样你就节省了大量的时间和精力来写代码，而不是无聊的测试。</p><p id="d0f1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">您还可以保存Alexa对Postman的响应并编写测试，而无需再次调用Prod API进行一次会话。你可以在这里了解更多<a class="ae jw" href="http://blog.getpostman.com/2017/03/16/simulate-a-back-end-with-postmans-mock-service/" rel="noopener ugc nofollow" target="_blank">。您可以在Runner中运行您的收藏，并了解您的技能状态。</a></p><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff ls"><img src="../Images/f251a862461d364e497e832ce04fa001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M6mtjD-HKQYi_ZjHkLmDgQ.png"/></div></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek">Monitor Skills on Postman’s cloud.</figcaption></figure><p id="fe21" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在，如果你像我一样是CLI迷，你会更喜欢从命令行测试所有的测试，对吗？</p><p id="a830" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">没问题，邮差有一个工具叫，<a class="ae jw" href="https://github.com/postmanlabs/newman" rel="noopener ugc nofollow" target="_blank">纽曼</a>，是邮差的命令行伴侣。</p><p id="75af" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">用NodeJS通过<code class="eh ld le lf lg b">npm install newman --global </code>安装纽曼。</p><p id="b8c0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">就是这样。现在是在CLI中使用集合的时候了。</p><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/471ff03a45117d1605f16e05e550539e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*5jfhpJ8RpzJEs6eBqIuX2w.png"/></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek">Export by clicking here.</figcaption></figure><p id="04af" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在，使用以下命令在CLI中运行测试</p><p id="9017" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><code class="eh ld le lf lg b">newman run AlexaSkillTesting/test_to_check_color.json</code></p><p id="d84f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">仅此而已。看到你的终端跟邮递员说话，替你测试。</p><p id="5a46" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">是的，<strong class="ja hv">邮递员监视器肯定可以通过监视响应来提供帮助，并在出现问题时发出通知。因为，我们将为我们的技能编写一整套单元测试，这样当我们对某个东西进行更改时，我们就有信心没有任何东西损坏，一切正常。这绝对有助于我们在每个对话阶段进行技能的功能测试。所以，干杯🍺</strong></p><p id="d3a3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">希望，我已经帮助你测试alexa的技能。感谢阅读🙌</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="lu lv l"/></div></figure></div></div>    
</body>
</html>