<html>
<head>
<title>Unicycle to Differential Drive: Coursera’s Control of Mobile Robots with ROS and ROSbots — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">独轮车到差动驱动:Coursera用ROS和ROSbots控制移动机器人——第二部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/unicycle-to-differential-drive-courseras-control-of-mobile-robots-with-ros-and-rosbots-part-2-6d27d15f2010?source=collection_archive---------6-----------------------#2018-03-19">https://medium.com/hackernoon/unicycle-to-differential-drive-courseras-control-of-mobile-robots-with-ros-and-rosbots-part-2-6d27d15f2010?source=collection_archive---------6-----------------------#2018-03-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="9097" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">欢迎回到我们的多部分<a class="ae jp" href="https://www.coursera.org/learn/mobile-robot" rel="noopener ugc nofollow" target="_blank"> Coursera的移动机器人控制</a> (CMR)系列的第2部分。这个系列用<a class="ae jp" href="http://www.ros.org" rel="noopener ugc nofollow" target="_blank"> ROS </a>和<a class="ae jp" href="http://www.rosbots.com" rel="noopener ugc nofollow" target="_blank"> ROSbots机器人</a>实现了从CMR学到的概念。</p><p id="51fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">ROSbots是一款基于树莓派的机器人套件。机器人套件旨在成为一个易于访问且非常友好的实验平台，添加其他传感器和致动器来实现您遇到的任何新的机器人概念。我们的代码是<a class="ae jp" href="https://github.com/rosbots" rel="noopener ugc nofollow" target="_blank">在Github上开源</a>。</p><p id="f979" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">组装这套工具大约需要一个小时。为了避免自己编译ROS和OpenCV的痛苦，我们有一个<a class="ae jp" rel="noopener" href="/@rosbots/ready-to-use-image-raspbian-stretch-ros-opencv-324d6f8dcd96"> Raspbian ROS + OpenCV SD卡镜像</a>你可以下载使用。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="a849" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们系列的第1部分，<a class="ae jp" rel="noopener" href="/@rosbots/apply-coursera-control-of-mobile-robots-with-ros-and-rosbots-part-1-777a51f63617">我们连接了ROSbots的L9110电机驱动器，并实现了ROS节点，让UNO板驱动我们机器人的轮子</a>。我们编译并上传到UNO的ROS固件订阅了两个ROS主题，<code class="eh jx jy jz ka b">/wheel_power_left</code>和<code class="eh jx jy jz ka b">/wheel_power_right</code>。在这些主题下发布的<code class="eh jx jy jz ka b">Float32</code> ROS消息描述了通过各自的脉冲宽度转动每个车轮的归一化功率(最大反向与最大正向之比在-1.0和1.0之间)。</p><p id="76c0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们通过使用内置的<code class="eh jx jy jz ka b">rostopic</code>命令行工具手动发布一个<code class="eh jx jy jz ka b">Float32</code> ROS消息来驱动每个轮子，从而结束了第1部分。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="e1a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第二部分中，我们将描述机器人差动驱动系统的运动学和动力学。然后，我们将应用这种理解并实现ROS代码，以遥控(RC)远程操作的方式可预测地驱动机器人。这将大致遵循来自<a class="ae jp" href="https://www.coursera.org/learn/mobile-robot/home/week/1" rel="noopener ugc nofollow" target="_blank"> CMR第1周</a>和<a class="ae jp" href="https://www.coursera.org/learn/mobile-robot/home/week/2" rel="noopener ugc nofollow" target="_blank">第2周</a>的课程和编程任务。</p><p id="0791" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于那些熟悉CMR课程并且可能使用<a class="ae jp" href="http://jpdelacroix.com/simiam/" rel="noopener ugc nofollow" target="_blank"> Sim实现了课程的Matlab编程任务的人。I.am模拟器</a>，我们将使用CMR课程中描述的大致相同的文件和架构结构来实现我们的ROS版本。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><h1 id="6ed7" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">单轮和差动驱动模型</h1><p id="5bcc" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">由于轮式机器人不能飞行，我们只关心定义其姿态的三种状态:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="bb14" class="lm kc hu ka b fv ln lo l lp lq">x - position on the x-axis (ie in meters)</span><span id="9576" class="lm kc hu ka b fv lr lo l lp lq">y - position on the y-axis (ie in meters)</span><span id="3ee4" class="lm kc hu ka b fv lr lo l lp lq">φ - phi - angle of the unicycle counter clockwise from x-axis (ie in radians)</span></pre><figure class="le lf lg lh fq lt fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/2c31949eeaddf4fb11f392524175f94e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*rhwbANSiGUA8X98-nlbGTA.png"/></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">State and inputs for a unicycle model</figcaption></figure><p id="2d0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于独轮车模型，有2个输入影响机器人的这3种状态:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="caa4" class="lm kc hu ka b fv ln lo l lp lq">v = forward velocity (ie meters per second)</span><span id="8d34" class="lm kc hu ka b fv lr lo l lp lq">w = angular velocity (ie radians per second)</span></pre><p id="c4da" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然轮式机器人可以有任意数量的轮子和影响其姿态的更复杂的因素，但我们方便地使用独轮模型来描述大多数轮式机器人的动力学，因为它易于理解和直观。具体来说，我们直观地用<code class="eh jx jy jz ka b">v</code>和<code class="eh jx jy jz ka b">w</code>来描述独轮车会如何运动。</p><p id="13d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这一切都很好，但我们的ROSbots机器人是一个差动驱动机器人，两个轮子各有2个输入:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="9014" class="lm kc hu ka b fv ln lo l lp lq">v_r = clockwise angular velocity of right wheel (ie radians per second)</span><span id="b761" class="lm kc hu ka b fv lr lo l lp lq">v_l = counter-clockwise angular velocity of left wheel (ie radians per second)</span></pre><p id="f7ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">幸运的是，我们可以将独轮输入转换为差分驱动输入。在描述转换公式之前，我们需要用直尺进行一些测量。</p><figure class="le lf lg lh fq lt fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/c35c18c61c389c4effae348b619a3e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*0T8tN-AvcmkJfXxj82FTiA.png"/></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">Differential Drive Model</figcaption></figure><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="2480" class="lm kc hu ka b fv ln lo l lp lq">L = wheelbase (in meters per radian)</span><span id="3330" class="lm kc hu ka b fv lr lo l lp lq">R = wheel radius (in meters per radian)</span></pre><p id="3b06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为<code class="eh jx jy jz ka b">R</code>是车轮半径的度量单位，所以将<code class="eh jx jy jz ka b">R</code>视为每弧度的米数是有意义的。</p><p id="b1f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对<code class="eh jx jy jz ka b">L</code>来说，这并不那么直观。在差速驱动运动学模型中，你可以把<code class="eh jx jy jz ka b">L</code>想象成一个轮子旋转同时保持另一个轮子不动所画的圆的半径。所以<code class="eh jx jy jz ka b">L</code>也是以米/弧度为单位，也就是那个圆的半径。</p><figure class="le lf lg lh fq lt fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/169880b4d68e35301263fb9539e4a5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*TUeFt044wCi7CUDUqWp8Zw.png"/></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">L is in meters per radian</figcaption></figure><p id="1e59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们不会进入令人痛苦的细节(因为这不是一个关于运动学的帖子)，但总的来说，我们可以使用独轮车模型的<a class="ae jp" href="http://planning.cs.uiuc.edu/node660.html" rel="noopener ugc nofollow" target="_blank">运动学和差动驱动模型</a>的<a class="ae jp" href="http://planning.cs.uiuc.edu/node659.html" rel="noopener ugc nofollow" target="_blank">运动学来得出以下等式，以将独轮车<code class="eh jx jy jz ka b">v</code>和<code class="eh jx jy jz ka b">w</code>输入转换为我们的ROSbots机器人的<code class="eh jx jy jz ka b">v_r</code>和<code class="eh jx jy jz ka b">v_l</code>差动驱动输入。</a></p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="68c8" class="lm kc hu ka b fv ln lo l lp lq">v_r = ((2 * v) + (w * L)) / (2 * R)</span><span id="63ab" class="lm kc hu ka b fv lr lo l lp lq">v_l = ((2 * v) - (w * L)) / (2 * R)</span></pre><p id="94a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">两个方程的分子单位都是米每秒。分母是米每弧度。v_r和v_l分别以弧度/秒表示，顺时针和逆时针——这正是我们所期望的。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><h1 id="91c4" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">ROS中单轮驱动到差动驱动的转换</h1><p id="a1d8" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">上面的两个方程是我们的甜心方程，我们在ROSbots机器人的ROS节点中实现了它们。</p><p id="6388" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了测试我们的机器人，我们将以遥控(RC)远程操作的方式驱动我们的机器人，通过键盘命令指定<code class="eh jx jy jz ka b">v</code>和<code class="eh jx jy jz ka b">w</code>输入。键盘接口是通过一个由ROS社区创建的<a class="ae jp" href="http://wiki.ros.org/teleop_twist_keyboard" rel="noopener ugc nofollow" target="_blank">teleop _ twist _ keyboard ROS node</a>应用程序。</p><p id="d65d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">SSH到您的ROSbots机器人上的Raspberry Pi (RPi)。在您的RPi运行中:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="3d13" class="lm kc hu ka b fv ln lo l lp lq">$ update_rosbots_git_repos</span></pre><p id="b7a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这应该可以从Github获取最新的ROSbots库源文件。</p><p id="4844" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还将假设您正从我们离开第1部分的地方继续学习。具体来说，您可以通过以下方式将motor_driver固件编译并上传到ROSBots的UNO板上:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="4501" class="lm kc hu ka b fv ln lo l lp lq">$ upload_firmware ~/gitspace/rosbots_driver/platformio/rosbots_firmware/examples/motor_driver/</span></pre><p id="4b1c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为健全性检查，如果您运行<code class="eh jx jy jz ka b">$ rosnode list</code>，下面是正在运行的ROS节点:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="3b01" class="lm kc hu ka b fv ln lo l lp lq">/rosout<br/>/uno_serial_node</span></pre><p id="88ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您运行<code class="eh jx jy jz ka b">$ rostopic list</code>，以下是ROS主题:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="04de" class="lm kc hu ka b fv ln lo l lp lq">/diagnostics<br/>/rosout<br/>/rosout_agg<br/>/wheel_power_left<br/>/wheel_power_right</span></pre><p id="f6e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在运行让我们运行独轮车来区别驱动模型机器人代码。同样，从RPi SSH终端运行:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="1a3d" class="lm kc hu ka b fv ln lo l lp lq">$ rosrun rosbots_driver part2_cmr.py</span></pre><p id="ba38" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您应该看到以下输出，则ROS节点正在工作:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="875e" class="lm kc hu ka b fv ln lo l lp lq">[INFO] [1521228417.529282]: /part2_cmr RCTeleop initialized<br/>[INFO] [1521228417.595446]: /part2_cmr wheelbase: 0.14 wheel radius: 0.035<br/>[INFO] [1521228417.596918]: /part2_cmr v: 0 w: 0<br/>[INFO] [1521228417.598303]: /part2_cmr vl: 0.0 vr: 0.0<br/>[INFO] [1521228417.605237]: /part2_cmr right power: data: 0.0 left power: data: 0.0<br/>[INFO] [1521228418.098403]: /part2_cmr v: 0 w: 0<br/>[INFO] [1521228418.101346]: /part2_cmr vl: 0.0 vr: 0.0<br/>[INFO] [1521228418.104728]: /part2_cmr right power: data: 0.0 left power: data: 0.0<br/>...</span></pre><p id="bd9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在<strong class="it hv">为机器人上的RPi打开另一个SSH终端</strong>。</p><p id="e031" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们来看看还有哪些额外的ROS话题发布。从RPi上的第二个SSH终端运行<code class="eh jx jy jz ka b">$ rosnode list</code>，您应该会看到列出了新的<code class="eh jx jy jz ka b">/part2_cmr</code> ROS节点:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="2d13" class="lm kc hu ka b fv ln lo l lp lq">/part2_cmr<br/>/rosout<br/>/uno_serial_node</span></pre><p id="0cd7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们看看运行<code class="eh jx jy jz ka b">/part2_cmr</code> ROS节点给ROS系统增加了哪些其他主题。</p><p id="b000" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第二个SSH RPi终端中，键入<br/> <code class="eh jx jy jz ka b">$ rostopic list</code> —您应该会看到一个额外的<code class="eh jx jy jz ka b">/part2_cmr/cmd_vel</code>主题。</p><p id="3266" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">键入<code class="eh jx jy jz ka b">$ rostopic info /part2_cmr/cmd_vel</code>，您将获得关于<code class="eh jx jy jz ka b">/part2_cmr/cmd_vel</code>主题的更多信息:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="c854" class="lm kc hu ka b fv ln lo l lp lq">Type: geometry_msgs/Twist</span><span id="50fc" class="lm kc hu ka b fv lr lo l lp lq">Publishers: None</span><span id="afe5" class="lm kc hu ka b fv lr lo l lp lq">Subscribers: <br/> * /part2_cmr (<a class="ae jp" href="http://192.168.0.22:33183/" rel="noopener ugc nofollow" target="_blank">http://192.168.0.22:33183/</a>)</span></pre><p id="0002" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本主题传输一个<a class="ae jp" href="http://docs.ros.org/api/geometry_msgs/html/msg/Twist.html" rel="noopener ugc nofollow" target="_blank"> ROS扭转消息</a>类型。扭曲信息是标准<a class="ae jp" href="http://wiki.ros.org/geometry_msgs" rel="noopener ugc nofollow" target="_blank">几何_msgs ROS包</a>的一部分，该包包含许多用于描述机器人几何和运动学的通用信息。</p><p id="3b5d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你看看<a class="ae jp" href="http://docs.ros.org/api/geometry_msgs/html/msg/Twist.html" rel="noopener ugc nofollow" target="_blank"> ROS扭曲信息</a>的定义，你会注意到它实际上可以编码6个自由度的运动——3个为线性运动，3个为角度运动。我们实际上只需要2个DOF——linear . x是我们的<code class="eh jx jy jz ka b">v</code>和angular.z是我们的<code class="eh jx jy jz ka b">w</code>。</p><p id="1c61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意我们的<code class="eh jx jy jz ka b">/part2_cmr</code> ROS节点是主题的订阅者，但是目前没有发布者！没有人告诉机器人该做什么。</p><p id="ce19" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们通过运行<code class="eh jx jy jz ka b">teleop_twist_keyboard</code> ROS节点来添加一个发布者。在第二个SSH RPi终端中，键入:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="caef" class="lm kc hu ka b fv ln lo l lp lq">$ rosrun teleop_twist_keyboard teleop_twist_keyboard.py /cmd_vel:=/part2_cmr/cmd_vel</span></pre><p id="8010" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">默认情况下，<code class="eh jx jy jz ka b">teleop_twist_keyboard</code> ROS节点向名为<code class="eh jx jy jz ka b">/cmd_vel</code>的主题发布Twist消息。<code class="eh jx jy jz ka b">/cmd_vel:=/part2_cmr/cmd_vel</code>参数告诉rosrun将<code class="eh jx jy jz ka b">/cmd_vel</code>名称重新映射到<code class="eh jx jy jz ka b">/part2_cmr/cmd_vel</code>，所以现在发布的主题名称对于发布的<code class="eh jx jy jz ka b">teleop_twist_keyboard</code> ROS节点和订阅的<code class="eh jx jy jz ka b">/part2_cmr</code> ROS节点是相同的。</p><p id="dae8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦运行了<code class="eh jx jy jz ka b">teleop_twist_keyboard</code> ROS节点，让我们首先调整线速度和角速度因子。点击“x”按钮，直到到达<code class="eh jx jy jz ka b">speed 0.174</code>附近，点击“e”键，直到到达<code class="eh jx jy jz ka b">turn 2.59</code>。如果你有3到4个小数位，那很好:</p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="ceba" class="lm kc hu ka b fv ln lo l lp lq">...<br/>currently: speed 0.17433922005 turn 2.5937424601</span></pre><p id="c3c8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如运行teleop_twist_keyboard的输出所描述的，使用小写u i o j k l…键来驱动你的ROSbots机器人。</p><figure class="le lf lg lh fq lt"><div class="bz el l di"><div class="mb mc l"/></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">RC Teleoperating ROSbots</figcaption></figure><p id="c45a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">噢耶！</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><h1 id="8366" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">ROSbots实现细节</h1><p id="9875" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">我们大致平行于CMR课程的Sim的软件设计和文件结构。我是Matlab模拟器。</p><p id="01e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从我们源代码的顶层<a class="ae jp" href="https://github.com/ROSbots/rosbots_driver/tree/master/scripts/examples/coursera_control_of_mobile_robots/part2/full" rel="noopener ugc nofollow" target="_blank">通过。/part2/full文件夹，您会看到以下文件结构:</a></p><pre class="le lf lg lh fq li ka lj lk aw ll dt"><span id="d8cd" class="lm kc hu ka b fv ln lo l lp lq">├── controller<br/>│   ├── controller.py<br/>│   ├── dynamics<br/>│   │   ├── differential_drive.py<br/>│   │   ├── __init__.py<br/>│   ├── go_to_angle.py<br/>│   ├── __init__.py<br/>│   ├── rc_teleop.py<br/>│   ├── robot.py<br/>│   ├── supervisor.py<br/>└── part2_cmr.py</span></pre><p id="17fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jx jy jz ka b">/part2_cmr</code> ROS节点的main()函数在顶层的<code class="eh jx jy jz ka b">part2_cmr.py</code>中。在main()内部，我们创建了一个<code class="eh jx jy jz ka b">Supervisor</code>对象，并通过以下方式每秒调用它的execute()函数两次(2Hz ):</p><figure class="le lf lg lh fq lt fe ff paragraph-image"><div class="fe ff md"><img src="../Images/3ae4ef4fcfece39ae3d593c1e04cd436.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*LASpXAy8h8NbqU64yjVbvg.png"/></div></figure><p id="cbb8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建主管时，它做三件事。</p><ol class=""><li id="3307" class="me mf hu it b iu iv iy iz jc mg jg mh jk mi jo mj mk ml mm dt translated">创建一个<code class="eh jx jy jz ka b">Robot</code>对象</li><li id="b12e" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">创建一个<code class="eh jx jy jz ka b">DifferentialDrive</code>对象。</li><li id="fe9b" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">为定义的目标创建所有需要的控制器对象——在我们的例子中，我们只需要一个控制器对象，即<code class="eh jx jy jz ka b">RCTeleop</code>控制器。</li></ol><p id="e8ad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">控制器决定机器人做什么。例如，您可以创建一个“到达目标”控制器来规划到达特定航路点的路径。您可以创建转向角度控制器，以转向并跟踪特定的角度方向φ。现代汽车有一个速度控制器，又名巡航控制器，用于加速/减速和跟踪特定的速度。</p><p id="f853" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇第2部分的文章中，我们的主管将会有一个遥控独轮车控制器来执行遥控独轮车命令。在初始化时，<code class="eh jx jy jz ka b">RCTeleop</code>订阅了<code class="eh jx jy jz ka b">/part2_cmr/cmd_vel</code>主题并监听<code class="eh jx jy jz ka b">Twist</code>独轮车命令。</p><figure class="le lf lg lh fq lt fe ff paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="fe ff ms"><img src="../Images/73ec7c5a606d698c537141bcc053f632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zq47eAhvsqvIMjCQ8x_3xg.png"/></div></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">rc_teleop.py</figcaption></figure><p id="88ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jx jy jz ka b">self.twist_cb(.)</code>回调函数在<code class="eh jx jy jz ka b">Twist</code>消息到来时被调用，并存储<code class="eh jx jy jz ka b">v</code>和<code class="eh jx jy jz ka b">w</code>速度。</p><figure class="le lf lg lh fq lt fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/7deb8e8edd627e601a1cd4cada84feed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*JX6OaoZsOs8dkhQDTsPcUQ.png"/></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">rc_teleop.py</figcaption></figure><p id="bc95" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当管理者创建<code class="eh jx jy jz ka b">Robot</code>对象时，<code class="eh jx jy jz ka b">Robot</code>对象从<a class="ae jp" href="http://wiki.ros.org/Parameter%20Server" rel="noopener ugc nofollow" target="_blank"> ROS参数服务器</a>获取其轴距和车轮半径的尺寸以及其电机的最小和最大速度(是的，真实的机器人有真实的物理极限)。</p><figure class="le lf lg lh fq lt fe ff paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="fe ff my"><img src="../Images/94c7a0fbfe65a57daa8639ce2bdb678b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3nQF4UsEGD7fmkrLS5iDRQ.png"/></div></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">robot.py</figcaption></figure><p id="e272" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当管理程序创建一个<code class="eh jx jy jz ka b">DifferentialDrive</code>对象时，它会传递轴距和车轮半径测量值，因此<code class="eh jx jy jz ka b">DifferentialDrive</code>对象可以准确地<strong class="it hv">将独轮车前进和角速度输入转换为差动驱动轮速度输入</strong>。</p><p id="8b07" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就是初始化的大部分内容。</p><p id="de93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每次调用<code class="eh jx jy jz ka b">supervisor.execute()</code>时，管理程序执行以下操作:</p><ol class=""><li id="95e6" class="me mf hu it b iu iv iy iz jc mg jg mh jk mi jo mj mk ml mm dt translated">执行当前控制器—<code class="eh jx jy jz ka b">RCTeleop</code>控制器——以获得独轮<code class="eh jx jy jz ka b">v</code>和<code class="eh jx jy jz ka b">w</code>速度。</li><li id="6a72" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">调用<code class="eh jx jy jz ka b">DifferentialDrive</code>将独轮车<code class="eh jx jy jz ka b">v</code>、<code class="eh jx jy jz ka b">w</code>速度转换为<code class="eh jx jy jz ka b">v_r</code>和<code class="eh jx jy jz ka b">v_l</code>车轮速度。</li><li id="c59d" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">将<code class="eh jx jy jz ka b">v_r</code>和<code class="eh jx jy jz ka b">v_l</code>速度传递给<code class="eh jx jy jz ka b">Robot</code>，后者将<code class="eh jx jy jz ka b">Float32</code> ROS消息发布给<code class="eh jx jy jz ka b">/wheel_power_left</code>和<code class="eh jx jy jz ka b">/wheel_power_right</code> ROS主题——指导我们的UNO板转动ROSbots各自的轮子，如我们系列的第1部分所述。</li></ol><figure class="le lf lg lh fq lt fe ff paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="fe ff mz"><img src="../Images/e755c8a90a0c35ddd14faef348ff5a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3kbOaeJSh5lqfViIAoiuFg.png"/></div></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">Each time the Supervisor gets executed: supervisor.py</figcaption></figure><p id="ec8d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jx jy jz ka b">RCTeleop</code>控制器的执行功能只是返回其存储的当前<code class="eh jx jy jz ka b">v</code>和<code class="eh jx jy jz ka b">w</code>。这里没什么令人兴奋的。</p><figure class="le lf lg lh fq lt fe ff paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="fe ff na"><img src="../Images/412589c3a8b753684ed73dc4c244a3f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QXMB7yd3zf-0r1jkaqvODg.png"/></div></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">rc_teleop.py</figcaption></figure><p id="b3f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jx jy jz ka b">DifferentialDrive’s</code> <code class="eh jx jy jz ka b">uni_to_diff(.)</code>功能实现了单轮驱动到差动驱动模式的转换。这是我们两个甜心函数实现的地方。</p><p id="8667" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jx jy jz ka b">Robot</code>的<code class="eh jx jy jz ka b">set_wheel_speed(.)</code>功能有几个重要的职责。</p><ol class=""><li id="189a" class="me mf hu it b iu iv iy iz jc mg jg mh jk mi jo mj mk ml mm dt translated">它将车轮速度限制在电机的物理限制范围内。</li><li id="d290" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated"><strong class="it hv">将车轮速度转换为车轮功率</strong>。如果您还记得第1部分，我们的motor_driver固件只支持在-1.0和1.0之间归一化的车轮功率——全速返回全速前进。<code class="eh jx jy jz ka b">set_wheel_speed(.)</code>功能使用我们之前在ROSbots机器人上测量的空载速度的查找表将速度转换为功率。</li><li id="fac1" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated"><strong class="it hv">我们的电机也有一个最小速度</strong>。有一个最小脉冲宽度阈值，在这个阈值下，电机不会转动。如果控制器希望速度低于这个阈值，电机将无法支持它，所以目前我们只是设置电机速度为零，以节省电力。</li></ol><p id="ea1e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">难道我们不爱真实硬件的凌乱吗？</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="324f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就引出了第2部分的结论。我们已经谈到了单轮模型以及如何将单轮模型输入转换为差分驱动模型输入。我们在ROSbots机器人上使用ROS实现了这个系统，并以遥控操作的方式测试了这个系统。</p><p id="3596" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在下一篇第3部分的文章中，我们将开始实现反馈，这是有效控制系统的关键部分。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="12d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">像往常一样，关注@rosbots on Medium获取更新。在Instagram 和脸书<a class="ae jp" href="https://www.facebook.com/hackrosbots" rel="noopener ugc nofollow" target="_blank">上关注我们吧！</a></p><p id="7adc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">欢迎在此评论或提问。但是如果你有技术问题，请在answers.ros.org上发表(主题“ROSbots question:<em class="nb">blahblah</em>”，标签“ROS bots”)。</p><p id="c5ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想合作，或者只是想打个招呼，请不要犹豫，去寻求一般的反馈。</p><p id="2a92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你还没有这样做，<a class="ae jp" href="https://www.rosbots.com/purchase" rel="noopener ugc nofollow" target="_blank">在这里购买你自己的ROSbots机器人</a>跟着做吧。</p><p id="2a0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">谢谢！<br/>杰克“机器人制造商”</p></div></div>    
</body>
</html>