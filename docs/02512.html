<html>
<head>
<title>How to use python to test your Ethereum Smart Contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用python测试你的以太坊智能合约</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-use-python-for-testing-your-ethereum-smart-contracts-e3d3f4b6e587?source=collection_archive---------18-----------------------#2018-03-20">https://medium.com/hackernoon/how-to-use-python-for-testing-your-ethereum-smart-contracts-e3d3f4b6e587?source=collection_archive---------18-----------------------#2018-03-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/74323663c6f832f531f31405bae9710f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTi22ZcqVADce4SJtIpyBw.jpeg"/></div></div></figure><div class=""/><p id="5c36" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最近开始做以太坊区块链开发。包括solidity语言在内的大多数工具都偏向于javascript。</p><p id="7eb8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当我开始使用<code class="eh ka kb kc kd b">truffle</code>进行测试时，我发现javascript测试(IMO)不必要的太长。</p><p id="36e5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但这就是语言的本质。</p><p id="c1ef" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">比起JS，我一直更喜欢python。我喜欢并在我以前的项目中使用过<code class="eh ka kb kc kd b">py.test</code>。所以当我有机会使用<code class="eh ka kb kc kd b">py.test</code>测试我的智能合约时，我肯定会试一试。</p><p id="e1ab" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就在那时我遇到了<code class="eh ka kb kc kd b">populus</code>。原来它的目标是“给皮托尼斯塔的松露”(我的原话，不是“官方”标语，但他们可以使用它。)</p><p id="ac66" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最初它是一个个人项目——被以太坊组织(在github上)正式采用，为迄今为止所做的出色工作增加了可信度。</p><p id="19da" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在这里阅读官方文档<a class="ae ke" href="http://populus.readthedocs.io/en/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="e18d" class="kf kg if bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">测试</h1><p id="9e67" class="pw-post-body-paragraph jc jd if je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">正如我前面提到的，我来是为了有机会使用<code class="eh ka kb kc kd b">py.test</code>来测试智能合约。</p><p id="1d06" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">编写测试(以及<code class="eh ka kb kc kd b">web3.py</code>)非常容易。</p><p id="939a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在not <code class="eh ka kb kc kd b">populus test</code>(像<code class="eh ka kb kc kd b">truffle test</code>)中运行测试。我前面提到过，是通过<code class="eh ka kb kc kd b">py.test</code>。所以是<code class="eh ka kb kc kd b">py.test &lt;folder_containing_tests&gt;/</code></p><p id="48de" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">..这就是我遇到“小故障”的地方。</p><p id="898a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">原来有一个已知的<a class="ae ke" href="https://github.com/ethereum/populus/issues/431" rel="noopener ugc nofollow" target="_blank">问题</a>和一个<a class="ae ke" href="https://github.com/ethereum/populus/issues/414#issuecomment-352628648" rel="noopener ugc nofollow" target="_blank">解决方案</a></p><p id="1591" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我喜欢使用<code class="eh ka kb kc kd b">py.test</code>的一点是，我不需要明确地<strong class="je ig">开始<code class="eh ka kb kc kd b">testrpc</code></strong></p><p id="d338" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于<code class="eh ka kb kc kd b">truffle test</code> testrpc或<code class="eh ka kb kc kd b">geth</code>需要显式运行。否则，您会得到以下错误:</p><pre class="li lj lk ll fq lm kd ln lo aw lp dt"><span id="d520" class="lq kg if kd b fv lr ls l lt lu">$ truffle test <br/>Could not connect to your Ethereum client. Please check that your Ethereum client: <br/>    - is running <br/>    - is accepting RPC connections (i.e., "--rpc" option is used in geth) <br/>    - is accessible over the network <br/>    - is properly configured in your Truffle configuration file (truffle.js)</span></pre><p id="eadc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我不是说这有什么不对，只是说省略一个步骤是件好事。</p><h1 id="8a1d" class="kf kg if bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">本地链</h1><p id="2a55" class="pw-post-body-paragraph jc jd if je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated"><code class="eh ka kb kc kd b">populus</code>比<code class="eh ka kb kc kd b">truffle</code>更好的一个特性是创建本地<code class="eh ka kb kc kd b">geth</code>实例的能力。</p><p id="d363" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这可以通过<code class="eh ka kb kc kd b">populus chain new &lt;chain_name&gt;</code>轻松完成</p><p id="86a6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这将完成以下几项工作:</p><ul class=""><li id="f5ab" class="lv lw if je b jf jg jj jk jn lx jr ly jv lz jz ma mb mc md dt translated">创建一个<code class="eh ka kb kc kd b">genesis.json</code>(通常需要手工创建，或者从“某处”复制一个现有的并修改)</li><li id="d8a6" class="lv lw if je b jf me jj mf jn mg jr mh jv mi jz ma mb mc md dt translated">创建一个帐户，有足够的余额。</li><li id="2890" class="lv lw if je b jf me jj mf jn mg jr mh jv mi jz ma mb mc md dt translated">创建两个脚本:一个创建创世块(<code class="eh ka kb kc kd b">init_chain.sh</code>)，另一个启动“节点”(<code class="eh ka kb kc kd b">run_chain.sh</code>)</li></ul><p id="4565" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这样做的好处是，新开发人员不需要了解<code class="eh ka kb kc kd b">genesis.json</code>中各种选项的复杂性，也不需要了解<code class="eh ka kb kc kd b">geth</code>的一长串命令行选项</p><p id="760b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它只是工作。</p><p id="99c1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这对半经验丰富开发人员也很有用。她可以根据需要修改<code class="eh ka kb kc kd b">genesis.json</code>和脚本。</p><p id="2c50" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于没有“更改密码”的概念，如果不删除现有帐户并重新创建一个新帐户，就无法创建一个“更好”的密码。这意味着您需要修改<code class="eh ka kb kc kd b">run_chain.sh</code>脚本，因为它提到了一个用于<code class="eh ka kb kc kd b">--unlock</code>参数的帐户。还需要修改<code class="eh ka kb kc kd b">genesis.json</code>，因为<code class="eh ka kb kc kd b">alloc</code>中提到了“预填充”账户。</p><p id="a367" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但这没关系，因为<code class="eh ka kb kc kd b">populus</code>无论如何都是为了开发而设计的。</p><p id="ee2d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">阅读关于使用populus创建本地链的详细教程<a class="ae ke" href="http://populus.readthedocs.io/en/latest/tutorial.part-2.html" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="90ea" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mj">还有</em> <code class="eh ka kb kc kd b"><em class="mj">populus chain reset &lt;chain_name&gt;</em></code> <em class="mj">但是都不行。我已经提出了一个问题</em> <a class="ae ke" href="https://github.com/ethereum/populus/issues/451" rel="noopener ugc nofollow" target="_blank"> <em class="mj">这里</em> </a></p><h1 id="8c83" class="kf kg if bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">部署合同</h1><p id="5289" class="pw-post-body-paragraph jc jd if je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">对于简单的一次性合同，有一个命令行版本:<code class="eh ka kb kc kd b">populus deploy</code></p><p id="81b3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于稍微复杂的部署，尤其是当需要向契约构造函数传递参数时，需要编写自己的python代码。</p><p id="7a8c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这与在<code class="eh ka kb kc kd b">truffle</code>平台上编写迁移脚本没有什么不同，除了在<code class="eh ka kb kc kd b">truffle init</code>平台上有一个“默认”脚本，在这里我们没有。</p><p id="1373" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击阅读详情<a class="ae ke" href="http://populus.readthedocs.io/en/latest/deploy.html" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="2804" class="kf kg if bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">迁移</h1><p id="829d" class="pw-post-body-paragraph jc jd if je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated"><code class="eh ka kb kc kd b">populus</code>旧版本中有此功能，但已被移除。当我在gitter上被问到时，我被告知有一个“把他们带回来”的计划</p><h1 id="3465" class="kf kg if bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">我应该扔掉松露吗？</h1><p id="307a" class="pw-post-body-paragraph jc jd if je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">还没有。</p><p id="32ce" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然我想把<code class="eh ka kb kc kd b">populus</code>作为唯一的选择，但我认为它比<code class="eh ka kb kc kd b">truffle</code>更“成熟”</p><p id="24b1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">目前，我在与他人分享的项目中使用<code class="eh ka kb kc kd b">truffle</code>(因为<code class="eh ka kb kc kd b">truffle</code>似乎更“知名”)，但对于我的“个人”项目，我将继续使用<code class="eh ka kb kc kd b">populus</code>(报告问题，在gitter上讨论，并在可能的情况下发送PR)</p></div><div class="ab cl mk ml hc mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hn ho hp hq hr"><p id="9276" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">注</strong>:你可以在这里查看我的(在制品)代码<a class="ae ke" href="https://github.com/mandarvaze/eth-playground" rel="noopener ugc nofollow" target="_blank">。它既有<code class="eh ka kb kc kd b">truffle</code>也有<code class="eh ka kb kc kd b">populus</code>配置文件。测试只在python中进行。我有一个python的部署脚本。</a></p></div><div class="ab cl mk ml hc mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hn ho hp hq hr"><p id="c0ab" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mj">原载于2018年3月20日</em><a class="ae ke" href="https://mandarvaze.bitbucket.io/posts/populus-ethereum-dev-env/" rel="noopener ugc nofollow" target="_blank"><em class="mj">mandarvaze . bit bucket . io</em></a><em class="mj">。</em></p></div></div>    
</body>
</html>