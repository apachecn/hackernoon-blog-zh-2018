<html>
<head>
<title>Build a simple ChatBot in Python with RASA — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用RASA用Python构建一个简单的聊天机器人——第2部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-simple-chatbot-with-rasa-part-2-16726357b72c?source=collection_archive---------2-----------------------#2018-03-24">https://medium.com/hackernoon/build-simple-chatbot-with-rasa-part-2-16726357b72c?source=collection_archive---------2-----------------------#2018-03-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="88ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们正在建造一个惊人的聊天机器人T2柠檬水T3</p><p id="cbfc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这一部分，我们将致力于“使用<a class="ae jp" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> RASA </a>对话式人工智能解决方案构建一个简单的<a class="ae jp" href="https://chatbotslife.com/" rel="noopener ugc nofollow" target="_blank">聊天机器人</a>”的对话部分。</p><p id="03ed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你还没有读完<a class="ae jp" rel="noopener" href="/p/f4c6d5bb1aea">第一部分</a>，我建议你先读完<a class="ae jp" rel="noopener" href="/p/f4c6d5bb1aea">第一部分</a>，然后再读这一部分。</p><p id="08f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在事情变得有趣了，聊天机器人方面——到目前为止，我们已经建立了NLP部分，现在我们将致力于对话部分。</p><p id="85ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如我在第1部分中提到的，对于每一个实际上不仅仅是回答问题的聊天机器人，最基本的是一个支持“槽填充”的聊天机器人，这意味着(在我们的例子中)与用户进行交互，以获得它需要的强制槽(根据“域定义”，不要担心我们稍后会谈到这一点)。</p><p id="5ecb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一种插槽填充场景可能是:</p><ul class=""><li id="4850" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">用户:“我要披萨”；#缺少的槽:[大小、配料等。]</li><li id="770f" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">bot:“什么尺寸？”</li><li id="ca83" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">用户:“大”</li><li id="6a16" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">机器人:“你想要哪种配料？”</li><li id="8cf2" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">用户:“橄榄”</li></ul><p id="ea0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本例中，我们与用户有2次交互— 2个空位需要填充。</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><a href="https://www.eventbrite.com/e/chatbot-conference-tickets-45884424549?utm-medium=discovery&amp;utm-campaign=social&amp;utm-content=attendeeshare&amp;aff=escb&amp;utm-source=cp&amp;utm-term=listing"><div class="fe ff ke"><img src="../Images/35e0d9f511d0fa9382350bf887b167ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oyftTzPL9qaCYc8z2EbcHg.png"/></div></a></figure><h2 id="759b" class="km kn hu bd ko kp kq kr ks kt ku kv kw jc kx ky kz jg la lb lc jk ld le lf lg dt translated">建立对话</h2><p id="4bb8" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">类似于我们在NLU中构建的(上面提到的第1部分),我们应该创建域和训练数据。</p><h2 id="e99c" class="km kn hu bd ko kp kq kr ks kt ku kv kw jc kx ky kz jg la lb lc jk ld le lf lg dt translated">构建域</h2><p id="2162" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">这里我们将创建文件chat_domail.yml。</p><p id="4895" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以使用该文件:</p><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="lm ln l"/></div></figure><p id="36c5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意最后一个——更多信息在下面的解释部分。</p><p id="da3f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，如果您创建了自己的格式或更改了这个格式，验证格式总是一个好的做法(这是一个脆弱的格式，如果您破坏了它，它将无法工作):</p><p id="8626" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="http://www.yamllint.com/" rel="noopener ugc nofollow" target="_blank">将</a>链接到在线yml验证。</p><p id="9b7b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们试着解释一下上面的文件。</p><ul class=""><li id="35e6" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">意图——是父结构，通常是bot支持的动作(但也有例外)</li><li id="e3ec" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">实体—是您希望机器人从自由文本中提取的单词</li><li id="b5d1" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">slots——在这里定义它们，就像通过对话告诉机器人要跟踪哪些实体，例如，如果用户说:“我想要比萨饼”，我们希望机器人与用户交互，以获得“大小”或“浇头”槽。</li><li id="5dcf" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">动作——或者是话语，这意味着我们要发送给用户的输出，或者你可以实际创建你自己的固有形式动作的类。在我们的例子中，它是:“动作。ActionOrderPizza”，这里再次说明Rasa有一个非常酷的界面，你应该从Action类中固有并根据你的需要在派生类中添加你的逻辑，这里有一个例子——创建文件<strong class="it hv"> action.py </strong>:</li></ul><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="lm ln l"/></div></figure><h1 id="51c0" class="lo kn hu bd ko lp lq lr ks ls lt lu kw lv lw lx kz ly lz ma lc mb mc md lf me dt translated">前3名机器人教程</h1><blockquote class="mf"><p id="cda3" class="mg mh hu bd mi mj mk ml mm mn mo jo ek translated"><a class="ae jp" href="https://chatbotslife.com/best-chatbot-platforms-to-build-a-chatbot-13b846a59ddd" rel="noopener ugc nofollow" target="_blank"> 1。打造聊天机器人的最佳聊天机器人平台</a></p><p id="fa69" class="mg mh hu bd mi mj mk ml mm mn mo jo ek translated"><a class="ae jp" href="https://chatbotslife.com/build-simple-chatbot-with-rasa-part-1-f4c6d5bb1aea" rel="noopener ugc nofollow" target="_blank"> 2。使用RASA在Python中构建简单的聊天机器人—第1部分</a></p><p id="8940" class="mg mh hu bd mi mj mk ml mm mn mo jo ek translated"><a class="ae jp" href="https://chatbotslife.com/how-i-developed-my-own-learning-chatbot-in-python-from-scratch-and-deployed-it-on-facebook-88bc828be0a8" rel="noopener ugc nofollow" target="_blank"> 3。我如何用Python开发我自己的“学习”聊天机器人</a></p></blockquote><p id="bab4" class="pw-post-body-paragraph ir is hu it b iu mp iw ix iy mq ja jb jc mr je jf jg ms ji jj jk mt jm jn jo hn dt translated">在上面的例子中，我将它创建为“stubs ”,这里没有真正的逻辑，只是为了举例。</p><h2 id="0255" class="km kn hu bd ko kp kq kr ks kt ku kv kw jc kx ky kz jg la lb lc jk ld le lf lg dt translated">为对话建立训练数据</h2><p id="a111" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">在这里，我们将构建一个标记文件，我们将其命名为:stories.md，顾名思义，我们将可能的对话流描述为用户故事。</p><p id="26aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，你可能会担心这是一个非常手工的过程，但不要担心RASA有一个很好的工具来在线训练你的对话！或者甚至更多的加载预先训练好的对话。</p><p id="c768" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但首先让我们创建一个非常短的基本流程，并训练对话模型，稍后我们将回到在线训练。</p><p id="9697" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于基本流程，您可以使用这个文件stories.md:</p><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="lm ln l"/></div></figure><p id="a109" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，在上述流程中，我们涵盖了以下场景:</p><ol class=""><li id="7e74" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo mu jw jx jy dt translated">Bot:“你好，有什么可以帮你的吗？”</li><li id="630c" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo mu jw jx jy dt translated">用户:“我想要比萨饼”#缺少槽:“大小”和“配料”</li><li id="af6e" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo mu jw jx jy dt translated">Bot:“什么尺寸？”</li><li id="35ca" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo mu jw jx jy dt translated">用户:“大”</li><li id="3ae9" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo mu jw jx jy dt translated">机器人:“你的比萨饼想要什么配料？”</li><li id="8765" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo mu jw jx jy dt translated">用户:“奶酪”</li></ol><p id="9387" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们准备用上面的训练数据训练一段对话。</p><p id="9e99" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们写一些代码，你可以使用这个文件:</p><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="lm ln l"/></div></figure><p id="29a9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在运行:</p><pre class="kf kg kh ki fq mv mw mx my aw mz dt"><span id="6699" class="km kn hu mw b fv na nb l nc nd">python dialogue_model.py</span></pre><p id="661d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意:上面的代码在Python3上运行没有错误，但是由于某种原因，我在Python2上遇到了一些问题。</p><p id="d0eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果一切顺利，您应该已经训练好了模型，输出在models/dialogue/下，应该是这样的:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="fe ff ne"><img src="../Images/ddd12f99c566021047e8af6c7e8c7b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pbafPhE0tBz1NdJx4I2Vrw.png"/></div></div></figure><p id="dc3d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们已经为在线培训做好了准备！耶！！！</p><p id="827b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如我所承诺的，RASA有一个惊人的能力来在线训练你的机器人，并创建一个更详细的stories.md文件供你在线训练课程结束后使用。</p><p id="b9e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在创建online_train.py:</p><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="lm ln l"/></div></figure><p id="7287" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不，我们已经准备好了:</p><pre class="kf kg kh ki fq mv mw mx my aw mz dt"><span id="e4b3" class="km kn hu mw b fv na nb l nc nd">python online_train.py</span></pre><p id="9e59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您应该获得一个交互式会话，在该会话中，您应该遵循预期的流程，例如:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="fe ff nj"><img src="../Images/bf2e78d75ff2a04f11434218684b984a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JlC2xdqmgsh4RZbQEOglRQ.png"/></div></div></figure><ol class=""><li id="6fad" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo mu jw jx jy dt translated">在第一条绿线中，它表示bot已经加载，正在等待用户输入。</li><li id="bad5" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo mu jw jx jy dt translated">接下来我们输入:“嗨”</li><li id="5ccb" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo mu jw jx jy dt translated">现在您可以看到系统打印了“聊天记录”:</li></ol><ul class=""><li id="28f9" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">我们可以看到流程是正确的:</li><li id="e2de" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">机器人做了:动作_听</li><li id="889e" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">用户说:嗨</li><li id="c602" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">其意图是:问候</li></ul><p id="cab3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.现在，系统正在等待您的反馈，在这种情况下，流程是正确的，所以我们应该键入:2。</p><p id="e367" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.当您完成输入“0”以导出新的stories.md文件(给它一个新的名称，例如:“stories_v1.md”)时，您可以继续这样做。</p><p id="da3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在替换以前的故事文件(首先备份它！)或者将它们连接在同一个stories文件中，这样您将拥有越来越多的训练数据！</p><p id="ed65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就这样—现在最后一部分是测试它—更多内容将在后面……</p><p id="f491" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请随时在此提问或前往相关的gitter部分:</p><div class="nk nl fm fo nm nn"><a href="https://gitter.im/RasaHQ/rasa_core" rel="noopener  ugc nofollow" target="_blank"><div class="no ab ej"><div class="np ab nq cl cj nr"><h2 class="bd hv fv z el ns eo ep nt er et ht dt translated">RasaHQ/rasa_core</h2><div class="nu l"><h3 class="bd b fv z el ns eo ep nt er et ek translated">用于对话软件的基于机器学习的对话引擎</h3></div><div class="nv l"><p class="bd b gc z el ns eo ep nt er et ek translated">gitter.im</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob kk nn"/></div></div></a></div><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="oc ln l"/></div></figure><div class="kf kg kh ki fq ab cb"><figure class="od kj oe of og oh oi paragraph-image"><a href="https://chatbotslife.com/bot-communities-mastermind-group-d2dae9876709#.53x0py6ou"><img src="../Images/5ba109d060e9ddce34a21e4f057bd981.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*6XUspT9JOSq0w0Fi35HIaA.png"/></a></figure><figure class="od kj oe of og oh oi paragraph-image"><a href="https://m.me/ChatbotsLife"><img src="../Images/6669d4d26338491b6b15930d8dacd0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*c1LDMH5vbnIz9rmAka8Hwg.png"/></a></figure><figure class="od kj oe of og oh oi paragraph-image"><a href="https://chatbotslife.com/how-to-get-a-free-chatbot-b1fb9dfe109#.z9dtp2sy0"><img src="../Images/e0380c5cd23de0f8fa7b9457c952cc8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*D0Jf3dI6ZThtqcfwDYY7mg.png"/></a></figure></div><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="oc ln l"/></div></figure></div></div>    
</body>
</html>