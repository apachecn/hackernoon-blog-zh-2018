<html>
<head>
<title>Publish Custom Metrics to AWS CloudWatch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将自定义指标发布到AWS CloudWatch</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/publish-custom-metrics-to-aws-cloudwatch-18cb3bbff17c?source=collection_archive---------8-----------------------#2018-03-24">https://medium.com/hackernoon/publish-custom-metrics-to-aws-cloudwatch-18cb3bbff17c?source=collection_archive---------8-----------------------#2018-03-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/823ffda9fc68a5cd20fab3095565841c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RCS5TG_MmAFsbEIU1Jj4bg.jpeg"/></div></div></figure><div class=""/><p id="e110" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> AWS自动缩放组</strong>只能根据<strong class="je ig"> CloudWatch </strong>中的指标进行缩放，大多数默认指标不足以用于<em class="ka">预测缩放</em>。这就是为什么您需要将您的自定义指标发布到CloudWatch。</p><p id="19cc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我像往常一样在网上冲浪，我找不到任何谈论如何向AWS CloudWatch发布自定义指标的帖子，而且因为我是一个<em class="ka"> Gopher </em>，所以我把手弄脏了，我用Go编写了自己的脚本。</p><p id="5019" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以使用<a class="ae kb" href="https://github.com/aws/aws-sdk-go-v2" rel="noopener ugc nofollow" target="_blank"> AWS Go SDK </a>将自己的指标发布到<strong class="je ig"> CloudWatch </strong>:</p><figure class="kc kd ke kf fq hw"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="e515" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如，要收集关于内存的指标，您可以解析命令'<em class="ka"> free -m' </em>的输出，或者使用第三方库，如<em class="ka"> gopsutil </em>:</p><figure class="kc kd ke kf fq hw"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="32ca" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> memoryMetrics </strong>对象公开了多个指标:</p><ul class=""><li id="0c0a" class="ki kj if je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated">使用的内存</li><li id="df83" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">可用内存</li><li id="7dba" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">缓冲</li><li id="faf6" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">交换缓存</li><li id="a068" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">页面表格</li><li id="60c6" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">等等</li></ul><p id="e097" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">每个指标都将发布一个<strong class="je ig"> InstanceID维度</strong>。要获得实例id，您可以查询<strong class="je ig">元数据</strong>:</p><figure class="kc kd ke kf fq hw"><div class="bz el l di"><div class="kg kh l"/></div></figure><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div class="fe ff kw"><img src="../Images/24318e02e45ae0d6980ffa707c594fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/0*Z4WPdEkmD5lEMMmX."/></div></figure><p id="051e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果我不是<strong class="je ig">地鼠</strong>怎么办？嗯，不要害怕，我构建了一个简单的<a class="ae kb" href="https://github.com/mlabouardy/mon-put-instance-data" rel="noopener ugc nofollow" target="_blank"> CLI </a>，它不需要安装任何<strong class="je ig"> Go </strong>知识或依赖项(<a class="ae kb" href="https://aws.amazon.com/code/amazon-cloudwatch-monitoring-scripts-for-linux/" rel="noopener ugc nofollow" target="_blank"> AWS CloudWatch监控脚本</a>需要Perl依赖项)，而且它是跨平台的。</p><p id="752b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">CLI收集以下指标:</p><ul class=""><li id="a47f" class="ki kj if je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated"><strong class="je ig">内存</strong>:利用率，已用，可用。</li><li id="0dd7" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><strong class="je ig">交换</strong>:利用、已用、空闲。</li><li id="6715" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><strong class="je ig">磁盘</strong>:利用率、已用、可用。</li><li id="a858" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><strong class="je ig">网络</strong>:包入/出，字节入/出，错误入/出。</li><li id="fa7f" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><strong class="je ig"> Docker </strong>:每容器内存&amp; cpu。</li></ul><p id="bdcc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> CLI </strong>已经在使用以下<strong class="je ig">ami</strong>(64位版本)的实例上进行了测试:</p><ul class=""><li id="6ba5" class="ki kj if je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated">亚马逊Linux</li><li id="a066" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">亚马逊Linux 2</li><li id="204b" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">Ubuntu 16.04</li><li id="c9eb" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">微软视窗服务器</li></ul><p id="ebca" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，找到适合您的实例的<a class="ae kb" href="https://github.com/mlabouardy/mon-put-instance-data" rel="noopener ugc nofollow" target="_blank">包</a>并下载它。对于linux:</p><figure class="kc kd ke kf fq hw"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="5237" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">安装CLI后，您可能需要将可执行文件的路径添加到您的<strong class="je ig"> PATH </strong>变量中。然后，发出以下命令:</p><blockquote class="kx ky kz"><p id="9d55" class="jc jd ka je b jf jg jh ji jj jk jl jm la jo jp jq lb js jt ju lc jw jx jy jz hn dt translated">mon-put-instance-data-内存-交换-网络docker间隔1</p></blockquote><p id="ef52" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面的命令将收集<em class="ka">内存</em>、<em class="ka">交换</em>、<em class="ka">网络</em>、&amp;、<em class="ka"> docker容器</em>当前系统上的资源利用率。</p><p id="840f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意:确保一个<strong class="je ig"> IAM角色</strong>与您的实例相关联，验证它授予执行<em class="ka">cloud watch:PutMetricData</em>的权限。</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ld"><img src="../Images/1a01f2b400cdc0eef02b71f2f9107b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7fXXTxd3hlGyZt_U."/></div></div></figure><p id="f919" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">既然我们已经将自定义指标写入了<strong class="je ig"> CloudWatch </strong>。您可以使用<strong class="je ig"> AWS管理控制台</strong>查看您发布的指标的统计图表:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff le"><img src="../Images/67bae9508664a1ec6cb1908e57975a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZqhPlvntKtCQ6ZHs."/></div></div></figure><p id="ee19" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以根据这些指标创建自己的交互式动态<strong class="je ig">仪表盘</strong>:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lf"><img src="../Images/9d32eac492e1ce05f6d4059e8d34478d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AczIsRib6tr9nDmU."/></div></div></figure><p id="308f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">希望有帮助！CLI仍处于早期阶段，因此欢迎您为GitHub上的项目做出贡献。</p></div></div>    
</body>
</html>