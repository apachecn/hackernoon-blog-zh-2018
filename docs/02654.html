<html>
<head>
<title>Serverless and Flogo: A Perfect Match</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器和Flogo:一个完美的匹配</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/serverless-and-flogo-a-perfect-match-aea01117f21f?source=collection_archive---------19-----------------------#2018-03-24">https://medium.com/hackernoon/serverless-and-flogo-a-perfect-match-aea01117f21f?source=collection_archive---------19-----------------------#2018-03-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/95c14164a032279864728e3ffb55def5.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*_fL5kaU_ARoczQ_uG1wMrQ.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">Flynn loves Lambda!</figcaption></figure><p id="95bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我每天都在使用<a class="ae ka" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>微服务，这些是我自己使用的服务，也是我帮助我们的客户构建的服务，以利用无服务器带给你的<a class="ae ka" href="https://image.slidesharecdn.com/cmp211-getting-started-with-se-7ec83976-5aaa-4bc2-8e5d-c6c623f31df1-446724172-171201041452/95/cmp211getting-started-with-serverless-architectures-4-638.jpg?cb=1512146620" rel="noopener ugc nofollow" target="_blank">好处</a>。由于许多服务需要部署和持续更新，我发现自己一遍又一遍地做着同样的事情。最让我沮丧的是那个特定的任务；它并不像我想象的那样完美。</p><p id="e997" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本文中，我将向您介绍我是如何缩短开发时间并使部署像在公园散步一样容易重复的——这要归功于<a class="ae ka" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>和一个名为<a class="ae ka" href="http://www.flogo.io/" rel="noopener ugc nofollow" target="_blank"> Project Flogo </a>的工具的组合。</p><h1 id="6702" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">弗洛戈是什么？</h1><p id="d1df" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我猜你知道无服务器框架，但是你可能不知道什么是Flogo。嗯，Flogo是一个<em class="le">超轻边缘微服务框架</em>！既然我们已经把标语说清楚了，那就让我们稍微解释一下这句话。Flogo是用go编写的，现在你可以在Lambda上运行Go，你可以很容易地打包你的服务并在Lambda上运行它。Flogo为您提供了一个可视化的环境来设计您的服务，这个环境过于简化，意味着您将一堆活动(比如向Amazon SNS发送消息)放在一行中，并在事件发生时执行它们。</p><p id="6399" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">与无服务器框架一起，您可以配置哪些事件应该触发它，在哪里部署它，以及允许它在不进入AWS控制台的情况下使用哪种资源。我个人感到非常兴奋的是，配置管理是多么容易，您可以多么容易地将您的服务转移到一个新的阶段。</p><h1 id="56fd" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">先决条件</h1><p id="6876" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在本教程中，我将带您创建您的应用程序，以及使用无服务器部署它。</p><p id="f3c4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您需要具备:</p><ol class=""><li id="2cc0" class="lf lg hu je b jf jg jj jk jn lh jr li jv lj jz lk ll lm ln dt translated"><a class="ae ka" href="https://serverless.com/framework/docs/providers/aws/guide/quick-start/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>和<a class="ae ka" href="https://golang.org/doc/install" rel="noopener ugc nofollow" target="_blank">安装完毕</a></li><li id="3206" class="lf lg hu je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated">一个<a class="ae ka" href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS账户</a></li></ol><p id="b2d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="le">如果你还没有完成，这些链接会引导你完成这些步骤。</em></p><h1 id="09d2" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">安装项目Flogo CLI</h1><p id="3bdf" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">为了构建Flogo应用程序，我们将使用Flogo CLI。</p><p id="accd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">像这样安装它:</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="0377" class="mc kc hu ly b fv md me l mf mg">go get -u github.com/TIBCOSoftware/flogo-cli/...</span></pre><p id="85a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了简化依赖性管理，我们使用Go <code class="eh mh mi mj ly b">dep</code>工具。(请注意，<code class="eh mh mi mj ly b">dep</code>强烈建议使用在<a class="ae ka" href="https://github.com/golang/dep/releases" rel="noopener ugc nofollow" target="_blank">版本</a>页面上提供的二进制版本。)</p><h1 id="f7f4" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建您的应用</h1><p id="94a0" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">由于<code class="eh mh mi mj ly b">dep</code>的工作方式，您需要从您的<code class="eh mh mi mj ly b">${GOPATH}/src</code>目录中执行命令。</p><p id="b8c9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们创建一个名为<code class="eh mh mi mj ly b">serverlesslambdaapp</code>的目录:</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="c78b" class="mc kc hu ly b fv md me l mf mg">cd $GOPATH/src</span><span id="2924" class="mc kc hu ly b fv mk me l mf mg">mkdir serverlesslambdaapp</span></pre><p id="5289" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">以及该目录中的一个<code class="eh mh mi mj ly b">flogo.json</code>文件:</p><figure class="lt lu lv lw fq iv"><div class="bz el l di"><div class="ml mm l"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">A Flogo app, ready for Lambda</figcaption></figure><p id="b408" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完成后，您只需要一个命令就可以将它转换成一个Flogo应用程序，稍后您可以使用它来构建可执行文件:</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="3bc6" class="mc kc hu ly b fv md me l mf mg">flogo create -f flogo.json lambda</span></pre><p id="6c13" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面的命令将创建一个名为<code class="eh mh mi mj ly b">lambda</code>的目录，找到流的所有依赖项，并下载它们。此命令可能需要几秒钟才能完成。</p><p id="d2f8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们可以从该项目中创建一个可执行文件。要在AWS Lambda中运行，我们需要在应用程序中嵌入<code class="eh mh mi mj ly b">flogo.json</code>以确保没有外部文件依赖。(您仍然可以使用环境变量，但是我们将在另一个教程中介绍。)</p><p id="1865" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Lambda的触发器包含事件信息，利用Makefile来构建和压缩应用程序。所以让我们跑吧:</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="d915" class="mc kc hu ly b fv md me l mf mg">cd lambda</span><span id="c3d4" class="mc kc hu ly b fv mk me l mf mg">flogo build -e -shim my_lambda_trigger</span></pre><p id="2d69" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<code class="eh mh mi mj ly b">flogo build</code>命令之后，<code class="eh mh mi mj ly b">./src/lambda</code>中有两个重要文件。一个文件叫做<em class="le">handler . zip</em>；这是一个压缩的可执行文件，你可以上传到Lambda。另一个简称为<em class="le">处理程序</em>，是解压后的版本。</p><p id="3ec3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然您完全可以使用AWS提供的命令行工具来部署您的应用程序，甚至手动上传，但自动化这一部分要容易得多——尤其是当您的应用程序变得更加复杂时。这就是为什么我喜欢❤的无服务器架构</p><h1 id="bf1f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">使用无服务器部署应用</h1><p id="d0ba" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">无服务器团队在简化部署和打包方面做得非常出色。从这里你只需要几步。</p><p id="2fd9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">第一件事是在与您的<code class="eh mh mi mj ly b">flogo.json</code>文件相同的文件夹中创建一个新的无服务器服务(如果您按照命令进行了操作，您应该还在那里:-):</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="7495" class="mc kc hu ly b fv md me l mf mg"># Let’s create a serverless service with the same name as the app</span><span id="2b5c" class="mc kc hu ly b fv mk me l mf mg">serverless create -u <a class="ae ka" href="https://github.com/retgits/flogo-serverless" rel="noopener ugc nofollow" target="_blank">https://github.com/retgits/flogo-serverless</a> -p serverlesslambdaapp</span></pre><p id="16d5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下一步是将<em class="le">处理程序</em>复制到新创建的无服务器文件夹中:</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="83b7" class="mc kc hu ly b fv md me l mf mg">cp src/lambda/handler serverlesslambdaapp/handler</span></pre><p id="7c45" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这将是用任何bucket名称、IAM角色、环境变量或您想要配置的任何东西来更新您的<code class="eh mh mi mj ly b">serverless.yml</code>文件的理想时机，因为剩下的唯一事情就是部署！</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="a109" class="mc kc hu ly b fv md me l mf mg"># To package up your function before deploying run</span><span id="28dd" class="mc kc hu ly b fv mk me l mf mg">cd serverlesslambdaapp</span><span id="fade" class="mc kc hu ly b fv mk me l mf mg">serverless package</span><span id="3636" class="mc kc hu ly b fv mk me l mf mg"># To deploy, which also does the packaging, your function run</span><span id="39b6" class="mc kc hu ly b fv mk me l mf mg">cd serverlesslambdaapp</span><span id="2c94" class="mc kc hu ly b fv mk me l mf mg">serverless deploy</span></pre><p id="b074" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">*注意:不幸的是，这只适用于Linux或macOS系统，或者使用Linux的Windows子系统(WSL)时。这是因为Windows开发人员可能很难生成一个将二进制文件标记为可在Linux上执行的zip文件。查看<a class="ae ka" href="https://github.com/aws/aws-lambda-go" rel="noopener ugc nofollow" target="_blank">此处</a>了解更多信息)。</p><h1 id="c8eb" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">测试1… 2… 3…</h1><p id="68a3" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">让我们测试这个应用程序，以确保它真正部署到Lambda并正确运行。</p><p id="a291" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">登录AWS并选择“Lambda”后，您将看到目前为止已经部署的所有功能。其中一个应该叫<code class="eh mh mi mj ly b">serverlesslambdaapp-dev-hello</code>之类的。</p><p id="4718" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击它，你会看到你的功能概述，包括一个写着“测试”的大按钮。单击“测试”配置新的测试事件(任何输入都可以)，然后再次单击“测试”运行它。</p><p id="0316" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果一切顺利，为什么不应该呢，您的日志将显示类似于<code class="eh mh mi mj ly b">2018–03–07 00:18:34.735 INFO [activity-tibco-log] — Hello World from Serverless and Flogo</code>的一行</p><figure class="lt lu lv lw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="fe ff mn"><img src="../Images/63a6bddbe902e87e176d0ed078ca2690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tdOZXWN7ONziFpOZQRtOPQ.png"/></div></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">testing…</figcaption></figure><h1 id="fab9" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">想自己试试吗？</h1><p id="2078" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">兴奋地想和<a class="ae ka" href="http://www.flogo.io" rel="noopener ugc nofollow" target="_blank">弗洛戈</a>一起尝试更多的东西？查看我们的<a class="ae ka" href="https://tibcosoftware.github.io/flogo" rel="noopener ugc nofollow" target="_blank">文档</a>或<a class="ae ka" href="http://www.flogo.io/" rel="noopener ugc nofollow" target="_blank">网站</a></p><figure class="lt lu lv lw fq iv"><div class="bz el l di"><div class="ms mm l"/></div></figure></div></div>    
</body>
</html>