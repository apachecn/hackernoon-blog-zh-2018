<html>
<head>
<title>Global HTTP error catching in Angular 4.3+</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular 4.3+中的全局HTTP错误捕获</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/global-http-error-catching-in-angular-4-3-9e15cc1e0a6b?source=collection_archive---------2-----------------------#2018-03-27">https://medium.com/hackernoon/global-http-error-catching-in-angular-4-3-9e15cc1e0a6b?source=collection_archive---------2-----------------------#2018-03-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0a4c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每当你做一个HTTP请求时，都有可能出错。如果事情出错，请求将返回一个带有错误代码的响应。例如，基于这个错误代码，您想要通知用户哪里出错了。现在，如果您可以将这个逻辑放在一个地方，并在任何地方重用它，会不会很方便？请继续阅读！</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/f047f7626266238ced200dc0583b517b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b2Q1sQdU5REdEf53gPyc-w.jpeg"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Photo by <a class="ae kf" href="https://unsplash.com/photos/qzQP8Tbro_Q?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Duffy Brook</a> on <a class="ae kf" href="https://unsplash.com/search/photos/train-interception?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6c37" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您在请求中附加了一个<code class="eh kg kh ki kj b">catch</code>，那么您只能处理<a class="ae kf" href="https://hackernoon.com/tagged/http" rel="noopener ugc nofollow" target="_blank"> http </a>错误。这可能看起来像这样:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="kk kl l"/></div></figure><p id="a69f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当应用程序增长时，HTTP请求的数量也会增加。给每个请求附加一个<code class="eh kg kh ki kj b">catch</code>并不完全是枯燥的。从4.3开始，引入了新的HttpModule，我们终于可以再次使用传统的拦截器了。</p><h1 id="065e" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">使用http拦截器</h1><p id="02a1" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">当使用一个http拦截器时，基本的思想是所有在你的模块中产生的请求都通过这个拦截器路由。这意味着您可以为每个请求自动添加或删除属性。当您与一个受保护的API对话，并且需要在每个请求中发送一个api-key时，这是非常方便的。</p><p id="6f03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为你发出的每个请求都要经过这个拦截器，所以我们也可以使用这个拦截器来捕捉所有作为<code class="eh kg kh ki kj b">HttpErrorResponse</code>实例返回的请求。你应该这样做:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="kk kl l"/></div></figure><p id="119b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们向<code class="eh kg kh ki kj b">HttpHandler</code>发送请求，然后执行请求。在回调函数中，我们检查错误。如果错误是<code class="eh kg kh ki kj b">HttpErrorResponse</code>的一个实例，我们可以将请求发送给一个错误处理程序，它会显示一条关于出错原因的小消息。</p><p id="e017" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在下面的stackblitz中，您可以看到一个完整的工作示例。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lp kl l"/></div></figure><h1 id="8f2c" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">这没有抓住什么</h1><p id="4b9f" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">正如前面几次提到的，这种拦截方式只会捕获带有实例<code class="eh kg kh ki kj b">HttpErrorResponse</code>的http响应。这意味着，如果您在请求中创建了一个<code class="eh kg kh ki kj b">map </code>来格式化您的响应并在其中出错，它将不会捕捉到它。</p><h1 id="c0c5" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">结论</h1><p id="fb2e" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">当您的应用程序非常依赖与外部rest API的交互时，使用这个拦截器设置特别有用。如果API设置正确，当请求不正确时，它会返回一个很好的错误消息。该消息现在可以容易地显示和展示给用户。如果您对Http请求进行了大量的客户端格式化，您仍然应该创建逻辑来处理潜在的错误。</p></div><div class="ab cl lq lr hc ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><h1 id="512e" class="km kn hu bd ko kp lx kr ks kt ly kv kw kx lz kz la lb ma ld le lf mb lh li lj dt translated">在阿姆斯特丹找工作？</h1><p id="0dd6" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">我在Sytac工作，是一名高级前端开发人员，我们正在寻找精通Angular、React、Java或Scala的中级/高级开发人员。Sytac是荷兰一家雄心勃勃的咨询公司，为银行、航空、政府和零售部门的许多知名公司工作。你可以想到荷兰国际集团、荷兰皇家航空公司、德勤公司、阿霍尔德·德尔海兹公司、ABN·AMRO公司、弗洛拉·荷兰公司等等。</p><p id="d569" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从个人的观点来看，Sytac确实与他们的客户组合不同，但也与他们如何照顾他们的员工不同。他们真的很关心员工的福利。除了丰厚的薪水(50K-75k)，你会在与咨询经理的定期会议中注意到这一点，还会从他们组织的活动数量以及他们为让所有员工满意而提供的所有其他津贴中注意到这一点。</p><p id="4936" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你认为自己具备与最优秀的人共事的条件，请发邮件至<a class="ae kf" href="mailto:luuk.gruijs@sytac.io" rel="noopener ugc nofollow" target="_blank"> luuk.gruijs@sytac.io </a>给我，我很乐意告诉你更多。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc kl l"/></div></figure></div></div>    
</body>
</html>