<html>
<head>
<title>Creating Multiple Authentication in Laravel 5.5 Using Middleware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用中间件在Laravel 5.5中创建多重认证</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/laravel-multiple-authentication-80daa855322b?source=collection_archive---------0-----------------------#2018-03-29">https://medium.com/hackernoon/laravel-multiple-authentication-80daa855322b?source=collection_archive---------0-----------------------#2018-03-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7e19" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每个web应用程序都有一组预定义的用户，他们具有不同的角色和权限。为了验证用户，应用程序需要有身份验证模块或功能。使用中间件，您可以很容易地在Laravel中实现多重认证。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/5b1f3f814d00ed11c62a62d235bbc000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RfV8IR1pqa8AoOZyBvVyqg.png"/></div></div></figure><p id="a049" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，我将演示中间件的功能。更具体地说，我将展示如何验证管理员用户和普通用户。</p><h1 id="d44f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">中间件</h1><p id="883b" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">在网络应用中，开发人员经常需要在特定URI的请求命中期间实现一些功能。实际上，它就像开发人员在用户请求和应用程序响应之间放置的层。<strong class="it hv"> Laravel 5.5中间件为此提供了一个非常灵活的应用编程接口</strong>。此外，开发人员可以很快实现定制中间件。他们只需要发射一个指令，拉沃尔就准备好了。自定义逻辑被放在一个函数中，并在应用程序中定义。</p><h1 id="e840" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">先决条件</h1><p id="848d" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">出于本教程的目的，我假设您在web服务器上安装了一个PHP应用程序。我的设置是:</p><ul class=""><li id="5d19" class="le lf hu it b iu iv iy iz jc lg jg lh jk li jo lj lk ll lm dt translated">PHP 7.1</li><li id="1c16" class="le lf hu it b iu ln iy lo jc lp jg lq jk lr jo lj lk ll lm dt translated">关系型数据库</li><li id="46e3" class="le lf hu it b iu ln iy lo jc lp jg lq jk lr jo lj lk ll lm dt translated">Laravel 5.5</li></ul><p id="c8be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了确保我可以专注于教程而不会被服务器设置和管理问题所困扰，我决定将我的Laravel应用程序托管在Cloudways托管服务器上，因为它们负责服务器级别的问题，并且有一个强大的开发堆栈，该堆栈是为托管Laravel 而优化的<a class="ae ls" href="https://www.cloudways.com/en/laravel-hosting.php" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="2c32" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建Laravel项目</h1><p id="cf82" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">如果您在Cloudways之外的主机提供商上或在本地主机上，请打开Command终端并输入以下命令来创建Laravel应用程序:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="7a46" class="ly kc hu lu b fv lz ma l mb mc">composer create-project — prefer-dist laravel/laravel blog “5.5.*”</span></pre><h1 id="e6f3" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">配置数据库</h1><p id="0fd9" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">成功安装Laravel应用程序后，下一步是数据库配置。让我们开门。<strong class="it hv"> env </strong>文件和<strong class="it hv"> config/database.php </strong>文件，并在这些文件中设置数据库凭据。</p><h1 id="5d50" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">设置管理中间件</h1><p id="9864" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">接下来，在数据库/迁移/…user.php中打开用户迁移，并为Admin更新以下字段。</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="b8e2" class="ly kc hu lu b fv lz ma l mb mc">$table-&gt;boolean(‘isAdmin’)-&gt;nullable();</span></pre><h1 id="3d5a" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">运行迁移</h1><p id="71a6" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">创建数据库并添加配置设置后，运行以下命令在数据库中创建表。</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="c909" class="ly kc hu lu b fv lz ma l mb mc">Php artisan migrate</span></pre><h1 id="a2d9" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Laravel Auth</h1><p id="decb" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">Laravel提供了一个用于注册和登录的内置认证系统。只需在终端输入以下命令:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="c44f" class="ly kc hu lu b fv lz ma l mb mc">Php artisan make:auth</span></pre><h1 id="ff81" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建中间件管理员</h1><p id="cf8e" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">通过键入以下Laravel命令创建一个中间件:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="8823" class="ly kc hu lu b fv lz ma l mb mc">php artisan make:middleware Admin</span></pre><p id="6c6e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，转到<strong class="it hv"> app/Http/中间件/admin . PHP。</strong>您会注意到该文件已经包含了Laravel提供的样板代码。在这段代码中，您只需要处理一个函数，即<strong class="it hv">句柄()。</strong>用以下代码更新本功能的代码:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="6989" class="ly kc hu lu b fv lz ma l mb mc">public function handle($request, Closure $next)</span><span id="7d77" class="ly kc hu lu b fv md ma l mb mc">{</span><span id="4c04" class="ly kc hu lu b fv md ma l mb mc">if(auth()-&gt;user()-&gt;isAdmin == 1){</span><span id="220e" class="ly kc hu lu b fv md ma l mb mc">return $next($request);</span><span id="092a" class="ly kc hu lu b fv md ma l mb mc">}</span><span id="48d9" class="ly kc hu lu b fv md ma l mb mc">return redirect(‘home’)-&gt;with(‘error’,’You have not admin access’);</span><span id="5916" class="ly kc hu lu b fv md ma l mb mc">}</span></pre><p id="716b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，在<strong class="it hv"> app/Http/Kernel.php中注册这条路线。</strong>使用以下内容更新$ routeMiddleware属性:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="ce82" class="ly kc hu lu b fv lz ma l mb mc">&lt;?php</span><span id="7102" class="ly kc hu lu b fv md ma l mb mc">// Kernel.php</span><span id="fba2" class="ly kc hu lu b fv md ma l mb mc">protected $routeMiddleware = [</span><span id="5480" class="ly kc hu lu b fv md ma l mb mc">‘auth’ =&gt; \Illuminate\Auth\Middleware\Authenticate::class,</span><span id="b699" class="ly kc hu lu b fv md ma l mb mc">‘auth.basic’ =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,</span><span id="b59f" class="ly kc hu lu b fv md ma l mb mc">‘bindings’ =&gt; \Illuminate\Routing\Middleware\SubstituteBindings::class,</span><span id="4797" class="ly kc hu lu b fv md ma l mb mc">‘can’ =&gt; \Illuminate\Auth\Middleware\Authorize::class,</span><span id="e718" class="ly kc hu lu b fv md ma l mb mc">‘guest’ =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,</span><span id="177e" class="ly kc hu lu b fv md ma l mb mc">‘throttle’ =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,</span><span id="cb71" class="ly kc hu lu b fv md ma l mb mc">‘admin’ =&gt; \App\Http\Middleware\Admin::class,</span><span id="b7ba" class="ly kc hu lu b fv md ma l mb mc">];.</span><span id="2178" class="ly kc hu lu b fv md ma l mb mc">?&gt;</span></pre><h1 id="41c1" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">配置受管理保护的路由</h1><p id="9573" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">接下来，我将为admin创建路由。打开<strong class="it hv"> routes/web.php </strong>文件，在其中输入以下代码:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="5565" class="ly kc hu lu b fv lz ma l mb mc">Route::get(‘admin/routes’, ‘HomeController@admin’)-&gt;middleware(‘admin’);</span></pre><h1 id="78d7" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建控制器</h1><p id="f741" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">让我们打开<strong class="it hv">app/http/controller/home controller</strong>，更新以下方法。</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="2dbf" class="ly kc hu lu b fv lz ma l mb mc">public function index()</span><span id="7392" class="ly kc hu lu b fv md ma l mb mc">{</span><span id="d79f" class="ly kc hu lu b fv md ma l mb mc">return view(‘home’);</span><span id="2e3b" class="ly kc hu lu b fv md ma l mb mc">}</span><span id="56a2" class="ly kc hu lu b fv md ma l mb mc">public function admin()</span><span id="dfe9" class="ly kc hu lu b fv md ma l mb mc">{ return view(‘admin’); }</span></pre><h1 id="4422" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建主视图</h1><p id="0946" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">设置好受保护的管理路径后，打开<strong class="it hv">资源/视图/home.blade.php </strong>文件并更新以下代码:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="4b4c" class="ly kc hu lu b fv lz ma l mb mc">@extends(‘layouts.app’)</span><span id="df2b" class="ly kc hu lu b fv md ma l mb mc">@section(‘content’)</span><span id="3617" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”container”&gt;</span><span id="969d" class="ly kc hu lu b fv md ma l mb mc">@if(\Session::has(‘error’))</span><span id="87f0" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”alert alert-danger”&gt;</span><span id="c17c" class="ly kc hu lu b fv md ma l mb mc">{{\Session::get(‘error’)}}</span><span id="3a75" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;</span><span id="7b8c" class="ly kc hu lu b fv md ma l mb mc">@endif</span><span id="5706" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”row”&gt;</span><span id="9d4b" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”col-md-8 col-md-offset-2"&gt;</span><span id="7330" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”panel panel-default”&gt;</span><span id="3afb" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”panel-heading”&gt;Dashboard&lt;/div&gt;</span><span id="8328" class="ly kc hu lu b fv md ma l mb mc">&lt;?php if(auth()-&gt;user()-&gt;isAdmin == 1){?&gt;</span><span id="2cf9" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”panel-body”&gt;</span><span id="ca85" class="ly kc hu lu b fv md ma l mb mc">&lt;a href=”{{url(‘admin/routes’)}}”&gt;Admin&lt;/a&gt;</span><span id="ebe7" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;&lt;?php } else echo ‘&lt;div class=”panel-heading”&gt;Normal User&lt;/div&gt;’;?&gt;</span><span id="808a" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;</span><span id="640f" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;</span><span id="200a" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;</span><span id="6014" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;</span><span id="bb62" class="ly kc hu lu b fv md ma l mb mc">@endsection</span></pre><p id="b84a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这段代码中，我使用了<strong class="it hv">if(auth()-&gt;user()-&gt;is admin = = 1)</strong>来检查用户配置文件。如果是<strong class="it hv">管理</strong>、<strong class="it hv">、</strong>将导航到管理区。否则，它将重定向到用户区。</p><h1 id="7f77" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建管理视图</h1><p id="1bb3" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">在视图文件夹的<strong class="it hv">根中创建一个名为<strong class="it hv">admin.blade.php</strong>的视图，并向其中添加以下代码:</strong></p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="869b" class="ly kc hu lu b fv lz ma l mb mc">@extends(‘layouts.app’)</span><span id="1ae4" class="ly kc hu lu b fv md ma l mb mc">@section(‘content’)</span><span id="ba52" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”row”&gt;</span><span id="e75b" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”col-md-8 col-md-offset-2"&gt;</span><span id="b5d2" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”panel panel-default”&gt;</span><span id="0554" class="ly kc hu lu b fv md ma l mb mc">&lt;div class=”panel-heading btn-primary”&gt;WELCOME TO ADMIN ROUTE&lt;/div&gt;</span><span id="b557" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;</span><span id="95cd" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;</span><span id="b2cd" class="ly kc hu lu b fv md ma l mb mc">&lt;/div&gt;</span><span id="3edb" class="ly kc hu lu b fv md ma l mb mc">@endsection</span></pre><h1 id="0287" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">管理员授权</h1><p id="1142" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">要设置admin auth，首先通过Laravel register注册一个用户，然后将<strong class="it hv"> isadmin </strong>的状态更改为“1”。接下来，登录应用程序:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff me"><img src="../Images/d3bd4732aafd378f31b5ab599aac25c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XdSgDn9qCnf63YE_."/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mf"><img src="../Images/e10663b64975e893a368784f5cabc14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d2p7sql9-lTuLiie."/></div></div></figure><h1 id="c05a" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">用户授权</h1><p id="b766" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">以下是用户身份验证的结果:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mg"><img src="../Images/ff2b17dd109d7ba22ed624d0f841f203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZM8cl82SQ0Z9IZhB."/></div></div></figure><p id="6020" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望现在您可以轻松地在Laravel项目中设置多重身份验证。如果你需要帮助，请留言，我会尽快回复你！</p></div></div>    
</body>
</html>