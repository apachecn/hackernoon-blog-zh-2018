<html>
<head>
<title>MobX &amp; React for Vuex users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向Vuex用户的MobX和React</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/mobx-react-for-vue-vuex-users-213875717f33?source=collection_archive---------9-----------------------#2018-03-29">https://medium.com/hackernoon/mobx-react-for-vue-vuex-users-213875717f33?source=collection_archive---------9-----------------------#2018-03-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="8a5d" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">或者只是一个不错的MobX教程</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/ab04910bc7cb2a860b2698babc302111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6zF6vXBihR1By6R2."/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Photo by <a class="ae jz" href="https://unsplash.com/@inf1783?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Karsten Würth (@inf1783)</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="2f1e" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">框架战争…不是😜</h2><p id="ee10" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">我从Laracast的<a class="ae jz" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue </a>和<a class="ae jz" href="https://laracasts.com/series/learn-vue-2-step-by-step" rel="noopener ugc nofollow" target="_blank">this</a><strong class="la hv"><em class="lr">amazing</em></strong>系列开始了我的框架仙境之旅。我听说过React，但当时当我看着JSX时，它对我来说似乎是一种憎恶！把html标签和JS逻辑混在一起？他们没听说过设计模式和关注点分离吗？看在上帝的份上，为什么不使用JQuery制作一些闪烁的文本呢？</p><p id="0bbf" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">但是后来我学习了JS，不是<em class="lr"> JQuery JS* ( </em>用DOM耍把戏)，而是JS作为一种开发语言，一种优雅的表达工具来操纵数据，一种用漂亮的方法来处理数组、字符串和对象的语言。你不能用香草JS做的事情很可能有一个<a class="ae jz" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> Lodash </a>来做，或者<em class="lr">肯定有一个NPM包。(<code class="eh lx ly lz ma b">npm install make-me-a-sandwich</code> Lol！)</em></p><p id="1517" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">在这一切之后，我又看了一眼React我立刻爱上了它！其中Vue有点像添加了功能的html(<code class="eh lx ly lz ma b">v-if, v-for...</code>)JSX是普通的JS，恰好生成DOM。实际上，我并不想在这里挑起一场框架之战。我目前在生产中使用Vue和React应用程序，并且我已经能够在这两个框架上找到我工作所需的所有工具。这个选择实际上取决于个人偏好或者你的公司/团队的偏好。</p><h2 id="d050" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">但是反应过来…</h2><p id="ce4e" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">对于一个React初学者来说，似乎Redux是Vue的默认商店，因此我决定学习Redux……在看了完整的egghead系列大约3遍并浏览了同样多遍文档后，我仍然觉得我不知道自己在做什么。除了微不足道的缩减器之外，任何东西都是令人头疼的。规范化数据、关系表、不变性和DB技术，它们看起来都是Redux的先决条件！我确实学到了很多，但还不足以让我觉得有所收获。然后是Redux和高阶函数的包装器，以生成其他函数和reducer配方…我感觉自己又像一个实习生，无法完成我的项目，因为我不知道如何拥有一个简单的商店，并让我的应用程序<em class="lr">对它做出反应</em>！😥</p><p id="9319" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">我敢肯定，有很多比我更聪明的开发人员使用Redux非常高效。我尊敬你，老师！</p><p id="06b7" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">我怀念Vuex的日子，在那里一切都可以正常工作，可变状态不是罪恶，无论我在哪里调用商店操作，整个应用程序总是同步的。但是我也很喜欢React，所以我开始尝试在React上使用Vuex，(显然不能)，但是在搜索中我遇到了MobX。它肯定有大胆的主张:</p><blockquote class="mb mc md"><p id="3820" class="ky kz lr la b lb ls iv ld le lt iy lg me lu li lj mf lv ll lm mg lw lo lp lq hn dt translated">MobX通过解决根本问题使状态管理再次变得简单:它使得不可能产生不一致的状态。<a class="ae jz" href="https://mobx.js.org/getting-started.html" rel="noopener ugc nofollow" target="_blank"> * </a></p></blockquote><p id="aad4" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">我再次前往egghead观看视频教程。他们很好，但运气不好！不支持装饰者，没有装饰者你不会有很多例子来说明如何做事。然后还有<code class="eh lx ly lz ma b">mobx-state-tree</code>声称很有主见(那是轻描淡写！)而且，我不知道如何做事，也不知道发生了什么！这些视频教我如何制作一个相当不错的柜台，T2感觉我正在编写一个企业银行应用程序，但是我找不到中等难度的。</p><p id="696c" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">我真的很喜欢React，所以我回到Redux，但无法让它工作，所以，我再次不情愿地给了MobX另一个尝试...<em class="lr">我终于看到了光明；就像雾已经消散了一样</em></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/3613ce4d777f0945fc633765e2df6dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*koiFprO2RWUqwfsYqgAvzw.gif"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Shameless Disney plug!</figcaption></figure><p id="430d" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">我想让你看看MobX比你想象的更容易使用。我们将使用MobX做更多的事情，而不仅仅是向上和向下计数，并且比<code class="eh lx ly lz ma b">mobx-state-tree</code>实现更简单。</p><h2 id="0add" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">商店</h2><p id="72db" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">我们将制作一个简单的商店，从我目前正在做的项目中提取。在其中，我们将有一个学生列表和一个课程列表，我们将能够从一个课程中注册和取消注册学生。</p><p id="b462" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">起点是一个干净的<code class="eh lx ly lz ma b">create-react-app</code> app，这里是<code class="eh lx ly lz ma b">store.js</code>:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="fec6" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">🙄不要让长度吓到你，它实际上很简单，学生和课程的方法是一样的。</p><p id="9459" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">在MobX术语中，有<strong class="la hv">可观察的</strong>，观察变化的<em class="lr">，以及观察</em>变化的<strong class="la hv">观察者</strong>，观察的<em class="lr">。接下来就是魔法了相当神奇！</em></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/ac2ce5554e34f2d26df006591fd8d55b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/1*tPwg5uNT2iRjz6_4XkgmRg.gif"/></div></figure><p id="8d98" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">首先我们简单地将<code class="eh lx ly lz ma b">const store</code>声明为<code class="eh lx ly lz ma b">observable()</code>的第一个参数。* <em class="lr">这就是你如何声明一个不使用修饰语法的可观察对象(</em> <code class="eh lx ly lz ma b"><em class="lr">@observable</em></code> <em class="lr">)。</em></p><p id="5fc2" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">在传递给<code class="eh lx ly lz ma b">observable()</code>的对象中，有三个地方可以存放数据:<em class="lr">学生</em>、<em class="lr">课程、</em>和<em class="lr">注册、</em>以及那些被定义为<code class="eh lx ly lz ma b">observable.map()</code>的。如果这是你第一次遇到<a class="ae jz" href="https://mobx.js.org/refguide/map.html" rel="noopener ugc nofollow" target="_blank">地图</a>，不要担心，它只是一个奇特的对象，有一个很好的方法来访问其中的内容(setters和getters)。在普通的JS对象中，数据是这样访问的:<code class="eh lx ly lz ma b">object.key1.key2</code>或<code class="eh lx ly lz ma b">object['key1']['key2']</code>，在地图上，你可以这样访问:<code class="eh lx ly lz ma b">object.get('key1').get('key2')</code>。这有几个好处，在这个特别的项目中，它让我不用使用大量的<code class="eh lx ly lz ma b">_.set()</code>和<code class="eh lx ly lz ma b">_.assign()</code>(来自Lodash)。</p><p id="a23a" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">然后是添加、更新和删除学生和课程的存储方法。它们只是简单的带有一些错误处理的<code class="eh lx ly lz ma b">.set()</code>。</p><p id="d9d5" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">下一个有趣的地方是注册处理。这个想法确实有一种冗余的味道(<a class="ae jz" href="https://redux.js.org/recipes/structuring-reducers/normalizing-state-shape#relationships-and-tables" rel="noopener ugc nofollow" target="_blank">关系和表</a>)，在这种情况下很有用。我正在创建一个对象，它的键等于课程ID，值是注册学生ID的数组。看起来是这样的:</p><pre class="jk jl jm jn fq ml ma mm mn aw mo dt"><span id="a9f7" class="ka kb hu ma b fv mp mq l mr ms">{<br/>   course1: ['student1', 'student2', 'student3'],<br/>   course2: ['student4', 'student5', 'student6'],<br/>}</span></pre><p id="74f1" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">动作发生在<code class="eh lx ly lz ma b">enrolledStudents</code>方法中。我们来分解一下:它返回一个<code class="eh lx ly lz ma b">computed(() =&gt; {...})</code>函数，这是一个MobX表达式，用来观察其内部元素的变化，并自动更新其值。没什么特别的。接下来，它获取注册映射中与作为参数传递的课程ID相匹配的元素，这将返回学生ID的数组。然后通过数组中的一个<code class="eh lx ly lz ma b">.map()</code>用每个学生的ID替换整个学生对象。请注意，最后一个单独的<code class="eh lx ly lz ma b">.get()</code>应用于<code class="eh lx ly lz ma b">computed()</code>并获得实际数据。<br/>因此<code class="eh lx ly lz ma b">enrolledStudents</code>方法的结果是一个数组，包含了所有注册了特定课程的学生的对象，抱歉，是一个<em class="lr">可观察数组</em>，因此函数中数据的任何变化都会更新其返回值并进行适当的重新渲染！🤩</p><p id="bbac" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">下面是一个简单的React组件来展示这一点:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="0bc5" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">这是一个非常标准的React组件，除了<code class="eh lx ly lz ma b">observer</code>和<code class="eh lx ly lz ma b">store</code>。</p><p id="808f" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">首先，定义几个学生和一门课程，并将其添加到存储中。然后<code class="eh lx ly lz ma b">student1</code>注册了这个课程。接下来，我们使用我想要的学生列表的课程ID，通过来自商店的<code class="eh lx ly lz ma b">enrolledStudents</code>方法进行映射，结果与预期一致。</p><p id="e2aa" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">当你按下“注册学生2”按钮时，有趣的部分发生了。<br/>在商店中，学生ID被添加到相应课程地图的数组中，MobX负责保持所有内容的同步，正确地<em class="lr">计算</em><code class="eh lx ly lz ma b">enrolledStudents</code><em class="lr">、</em>的值，并进行适当的重新渲染。所有这一切都是因为L39，我们将<code class="eh lx ly lz ma b">StudentsList</code>包裹在<code class="eh lx ly lz ma b">observer()</code>中！</p><p id="1cfd" class="pw-post-body-paragraph ky kz hu la b lb ls iv ld le lt iy lg kl lu li lj kp lv ll lm kt lw lo lp lq hn dt translated">请注意，您的组件可以通过多种方式访问存储。您可以从文件中导入组件，就像前面的例子一样，您可以从父容器中将它作为道具传递下去，或者您可以使用<code class="eh lx ly lz ma b">mobx-react</code> provider/inject实用程序(在我的例子中，我可以在需要时导入<code class="eh lx ly lz ma b">store</code>)。</p><h2 id="92b7" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">结论</h2><p id="0acd" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">MobX感觉确实有点不可思议，当我最终理解它时，它就像一股新鲜空气冲进了我的React开发中！(那是对上图的引用)。希望你在探索它的过程中获得乐趣，并继续制作酷的、棒的东西！😎</p></div></div>    
</body>
</html>