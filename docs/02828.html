<html>
<head>
<title>Bunyan simple JSON logging library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">班扬简单JSON日志库</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/bunyan-simple-json-logging-library-1bb1d856c8e5?source=collection_archive---------12-----------------------#2018-03-29">https://medium.com/hackernoon/bunyan-simple-json-logging-library-1bb1d856c8e5?source=collection_archive---------12-----------------------#2018-03-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="22ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">想知道如何删除你的nodeJS代码中的console.logs？我们将使用测井仪。bunyan logger可以简单地以JSON格式将消息记录到不同的流中。</p><h1 id="dec8" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">装置</h1><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="dd63" class="kw jq hu ks b fv kx ky l kz la">npm install bunyan</span></pre><h1 id="1f72" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">创建日志文件</h1><p id="d2a0" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">安装班扬后创建一个文件。在我的例子中，我创建了一个名为<em class="lg"> logger.js </em>的文件。首先包括班扬图书馆。</p><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="6012" class="kw jq hu ks b fv kx ky l kz la"><strong class="ks hv">//logger.js<br/>var </strong>bunyan = require('bunyan');</span></pre><p id="fb21" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后使用createLogger方法创建记录器。</p><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="1dad" class="kw jq hu ks b fv kx ky l kz la">var log = bunyan.createLogger({<br/>    name: 'myapp',<br/>    stream: process.stdout,<br/>    level: 'info'<br/>});</span><span id="8a79" class="kw jq hu ks b fv lh ky l kz la">log.info("This is logging");</span></pre><p id="44e6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您运行这个文件，您将在控制台中看到类似这样的输出。</p><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="52c6" class="kw jq hu ks b fv kx ky l kz la">{“name”:”myapp”,”hostname”:”ChamaraL”,”pid”:28027,”level”:30,”msg”:”This is logging”,”time”:”2018–03–29T15:15:33.715Z”,”v”:0}</span></pre><p id="86c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">班扬日志记录是JSON。一些字段会自动添加:“pid”、“主机名”、“时间”和“v”。</p><p id="aa6e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在bunyan日志库中定义了几个日志级别。</p><ul class=""><li id="1615" class="li lj hu it b iu iv iy iz jc lk jg ll jk lm jo ln lo lp lq dt translated"><em class="lg">致命”(60):服务/应用将停止或变得不可用。运营商应该尽快调查此事。</em></li><li id="07cc" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><em class="lg">“错误”(50):对于特定的请求是致命的，但是服务/应用程序继续为其他请求服务。操作员应该很快就会看到这一点。</em></li><li id="a43f" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><em class="lg">“警告”(40):关于操作员最终可能会看到的东西的注释。</em></li><li id="ac3a" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><em class="lg">“信息”(30):常规操作的详细信息。</em></li><li id="bd2f" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><em class="lg">“debug”(20):其他任何内容，即过于冗长而无法包含在“info”级别中。</em></li><li id="c8b8" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><em class="lg">“trace”(10):从你的应用使用的外部库进行日志记录或者非常详细的应用日志记录。</em></li></ul><p id="fec1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">参赛:https://github.com/trentm/node-bunyan#levels</p><p id="4f8e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以根据需要指定日志级别。</p><p id="a57c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在bunyan中有一个很酷的特性叫做Streams，它允许我们使用不同的流来记录我们的输出。假设我想将所有错误记录到一个外部日志文件和信息级日志(标准输出的操作细节),那么我们可以如下使用流。</p><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="a934" class="kw jq hu ks b fv kx ky l kz la"><strong class="ks hv">var </strong>bunyan = require('bunyan');<br/>var log = bunyan.createLogger({<br/>    name: "bunyan-log",<br/>    streams: [<br/>        {<br/>            level: 'debug',<br/>            stream: process.stdout // log INFO and above to stdout<br/>        },<br/>        {<br/>            level: 'error',<br/>            path: __dirname + '/logs/appError.log' // log ERROR and above to a file<br/>        }<br/>    ]<br/>});<br/><br/>module.exports = log;</span></pre><p id="707b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如上所述，您可以在列表中定义多个流。当日志级别为error时，我将它保存到一个名为appError.log的文件中。如果级别为debug，我将它输出到标准输出中。</p><p id="dbec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我是如何在代码中使用日志记录器的</p><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="3c04" class="kw jq hu ks b fv kx ky l kz la"><strong class="ks hv">let </strong>mongoose = require('mongoose');<br/><strong class="ks hv">let </strong>config = require('./config');<br/><strong class="ks hv">let </strong>logger = require('./../../utils/logger'); //path to my logger <br/><br/><strong class="ks hv">class </strong>Database {<br/><br/>    constructor() {<br/>        <strong class="ks hv">this</strong>._connect();<br/>    }<br/><br/>    _connect() {<br/>        mongoose.connect(`mongodb://${config.server}/${config.database}`)<br/>            .then(() =&gt; {<br/>                logger.debug('Database connection successful'); //logs the info<br/>            })<br/>            .catch(err =&gt; {<br/>                logger.error('Database connection error' + err); //logs the error<br/>            });<br/>    }<br/>}<br/><br/>module.exports = <strong class="ks hv">new </strong>Database();</span></pre><p id="3205" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种方式比在代码中到处写console.log()要好，这不是一种好的做法。</p><p id="33b0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过这样的配置，您将在日志文件中获得所有错误，而其他常规输出以JSON格式显示在控制台中。</p><p id="3e06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您需要更多细节和更多功能，请参考<a class="ae lw" href="https://github.com/trentm/node-bunyan" rel="noopener ugc nofollow" target="_blank">https://github.com/trentm/node-bunyan</a></p></div></div>    
</body>
</html>