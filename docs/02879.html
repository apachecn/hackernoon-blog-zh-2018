<html>
<head>
<title>Metflix: Because You Watched X</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">因为你看了X</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/metflix-because-you-watched-x-26fe9bdfca7f?source=collection_archive---------10-----------------------#2018-03-31">https://medium.com/hackernoon/metflix-because-you-watched-x-26fe9bdfca7f?source=collection_archive---------10-----------------------#2018-03-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/e6704a02656e0a4027d32d4124f85320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jlQxemlP9Yim_rWTqlCFDQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Netflix because you watched feature</figcaption></figure><h1 id="25fc" class="jg jh hu bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">我们在哪里？</h1><p id="19cf" class="pw-post-body-paragraph ke kf hu kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">这是我们到目前为止所做的</p><ul class=""><li id="d925" class="lc ld hu kg b kh le kl lf kp lg kt lh kx li lb lj lk ll lm dt translated">在<a class="ae ln" rel="noopener" href="/all-things-ai/metflix-how-to-recommend-movies-part-0-f128bc4fcccc">第0部分</a>，我们从<a class="ae ln" href="https://grouplens.org/datasets/movielens/" rel="noopener ugc nofollow" target="_blank"> MovieLens </a>下载了我们的数据，做了一些EDA并创建了我们的用户项目矩阵。矩阵有671个独立用户，9066部独立电影，稀疏度为98.35%</li><li id="b372" class="lc ld hu kg b kh lo kl lp kp lq kt lr kx ls lb lj lk ll lm dt translated">在<a class="ae ln" rel="noopener" href="/all-things-ai/metflix-how-to-recommend-movies-part-1-98ae30127033">第一部分</a>中，我们描述了3种最常见的推荐方法:基于用户的协同过滤、基于项目的协同过滤和矩阵分解</li><li id="cae4" class="lc ld hu kg b kh lo kl lp kp lq kt lr kx ls lb lj lk ll lm dt translated">在<a class="ae ln" href="https://hackernoon.com/metflix-how-to-recommend-movies-part-2-54d2b6cfed13" rel="noopener ugc nofollow" target="_blank"> part 2 </a>中，我们通过ALS实现了矩阵分解，找到了类似的电影</li><li id="8a06" class="lc ld hu kg b kh lo kl lp kp lq kt lr kx ls lb lj lk ll lm dt translated">在第3部分中，我们根据用户对电影的评价向他们推荐电影。我们还试图复制网飞的“因为你看了X”功能，并为热门电影做一个完整的页面推荐</li></ul><h1 id="1c5f" class="jg jh hu bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">向用户推荐电影</h1><p id="ac9b" class="pw-post-body-paragraph ke kf hu kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">我们从<em class="lt">隐式</em>库中获取我们训练ALS模型的代码。以前加载和处理数据的代码可以在本系列以前的文章中找到，或者在我的<a class="ae ln" href="https://github.com/maviator/metflix" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="bebe" class="md jh hu lz b fv me mf l mg mh">model = implicit.als.AlternatingLeastSquares(factors=10,<br/>                                             iterations=20,<br/>                                             regularization=0.1,<br/>                                             num_threads=4)</span><span id="463d" class="md jh hu lz b fv mi mf l mg mh">model.fit(user_item.T)</span></pre><p id="88f5" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated">首先，让我们编写一个函数，返回特定用户评价过的电影</p><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="0693" class="md jh hu lz b fv me mf l mg mh">def get_rated_movies_ids(user_id, user_item, users, movies):<br/>   “””<br/>   Input<br/>   -----</span><span id="e2be" class="md jh hu lz b fv mi mf l mg mh">   user_id: int<br/>      User ID</span><span id="d691" class="md jh hu lz b fv mi mf l mg mh">   user_item: scipy.Sparse Matrix<br/>      User item interaction matrix</span><span id="2968" class="md jh hu lz b fv mi mf l mg mh">   users: np.array<br/>      Mapping array between user ID and index in the user item       matrix</span><span id="a1ed" class="md jh hu lz b fv mi mf l mg mh">   movies: np.array<br/>      Mapping array between movie ID and index in the user item matrix</span><span id="829d" class="md jh hu lz b fv mi mf l mg mh">  Output<br/>  -----</span><span id="5b4e" class="md jh hu lz b fv mi mf l mg mh">   movieTableIDs: python list<br/>      List of movie IDs that the user had rated</span><span id="ef37" class="md jh hu lz b fv mi mf l mg mh">  “””<br/>  user_id = users.index(user_id)<br/>  # Get matrix ids of rated movies by selected user<br/>  ids = user_item[user_id].nonzero()[1]<br/>  # Convert matrix ids to movies IDs<br/>  movieTableIDs = [movies[item] for item in ids]</span><span id="b661" class="md jh hu lz b fv mi mf l mg mh">  return movieTableIDs</span><span id="f2c3" class="md jh hu lz b fv mi mf l mg mh">movieTableIDs = get_rated_movies_ids(1, user_item, users, movies)<br/>rated_movies = pd.DataFrame(movieTableIDs, columns=[‘movieId’])<br/>rated_movies</span></pre><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/d1a5a6e12aa2a56027f4a75355f11429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fTF6ux8jGyz8LsrIg-ybMA.png"/></div></div></figure><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="94fe" class="md jh hu lz b fv me mf l mg mh">def get_movies(movieTableIDs, movies_table):<br/>   “””<br/>   Input<br/>   -----</span><span id="d108" class="md jh hu lz b fv mi mf l mg mh">   movieTableIDs: python list<br/>      List of movie IDs that the user had rated</span><span id="1859" class="md jh hu lz b fv mi mf l mg mh">   movies_table: pd.DataFrame<br/>      DataFrame of movies info</span><span id="7d2c" class="md jh hu lz b fv mi mf l mg mh">   Output<br/>   -----</span><span id="7671" class="md jh hu lz b fv mi mf l mg mh">   rated_movies: pd.DataFrame<br/>      DataFrame of rated movies</span><span id="393d" class="md jh hu lz b fv mi mf l mg mh">   “””</span><span id="fd93" class="md jh hu lz b fv mi mf l mg mh">   rated_movies = pd.DataFrame(movieTableIDs, columns=[‘movieId’])</span><span id="475a" class="md jh hu lz b fv mi mf l mg mh">   rated_movies = pd.merge(rated_movies, movies_table, on=’movieId’, how=’left’)</span><span id="2a94" class="md jh hu lz b fv mi mf l mg mh">   return rated_movies</span><span id="b1c6" class="md jh hu lz b fv mi mf l mg mh"><br/>movieTableIDs = get_rated_movies_ids(1, user_item, users, movies)<br/>df = get_movies(movieTableIDs, movies_table)<br/>df</span></pre><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/fbd4227727b60a2791c58c790356d265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f2ZlLeKnBohDle96XumtAQ.png"/></div></div></figure><p id="c0f8" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated">现在，让我们根据用户对电影的评价，为特定的用户ID推荐电影ID。</p><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="dd54" class="md jh hu lz b fv me mf l mg mh">def recommend_movie_ids(user_id, model, user_item, users, movies, N=5):<br/>   “””<br/>   Input<br/>   -----</span><span id="d63e" class="md jh hu lz b fv mi mf l mg mh">   user_id: int<br/>      User ID</span><span id="bbb2" class="md jh hu lz b fv mi mf l mg mh">   model: ALS model<br/>      Trained ALS model</span><span id="2c5e" class="md jh hu lz b fv mi mf l mg mh">   user_item: sp.Sparse Matrix<br/>      User item interaction matrix so that we do not recommend already rated movies</span><span id="fb3c" class="md jh hu lz b fv mi mf l mg mh">   users: np.array<br/>      Mapping array between User ID and user item index</span><span id="d415" class="md jh hu lz b fv mi mf l mg mh">   movies: np.array<br/>      Mapping array between Movie ID and user item index</span><span id="132e" class="md jh hu lz b fv mi mf l mg mh">   N: int (default =5)<br/>      Number of recommendations</span><span id="7423" class="md jh hu lz b fv mi mf l mg mh">   Output<br/>   -----</span><span id="48b0" class="md jh hu lz b fv mi mf l mg mh">   movies_ids: python list<br/>      List of movie IDs<br/>   “””</span><span id="2ad5" class="md jh hu lz b fv mi mf l mg mh">   user_id = users.index(user_id)</span><span id="3370" class="md jh hu lz b fv mi mf l mg mh">   recommendations = model.recommend(user_id, user_item, N=N)</span><span id="d5d1" class="md jh hu lz b fv mi mf l mg mh">   recommendations = [item[0] for item in recommendations]</span><span id="b952" class="md jh hu lz b fv mi mf l mg mh">   movies_ids = [movies[ids] for ids in recommendations]</span><span id="7df0" class="md jh hu lz b fv mi mf l mg mh">   return movies_ids</span><span id="4c6f" class="md jh hu lz b fv mi mf l mg mh">movies_ids = recommend_movie_ids(1, model, user_item, users, movies, N=5)<br/>movies_ids</span><span id="3978" class="md jh hu lz b fv mi mf l mg mh">&gt; [1374, 1127, 1214, 1356, 1376]</span><span id="4a85" class="md jh hu lz b fv mi mf l mg mh">movies_rec = get_movies(movies_ids, movies_table)<br/>movies_rec</span></pre><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/80912a6e6d1cd39a2d5fe6bb5fc154fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKa2AYxeJOfJ818fuyoI2Q.png"/></div></div></figure><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="3212" class="md jh hu lz b fv me mf l mg mh">display_posters(movies_rec)</span></pre><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mp"><img src="../Images/c5d0a4ed93eb5804680f08366da2aab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qP-V2wEpKFpPKAsafTAZng.png"/></div></div></figure><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="214d" class="md jh hu lz b fv me mf l mg mh">movies_ids = recommend_movie_ids(100, model, user_item, users, movies, N=7)<br/>movies_rec = get_movies(movies_ids, movies_table)<br/>display_posters(movies_rec)</span></pre><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mq"><img src="../Images/a2d234d92453ff7b8cde7dad0bbad251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DM2ZX4nYjNDig2KgNucWYA.png"/></div></div></figure><h1 id="00b8" class="jg jh hu bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">因为你看了</h1><p id="cb76" class="pw-post-body-paragraph ke kf hu kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">让我们实现网飞的“因为你看了”功能。而是根据你看过的内容推荐电影。这类似于我们已经做的，但这一次，它更有选择性。我们将这样做:我们将随机选择用户看过的5部电影，并为每部电影推荐相似的电影。最后，我们将它们全部显示在一个页面布局中</p><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="7394" class="md jh hu lz b fv me mf l mg mh">def similar_items(item_id, movies_table, movies, N=5):<br/>     “””<br/>     Input<br/>     -----<br/>     item_id: int<br/>       MovieID in the movies table</span><span id="c795" class="md jh hu lz b fv mi mf l mg mh">     movies_table: DataFrame<br/>       DataFrame with movie ids, movie title and genre</span><span id="f96b" class="md jh hu lz b fv mi mf l mg mh">     movies: np.array<br/>       Mapping between movieID in the movies_table and id in the item user matrix</span><span id="bccb" class="md jh hu lz b fv mi mf l mg mh">     N: int<br/>       Number of similar movies to return</span><span id="49f1" class="md jh hu lz b fv mi mf l mg mh">     Output<br/>     -----<br/>     df: DataFrame<br/>       DataFrame with selected movie in first row and similar movies for N next rows<br/>     “””</span><span id="1fbb" class="md jh hu lz b fv mi mf l mg mh">    # Get movie user index from the mapping array<br/>    user_item_id = movies.index(item_id)<br/>    # Get similar movies from the ALS model<br/>    similars = model.similar_items(user_item_id, N=N+1) <br/>    # ALS similar_items provides (id, score), we extract a list of ids<br/>    l = [item[0] for item in similars[1:]]<br/>    # Convert those ids to movieID from the mapping array<br/>    ids = [movies[ids] for ids in l]<br/>    # Make a dataFrame of the movieIds<br/>    ids = pd.DataFrame(ids, columns=[‘movieId’])<br/>    # Add movie title and genres by joining with the movies table<br/>    recommendation = pd.merge(ids, movies_table, on=’movieId’, how=’left’)</span><span id="134b" class="md jh hu lz b fv mi mf l mg mh">    return recommendation</span><span id="3820" class="md jh hu lz b fv mi mf l mg mh">def similar_and_display(item_id, movies_table, movies, N=5):</span><span id="ed21" class="md jh hu lz b fv mi mf l mg mh">     df = similar_items(item_id, movies_table, movies, N=N)</span><span id="3d61" class="md jh hu lz b fv mi mf l mg mh">     df.dropna(inplace=True)</span><span id="9bb0" class="md jh hu lz b fv mi mf l mg mh">     display_posters(df)</span><span id="d535" class="md jh hu lz b fv mi mf l mg mh">def because_you_watched(user, user_item, users, movies, k=5, N=5):<br/>     “””<br/>     Input<br/>     -----<br/>     user: int<br/>       User ID</span><span id="50aa" class="md jh hu lz b fv mi mf l mg mh">     user_item: scipy sparse matrix<br/>       User item interaction matrix</span><span id="8bbb" class="md jh hu lz b fv mi mf l mg mh">     users: np.array<br/>       Mapping array between User ID and user item index</span><span id="b34c" class="md jh hu lz b fv mi mf l mg mh">     movies: np.array<br/>       Mapping array between Movie ID and user item index</span><span id="c8bc" class="md jh hu lz b fv mi mf l mg mh">     k: int<br/>       Number of recommendations per movie</span><span id="6617" class="md jh hu lz b fv mi mf l mg mh">     N: int<br/>       Number of movies already watched chosen</span><span id="d80d" class="md jh hu lz b fv mi mf l mg mh">     “””</span><span id="40a7" class="md jh hu lz b fv mi mf l mg mh">     movieTableIDs = get_rated_movies_ids(user, user_item, users, movies)<br/>     <br/>     df = get_movies(movieTableIDs, movies_table)</span><span id="83e5" class="md jh hu lz b fv mi mf l mg mh">     movieIDs = random.sample(df.movieId, N)</span><span id="52e2" class="md jh hu lz b fv mi mf l mg mh">     for movieID in movieIDs:<br/>        title = df[df.movieId == movieID].iloc[0].title<br/>        print(“Because you’ve watched “, title)<br/>        similar_and_display(movieID, movies_table, movies, k)</span><span id="ca89" class="md jh hu lz b fv mi mf l mg mh">because_you_watched(500, user_item, users, movies, k=5, N=5)</span></pre><p id="8f15" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》《肯定，也许(2008)》</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/128817885136e464b97ee73eede00799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9YhbVJeZ3HK6FSBrrdtIhQ.png"/></div></div></figure><p id="95f4" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》《风中奇缘》(1995) </strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ms"><img src="../Images/0a224c77739f3965b77b65b8c8a8f296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKBl0GPMYP2KpeP_rHeqbg.png"/></div></div></figure><p id="9871" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">“因为你看了”，《辛普森一家电影》(2007)</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/9c016f7e246539bc0093a8d2a2dbdb58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sd47SpBPmZYE2wwzwLP0sw.png"/></div></div></figure><p id="658a" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》《有本事你来抓我》(2002)</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mu"><img src="../Images/5a8c85be8df9a27a0d526e0af7c3802e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AtkQ3CLsIkWMFIaDQRO89g.png"/></div></div></figure><p id="af50" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》，《冒险的事业》(1983)</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/c5c64906296db9a45ac4c47216492e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oeo9idldgh9Dp16mNWfySA.png"/></div></div></figure><h1 id="288d" class="jg jh hu bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">热门电影</h1><p id="105d" class="pw-post-body-paragraph ke kf hu kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">让我们也实现趋势电影。在我们的上下文中，趋势电影是用户评价最高的电影</p><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="eda5" class="md jh hu lz b fv me mf l mg mh">def get_trending(user_item, movies, movies_table, N=5):<br/>   “””<br/>   Input<br/>   -----</span><span id="0085" class="md jh hu lz b fv mi mf l mg mh">   user_item: scipy sparse matrix<br/>     User item interaction matrix to use to extract popular movies</span><span id="2a37" class="md jh hu lz b fv mi mf l mg mh">   movies: np.array<br/>     Mapping array between movieId and ID in the user_item matrix</span><span id="6917" class="md jh hu lz b fv mi mf l mg mh">   movies_table: pd.DataFrame<br/>     DataFrame for movies information</span><span id="2ab7" class="md jh hu lz b fv mi mf l mg mh">   N: int<br/>     Top N most popular movies to return</span><span id="06d7" class="md jh hu lz b fv mi mf l mg mh">   “””</span><span id="ce56" class="md jh hu lz b fv mi mf l mg mh">   binary = user_item.copy()<br/>   binary[binary !=0] = 1</span><span id="fc00" class="md jh hu lz b fv mi mf l mg mh">   populars = np.array(binary.sum(axis=0)).reshape(-1)</span><span id="6d0f" class="md jh hu lz b fv mi mf l mg mh">   movieIDs = populars.argsort()[::-1][:N]</span><span id="7089" class="md jh hu lz b fv mi mf l mg mh">   movies_rec = get_movies(movieIDs, movies_table)</span><span id="a305" class="md jh hu lz b fv mi mf l mg mh">   movies_rec.dropna(inplace=True)</span><span id="e53f" class="md jh hu lz b fv mi mf l mg mh">   print(“Trending Now”)</span><span id="0333" class="md jh hu lz b fv mi mf l mg mh">   display_posters(movies_rec)</span><span id="14e1" class="md jh hu lz b fv mi mf l mg mh">get_trending(user_item, movies, movies_table, N=6)</span></pre><p id="e68f" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated">当前趋势</p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/6bc3021a2d25713b56f049f5bd5dc0ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ygBIE5LS1JvqSNGParyggw.png"/></div></div></figure><h1 id="610d" class="jg jh hu bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">页面推荐</h1><p id="5911" class="pw-post-body-paragraph ke kf hu kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">让我们把一切都放在一个时间轴方法中。时间线方法将获取用户ID，并根据用户观看过的类似电影显示热门电影和推荐。</p><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="89cd" class="md jh hu lz b fv me mf l mg mh">def my_timeline(user, user_item, users, movies, movies_table, k=5, N=5):</span><span id="6df3" class="md jh hu lz b fv mi mf l mg mh">     get_trending(user_item, movies, movies_table, N=N)</span><span id="ff50" class="md jh hu lz b fv mi mf l mg mh">     because_you_watched(user, user_item, users, movies, k=k, N=N)</span><span id="8d3a" class="md jh hu lz b fv mi mf l mg mh">my_timeline(500, user_item, users, movies, movies_table, k=5, N=5)</span></pre><p id="ce7b" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">当前趋势</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/6bc3021a2d25713b56f049f5bd5dc0ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ygBIE5LS1JvqSNGParyggw.png"/></div></div></figure><p id="c94d" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》、‘肯定，也许(2008)’</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/128817885136e464b97ee73eede00799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9YhbVJeZ3HK6FSBrrdtIhQ.png"/></div></div></figure><p id="fd14" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》，《风中奇缘》(1995)</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ms"><img src="../Images/0a224c77739f3965b77b65b8c8a8f296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKBl0GPMYP2KpeP_rHeqbg.png"/></div></div></figure><p id="6f1a" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》，《辛普森一家电影》(2007)</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/9c016f7e246539bc0093a8d2a2dbdb58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sd47SpBPmZYE2wwzwLP0sw.png"/></div></div></figure><p id="4db6" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》《有本事你来抓我》(2002)</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mu"><img src="../Images/5a8c85be8df9a27a0d526e0af7c3802e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AtkQ3CLsIkWMFIaDQRO89g.png"/></div></div></figure><p id="ce13" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated"><strong class="kg hv">《因为你看了》，《冒险事业(1983)》</strong></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/c5c64906296db9a45ac4c47216492e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oeo9idldgh9Dp16mNWfySA.png"/></div></div></figure><h1 id="a06e" class="jg jh hu bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">导出用于生产的训练模型</h1><p id="0e21" class="pw-post-body-paragraph ke kf hu kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">此时，我们希望将我们的模型投入生产。我们希望创建一个web服务，其中用户将向服务提供一个用户id，服务将返回所有的推荐，包括趋势和“因为你看过”。</p><p id="34d2" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated">为此，我们首先导出训练好的模型和使用过的数据，以便在web服务中使用。</p><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="a93a" class="md jh hu lz b fv me mf l mg mh">import scipy.sparse</span><span id="2f75" class="md jh hu lz b fv mi mf l mg mh">scipy.sparse.save_npz(‘model/user_item.npz’, user_item)</span><span id="4003" class="md jh hu lz b fv mi mf l mg mh">np.save(‘model/movies.npy’, movies)<br/>np.save(‘model/users.npy’, users)<br/>movies_table.to_csv(‘model/movies_table.csv’, index=False)</span><span id="033f" class="md jh hu lz b fv mi mf l mg mh">from sklearn.externals import joblib<br/>joblib.dump(model, ‘model/model.pkl’)</span></pre><h1 id="4386" class="jg jh hu bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">结论</h1><p id="9461" class="pw-post-body-paragraph ke kf hu kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在本帖中，我们根据用户的电影评级历史向他们推荐电影。从那里，我们试图克隆网飞的“因为你看了”功能，并显示热门电影作为被评为次数最多的电影。在下一篇文章中，我们将尝试把我们的工作放在一个web服务中，用户通过提供其用户ID来请求电影推荐。</p><p id="fb28" class="pw-post-body-paragraph ke kf hu kg b kh le kj kk kl lf kn ko kp mj kr ks kt mk kv kw kx ml kz la lb hn dt translated">敬请期待！</p></div></div>    
</body>
</html>