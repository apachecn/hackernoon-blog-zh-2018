<html>
<head>
<title>Going live with Google Cloud Compute Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌云计算引擎上线</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/going-live-with-google-cloud-compute-engine-70542da89aa8?source=collection_archive---------3-----------------------#2018-04-01">https://medium.com/hackernoon/going-live-with-google-cloud-compute-engine-70542da89aa8?source=collection_archive---------3-----------------------#2018-04-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/e157fc4628747c6835c4fd8130d3c790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fr8uNJcQSbS_5J48gCtdA.jpeg"/></div></div></figure><p id="41a0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<a class="ae ka" href="https://hackernoon.com/trials-and-tribulations-of-google-cloud-hosting-a-tutorial-26395eb25636" rel="noopener ugc nofollow" target="_blank">之前的文章</a>中，我们看到了使用谷歌的应用<a class="ae ka" href="https://hackernoon.com/tagged/engine" rel="noopener ugc nofollow" target="_blank">引擎</a>上线是多么容易。我们还了解到，从长远来看，这样做的代价会有多大。对于初创企业和中小型企业来说，一个更简单、更便宜的解决方案是谷歌的计算引擎。</p></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><blockquote class="ki kj kk"><p id="39d5" class="jc jd kl je b jf jg jh ji jj jk jl jm km jo jp jq kn js jt ju ko jw jx jy jz hn dt translated"><strong class="je hv">免责声明</strong>:这个话题是针对熟悉或者不回避某个终端的开发者。</p></blockquote><p id="de6e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在讨论这个话题时，我最常听到的问题是:“App Engine和Compute Engine有什么区别？”。一个过于简单的答案是，App Engine提供开箱即用的魔法，而Compute Engine让您实现自己的魔法。</p><p id="f90d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一个更深入的答案是:</p><ul class=""><li id="bece" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">App Engine是一个<strong class="je hv">平台即服务</strong>，您只需在其中部署代码，它就会自动处理其他更复杂的系统，比如扩展。</li><li id="f876" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated">计算引擎是一个<strong class="je hv">基础设施即服务</strong>，其中所有配置都由您(开发人员)提供。操作系统、服务器设置、扩展、SSL…所有这些都将手动处理。</li></ul><p id="ad6d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于所有的体力劳动，你确实有一些主要的好处，其中两个是:灵活性和成本。</p><p id="1da4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请<a class="ae ka" href="https://hackernoon.com/trials-and-tribulations-of-google-cloud-hosting-a-tutorial-26395eb25636" rel="noopener ugc nofollow" target="_blank">阅读上一篇文章</a>以便创建您的<a class="ae ka" href="https://hackernoon.com/tagged/google" rel="noopener ugc nofollow" target="_blank"> Google </a>云项目并安装Google Cloud SDK。从现在开始，让我们再次假设我们是example.com的所有者。</p><p id="34c1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">转到您的<code class="eh ld le lf lg b">Google Cloud / Compute Engine / VM instances</code>部分并选择<strong class="je hv">创建实例</strong>。从这里开始，您应该:</p><ul class=""><li id="ee48" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">给你的实例起一个名字(<strong class="je hv">警告:</strong>它不能轻易改变，所以给它起一个好名字)</li><li id="d8f3" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated">选择一个区域——这决定了你的数据存储在哪里，以及你将拥有怎样的计算能力(详情<a class="ae ka" href="https://cloud.google.com/compute/docs/regions-zones/" rel="noopener ugc nofollow" target="_blank">此处</a>)。请不要以为这一步会影响总成本…有些区域比其他区域更贵。</li><li id="1a0b" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated">选择CPU——这也会影响成本。在我们的例子中，我们将选择最小的(微1共享vCPU，具有0.6GB RAM，也称为<em class="kl">f1-微</em>)</li><li id="c090" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated">选择操作系统—选择一个您熟悉/熟悉的操作系统(我会选择CentOS 7)</li><li id="99c0" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated">还要确保你检查HTTP，HTTPS交通。稍后我们将添加我们自己的SSL证书。</li></ul><p id="eb4c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您应该能够在<strong class="je hv">虚拟机实例</strong>视图中看到您的实例，如下所示:</p><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lh"><img src="../Images/4bc259aa274594eaa9b957e67b01b07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bE5_TR9VlD27s8qpHZTCfA.png"/></div></div></figure><p id="cd9c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您将看到您的实例有一个内部IP和一个外部IP。我们关心的是外部IP，因为我们将把它添加到我们的注册商DNS管理器中，这样我们就可以将域名链接到该服务器。</p><p id="bca2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然而，在我们这样做之前，我们需要确保我们保留了一个静态IP。我们目前看到的是所谓的<strong class="je hv">短命</strong> IP(意味着它不会持续太久)。</p><p id="113f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为此，转到<code class="eh ld le lf lg b">Google Cloud / VPC Network / External IP addresses</code>并点击<strong class="je hv">保留静态地址</strong>:</p><ul class=""><li id="ef6d" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">给它一个名字，这样很容易记住它属于什么，我通常使用域名</li><li id="5335" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated">选择一个IP版本(如果您不确定应该选择什么，请选择IPv4 —区域类型),然后</li><li id="1ba1" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated"><strong class="je hv">确保将它附加到您的虚拟机实例</strong>。你得到一个静态的“免费”IP作为你的帐户的一部分。其他静态IP地址如果没有连接到机器，则按小时计费。</li></ul><p id="32d8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">回到<code class="eh ld le lf lg b">Google Cloud / Compute Engine / VM instances</code>，你会发现你可能有一个不同的外部IP地址。这个是静态的，我们可以将它添加到我们的注册器中。我们将在我们的服务器实际显示一些东西之后再做。</p><p id="1d3f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们需要在服务器上安装一些东西，所以单击带有我们实例名称的表格中的<strong class="je hv"> SSH </strong>按钮:</p><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lh"><img src="../Images/d354ff8caa19e8b4f2a24acf643fa89e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sI7ciml2n3ejqLKc7kC0BQ.png"/></div></div></figure><p id="2d6e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">根据您选择的操作系统，接下来的步骤会有所不同，但如果您选择了CentOS，软件包管理器将会是<strong class="je hv"> yum </strong>。我们需要运行以下命令:</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="c3eb" class="lq lr hu lg b fv ls lt l lu lv">sudo yum install epel-release # the CentOS EPEL repository<br/>sudo yum install nginx # our web server<br/>sudo systemctl start nginx # to run nginx</span></pre><p id="e678" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此时，如果我们在浏览器中键入我们的静态IP地址，我们将看到默认的Nginx登录页面。到目前为止一切顺利，现在我们需要教它为我们自己的网站服务。我们将把它配置成一个静态HTML页面:</p><ul class=""><li id="ed08" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">首先让我们创建一个文件夹来存放我们的站点</li></ul><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="a5b1" class="lq lr hu lg b fv ls lt l lu lv">sudo mkdir -p /var/www/example.com</span></pre><ul class=""><li id="f557" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">用一些随机内容创建一个<em class="kl">index.html</em>文件</li></ul><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="9a61" class="lq lr hu lg b fv ls lt l lu lv">echo "Hello World" &gt; /var/www/example.com/index.html</span></pre><ul class=""><li id="f9aa" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">我们还需要将这个文件夹的所有权从根用户更改为谷歌云用户。幸运的是，该用户存储在一个系统变量中，名为<em class="kl"> $USER </em></li></ul><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="facc" class="lq lr hu lg b fv ls lt l lu lv">sudo chown -R $USER:$USER /var/www/example.com</span></pre><ul class=""><li id="e9ae" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">我们还应该更改这些文件夹的权限，以便系统可以读取它们</li></ul><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="bfbe" class="lq lr hu lg b fv ls lt l lu lv">sudo chmod -R 755 /var/www/example.com #755 for folders<br/>sudo chmod -R 644 /var/www/example.com/* #644 for files</span></pre><ul class=""><li id="1531" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">创建一个nginx配置文件，它将在端口80上服务我们的站点。在这里，我们可以选择创建<em class="kl">站点可用的</em>和<em class="kl">站点启用的</em>文件夹，或者选择快捷方式，在<em class="kl"> conf.d </em>文件夹中创建我们的文件。我们采用第二种方案。传统上，您会将配置文件命名为与您的域相同的名称，后跟<em class="kl">。conf </em>分机，像这样:</li></ul><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="3fff" class="lq lr hu lg b fv ls lt l lu lv">sudo vim /etc/nginx/conf.d/example.com.conf</span></pre><p id="e0ef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果VIM不好用，不要担心，我们只需要把这个粘贴到它里面:</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="b095" class="lq lr hu lg b fv ls lt l lu lv">server {<br/>    server_name localhost; #example.com www.example.com;<br/><br/>    location / {<br/>        root  /var/www/example.com;<br/>        index  index.html index.htm;<br/>        try_files $uri $uri/ =404;<br/>    }<br/><br/>    error_page  500 502 503 504  /50x.html;<br/>    location = /50x.html {<br/>        root  /usr/share/nginx/html;<br/>    }<br/>}</span></pre><p id="8954" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后按<strong class="je hv"> ESC </strong>然后按<strong class="je hv"> :wq </strong>保存并退出文件(记住这个)。这是最基本的配置文件…你给它我们网站的根目录，服务器的名字，然后你就完成了。在我们将域名与服务器IP地址链接之前，<em class="kl">服务器名</em>将是<em class="kl">本地主机</em>，之后我们可以在这里写入实际的域名。</p><p id="1f88" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们需要禁用nginx运行的默认页面，因此编辑nginx.conf文件，如下所示:</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="934b" class="lq lr hu lg b fv ls lt l lu lv">sudo vim /etc/nginx/nginx.conf</span></pre><p id="90a4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">按下<em class="kl"> Insert </em>键，这样您就可以编辑文件，找到<em class="kl"> http {} </em>部分，并通过在每行前面添加#注释掉整个<em class="kl"> server {} </em>块，然后保存并退出文件。</p><p id="8452" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">差不多了，我们只需要重启nginx。</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="377d" class="lq lr hu lg b fv ls lt l lu lv">sudo systemctl restart nginx</span></pre><p id="d94c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">打开浏览器选项卡，导航到服务器静态IP地址aaaaaaaand:</p><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lw"><img src="../Images/3e86d960f10afd5002a93c1aae7c71b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vQnJOMf0gAVldvdt9Z_PdA.png"/></div></div></figure><p id="2c59" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为什么，我们做的一切都是对的……对吗？嗯，不…欢迎来到SELinux的奇妙世界。如果你使用的是没有SELinux模块的Linux发行版，比如Ubuntu…你可能已经安装并运行了。我们这些使用Cent OS或其他红帽发行版的人被困在了这里。</p><p id="bf63" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">SELinux最初是由NSA(是的，就是NSA)和Red Hat Software创作的，后者提供了一种访问控制的安全机制。我们已经配置好了，但是SELinux不让nginx访问它们。要使它工作，只需运行以下命令:</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="ad2e" class="lq lr hu lg b fv ls lt l lu lv">sudo restorecon -v /var/www/example.com/index.html</span></pre><p id="08da" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请记住它，因为每次在这里添加新文件夹或文件时，您都需要运行它。至于为什么会这样，我把这篇文章留给你，这篇文章解释了SELinux的基础知识。</p><p id="9cb9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">再次刷新页面，发现了！我们提供静态HTML页面。接下来，让我们将我们的域名与这台机器链接起来。</p><p id="84a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<a class="ae ka" href="https://hackernoon.com/trials-and-tribulations-of-google-cloud-hosting-a-tutorial-26395eb25636" rel="noopener ugc nofollow" target="_blank">之前的文章</a>中，我提到我使用<a class="ae ka" href="https://www.godaddy.com" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> GoDaddy </strong> </a>作为我的域名注册商。不管你用的是什么，下一步应该是相似的。登录您的域名注册商，进入您的域名<strong class="je hv"> DNS管理器</strong>。假设您使用IPv4作为静态IP，添加两个新记录:</p><ul class=""><li id="b312" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">Type: A，Host: @，指向:您的VM实例的外部(静态)IP</li><li id="dc94" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated">Type: A，Host: www，指向:你的VM实例的外部(静态)IP</li></ul><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lx"><img src="../Images/1e9b1681c6845a31fe2fa54e2860575e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s1KnY3SoefEvp9mEHkYuDQ.png"/></div></div><figcaption class="ly lz fg fe ff ma mb bd b be z ek">Registrar DNS Records</figcaption></figure><p id="1ec5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上表中，<em class="kl">名</em>为<em class="kl">主机</em>，<em class="kl">值</em>为静态<em class="kl"> IP </em>。如果你选择了IPv6，你可以做同样的事情，但是不是用<strong class="je hv"> A </strong>记录，而是用同样的方式创建<strong class="je hv"> AAAA </strong>记录。</p><p id="ad76" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">编辑您的服务器配置文件并添加正确的域名(当前是localhost)</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="f050" class="lq lr hu lg b fv ls lt l lu lv"># edit config file<br/>sudo vim /etc/nginx/conf.d/example.com.conf</span><span id="0bc4" class="lq lr hu lg b fv mc lt l lu lv"># update server_name from this<br/>server_name localhost; #example.com <a class="ae ka" href="http://www.example.com;" rel="noopener ugc nofollow" target="_blank">www.example.com;</a></span><span id="193a" class="lq lr hu lg b fv mc lt l lu lv"># to your domain name<br/>server_name example.com <a class="ae ka" href="http://www.example.com;" rel="noopener ugc nofollow" target="_blank">www.example.com;</a></span><span id="7637" class="lq lr hu lg b fv mc lt l lu lv"># make sure to restart nginx again<br/>sudo systemctl restart nginx</span></pre><p id="0fc1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">DNS更改可能需要一段时间才能传播，但一旦传播，您将能够使用自己的域名而不是静态IP来访问您的服务器。</p><p id="159f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">剩下的就是创建一些SSL证书，这样一切都可以在HTTPS上运行，我们就完成了。最简单和免费的选择是使用<strong class="je hv"> certbot </strong>实用程序，它生成由<a class="ae ka" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">颁发的证书，让我们加密</a>。Certbot还提供基于您的web服务器的实用程序(在我们的例子中是nginx ),您可以像这样安装它:</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="8d97" class="lq lr hu lg b fv ls lt l lu lv"># this assumes you've already installed the<br/># epel-release repository in the previous steps<br/>sudo yum install certbot-nginx</span></pre><p id="b9f3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果在创建VM实例时已经检查了HTTP和HTTPS，那么可以跳过这一步。否则，我们需要允许通过防火墙访问端口80和443，因此运行以下命令:</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="18cc" class="lq lr hu lg b fv ls lt l lu lv"># for systems with firewalld firewall<br/>sudo firewall-cmd --add-service=http<br/>sudo firewall-cmd --add-service=https<br/>sudo firewall-cmd --runtime-to-permanent</span><span id="13c8" class="lq lr hu lg b fv mc lt l lu lv"># for systems with iptables firewall<br/>sudo iptables -I INPUT -p tcp -m tcp --dport 80 -j ACCEPT<br/>sudo iptables -I INPUT -p tcp -m tcp --dport 443 -j ACCEPT</span></pre><p id="6231" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完成这些步骤后，我们可以要求certbot为我们的域和子域颁发SSL证书，如下所示:</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="b783" class="lq lr hu lg b fv ls lt l lu lv">sudo certbot --nginx -d example.com -d www.example.com</span></pre><p id="aa22" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您是第一次运行它，certbot会问您几个问题，其中一个问题与HTTP流量有关；具体来说，如果我们允许HTTP流量或只允许HTTPS，我会选择:"<code class="eh ld le lf lg b">Secure - Make all requests redirect to secure HTTPS access</code>"</p><p id="bd74" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Certbot会自动用新生成的SSL证书更新您的nginx配置文件。你可以在这里测试你的SSL证书的强度。这些是免费的，但需要每3个月更新一次。</p><p id="5255" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有两种方法可以解决这个问题，您可以:</p><ul class=""><li id="e04a" class="kp kq hu je b jf jg jj jk jn kr jr ks jv kt jz ku kv kw kx dt translated">每3个月手动运行一次<code class="eh ld le lf lg b">certbot renew</code>(#无聊，#乏味，#难忘)或</li><li id="96a8" class="kp kq hu je b jf ky jj kz jn la jr lb jv lc jz ku kv kw kx dt translated">创建一个系统cron作业来为您运行该命令</li></ul><p id="2ebd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您创建一个SSL自动更新cron作业，建议您每天至少运行一次或两次该命令。在CentOS 7上，cronie默认运行。</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="4b3e" class="lq lr hu lg b fv ls lt l lu lv"># verify croni is installed<br/>sudo rpm -q cronie</span><span id="6d96" class="lq lr hu lg b fv mc lt l lu lv"># install croni if necessary<br/>sudo yum install cronie</span><span id="7636" class="lq lr hu lg b fv mc lt l lu lv"># check if crond service is running<br/>sudo systemctl status crond.service</span><span id="88a0" class="lq lr hu lg b fv mc lt l lu lv"># display help info about cron jobs<br/>sudo cat /etc/crontab</span><span id="39cd" class="lq lr hu lg b fv mc lt l lu lv"># open cron jobs file in default editor<br/>sudo crontab -e</span><span id="1407" class="lq lr hu lg b fv mc lt l lu lv"># add cron job to update SSL every day at 2:00 AM<br/>0 2 * * * /usr/bin/certbot renew --quiet</span><span id="0367" class="lq lr hu lg b fv mc lt l lu lv"># restart crond service after making changes to cron job<br/>sudo systemctl restart crond.service</span></pre><p id="9d26" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你想使用nginx作为反向代理(如果你在另一个端口上运行NodeJS实例)，你只需要编辑你的<em class="kl"> example.com.conf </em>配置文件如下:</p><pre class="li lj lk ll fq lm lg ln lo aw lp dt"><span id="0c7f" class="lq lr hu lg b fv ls lt l lu lv">server {<br/>    ...<br/><br/>    location / {<br/>        proxy_set_header X-Forwarded-For $remote_addr;<br/>        proxy_set_header Host $http_host;<br/>        proxy_pass "<a class="ae ka" href="http://127.0.0.1:1337" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:3</a>000";<br/>    }<br/><br/>    ...<br/>    # SSL configs added by certbot<br/>}</span></pre><p id="68e7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">记下<em class="kl"> proxy_pass </em>并添加运行NodeJS服务器的端口。顺便提一下，你可能应该通过<a class="ae ka" href="https://www.npmjs.com/package/pm2" rel="noopener ugc nofollow" target="_blank"> PM2 </a>或者类似的过程管理器来运行你的节点。</p><p id="c04e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你现在有一个非常基本的网站运行在谷歌云计算引擎与SSL自动更新。</p><p id="2b11" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">恭喜你，编码快乐！</p><figure class="li lj lk ll fq iv"><div class="bz el l di"><div class="md me l"/></div></figure></div></div>    
</body>
</html>