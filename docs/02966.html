<html>
<head>
<title>Where to integrate API calls in ReactJs? — componentWillMount vs componentDidMount</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ReactJs中哪里集成API调用？— componentWillMount与componentDidMount</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/where-to-integrate-api-calls-in-reactjs-componentwillmount-vs-componentdidmount-710085dc05c3?source=collection_archive---------2-----------------------#2018-04-04">https://medium.com/hackernoon/where-to-integrate-api-calls-in-reactjs-componentwillmount-vs-componentdidmount-710085dc05c3?source=collection_archive---------2-----------------------#2018-04-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/bd584bbae0106dadf7a73ec0cc05ea57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kTg8v_bjf_jpYJOyUKOY0Q.jpeg"/></div></div></figure><div class=""/><p id="aec3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">每个想要获取数据或向服务器发送数据的React应用程序都需要集成API。</p><p id="2464" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有各种各样的生命周期方法，如果一个组件想要集成API，那么什么是正确的位置呢？</p><p id="a3a7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">React中有各种生命周期方法，了解生命周期方法将有助于您成为更好的React开发人员。</p><p id="9c41" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你对生命周期方法有任何疑问，你真的应该去看看这篇博文。</p><div class="ht hu fm fo hv kb"><a href="https://hackernoon.com/reactjs-component-lifecycle-methods-a-deep-dive-38275d9d13c0" rel="noopener  ugc nofollow" target="_blank"><div class="kc ab ej"><div class="kd ab ke cl cj kf"><h2 class="bd ig fv z el kg eo ep kh er et ie dt translated">ReactJs组件生命周期方法——深入探讨</h2><div class="ki l"><h3 class="bd b fv z el kg eo ep kh er et ek translated">“ReactJs是一个用于构建用户界面的javascript库”是关于ReactJs的官方介绍。</h3></div><div class="kj l"><p class="bd b gc z el kg eo ep kh er et ek translated">hackernoon.com</p></div></div><div class="kk l"><div class="kl l km kn ko kk kp ib kb"/></div></div></a></div><p id="a972" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通常，在任何客户端应用程序中有两种API调用集成:</p><ol class=""><li id="18b7" class="kq kr if je b jf jg jj jk jn ks jr kt jv ku jz kv kw kx ky dt translated"><strong class="je ig">当用户要求<br/> </strong>这种API调用是用户在点击、滚动、拖放&amp;等各种事件上要求的。例如提交表格和加载更多选项。这种API调用有专门的事件函数，API就是从那里调用的。</li><li id="14f0" class="kq kr if je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated"><strong class="je ig">组件加载<br/> </strong>在很多场景下，都要求我们希望组件一加载就获取一些数据。例如，考虑显示项目列表的组件，在这种情况下，一旦组件加载到浏览器上，您就需要自动调用GET API。另一个例子是集成API来分析组件的加载。</li></ol><p id="1c91" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这篇博文中，我们将讨论在组件加载后，React app中API的集成。</p><blockquote class="le"><p id="d03b" class="lf lg if bd lh li lj lk ll lm ln jz ek translated">我们不应该在render方法中获取任何数据，因为render是一个纯函数，在这里调用API可能会产生副作用。</p></blockquote><p id="c76d" class="pw-post-body-paragraph jc jd if je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">我知道，这是大家都知道的。我只是想<em class="ka">提醒</em>😉</p><p id="be60" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在定义了属性和状态之后，生命周期方法的领域就开始了。因此，这两种方法是最合适的候选方法，其中API可以被调用:</p><ol class=""><li id="52c2" class="kq kr if je b jf jg jj jk jn ks jr kt jv ku jz kv kw kx ky dt translated">component will mount/UNSAFE _ component will mount</li><li id="37fa" class="kq kr if je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">组件安装</li></ol><h2 id="9d78" class="lt lu if bd lv lw lx ly lz ma mb mc md jn me mf mg jr mh mi mj jv mk ml mm mn dt translated">1)component will mount/UNSAFE _ component will mount</h2><p id="42ed" class="pw-post-body-paragraph jc jd if je b jf mo jh ji jj mp jl jm jn mq jp jq jr mr jt ju jv ms jx jy jz hn dt translated">如果你是第一次看到<code class="eh mt mu mv mw b"><strong class="je ig">UNSAFE_</strong></code> <strong class="je ig"> </strong>，让我告诉你在几天前发布的React v16.3.0中，已经宣布<code class="eh mt mu mv mw b">componentWillMount</code><strong class="je ig">将只工作到版本17</strong><code class="eh mt mu mv mw b"><strong class="je ig">UNSAFE_</strong></code>将作为前缀允许逐步迁移。<br/>这是一个非常<strong class="je ig">强有力的</strong>不使用这种方法的理由，但是让我们仍然为使用react版本低于17的应用程序找到答案，因为这些方法将始终保留在较旧的React版本中，甚至在接下来的几个版本中。</p><p id="89a4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">过去，在React社区中有一场大辩论和讨论，反对使用<code class="eh mt mu mv mw b">componentWillMount</code>而使用构造函数，因此已经完成了。</p><p id="55a9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ka">请点击以下链接查看讨论内容。</em></p><div class="ht hu fm fo hv kb"><a href="https://github.com/facebook/react/issues/7671" rel="noopener  ugc nofollow" target="_blank"><div class="kc ab ej"><div class="kd ab ke cl cj kf"><h2 class="bd ig fv z el kg eo ep kh er et ie dt translated">可能会安装不推荐的组件？问题#7671 facebook/react</h2><div class="ki l"><h3 class="bd b fv z el kg eo ep kh er et ek translated">让我们利用这个主题来讨论组件安装的用例以及这些问题的替代解决方案…</h3></div><div class="kj l"><p class="bd b gc z el kg eo ep kh er et ek translated">github.com</p></div></div><div class="kk l"><div class="mx l km kn ko kk kp ib kb"/></div></div></a></div><p id="4f70" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你计划升级你的React版本，你可以使用<a class="ae my" href="https://github.com/reactjs/react-codemod#rename-unsafe-lifecycles" rel="noopener ugc nofollow" target="_blank">自动化脚本</a>来重命名名字。</p><p id="e579" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是React开发人员在社区中非常普遍的误解，他们认为我们应该在<code class="eh mt mu mv mw b">componentWillMount</code>中调用API，这样就可以避免额外的渲染。但是，我的朋友，事实是render方法总是在<code class="eh mt mu mv mw b">componentWillMount</code>之后被立即调用，没有办法要求render等待API调用完成。</p><blockquote class="le"><p id="a42e" class="lf lg if bd lh li lj lk ll lm ln jz ek translated">必须正确设置组件的默认状态和属性，以呈现具有空状态值的组件。</p></blockquote><p id="d6f0" class="pw-post-body-paragraph jc jd if je b jf lo jh ji jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">如果您正在进行React组件的服务器端渲染，那么<code class="eh mt mu mv mw b">componentWillMount</code>将在服务器端被调用，并在客户端再次被调用，从而导致调用fetch两次。因此，这绝对不是我们应该集成API的地方。</p><h2 id="f180" class="lt lu if bd lv lw lx ly lz ma mb mc md jn me mf mg jr mh mi mj jv mk ml mm mn dt translated">2)组件安装</h2><p id="328a" class="pw-post-body-paragraph jc jd if je b jf mo jh ji jj mp jl jm jn mq jp jq jr mr jt ju jv ms jx jy jz hn dt translated">这个方法是集成API的合适位置，因为此时render方法已经被调用过一次<strong class="je ig">。</strong></p><p id="370a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果我们的组件呈现在服务器上，API不会被调用两次，一次是因为在服务器端组件<strong class="je ig"> DidMount </strong>不会被调用。因此，该API在客户端只被调用一次。</p></div><div class="ab cl mz na hc nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hn ho hp hq hr"><p id="9553" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是这篇博文的内容，我希望你能从这篇博文中获得一些有价值的信息。请鼓掌，评论，让我知道你的想法，并在twitter上分享🙂不断学习和分享😊</p><figure class="nh ni nj nk fq hw fe ff paragraph-image"><div class="fe ff ng"><img src="../Images/436774fbc80b39256ed738f4ffa570c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*N274G84ZMJk7k80Xay-P2Q.jpeg"/></div></figure><p id="e793" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果这篇文章对你有帮助，那么你可以<a class="ae my" href="http://paypal.me/MaheshHaldar" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a>😊</p></div></div>    
</body>
</html>