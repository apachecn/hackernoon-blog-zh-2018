<html>
<head>
<title>Upgradeable Smart Contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可升级的智能合同</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/upgradeable-smart-contracts-a7e9aef76fdd?source=collection_archive---------6-----------------------#2018-04-05">https://medium.com/hackernoon/upgradeable-smart-contracts-a7e9aef76fdd?source=collection_archive---------6-----------------------#2018-04-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="c950" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">如果你只是简单地寻找代码，你可以在这里</em>  <em class="jp">找到回购</em> <a class="ae jq" href="https://github.com/kyriediculous/contract-manager-solidity" rel="noopener ugc nofollow" target="_blank"> <em class="jp">。</em></a></p><p id="fe32" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当你熟悉<a class="ae jq" href="https://hackernoon.com/tagged/ethereum" rel="noopener ugc nofollow" target="_blank">以太坊</a>(或者一般来说<a class="ae jq" href="https://hackernoon.com/tagged/blockchain" rel="noopener ugc nofollow" target="_blank">区块链</a>的时候，你可能会遇到<em class="jp">‘不可变’</em>这个词。当考虑区块链时，我们主要将其与系统的分类账和功能状态不能被篡改或删除的事实联系起来。当具体考虑智能合约时，我宁愿将其与<em class="jp">“不可变对象”</em>的定义进行比较。</p><blockquote class="jr js jt"><p id="c29a" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">在面向对象和函数式编程中，<strong class="it hv">不可变对象</strong>是一个对象，它的状态在创建后不能被修改</p></blockquote><p id="b832" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着，一旦我们的合同部署到区块链，它是固定的。我们不能改变其预定义范围(setters)之外的状态，但更重要的是我们不能改变代码。</p><p id="4ac1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了解决这个问题，我们将讨论一个解决方案，该方案基于将我们的契约存储和逻辑拆分到单独的契约中，同时通过注册中心引导调用。之后，我们将讨论一些利弊。</p><figure class="jy jz ka kb fq kc fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/daec9e32acced33597c52cca83f3fa63.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*r6LLu7uRLpMBsmTa0b58aQ.png"/></div></figure><h1 id="15fc" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated"><strong class="ak">合同管理合同</strong></h1><p id="d6da" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">该模型将基于Monax 的<a class="ae jq" href="https://monax.io/docs/solidity/solidity_1_the_five_types_model/" rel="noopener ugc nofollow" target="_blank">五种类型模型，针对最新的Solidity语言特性进行更新，以使其更易于理解和阅读。我们将执行以下合同:</a></p><ol class=""><li id="e639" class="li lj hu it b iu iv iy iz jc lk jg ll jk lm jo ln lo lp lq dt translated">CMC —在我们的系统中跟踪合同的注册表</li><li id="2ec6" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated">控制器—根据我们的存储合同运作的合同</li><li id="accc" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated">存储—具有必要的获取器和设置器的数据存储契约</li><li id="fc3c" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated">ALC——包含特定于应用程序的逻辑(通常是用户入口点)的契约</li></ol><p id="1578" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您以前有web应用程序的经验，那么这个动作流看起来就像您从命名中所期望的那样。</p><p id="d315" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">用户→ALC→控制器→存储</p><h1 id="e7c8" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">ALC、控制器和存储的基本类别</h1><p id="5ec4" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">我们添加到注册中心的每个合同都将从一个基类开始，该基类为我们的注册中心设置并包含以太坊地址、一个用于合同访问控制的修饰符、一个从注册中心的合同中获取地址的接口以及一个删除合同的选项。</p><figure class="jy jz ka kb fq kc"><div class="bz el l di"><div class="lw lx l"/></div></figure><figure class="jy jz ka kb fq kc"><div class="bz el l di"><div class="lw lx l"/></div></figure><h1 id="a2cb" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">合同登记处</h1><p id="cf9a" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">我们的合同注册中心将跟踪我们的系统当前在<em class="jp">映射</em>中使用的合同地址。我们将使用<em class="jp">字节3 </em> 2变量，因为我们不能将动态类型(字符串)作为键。我们将添加一些函数来添加、获取和删除注册表中的函数，并添加一个函数来更新我们部署的契约所使用的注册表。<em class="jp">(可以从</em><a class="ae jq" href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/ownership/Ownable.sol" rel="noopener ugc nofollow" target="_blank"><em class="jp">OpenZeppelin</em></a><em class="jp">)获取Ownable.sol】</em></p><figure class="jy jz ka kb fq kc"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="0896" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！现在是说明它如何工作的时候了，为此我们将创建一个简单的工作流，通过ALC和控制器将变量<em class="jp"> x </em>存储到我们的存储契约中。<strong class="it hv">每个合同将被单独部署，并在创建后添加到注册表中。</strong>一个好的惯例可能是给你的合同起一个和定义它们时一样的名字。</p><figure class="jy jz ka kb fq kc"><div class="bz el l di"><div class="lw lx l"/></div></figure><h1 id="f4f7" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">对其进行测试</h1><p id="5d1c" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">在github repo中，您会在test文件夹中找到一个文件，其中包含一些基本的单元测试。要运行这些程序，请确保您已经安装了<a class="ae jq" href="http://truffleframework.com/docs/getting_started/installation" rel="noopener ugc nofollow" target="_blank">块菌</a>并且<a class="ae jq" href="http://truffleframework.com/ganache/" rel="noopener ugc nofollow" target="_blank"> Ganache </a>正在运行。运行test命令来运行单元测试:</p><pre class="jy jz ka kb fq ly lz ma mb aw mc dt"><span id="a2a8" class="md kg hu lz b fv me mf l mg mh">truffle test</span></pre><figure class="jy jz ka kb fq kc fe ff paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="fe ff mi"><img src="../Images/aa535b2cc0380d8cc3ea96138275fd8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rfvfoIaBEBh3mHF1YSgLww.png"/></div></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">completed tests</figcaption></figure><h1 id="d54e" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">赞成和反对</h1><p id="20c6" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">这种设置的两个优点当然是代码的可维护性和可升级性。我们现在可以在现有存储之上部署新的控制器或ALC，这样我们的用户数据就不会受到影响。</p><p id="4f51" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最大的缺点是汽油成本。部署这个宝贝将比仅仅部署一个合同花费更多，特别是如果工作流程真的很简单的话。除此之外，您/用户在进行状态更改时，将额外支付10%的天然气费用。</p><p id="3fc6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我知道对于用户来说，这可能会有一些信任问题，但是我并不认为这是一个争论，因为他们可以很容易地检查注册，以检查哪些合同正在使用。</p></div><div class="ab cl mr ms hc mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hn ho hp hq hr"><p id="94fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感谢你的阅读，我希望你喜欢它，尤其是学到了一些新东西。这只是一个基本模型，一个更大的系统当然会在CMC上有更多的逻辑，甚至系统的不同部分会有不同的合同经理。</p><p id="a1b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想了解更多关于可靠性的知识，一定要看看我们的<a class="ae jq" href="https://itnext.io/create-your-first-ethereum-dapp-with-web3-and-vue-js-c7221af1ed82" rel="noopener ugc nofollow" target="_blank"> dApp教程系列</a>和我们的<a class="ae jq" href="https://hackernoon.com/create-your-own-ethereum-token-bfa6302084da" rel="noopener ugc nofollow" target="_blank">令牌教程</a>！</p><p id="8641" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢这篇文章，随时欢迎你留下你的建议并支持免费的知识分享！</p><p id="87b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">ETH—0x 6d 31 CB 338 b 5590 adafec 46462 a1 b 095 ebdc 37d 50</em></p><figure class="jy jz ka kb fq kc"><div class="bz el l di"><div class="my lx l"/></div></figure></div></div>    
</body>
</html>