<html>
<head>
<title>Using Redis with Node JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对节点JS使用Redis</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/using-redis-with-node-js-8d87a48c5dd7?source=collection_archive---------1-----------------------#2018-04-08">https://medium.com/hackernoon/using-redis-with-node-js-8d87a48c5dd7?source=collection_archive---------1-----------------------#2018-04-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/7c3e7da80d7d75309e0105a374b6e1b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/0*ia_gKRqbfM5xyYDJ.jpg"/></div></figure><h2 id="8bf8" class="iy iz hu bd ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv dt translated">什么是Redis</h2><p id="8f38" class="pw-post-body-paragraph jw jx hu jy b jz ka kb kc kd ke kf kg jj kh ki kj jn kk kl km jr kn ko kp kq hn dt translated"><a class="ae kr" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank"> Redis </a>是一个内存中的数据结构存储，可以用作数据库、缓存和消息代理。Redis支持不同的数据结构，如字符串、列表、集合、散列、位图等。。简单地说，Redis使用你的RAM来存储数据，速度非常快，但是如果你重启你的服务器，这些值就会消失，除非你启用R <a class="ae kr" href="https://redis.io/topics/persistence" rel="noopener ugc nofollow" target="_blank"> edis持久性</a>。好消息默认情况下Redis为您启用了持久性机制(您可以根据需要禁用或配置持久性。)</p><h2 id="2721" class="iy iz hu bd ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv dt translated">安装Redis (Linux)</h2><p id="f788" class="pw-post-body-paragraph jw jx hu jy b jz ka kb kc kd ke kf kg jj kh ki kj jn kk kl km jr kn ko kp kq hn dt translated">参考:<a class="ae kr" href="https://redis.io/download" rel="noopener ugc nofollow" target="_blank">https://redis.io/download</a></p><p id="8df5" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated"><em class="kx">用</em>下载、解压并编译Redis</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="6746" class="iy iz hu ld b fv lh li l lj lk">$ wget http://download.redis.io/releases/redis-4.0.9.tar.gz<br/>$ tar xzf redis-4.0.9.tar.gz<br/>$ cd redis-4.0.9<br/>$ make</span></pre><p id="7859" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated"><em class="kx">现在编译的二进制文件在</em> <code class="eh ll lm ln ld b"><em class="kx">src</em></code> <em class="kx">目录下。使用</em>运行Redis</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="b327" class="iy iz hu ld b fv lh li l lj lk">$ src/redis-server</span></pre><p id="b652" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">您可以使用内置客户端与Redis进行交互:</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="9403" class="iy iz hu ld b fv lh li l lj lk">$ src/redis-cli<br/>redis&gt; set foo bar<br/>OK<br/>redis&gt; get foo<br/>"bar"</span></pre><p id="c649" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">好了，现在我们已经成功地在本地机器上安装了Redis。<a class="ae kr" href="https://redis.io/commands" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以看到我们可以和Redis一起使用的有用的<a class="ae kr" href="https://redis.io/commands" rel="noopener ugc nofollow" target="_blank">命令</a>。它们超级简单和有用。花些时间使用这些命令。</p><h2 id="8f63" class="iy iz hu bd ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv dt translated">在NodeJS应用程序中使用Redis</h2><p id="4e9f" class="pw-post-body-paragraph jw jx hu jy b jz ka kb kc kd ke kf kg jj kh ki kj jn kk kl km jr kn ko kp kq hn dt translated">首先，您需要通过<a class="ae kr" href="https://www.npmjs.com/package/redis" rel="noopener ugc nofollow" target="_blank"> npm </a>为NodeJS安装Redis客户端。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="037a" class="iy iz hu ld b fv lh li l lj lk">npm install redis</span></pre><p id="9e78" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">现在，在NodeJS项目中创建一个名为redisDemo.js的文件。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="342c" class="iy iz hu ld b fv lh li l lj lk">// redisDemo.js<br/>var redis = require('redis');<br/>var client = redis.createClient(); // this creates a new client</span></pre><p id="d457" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">默认情况下，redis.createClient()将使用127.0.0.1和6379端口。如果您有自定义的ip和端口，请使用</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="682e" class="iy iz hu ld b fv lh li l lj lk">var client = redis.createClient(port, host);</span></pre><p id="78b6" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">现在，我们想监听<em class="kx"> connect </em>事件，看看我们是否成功连接到redis-server。我们可以像这样检查成功的连接。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="516a" class="iy iz hu ld b fv lh li l lj lk">client.on('connect', <strong class="ld hv">function</strong>() {<br/>    console.log('Redis client connected');<br/>});</span></pre><p id="03e2" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">同样，我们想检查我们是否未能连接到redis服务器。我们可以监听<em class="kx">错误</em>事件。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="531a" class="iy iz hu ld b fv lh li l lj lk">client.on('error', <strong class="ld hv">function </strong>(err) {<br/>    console.log('Something went wrong ' + err);<br/>});</span></pre><p id="53fe" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">当您忘记在应用程序运行前启动<em class="kx"> redis-server </em>时，这可能会触发。因此，在测试这段代码之前，请确保运行redis服务器。</p><p id="873c" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">注意:您可以使用以下命令启动、停止redis服务器。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="7076" class="iy iz hu ld b fv lh li l lj lk">/etc/init.d/redis-server stop<br/>/etc/init.d/redis-server start</span></pre><p id="e43e" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">让我们看看我们的代码现在是什么样子。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="fafe" class="iy iz hu ld b fv lh li l lj lk"><strong class="ld hv">var </strong>redis = require('redis');<br/><strong class="ld hv">var </strong>client = redis.createClient();<br/><br/>client.on('connect', <strong class="ld hv">function</strong>() {<br/>    console.log('Redis client connected');<br/>});<br/><br/>client.on('error', <strong class="ld hv">function </strong>(err) {<br/>    console.log('Something went wrong ' + err);<br/>});</span></pre><p id="41c6" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">现在，让我们看看如何在redis中的一个键下设置一些简单的值。为此，您可以使用set()和get()方法。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="9d90" class="iy iz hu ld b fv lh li l lj lk">client.set('my test key', 'my test value', redis.print);<br/>client.get('my test key', <strong class="ld hv">function </strong>(error, result) {<br/>    <strong class="ld hv">if </strong>(error) {<br/>        console.log(error);<br/>        <strong class="ld hv">throw </strong>error;<br/>    }<br/>    console.log('GET result -&gt;' + result);<br/>});</span></pre><p id="64cd" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">在client.set()中，我们首先给出键，然后给出值。记住Redis是一个键值存储。Redis将创建一个名为<em class="kx">‘我的测试键’</em>的键，并为该键分配值<em class="kx">‘我的测试值’</em>。</p><p id="0562" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">你可以看到我在set()方法上使用了那个<em class="kx"> redis.print </em>。它向控制台输出“Reply: OK ”,表示redis保存了这个值。如果你愿意，你可以省略这个论点。</p><p id="ba0a" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">现在，在get()方法中，我们只需通过指定确切的键名来检索刚刚保存的值。然后，它将在控制台中打印保存的值。</p><p id="5e7a" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">现在让我们看看完整的代码。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="6c58" class="iy iz hu ld b fv lh li l lj lk"><strong class="ld hv">var </strong>redis = require('redis');<br/><strong class="ld hv">var </strong>client = redis.createClient();<br/><br/>client.on('connect', <strong class="ld hv">function</strong>() {<br/>    console.log('Redis client connected');<br/>});<br/><br/>client.on('error', <strong class="ld hv">function </strong>(err) {<br/>    console.log('Something went wrong ' + err);<br/>});<br/><br/>client.set('my test key', 'my test value', redis.print);<br/>client.get('my test key', <strong class="ld hv">function </strong>(error, result) {<br/>    <strong class="ld hv">if </strong>(error) {<br/>        console.log(error);<br/>        <strong class="ld hv">throw </strong>error;<br/>    }<br/>    console.log('GET result -&gt;' + result);<br/>});</span></pre><p id="1f37" class="pw-post-body-paragraph jw jx hu jy b jz ks kb kc kd kt kf kg jj ku ki kj jn kv kl km jr kw ko kp kq hn dt translated">输出将如下所示</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="65b5" class="iy iz hu ld b fv lh li l lj lk">Redis client connected<br/>Reply: OK<br/>GET result -&gt;my test value</span></pre><h2 id="3f17" class="iy iz hu bd ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv dt translated">结论</h2><p id="46b6" class="pw-post-body-paragraph jw jx hu jy b jz ka kb kc kd ke kf kg jj kh ki kj jn kk kl km jr kn ko kp kq hn dt translated">Redis是非常强大的内存数据存储，我们可以在我们的应用程序中使用。保存和获取数据非常简单，不需要太多开销。更多用例请参考https://www.npmjs.com/package/redis的<a class="ae kr" href="https://www.npmjs.com/package/redis" rel="noopener ugc nofollow" target="_blank">，更多redis命令请参考https://redis.io/commands</a>的<a class="ae kr" href="https://redis.io/commands" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="ky kz la lb fq iv"><div class="bz el l di"><div class="lo lp l"/></div></figure></div></div>    
</body>
</html>