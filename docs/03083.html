<html>
<head>
<title>Implementing Driving Records Blockchain in iOS Using Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Swift在iOS中实现行车记录区块链</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/implementing-driving-records-blockchain-in-ios-using-swift-23fb258819b1?source=collection_archive---------7-----------------------#2018-04-08">https://medium.com/hackernoon/implementing-driving-records-blockchain-in-ios-using-swift-23fb258819b1?source=collection_archive---------7-----------------------#2018-04-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/d9ad460217238d5971ecf53e1d706c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i91mQg3aCnCaLW0b4TDg9Q.jpeg"/></div></div></figure><p id="efc3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不管你喜不喜欢，汽车保险公司会查看你的驾驶记录，以便为你提供最新的保险费率。如果您从一个州搬到另一个州，您的驾驶记录可能会根据新州的规则和规定而变化。通常，驾驶记录存储在旧的政府系统中，这些系统容易受到网络攻击。</p><p id="4db0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本帖中我将使用Swift语言在<a class="ae ka" href="https://hackernoon.com/tagged/ios" rel="noopener ugc nofollow" target="_blank"> iOS </a>中实现一个<a class="ae ka" href="https://hackernoon.com/tagged/blockchain" rel="noopener ugc nofollow" target="_blank">区块链</a>，负责存储用户的行车记录。接下来，我将使用Vapor，服务器端Swift框架，将区块链暴露为Web API。最后，我将创建一个简单的接口，该接口将与API进行通信，以通过特定用户的驾驶执照号码来获取和显示他们的驾驶历史。</p><p id="5e85" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完整的代码可以从<a class="ae ka" href="https://github.com/azamsharp/BlockchainRealWorld" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><blockquote class="kb kc kd"><p id="54e5" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">我还提供ARKit、iOS、React和Redux开发的培训研讨会。如果您或您的公司对研讨会感兴趣，请随时联系我。</p></blockquote><h2 id="309a" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">实现模型</h2><p id="80bf" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">让我们从实现应用程序中使用的领域模型开始。为了实现区块链，我们需要以下模型:</p><ul class=""><li id="4828" class="li lj hu je b jf jg jj jk jn lk jr ll jv lm jz ln lo lp lq dt translated">区块链</li><li id="64da" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated">街区</li><li id="105f" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated">交易</li></ul><p id="f791" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">区块链和区块是不言自明的。交易模型表示用户的驾驶记录。如果您不喜欢“事务”这个名称，那么您可以将其更改为“驱动记录”。在这篇文章中，我将使用“交易”，这将代表一个用户的驾驶记录。</p><p id="55a7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">交易</strong>:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="3871" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">交易类别由与驾驶记录相关的属性组成。这包括以下内容:</p><ul class=""><li id="4f76" class="li lj hu je b jf jg jj jk jn lk jr ll jv lm jz ln lo lp lq dt translated">驾驶执照号码</li><li id="5499" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated">语音类型</li><li id="3565" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated">没有变化</li><li id="2df8" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated">isDrivingLicenseSuspended</li></ul><p id="74dd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">显然，您可以添加更多的属性来存储更多与驾驶记录相关的信息。</p><p id="eeb0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">区块:</strong></p><p id="60fe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Block类负责存储事务。每个区块都要由矿工开采，之后再加入区块链。Block类的实现如下所示:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="a1b3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">块类的属性“<strong class="je hv"> key </strong>”是一个计算属性，它取决于块链中块的交易数据、先前散列、随机数和索引。</p><p id="915c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">区块链:</strong></p><p id="2826" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，区块链类负责维护和添加区块到区块链。区块链类的实现如下所示:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><h2 id="408c" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated"><strong class="ak">将区块链公开为Web API: </strong></h2><p id="fbb0" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">在我之前的一篇<a class="ae ka" href="https://hackernoon.com/building-blockchain-web-api-using-swift-and-vapor-2daf599c8449" rel="noopener ugc nofollow" target="_blank">帖子</a>中，我讨论了如何使用服务器端Swift框架Vapor将区块链公开为Web API。你可以在这里阅读<a class="ae ka" href="https://hackernoon.com/building-blockchain-web-api-using-swift-and-vapor-2daf599c8449" rel="noopener ugc nofollow" target="_blank">的帖子。Web API由负责管理区块链的<strong class="je hv">区块链控制器</strong>组成。</a></p><p id="a509" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">路由“<strong class="je hv">区块链</strong>”负责返回JSON格式的区块链。实现如下所示:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="dca7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您使用Postman调用“区块链”路线，您将得到以下结果:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mc"><img src="../Images/26ef8a0fca22ff45fac1e7f372cdf562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5935ODjgocUd-jx2aetrA.png"/></div></div></figure><p id="95a4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该屏幕截图显示被返回的区块链由单个块组成。该程序块是自动创建的，它被称为“<strong class="je hv">生成程序块</strong>”。</p><p id="e03c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">BlockchainController的“<strong class="je hv"> mine </strong>”路由负责挖掘块，并将事务添加到挖掘的块中。如果您使用Postman调用“我的”路线，您将得到以下结果:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mc"><img src="../Images/b37f57e097da331888b89a19921ff813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oUjgPKlGU2qT-1midJVkpQ.png"/></div></div></figure><p id="4e37" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以再次获取区块链，以验证具有行驶记录的块是否已添加到区块链。只需使用Postman或您的浏览器访问“<strong class="je hv">区块链</strong>”路径，查看JSON响应。</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mc"><img src="../Images/916efa33e2b0bbae927265a10657b290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fw43F9z7wnlq_Co7Fgy15g.png"/></div></div></figure><p id="02a7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这确保了我们的驾驶记录被成功添加到区块链。请注意，在区块链中，driverLicenseNumber是经过哈希处理的，而不是以普通驾照号码的形式存储。</p><blockquote class="kb kc kd"><p id="7b29" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">在本例中，我向一个块添加了一个事务。实际上，一个块由几个事务组成，这取决于块的大小。</p></blockquote><p id="ddea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此时，如果您为同一个驾照号码添加另一个违规，您将立即看到问题。</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff md"><img src="../Images/d3cde38137fceb80a6747b11f0c1248e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*85KMmNHoFmzA9zVMtqKl1g.png"/></div></div></figure><p id="5148" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">即使这个人有两次违规，区块链仍然说1。我们不能去更新原始事务并将违例增加到2，因为区块链中的块是不可变的并且不能被改变。在将事务添加到区块链之前，我们必须根据一些逻辑动态地更改事务。这听起来像是智能合约的完美工作。</p><p id="0bcf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">实施智能合同:</strong></p><p id="43c6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">智能合约是位于区块链上的代码块，能够执行自定义逻辑。我们可以使用这个定制逻辑在事务被添加到块之前更新它。<strong class="je hv">驱动记录智能合同</strong>的实现如下所示:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="5cee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">DrivingRecordSmartContract由一个名为“<strong class="je hv"> apply </strong>”的函数组成。apply函数遍历区块链中的每个块，并找到与驾照号码相关联的交易。一旦找到驾照号码，就会更新该交易的违规次数。如果违章次数超过5次，那么驾照将被吊销。</p><p id="1d42" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">区块链类更新为支持智能合约，如下所示:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="8821" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<strong class="je hv"> getNextBlock </strong>函数中，我们调用智能契约，并将事务和对块的引用传递给它。</p><p id="5c7e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，如果您访问区块链，您将获得更新后的交易，如下所示:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff me"><img src="../Images/65c9481bb30a975cc83e6248e1c0a6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dIyr0Iq2e9ARnfV2l6UTA.png"/></div></div></figure><h2 id="447d" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">使用Web界面访问驾驶记录:</h2><p id="8023" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">现在，我们的区块链实现已经完成，让我们看看如何使用web界面访问区块链记录。首先，我们需要创建一条可以通过驾照号码的路线。根据驾驶执照号码，区块链服务将返回适当的结果。</p><p id="8ed9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面的实现显示了BlockchainController路由，它可用于传递驾驶执照号码:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="928f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Blockchain类已经更新，包含了基于驾照号码返回交易的<strong class="je hv"> transactionsBy </strong>函数。</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ma mb l"/></div></figure><p id="d62c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面的截图显示了JSON结果:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mc"><img src="../Images/e7c5440de87b601a711ec90a527d4565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WY9zeSB-AO5Z_RFDGJV8EQ.png"/></div></div></figure><p id="e779" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过web应用程序访问时，结果如下所示:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mf"><img src="../Images/96bcadabae0f180b7a5c7d8bd776fc98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTwtxJ2L_5YR18y8KHT9VA.png"/></div></div></figure><p id="38cd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您有兴趣了解更多关于区块链的知识，请查看下面我的Udemy课程:</p><div class="mg mh fm fo mi mj"><a href="https://www.udemy.com/blockchain-programming-in-ios-using-swift/?couponCode=ILOVEBLOCKCHAIN" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab ej"><div class="ml ab mm cl cj mn"><h2 class="bd hv fv z el mo eo ep mp er et ht dt translated">使用Swift | Udemy在iOS中进行区块链编程</h2><div class="mq l"><h3 class="bd b fv z el mo eo ep mp er et ek translated">有兴趣了解区块链技术吗？区块链技术是比特币的支柱…</h3></div><div class="mr l"><p class="bd b gc z el mo eo ep mp er et ek translated">www.udemy.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx ja mj"/></div></div></a></div><div class="mg mh fm fo mi mj"><a href="https://www.udemy.com/blockchain-programming-using-javascript/?couponCode=BLOCKCHAINJS" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab ej"><div class="ml ab mm cl cj mn"><h2 class="bd hv fv z el mo eo ep mp er et ht dt translated">使用Javascript | Udemy的区块链编程</h2><div class="mq l"><h3 class="bd b fv z el mo eo ep mp er et ek translated">了解自互联网以来最具颠覆性的发明</h3></div><div class="mr l"><p class="bd b gc z el mo eo ep mp er et ek translated">www.udemy.com</p></div></div><div class="ms l"><div class="my l mu mv mw ms mx ja mj"/></div></div></a></div><p id="322b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">非常感谢，编码快乐！</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mz mb l"/></div></figure></div></div>    
</body>
</html>