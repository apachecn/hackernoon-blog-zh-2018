<html>
<head>
<title>Tutorial: SSR Split Testing and Analytics with React, Redux, and Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ•™ç¨‹:ä½¿ç”¨Reactã€Reduxå’ŒNext.jsè¿›è¡ŒSSRåˆ†å‰²æµ‹è¯•å’Œåˆ†æ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/tutorial-ssr-split-testing-and-analytics-with-react-redux-and-next-js-5392799c15c7?source=collection_archive---------5-----------------------#2018-04-09">https://medium.com/hackernoon/tutorial-ssr-split-testing-and-analytics-with-react-redux-and-next-js-5392799c15c7?source=collection_archive---------5-----------------------#2018-04-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/b7e4017738770a20ac36b5d7a4ac4ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yfy9qOJwzCxxK9bdOAOpFA.png"/></div></div></figure><div class=""/><p id="b28a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Eric Reisçš„ã€Šç²¾ç›Šåˆ›ä¸šã€‹ä¸ºæˆ‘ä»¬ä¼ä¸šçš„æˆåŠŸå¼€å‡ºäº†è¯æ–¹:å»ºç«‹ã€<strong class="je ig">æµ‹é‡</strong>ï¼Œå­¦ä¹ ï¼Œé‡å¤ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦å…³æ³¨â€œæµ‹é‡â€éƒ¨åˆ†ã€‚</p><p id="6403" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">åˆ†å‰²æµ‹è¯•å’Œåˆ†æä¸æ˜¯ç‰¹æ€§ï¼Œè€Œæ˜¯éœ€æ±‚ã€‚</strong></p><p id="1c93" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å¦‚æœä½ è¿ç”¨æˆ·åœ¨åšä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Œä½ æ€ä¹ˆèƒ½çŸ¥é“ä»»ä½•ä¸œè¥¿åœ¨å·¥ä½œå‘¢ï¼Ÿå¦‚æœä¸è¿›è¡Œæµ‹é‡ï¼Œæ‚¨å¦‚ä½•çŸ¥é“ä¸€ç§æ–¹æ³•æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Ÿ</p><blockquote class="ka"><p id="8d82" class="kb kc if bd kd ke kf kg kh ki kj jz ek translated">â€œå½“æ¨å‡ºä¸€ä¸ªæ–°çš„æ¼æ–—æ—¶ï¼Œä½ ä¸ä¸€å®šæœŸæœ›å®ƒé©¬ä¸Šèµ·ä½œç”¨â€”â€”ä½ æ˜¯åœ¨è´­ä¹°æ•°æ®ã€‚â€â€”é²è¾¾Â·å…‹é‡Œå¸Œçº³</p></blockquote><p id="aa1d" class="pw-post-body-paragraph jc jd if je b jf kk jh ji jj kl jl jm jn km jp jq jr kn jt ju jv ko jx jy jz hn dt translated">ä¸ä»…æ˜¯åˆ†å‰²æµ‹è¯•å’Œåˆ†æéœ€æ±‚ï¼›ä»–ä»¬ä¹Ÿæ˜¯å‡è¡¡å™¨ã€‚ä»–ä»¬å¯ä»¥å¸®åŠ©ä½ çš„å›¢é˜Ÿæ¶ˆé™¤â€œæ²³é©¬â€æˆ–é«˜è–ªäººå£«çš„çœ‹æ³•ã€‚</p><p id="d5dd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">è¿™å°±æ˜¯è¯´ï¼Œå°½ç®¡æœ‰è¯æ®è¡¨æ˜ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å¼ºæœ‰åŠ›çš„ï¼Œä½†è–ªé…¬æœ€é«˜çš„äººçš„æ„è§ä»ç„¶æ˜¯æœ€ç»ˆå¾—åˆ°å®æ–½çš„ä¸œè¥¿â€¦â€¦å› ä¸ºä»–ä»¬æ˜¯è¿™ä¹ˆè¯´çš„ï¼Œè€Œä¸”ä»–ä»¬èµšçš„æ¯”ä½ å¤šã€‚æ˜¾ç„¶ï¼Œæ›´é«˜çš„â€œæ³¢æ®µâ€æ„å‘³ç€æ›´é«˜çš„æ™ºåŠ›â€¦ğŸ˜œ</p><p id="290b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">æˆ‘æ›´å–œæ¬¢æ›´ç§‘å­¦çš„æ–¹æ³•:<em class="kp">ä¸€åˆ‡éƒ½æ˜¯å‡è®¾ï¼Œé™¤éæ•°æ®æ˜¾ç¤ºå¹¶éå¦‚æ­¤ã€‚</em> </strong></p><p id="c3fa" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ä¸ºæ­¤ï¼Œæˆ‘å·²ç»å†™äº†å¾ˆå¤šåˆ†æµ‹è¯•ï¼Œè€Œä¸”ï¼Œæˆ‘è®¤ä¸ºå¾ˆå¤šäººçœŸçš„æŠŠäº‹æƒ…è¿‡åˆ†å¤æ‚åŒ–äº†ã€‚</p><p id="b77b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘æƒ³å±•ç¤ºä½¿ç”¨Reduxå’ŒNext.jsæ·»åŠ è‡ªå®šä¹‰SSRåˆ†å‰²æµ‹è¯•æ˜¯å¤šä¹ˆç®€å•ã€‚</p><p id="c01b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»ä¸€ä¸ªç©ºçš„Node.jsé¡¹ç›®å¼€å§‹ï¼Œå¹¶é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰Reduxåˆ†æä¸­é—´ä»¶ï¼Œä½¿ç”¨Next.jsã€Reduxå’Œæ— ç¼åˆ†ææ„å»ºç®€å•çš„åˆ†å‰²æµ‹è¯•åŠŸèƒ½ã€‚</strong></p><p id="9fa2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">è¿™æ˜¯ä¸€ä¸¾ä¸¤å¾—ã€‚ä½œä¸ºå¯¹Reduxå’ŒNext.jsçš„ä»‹ç»ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬æ„å»ºä¸€ä¸ªå®é™…æœ‰ç”¨çš„ç‰¹æ€§ã€‚</strong></p><p id="69d3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å¯¹äºé‚£äº›ä¸ç†Ÿæ‚‰è¿™äº›æŠ€æœ¯çš„äººæ¥è¯´:</p><p id="cc42" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> Redux: </strong> Reduxæ˜¯JavaScriptåº”ç”¨çš„å¯é¢„æµ‹çŠ¶æ€å®¹å™¨ã€‚å®ƒå¸®åŠ©æ‚¨ç¼–å†™è¡Œä¸ºä¸€è‡´ã€åœ¨ä¸åŒç¯å¢ƒ(å®¢æˆ·æœºã€æœåŠ¡å™¨å’Œæœ¬æœº)ä¸­è¿è¡Œã€æ˜“äºæµ‹è¯•çš„åº”ç”¨ç¨‹åºã€‚<br/> <strong class="je ig"> React </strong>:ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„JavaScriptåº“<br/> <strong class="je ig"> Next.js: </strong>æœåŠ¡å™¨æ¸²æŸ“æˆ–é™æ€å¯¼å‡ºReactåº”ç”¨çš„æ¡†æ¶</p><p id="32d8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">æ³¨:</strong>è¿™æ˜¯ç”¨next@5å†™çš„â€”â€”ç”¨next@6ç ´æ•™ç¨‹ã€‚æ•™ç¨‹ä¸­çš„æ¦‚å¿µæ˜¯é‡è¦çš„éƒ¨åˆ†ï¼Œå¯ä»¥åº”ç”¨äºä»»ä½•æ¡†æ¶æˆ–è¯­è¨€ã€‚æˆ‘å·²ç»åœ¨å®‰è£…å‘½ä»¤ä¸­æ·»åŠ äº†ç‰ˆæœ¬å·ï¼Œæ‰€ä»¥æ‚¨ä»ç„¶å¯ä»¥éµå¾ªã€‚</p><h1 id="deec" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated"><strong class="ak"> 1ã€‚æˆ‘ä»¬å°†ä»ä¸€ä¸ªå…¨æ–°çš„Node.jsé¡¹ç›®</strong>å¼€å§‹</h1><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="2969" class="lx kr if lt b fv ly lz l ma mb">mkdir split-test<br/>cd split-test<br/>echo "node_modules\n.next" | tee .gitignore<br/>npm init</span></pre><h1 id="8f06" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">2.<strong class="ak">å®‰è£…å¹¶é…ç½®Next.js </strong></h1><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="aad3" class="lx kr if lt b fv ly lz l ma mb">npm install --save next@5 react@16 react-dom@16</span><span id="628e" class="lx kr if lt b fv mc lz l ma mb"># and open up your code editor. I'm using VSCode.<br/>code .</span></pre><p id="b77f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ä¸ºäº†å®Œæˆä¸‹ä¸€æ­¥çš„è®¾ç½®ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°<code class="eh md me mf lt b">package.json</code></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="7ee8" class="lx kr if lt b fv ly lz l ma mb">"scripts": {<br/> "dev": "next",<br/> "build": "next build",<br/> "start": "next start"<br/>}</span></pre><p id="1607" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç´¢å¼•é¡µé¢ã€‚ä»æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf lt b">pages</code>çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<code class="eh md me mf lt b">index.js</code></p><p id="3bbd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/pages/index.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="7c84" class="lx kr if lt b fv ly lz l ma mb">export default () =&gt; &lt;div&gt;Welcome to next.js!&lt;/div&gt;</span></pre><p id="6b30" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å¦‚æœä½ ä¸ç†Ÿæ‚‰Next.jsï¼Œå®ƒæ˜¯ä¸€ä¸ªå›´ç»•Webpackæ„å»ºçš„å›ºæ‰§å·±è§çš„æ¡†æ¶ã€‚<code class="eh md me mf lt b">pages</code>ç›®å½•ä¸­çš„ä¸€åˆ‡éƒ½æ˜¯æ–°çš„<code class="eh md me mf lt b">entrypoint</code>ï¼Œä¹Ÿå°±æ˜¯<code class="eh md me mf lt b">code-split</code>ã€‚</p><p id="98e2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨<code class="eh md me mf lt b">npm run dev</code>è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨çƒ­ä»£ç é‡è½½ã€‚è¯·è®¿é—®localhost:3000æŸ¥çœ‹æ‚¨çš„è¿›åº¦ï¼</p><p id="cd07" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ä½†æ˜¯å¦‚æœè¿™ä¸ªé¡µé¢å†™ç€â€œæ¬¢è¿æ¥åˆ°æˆ‘çš„next.jsâ€ä¼šè½¬æ¢å¾—æ›´å¥½å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­å§ã€‚</p><h1 id="59b0" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated"><strong class="ak"> 3ã€‚é…ç½®å†—ä½™</strong></h1><p id="2d1f" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">Reduxå°†ç®¡ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å“ªäº›å®éªŒå½“å‰æ˜¯æ´»åŠ¨çš„ã€‚</p><h2 id="d731" class="lx kr if bd ks ml mm mn kw mo mp mq la jn mr ms le jr mt mu li jv mv mw lm mx dt translated"><strong class="ak">å®‰è£…Redux </strong></h2><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="aa43" class="lx kr if lt b fv ly lz l ma mb">npm i --save redux@3 react-redux@5 next-redux-wrapper@1</span></pre><p id="4160" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåˆå§‹åŒ–Reduxçš„æ¨¡å—ã€‚å§‘ä¸”ç§°ä¹‹ä¸º<code class="eh md me mf lt b">initRedux.js</code>ï¼Œå­˜æ”¾åœ¨ä¸€ä¸ªæ–°æ–‡ä»¶å¤¹<code class="eh md me mf lt b">lib</code>ã€‚</p><p id="9721" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/initRedux.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="0197" class="lx kr if lt b fv ly lz l ma mb">import {<br/>  createStore,<br/>  combineReducers,<br/>  applyMiddleware,<br/>  compose<br/>} from 'redux'</span><span id="0ea4" class="lx kr if lt b fv mc lz l ma mb">let reducers = {}<br/>let reduxStore = null</span><span id="1d90" class="lx kr if lt b fv mc lz l ma mb">// The following checks if the Redux DevTools extension <br/>// is available in your browser, and activates it if so.<br/>// Otherwise, it executes a no-op function<br/>let devtools = f =&gt; f<br/>if (process.browser &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__) {<br/>  devtools = window.__REDUX_DEVTOOLS_EXTENSION__()<br/>}</span><span id="2055" class="lx kr if lt b fv mc lz l ma mb">function create (initialState = {}) {<br/>  return createStore(<br/>    combineReducers({ // Setup reducers<br/>      ...reducers<br/>    }),<br/>    initialState, // Hydrate the store with server-side data<br/>    devtools<br/>  )<br/>}</span><span id="3d67" class="lx kr if lt b fv mc lz l ma mb">export default function initStore (initialState) {<br/>  // Make sure to create a new store for every server-side request so that data<br/>  // isn't shared between connections (which would be bad)<br/>  if (!process.browser) {<br/>    return create(initialState)<br/>  }<br/>  <br/>  // Reuse store on the client-side<br/>  if (!reduxStore) {<br/>    reduxStore = create(initialState)<br/>  }</span><span id="7b31" class="lx kr if lt b fv mc lz l ma mb">  return reduxStore<br/>}</span></pre><p id="4923" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">åœ¨ä¸Šé¢çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯¼å‡ºäº†ä¸€ä¸ªé»˜è®¤å‡½æ•°<code class="eh md me mf lt b">initStore</code>ï¼Œå®ƒå°†ä½¿ç”¨æä¾›çš„<code class="eh md me mf lt b">initialState</code>åˆ›å»ºå•†åº—ã€‚å› ä¸ºNext.jsæ˜¯<strong class="je ig">åŒæ„çš„</strong>ï¼Œè¿™æ„å‘³ç€ä»£ç å°†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¿è¡Œã€‚åœ¨<code class="eh md me mf lt b">initStore</code>ä¸­ï¼Œæˆ‘ä»¬è¿˜æ£€æŸ¥è¯¥è¿›ç¨‹æ˜¯å¦æ­£åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç”¨åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºçš„<code class="eh md me mf lt b">reduxStore</code>ã€‚</p><p id="75f4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ— è®ºå“ªç§æƒ…å†µï¼Œæ¥ä¸‹æ¥éƒ½ä¼šè°ƒç”¨<code class="eh md me mf lt b">create</code>ã€‚è¿™ç”¨æˆ‘ä»¬çš„reducersã€initialStateå’ŒRedux DevToolsåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„redux storeï¼Œç”¨äºæ›´å¥½çš„å¼€å‘å®éªŒã€‚</p><h2 id="247c" class="lx kr if bd ks ml mm mn kw mo mp mq la jn mr ms le jr mt mu li jv mv mw lm mx dt translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å°†Reduxâ€œè¿æ¥â€åˆ°æˆ‘ä»¬çš„ç´¢å¼•é¡µé¢ã€‚</h2><p id="8454" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated"><strong class="je ig">ã€‚/pages/index.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="f0db" class="lx kr if lt b fv ly lz l ma mb">import initStore from '../lib/initRedux'<br/>import withRedux from 'next-redux-wrapper'</span><span id="76a7" class="lx kr if lt b fv mc lz l ma mb">const Index = () =&gt; &lt;div&gt;Welcome to next.js!&lt;/div&gt;</span><span id="8633" class="lx kr if lt b fv mc lz l ma mb">const mapStateToProps = () =&gt; ({})<br/>const mapDispatchToProps = () =&gt; ({})</span><span id="36ba" class="lx kr if lt b fv mc lz l ma mb">export default withRedux(initStore, mapStateToProps, mapDispatchToProps)(Index)</span></pre><p id="ba71" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘ä»¬é€šè¿‡ç”¨<code class="eh md me mf lt b">withRedux</code>åŒ…è£…ç»„ä»¶æ¥ä¿®æ”¹<code class="eh md me mf lt b">./pages/index.js</code>ã€‚<code class="eh md me mf lt b">withRedux</code>æ¥å—ä¸€ä¸ªè¿”å›redux storeçš„å‡½æ•°ä½œä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶æ¥å—ä¸¤ä¸ªé¢å¤–çš„å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹ç»„ä»¶å¯ç”¨çš„<code class="eh md me mf lt b">props</code>å¯¹è±¡ã€‚æˆ‘ä»¬å°†å¾ˆå¿«å¡«å†™è¿™äº›å†…å®¹ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸè¿æ¥äº†Reduxã€‚è®¿é—®localhost:3000ï¼Œå°†æ˜¾ç¤º<a class="ae my" href="http://extension.remotedev.io/" rel="noopener ugc nofollow" target="_blank"> Redux DevTools chromeæ‰©å±•</a>å·²å¯ç”¨ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£…å®ƒï¼Œè¯·å®‰è£…å®ƒã€‚</p><h1 id="3561" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">4.å®éªŒç¼©å‡å™¨</h1><p id="1bbe" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">Reducersæ˜¯å­˜å‚¨åº”ç”¨ç¨‹åºé€»è¾‘çš„åœ°æ–¹ã€‚åŠ¨ä½œè¿›æ¥ï¼Œreducerå†³å®šè¿™ä¸ªåŠ¨ä½œå¦‚ä½•æ”¹å˜çŠ¶æ€ã€‚</p><p id="fdfc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘ä»¬å…ˆåœ¨libä¸­æ–°å»ºä¸€äº›æ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«å«åš<code class="eh md me mf lt b">redux</code>å’Œ<code class="eh md me mf lt b">redux/reducers</code>ï¼Œåœ¨æ–°å»ºçš„<code class="eh md me mf lt b">reducers</code>æ–‡ä»¶å¤¹ä¸­å®šä¹‰ä¸€ä¸ªæ–‡ä»¶<code class="eh md me mf lt b">experiments.js</code>ã€‚</p><p id="917f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/redux/reducers/experiments . js</strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="2ab3" class="lx kr if lt b fv ly lz l ma mb">export default (state = {<br/>  active: {}<br/>}, { type, payload }) =&gt; {<br/>  switch (type) {<br/>    case 'START_EXPERIMENT':<br/>      let { name, variant } = payload<br/>      let active = Object.assign({}, state.active)<br/>      active[name] = variant<br/>      return {<br/>        active<br/>      }<br/>    default:<br/>      return state<br/>  }<br/>}</span><span id="438b" class="lx kr if lt b fv mc lz l ma mb">export function startExperiment ({name, variant}) {<br/>  return {<br/>    type: 'START_EXPERIMENT',<br/>    payload: {<br/>      name,<br/>      variant<br/>    }<br/>  }<br/>}</span></pre><p id="a7e0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘ä»¬çš„æ•´ä¸ªç¼©å‡å™¨éå¸¸ç®€å•â€”â€”å®ƒå¯¼å‡ºä¸€ä¸ªåˆå§‹çŠ¶æ€ä¸º<code class="eh md me mf lt b">{ active: {} }</code>çš„ç¼©å‡å™¨ã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçœŸæ­£éœ€è¦çŸ¥é“çš„æ˜¯å“ªäº›å®éªŒæ˜¯æ´»åŠ¨çš„ï¼Œæ‰€ä»¥è¿™å°±è¶³å¤Ÿäº†ã€‚</p><p id="460f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºç¼©å‡å™¨çš„<code class="eh md me mf lt b">switch</code>è¯­å¥å®šä¹‰äº†ä¸€ä¸ª<code class="eh md me mf lt b">case 'START_EXPERIMENT'</code>ã€‚è¿™å°†ä¸ºæˆ‘ä»¬ç”¨å®éªŒçš„<strong class="je ig">åç§°</strong>å®šä¹‰çš„<code class="eh md me mf lt b">active</code>çŠ¶æ€æ·»åŠ ä¸€ä¸ªæ–°çš„é”®ï¼Œè¯¥å€¼å°†æ˜¯æ´»åŠ¨çš„<strong class="je ig">å˜é‡</strong>ã€‚</p><p id="0d70" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æœ€åï¼Œæˆ‘ä»¬å¯¼å‡ºä¸€ä¸ª<em class="kp">åŠ¨ä½œ</em> <code class="eh md me mf lt b">startExperiment</code>ã€‚è¿™éœ€è¦ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œå¹¶æœŸæœ›ä¸€ä¸ªå®éªŒ<code class="eh md me mf lt b">name</code>ï¼Œä»¥åŠå“ªä¸ª<code class="eh md me mf lt b">variant</code>æ˜¯æ´»åŠ¨çš„ã€‚</p><p id="6ea8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/redux/reducers/index . js</strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="147d" class="lx kr if lt b fv ly lz l ma mb">import experiments from './experiments'</span><span id="6b64" class="lx kr if lt b fv mc lz l ma mb">export default {<br/>  experiments<br/>}</span></pre><p id="5179" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ¯å½“æˆ‘ä»¬æœ‰æ–°çš„å‡é€Ÿå™¨æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å°†å…¶æ·»åŠ åˆ°æ­¤å¯¼å‡ºä¸­ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå®ƒè¿æ¥èµ·æ¥ã€‚</p><p id="3300" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/initRedux.js </strong></p><p id="1854" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">åœ¨<code class="eh md me mf lt b">./lib/initRedux.js</code>ä¸­æ›´æ¢ç®¡è·¯:</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="de0b" class="lx kr if lt b fv ly lz l ma mb">let reducers = {}</span></pre><p id="8344" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ä½¿ç”¨:</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="4ba6" class="lx kr if lt b fv ly lz l ma mb">import reducers from './redux/reducers'</span></pre><p id="7b5e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> Reduxç°åœ¨ä¸æˆ‘ä»¬çš„å‡é€Ÿå™¨â€œè¿æ¥â€åœ¨ä¸€èµ·ã€‚</strong></p><p id="1d4b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨Next.jsçš„<code class="eh md me mf lt b">getInitialProps</code>åœ¨æœåŠ¡å™¨ç«¯å¼€å§‹å®éªŒã€‚</p><h1 id="cffb" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">5.<code class="eh md me mf lt b">dispatch</code>æ¥è‡ª<code class="eh md me mf lt b">getInitialProps</code></h1><p id="22cb" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">åœ¨<code class="eh md me mf lt b">const Index = ...</code>è¡Œä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ·»åŠ ä¸€ä¸ª<code class="eh md me mf lt b">getInitialProps</code>å‡½æ•°ã€‚å½“æˆ‘ä»¬ä½¿ç”¨<code class="eh md me mf lt b">withRedux</code>åŒ…è£…æˆ‘ä»¬çš„ç»„ä»¶æ—¶ï¼Œè¿™ä½¿å¾—Redux <code class="eh md me mf lt b">store</code>åœ¨ä¼ é€’ç»™<code class="eh md me mf lt b">getInitialProps</code>çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­æ˜¯å¯è®¿é—®çš„ã€‚æˆ‘ä»¬éœ€è¦è°ƒç”¨æˆ‘ä»¬åœ¨reducerä¸­å®šä¹‰çš„åŠ¨ä½œï¼Œæ‰€ä»¥ä¹Ÿåœ¨é¡¶éƒ¨å¯¼å…¥å®ƒã€‚</p><p id="83b1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/pages/index.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="b283" class="lx kr if lt b fv ly lz l ma mb">import { startExperiment } from '../lib/redux/reducers/experiments'</span><span id="df71" class="lx kr if lt b fv mc lz l ma mb">// ...</span><span id="e9bf" class="lx kr if lt b fv mc lz l ma mb">/* context: {req, res, query, isServer, store} */<br/>Index.getInitialProps = ({store}) =&gt; {<br/>  const dispatchStartExperiment = ({name, variant}) =&gt; {<br/>    store.dispatch(startExperiment({<br/>      name,<br/>      variant<br/>    }))<br/>  }<br/>}</span><span id="7486" class="lx kr if lt b fv mc lz l ma mb">// ...</span></pre><p id="01e9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°æ¥åˆ†æ´¾ä¸€ä¸ª<code class="eh md me mf lt b">startExperiment</code>åŠ¨ä½œï¼Œå¹¶æ¥å—å®éªŒ<strong class="je ig">åç§°</strong>å’Œ<strong class="je ig">å˜é‡</strong>ä½œä¸ºå‚æ•°ã€‚</p><p id="7766" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®éªŒã€‚æˆ‘ä»¬è‡ªç„¶ä¼šç”¨JavaScriptæ¥å®ç°ã€‚</p><h1 id="e150" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated"><strong class="ak"> 6ã€‚åˆ›å»ºæ–°å®éªŒ()</strong></h1><p id="638e" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®éªŒç±»ï¼Œæ‰©å±•<code class="eh md me mf lt b">EventEmitter</code>ä½œä¸ºä¸€ç§ç®€å•çš„æ–¹æ³•æ¥æŒ‚é’©æ¯ä¸ªå®éªŒçš„çŠ¶æ€å˜åŒ–ã€‚</p><p id="29e5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">é¦–å…ˆæ˜¯å®éªŒç­ã€‚</p><p id="0d9a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">åœ¨å…¶ä¸­ï¼Œä¸€ä¸ªç»™å®šå˜é‡åˆ—è¡¨å’Œidçš„<code class="eh md me mf lt b">selectVariant</code>ç®—æ³•å°†æ€»æ˜¯é€‰æ‹©ç›¸åŒçš„å˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ç¡®ä¿ç”¨æˆ·æ€»æ˜¯å¾—åˆ°ç›¸åŒçš„å®éªŒï¼Œä½ éœ€è¦åšçš„å°±æ˜¯ä¼ å…¥ç›¸åŒçš„idã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨cookieä¸­å­˜å‚¨ä»–ä»¬çš„userIdæˆ–å…¶æ•£åˆ—æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™ä¸ªç®—æ³•æ˜¯æˆ‘ä»<a class="ae my" href="https://github.com/pushtell/react-ab-test/blob/master/src/Experiment.jsx#L51" rel="noopener ugc nofollow" target="_blank"> react-ab-test </a>å€Ÿæ¥çš„ã€‚</p><p id="1394" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘è®¤ä¸ºä½¿ç”¨Reactç»„ä»¶æ¥ç»´æŠ¤å®éªŒçš„çŠ¶æ€è¿‡äºå¤æ‚ï¼Œreduxæ›´é€‚åˆè¿™é¡¹ä»»åŠ¡ï¼Œä½†â€œæ”¯æŒâ€ç®—æ³•<a class="mz na gr" href="https://medium.com/u/1b78fc47a4ad?source=post_page-----5392799c15c7--------------------------------" rel="noopener" target="_blank"> John Wehr </a>ã€‚ğŸ‘</p><p id="46b9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/experience . js</strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="f6a1" class="lx kr if lt b fv ly lz l ma mb">import { EventEmitter } from 'events'<br/>import crc32 from 'fbjs/lib/crc32'</span><span id="288c" class="lx kr if lt b fv mc lz l ma mb">export default class Experiment extends EventEmitter {<br/>  constructor ({<br/>    name,<br/>    variants,<br/>    userId<br/>  }) {<br/>    super()<br/>    this.name = name<br/>    this.variants = variants<br/>    this.userId = userId<br/>  }</span><span id="e9b1" class="lx kr if lt b fv mc lz l ma mb">selectVariant (userId) {</span><span id="b471" class="lx kr if lt b fv mc lz l ma mb">    /*<br/>    Choosing a weighted variant:<br/>      For C, A, B with weights 2, 4, 8<br/>      variants = A, B, C<br/>      weights = 4, 8, 2<br/>      weightSum = 14<br/>      weightedIndex = 9<br/>      AAAABBBBBBBBCC<br/>      ========^<br/>      Select B<br/>    */</span><span id="1565" class="lx kr if lt b fv mc lz l ma mb">    // Sorted array of the variant names, example: ["A", "B", "C"]<br/>    const variants = Object.keys(this.variants).sort()</span><span id="c0a8" class="lx kr if lt b fv mc lz l ma mb">    // Array of the variant weights, also sorted by variant name. For example, if<br/>    // variant C had weight 2, variant A had weight 4, and variant B had weight 8<br/>    // return [4, 8, 2] to correspond with ["A", "B", "C"]<br/>    const weights = variants.reduce((weights, variant) =&gt; {<br/>      weights.push(this.variants[variant].weight)<br/>      return weights<br/>    }, [])</span><span id="6d1e" class="lx kr if lt b fv mc lz l ma mb">    // Sum the weights<br/>    const weightSum = weights.reduce((a, b) =&gt; {<br/>      return a + b<br/>    }, 0)</span><span id="bf3a" class="lx kr if lt b fv mc lz l ma mb">    // A random number between 0 and weightSum<br/>    let weightedIndex = typeof userId === 'string' ? Math.abs(crc32(userId) % weightSum) : Math.floor(Math.random() * weightSum)</span><span id="fff6" class="lx kr if lt b fv mc lz l ma mb">    // Iterate through the sorted weights, and deduct each from the weightedIndex.<br/>    // If weightedIndex drops &lt; 0, select the variant. If weightedIndex does not<br/>    // drop &lt; 0, default to the last variant in the array that is initially assigned.<br/>    let selectedVariant = variants[variants.length - 1]<br/>    for (let index = 0; index &lt; weights.length; index++) {<br/>      weightedIndex -= weights[index]<br/>      if (weightedIndex &lt; 0) {<br/>        selectedVariant = variants[index]<br/>        break<br/>      }<br/>    }</span><span id="8df3" class="lx kr if lt b fv mc lz l ma mb">    return selectedVariant<br/>  }</span><span id="f2af" class="lx kr if lt b fv mc lz l ma mb">  start ({ userId }) {<br/>    userId = userId || this.userId<br/>    let variant = this.selectVariant(userId)<br/>    this.emit('variant.selected', { name: this.name, variant })<br/>  }<br/>}</span></pre><p id="86fa" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">è®©æˆ‘ä»¬ç”¨å®ƒæ¥åšä¸€ä¸ªå®éªŒï¼</p><p id="a5cd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/experiments/headerText.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="20de" class="lx kr if lt b fv ly lz l ma mb">import Experiment from '../lib/Experiment'</span><span id="7684" class="lx kr if lt b fv mc lz l ma mb">const headerTextExperiment = new Experiment({<br/>  name: 'Header Text',<br/>  variants: {<br/>    control: {<br/>      weight: 50,<br/>      displayName: 'control'<br/>    },<br/>    mine: {<br/>      weight: 50,<br/>      displayName: 'mine'<br/>    }<br/>  }<br/>})</span><span id="8aba" class="lx kr if lt b fv mc lz l ma mb">export default headerTextExperiment</span></pre><p id="4afe" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">åœ¨æˆ‘ä»¬å®šä¹‰çš„å®éªŒç±»ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰ä¸€äº›åˆå§‹åŒ–é€‰é¡¹çš„å¯¹è±¡:1)å®éªŒçš„åç§°ï¼Œä»¥åŠ2)å˜é‡åŠå…¶å„è‡ªçš„æƒé‡ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§å˜ä½“ï¼Œå¯¹åŠåˆ†å‰²ã€‚</p><h1 id="18f5" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">7.æ¿€æ´»å®éªŒ</h1><p id="1290" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">æˆ‘ä»¬æƒ³æ¿€æ´»<strong class="je ig">ä¸Šçš„å®éªŒã€‚/pages/index.jsï¼Œ</strong>æ‰€ä»¥è®©æˆ‘ä»¬å¯¼å…¥å®ƒï¼Œå¹¶åœ¨getInitialPropsä¸­æ¿€æ´»å®ƒã€‚æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œå¦‚æœuserIdå­˜åœ¨ï¼Œæˆ‘ä»¬å°†å¸Œæœ›ä¼ å…¥ä¸€ä¸ªuserIdï¼Œæ‰€ä»¥ä¸ºäº†æ¼”ç¤ºèµ·è§ï¼Œæˆ‘ä»¬å‡è®¾å®ƒåœ¨cookiesä¸­æ˜¯å¯ç”¨çš„ã€‚</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="f2e5" class="lx kr if lt b fv ly lz l ma mb">npm install --save next-cookies@1</span></pre><p id="5885" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/pages/index.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="87ab" class="lx kr if lt b fv ly lz l ma mb">import initStore from '../lib/initRedux'<br/>import withRedux from 'next-redux-wrapper'<br/>import { startExperiment } from '../lib/redux/reducers/experiments'<br/><strong class="lt ig">import headerTextExperiment from '../experiments/headerText'<br/>import cookies from 'next-cookies'</strong></span><span id="1155" class="lx kr if lt b fv mc lz l ma mb"><strong class="lt ig">const Index = ({experiments}) =&gt; (<br/>  &lt;div&gt;<br/>    { experiments.active[headerTextExperiment.name] === 'control' ? "Welcome to Next.js!" : null }<br/>    { experiments.active[headerTextExperiment.name] === 'mine' ? "Welcome to MY Next.js!" : null }<br/>  &lt;/div&gt;<br/>)</strong></span><span id="1f49" class="lx kr if lt b fv mc lz l ma mb">/* context: {req, res, query, isServer, store} */<br/><strong class="lt ig">Index.getInitialProps = (ctx) =&gt; {<br/>  const { store } = ctx</strong><br/>  const dispatchStartExperiment = ({name, variant}) =&gt; {<br/>    console.log('starting experiment')<br/>    store.dispatch(startExperiment({<br/>      name,<br/>      variant<br/>    }))<br/>  }</span><span id="8bd9" class="lx kr if lt b fv mc lz l ma mb">  <strong class="lt ig">const activeExperiments = [<br/>    headerTextExperiment<br/>  ]</strong></span><span id="2f76" class="lx kr if lt b fv mc lz l ma mb"><strong class="lt ig">  headerTextExperiment.once('variant.selected', dispatchStartExperiment)</strong></span><span id="c898" class="lx kr if lt b fv mc lz l ma mb"><strong class="lt ig">  let { userId } = cookies(ctx)<br/>  activeExperiments.forEach((experiment) =&gt; {<br/>    experiment.start({userId})<br/>  })</strong><br/>}</span><span id="2f97" class="lx kr if lt b fv mc lz l ma mb"><strong class="lt ig">const mapStateToProps = ({ experiments }) =&gt; ({<br/>  experiments<br/>})</strong><br/>const mapDispatchToProps = () =&gt; ({})</span><span id="54c9" class="lx kr if lt b fv mc lz l ma mb">export default withRedux(initStore, mapStateToProps, mapDispatchToProps)(Index)</span></pre><p id="962f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæˆ‘ç”¨ç²—ä½“å­—æ ‡å‡ºäº†å˜åŒ–ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥<code class="eh md me mf lt b">headerTextExperiment</code>å’Œ<code class="eh md me mf lt b">cookies</code>ã€‚<code class="eh md me mf lt b">cookies</code>éœ€è¦nextçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ‰€ä»¥å¿«é€Ÿé‡æ„getInitialPropsä»¥åœ¨é¡¶éƒ¨æš´éœ²å®ƒã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¦æ¿€æ´»çš„å®éªŒæ•°ç»„ï¼Œå¹¶ä½¿ç”¨forEachæ¥å¯åŠ¨æ¯ä¸ªå®éªŒï¼Œå¦‚æœå¯ç”¨çš„è¯ï¼Œä¼ å…¥ä¸€ä¸ª<code class="eh md me mf lt b">userId</code>ã€‚</p><p id="fc56" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å®éªŒå¯åŠ¨åï¼Œä¼šé€‰æ‹©ä¸€ä¸ªå˜é‡ï¼Œå¹¶å‘å‡ºä¸€ä¸ªäº‹ä»¶:<code class="eh md me mf lt b">'variant.selected'</code>ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å°†å‘reduxå‘é€ä¸€ä¸ªåŠ¨ä½œï¼Œè¯¥åŠ¨ä½œå°†æ›´æ–°å…¨å±€çŠ¶æ€ã€‚å½“çŠ¶æ€æ”¹å˜æ—¶ï¼Œ<code class="eh md me mf lt b">mapStateToProps</code>å°†è¢«è§¦å‘ï¼Œè®©æˆ‘ä»¬çš„ç»„ä»¶é€šè¿‡å®ƒçš„<code class="eh md me mf lt b">props</code>è®¿é—®æ­£åœ¨è¿›è¡Œçš„å®éªŒã€‚</p><p id="7a4d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å¦‚æœå®éªŒçš„å˜ä½“â€œcontrolâ€æ˜¯æ´»åŠ¨çš„ï¼Œæˆ‘ä»¬æ˜¾ç¤ºåŸå§‹æ–‡æœ¬ï¼Œå¦‚æœå˜ä½“â€œmineâ€æ˜¯æ´»åŠ¨çš„ï¼Œæˆ‘ä»¬æ˜¾ç¤ºæ›¿ä»£æ–‡æœ¬ã€‚</p><h1 id="f32a" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">8.ä½¿ç”¨åˆ†æä¸­é—´ä»¶è·Ÿè¸ªäº‹ä»¶</h1><p id="5d4a" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">å› ä¸ºæˆ‘ä»¬ä½¿ç”¨reduxæ¥æ”¹å˜æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‚é’©åˆ°å®ƒï¼Œå¹¶åœ¨reduxåŠ¨ä½œå‘ç”Ÿæ—¶å‘å‡ºåˆ†æäº‹ä»¶ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„åˆ†æä¸­é—´ä»¶ã€‚æˆ‘å°†å±•ç¤ºå¦‚ä½•ä¸google analyticsä»¥åŠfacebook analyticsé›†æˆã€‚ä½ å¯ä»¥ç”¨ä½ çš„æƒ³è±¡åŠ›è¿›è¡Œå…¶ä»–çš„æ•´åˆã€‚æˆ‘ç‰¹åˆ«å–œæ¬¢Mixpanelçš„è¿™ç§ç±»å‹çš„åˆ†æã€‚</p><p id="b051" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/analytics.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="fd91" class="lx kr if lt b fv ly lz l ma mb">export const track = ({event, value}) =&gt; {<br/>  console.log('track', event, {<br/>    value<br/>  })</span><span id="b9ef" class="lx kr if lt b fv mc lz l ma mb">  if (process.browser) {<br/>    window.ga &amp;&amp; window.ga('send', 'event', {<br/>      eventCategory: event,<br/>      eventLabel: value<br/>    })<br/>    window.fbq &amp;&amp; window.fbq('track', event, {<br/>      value<br/>    })<br/>  }<br/>}</span></pre><p id="1057" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/redux/middleware/analytics . js</strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="8c60" class="lx kr if lt b fv ly lz l ma mb">import { track } from '../../analytics'</span><span id="b5ec" class="lx kr if lt b fv mc lz l ma mb">export default ({ dispatch, getState }) =&gt; next =&gt; action =&gt; {<br/>  const {<br/>    analytics<br/>  } = action.meta || {}</span><span id="27b2" class="lx kr if lt b fv mc lz l ma mb">next(action)</span><span id="e102" class="lx kr if lt b fv mc lz l ma mb">if (analytics) {<br/>    track(analytics)<br/>  }<br/>}</span></pre><p id="4f39" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/initRedux.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="d0cb" class="lx kr if lt b fv ly lz l ma mb"><strong class="lt ig">import analyticsMiddleware from './redux/middleware/analytics'</strong></span><span id="0112" class="lx kr if lt b fv mc lz l ma mb">// ...</span><span id="2c75" class="lx kr if lt b fv mc lz l ma mb">function create (initialState = {}) {<br/>  return createStore(<br/>    combineReducers({ // Setup reducers<br/>      ...reducers<br/>    }),<br/>    initialState, // Hydrate the store with server-side data<br/>    <strong class="lt ig">compose(<br/>      applyMiddleware(<br/>        analyticsMiddleware<br/>      ),<br/>      devtools<br/>    )</strong><br/>  )<br/>}</span></pre><p id="8de7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘ä»¬ä½¿ç”¨<code class="eh md me mf lt b">compose</code>å’Œ<code class="eh md me mf lt b">applyMiddleware</code>æ˜¯ä¸ºäº†ä½¿ç”¨å¤šä¸ªä¸­é—´ä»¶ä»¥åŠRedux DevToolsã€‚</p><p id="d112" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ç°åœ¨æˆ‘ä»¬å¯ä»¥ç®€å•åœ°åœ¨reduxåŠ¨ä½œä¸­æ·»åŠ ä¸€ä¸ª<code class="eh md me mf lt b">meta</code>é”®ï¼Œä»¥ä¾¿åœ¨å®ƒä»¬å‘ç”Ÿæ—¶è·Ÿè¸ªå®ƒä»¬ã€‚</p><p id="ee93" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/redux/reducers/experiments . js</strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="32c1" class="lx kr if lt b fv ly lz l ma mb">// ...</span><span id="949b" class="lx kr if lt b fv mc lz l ma mb">export function startExperiment ({name, variant}) {<br/>  return {<br/>    type: 'START_EXPERIMENT',<br/>    payload: {<br/>      name,<br/>      variant<br/>    }<strong class="lt ig">,</strong><br/>    <strong class="lt ig">meta: {<br/>      analytics: {<br/>        event: `${name} Experiment Played`,<br/>        value: variant<br/>      }<br/>    }</strong><br/>  }<br/>}</span></pre><p id="d6c8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ç°åœ¨ï¼Œæ¯æ¬¡è°ƒåº¦startExperimentæ—¶ï¼Œä¸€ä¸ªäº‹ä»¶â€œNAME Experiment Playedâ€å°†è¢«å‘é€åˆ°æ‚¨çš„å…·æœ‰æ‰€é€‰å˜ä½“çš„åˆ†æç«¯ç‚¹ã€‚</p><h1 id="be77" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">9.è·Ÿè¸ªå…¶ä»–äº‹ä»¶</h1><p id="5ecd" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">ä½†æ˜¯ï¼ŒæŒ‰ç…§è®¾è®¡ï¼Œæ­¤æ“ä½œä¸ä¼šåœ¨å®¢æˆ·ç«¯å‘ç”Ÿã€‚åªæœ‰æœåŠ¡å™¨ã€‚</p><p id="5fd0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„å¼‚å¸¸ï¼Œä»¥ä¾¿åœ¨ç»„ä»¶è£…è½½åˆ°å®¢æˆ·æœºä¸Šæ—¶ä¹Ÿè·Ÿè¸ªè¿™ä¸ªäº‹ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è¿™ä¸ªæ•°æ®ã€‚æœ‰å¾ˆå¤šå¾ˆå¥½çš„ç†ç”±éœ€è¦åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¿›è¡Œåˆ†æã€‚ä¾‹å¦‚ï¼ŒæŸ¥çœ‹æœ‰å¤šå°‘äººè¯·æ±‚äº†ä¸€ä¸ªé¡µé¢ï¼Œä½†æ˜¯åœ¨å®ƒåŠ è½½ä¹‹å‰å› ä¸ºæŸç§åŸå› è€Œæ”¾å¼ƒäº†ã€‚</p><p id="c043" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘ä»¬éœ€è¦ä¸€äº›ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæ‰€ä»¥è¿™å¯¼è‡´äº†ä¸€äº›é‡æ„ï¼Œä»¥ä½¿Index extend Reactçš„ç»„ä»¶ï¼Œä»¥åŠå°†getInitialPropsç§»å…¥å…¶ä¸­ã€‚</p><p id="09ce" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/pages/index.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="f67c" class="lx kr if lt b fv ly lz l ma mb">// ...<br/><strong class="lt ig">import { Component } from 'react'<br/>import { track } from '../lib/analytics'</strong></span><span id="65f4" class="lx kr if lt b fv mc lz l ma mb"><strong class="lt ig">class Index extends Component {<br/>  static getInitialProps (ctx) {</strong><br/>    /* ctx: {req, res, query, isServer, store} */<br/>    const { store } = ctx<br/>    const dispatchStartExperiment = ({name, variant}) =&gt; {<br/>      store.dispatch(startExperiment({<br/>        name,<br/>        variant<br/>      }))<br/>    }</span><span id="50ac" class="lx kr if lt b fv mc lz l ma mb">    const activeExperiments = [<br/>      headerTextExperiment<br/>    ]<br/>  <br/>    headerTextExperiment.once('variant.selected', dispatchStartExperiment)<br/>  <br/>    let { userId } = cookies(ctx)<br/>    activeExperiments.forEach((experiment) =&gt; {<br/>      experiment.start({userId})<br/>    })<br/>  <strong class="lt ig">}</strong></span><span id="0fc6" class="lx kr if lt b fv mc lz l ma mb">  <strong class="lt ig">componentDidMount () {<br/>    const { experiments } = this.props</strong></span><span id="7ca6" class="lx kr if lt b fv mc lz l ma mb"><strong class="lt ig">    if (experiments.active[headerTextExperiment.name]) {<br/>      // startExperiment just returns the redux action object<br/>      // we can make use of this to look up the analytics<br/>      // event name and value<br/>      let analytics = startExperiment({<br/>        name: headerTextExperiment.name,<br/>        variant: experiments.active[headerTextExperiment.name]<br/>      }).meta.analytics<br/>      track({<br/>        event: analytics.event, <br/>        value: analytics.value<br/>      })<br/>    }<br/>  }</strong></span><span id="e593" class="lx kr if lt b fv mc lz l ma mb">  <strong class="lt ig">render () {<br/>    const { experiments } = this.props<br/>    return </strong>(<br/>      &lt;div&gt;<br/>        { experiments.active[headerTextExperiment.name] === 'control' ? "Welcome to Next.js!" : null }<br/>        { experiments.active[headerTextExperiment.name] === 'mine' ? "Welcome to MY Next.js!" : null }<br/>      &lt;/div&gt;<br/>    )<br/>  <strong class="lt ig">}</strong><br/><strong class="lt ig">}</strong></span><span id="1d63" class="lx kr if lt b fv mc lz l ma mb">// ...</span></pre><p id="efa4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ–°çš„<code class="eh md me mf lt b">componentDidMount</code>åŠŸèƒ½åªåœ¨å®¢æˆ·ç«¯è¿è¡Œã€‚å¦‚æœä¸€ä¸ªå®éªŒæ˜¯æ´»åŠ¨çš„ï¼Œæˆ‘ä»¬åªæ˜¯ä»reduxåŠ¨ä½œå¯¹è±¡ä¸­ç”¨ç›¸åŒçš„å€¼è°ƒç”¨<code class="eh md me mf lt b">track</code>ã€‚</p><h1 id="151b" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">10.åŒ…æ‹¬ç¬¬ä¸‰æ–¹åˆ†æåº“</h1><p id="4271" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä»ä»»ä½•æä¾›çš„snippetçš„<code class="eh md me mf lt b">&lt;script&gt;</code>æ ‡ç­¾ä¸­æå–javascriptï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨ä¸ºçº¯jsã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨Reactçš„<code class="eh md me mf lt b">dangerouslySetInnerHTML</code> APIä½¿ç”¨<code class="eh md me mf lt b">next/head</code>æ¥æ’å…¥å®ƒä»¬ã€‚</p><p id="d1f0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/pages/index.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="0e05" class="lx kr if lt b fv ly lz l ma mb"><strong class="lt ig">import ga from '../lib/analytics/ga'<br/>import fb from '../lib/analytics/fb'<br/>import Head from 'next/head'</strong></span><span id="62a2" class="lx kr if lt b fv mc lz l ma mb">class Index extends Component {<br/>  // ...</span><span id="8257" class="lx kr if lt b fv mc lz l ma mb">  render () {<br/>    const { experiments } = this.props<br/>    return (<br/>      &lt;div&gt;<br/>        <strong class="lt ig">&lt;Head&gt;<br/>          &lt;title&gt;SSR Split Tests&lt;/title&gt;<br/>          &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;<br/>          &lt;script dangerouslySetInnerHTML={{__html: ga}} /&gt;<br/>          &lt;script dangerouslySetInnerHTML={{__html: fb}} /&gt;<br/>        &lt;/Head&gt;</strong><br/>        { experiments.active[headerTextExperiment.name] === 'control' ? "Welcome to Next.js!" : null }<br/>        { experiments.active[headerTextExperiment.name] === 'mine' ? "Welcome to MY Next.js!" : null }<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span><span id="ce21" class="lx kr if lt b fv mc lz l ma mb">// ...</span></pre><p id="06ad" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/analytics/fb.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="566d" class="lx kr if lt b fv ly lz l ma mb">export default `<br/>if(typeof fbq === 'undefined') {<br/>  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?<br/>  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;<br/>  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;<br/>  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,<br/>  document,'script','<a class="ae my" href="https://connect.facebook.net/en_US/fbevents.js'" rel="noopener ugc nofollow" target="_blank">https://connect.facebook.net/en_US/fbevents.js'</a>);<br/>  fbq('init', '<strong class="lt ig">YOUR FB ID GOES HERE</strong>');<br/>  fbq('track', 'PageView');<br/>} else {<br/>  fbq('track', 'PageView');<br/>}<br/>`</span></pre><p id="6957" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/analytics/ga.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="e10d" class="lx kr if lt b fv ly lz l ma mb">export default `<br/>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){<br/>  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),<br/>  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)<br/>  })(window,document,'script','<a class="ae my" href="https://www.google-analytics.com/analytics.js','ga'" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com/analytics.js','ga'</a>);<br/>  ga('create', '<strong class="lt ig">YOUR GA ID GOES HERE</strong>', 'auto');<br/>  ga('send', 'pageview');<br/>`</span></pre><h1 id="516b" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">11.å¦‚æœæœ‰ç›®æ ‡ï¼Œä¼šæœ‰å¸®åŠ©</h1><p id="51f3" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç›®æ ‡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªçŸ¥é“ä¸€ä¸ªå®éªŒä½•æ—¶è¢«è§‚çœ‹ã€‚</p><p id="227e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘æœ€åˆä¸ºä¸€ä¸ªç™»å½•é¡µé¢åšäº†æ‰€æœ‰è¿™äº›ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­è¿™ä¸ªä¾‹å­ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªé¡µé¢çš„ç›®æ ‡æ˜¯è®©ç”¨æˆ·è¾“å…¥ä»–ä»¬çš„ç”µå­é‚®ä»¶åœ°å€å¹¶æäº¤å®ƒï¼</p><p id="1a34" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å°†ä»–ä»¬çš„ç”µå­é‚®ä»¶å­˜å‚¨åœ¨æˆ‘ä»¬çš„redux storeä¸­ï¼Œå¹¶è¯´å£°è°¢è°¢ã€‚è¿™ä¹Ÿå±•ç¤ºäº†æœªæ¥è§¦çš„<code class="eh md me mf lt b">mapDispatchToProps</code>å’Œä½¿ç”¨å¤šä¸ªå‡é€Ÿå™¨ã€‚</p><p id="ca2d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ä¼¼ä¹æˆ‘ä»¬æ˜¯å¦‚ä½•è·Ÿè¸ª<strong class="je ig">çº¿ç´¢</strong>çš„ï¼Œè®©æˆ‘ä»¬åšä¸€ä¸ª<code class="eh md me mf lt b">lead</code>å‡é€Ÿå™¨ã€‚</p><p id="0a6e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/redux/reducers/lead . js</strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="a681" class="lx kr if lt b fv ly lz l ma mb">export default (state = {<br/>  email: null<br/>}, { type, payload }) =&gt; {<br/>  switch (type) {<br/>    case 'SIGNUP_LEAD':<br/>      let { email } = payload<br/>      return {<br/>        ...state,<br/>        email<br/>      }<br/>    default:<br/>      return state<br/>  }<br/>}</span><span id="5f34" class="lx kr if lt b fv mc lz l ma mb">export function signupLead ({email}) {<br/>  return {<br/>    type: 'SIGNUP_LEAD',<br/>    payload: {<br/>      email<br/>    },<br/>    meta: {<br/>      analytics: {<br/>        event: `Signed Up`,<br/>        value: email<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="f484" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/lib/redux/reducers/index . js</strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="be70" class="lx kr if lt b fv ly lz l ma mb">import experiments from './experiments'<br/>import lead from './lead'</span><span id="76be" class="lx kr if lt b fv mc lz l ma mb">export default {<br/>  experiments,<br/>  lead<br/>}</span></pre><p id="6582" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„ç»„ä»¶æ¥åŒ…å«æ³¨å†Œè¡¨å•ï¼Œå¹¶æ˜¾ç¤ºåœ¨ç´¢å¼•é¡µé¢ä¸Šã€‚</p><p id="ac80" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/components/SignUpForm.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="3999" class="lx kr if lt b fv ly lz l ma mb">export default function SignUpForm () {<br/>  function submit(e) {<br/>    e.preventDefault()<br/>    let email = e.target.elements.email.value<br/>    if (email) {<br/>      alert(email)<br/>    } else {<br/>      alert("Email is Required")<br/>    }<br/>  }<br/>  return (<br/>    &lt;form onSubmit={submit}&gt;<br/>      &lt;input name="email" type="email" placeholder="Enter your email..." /&gt;<br/>      &lt;button&gt;Submit&lt;/button&gt;<br/>    &lt;/form&gt;<br/>  )<br/>}</span></pre><p id="0aad" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/pages/index.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="a2d5" class="lx kr if lt b fv ly lz l ma mb"><strong class="lt ig">import SignUpForm from '../components/SignUpForm'</strong></span><span id="708c" class="lx kr if lt b fv mc lz l ma mb">// ...  <br/>  render () {<br/>    const { experiments } = this.props<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;Head&gt;<br/>          &lt;title&gt;SSR Split Tests&lt;/title&gt;<br/>          &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;<br/>          &lt;script dangerouslySetInnerHTML={{__html: ga}} /&gt;<br/>          &lt;script dangerouslySetInnerHTML={{__html: fb}} /&gt;<br/>        &lt;/Head&gt;<br/>        { experiments.active[headerTextExperiment.name] === 'control' ? &lt;h1&gt;Welcome to Next.js!&lt;/h1&gt; : null }<br/>        { experiments.active[headerTextExperiment.name] === 'mine' ? &lt;h1&gt;Welcome to MY Next.js!&lt;/h1&gt; : null }<br/>        <strong class="lt ig">&lt;SignUpForm/&gt;</strong><br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>// ...</span></pre><h1 id="c1fe" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">12.å°†reduxè¿æ¥åˆ°è¡¨å•</h1><p id="ec1d" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">æˆ‘ä»¬çš„è¡¨å•éœ€è¦è®¿é—®æˆ‘ä»¬å®šä¹‰çš„reduxåŠ¨ä½œï¼Œä»¥åŠæ¥è‡ªæˆ‘ä»¬å­˜å‚¨çš„<code class="eh md me mf lt b">lead</code>çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="eh md me mf lt b">mapDispatchToProps</code>å’Œ<code class="eh md me mf lt b">mapStateToProps</code>æ¥æä¾›è®¿é—®ã€‚</p><p id="9785" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/pages/index.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="3393" class="lx kr if lt b fv ly lz l ma mb">// ...<br/><strong class="lt ig">import { signupLead}  from '../lib/redux/reducers/lead'</strong></span><span id="4c82" class="lx kr if lt b fv mc lz l ma mb">class Index extends Component {<br/>  // ...</span><span id="1000" class="lx kr if lt b fv mc lz l ma mb">  render () {<br/>    const { experiments<strong class="lt ig">, lead, signupLead</strong> } = this.props<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;Head&gt;<br/>          &lt;title&gt;SSR Split Tests&lt;/title&gt;<br/>          &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;<br/>          &lt;script dangerouslySetInnerHTML={{__html: ga}} /&gt;<br/>          &lt;script dangerouslySetInnerHTML={{__html: fb}} /&gt;<br/>        &lt;/Head&gt;<br/>        { experiments.active[headerTextExperiment.name] === 'control' ? &lt;h1&gt;Welcome to Next.js!&lt;/h1&gt; : null }<br/>        { experiments.active[headerTextExperiment.name] === 'mine' ? &lt;h1&gt;Welcome to MY Next.js!&lt;/h1&gt; : null }<br/><strong class="lt ig">        &lt;SignUpForm lead={lead} signup={signupLead}/&gt;<br/></strong>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span><span id="14e4" class="lx kr if lt b fv mc lz l ma mb">const mapStateToProps = ({ experiments<strong class="lt ig">, lead</strong> }) =&gt; ({<br/>  experiments,<br/>  <strong class="lt ig">lead</strong><br/>})<br/><strong class="lt ig">const mapDispatchToProps = (dispatch, ownProps) =&gt; ({<br/>  signupLead: ({email}) =&gt; {<br/>    dispatch(signupLead({email}))<br/>  }<br/>})</strong></span><span id="7086" class="lx kr if lt b fv mc lz l ma mb">// ...</span></pre><p id="f495" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°å¯¼å…¥æ–°åŠ¨ä½œï¼Œç„¶åç”¨<code class="eh md me mf lt b">mapDispatchToProps</code>ä¸­çš„<code class="eh md me mf lt b">dispatch</code>å°†å®ƒæ˜ å°„åˆ°é“å…·ã€‚æˆ‘ä»¬è¿˜ä¿®æ”¹äº†<code class="eh md me mf lt b">mapStateToProps</code>æ¥è®¿é—®<code class="eh md me mf lt b">lead</code>çŠ¶æ€ã€‚</p><p id="48ab" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æœ€åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨æ–°çš„é“å…·æ¥å®Œæˆè¡¨æ ¼ï¼</p><p id="997b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">ã€‚/components/SignUpForm.js </strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="a591" class="lx kr if lt b fv ly lz l ma mb">export default function SignUpForm (<strong class="lt ig">{lead, signup}</strong>) {<br/>  function submit(e) {<br/>    e.preventDefault()<br/>    let email = e.target.elements.email.value<br/>    if (email) {<br/>      <strong class="lt ig">signup({email})</strong><br/>    } else {<br/>      alert("Email is Required")<br/>    }<br/>  }<br/>  return (<br/>    &lt;div&gt;<br/>      <strong class="lt ig">{typeof lead.email === 'string' &amp;&amp; lead.email.length &gt; 0 ? <br/>      &lt;p&gt;Hello {lead.email}&lt;/p&gt;<br/>      :<br/>      &lt;form onSubmit={submit}&gt;<br/>        &lt;input name="email" type="email" placeholder="Enter your email..." /&gt;<br/>        &lt;button&gt;Submit&lt;/button&gt;<br/>      &lt;/form&gt;<br/>      }</strong><br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="2019" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ç°åœ¨ï¼Œå½“æŒ‰ä¸‹submitæ—¶ï¼Œè¾“å…¥æ¡†å°†åˆ‡æ¢åˆ°say <code class="eh md me mf lt b">Hello {lead.email}</code>å¹¶ä»¥emailä¸ºå€¼è·Ÿè¸ªäº‹ä»¶â€œå·²æ³¨å†Œâ€ã€‚</p><p id="964f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ç°åœ¨ï¼Œåœ¨æ‚¨çš„æ¼æ–—åˆ†æä¸­ï¼Œæ‚¨å¯ä»¥è¿›è¡Œä¸¤ä¸ªæŸ¥è¯¢:</p><ol class=""><li id="bae7" class="nb nc if je b jf jg jj jk jn nd jr ne jv nf jz ng nh ni nj dt translated">ä»å€¼ä¸ºâ€œæ§åˆ¶â€çš„â€œæ ‡é¢˜æ–‡æœ¬è¯•éªŒæ’­æ”¾â€å¼€å§‹</li><li id="ba7a" class="nb nc if je b jf nk jj nl jn nm jr nn jv no jz ng nh ni nj dt translated">ä»å€¼ä¸ºâ€œmineâ€çš„â€œæ ‡é¢˜æ–‡æœ¬è¯•éªŒæ’­æ”¾â€å¼€å§‹</li></ol><p id="c02b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ‚¨å°†èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°çœ‹åˆ°é€šè¿‡æ¯ä¸ªå®éªŒçš„æ¯ä¸ªæ­¥éª¤çš„ç”¨æˆ·çš„ç™¾åˆ†æ¯”ã€‚</p><h1 id="9708" class="kq kr if bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">ç»“è®ºğŸ‰</h1><p id="9f0c" class="pw-post-body-paragraph jc jd if je b jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv mk jx jy jz hn dt translated">ç°åœ¨ä½ æœ‰äº†ï¼ŒSSRåˆ†è£‚æµ‹è¯•(å¤§éƒ¨åˆ†)è‡ªåŠ¨åˆ†æ(åªè¦ä½ ç»§ç»­ä½¿ç”¨redux)ï¼</p><p id="fe2a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æ„Ÿè°¢é˜…è¯»ï¼ä¸‹æ¬¡è§ï¼å¦‚æœä½ è§‰å¾—è¿™æœ‰ç”¨ï¼Œè¯·é¼“æŒå¹¶åˆ†äº«ï¼Œå› ä¸ºå®ƒå°†å¸®åŠ©æˆ‘æ¥è§¦åˆ°æ›´å¤šçš„äººï¼:)</p><p id="4beb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ä½ å¯ä»¥åœ¨GitHubåº“ä¸­æ‰¾åˆ°æ‰€æœ‰çš„ä»£ç ã€‚è¯·éšæ„ä½¿ç”¨å®ƒä½œä¸ºæ ·æ¿ï¼</p><p id="5351" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å¸•ç‰¹é‡Œå…‹Â·æ–¯ç§‘ç‰¹</p><p id="3d13" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">â€”</p><blockquote class="ka"><p id="8cdf" class="kb kc if bd kd ke kf kg kh ki kj jz ek translated">æ²¡æœ‰æ— ç”¨çš„AWSè®¤è¯ï¼Œæœ‰å…´è¶£å¬å¬æˆ‘çš„DevOpsä¹‹æ—…å—ï¼Ÿ <a class="ae my" href="https://hackernoon.com/my-journey-to-achieving-devops-bliss-without-useless-aws-certifications-a7cbf7c539d1" rel="noopener ugc nofollow" target="_blank"> <em class="np">ç°åœ¨å°±åœ¨HackerNoon </em> </a> <em class="np">ä¸Šçœ‹ã€‚</em></p></blockquote><p id="460e" class="pw-post-body-paragraph jc jd if je b jf kk jh ji jj kl jl jm jn km jp jq jr kn jt ju jv ko jx jy jz hn dt translated"><strong class="je ig">æˆ‘æœ‰ç©ºå’¨è¯¢â€”â€”åœ¨</strong> <a class="ae my" href="https://twitter.com/pat_scott" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> Twitter </strong> </a> <strong class="je ig">æˆ–</strong><a class="ae my" href="https://www.linkedin.com/in/patricklscott/" rel="noopener ugc nofollow" target="_blank"><strong class="je ig">LinkedIn</strong></a><strong class="je ig">ä¸Šç»™æˆ‘å‘æ¶ˆæ¯ã€‚è¯·æåŠä½ çœ‹åˆ°äº†æˆ‘çš„æ–‡ç« ï¼ä¸è¦å®³ç¾ï¼</strong></p><p id="4c0e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kp">æƒ³äº†è§£å¦‚ä½•ä½¿ç”¨å¾®æœåŠ¡æ„å»ºè‡ªå®šä¹‰åˆ†æåç«¯å—ï¼Ÿåœ¨æˆ‘å³å°†å¼€å§‹çš„è¯¾ç¨‹â€œ</em> <a class="ae my" href="http://www.microservicedriven.com/get-access" rel="noopener ugc nofollow" target="_blank"> <em class="kp">å¾®æœåŠ¡é©±åŠ¨</em> </a> <em class="kp">â€ä¸­ï¼Œæˆ‘å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚ä»</em> <strong class="je ig"> <em class="kp">è¿™ä¸ª</em> </strong> <em class="kp">ä¾‹å­å¼€å§‹ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªç”¨äºè·Ÿè¸ªåˆ†æå’Œçº¿ç´¢çš„å¾®æœåŠ¡åç«¯ï¼Œå¹¶ä½¿ç”¨Docker Swarmåœ¨ç”Ÿäº§ä¸­è¿è¡Œå®ƒã€‚</em> <a class="ae my" href="http://www.microservicedriven.com/get-access" rel="noopener ugc nofollow" target="_blank"> <em class="kp">ç°åœ¨å°±æŠ¥åå§ï¼</em> </a></p></div></div>    
</body>
</html>