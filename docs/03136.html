<html>
<head>
<title>Introduction to AWS With Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform自动气象站简介</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/introduction-to-aws-with-terraform-7a8daf261dc0?source=collection_archive---------0-----------------------#2018-04-10">https://medium.com/hackernoon/introduction-to-aws-with-terraform-7a8daf261dc0?source=collection_archive---------0-----------------------#2018-04-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="49de" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">放弃</h2></div><p id="2d66" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">此内容是我们在线课程/培训的一部分/灵感来源。在2019年<strong class="jl hv">黑色星期五</strong>期间，我们提供这些材料高达80%的折扣。</p><p id="ede3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以在这里得到你的折扣。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><a href="http://bf.eralabs.io"><div class="fe ff kg"><img src="../Images/f322772403668f8316905cec24b85586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0qBLWIa0zP-zJcrenZN8w.png"/></div></a></figure></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><p id="0af3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">大约一个月前，我发布了实用AWS，这是一个关于AWS实际使用的培训，而不是理论和想法。</p><p id="dc5f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以观看<a class="ae kf" href="https://www.youtube.com/watch?v=Z6UilbN8WEg&amp;t=226s" rel="noopener ugc nofollow" target="_blank">演示视频</a>，或者访问<a class="ae kf" href="https://www.practicalaws.com/" rel="noopener ugc nofollow" target="_blank">培训网站</a>。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><a href="http://practicalaws.com"><div class="fe ff kv"><img src="../Images/affb064f95242153500382183a6c0ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DFnMWMzBL0AuzpPxnro5vQ.png"/></div></a><figcaption class="kw kx fg fe ff ky kz bd b be z ek">More information on <a class="ae kf" href="http://practicalaws.com" rel="noopener ugc nofollow" target="_blank">http://practicalaws.com</a></figcaption></figure><p id="320c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">即使培训发布了，但由于它将终身免费更新新内容，这篇博客文章是将添加到培训中的新课的原型。</p><p id="5988" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这篇博文介绍了如何使用Terraform管理AWS基础设施。</p><h1 id="d9e4" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">下载和安装Terraform</h1><p id="a6d2" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">从官方下载页面的<a class="ae kf" href="https://www.terraform.io/downloads.html" rel="noopener ugc nofollow" target="_blank">下载Terraform开始。</a></p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff lx"><img src="../Images/7047915101478982676e7d64bb846885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HrLhg656TteLj05uI7DngA.png"/></div></div></figure><p id="db4a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">选择您的操作系统和CPU架构，并开始下载。<br/> Terraform是一个单独的二进制文件，你应该将它转移到<code class="eh mc md me mf b">/usr/bin </code>并使其可执行。</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="05de" class="mk lb hu mf b fv ml mm l mn mo">sudo mv terraform /usr/bin &amp;&amp; sudo chmod +x</span></pre><p id="6b02" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您正在使用另一个操作系统，请参考<a class="ae kf" href="http://dome.readthedocs.io/en/latest/dmc/deployment/install-terra.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h1 id="389b" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">配置AWS</h1><p id="9eda" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">为了遵循最佳实践，让我们为Terraform创建一个用户。转到您的AWS控制台并创建<code class="eh mc md me mf b">terraform_user </code>用户:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff mp"><img src="../Images/eeaf4b8b6e238090c16c2be6abe657f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZM0QPhYnBsMR-l5VnpKhw.png"/></div></div></figure><p id="69e0" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">给它好的权利。在我的例子中，我需要Terraform来管理我所有的AWS云资源:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff mq"><img src="../Images/0ae9455d1cfbccfdcac7ae820848e11c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*470YXFOzgwgsfEI-9kvUsQ.png"/></div></div></figure><p id="b840" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">不要忘记存储AWS访问密钥id和秘密访问密钥:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff mr"><img src="../Images/2c02050c7eb1deb071c3d4d9720be7e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PFYKvoTt0Zw-Yht79JXXPw.png"/></div></div></figure><p id="08de" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将它们复制到AWS凭据文件中:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="fb9e" class="mk lb hu mf b fv ml mm l mn mo">.aws/credentials</span></pre><p id="3f6e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你也可以执行<code class="eh mc md me mf b">aws configure </code>来添加一个新用户。</p><p id="faae" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这两种情况下，您的密钥都将存储在AWS凭证文件中:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="95b7" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">[terraform]</strong><br/>aws_access_key_id = xxxxxxxxxxxxxxxxxxx<br/>aws_secret_access_key = xxx/xxxxxxxxxxxxx/xxxx</span></pre><h1 id="dff8" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">Terraform Hello World！</h1><p id="95d6" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">转到您的工作区，创建一个名为terraform的文件夹:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="339c" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">mkdir</strong> terraform</span></pre><p id="e10a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将这些行添加到<code class="eh mc md me mf b">main.tf </code>:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="540a" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">provider</strong> "aws" {<br/>  <strong class="mf hv">region</strong>                  = "eu-west-3"<br/>  shared_credentials_file = "/home/eon01/.aws/credentials"<br/>  profile                 = "terraform"<br/>}</span></pre><p id="09ef" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">以上是AWS的配置，根据您自己的配置、概要文件名称以及区域来调整凭证文件路径。在我的例子中，我使用的是巴黎地区。</p><p id="3746" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了创建我们的第一台AWS机器，让我们添加以下代码行:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="1d92" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">resource</strong> "aws_instance" "web" {<br/>  <strong class="mf hv">ami</strong> = "ami-0e55e373"<br/>  instance_type = "t1.micro"<br/>  tags {<br/>    <strong class="mf hv">Name</strong> = "eralabs"<br/>  }</span></pre><p id="c2cf" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们的文件<code class="eh mc md me mf b">main.tf </code>将是这样的:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="1366" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">provider</strong> "aws" {<br/>  <strong class="mf hv">region</strong>                  = "eu-west-3"<br/>  shared_credentials_file = "/home/eon01/.aws/credentials"<br/>  profile                 = "terraform"<br/>}</span><span id="b46f" class="mk lb hu mf b fv ms mm l mn mo">resource "aws_instance" "web" {<br/>  <strong class="mf hv">ami</strong> = "ami-0e55e373"<br/>  instance_type = "t1.micro"<br/>  tags {<br/>    <strong class="mf hv">Name</strong> = "eralabs"<br/>  }</span><span id="06ba" class="mk lb hu mf b fv ms mm l mn mo">}</span></pre><p id="5bca" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在上面的例子中，我使用配置文件“terraform”在区域“eu-west-3”上创建了一台机器。</p><p id="6d46" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我的机器大小是<code class="eh mc md me mf b">t1.micro </code>，它使用的是AMI <code class="eh mc md me mf b">ami-0e55e373 </code>，这是一个适用于“eu-west-3”地区的Ubuntu 17.04映像。</p><p id="a31f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">注意</strong> : Ubuntu 17.04镜像在两个不同的地区没有相同的AMI id。</p><p id="0a6b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你喜欢像这个例子中一样使用Ubuntu，你可以访问<a class="ae kf" href="http://cloud-images.ubuntu.com" rel="noopener ugc nofollow" target="_blank">cloud-images.ubuntu.com</a>，在那里你可以找到你应该使用的AMI的id。</p><p id="ef2a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您还可以使用CLI来描述AWS IAMs:</p><ul class=""><li id="8e9d" class="mt mu hu jl b jm jn jp jq js mv jw mw ka mx ke my mz na nb dt translated">例如:描述由Amazon EBS支持的Windows AMIs。</li></ul><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="9c53" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">aws</strong> ec2 describe-images --filters "Name=platform,Values=windows" "Name=root-device-type,Values=ebs"</span></pre><ul class=""><li id="7f65" class="mt mu hu jl b jm jn jp jq js mv jw mw ka mx ke my mz na nb dt translated">例如:描述Ubuntu AMIs</li></ul><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="54fc" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">aws</strong> ec2 describe-images --filters "Name=name,Values=ubuntu*"</span></pre><p id="d757" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">注意:</strong>查看本次培训附带的AWS备忘单，以获取更多示例。</p><p id="dc94" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">选择AMI后，进入创建main.tf的文件夹并初始化Terraform:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="12fb" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">terraform</strong> init</span></pre><p id="c428" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您将看到与此类似的输出:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="1f75" class="mk lb hu mf b fv ml mm l mn mo">Initializing provider plugins...<br/>- Checking for available provider plugins on https://releases.hashicorp.com...<br/>- Downloading plugin for provider "aws" (1.13.0)...</span><span id="e205" class="mk lb hu mf b fv ms mm l mn mo">The following providers <strong class="mf hv">do</strong> <strong class="mf hv">not</strong> have <strong class="mf hv">any</strong> <strong class="mf hv">version</strong> <strong class="mf hv">constraints</strong> <strong class="mf hv">in</strong> configuration,<br/>so the latest <strong class="mf hv">version</strong> was installed.</span><span id="79d7" class="mk lb hu mf b fv ms mm l mn mo"><strong class="mf hv">To</strong> prevent automatic upgrades <strong class="mf hv">to</strong> new major versions that may contain breaking<br/>changes, it <strong class="mf hv">is</strong> recommended <strong class="mf hv">to</strong> <strong class="mf hv">add</strong> <strong class="mf hv">version</strong> = "..." <strong class="mf hv">constraints</strong> <strong class="mf hv">to</strong> the<br/><strong class="mf hv">corresponding</strong> provider blocks <strong class="mf hv">in</strong> configuration, <strong class="mf hv">with</strong> the <strong class="mf hv">constraint</strong> strings<br/>suggested below.</span><span id="c415" class="mk lb hu mf b fv ms mm l mn mo">* provider.aws: <strong class="mf hv">version</strong> = "~&gt; 1.13"</span><span id="b8c7" class="mk lb hu mf b fv ms mm l mn mo">Terraform has been successfully initialized!</span><span id="6165" class="mk lb hu mf b fv ms mm l mn mo">You may <strong class="mf hv">now</strong> <strong class="mf hv">begin</strong> working <strong class="mf hv">with</strong> Terraform. Try running "terraform plan" <strong class="mf hv">to</strong> see<br/><strong class="mf hv">any</strong> changes that <strong class="mf hv">are</strong> required <strong class="mf hv">for</strong> your infrastructure. <strong class="mf hv">All</strong> Terraform commands<br/>should <strong class="mf hv">now</strong> <strong class="mf hv">work</strong>.</span><span id="70c8" class="mk lb hu mf b fv ms mm l mn mo"><strong class="mf hv">If</strong> you ever <strong class="mf hv">set</strong> <strong class="mf hv">or</strong> <strong class="mf hv">change</strong> modules <strong class="mf hv">or</strong> backend configuration <strong class="mf hv">for</strong> Terraform,<br/>rerun this command <strong class="mf hv">to</strong> reinitialize your working directory. <strong class="mf hv">If</strong> you forget, other<br/>commands will detect it <strong class="mf hv">and</strong> remind you <strong class="mf hv">to</strong> <strong class="mf hv">do</strong> so <strong class="mf hv">if</strong> necessary.</span></pre><p id="8b16" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在执行:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="4205" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">terraform</strong> plan</span></pre><p id="4fa2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这个命令不会在您的AWS云上创建任何资源。它让你知道Terraform会做什么。</p><p id="91a8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您将看到以下输出:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="29eb" class="mk lb hu mf b fv ml mm l mn mo">+ aws_instance.web<br/>      id:                           &lt;computed&gt;<br/>      ami:                          "ami-0e55e373"<br/>      associate_public_ip_address:  &lt;computed&gt;<br/>      availability_zone:            &lt;computed&gt;<br/>      ebs_block_device.#:           &lt;computed&gt;<br/>      ephemeral_block_device.#:     &lt;computed&gt;<br/>      get_password_data:            "false"<br/>      instance_state:               &lt;computed&gt;<br/>      instance_type:                "t1.micro"<br/>      ipv6_address_count:           &lt;computed&gt;<br/>      ipv6_addresses.#:             &lt;computed&gt;<br/>      key_name:                     &lt;computed&gt;<br/>      network_interface.#:          &lt;computed&gt;<br/>      network_interface_id:         &lt;computed&gt;<br/>      password_data:                &lt;computed&gt;<br/>      placement_group:              &lt;computed&gt;<br/>      primary_network_interface_id: &lt;computed&gt;<br/>      private_dns:                  &lt;computed&gt;<br/>      private_ip:                   &lt;computed&gt;<br/>      public_dns:                   &lt;computed&gt;<br/>      public_ip:                    &lt;computed&gt;<br/>      root_block_device.#:          &lt;computed&gt;<br/>      security_groups.#:            &lt;computed&gt;<br/>      source_dest_check:            "true"<br/>      subnet_id:                    &lt;computed&gt;<br/>      tags.%:                       "1"<br/>      tags.Name:                    "eralabs"<br/>      tenancy:                      &lt;computed&gt;<br/>      volume_tags.%:                &lt;computed&gt;<br/>      vpc_security_group_ids.#:     &lt;computed&gt;</span></pre><p id="5904" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">请注意，加号(+)表示将创建一个资源。另一方面，当显示减号(-)时，Terraform意味着资源将被删除。</p><h1 id="e7c9" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">使用变量</h1><p id="06d1" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">让我们来看看如何使用Terraform变量来编写一个更简洁的配置文件。</p><p id="d555" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们可以认为AWS区域是可变的，这就是为什么我们要将这段代码添加到main.tf文件中:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="37f6" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">variable</strong> "region" {<br/>  <strong class="mf hv">default</strong> = "eu-west-3"<br/>}</span></pre><p id="adce" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，您可以使用以下命令从Terraform文件中调用它:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="9955" class="mk lb hu mf b fv ml mm l mn mo">${var.region}</span></pre><p id="6f99" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这就是我们main.tf的样子:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="e949" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">variable</strong> "region" {<br/>  <strong class="mf hv">default</strong> = "eu-west-3"<br/>}</span><span id="f0cb" class="mk lb hu mf b fv ms mm l mn mo">provider "aws" {<br/>  <strong class="mf hv">region</strong>                  = "${var.region}"<br/>  shared_credentials_file = "/home/eon01/.aws/credentials"<br/>  profile                 = "terraform"<br/>}</span><span id="00a5" class="mk lb hu mf b fv ms mm l mn mo">resource "aws_instance" "web" {<br/>  <strong class="mf hv">ami</strong> = "ami-0e55e373"<br/>  instance_type = "t1.micro"<br/>  tags {<br/>    <strong class="mf hv">Name</strong> = "eralabs"<br/>  }</span><span id="e3c4" class="mk lb hu mf b fv ms mm l mn mo">}</span></pre><p id="4b72" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对！让我们对“shared_credentials_file”和“profile”做同样的事情:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="6bbe" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">variable</strong> "region" {<br/>  <strong class="mf hv">default</strong> = "eu-west-3"<br/>}</span><span id="60e5" class="mk lb hu mf b fv ms mm l mn mo">variable "shared_credentials_file" {<br/>  <strong class="mf hv">default</strong> = "/home/eon01/.aws/credentials"<br/>}<br/></span><span id="5f8b" class="mk lb hu mf b fv ms mm l mn mo">variable "profile" {<br/>  <strong class="mf hv">default</strong> = "terraform"<br/>}<br/></span><span id="b3dd" class="mk lb hu mf b fv ms mm l mn mo">provider "aws" {<br/>  <strong class="mf hv">region</strong>                  = "${var.region}"<br/>  shared_credentials_file = "${var.shared_credentials_file}"<br/>  profile                 = "${var.profile}"<br/>}</span><span id="ce49" class="mk lb hu mf b fv ms mm l mn mo">resource "aws_instance" "web" {<br/>  <strong class="mf hv">ami</strong> = "ami-0e55e373"<br/>  instance_type = "t1.micro"<br/>  tags {<br/>    <strong class="mf hv">Name</strong> = "eralabs"<br/>  }</span><span id="ae5e" class="mk lb hu mf b fv ms mm l mn mo">}</span></pre><h1 id="f536" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">使用地形图</h1><p id="9ce7" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">在我的例子中，我使用的是巴黎地区(eu-west-3 ),但是如果我需要添加新的地区，比如都柏林(eu-west1 ),该怎么办呢？？</p><p id="08d5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">上面的代码将把EC2实例部署到一个区域。</p><p id="5dc3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了解决这个问题，接下来的第一步是找到我们想要使用的AMI(取决于地区)，然后创建一个“map”类型的变量:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="d5ee" class="mk lb hu mf b fv ml mm l mn mo">variable "my_ami" {<br/>  type = "map"<br/>  default = {<br/>    eu-west-1 = "ami-f90a4880"<br/>    eu-west-3 = "ami-0e55e373"<br/>  }<br/>  description = "I added only 2 regions: Paris and Dublin. You can use as many regions as you want."<br/>}</span></pre><p id="fc47" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">根据使用的区域，Terraform应该创建一个具有不同AMI的EC2机器。</p><p id="85e1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是通过将<code class="eh mc md me mf b">ami = "ami-0e55e373" </code>更改为<code class="eh mc md me mf b">ami = "${lookup(var.my_ami, var.region)}" </code>来更改旧的AMI线来实现的。</p><p id="d13b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">要测试这一点，键入<code class="eh mc md me mf b">terraform plan </code>，您将得到以下输出:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="90bc" class="mk lb hu mf b fv ml mm l mn mo">+ aws_instance.web<br/>      id:                           &lt;computed&gt;<br/>      ami:                          "ami-0e55e373"<br/>      associate_public_ip_address:  &lt;computed&gt;<br/>      availability_zone:            &lt;computed&gt;<br/>      ebs_block_device.#:           &lt;computed&gt;<br/>      ephemeral_block_device.#:     &lt;computed&gt;<br/>      get_password_data:            "false"<br/>      instance_state:               &lt;computed&gt;<br/>      instance_type:                "t1.micro"<br/>      ipv6_address_count:           &lt;computed&gt;<br/>      ipv6_addresses.#:             &lt;computed&gt;<br/>      key_name:                     &lt;computed&gt;<br/>      network_interface.#:          &lt;computed&gt;<br/>      network_interface_id:         &lt;computed&gt;<br/>      password_data:                &lt;computed&gt;<br/>      placement_group:              &lt;computed&gt;<br/>      primary_network_interface_id: &lt;computed&gt;<br/>      private_dns:                  &lt;computed&gt;<br/>      private_ip:                   &lt;computed&gt;<br/>      public_dns:                   &lt;computed&gt;<br/>      public_ip:                    &lt;computed&gt;<br/>      root_block_device.#:          &lt;computed&gt;<br/>      security_groups.#:            &lt;computed&gt;<br/>      source_dest_check:            "true"<br/>      subnet_id:                    &lt;computed&gt;<br/>      tags.%:                       "1"<br/>      tags.Name:                    "eralabs"<br/>      tenancy:                      &lt;computed&gt;<br/>      volume_tags.%:                &lt;computed&gt;<br/>      vpc_security_group_ids.#:     &lt;computed&gt;</span></pre><p id="2f55" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您手动将区域更改为<code class="eh mc md me mf b">eu-west-1 </code>，您会注意到<code class="eh mc md me mf b">terraform plan </code>将使用另一个AMI:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="f26a" class="mk lb hu mf b fv ml mm l mn mo">+ aws_instance.web<br/>      id:                           &lt;computed&gt;<br/>      ami:                          "ami-f90a4880"<br/>      associate_public_ip_address:  &lt;computed&gt;<br/>      availability_zone:            &lt;computed&gt;<br/>      ebs_block_device.#:           &lt;computed&gt;<br/>      ephemeral_block_device.#:     &lt;computed&gt;<br/>      get_password_data:            "false"<br/>      instance_state:               &lt;computed&gt;<br/>      instance_type:                "t1.micro"<br/>      ipv6_address_count:           &lt;computed&gt;<br/>      ipv6_addresses.#:             &lt;computed&gt;<br/>      key_name:                     &lt;computed&gt;<br/>      network_interface.#:          &lt;computed&gt;<br/>      network_interface_id:         &lt;computed&gt;<br/>      password_data:                &lt;computed&gt;<br/>      placement_group:              &lt;computed&gt;<br/>      primary_network_interface_id: &lt;computed&gt;<br/>      private_dns:                  &lt;computed&gt;<br/>      private_ip:                   &lt;computed&gt;<br/>      public_dns:                   &lt;computed&gt;<br/>      public_ip:                    &lt;computed&gt;<br/>      root_block_device.#:          &lt;computed&gt;<br/>      security_groups.#:            &lt;computed&gt;<br/>      source_dest_check:            "true"<br/>      subnet_id:                    &lt;computed&gt;<br/>      tags.%:                       "1"<br/>      tags.Name:                    "eralabs"<br/>      tenancy:                      &lt;computed&gt;<br/>      volume_tags.%:                &lt;computed&gt;<br/>      vpc_security_group_ids.#:     &lt;computed&gt;</span></pre><h1 id="516a" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">使用输入参数</h1><p id="d720" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">在最新的示例中，我们手动将区域值从“欧盟-西方-3”更改为“欧盟-西方-1”。目标是测试地图功能是否正常工作。</p><p id="dde8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">实际上，您不需要手动更改您的<code class="eh mc md me mf b">main.tf </code>文件，但是您可以通过使用一个新的区域作为参数来覆盖region的值:</p><p id="97a1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">尝试使用“eu-west-1”代替默认值“eu-west-3”:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="a17c" class="mk lb hu mf b fv ml mm l mn mo">terraform plan -var region=eu-west-1</span></pre><p id="6573" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">可以在同一行中输入其他变量。例如，我们可以使用以下命令将使用的配置文件从“terraform”更改为“default”:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="d3f8" class="mk lb hu mf b fv ml mm l mn mo">terraform plan -var region=eu-west-1 -var profile=default</span></pre><h1 id="60ff" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">使用变量文件</h1><p id="c471" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">我们希望将配置与执行代码分开，这就是为什么我们要创建一个包含我们正在使用的变量的文件(variables.tfvars):</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="ca3f" class="mk lb hu mf b fv ml mm l mn mo">region = "eu-west-1"</span><span id="2a46" class="mk lb hu mf b fv ms mm l mn mo">shared_credentials_file = "/home/eon01/.aws/credentials"<br/>profile = "terraform"</span><span id="71b8" class="mk lb hu mf b fv ms mm l mn mo">my_ami = {<br/>    "eu-west-1" = "ami-f90a4880"<br/>    "eu-west-3" = "ami-0e55e373"<br/>  }</span></pre><p id="e7c7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">从<code class="eh mc md me mf b">main.tf </code>文件中删除变量后，它变成了:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="a97e" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">variable</strong> "region" {}<br/><strong class="mf hv">variable</strong> "shared_credentials_file" {}<br/><strong class="mf hv">variable</strong> "profile" {}<br/><strong class="mf hv">variable</strong> "my_ami" {<br/>  <strong class="mf hv">type</strong> = "map"<br/>}<br/>provider "aws" {<br/>  <strong class="mf hv">region</strong>                  = "${var.region}"<br/>  shared_credentials_file = "${var.shared_credentials_file}"<br/>  profile                 = "${var.profile}"<br/>}<br/></span><span id="1c08" class="mk lb hu mf b fv ms mm l mn mo">resource "aws_instance" "web" {<br/>  <strong class="mf hv">ami</strong> = "${lookup(var.my_ami, var.region)}"<br/>  instance_type = "t1.micro"<br/>  tags {<br/>    <strong class="mf hv">Name</strong> = "eralabs"<br/>  }</span><span id="c0e5" class="mk lb hu mf b fv ms mm l mn mo">}</span></pre><p id="4461" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们执行plan命令，看看是否会创建EC2机器:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="4abc" class="mk lb hu mf b fv ml mm l mn mo">terraform plan -var-file=variables.tfvars</span></pre><h1 id="8296" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">地形应用</h1><p id="a0d3" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">为了执行创建我们的EC2机器，我们需要执行:<code class="eh mc md me mf b">terraform apply </code>。<br/>因为我们使用文件来存储变量，所以我们需要执行:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="525f" class="mk lb hu mf b fv ml mm l mn mo">terraform apply -var-file=variables.tfvars</span></pre><p id="8833" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">执行上面的命令后，我们将得到与此类似的输出:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="81f9" class="mk lb hu mf b fv ml mm l mn mo">An execution plan has been generated and is shown below.<br/>Resource actions are indicated with the following symbols:<br/>  + create</span><span id="7204" class="mk lb hu mf b fv ms mm l mn mo">Terraform will perform the following actions:</span><span id="cfb4" class="mk lb hu mf b fv ms mm l mn mo">  + aws_instance.web<br/>      id:                           &lt;computed&gt;<br/>      ami:                          "ami-f90a4880"<br/>      associate_public_ip_address:  &lt;computed&gt;<br/>      availability_zone:            &lt;computed&gt;<br/>      ebs_block_device.#:           &lt;computed&gt;<br/>      ephemeral_block_device.#:     &lt;computed&gt;<br/>      get_password_data:            "false"<br/>      instance_state:               &lt;computed&gt;<br/>      instance_type:                "t1.micro"<br/>      ipv6_address_count:           &lt;computed&gt;<br/>      ipv6_addresses.#:             &lt;computed&gt;<br/>      key_name:                     &lt;computed&gt;<br/>      network_interface.#:          &lt;computed&gt;<br/>      network_interface_id:         &lt;computed&gt;<br/>      password_data:                &lt;computed&gt;<br/>      placement_group:              &lt;computed&gt;<br/>      primary_network_interface_id: &lt;computed&gt;<br/>      private_dns:                  &lt;computed&gt;<br/>      private_ip:                   &lt;computed&gt;<br/>      public_dns:                   &lt;computed&gt;<br/>      public_ip:                    &lt;computed&gt;<br/>      root_block_device.#:          &lt;computed&gt;<br/>      security_groups.#:            &lt;computed&gt;<br/>      source_dest_check:            "true"<br/>      subnet_id:                    &lt;computed&gt;<br/>      tags.%:                       "1"<br/>      tags.Name:                    "eralabs"<br/>      tenancy:                      &lt;computed&gt;<br/>      volume_tags.%:                &lt;computed&gt;<br/>      vpc_security_group_ids.#:     &lt;computed&gt;<br/></span><span id="7820" class="mk lb hu mf b fv ms mm l mn mo">Plan: 1 to add, 0 to change, 0 to destroy.</span><span id="b71e" class="mk lb hu mf b fv ms mm l mn mo">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.</span></pre><p id="9028" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将要求您确认，请输入“是”:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="70f9" class="mk lb hu mf b fv ml mm l mn mo">Enter a value: yes</span><span id="d496" class="mk lb hu mf b fv ms mm l mn mo">aws_instance.web: Creating...<br/>  ami:                          "" =&gt; "ami-f90a4880"<br/>  associate_public_ip_address:  "" =&gt; "&lt;computed&gt;"<br/>  availability_zone:            "" =&gt; "&lt;computed&gt;"<br/>  ebs_block_device.<em class="nc">#:           "" =&gt; "&lt;computed&gt;"</em><br/>  ephemeral_block_device.<em class="nc">#:     "" =&gt; "&lt;computed&gt;"</em><br/>  get_password_data:            "" =&gt; "false"<br/>  instance_state:               "" =&gt; "&lt;computed&gt;"<br/>  instance_type:                "" =&gt; "t1.micro"<br/>  ipv6_address_count:           "" =&gt; "&lt;computed&gt;"<br/>  ipv6_addresses.<em class="nc">#:             "" =&gt; "&lt;computed&gt;"</em><br/>  key_name:                     "" =&gt; "&lt;computed&gt;"<br/>  network_interface.<em class="nc">#:          "" =&gt; "&lt;computed&gt;"</em><br/>  network_interface_id:         "" =&gt; "&lt;computed&gt;"<br/>  password_data:                "" =&gt; "&lt;computed&gt;"<br/>  placement_group:              "" =&gt; "&lt;computed&gt;"<br/>  primary_network_interface_id: "" =&gt; "&lt;computed&gt;"<br/>  private_dns:                  "" =&gt; "&lt;computed&gt;"<br/>  private_ip:                   "" =&gt; "&lt;computed&gt;"<br/>  public_dns:                   "" =&gt; "&lt;computed&gt;"<br/>  public_ip:                    "" =&gt; "&lt;computed&gt;"<br/>  root_block_device.<em class="nc">#:          "" =&gt; "&lt;computed&gt;"</em><br/>  security_groups.<em class="nc">#:            "" =&gt; "&lt;computed&gt;"</em><br/>  source_dest_check:            "" =&gt; "true"<br/>  subnet_id:                    "" =&gt; "&lt;computed&gt;"<br/>  tags.%:                       "" =&gt; "1"<br/>  tags.Name:                    "" =&gt; "eralabs"<br/>  tenancy:                      "" =&gt; "&lt;computed&gt;"<br/>  volume_tags.%:                "" =&gt; "&lt;computed&gt;"<br/>  vpc_security_group_ids.<em class="nc">#:     "" =&gt; "&lt;computed&gt;"</em><br/>aws_instance.web: Still creating... (10s elapsed)<br/>aws_instance.web: Creation complete after 19s (ID: i-055aaa2cab2436ab4)</span><span id="9bf5" class="mk lb hu mf b fv ms mm l mn mo">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span></pre><h1 id="016d" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">地形&amp;不变的基础设施</h1><p id="6485" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">简单地定义这个概念，对于每个部署，不可变的资源或组件被替换。例如，服务器在部署后从不修改。当需要更新时，应该使用新的更新从基本/公共映像创建新的服务器。</p><p id="2a5d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了在实践中看到这一点，我明确地忘记将SSH密钥添加到EC2描述文件中，没有它，您可以创建EC2机器，但是您不能使用SSH访问它。现在让我们向EC2机器添加一个密钥对:</p><p id="fe7f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在main.tf文件中:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="893c" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">resource</strong> "aws_instance" "web" {<br/>  <strong class="mf hv">ami</strong> = "${lookup(var.my_ami, var.region)}"<br/>  instance_type = "t1.micro"</span><span id="efc8" class="mk lb hu mf b fv ms mm l mn mo">  key_name = "${var.key_name}"  </span><span id="69ef" class="mk lb hu mf b fv ms mm l mn mo">  tags {<br/>    <strong class="mf hv">Name</strong> = "eralabs"<br/>  }</span></pre><p id="f9e7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在variables.tfvs文件中:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="6aac" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">key_name</strong> = "my_key.kp"</span></pre><p id="62ed" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，您可以执行plan命令，而不是apply命令，您会注意到Terraform不会更新机器以添加新密钥，而是会销毁它并使用新配置创建一个新密钥:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="5591" class="mk lb hu mf b fv ml mm l mn mo">-/+ aws_instance.web (<strong class="mf hv">new</strong> resource required)<br/>      id:                           "i-055aaa2cab2436ab4" =&gt; &lt;computed&gt; (forces <strong class="mf hv">new</strong> resource)<br/>      ami:                          "ami-f90a4880" =&gt; "ami-f90a4880"<br/>      associate_public_ip_address:  "true" =&gt; &lt;computed&gt;<br/>      availability_zone:            "eu-west-1a" =&gt; &lt;computed&gt;<br/>      ebs_block_device.<em class="nc">#:           "0" =&gt; &lt;computed&gt;</em><br/>      ephemeral_block_device.<em class="nc">#:     "0" =&gt; &lt;computed&gt;</em><br/>      get_password_data:            "false" =&gt; "false"<br/>      instance_state:               "running" =&gt; &lt;computed&gt;<br/>      instance_type:                "t1.micro" =&gt; "t1.micro"<br/>      ipv6_address_count:           "" =&gt; &lt;computed&gt;<br/>      ipv6_addresses.<em class="nc">#:             "0" =&gt; &lt;computed&gt;</em><br/>      key_name:                     "" =&gt; "my_key.kp" (forces <strong class="mf hv">new</strong> resource)<br/>      network_interface.<em class="nc">#:          "0" =&gt; &lt;computed&gt;</em><br/>      network_interface_id:         "eni-ddcf2fd9" =&gt; &lt;computed&gt;<br/>      password_data:                "" =&gt; &lt;computed&gt;<br/>      placement_group:              "" =&gt; &lt;computed&gt;<br/>      primary_network_interface_id: "eni-ddcf2fd9" =&gt; &lt;computed&gt;<br/>      private_dns:                  "ip-172-31-43-75.eu-west-1.compute.internal" =&gt; &lt;computed&gt;<br/>      private_ip:                   "172.31.43.75" =&gt; &lt;computed&gt;<br/>      public_dns:                   "ec2-52-211-29-100.eu-west-1.compute.amazonaws.com" =&gt; &lt;computed&gt;<br/>      public_ip:                    "52.211.29.100" =&gt; &lt;computed&gt;<br/>      root_block_device.<em class="nc">#:          "1" =&gt; &lt;computed&gt;</em><br/>      security_groups.<em class="nc">#:            "1" =&gt; &lt;computed&gt;</em><br/>      source_dest_check:            "true" =&gt; "true"<br/>      subnet_id:                    "subnet-7f510f27" =&gt; &lt;computed&gt;<br/>      tags.%:                       "1" =&gt; "1"<br/>      tags.Name:                    "eralabs" =&gt; "eralabs"<br/>      tenancy:                      "default" =&gt; &lt;computed&gt;<br/>      volume_tags.%:                "0" =&gt; &lt;computed&gt;<br/>      vpc_security_group_ids.<em class="nc">#:     "1" =&gt; &lt;computed&gt;</em><br/></span><span id="40e2" class="mk lb hu mf b fv ms mm l mn mo">Plan: 1 to add, 0 to change, 1 to destroy.</span></pre><h1 id="3370" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">使用Terraform模块</h1><p id="4e89" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">Terraform hots <a class="ae kf" href="https://registry.terraform.io/" rel="noopener ugc nofollow" target="_blank">一个公共注册中心</a>，在那里你可以找到通用的可重用模块。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff nd"><img src="../Images/1c22d74ae16a9422f4b4ce4ff40fdf0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s655bLexKRYYQ33tagEQsw.png"/></div></div></figure><p id="c459" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以在您的项目中使用这个注册模块。其中一些得到了Terraform背后的公司HashiCorp的验证。</p><p id="2c08" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了将它付诸实践，我们将做同样的操作(创建一个EC2机器)，但是使用<a class="ae kf" href="https://registry.terraform.io/modules/terraform-aws-modules/ec2-instance/aws/1.5.0" rel="noopener ugc nofollow" target="_blank">这个模块</a>。</p><p id="38d6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">创建一个新文件(例如:main2.tf)并添加以下几行:</p><pre class="kh ki kj kk fq mg mf mh mi aw mj dt"><span id="ba18" class="mk lb hu mf b fv ml mm l mn mo"><strong class="mf hv">module</strong> "ec2_cluster" {<br/>  <strong class="mf hv">source</strong> = "terraform-aws-modules/ec2-instance/aws"</span><span id="36e7" class="mk lb hu mf b fv ms mm l mn mo">  name           = "my-cluster"<br/>  instance_count = 5</span><span id="76db" class="mk lb hu mf b fv ms mm l mn mo">  ami                    = "ami-ebd02392"<br/>  instance_type          = "t2.micro"<br/>  key_name               = "user1"<br/>  monitoring             = true<br/>  vpc_security_group_ids = ["sg-12345678"]<br/>  subnet_id              = "subnet-eddcdzz4"</span><span id="fd72" class="mk lb hu mf b fv ms mm l mn mo">  tags = {<br/>    <strong class="mf hv">Terraform</strong> = "true"<br/>    Environment = "dev"<br/>  }<br/>}</span></pre><p id="6ffb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在输入<code class="eh mc md me mf b">terraform init </code>，模块文件将被下载。您可以先使用计划，然后使用应用命令。</p><h1 id="e734" class="la lb hu bd lc ld le lf lg lh li lj lk ja ll jb lm jd ln je lo jg lp jh lq lr dt translated">连接更深</h1><p id="a975" class="pw-post-body-paragraph jj jk hu jl b jm ls iv jo jp lt iy jr js lu ju jv jw lv jy jz ka lw kc kd ke hn dt translated">在本教程中，我们开始用AWS操作Terraform，但这是一个介绍，它将在实际的AWS在线培训中扩展。</p><blockquote class="ne"><p id="3f43" class="nf ng hu bd nh ni nj nk nl nm nn ke ek translated">如果你对<a class="ae kf" href="https://practicalaws.com" rel="noopener ugc nofollow" target="_blank">实用AWS培训</a>感兴趣，可以<a class="ae kf" href="http://practicalaws.com" rel="noopener ugc nofollow" target="_blank">下单</a>马上开始学习AWS。</p><p id="553e" class="nf ng hu bd nh ni nj nk nl nm nn ke ek translated">你也可以下载我的迷你电子书<a class="ae kf" href="https://app.getresponse.com/site2/practical_aws?u=hWKcs&amp;webforms_id=BSioY" rel="noopener ugc nofollow" target="_blank"> 8个学习AWS的好方法</a>。</p></blockquote></div></div>    
</body>
</html>