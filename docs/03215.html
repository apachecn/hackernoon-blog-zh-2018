<html>
<head>
<title>5 Tips to SpeedUp Serverless Web Apps in AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加速AWS中无服务器Web应用的5个技巧</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/speedup-serverless-web-apps-in-aws-12fa25b94600?source=collection_archive---------4-----------------------#2018-04-12">https://medium.com/hackernoon/speedup-serverless-web-apps-in-aws-12fa25b94600?source=collection_archive---------4-----------------------#2018-04-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="5fe4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你是否使用CloudFront、API Gateway、Lambda在AWS中部署了无服务器Web应用程序，但仍然发现它的性能没有达到预期？</p><blockquote class="jp jq jr"><p id="10b4" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hn dt translated">这篇文章主要关注提高无服务器Web应用程序性能的5个技巧。</p></blockquote><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff jw"><img src="../Images/065d04307186215418275996b2341578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NVvmUe2sCxdofP2-UiQyXQ.png"/></div></div></figure><h1 id="a5ac" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">1.保持Lambda函数温暖</h1><p id="1f57" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">AWS Lambda功能具有相当长的冷启动时间。尽管当您增加单个函数的内存时，它会减少，但它仍然可以为您的web应用程序提供显著的效果。</p><p id="0164" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">实现一种机制来保持Lambda函数的热度。您可以使用以下两种方法之一来实现这一点。</p><ul class=""><li id="eb90" class="ll lm hu it b iu iv iy iz jc ln jg lo jk lp jo lq lr ls lt dt translated">使用一个称为“Ping”的特殊端点，从外部调用时，它只调用成功回调。您可以使用AWS <a class="ae lu" href="https://read.acloud.guru/how-to-keep-your-lambda-functions-warm-9d7e1aa6e2f0" rel="noopener ugc nofollow" target="_blank"> CloudWatch </a>调用该功能，或者使用带有预定事件的<a class="ae lu" href="https://docs.aws.amazon.com/lambda/latest/dg/with-scheduled-events.html" rel="noopener ugc nofollow" target="_blank"> Lambda。</a></li><li id="feef" class="ll lm hu it b iu lv iy lw jc lx jg ly jk lz jo lq lr ls lt dt translated">使用无服务器<a class="ae lu" href="https://serverless.com/blog/keep-your-lambdas-warm/" rel="noopener ugc nofollow" target="_blank">预热插件</a>。</li></ul><h1 id="bd66" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">2.通过使用相同的来源访问您的API和前端来避免CORS</h1><p id="fcf4" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">如果你已经将你的前端(Angular，ReactJS，VueJS App)部署到S3，并使用API Gateway提供API，你将遇到CORS(跨源资源共享)。这不是一件坏事，但问题是当你发送像授权(或除了基本头以外的任何东西)这样的头时，modern Browser在发送实际请求之前发送一个特殊的请求，首先称为预检请求。</p><p id="a81a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就产生了瀑布效应，为整个请求的实现增加了两倍的延迟。为了避免这种情况，你可以使用AWS CloudFront和Plugin API Gateway和S3两者到同一个域，并在那里配置路由。</p><p id="07b1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当将API Gateway连接到CloudFront时，请确保执行以下操作</p><ul class=""><li id="518c" class="ll lm hu it b iu iv iy iz jc ln jg lo jk lp jo lq lr ls lt dt translated">创建始发时，将始发协议策略设置为HTTPS</li></ul><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff ma"><img src="../Images/e1e69b03119254c224bfc00b4a94e708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8YSU1_aOIQt-9smjaaunUA.png"/></div></div></figure><ul class=""><li id="daf6" class="ll lm hu it b iu iv iy iz jc ln jg lo jk lp jo lq lr ls lt dt translated">确保您选择了API来源。</li><li id="06be" class="ll lm hu it b iu lv iy lw jc lx jg ly jk lz jo lq lr ls lt dt translated">适当地设置路径模式(例如；<strong class="it hv"><em class="js">/开发阶段/资源/* </em> </strong>)</li><li id="9b00" class="ll lm hu it b iu lv iy lw jc lx jg ly jk lz jo lq lr ls lt dt translated">在创建行为时，<strong class="it hv">不要转发</strong>主机报头(将其余部分列入白名单)</li><li id="4fd6" class="ll lm hu it b iu lv iy lw jc lx jg ly jk lz jo lq lr ls lt dt translated">同样将TTL值设置为0，除非您想要缓存API(即使您计划缓存，也要为各个路径创建单独的行为)。</li></ul><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff mb"><img src="../Images/818710e96951bd7b1d697ef58b37da95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3leE2ddGehkEndkMkzccTA.png"/></div></div></figure><h1 id="804c" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">3.将您的API网关部署为区域端点</h1><p id="9103" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">当您部署API网关时，它会在内部附加一个CloudFront发行版。这造成了延迟，因为它为请求转发增加了另一跳。</p><p id="7495" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以将端点类型设置为区域端点，以将其部署为区域端点来避免这种情况。</p><ul class=""><li id="cf91" class="ll lm hu it b iu iv iy iz jc ln jg lo jk lp jo lq lr ls lt dt translated">如果您使用无服务器框架，请参考<a class="ae lu" href="https://serverless.com/framework/docs/providers/aws/events/apigateway/#configuring-endpoint-types" rel="noopener ugc nofollow" target="_blank">配置端点类型</a>。</li><li id="024d" class="ll lm hu it b iu lv iy lw jc lx jg ly jk lz jo lq lr ls lt dt translated">如果您使用AWS SAM或AWS CLI部署API网关，请根据需要添加“值”:“区域”。</li></ul><h1 id="0c3d" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">4.优化前端</h1><p id="7179" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">即使你使用AWS CloudFront来服务前端，你也可以通过使用GZIP压缩JavaScript、CSS等文件并上传到S3来进一步提高性能。还要确保使用正确的内容编码:gzip头。这将在几个方面减少下载文件所需的带宽。</p><p id="57ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，在CloudFront Behavior configuration中启用Compress Objects Automatically，为请求头中包含Accept-Encoding: gzip的web请求自动压缩内容。这允许CloudFront为亚马逊S3和定制源压缩某些类型的文件。</p><p id="95b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于CloudFront在边缘位置的服务器不忙时会尽最大努力(不保证)将文件压缩到GZIP，因此存储压缩的文件可以提供更好的性能。</p><h1 id="14c0" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">5.为你的Lambda函数使用合适的内存</h1><p id="aedf" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">当你为Lambda使用较小的内存时(例如；128MB)它使用，较低速度的CPU也匹配内存。这可能会对您的Lambda性能产生不利影响。因此，根据函数处理的逻辑适当地增加内存(至少512MB用于生产应用程序)是很重要的。</p></div></div>    
</body>
</html>