<html>
<head>
<title>How I built a real-time chat app using React and Firebase 🔥🔥</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用React和Firebase构建实时聊天应用程序🔥🔥</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/https-medium-com-sargupta-how-i-built-a-real-time-chat-app-using-react-and-firebase-dc8690bf41f7?source=collection_archive---------2-----------------------#2018-04-14">https://medium.com/hackernoon/https-medium-com-sargupta-how-i-built-a-real-time-chat-app-using-react-and-firebase-dc8690bf41f7?source=collection_archive---------2-----------------------#2018-04-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/032333c53c9fc2bfb54aec8498b73ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTAHnz8gq1UkwTa_1sGYdw.png"/></div></div></figure><p id="568f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Medium说你只需要6分钟就可以读完这篇文章，所以拿杯茶继续读下去吧！</p><blockquote class="ka kb kc"><p id="47ea" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">此链接提供应用程序，请查看！</p><p id="c8f2" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><a class="ae kh" href="https://spacedev.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://spacedev.herokuapp.com/</a></p><p id="dad6" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">加入聊天室<code class="eh ki kj kk kl b">test</code>与其他开发者交流！</p></blockquote><p id="1b48" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于那些只对代码感兴趣的人，你可以直接进入🏊‍♂️ <br/>在<a class="ae kh" href="https://github.com/sar-gupta/space/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">自述文件</a>中提供了本地运行的说明。</p><p id="7327" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">给我一颗星星🌟在github上击碎掌声👏如果你喜欢这个项目:</p><h1 id="b77c" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated"><a class="ae kh" href="https://github.com/sar-gupta/space" rel="noopener ugc nofollow" target="_blank">代码在这里</a></h1><p id="86f1" class="pw-post-body-paragraph jc jd hu je b jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv lo jx jy jz hn dt translated">如果您想在接触代码之前先阅读一下这个项目，请继续阅读😄我试图通过加入迷因和gif让读者觉得这篇文章很有趣，希望你喜欢！</p><p id="df5b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以！大家好。我最近学习了React和Firebase，所以我在寻找一些可以练习和获得经验的项目。在经历了大量的想法后，我决定构建一个聊天应用程序。柠檬榨汁机🍋</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff lp"><img src="../Images/db982819952ece71030ff9e51d6680d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*6zuhirVZIsdVdVOWg5IJ8Q.jpeg"/></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">oh well….</figcaption></figure><p id="a5b9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在构建它的过程中，我遇到了许多障碍(实在太多了)。对你来说幸运的是，我正在写我构建这个应用程序的经历，所以如果你决定自己构建一些东西，希望你不会遇到很多问题。但是在你的代码中出现错误并不是坏事。这其实很好，因为你可以学到新的东西！此外，想想这个:你凌晨4点起床，想着如何解决一个问题，黑咖啡是你唯一的伴侣，突然它就灵光一现。您进行了更改，并看到您的代码工作正常。我可以亲自核实；完全是不一样的感觉！</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff ly"><img src="../Images/da7cfd80e0682d840c73d1bfaa79238d.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/1*XFspzXXeYnd0P4wYVKEAdA.gif"/></div></figure><p id="c7ec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">是的，我的最后一周就是这样度过的:睡到很晚才醒，挤压虫子，然后遇到更多的虫子🤐😂</p><p id="d8b8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但最终，这个应用程序开始工作了🎉所以，让我们开始吧。</p><h1 id="72dc" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">关于代码的一切👨‍💻</h1><p id="dc3b" class="pw-post-body-paragraph jc jd hu je b jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv lo jx jy jz hn dt translated">该应用使用<strong class="je hv"> React </strong>和<strong class="je hv"> Redux </strong>管理前端，使用<strong class="je hv"> Firebase </strong>管理后端。React是一个根据应用程序的“状态”在屏幕上呈现应用程序的框架。对于复杂的应用程序，管理这种“状态”变得非常困难。输入Redux。Redux是React的状态管理器。最后，firebase提供后端即服务；超级方便！</p><p id="0b8a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该应用程序的结构如下:</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/1be8dcd5ccfa3bc5792bcf934c40bd30.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*YjhaGQyIS8CHtVSzbbUERQ.jpeg"/></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">App Structure</figcaption></figure><p id="5242" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们所有的React代码都位于src文件夹中。<a class="ae kh" href="https://babeljs.io" rel="noopener ugc nofollow" target="_blank"> Babel </a>为我们编译一切，输出到public/dist/bundle.js</p><p id="2c30" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">服务器服务于公共/文件夹。</p><p id="d926" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我不会用所有的配置文件来烦你，你可以在<a class="ae kh" href="https://github.com/sar-gupta/space" rel="noopener ugc nofollow" target="_blank"> Github </a>上看看。</p><p id="0f6f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以在<a class="ae kh" href="https://github.com/sar-gupta/space/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">自述文件</a>中查看如何设置firebase项目。</p><p id="3161" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我提供了<code class="eh ki kj kk kl b">Login with Github</code>选项，这样我以后可以使用Github API为开发人员集成一些很酷的特性。</p><p id="ec37" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以，我们想做一个实时的app，对。有两件事我们需要反复做很多次。我们需要更新数据库，之后，我们需要用<code class="eh ki kj kk kl b">dispatch</code>动作来更新应用程序<code class="eh ki kj kk kl b">state</code>。如果我要总结这个应用程序，前面的一行将是它。</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/4c44daada507cdeec614e38f7dc10113.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*BA26sWuGSg4lDXGuIMNRMQ.gif"/></div></figure><p id="5acb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如你可能猜到的，数据库主要有两部分:<code class="eh ki kj kk kl b">rooms</code>(聊天室)和<code class="eh ki kj kk kl b">users</code>。</p><p id="8f7f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，每当你想让应用程序重新渲染时，你只需通过调度动作来改变状态。有些动作就像创建房间、加入房间、离开房间、发送消息、更新未读消息数……你大概知道了。</p><p id="2153" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些操作是同步的，这意味着它们一行一行地运行代码，一个接一个。如果有任何异步代码，他们不会等待它返回结果。没有提供<code class="eh ki kj kk kl b">callback</code>或<code class="eh ki kj kk kl b">promise</code>。由于我们必须将数据写入firebase(这是异步的)，我们将使用一个名为<code class="eh ki kj kk kl b">redux-thunk</code>的redux中间件。它为我们提供了调度异步动作的能力。所有动作的一般模式都非常相似:</p><blockquote class="ka kb kc"><p id="9450" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">我们更新数据库，在回调中，我们调度乏味的旧同步操作来更新应用程序状态。</p></blockquote><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/43615ec3db8aeccab62647cba11dd80a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*AYjGMgms7VnxWD4cqU5Qng.gif"/></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Oh Shelly, stop it, will ya?</figcaption></figure><p id="0565" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一个重要的动作是<strong class="je hv">设置开始状态</strong>。每当用户打开你的应用程序时，你想要像他离开时一样向他显示应用程序(带有关于新消息的更新)。你不希望用户每次打开应用程序时都面对黑屏。因此，每当应用程序刷新时，我们通过从数据库中读取来为用户设置开始状态。</p><p id="b4ef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，该应用程序的棘手部分是<strong class="je hv">如何使其实时化？</strong></p><p id="3f33" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">每个用户都有自己的机器，并且状态对于他们的浏览器窗口来说是本地的。知道州是本地的对于构建任何React应用程序都很重要。所谓本地，我的意思是一台机器上的应用程序的状态变化不会影响任何其他机器上的应用程序的状态。</p><p id="535f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们希望当一个用户发送消息时，在同一房间的所有用户的机器上的状态都改变，并显示新发送的消息。那么，我们该怎么做呢？</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/26730f37a2c080f2985e8e3f4cc035ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/1*E-Zv4qZ8f3ZKPQ5gaDIFYg.gif"/></div></figure><p id="f371" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">嗯，这没有你想象的那么复杂。我们的老朋友Firebase是来帮忙的！</p><p id="0ed2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了从数据库中读取数据，firebase大致提供了两种方法:</p><ul class=""><li id="36aa" class="md me hu je b jf jg jj jk jn mf jr mg jv mh jz mi mj mk ml dt translated"><strong class="je hv">。once() </strong>:这将在被调用时给出数据库的一个<code class="eh ki kj kk kl b">snapshot</code>。它只执行一次，然后离开数据库，直到它被再次调用。</li><li id="340d" class="md me hu je b jf mm jj mn jn mo jr mp jv mq jz mi mj mk ml dt translated"><strong class="je hv">。这就是我们手头工作所需要的。该方法开始监听数据库某部分的变化，并在每次该部分更新时运行一个<code class="eh ki kj kk kl b">callback</code>函数。</strong></li></ul><p id="8416" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些方法的文档可以在<a class="ae kh" href="https://firebase.google.com/docs/" rel="noopener ugc nofollow" target="_blank"> firebase文档</a>中的<a class="ae kh" href="https://firebase.google.com/docs/database/web/read-and-write" rel="noopener ugc nofollow" target="_blank">处</a>处找到。</p><p id="b678" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因此，当一个用户发送消息时，会发生以下情况:</p><ol class=""><li id="8338" class="md me hu je b jf jg jj jk jn mf jr mg jv mh jz mr mj mk ml dt translated">数据库用新消息更新。</li><li id="1a7e" class="md me hu je b jf mm jj mn jn mo jr mp jv mq jz mr mj mk ml dt translated">用户的本地状态通过在异步发送消息操作的回调中调度操作来更改。</li><li id="f24c" class="md me hu je b jf mm jj mn jn mo jr mp jv mq jz mr mj mk ml dt translated">该房间的所有用户都使用收听该房间中新留言的变化。firebase提供的on()方法。一旦新消息被写入数据库，调用。在()上调用。我们使用这个函数来调度一个更新用户本地状态的动作。这个回调被同时调用到所有用户的机器上，这些机器在那个特定的房间里监听新消息的变化。</li></ol><p id="9e43" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">(2和3几乎同时发生，因为两者都在数据写入数据库后立即触发)。</p><p id="accf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">理解异步和同步应用程序的概念对于构建任何web应用程序都是必不可少的。我遇到过无数次bug，只是因为我忘记了某个事件的异步本质。代码中的这种错误很难被发现，因为它不会产生任何错误。它就是不做它应该做的事情，也不解释为什么会这样。</p><p id="b32a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我希望你喜欢这篇文章，并在此过程中学到一些新东西！</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/b588312ee267ca67369104c9b08060de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*yvASRwPSrG0qyl6V5XQC5A.gif"/></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">That’s all, folks!</figcaption></figure><h2 id="b242" class="ms kn hu bd ko mt mu mv ks mw mx my kw jn mz na la jr nb nc le jv nd ne li nf dt translated">这款应用程序远非完美，但你帮助它更接近那个目标，同时将另一个项目(作为贡献者)添加到你的简历中！</h2><p id="2d7d" class="pw-post-body-paragraph jc jd hu je b jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv lo jx jy jz hn dt translated">随意分叉<a class="ae kh" href="https://github.com/sar-gupta/space" rel="noopener ugc nofollow" target="_blank"> github库</a>并打开问题和拉请求。</p><p id="e745" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你不想一路向上滚动代码，我会告诉你:</p><h1 id="e16a" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated"><a class="ae kh" href="https://github.com/sar-gupta/space" rel="noopener ugc nofollow" target="_blank">代码在这里</a></h1><h1 id="95fe" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">如果你喜欢这篇文章，请打星号🌟github上的项目，给我一些掌声👏中号(大家都喜欢更多的拍手声吧？😛).</h1></div></div>    
</body>
</html>