<html>
<head>
<title>The Sneakiest Ethereum “Scam” (honeypot) Ever</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有史以来最狡猾的以太坊“骗局”(蜜罐)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-sneakiest-ethereum-scam-ever-6dc138061235?source=collection_archive---------8-----------------------#2018-04-17">https://medium.com/hackernoon/the-sneakiest-ethereum-scam-ever-6dc138061235?source=collection_archive---------8-----------------------#2018-04-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4ffd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最近看到一条关于一个卑鄙骗局的推文，有人会泄露拥有一些代币并需要汽油来提取它们的账户的私钥。它有一个智能合同，可以将任何发送到它的地址的eth传送到另一个合同。我觉得这很不错，这让我想起了几个月前我看到的另一个“骗局”，在我看来，这个骗局甚至更狡猾。共同点是，这两种骗局都试图从一开始就怀有不良意图的人那里获得金钱。</p><p id="f1d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">人们已经写了一些关于以太坊蜜罐的文章，但是我在这篇文章中要介绍的是其中最隐秘的一个。如果你不知道什么是蜜罐，在以太坊的例子中，它是一个智能合同，希望让阅读代码的人认为他可以破解它，并从合同中撤回以太。但是为了破解它，你将不得不发送以太网，你将永远得不到他们回来。所以基本上就是“黑了黑客”。</p><p id="b54f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经监视以太坊链好几个月了，我的眼睛变得非常善于发现蜜罐。通常它们都不是那么原创。但在这件事上，我有一个严重的疑问。我甚至找了一个我认为比自己扎实的黑客朋友来看看。他的第一反应是告诉我，这不是一个蜜罐，你可以很容易地从合同中撤销乙醚。因此，他继续发送1 eth到合同，并丢失了它…从这一点上，我知道蜜罐是在另一个水平=D。</p><p id="044e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是合同的代码:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ju jv l"/></div></figure><p id="e6e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">看起来很简单也很脆弱，对吧？<code class="eh jw jx jy jz b">shuffle()</code>函数将生成一个“随机”数，该函数首先在构造函数中被调用。</p><p id="2794" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这一点上每个人都知道</p><pre class="jp jq jr js fq ka jz kb kc aw kd dt"><span id="6ef9" class="ke kf hu jz b fv kg kh l ki kj">uint8(sha3(now, block.blockhash(block.number-1))) % 20 + 1;</span></pre><p id="080d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不是生成随机数的好方法。这是我们的诱饵。如果你是一个想成为黑客的人，当你打开你的以太钱包希望成为第一个从这个合同中抢夺以太的人时，你看到这条线，你的心跳开始跳动。要获得“秘密”数字，只需查询契约的存储，因为它是在构造函数中创建的。但是当然你也可以预测每一个新的<code class="eh jw jx jy jz b">shuffle()</code>将会产生的“秘密”数字。我们不打算在这里讨论这个问题，因为我想这个问题以前已经讨论过很多次了。</p><p id="118c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以我们想成为黑客的人现在上当了，他打开钱包，拿到号码，用正确的号码和一些以太AAA和…调用<code class="eh jw jx jy jz b">play()</code>函数</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff kk"><img src="../Images/4ff22273eddd5e4fe8a904274bedec9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*ogumd4kxN7_7aO182e1qmw.png"/></div></figure><p id="28cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是到底发生了什么？</p><p id="af8e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了理解它，我用正确的数字调用了<code class="eh jw jx jy jz b">play()</code>函数，并观察了Remix调试器中发生的情况。在这种情况下，我们的秘密数字是17(十六进制0x11)。因为<code class="eh jw jx jy jz b">secretNumber</code>变量是契约中声明的第一个变量，所以它位于地址0:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff kn"><img src="../Images/21caf408ae6b7d63b59e89aee8b7d38f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*qT5dExzdcbrWYPglvYUALA.png"/></div></figure><p id="1ce9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">随着函数的进展，我可以看到该地址的值被覆盖了:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/c6af0cec16a86f6b282f4a4d98bf60fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*9hhUOZuDZ2cyi4TneEpk1A.png"/></div></figure><p id="d2f0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在代码中添加了两个事件，以清晰的方式输出发生的事情:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="fe ff kp"><img src="../Images/4ebe6549f83dd62ab4d8540512435b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ev9DYbtDwwPAtzcEEsQhJg.png"/></div></div></figure><p id="82e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Solidity中，struct默认为<code class="eh jw jx jy jz b">storage</code>(另一个选项是<code class="eh jw jx jy jz b">memory</code>)，因为我们的struct未初始化，所以它实际上指向地址0。所以在这个契约的第37行，我们写到地址0，因为它是<code class="eh jw jx jy jz b">secretNumber</code>的存储地址，所以它改变了它的值。因此<code class="eh jw jx jy jz b">secretNumber</code>永远不会等于你的号码，你也拿不到钱……之后，对<code class="eh jw jx jy jz b">shuffle()</code>的新呼叫被发出，一切又看起来很好，\_(ツ)_/</p><p id="db08" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我在二月份发现的第一份合同:</p><div class="ku kv fm fo kw kx"><a href="https://etherscan.io/address/0x6f952d7acaa2dffaecfe34d064ed5b46fcc59664" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab ej"><div class="kz ab la cl cj lb"><h2 class="bd hv fv z el lc eo ep ld er et ht dt translated">以太坊账户、地址和合同</h2><div class="le l"><h3 class="bd b fv z el lc eo ep ld er et ek translated">以太坊区块链浏览器、API和分析平台</h3></div><div class="lf l"><p class="bd b gc z el lc eo ep ld er et ek translated">etherscan.io</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll kl kx"/></div></div></a></div><p id="f976" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我也有一个Github repo，在那里我跟踪已知的蜜罐:</p><div class="ku kv fm fo kw kx"><a href="https://github.com/misterch0c/Solidlity-Vulnerable/tree/master/honeypots" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab ej"><div class="kz ab la cl cj lb"><h2 class="bd hv fv z el lc eo ep ld er et ht dt translated">易混淆/易混淆</h2><div class="le l"><h3 class="bd b fv z el lc eo ep ld er et ek translated">稳固-脆弱-脆弱智能合约</h3></div><div class="lf l"><p class="bd b gc z el lc eo ep ld er et ek translated">github.com</p></div></div><div class="lg l"><div class="lm l li lj lk lg ll kl kx"/></div></div></a></div></div></div>    
</body>
</html>