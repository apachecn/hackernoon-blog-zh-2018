<html>
<head>
<title>How will you handle null references if you are designing a new language?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果你正在设计一门新的语言，你将如何处理空引用？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-will-you-handle-null-references-if-you-are-designing-a-new-language-b1e4056456fc?source=collection_archive---------14-----------------------#2018-04-18">https://medium.com/hackernoon/how-will-you-handle-null-references-if-you-are-designing-a-new-language-b1e4056456fc?source=collection_archive---------14-----------------------#2018-04-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/71f35f2c958a4d2acf7bd1936aee4928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ZIEC_Tstjqg8vfFg2_M1g.png"/></div></div></figure><div class=""/><div class=""><h2 id="3ec0" class="pw-subtitle-paragraph jc ie if bd b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ek translated">科特林处理零安全的惯用方法</h2></div><p id="fe42" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">计算机科学家<strong class="jw ig">东尼·霍尔</strong>说:</p><blockquote class="kq kr ks"><p id="044a" class="ju jv kt jw b jx jy jg jz ka kb jj kc ku ke kf kg kv ki kj kk kw km kn ko kp hn dt translated">我称之为我的十亿美元错误。这是1965年零引用的发明</p></blockquote><p id="fa73" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated"><em class="kt">可空的</em>对象引入了类型系统的一个基本问题。例如，如果您将一个对象声明为String，它不能保证该值是真实的<strong class="jw ig"> <em class="kt"> String </em> </strong>或<strong class="jw ig"> <em class="kt"> null </em> </strong>。</p><p id="6d5a" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">基于我们对控制代码流的假设，我们通常会跳过<em class="kt"> null </em>检查。但是当我们出错时，代码崩溃，出现空指针异常。Java 8引入了处理可空对象的选项。但是它有一些缺陷</p><h1 id="69c5" class="kx ky if bd kz la lb lc ld le lf lg lh jl li jm lj jo lk jp ll jr lm js ln lo dt translated">为什么Java选项不是处理空值的好方法？</h1><p id="3fd7" class="pw-post-body-paragraph ju jv if jw b jx lp jg jz ka lq jj kc kd lr kf kg kh ls kj kk kl lt kn ko kp hn dt translated">将对象包装和解包到可选类中会使代码冗长。此外，因为它只在JDK8中引入，所以您仍然需要处理从旧的JDK方法返回的空值。</p><h1 id="b0cb" class="kx ky if bd kz la lb lc ld le lf lg lh jl li jm lj jo lk jp ll jr lm js ln lo dt translated">科特林如何处理空安全？</h1><p id="88d0" class="pw-post-body-paragraph ju jv if jw b jx lp jg jz ka lq jj kc kd lr kf kg kh ls kj kk kl lt kn ko kp hn dt translated">如果你正在设计一种新的语言，你将如何处理空引用？你不会为nullables 添加一个显式类型定义吗？科特林就是这么做的。</p><p id="7d19" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">默认情况下，所有对象都是<em class="kt">不可空的</em>，所以不能在其中存储<em class="kt">空值</em>。但是如果一个变量可以保存空值，你必须显式地追加<code class="eh lu lv lw lx b">?</code>来表明它的<em class="kt">可以为空</em>。然后，Kotlin强迫你使用安全调用操作符<code class="eh lu lv lw lx b">?.</code>调用它们的方法</p><figure class="ly lz ma mb fq hw"><div class="bz el l di"><div class="mc md l"/></div></figure><h1 id="4d11" class="kx ky if bd kz la lb lc ld le lf lg lh jl li jm lj jo lk jp ll jr lm js ln lo dt translated">如何替换Kotlin中的Java选项？</h1><p id="a55e" class="pw-post-body-paragraph ju jv if jw b jx lp jg jz ka lq jj kc kd lr kf kg kh ls kj kk kl lt kn ko kp hn dt translated">用Java选项可以做的任何事情都可以用Kotlin的惯用方式来完成。例如:</p><ul class=""><li id="acca" class="me mf if jw b jx jy ka kb kd mg kh mh kl mi kp mj mk ml mm dt translated">做转换<code class="eh lu lv lw lx b">Optional.map(...)</code>可以换成安全调用操作<code class="eh lu lv lw lx b">?.</code></li><li id="3213" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp mj mk ml mm dt translated">为了从集合中过滤非空值，我们可以使用集合库中的<code class="eh lu lv lw lx b">filterNonNull()</code>方法。</li><li id="f114" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp mj mk ml mm dt translated">要仅在值为非空的时执行一段代码，可以使用Kotlin中的<code class="eh lu lv lw lx b">let</code>函数。<code class="eh lu lv lw lx b">let</code>函数在值为<em class="kt">非空</em>时执行一段代码很有用。</li><li id="edcc" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp mj mk ml mm dt translated">要在null的情况下指定默认值，可以使用elvis <code class="eh lu lv lw lx b">?:</code>运算符。</li><li id="c7be" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp mj mk ml mm dt translated">Elvis <code class="eh lu lv lw lx b">?:</code>操作符也可以用于在null的情况下抛出异常</li></ul><p id="fcd0" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">下面的代码展示了Java选项和它们在Kotlin中的对等物。</p><figure class="ly lz ma mb fq hw"><div class="bz el l di"><div class="mc md l"/></div></figure><h1 id="fa3c" class="kx ky if bd kz la lb lc ld le lf lg lh jl li jm lj jo lk jp ll jr lm js ln lo dt translated">与Java代码混合时，Kotlin如何确保空安全？</h1><p id="227f" class="pw-post-body-paragraph ju jv if jw b jx lp jg jz ka lq jj kc kd lr kf kg kh ls kj kk kl lt kn ko kp hn dt translated">Kotlin与接受<em class="kt">可空的</em>对象作为参数的Java方法很好地互操作。它使用注解<code class="eh lu lv lw lx b">@Nullable</code>和<code class="eh lu lv lw lx b">@NotNull</code>来完成，你可以从<code class="eh lu lv lw lx b">org.jetbrains.annotations</code>包中导入它们。</p><ol class=""><li id="6e91" class="me mf if jw b jx jy ka kb kd mg kh mh kl mi kp ms mk ml mm dt translated">如果一个方法参数没有被注释，Kotlin编译器不能阻止你传递空值，所以如果你传递空值，它会导致NPE。</li><li id="1bf6" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp ms mk ml mm dt translated">如果一个方法参数用<code class="eh lu lv lw lx b">@NotNull</code>注释，Kotlin编译器不允许你传递空值<em class="kt">。</em></li><li id="29ca" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp ms mk ml mm dt translated">如果一个方法参数用<code class="eh lu lv lw lx b">@Nullable</code>注释，Kotlin编译器将允许您传递空值<em class="kt">，但是如果不安全处理，可能会导致NPE。</em></li></ol><p id="e502" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">下面的例子展示了带有注释的Java方法，以及从Kotlin调用时它的行为。</p><figure class="ly lz ma mb fq hw"><div class="bz el l di"><div class="mc md l"/></div></figure><blockquote class="kq kr ks"><p id="96c5" class="ju jv kt jw b jx jy jg jz ka kb jj kc ku ke kf kg kv ki kj kk kw km kn ko kp hn dt translated">从Kotlin调用Java代码时，总是使用<code class="eh lu lv lw lx b">@Nullable</code>和<code class="eh lu lv lw lx b">@NotNull</code>注释。</p></blockquote><h1 id="cbb9" class="kx ky if bd kz la lb lc ld le lf lg lh jl li jm lj jo lk jp ll jr lm js ln lo dt translated">你真的需要使用可空对象吗？</h1><ul class=""><li id="6b7f" class="me mf if jw b jx lp ka lq kd mt kh mu kl mv kp mj mk ml mm dt translated">如果参数值为<em class="kt"> null </em>，只需不调用方法，就可以避免将可空类型作为方法参数传递。</li><li id="cf38" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp mj mk ml mm dt translated">使用集合时，可以用空集合替换可空变量。</li><li id="3884" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp mj mk ml mm dt translated">如果你需要表现一个物体的缺失。例如，链表中的下一个节点或树中的左节点。使用<a class="ae mw" href="https://sourcemaking.com/design_patterns/null_object" rel="noopener ugc nofollow" target="_blank">空对象设计模式</a>代替空引用</li><li id="6cb7" class="me mf if jw b jx mn ka mo kd mp kh mq kl mr kp mj mk ml mm dt translated">这将使你有唯一的理由使用空引用在边界条件和错误的情况下从一个方法返回值。甚至这也可以通过使用函数式风格<a class="ae mw" href="http://erajasekar.com/posts/better-exception-handling-java8-streams-using-javaslang/" rel="noopener ugc nofollow" target="_blank">来避免，试试Monad </a>。</li></ul><blockquote class="kq kr ks"><p id="f896" class="ju jv kt jw b jx jy jg jz ka kb jj kc ku ke kf kg kv ki kj kk kw km kn ko kp hn dt translated">除非绝对需要，否则不要使用可空类型</p></blockquote><h1 id="e976" class="kx ky if bd kz la lb lc ld le lf lg lh jl li jm lj jo lk jp ll jr lm js ln lo dt translated">参考</h1><p id="d455" class="pw-post-body-paragraph ju jv if jw b jx lp jg jz ka lq jj kc kd lr kf kg kh ls kj kk kl lt kn ko kp hn dt translated">书:<a class="ae mw" href="https://amzn.to/2HdDX3c" rel="noopener ugc nofollow" target="_blank">科特林在行动</a></p></div></div>    
</body>
</html>