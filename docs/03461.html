<html>
<head>
<title>How to build your own portable plug-in Lightning node!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建自己的便携插件Lightning节点！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-your-own-portable-plug-in-lightning-node-c4093a4b10fb?source=collection_archive---------1-----------------------#2018-04-20">https://medium.com/hackernoon/how-to-build-your-own-portable-plug-in-lightning-node-c4093a4b10fb?source=collection_archive---------1-----------------------#2018-04-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/208a51bae59a63be08d050cd0a9896f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8gv4N5c65BKlIj7q8A-rg.jpeg"/></div></div></figure><p id="66a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">部分:</p><ul class=""><li id="51b5" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">简介/要求</li><li id="d345" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">数据包转发设置</li><li id="6c6e" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">建筑<code class="eh ko kp kq kr b">c-lightning</code>和<code class="eh ko kp kq kr b">bitcoin-cli</code></li><li id="f492" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">安装闪电充电</li><li id="c994" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">为销售点解决方案安装<code class="eh ko kp kq kr b">nanopos</code></li></ul></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><p id="566a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">反向路径USB军械库是现在流行的SoC供电的硬件类别中的一个独特的设备，包括Raspberry Pi和Rock64。像其他系统一样，它在计算能力方面相对不足。然而，它的独特之处在于其紧凑的外形和组件。军械库不需要电源适配器或墙上插座；它只需要一个USB接口就能工作。军械库通过USB为自己供电，并以同样的方式通过模拟以太网连接与其主机设备通信。军械库采用运行频率为800 Mhz的恩智浦I . MX53 ARM Cortex-A8处理器。它还包括512 MB的DDR3 RAM和一个用于存储的microSD卡插槽。</p><blockquote class="kz la lb"><p id="81bc" class="jc jd lc je b jf jg jh ji jj jk jl jm ld jo jp jq le js jt ju lf jw jx jy jz hn dt translated">USB armory板由Inverse Path创建，用于支持各种安全应用的开发。</p><p id="ded8" class="jc jd lc je b jf jg jh ji jj jk jl jm ld jo jp jq le js jt ju lf jw jx jy jz hn dt translated">模拟任意USB设备的能力与i.MX53 SoC速度、安全功能以及灵活和完全可定制的操作环境相结合，使USB armory成为各种个人安全应用的理想平台。</p><p id="1fac" class="jc jd lc je b jf jg jh ji jj jk jl jm ld jo jp jq le js jt ju lf jw jx jy jz hn dt translated">USB军械库硬件的开放和最小化设计的透明性促进了可审计性，并且极大地限制了供应链攻击的可能性和范围。来自:<a class="ae lg" href="https://inversepath.com/usbarmory" rel="noopener ugc nofollow" target="_blank">https://inversepath.com/usbarmory</a></p></blockquote></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><p id="76e2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">利用外形、USB供电和模拟USB以太网的一个很好的用例是便携式比特币闪电钱包。通过这种配置，用户可以设置一个运行<code class="eh ko kp kq kr b">c-lightning</code>的设备，并将他们的私钥存储在一个便携式平台上，该平台可以轻松插入现有的硬件，如运行<code class="eh ko kp kq kr b">bitcoind</code>的Raspberry Pis。另外，另一种情况是，如果用户有一台运行完整节点的笔记本电脑。军械库可以简单地插入电源，然后用户可以通过Lightning网络进行交易，并运行Lightning供电的应用程序(LApps)。</p><p id="c333" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这种设置的另一个用例是为功能不足的设备增加处理能力，如较旧的笔记本电脑或Raspberry Pi。这样，军械库就像是闪电的协处理器！</p><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lh"><img src="../Images/6fd69f578003a108618b8ad001e20e6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KOXpu0Y1fZy61d3oRacMnQ.jpeg"/></div></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">An Armory connected to a Rock64</figcaption></figure><h1 id="39b4" class="lq lr hu bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn dt translated">要求:</h1><ul class=""><li id="50b8" class="ka kb hu je b jf mo jj mp jn mq jr mr jv ms jz kf kg kh ki dt translated"><a class="ae lg" href="https://inversepath.com/usbarmory" rel="noopener ugc nofollow" target="_blank">一个反路径USB军械库</a></li><li id="5177" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">安装了<a class="ae lg" href="https://github.com/inversepath/usbarmory-debian-base_image/releases" rel="noopener ugc nofollow" target="_blank">官方Debian基本映像</a>的4GB或更大容量的microSD卡</li><li id="2790" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">USB主机设备(笔记本电脑、工作站或类似RPi的设备)</li><li id="1efc" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">在您的局域网上运行，或在其他地方使用RPC的访问凭证运行</li></ul></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><h1 id="1cb3" class="lq lr hu bd ls lt mt lv lw lx mu lz ma mb mv md me mf mw mh mi mj mx ml mm mn dt translated"><code class="eh ko kp kq kr b">Prep</code>打开军械库进行安装:</h1><p id="89ba" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated">对于<code class="eh ko kp kq kr b">lightningd</code>来说，与远程<code class="eh ko kp kq kr b">bitcoind</code>通信所需要的就是<code class="eh ko kp kq kr b">bitcoin-cli</code>，这大大减少了建造军械库所需的时间。交叉编译是可能的，但这超出了本指南的范围。为了只构建<code class="eh ko kp kq kr b">bitcoin-cli</code>，比特币代码需要从其Github存储库中取出。但是，在此之前，必须在主机设备(军械库插入的设备)上启用数据包转发。</p><h1 id="edaf" class="lq lr hu bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn dt translated">网络:</h1><p id="57ea" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated">军械库(如果使用官方的Debian基本映像)在插入并启动时，会创建一个虚拟接口<a class="ae lg" href="https://en.wikipedia.org/wiki/Ethernet_over_USB" rel="noopener ugc nofollow" target="_blank">来模拟以太网连接</a>。一旦配置完成，军械库和它的USB主机就可以像在同一个局域网上一样互相通信(因为从技术上来说他们是在同一个局域网上)。由USB主机决定是否允许军械库的数据包被转发，如果允许，这将使军械库能够打开与本地网络之外的其他节点的Lightning网络通道。安装构建工具和依赖项也需要数据包转发。</p><h2 id="5823" class="nb lr hu bd ls nc nd ne lw nf ng nh ma jn ni nj me jr nk nl mi jv nm nn mm no dt translated">窗口:</h2><p id="e6fc" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated">在Windows 7、8和10上启用数据包转发(也称为连接共享)的说明可以在<a class="ae lg" href="https://github.com/inversepath/usbarmory/wiki/Host-communication#setup--connection-sharing-windows-7-8-10" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="5ffa" class="nb lr hu bd ls nc nd ne lw nf ng nh ma jn ni nj me jr nk nl mi jv nm nn mm no dt translated">MacOS:</h2><p id="a55a" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated">MacOS指令可以在<a class="ae lg" href="https://github.com/inversepath/usbarmory/wiki/Host-communication#setup--connection-sharing-macos" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="fc32" class="nb lr hu bd ls nc nd ne lw nf ng nh ma jn ni nj me jr nk nl mi jv nm nn mm no dt translated">Linux:</h2><p id="1ea6" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated"><em class="lc">注:在Ubuntu 16.04上，网管不干预。但是，其他发行版的配置可能会。</em></p><p id="0480" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">来自Linux的<a class="ae lg" href="https://github.com/inversepath/usbarmory/wiki/Host-communication#setup--connection-sharing-linux" rel="noopener ugc nofollow" target="_blank">指令:</a></p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="94cd" class="nb lr hu kr b fv nt nu l nv nw"><strong class="kr hv">Enable masquerading for outgoing connections</strong>:</span><span id="3234" class="nb lr hu kr b fv nx nu l nv nw"># iptables -t nat -A POSTROUTING -s 10.0.0.2/32 -o wlan0 -j MASQUERADE<br/><br/><strong class="kr hv">enable IP forwarding:</strong></span><span id="ebaf" class="nb lr hu kr b fv nx nu l nv nw"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></pre></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><p id="fdb9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">插入军械库，注意闪烁的白色LED。这意味着军械库正在运行。当军械库被使用时,“心跳”LED闪烁更快。</p><p id="6c81" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，用Debian基本映像的默认凭证<code class="eh ko kp kq kr b">ssh</code>进入您的军械库(用户名和密码都是<code class="eh ko kp kq kr b">usbarmory</code>)</p><p id="b0cc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ko kp kq kr b">$ ssh usbarmory@10.0.0.1</code></p><p id="be83" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Ping一个公共地址，看看你的军械库路由是否正确:</p><p id="7b43" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ko kp kq kr b">$ ping 8.8.8.8</code></p><p id="e085" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果成功，您将收到回复:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="dc2b" class="nb lr hu kr b fv nt nu l nv nw">PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br/>64 bytes from 8.8.8.8: icmp_seq=1 ttl=60 time=46.3 ms<br/>64 bytes from 8.8.8.8: icmp_seq=2 ttl=60 time=48.0 ms<br/>64 bytes from 8.8.8.8: icmp_seq=3 ttl=60 time=48.1 ms<br/>64 bytes from 8.8.8.8: icmp_seq=4 ttl=60 time=71.5 ms</span></pre><p id="05cf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太好了！</p></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><h1 id="a970" class="lq lr hu bd ls lt mt lv lw lx mu lz ma mb mv md me mf mw mh mi mj mx ml mm mn dt translated">建筑c-闪电:</h1><p id="a5ee" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated"><code class="eh ko kp kq kr b">$ sudo apt update &amp;&amp; sudo apt -y upgrade</code></p><p id="4d77" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦完成，重启军械库以防内核更新:</p><p id="cd82" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ko kp kq kr b">$ sudo reboot</code></p><p id="305a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，开始安装编译<code class="eh ko kp kq kr b">bitcoin-cli</code>和<code class="eh ko kp kq kr b">c-lightning</code>所需的构建工具和依赖项:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="dcb4" class="nb lr hu kr b fv nt nu l nv nw">$ sudo apt-get install -y \<br/>  autoconf automake build-essential git libtool libgmp-dev \<br/>  libsqlite3-dev python python3 net-tools libsodium-dev \<br/>  pkg-config libssl-dev libevent-dev \<br/>  libboost-system-dev libboost-filesystem-dev \<br/>  libboost-chrono-dev libboost-program-options-dev \<br/>  libboost-test-dev libboost-thread-dev tmux curl</span></pre><p id="f410" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">克隆<code class="eh ko kp kq kr b">c-lightning</code>库:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="758d" class="nb lr hu kr b fv nt nu l nv nw">$ git clone https://github.com/ElementsProject/lightning.git</span></pre><p id="b107" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">导航到本地存储库:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="ace3" class="nb lr hu kr b fv nt nu l nv nw">$ cd lightning</span></pre><p id="9efe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后开始构建:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="4646" class="nb lr hu kr b fv nt nu l nv nw">$ make</span></pre><p id="7421" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完成后，导航到<code class="eh ko kp kq kr b">usbarmory</code>用户的主目录:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="bdb8" class="nb lr hu kr b fv nt nu l nv nw">$ cd ~/</span></pre><p id="b2ba" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下载比特币核心0.16.0源代码档案SHA256SUMS.asc，导入核心维护者的gpg密钥验证哈希值。最后，解压缩归档文件:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="b13e" class="nb lr hu kr b fv nt nu l nv nw">$ wget <a class="ae lg" href="https://bitcoincore.org/bin/bitcoin-core-0.16.0/bitcoin-0.16.0-x86_64-linux-gnu.tar.gz" rel="noopener ugc nofollow" target="_blank">https://bitcoincore.org/bin/bitcoin-core-0.16.0/bitcoin-0.16.0.tar.gz</a></span><span id="04ed" class="nb lr hu kr b fv nx nu l nv nw">$ wget <a class="ae lg" href="https://bitcoincore.org/bin/bitcoin-core-0.16.0/SHA256SUMS.asc" rel="noopener ugc nofollow" target="_blank">https://bitcoincore.org/bin/bitcoin-core-0.16.0/SHA256SUMS.asc</a></span><span id="cae9" class="nb lr hu kr b fv nx nu l nv nw">$ gpg --recv-key 90C8019E36C2E964</span><span id="2fc9" class="nb lr hu kr b fv nx nu l nv nw">$ gpg --verify SHA256SUMS.asc</span><span id="8ac2" class="nb lr hu kr b fv nx nu l nv nw">$ sha256sum -c --ignore-missing SHA256SUMS.asc<br/># should output an "OK"</span><span id="ba26" class="nb lr hu kr b fv nx nu l nv nw">$ tar zxvf bitcoin-0.16.0.tar.gz</span></pre><p id="8e5b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太棒了。</p><p id="918f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，开始建造<code class="eh ko kp kq kr b">bitcoin-cli</code>。</p></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><h1 id="8d84" class="lq lr hu bd ls lt mt lv lw lx mu lz ma mb mv md me mf mw mh mi mj mx ml mm mn dt translated">构建比特币-cli:</h1><p id="088b" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated">导航到比特币源代码目录并开始构建过程:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="7626" class="nb lr hu kr b fv nt nu l nv nw">$ cd bitcoin-0.16.0/</span><span id="369f" class="nb lr hu kr b fv nx nu l nv nw">$ ./autogen.sh</span></pre><p id="b83e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">运行<code class="eh ko kp kq kr b">autogen.sh</code>时，可能会出现大量关于语言环境的警告消息。这可以通过设置区域设置来解决:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="687e" class="nb lr hu kr b fv nt nu l nv nw">$ sudo dpkg-reconfigure locales</span><span id="e221" class="nb lr hu kr b fv nx nu l nv nw"># Select something like en_US.UTF-8 and hit Ok</span></pre><p id="72fe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">继续构建过程:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="ede6" class="nb lr hu kr b fv nt nu l nv nw">$ CFLAGS="-march=native" ./configure --disable-wallet</span></pre><p id="befd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ko kp kq kr b">-march=native</code>告诉我们的编译器<code class="eh ko kp kq kr b">gcc</code>，自动检测军械库的处理器，并启用针对该处理器的优化。它有助于挤出ARM处理器的任何性能增加，这很重要，因为这种处理器相对较慢。</p><p id="5bc4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ko kp kq kr b">bitcoind</code>没有在建，所以不需要<code class="eh ko kp kq kr b">libdb</code>。传递<code class="eh ko kp kq kr b">--disable-wallet</code>以在不支持wallet的情况下构建(<code class="eh ko kp kq kr b">c-lightning</code>将是此配置中的wallet)。</p><p id="6484" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，构建<code class="eh ko kp kq kr b">bitcoin-cli</code>:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="7e68" class="nb lr hu kr b fv nt nu l nv nw">$ make src/bitcoin-cli</span></pre><p id="3c47" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，将新构建的<code class="eh ko kp kq kr b">bitcoin-cli</code>二进制文件复制到<code class="eh ko kp kq kr b">/usr/local/bin</code>:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="9680" class="nb lr hu kr b fv nt nu l nv nw">$ sudo cp src/bitcoin-cli /usr/local/bin</span><span id="ad8a" class="nb lr hu kr b fv nx nu l nv nw">$ whereis bitcoin-cli</span><span id="f40e" class="nb lr hu kr b fv nx nu l nv nw"># Should return "/usr/local/bin/bitcoin-cli"</span></pre><h1 id="4c35" class="lq lr hu bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn dt translated">通过RPC将军械库连接到<code class="eh ko kp kq kr b">bitcoind</code>:</h1><p id="7623" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated"><code class="eh ko kp kq kr b">c-lightning</code>使用<code class="eh ko kp kq kr b">bitcoin-cli</code>向<code class="eh ko kp kq kr b">bitcoind</code>发送原始交易，原因多种多样，如打开、强制关闭或相互关闭通道。由于<code class="eh ko kp kq kr b">c-lightning</code>在军械库运行，它也需要<code class="eh ko kp kq kr b">bitcoin-cli</code>。然而，<code class="eh ko kp kq kr b">bitcoin-cli</code>需要能够与<code class="eh ko kp kq kr b">bitcoind</code>通信，所以创建合适的物品并添加到军械库和USB主机中，<code class="eh ko kp kq kr b">bitcoin.conf</code>:</p><p id="3a49" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在USB主机上，或运行<code class="eh ko kp kq kr b">bitcoind</code>的其他设备上，在<code class="eh ko kp kq kr b">bitcoin.conf</code>中指定以下项目:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="8bf0" class="nb lr hu kr b fv nt nu l nv nw">rpcuser= &lt;username&gt;<br/>rpcpassword= &lt;yourpasswordnotthisone&gt;<br/>rpcallowip= &lt;the Armory's IP address&gt;</span></pre><p id="8574" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">保存这些更改，然后创建军械库的<code class="eh ko kp kq kr b">bitcoin.conf</code>，并添加以下物品:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="c702" class="nb lr hu kr b fv nt nu l nv nw">$ nano ~/.bitcoin/bitcoin.conf</span></pre><p id="201e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<code class="eh ko kp kq kr b">bitcoin.conf</code>中:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="3165" class="nb lr hu kr b fv nt nu l nv nw">rpcuser= &lt;username from before&gt;<br/>rpcpassword= &lt;password from before&gt;<br/>rpcconnect= &lt;USB hosts's IP (10.0.0.2)&gt;</span></pre><p id="ba81" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用<code class="eh ko kp kq kr b">10.0.0.2</code>替换<code class="eh ko kp kq kr b">bitcoind</code>可能监听的IP地址(例如<code class="eh ko kp kq kr b">192.168.0.254</code></p><p id="c740" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">尝试向军械库查询<code class="eh ko kp kq kr b">bitcoind</code>:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="3580" class="nb lr hu kr b fv nt nu l nv nw">$ bitcoin-cli -getinfo</span></pre><p id="9bd6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果成功，将返回一个带有相关信息的响应(方块高度、难度等)。)</p><p id="ebee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">厉害！</p></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><h1 id="7b18" class="lq lr hu bd ls lt mt lv lw lx mu lz ma mb mv md me mf mw mh mi mj mx ml mm mn dt translated">运行c-lightning:</h1><p id="d97e" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated">既然一切都已构建、配置并正确联网，那么就可以运行<code class="eh ko kp kq kr b">c-lightning</code>了。</p><p id="a702" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">启动<code class="eh ko kp kq kr b">tmux</code>会话，然后启动<code class="eh ko kp kq kr b">lightningd</code>:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="62fb" class="nb lr hu kr b fv nt nu l nv nw">$ tmux<br/>$ ./lightning/lightningd/lightningd --network testnet --log-level debug<br/>$ ./lightning/cli/lightning-cli getinfo</span></pre><p id="701e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lc">注:传</em> <code class="eh ko kp kq kr b"><em class="lc">--network bitcoin</em></code> <em class="lc">代替，如果你#鲁莽。</em></p><p id="a6ec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果<code class="eh ko kp kq kr b">lightningd</code>开始输出<code class="eh ko kp kq kr b">Adding block &lt;block number&gt;</code>，并且<code class="eh ko kp kq kr b">lightning-cli</code>返回当前方块高度(以及其他信息)，则军械库设置成功！</p><p id="8ad7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ko kp kq kr b">lightning-cli</code>现在可以用来生成新的地址进行比特币的存取，以及开启/关闭闪电网络通道！</p><h1 id="fcaa" class="lq lr hu bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn dt translated">闪电电荷:</h1><p id="0b53" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated">LApps是闪电供电的应用程序，利用闪电网络提供的即时支付。最近发布的应用程序包括Blockstream博客上列出的应用程序:<a class="ae lg" href="https://blockstream.com/2018/03/29/blockstreams-week-of-lapps-ends.html" rel="noopener ugc nofollow" target="_blank">https://block stream . com/2018/03/29/block streams-week-of-LApps-ends . html</a></p><p id="0627" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要运行这些LApps，闪电充电需要安装在军械库。</p><blockquote class="kz la lb"><p id="2d21" class="jc jd lc je b jf jg jh ji jj jk jl jm ld jo jp jq le js jt ju lf jw jx jy jz hn dt translated">Lightning Charge是用node.js编写的微支付处理系统，它通过其REST API公开了c-lightning的功能，可以通过<a class="ae lg" href="https://github.com/ElementsProject/lightning-charge-client-js" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>和<a class="ae lg" href="https://github.com/ElementsProject/lightning-charge-client-php" rel="noopener ugc nofollow" target="_blank"> PHP </a>库访问。来自:<a class="ae lg" href="https://blockstream.com/2018/01/16/lightning-charge.html" rel="noopener ugc nofollow" target="_blank">https://blockstream.com/2018/01/16/lightning-charge.html</a></p></blockquote><p id="3e7e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">闪电充电需要<code class="eh ko kp kq kr b">c-lightning</code>和<code class="eh ko kp kq kr b">nodejs</code>。立即安装:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="527f" class="nb lr hu kr b fv nt nu l nv nw">$ curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -</span><span id="acf1" class="nb lr hu kr b fv nx nu l nv nw">$ <!-- -->sudo apt-get install -y nodejs</span></pre><p id="f683" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于nodesource.com提供的<code class="eh ko kp kq kr b">nodejs</code>包，可能会出现权限错误。要解决此问题，请执行以下操作:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="c3a6" class="nb lr hu kr b fv nt nu l nv nw">$ mkdir ~/.npm-global<br/>$ npm config set prefix '~/.npm-global'</span></pre><p id="aa64" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将以下内容添加到<code class="eh ko kp kq kr b">~/.profile</code>:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="0fed" class="nb lr hu kr b fv nt nu l nv nw">$ export PATH=~/.npm-global/bin:$PATH</span></pre><p id="7033" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="ded2" class="nb lr hu kr b fv nt nu l nv nw">$ source ~/.profile</span></pre><p id="1008" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后简单的用<code class="eh ko kp kq kr b">npm</code>安装闪电充，运行<code class="eh ko kp kq kr b">charged</code>:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="a62d" class="nb lr hu kr b fv nt nu l nv nw">$ npm install -g lightning-charge</span><span id="4748" class="nb lr hu kr b fv nx nu l nv nw">$ charged --api-token &lt;a secret token&gt;</span></pre><p id="2968" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ko kp kq kr b">charged</code>将会运行在默认端口9112上！</p></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><h1 id="cc37" class="lq lr hu bd ls lt mt lv lw lx mu lz ma mb mv md me mf mw mh mi mj mx ml mm mn dt translated">安装nanopos LApp，将您的Lightning模块转变为微型销售点解决方案:</h1><p id="d445" class="pw-post-body-paragraph jc jd hu je b jf mo jh ji jj mp jl jm jn my jp jq jr mz jt ju jv na jx jy jz hn dt translated"><code class="eh ko kp kq kr b">nanopos</code>与<code class="eh ko kp kq kr b">npm</code>轻松安装:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="638f" class="nb lr hu kr b fv nt nu l nv nw">$ npm install -g nanopos</span></pre><p id="8be5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用待售产品编辑一个<code class="eh ko kp kq kr b">items.yaml</code>文件，用<code class="eh ko kp kq kr b">--currency</code>指定货币，然后运行<code class="eh ko kp kq kr b">nanopos</code>:</p><pre class="li lj lk ll fq np kr nq nr aw ns dt"><span id="f8fe" class="nb lr hu kr b fv nt nu l nv nw">$ nanopos -t &lt;charge API token&gt; --items-path items.yaml --currency USD</span></pre><p id="5df0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">渲染页面的标题可以用<code class="eh ko kp kq kr b">--title</code>来改变，在bootswatch.com有各种各样的主题可以用<code class="eh ko kp kq kr b">-m</code>来选择。</p><p id="601e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在<code class="eh ko kp kq kr b">c-lightning</code>、<code class="eh ko kp kq kr b">charged</code>和<code class="eh ko kp kq kr b">nanopos</code> LApp都在便携式军械库上运行！</p><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ny"><img src="../Images/1b04f5adfb97b57e4a82e08bc2f9fd31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34hCf-Lpupt31scUI7DHQg.png"/></div></div></figure></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><p id="ff72" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦完成交易，只需关闭军械库并拔掉电源插头，以便储存起来运输。当准备好再次交易时，插回电源，<code class="eh ko kp kq kr b">ssh</code>插入，并再次启动<code class="eh ko kp kq kr b">c-lightning</code>。这可以配置为使用在VPS或类似的面向公众的托管服务上运行的<code class="eh ko kp kq kr b">bitcoind</code>，以进一步提高可移植性(只需要军械库，而不需要带有<code class="eh ko kp kq kr b">bitcoind</code>的工作站/笔记本电脑/主机)。</p><p id="192b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">军械库也可以在“独立模式”下运行，这种模式不需要USB主机来连接或供电(不过它仍然通过USB供电)。这使得其他酷用例，如更便携的电池供电和支持WiFi的配置！</p><p id="cbdc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">感谢阅读！</p><p id="21ef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">-格鲁布斯</p></div></div>    
</body>
</html>