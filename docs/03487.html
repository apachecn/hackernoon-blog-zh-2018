<html>
<head>
<title>Deploy a Swarm Cluster with Alexa</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Alexa部署群集群</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploy-a-swarm-cluster-with-alexa-ae5fa8b8dffa?source=collection_archive---------7-----------------------#2018-04-21">https://medium.com/hackernoon/deploy-a-swarm-cluster-with-alexa-ae5fa8b8dffa?source=collection_archive---------7-----------------------#2018-04-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/ceeee72d06ab7408f724c13aba66436d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mds9d0Ek_LirO1e0fNFEsQ.jpeg"/></div></div></figure><p id="5ef5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">无服务器</strong>和<strong class="je hv">容器</strong>改变了我们利用公共云的方式，以及我们编写、部署和维护应用的方式。结合这两种范式的一个很好的方法是基于<strong class="je hv"> Lambda </strong>函数用<strong class="je hv"> Alexa </strong>构建一个语音助手——用<strong class="je hv"> Go </strong>编写——在<strong class="je hv"> AWS </strong>上部署<strong class="je hv"> Docker Swarm </strong>集群。</p><p id="b711" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下图显示了使用Alexa在AWS上部署生产就绪Swarm集群所需的所有组件。</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ka"><img src="../Images/917a00d5fada47bf9fcecc93c6547f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6rNni81fi9x2_cFayISRdg.png"/></div></div></figure><p id="cbb8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意:我的<a class="ae kf" href="https://github.com/mlabouardy/alexa-swarm" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上有完整的代码。</p><p id="45b1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用户将要求亚马逊Echo部署一个群集群:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kg"><img src="../Images/1781dac9683a0a01dc955de25b4c6664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sz6nR6Q6wrP_9LkzOvFZqw.png"/></div></div></figure><p id="17f2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Echo </strong>会以内置的自然语言理解和语音识别拦截用户的语音指令。将它们传送到Alexa 服务。一个定制的Alexa技能会将语音命令转换成意图:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kh"><img src="../Images/7f952592556b3b4b6afb2021589fe627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJ3nbHJQQSS9WqGyysMC9g.png"/></div></div></figure><p id="62f9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Alexa技能</strong>将触发Lambda功能以实现意图:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ki"><img src="../Images/5a51268b9397298b366a545bbfe0d940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQU7tjYXeqfCL9J6qs9cIg.png"/></div></div></figure><p id="c485" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Lambda函数将使用<strong class="je hv"> AWS EC2 API </strong>从预装了<strong class="je hv"> Docker CE </strong>的<strong class="je hv"> AMI </strong>中部署一队EC2实例(我使用<strong class="je hv"> Packer </strong>来烘焙AMI以减少实例的冷启动)。然后，将群集IP地址推送到SQS:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kg"><img src="../Images/2f4258bac64846606f63243c3835778b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dziwiAIbiEicBL5gwJaEMQ.png"/></div></div></figure><p id="0462" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，该函数将使用集群的当前状态向<strong class="je hv"> DynamoDB </strong>表中插入一个新项目:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kj"><img src="../Images/bd3d5b5ef9db5f4ef2b38b090cc73b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UeHwayoxHjZx2WsF57OItA.png"/></div></div></figure><p id="bc61" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦<strong class="je hv"> SQS </strong>收到该消息，将触发<strong class="je hv"> CloudWatch警报</strong>(它监控<em class="kk">approximaturenumberofmessages visible</em>参数)，并因此向<strong class="je hv"> SNS主题</strong>发布消息:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kl"><img src="../Images/8979c3f53d220dee088e6522ac1f7c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQ3jTEShIMKvc32u_R_1Tg.png"/></div></div></figure><p id="527e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> SNS </strong>话题触发订阅的Lambda函数:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kj"><img src="../Images/7a40007d347fd1a5e3dc52eadd670fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wFFd1zO2aFNCd-1cjDmXvg.png"/></div></div></figure><p id="8115" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Lambda </strong>函数将获取新集群的队列，并使用<strong class="je hv"> AWS系统管理器API </strong>在之前创建的EC2实例群上提供一个Swarm集群:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff km"><img src="../Images/35d71961a4ec802e81d35fd6302fa026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPrCGvK_3v8I_NBfnEUlQA.png"/></div></div></figure><p id="ce76" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了调试，该函数将把<strong class="je hv">群令牌</strong>输出到<strong class="je hv"> CloudWatch </strong>:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kn"><img src="../Images/0d72d2c189019808eb0ee3b703b31445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iBNHBAYnoVb5QMFhY7JDJQ.png"/></div></div></figure><p id="4078" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，它会将<strong class="je hv"> DynamoDB </strong>项的状态从<em class="kk">待定</em>更新为<em class="kk">完成</em>，并删除来自SQS的消息。</p><p id="0801" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在亚马逊Echo、Echo Dot或任何Alexa设备上测试你的技能，方法是说:“<em class="kk"> Alexa，打开Docker </em>”</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="38a6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在上述工作流程结束时，将创建一个<strong class="je hv">群集群</strong>:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kl"><img src="../Images/14a1deebac9a76ad13e26ad29a30a292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k3xCw-PbMHRRX9juA6_2Zg.png"/></div></div></figure><p id="9635" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此时，您可以通过发出如下所示的命令来查看您的群状态:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kq"><img src="../Images/fdcd168bb855be6962a51a6bfd00f212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BG0p7UDN2xTdp_dOU6A4g.png"/></div></div></figure><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div class="fe ff kr"><img src="../Images/2723743a47b18c4f1ec247966a1cfe62.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*qJVLhcFslfvu-rrsrihczA.png"/></div></figure><p id="4423" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">改进&amp;限制:</strong></p><ul class=""><li id="97b2" class="ks kt hu je b jf jg jj jk jn ku jr kv jv kw jz kx ky kz la dt translated"><strong class="je hv"> Lambda </strong>如果集群规模很大，执行超时。你可以使用一个<strong class="je hv">主</strong> Lambda函数来产生子Lambda。</li><li id="d6c3" class="ks kt hu je b jf lb jj lc jn ld jr le jv lf jz kx ky kz la dt translated"><strong class="je hv">cloud watch</strong>&amp;<strong class="je hv">SNS</strong>如果支持SQS作为Lambda事件源(AWS PLEAAASE！).<strong class="je hv"> DynamoDB streams </strong>或<strong class="je hv"> Kinesis streams </strong>不能用来通知Lambda，因为我想在设置Swarm集群之前为要完全创建的实例创建某种<strong class="je hv">延迟</strong>。(可能<strong class="je hv">简单工作流服务</strong>？)</li><li id="3a79" class="ks kt hu je b jf lb jj lc jn ld jr le jv lf jz kx ky kz la dt translated">在<strong class="je hv"> SQS </strong>之前注入<strong class="je hv"> SNS </strong>。SNS可以将消息添加到SQS，并触发<strong class="je hv">λ</strong>功能。我们不需要CloudWatch警报。</li><li id="c7c8" class="ks kt hu je b jf lb jj lc jn ld jr le jv lf jz kx ky kz la dt translated">你可以通过添加新的定制意图来提高技能，在集群上部署<strong class="je hv"> Docker容器</strong>或者要求Alexa在<strong class="je hv"> VPC </strong>上部署集群…</li></ul><p id="f23d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">关于这个技能的详细信息可以在我的GitHub上找到。请务必在下面留下您的评论、反馈或建议，或者直接在Twitter上与我联系<a class="ae kf" href="https://twitter.com/mlabouardy" rel="noopener ugc nofollow" target="_blank"><strong class="je hv"><em class="kk">@</em></strong><em class="kk">mlabouardy</em></a><em class="kk">。</em></p></div></div>    
</body>
</html>