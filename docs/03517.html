<html>
<head>
<title>Start to Finish: Deploying a React App on DigitalOcean</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从头到尾:在数字海洋上部署React应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/start-to-finish-deploying-a-react-app-on-digitalocean-bcfae9e6d01b?source=collection_archive---------3-----------------------#2018-04-23">https://medium.com/hackernoon/start-to-finish-deploying-a-react-app-on-digitalocean-bcfae9e6d01b?source=collection_archive---------3-----------------------#2018-04-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1664" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最近在部署一个应用程序时，我经历了许多伴随着部署的各种细微差别的挫折，其中大部分都因缺乏关于它的在线集中信息而变得更加困难。当然，这是多种部署方式的结果(这意味着本指南只是一种方式)。</p><p id="3488" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本指南旨在为使用<strong class="it hv">数字海洋</strong>创建<a class="ae jp" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank"> React </a>单页应用程序的人提供一个从头到尾的指南，包括每一个重要的细节。我们将使用<strong class="it hv"> NGINX </strong>作为反向代理(并解释<em class="jq">为什么</em>你要这样做)，使用<strong class="it hv"> PM2 </strong>作为流程经理，使用<strong class="it hv"> Serve </strong>实际处理应用程序的服务。一旦您可以通过shell访问您的服务器，这里关于设置您的<a class="ae jp" href="https://hackernoon.com/tagged/digitalocean" rel="noopener ugc nofollow" target="_blank">数字海洋</a>服务器的大多数概念都可以转移到<strong class="it hv"> AWS EC2 </strong>平台。这里的概念也可以用于其他spa、基于Express.js的服务器等。</p><p id="a551" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本指南将假设您已经拥有一个DigitalOcean帐户，并且已经将您的域名注册商的名称服务器指向DigitalOcean。有关更改域名服务器的信息，请查看数字海洋的这篇文章:<a class="ae jp" href="https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars" rel="noopener ugc nofollow" target="_blank">如何指向普通域名注册商的数字海洋域名服务器</a></p><p id="e80a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">如果你还没有账户，</strong> <a class="ae jp" href="https://m.do.co/c/2523d33dca05" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">这里有一个互利的推荐链接，让你从50美元(！)信用(够他们最便宜的服务器2个月左右的服务器时间)</strong> </a> <strong class="it hv">。</strong></p><h2 id="605c" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">步骤1:创建一个水滴</h2><p id="395c" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">Droplets是DigitalOcean聪明命名的服务器。我们要创造一个。单击屏幕顶部的绿色大创建按钮。</p><figure class="ks kt ku kv fq kw fe ff paragraph-image"><div class="fe ff kr"><img src="../Images/69cd49568ad7b6fdf82c2b8487e8b3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*qcdP4bKoFZf-mM8vmF6T7Q.png"/></div></figure><p id="4fb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">分配</strong></p><p id="272c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">DigitalOcean以“一键式应用”而闻名，它提供了你需要的一切，但为了明确地添加我们需要的东西，我们将从一个空的发行版开始。</p><p id="d97f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">至于发行版，有多种选择。Ubuntu很常见，我喜欢它，所以我们就用它吧！目前，有一个新的LTS版本即将推出——17.10——但我们将坚持使用16.04，因为这是我习惯使用的版本。</p><p id="628d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">尺寸、位置、选项</strong></p><p id="3dbf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于一个简单的React应用程序来说，您不需要太多的功能，它旨在作为您部署工作的投资组合或起点。出于我们的目的，我将选择51gb/1GB vCPU/25GB SSD/1TB传输选项。</p><p id="6e55" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于位置，选择离你最近的或者你希望你的用户在的地方。</p><p id="07a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你有一些非常棒的选择，例如专用网络(例如，一个只能与你的其他DO服务器通信的服务器)和每周备份，但我们现在不需要这些。</p><p id="f282" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> SSH按键</strong></p><p id="4bbf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个真的很重要！SSH(或安全SHell)对于以安全的方式与您的服务器直接联网至关重要。其他文章讨论了这一点，但是我们应该避免混淆。</p><p id="4b5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，检查您是否有现有的SSH密钥。如果你是一名程序员，你可能遇到过这种情况，或者至少已经有了一个。为此，打开命令提示符/终端并输入<code class="eh kz la lb lc b">ls -al ~/.ssh</code>。这个命令列出了您的主目录中的<code class="eh kz la lb lc b">.ssh </code>目录中的所有内容(您可能看不到，因为默认情况下它是隐藏的)，其中的<code class="eh kz la lb lc b">-a </code>标志显示了所有文件(意味着隐藏的文件和正常的非隐藏文件)，而<code class="eh kz la lb lc b">-l</code>显示了关于其中每个子目录的更多信息。如果你已经有了一对钥匙，它们可能会被称为<code class="eh kz la lb lc b">id_rsa</code>和<code class="eh kz la lb lc b">id_rsa.pub</code>。如果是这样，你可以跳过一段。</p><figure class="ks kt ku kv fq kw fe ff paragraph-image"><div class="fe ff ld"><img src="../Images/78282070f1ac5046881089cca3217104.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*lhL7ykmqIpJjUxhf2AXPsQ.png"/></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">You’ll get some fancy art when you make your key.</figcaption></figure><p id="9e61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您没有SSH密钥，我们需要创建一个新的。使用命令<code class="eh kz la lb lc b">ssh-keygen -t rsa</code>创建它。按照提示操作——您需要指定文件(通过将您的回答留空，将其保留为默认的<code class="eh kz la lb lc b">id_rsa</code>选项)和密码短语(如果您愿意，再次将其留空)。关于这一过程的更多细节，请查看另一篇便捷的数字海洋文章。</p><p id="9022" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在你有了SSH密钥，<code class="eh kz la lb lc b">cd ~/.ssh</code>并打开<code class="eh kz la lb lc b">id_rsa.pub</code>。这是您的公钥，意味着服务在连接时可以使用该密钥来验证您的身份。<code class="eh kz la lb lc b">id_rsa</code>是私钥——不要把这个传出去。复制整个<code class="eh kz la lb lc b">id_rsa.pub</code>文件的内容，返回到浏览器中的DigitalOcean“创建Droplet”选项卡，单击“添加您的SSH密钥”下的“新建SSH密钥”,并将其粘贴到那里。将密钥命名为与您的计算机相关的名称，以便您可以在需要时识别密钥存放的位置。</p><p id="ccae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你现在可以给你的水滴命名了！最好是按照你计划给网站起的名字来命名，因为如果你部署更多的话，可能会变得混乱。再次点击绿色的“创建”按钮！</p><h2 id="fa53" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">步骤2:设置Droplet</h2><p id="059b" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">点击“创建”一分钟后，你的水滴应该准备好了。前往数字海洋的水滴区，在那里你会找到你的水滴列表。将IP地址复制到列表中您的droplet名称旁边。因为你包括了一个SSH密钥，我们不需要你的电子邮件密码或任何东西来登录！</p><p id="e1bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">通过SSH连接</strong></p><p id="3dbd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回到您的命令提示符/终端。为了通过ssh连接到服务器，我们将使用SSH命令(duh！)，并在提供的IP地址上指定帐户的用户。因为我们是从<code class="eh kz la lb lc b">root</code>开始的，所以命令看起来像这样:<code class="eh kz la lb lc b">ssh root@[YOUR IP HERE]</code>。可能会有一个安全提示来确保您想继续(是的，您想继续)，如果您在创建SSH密钥时指定了密码，还会有一个密码，但仅此而已。就这样，你就成功了！当你的提示改变以反映你所在的用户和服务器时，你就会知道，例如<code class="eh kz la lb lc b">root@[SERVER NAME]</code>。</p><p id="82bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">更改默认用户</strong></p><p id="b46e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">设置服务器时的一个主要安全点是更改您正在连接的用户。同样地，一个人应该在他们的代码中明确地最小化不稳定的结果，一个人应该明确地授予用户特权。您登录的帐户将是您的应用程序使用的帐户，这意味着如果有任何东西受到损害，您的整个系统将因此处于危险之中。摧毁你的服务器只需要一个大范围的“rm -rf”就可以了。</p><p id="6769" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们到服务器的SSH连接中，我们现在创建一个新用户:<code class="eh kz la lb lc b">adduser [USERNAME]</code>。你会被提示输入一个密码<em class="jq">(这样做)</em>和一些其他不必要的信息。我们还想确保这个用户在必要的时候可以访问<code class="eh kz la lb lc b">sudo</code>组——这意味着<code class="eh kz la lb lc b">root</code>的权力。为此，我们将执行以下操作:<code class="eh kz la lb lc b">usermod -aG sudo [USERNAME]</code>。</p><ul class=""><li id="8d18" class="li lj hu it b iu iv iy iz jc lk jg ll jk lm jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">usermod</code>下面是用于修改用户帐户和权限的命令</li><li id="b2c5" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">-a</code>标志表示追加/添加，意思是。这只能与<code class="eh kz la lb lc b">-G</code>一起使用，它…</li><li id="25f2" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">-G</code>允许您选择要将用户添加到哪个组。</li><li id="fcea" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">sudo</code>是群体和等级的特权！(有趣的事实— <code class="eh kz la lb lc b">sudo</code>来自“超级用户do”)</li></ul><p id="477c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您做得正确，您应该能够在任何命令前添加<code class="eh kz la lb lc b">sudo</code>来以root权限运行它！我们来快速测试一下。使用<code class="eh kz la lb lc b">su [USERNAME]</code>切换到您的新用户，并尝试<code class="eh kz la lb lc b">sudo echo ‘Hello!'</code>。您不需要root权限来完成这项工作，但是它会提示您输入密码，这表明您做得很正确。如果您无法访问它，请再次尝试此过程。</p><p id="970a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">为新用户设置SSH</strong></p><p id="a358" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还希望能够SSH到这个用户，而不是必须通过<code class="eh kz la lb lc b">root</code>。让我们为此设置这个用户。以新用户身份登录，输入以下命令:</p><ul class=""><li id="1c1a" class="li lj hu it b iu iv iy iz jc lk jg ll jk lm jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">cd ~</code> —返回您的主目录。</li><li id="2da9" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">mkdir .ssh</code> —为SSH创建目录，因前缀`.'而隐藏</li><li id="bac7" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">touch .ssh/authorized_keys</code> —创建用于存储您的公钥的文件，以便用户能够识别您。</li><li id="cc0f" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">chmod 700 .ssh</code> —更改目录的权限；其他人看不到，但你仍然可以访问。</li><li id="dcc0" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">chmod 644 .ssh/authorized_keys</code> —更改文件的权限；所有人都可以读取它，但只有当前用户可以更改它。</li></ul><p id="91dd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">太多了！但是我们还有最重要的一步:添加您的公共SSH密钥。希望你仍然有你的' id_rsa.pub '文件的内容仍然复制到你的剪贴板，但如果没有，回到你的计算机并复制它。现在，我们将使用VIM编辑该文件！作为一个相对较新的程序员，VIM对我来说有些吓人，但是一旦你知道一些基本的命令，它实际上是非常方便的。让我们使用下面的命令从服务器上的主目录中编辑您的授权密钥:<code class="eh kz la lb lc b">vim .ssh/authorized_keys</code>。</p><p id="053b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">警告:我不是VIM专家，所以我可能没有有效地使用它。不要恨我！它工作了。</strong></p><p id="d73f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">目前，我们只是在查看<code class="eh kz la lb lc b">.ssh/authorized_keys</code>文件。要编辑它，我们将按下<code class="eh kz la lb lc b">i</code>。现在，粘贴你的密钥。接下来，我们可以使用<code class="eh kz la lb lc b">[CTRL]+ [</code>退出插入模式。接下来，输入<code class="eh kz la lb lc b">:wq</code>来写入(保存)您的文件并退出(对于它们自己，<code class="eh kz la lb lc b">:w</code>处理写入，<code class="eh kz la lb lc b">:q</code>处理退出)。宋承宪都设置好了！当您使用您的私钥SSH进入该用户时，该用户会认出您。</p><p id="f36f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经有了新的用户设置，我们没有理由再和<code class="eh kz la lb lc b">root</code>一起工作了！在终端中输入<code class="eh kz la lb lc b">exit</code>退出SSH提示符。<em class="jq">现在</em>，让我们用您的新用户名通过SSH登录您的服务器！和之前的类似，但是我们将使用你的新用户名<code class="eh kz la lb lc b">ssh [USERNAME]@[IP ADDRESS]</code>，而不是<code class="eh kz la lb lc b">root</code>。</p><p id="3345" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">安装环境依赖关系</strong></p><p id="7747" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要安装node来使用React应用程序。下面的代码将在编写9.10运行时获取Node的最新版本。这是最新的版本，而不是LTS发布，所以在继续之前，请确保这对你来说是可以的。<a class="ae jp" href="https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions" rel="noopener ugc nofollow" target="_blank">这篇文章更深入地讨论了通过包管理器和其他版本的安装选项。</a></p><blockquote class="lw lx ly"><p id="baea" class="ir is jq it b iu iv iw ix iy iz ja jb lz jd je jf ma jh ji jj mb jl jm jn jo hn dt translated"><code class="eh kz la lb lc b">curl -sL <a class="ae jp" href="https://deb.nodesource.com/setup_9.x" rel="noopener ugc nofollow" target="_blank">https://deb.nodesource.com/setup_9.x</a> | sudo -E bash -</code></p><p id="3236" class="ir is jq it b iu iv iw ix iy iz ja jb lz jd je jf ma jh ji jj mb jl jm jn jo hn dt translated"><code class="eh kz la lb lc b">sudo apt-get install -y nodejs</code></p><p id="5c4e" class="ir is jq it b iu iv iw ix iy iz ja jb lz jd je jf ma jh ji jj mb jl jm jn jo hn dt translated"><code class="eh kz la lb lc b">sudo apt-get install -y build-essential</code></p></blockquote><p id="5276" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将安装节点、npm和为npm提供便利的构建工具。</p><p id="3422" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在是安装你的应用程序可能需要的任何其他依赖项的好时机，但对于一个普通的React应用程序，你可能对此没有问题。</p><p id="8364" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦安装了节点和npm，我们将需要安装两个工具:</p><ul class=""><li id="439d" class="li lj hu it b iu iv iy iz jc lk jg ll jk lm jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">npm i -g pm2</code> —安装PM2，又名流程经理。如果这个名字没有提示你，它将帮助我们处理在你的服务器后台运行我们的应用程序。</li><li id="8dd0" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">npm i -g serve</code> —安装Serve，这是一个非常方便的应用程序，可以在服务器上提供单个页面。因为单页应用程序只在一个页面上，并且修改那个页面，所以这对于React是有效的。</li></ul><h2 id="bd87" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">步骤3:在服务器上设置React应用程序</h2><p id="8650" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">从现在开始，它应该是一帆风顺的，因为剩下的事情你可能已经在日常生活中遇到过了！你需要将你的React应用从Github克隆到服务器上。如果您使用了<code class="eh kz la lb lc b">create-react-app</code>来引导这个项目，那么您可以运行<code class="eh kz la lb lc b">npm run build</code>来将您的资产打包成一个对生产更有效的缩小版本。这将在项目的根目录下创建一个<code class="eh kz la lb lc b">build</code>文件夹。</p><p id="9182" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，为主要事件！运行<code class="eh kz la lb lc b">pm2 serve build</code>。在这里，PM2将使用Serve来显示您的网页。我相信Serve使用的默认端口是5000，所以您应该能够看到您的项目在<code class="eh kz la lb lc b">[YOUR PUBLIC IP ADDRESS]:5000</code>运行。如果它不起作用，检查<code class="eh kz la lb lc b">pm2 list</code>——它会让你知道你所有进程的状态，每个进程重启了多少次，等等。当你这么做的时候，熟悉一下PM2命令行参数——它在管理你的应用程序时会派上用场。</p><p id="a8f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果有效，那太好了！我们还有一点工作要做。</p><h2 id="9279" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">步骤4:用NGINX设置反向代理</h2><p id="6f12" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">在我们开始“如何做”之前，先说说“为什么”:</p><p id="d856" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除了标准防火墙之外，<em class="jq">反向代理是服务器和互联网其他部分之间的缓冲。可以这样想——有一个中介来检查每个请求，从服务器获取请求的信息，并将其发送回来，而不是与服务器周围的各种资源进行对话。在我们的例子中，我们让PM2/Serve把你的网页放在端口5000上(或者你电脑上的任何东西)。您的应用程序不会暴露该端口，而是在这个缓冲区后面受到保护，不会暴露。</em></p><p id="c489" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用PM2为网站提供服务并不是绝对必要的。另一种选择是使用NGINX来服务静态文件。但是我想这么做😁。</p><p id="0282" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们确定你已经安装了NGINX】。</p><p id="2aff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">NGINX是一种与默认Ubuntu防火墙协同工作的服务，可以通过<code class="eh kz la lb lc b">ufw</code>访问。如果你输入<code class="eh kz la lb lc b">ufw app list</code>，它应该会显示出来。应该有3个选项:</p><ul class=""><li id="b9e5" class="li lj hu it b iu iv iy iz jc lk jg ll jk lm jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">Nginx-Full</code> —启用端口22和88，分别用于HTTP和HTTPS访问。</li><li id="49b6" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">Nginx-HTTP</code> —仅为HTTP启用端口22。</li><li id="d87f" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">Nginx-HTTPS</code> —仅启用端口80 &amp; HTTPS。</li></ul><p id="179b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装SSL证书和设置HTTPS超出了这篇文章的范围，<a class="ae jp" href="https://www.digitalocean.com/community/tutorials/how-to-install-an-ssl-certificate-from-a-commercial-certificate-authority" rel="noopener ugc nofollow" target="_blank">但是可以随意查看这篇可靠的DigitalOcean文章。</a>无论如何，启用任何一个适合你的。我们假设您只是想开始工作，所以使用<code class="eh kz la lb lc b">sudo ufw allow 'Nginx HTTP’</code>来允许尽可能少的端口。</p><p id="13d5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们需要设置NGINX服务的配置。使用<code class="eh kz la lb lc b">cd /etc/nginx/sites-enabled</code>应该会把你带到一个有<code class="eh kz la lb lc b">default</code>文件的目录。<code class="eh kz la lb lc b">vim default</code>在VIM中打开这个文件。不要忘记:<code class="eh kz la lb lc b">i</code>插入，<code class="eh kz la lb lc b">[CTRL] + [</code>退出插入模式，<code class="eh kz la lb lc b">:w</code>写入/保存文件，<code class="eh kz la lb lc b">:x</code>退出。</p><p id="3fa8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你将会想要<strong class="it hv"> <em class="jq">几乎</em> </strong>复制并粘贴我在下面的块中列出的所有东西到你的<code class="eh kz la lb lc b">default</code>文件中，但是有一些东西我们需要个性化。</p><ul class=""><li id="7bcb" class="li lj hu it b iu iv iy iz jc lk jg ll jk lm jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">server_name</code> —您可以随意称呼您的整个服务器。</li><li id="954d" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated">这也可以被命名为任何东西，但是最好以你指向的应用程序命名。确保端口地址是正确的-您想要指向运行应用程序的本地端口。上游本身就像它听起来的那样——你的一个应用程序生活在你的代理服务器的“上游”，因此受到保护。</li><li id="c796" class="li lj hu it b iu lr iy ls jc lt jg lu jk lv jo ln lo lp lq dt translated"><code class="eh kz la lb lc b">proxy_pass</code> —您将在这里以上游的名义传递，因为此刻它实际上是在这里转发所有请求。</li></ul><blockquote class="lw lx ly"><p id="b97d" class="ir is jq it b iu iv iw ix iy iz ja jb lz jd je jf ma jh ji jj mb jl jm jn jo hn dt translated">上游<strong class="it hv">my _ nodejs _ upstream</strong>{<br/>服务器<strong class="it hv">127 . 0 . 0 . 1:5000</strong>；<br/>keepalive 64；<br/> }</p><p id="898e" class="ir is jq it b iu iv iw ix iy iz ja jb lz jd je jf ma jh ji jj mb jl jm jn jo hn dt translated">服务器{ <br/>监听80；<br/>服务器名<strong class="it hv">我的节点名服务器</strong>；<br/>根项目_根；<br/><br/>location/{<br/>proxy _ set _ header X-Forwarded-For $ proxy _ add _ X _ Forwarded _ For；<br/>proxy _ set _ header Host $ http _ Host；<br/>Proxy _ set _ header X-NginX-Proxy true；<br/>proxy _ http _ version 1.1；<br/> proxy_set_header升级$ http _ upgrade<br/> proxy_set_header连接“升级”；<br/>proxy _ max _ temp _ file _ size 0；<br/>proxy _ pass<a class="ae jp" href="http://my_nodejs_upstream/" rel="noopener ugc nofollow" target="_blank">http://<strong class="it hv">my _ nodejs _ upstream</strong>/</a>；<br/>proxy _ redirect off；<br/>proxy _ read _ time out 240s；<br/> } <br/> }</p></blockquote><p id="799c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦您将这个<code class="eh kz la lb lc b">/etc/nginx/sites-enabled/default</code>文件更新成这样，您就完成了！现在穿过它。</p><p id="e8ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">输入<code class="eh kz la lb lc b">sudo ufw enable</code>确认默认防火墙已启用。然后，<code class="eh kz la lb lc b">sudo service nginx start</code>让NGINX运行起来。再说一次，你的应用应该可以从你的IP地址访问，除非你不需要指定端口。指定一个端口不会给你带来任何东西。</p><p id="0946" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">祝贺你，感谢你坚持阅读本教程！您的应用程序现在再次完全可用。它应该可以通过IP地址访问，如果您正确设置了域名服务器，也可以通过您的域名访问！</p><p id="4c85" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你看到任何错误或错别字，或者只是一般想取得联系，<a class="ae jp" href="http://www.twitter.com/julesdotnyc" rel="noopener ugc nofollow" target="_blank">打我！</a></p><figure class="ks kt ku kv fq kw"><div class="bz el l di"><div class="mc md l"/></div></figure></div></div>    
</body>
</html>