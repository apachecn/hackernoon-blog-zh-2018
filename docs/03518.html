<html>
<head>
<title>Configuring GitLab CI on AWS EC2 Using Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker在AWS EC2上配置GitLab CI</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/configuring-gitlab-ci-on-aws-ec2-using-docker-7c359d513a46?source=collection_archive---------4-----------------------#2018-04-23">https://medium.com/hackernoon/configuring-gitlab-ci-on-aws-ec2-using-docker-7c359d513a46?source=collection_archive---------4-----------------------#2018-04-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="bee8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://hackernoon.com/tagged/gitlab-ci" rel="noopener ugc nofollow" target="_blank"> GitLab CI </a>学起来可能很隐晦，即使维护者说<a class="ae jp" href="https://docs.gitlab.com/ee/ci/quick_start/#examples" rel="noopener ugc nofollow" target="_blank">很容易</a>。原因是你需要经历诸如配置一个“Runner”之类的麻烦，然后创建一个你几乎不知道要放什么进去的文件。</p><p id="4ea8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇文章中，我继续从零开始在AWS EC2上安装GitLab，GitLab CI，并向您展示如何使用Docker runner和GitLab。</p><p id="f02e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">帖子:</p><ol class=""><li id="a25b" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated"><a class="ae jp" rel="noopener" href="/@josjaviasilis/tutorial-guide-installing-gitlab-gitlab-ci-on-aws-ec2-from-zero-751927e5ae5">【教程—指南】从零开始在AWS EC2上安装GitLab，GitLab CI。</a></li><li id="b94e" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">使用Docker 在AWS EC2上配置GitLab CI(本文)</li><li id="6e92" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated"><a class="ae jp" rel="noopener" href="/@josjaviasilis/configuring-gitlab-ci-yml-150a98e9765d">正在配置。gitlab-ci.yml </a></li><li id="f28b" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated"><a class="ae jp" rel="noopener" href="/@josjaviasilis/troubleshooting-gitlab-and-gitlab-ci-79d3b71ad79f">git lab和GitLab CI故障排除</a></li></ol><p id="0b42" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将逐一介绍这些步骤。<a class="ae jp" href="https://hackernoon.com/tagged/feedback" rel="noopener ugc nofollow" target="_blank">如有需要澄清的地方，欢迎反馈</a>。如果你是来找<code class="eh ke kf kg kh b">.gitlab-ci.yml</code>文件以及如何使用它的，请点击<a class="ae jp" rel="noopener" href="/@josjaviasilis/configuring-gitlab-ci-yml-150a98e9765d">这里</a>。</p></div><div class="ab cl ki kj hc kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hn ho hp hq hr"><p id="182e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从第一部分:你学习了如何在AWS EC2实例上设置git lab…但是GitLab CI呢？嗯，这也是一个漫长的过程。但是如果你已经走了这么远，拍拍你自己的后背，让我们继续！</p><p id="6e61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将假设你:</p><ul class=""><li id="4a48" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo kp jw jx jy dt translated">已经设置了GitLab。</li><li id="cbeb" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo kp jw jx jy dt translated">您已经创建或导入了一个项目(请在您为GitLab实例分配了一个弹性IP之后<strong class="it hv">执行此操作)。</strong></li></ul><h1 id="1b2a" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated"><strong class="ak"> #1-简介</strong></h1><p id="0e52" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">自从GitLab 10.3以来，事情发生了变化。GitLab引入了一个Kubernetes集群，允许您在其中运行CI。Kubernetes是一个开源的容器管理平台(您可以在其中部署Docker映像)。这个教程<strong class="it hv">不会涵盖这个</strong>。这将包括运行一个<strong class="it hv">单独的Docker实例</strong>来运行CI。我会做一个未来的教程，如何设置它与谷歌云平台。</p><p id="99c1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了让GitLab使用CI，它需要来自它所谓的<a class="ae jp" href="https://docs.gitlab.com/runner/" rel="noopener ugc nofollow" target="_blank"> GitLab runner </a>的帮助。它基本上是一个执行CI作业的scipt。是的，它们通常<strong class="it hv">驻留在与你的GitLab安装不同的服务器上</strong>(是的，另一个额外的服务器)。它们也可以安装在您当前的机器上，并在那里进行处理。还没调查过。无论如何我都不会推荐它，因为GitLab本身就是资源密集型的。</p><p id="fe75" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好消息是它们运行起来很便宜。您可以在微米、纳米甚至点实例中运行它们！如果你不熟悉后者，亚马逊有他们所谓的<a class="ae jp" href="https://aws.amazon.com/ec2/spot/" rel="noopener ugc nofollow" target="_blank">现货实例</a>。基本上，由于runner不会总是运行(它只在有人将CI配置文件推送到服务器时运行)，您不需要100%活动的服务器。你只需在有限的时间内租用它(现场实例)，你就可以开始了。</p></div><div class="ab cl ki kj hc kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hn ho hp hq hr"><h1 id="6bb1" class="kq kr hu bd ks kt lt kv kw kx lu kz la lb lv ld le lf lw lh li lj lx ll lm ln dt translated">#2-创建实例。</h1><p id="6899" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">非常欢迎您创建一个专用实例，并在不需要时关闭它。您不需要为spot实例或者GitLab runner正在使用的专用实例分配一个弹性IP。<strong class="it hv">是跑步者与GitLab </strong>交流，而不是相反。</p><p id="6c9a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们转到EC2仪表板</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ly"><img src="../Images/9006aad9f712f8c30ffe8d3cb1b3f47b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rKN0CYXF5_z77tq2Y1a4Xg.png"/></div></div><figcaption class="mk ml fg fe ff mm mn bd b be z ek">You can arrive here, by clicking “Services” on the top and then clicking “EC2”</figcaption></figure><p id="dea0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">单击显示“启动实例”的位置</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mo"><img src="../Images/47cf8c16e35744197112eb5435489e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FD81rmMV6e1no5lwsWm0Q.png"/></div></div></figure><p id="ef0d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在下一个屏幕上，选择Ubuntu Server 64位，它有一个免费层(如果您适用)。你选择的Linux版本并不重要。Ubuntu只是用起来更方便。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mp"><img src="../Images/3eebf102abf2c15cb7523d1250a5c587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3Ldtv_QQeNCAVb_jNtqlQ.png"/></div></div></figure><p id="7923" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您希望选择t2.micro，因为它可能会为您提供一个免费层。不需要很大的力量(这只是刚开始。如果你需要更多的能力和速度，那就启用更好的实例。偶尔犯一次(每天1-2次)你不会死)</p><p id="2b71" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，选择“下一步:配置实例详细信息”</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mq"><img src="../Images/f0bb7f0b94e20319d72d98e62a231175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TV381cYcKlBMmTKkrDi2Ig.png"/></div></div></figure><p id="ec6c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，您可以选择<a class="ae jp" href="https://aws.amazon.com/ec2/spot/" rel="noopener ugc nofollow" target="_blank">“请求Spot实例”</a>。我建议你做这件事，因为它能为你省钱。你可以在这里阅读更多关于EC2 Spot实例的内容。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mr"><img src="../Images/464113859ccc064afe18b0f61ce2c480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JG_rosyiy9gX2-bfnzyo0g.png"/></div></div></figure><p id="b453" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要低估下一步。尽可能多地添加空闲层提供的SSD。GitLab CI可以使用Docker(这将是我们将要使用的方法。你不必为了使用它而学习Docker)，而且它将很快填满空间(你将不得不随着时间的推移进行维护，并删除图像，稍后会详细介绍)。</p><p id="516d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">之后，点击“下一步:添加标签”</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ms"><img src="../Images/a687e8d8d8a12997428ff03562816e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXATiYj37ZqksUEIStZCAw.png"/></div></div></figure><p id="4fc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">标签不是强制性的，您可以安全地跳过这一步。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ms"><img src="../Images/414e4f113296f563b0193a5c5314aac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8DLan7PQbEmTjg69fJq0Mw.png"/></div></div></figure><p id="d537" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我总是推荐下面的步骤，因为它保护了它，并增加了一层安全来防止不必要的访问。只允许访问您的IP。请理解，每当您的IP改变并且您想要连接到机器时，您都必须执行这个过程(如果IP保持不变，那么您不需要做任何事情)。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mt"><img src="../Images/de59b9e7a8eb81ad603e260ffc4064d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nM_WBFw6vwgo7s4BdZquQQ.png"/></div></div></figure><p id="ff49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">检查一切正常，然后发射！</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mt"><img src="../Images/56bfb69e9c32cc4c8c7842d24bf5c7f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*deWihbuCbBiIsskgVkgIVw.png"/></div></div></figure><p id="683a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面的屏幕将询问您是要使用现有的还是新的。如果您想获得最高的安全性，请使用专门针对GitLab Runner的新密钥。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mt"><img src="../Images/997237823509cd8caa833f5397fd0a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZWba6bvGAk9XhQNC_SQYw.png"/></div></div></figure><h1 id="2069" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">#3安装GitLab转轮</h1><p id="6e50" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">一旦实例启动并运行，通过PuTTY连接到它。这与上一篇文章中的过程相同。将IPv4地址放入PuTTY</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mu"><img src="../Images/0ea702202c7d78597fb843cddbe79691.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EUiFhR2wMKTOeyBuRakGSw.png"/></div></div></figure><p id="7319" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">把它放进油灰里(记住。ppk文件也是！)</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff mv"><img src="../Images/fa0692a2c7742e8b73933a5b0a188e56.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*HUn-5Tg-PxhtgBy6CVGliA.png"/></div></figure><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/67e55f860efb4748141cf83e32597c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*iVQnUks2pQKf0UZcd_Hx_A.png"/></div><figcaption class="mk ml fg fe ff mm mn bd b be z ek">Click on Yes.</figcaption></figure><p id="0ace" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">登录后:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/aac199fa4eb5ff922d1586b3dc1b9d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*PZ-Mkuyj5weaz1jrnWOv_Q.png"/></div></figure><p id="a259" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在命令中运行:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="29c0" class="nc kr hu kh b fv nd ne l nf ng">sudo apt-get update</span><span id="5d3d" class="nc kr hu kh b fv nh ne l nf ng">curl -L <a class="ae jp" href="https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh" rel="noopener ugc nofollow" target="_blank">https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh</a> | sudo bash</span><span id="4f95" class="nc kr hu kh b fv nh ne l nf ng">sudo apt-get install gitlab-runner</span></pre><p id="d196" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您想更新跑步者，只需:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="9113" class="nc kr hu kh b fv nd ne l nf ng">sudo apt-get update<br/> sudo apt-get install gitlab-runner</span></pre><p id="fef6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在您必须注册跑步者:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="4d8d" class="nc kr hu kh b fv nd ne l nf ng">sudo gitlab-runner register</span></pre><p id="2e22" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将得到以下提示</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/bca518da64e575b510931106b69522df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*Am00Xt4Uynbn2jm4icDyQw.png"/></div></figure><p id="a2e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于URL，键入IPv4地址，并以斜杠结尾(末尾为斜杠)。例如:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="db2f" class="nc kr hu kh b fv nd ne l nf ng"><a class="ae jp" href="http://ec2-18-217-233-100.us-east-2.compute.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">http://ec2–28-251–133-100.us-east-2.compute.amazonaws.com/</a></span></pre><p id="c88e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，我们需要去GitLab。转到您想要设置CI的项目，并转到主repo页面。然后，在左边栏，会有一个“设置”链接。点击那里。它会在底部显示CI/CD。一旦你在那里，寻找“跑步者设置”，并点击“折叠”。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ni"><img src="../Images/b594b4b2961cf057b89b80126506c15b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O8DUG4W5O-1V9dFiUhAy3w.png"/></div></div></figure><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff nj"><img src="../Images/4e02b1b2d8bc4a3b962efdfc9f9623be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSgvo_e1uikIDyMYx17FnA.png"/></div></div></figure><p id="e4f2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后它会问你一个描述，你可以输入“Docker Runner”</p><h1 id="5d25" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated"><strong class="ak"> #3.1关于标签的快速说明。</strong></h1><p id="b28c" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">在GitLab CI(持续集成)环境中使用标签来分类和控制对运行者的访问(从GitLab中的项目)。它们在以下两者中进行了配置:。gitlab-ci.yml(稍后将详细介绍)，以及跑步者本身。为了简单起见，我们将把它留空。非常欢迎您为跑步者添加标签。</p></div><div class="ab cl ki kj hc kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hn ho hp hq hr"><p id="ebe9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当它询问您是否将跑步者锁定到当前项目[对/错]时，我将由您决定。如果您想要使用同一个实例来处理多个项目:</p><p id="e2ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">选择错误…</p><p id="b7a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">(错误)这会帮你省钱。这意味着许多项目(也称为存储库)将使用同一个运行器来处理集成管道。如果你有一个小团队，并且你在不同的时间表和一天中的少数几个时间投入，这是完美的。真实)</p><p id="3f6a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">选择真…</p><p id="d7b0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着你必须为每个项目注册一个新的跑步者。是的，您可以在同一个实例中注册多个运行者，尽管您必须记住每个运行者在运行时都会消耗CPU(没有双关语)。因此，我建议，无论何时你有一个中等规模的团队(或者你每天多次集成多个项目)，都要有单独的跑步者。对你来说，添加单独的流道，是相同的程序，比我们现在做的。</p></div><div class="ab cl ki kj hc kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hn ho hp hq hr"><p id="cbb8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了简单起见，我们将选择false，我们将防止跑步者被锁定到当前项目。</p><p id="727a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你这样做了，它会问你:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff nk"><img src="../Images/721cf02b1fe012a92fb8fb7b08fe3768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*m2U-G-52WFHyc2KRLpG9jQ.png"/></div></figure><p id="5abc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将键入<strong class="it hv"> shell </strong>。<em class="nl">不要</em>式的码头工人。原因是，如果我们指定Docker，我们将从Docker hub指定我们称为<a class="ae jp" href="https://docs.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank">的Docker映像</a>，并且我们将在稍后创建的配置文件中指定我们的映像。</p><p id="6402" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们开始吧:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/532042be1c44fc36df24ffd1d904ba9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*i2OQNqCiOSUCvCsSQwN-pw.png"/></div></figure><h1 id="c815" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">#3.2-移除未使用的滑道</h1><p id="7ec7" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">运行多次gitlab-runner register会创建多个runner，它不会为你删除它们。如果您想删除未使用的跑步者，那么您可以跑步:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="3eb9" class="nc kr hu kh b fv nd ne l nf ng">sudo gitlab-runner verify — delete</span></pre></div><div class="ab cl ki kj hc kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hn ho hp hq hr"><p id="0e78" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要验证跑步者是否在工作:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="b86c" class="nc kr hu kh b fv nd ne l nf ng">sudo gitlab-runner start<br/></span></pre><p id="bd0e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">导航到您之前所在的页面(Project Settings =&gt; CI/CD)，并验证runner是否已注册并正在运行。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff nm"><img src="../Images/cfd60031dc5c677c5b6d47eca3c15284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0nBR5yqC4aHSr6VcyjqCVQ.png"/></div></div></figure><h1 id="72ca" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">#3.3在GitLab转轮上安装Docker</h1><p id="6ba6" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">这遵循了Docker在Ubuntu服务器中的正常安装。检查<a class="ae jp" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository" rel="noopener ugc nofollow" target="_blank">此链接</a>了解正式的安装方法。我将在这里介绍这些步骤:</p><ol class=""><li id="584b" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">更新apt包索引:</li></ol><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="44b0" class="nc kr hu kh b fv nd ne l nf ng">sudo apt-get update</span></pre><p id="9e6d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.安装软件包以允许apt通过HTTPS使用存储库:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="5566" class="nc kr hu kh b fv nd ne l nf ng">sudo apt-get install \<br/>    apt-transport-https \<br/>    ca-certificates \<br/>    curl \<br/>    software-properties-common</span></pre><p id="b16c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.添加Docker官方GPG键:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="fa2d" class="nc kr hu kh b fv nd ne l nf ng">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span></pre><p id="6d47" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.设置存储库:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="b171" class="nc kr hu kh b fv nd ne l nf ng">sudo add-apt-repository \<br/>   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \<br/>   $(lsb_release -cs) \<br/>   stable"</span></pre><p id="e71e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.更新包</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="127e" class="nc kr hu kh b fv nd ne l nf ng">sudo apt-get update</span></pre><p id="f172" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">6.安装Docker cE的最新版本:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="7e50" class="nc kr hu kh b fv nd ne l nf ng">sudo apt-get install docker-ce</span></pre><p id="1893" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将带来一个是/否问题:选择是安装。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/956c90559bf0d22fb983af10b993f4e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*c1qhVhvWyDp-MZcTG4G6mQ.png"/></div></figure><p id="eb3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">7.通过运行以下命令，验证Docker安装是否正确:</p><pre class="lz ma mb mc fq my kh mz na aw nb dt"><span id="278f" class="nc kr hu kh b fv nd ne l nf ng">sudo docker run hello-world</span></pre><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/b9856ce972dc482d232e405908284626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*znl3nfKDnUcOoBciOLrCHQ.png"/></div><figcaption class="mk ml fg fe ff mm mn bd b be z ek">This is it! Finally, the runner has been configured 🎉🎉</figcaption></figure><p id="9f7e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这些，跑步者应该已经被成功配置了。</p><h1 id="c826" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">#4在GitLab中配置CI管道</h1><p id="0dbd" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">就是这一刻了，各位！最终配置CI管道的时刻到了！</p><p id="6d27" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">😱:“坚持住乔！你是在告诉我我们还没有做***吗？”</p><p id="8c4d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">🔥:“没错！我们只是在准备做菜的原料。现在我们正在准备。”</p><p id="321d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">到目前为止，我们所做的一切都是为CI的工作设置环境。所有的持续集成(CI)将通过<strong class="it hv"> <em class="nl">你</em> </strong>需要在项目中创建的一个<code class="eh ke kf kg kh b">.gitlab-ci.yml</code>文件来工作。</p><p id="898e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个文件的美妙之处在于，CI管道只耦合(依赖)于该文件，您可以做任何您想做的事情。</p><p id="667d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">文件的完整规范可在<a class="ae jp" href="https://docs.gitlab.com/ee/ci/yaml/#before_script-and-after_script" rel="noopener ugc nofollow" target="_blank">这里</a>找到:</p><div class="nn no fm fo np nq"><a href="https://docs.gitlab.com/ee/ci/yaml/#before_script-and-after_script" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab ej"><div class="ns ab nt cl cj nu"><h2 class="bd hv fv z el nv eo ep nw er et ht dt translated">使用配置您的作业。gitlab-ci.yml | GitLab</h2><div class="nx l"><h3 class="bd b fv z el nv eo ep nw er et ek translated">GitLab社区版、GitLab企业版、Omnibus GitLab和GitLab Runner的文档。</h3></div><div class="ny l"><p class="bd b gc z el nv eo ep nw er et ek translated">docs.gitlab.com</p></div></div></div></a></div><p id="45e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不幸的是，这篇文章变得太长了，我不得不把它分成一篇次要的。</p><p id="75ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们继续下面的一个:</p><p id="d094" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@josjaviasilis/configuring-gitlab-ci-yml-150a98e9765d">正在配置。gitlab-ci.yml，带AWS EC2，用于持续集成(ci)或持续部署(CD) </a></p><figure class="lz ma mb mc fq md"><div class="bz el l di"><div class="nz oa l"/></div></figure></div></div>    
</body>
</html>