<html>
<head>
<title>These 6 essential tools will release, version, and maintain your NPM modules for you</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这6个基本工具将为您发布、修改和维护您的NPM模块</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/these-6-essential-tools-will-maintain-your-npm-modules-for-you-4cbbee88e0cb?source=collection_archive---------3-----------------------#2018-04-25">https://medium.com/hackernoon/these-6-essential-tools-will-maintain-your-npm-modules-for-you-4cbbee88e0cb?source=collection_archive---------3-----------------------#2018-04-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="0b1e" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">学习如何在你自己的项目中实现它们将会节省你大量的时间！</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/e3ca56d0f90a13e62d9d0f4f3535c705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Ud1urb5Cff38fGChlhQ-A.jpeg"/></div></div></figure><blockquote class="jv"><p id="7a39" class="jw jx hu bd jy jz ka kb kc kd ke kf ek translated">管理开源项目的工作量太大了。</p></blockquote><p id="5d66" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la kf hn dt translated">这就是为什么你最喜欢的只有一两个贡献者的无名库没有合并你的拉取请求。</p><p id="b4f3" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">为了补救这种情况，可以使用一套自动化工具将您从保持依赖关系最新、确保代码质量和发布软件新版本的束缚中解放出来。</p><p id="0ada" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">不幸的是，我们不能自动化所有的维护，但我们可以处理很多。</p><p id="6a26" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">首先，你需要一个npm帐号和一个github帐号来运行这些。</p><p id="83f0" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">让我们开始吧。</p><h1 id="8e67" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">1.使用语义发布自动化您的发布和语义版本控制</h1><p id="0108" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la kf hn dt translated">这第一个工具真的解决了我看来最大的痛点。发布软件的新版本。</p><p id="a742" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">当正确使用时，<code class="eh md me mf mg b">semantic-release</code>将在必要时<em class="mh">计算新的版本号</em>，将决定何时删除版本号的情感部分排除在外。</p><p id="453f" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">它还<em class="mh">将你的包发布到npm </em>，并且<em class="mh">在GitHub </em>中标记一个新版本。这将生成一个格式良好的Releases页面，详细描述构成每个新版本的变化！</p><p id="a07e" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">首先，安装语义发布cli工具:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="6c31" class="mm lh hu mg b fv mn mo l mp mq">npm i -g semantic-release-cli</span></pre><p id="4cc1" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">然后，使用它来设置您的项目。在您正在使用的npm模块中运行以下程序:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="2216" class="mm lh hu mg b fv mn mo l mp mq">➜ semantic-release-cli setup<br/>? What is your npm registry? <a class="ae mr" href="https://registry.npmjs.org/" rel="noopener ugc nofollow" target="_blank">https://registry.npmjs.org/</a><br/>? What is your npm username? patrickleet<br/>? What is your npm password? [hidden]<br/>? What is your GitHub username? patrickleet<br/>? What is your GitHub password? [hidden]<br/>? What is your GitHub two-factor authentication code? [hidden]<br/>? What CI are you using? Travis CI<br/>? Do you want a `.travis.yml` file with semantic-release setup? Yes</span></pre><p id="9ed2" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这将建立所有必要的连接和认证与特拉维斯，Github和NPM。</p><p id="40d0" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这是新的<code class="eh md me mf mg b">package.json</code>文件。</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="953a" class="mm lh hu mg b fv mn mo l mp mq">{<br/>  "name": "open-source-setup",<br/>  "version": <strong class="mg hv">"0.0.0-development"</strong>,<br/>  "description": "",<br/>  "main": "index.js",<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",<strong class="mg hv"><br/></strong><br/>  },<br/>  "author": "",<br/>  "license": "ISC",<br/>  <strong class="mg hv">"repository": {<br/>    "type": "git",<br/>    "url": "</strong><a class="ae mr" href="https://github.com/patrickleet/open-source-setup.git" rel="noopener ugc nofollow" target="_blank"><strong class="mg hv">https://github.com/patrickleet/open-source-setup.git</strong></a><strong class="mg hv">"<br/>  }</strong><br/>}</span></pre><p id="3241" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">运行<code class="eh md me mf mg b">semantic-release-cli setup</code>向我们的<code class="eh md me mf mg b">package.json</code>文件添加了两个新脚本。以相同的名称调用devDependency的<code class="eh md me mf mg b">semantic-release</code>计算版本并准备构建的<code class="eh md me mf mg b">package.json</code>文件，用新计算的“语义版本”或“semver”替换<code class="eh md me mf mg b">0.0.0-development</code> <strong class="ki hv"> </strong>。</p><p id="1e78" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">下一个脚本<code class="eh md me mf mg b">travis-deploy-once</code>将运行实际的发布部分。但是，在Travis中，构建可以同时在多个环境中运行。我们需要<code class="eh md me mf mg b">travis-deploy-once</code>来确保实际的发布只发生一次，当所有构建都完成时，而不是为每个测试的节点版本发布。</p><p id="5bc2" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">如果缺少所需的<code class="eh md me mf mg b">repository</code>部分，则<code class="eh md me mf mg b">setup</code>命令还会将其添加到您的配置中，并安装新的所需的<code class="eh md me mf mg b">devDependencies</code>。</p><p id="ca46" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">最后，还生成了一个“travis.yml”文件，其内容如下:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="a43f" class="mm lh hu mg b fv mn mo l mp mq">language: node_js</span><span id="b589" class="mm lh hu mg b fv ms mo l mp mq">node_js:<br/>  - node<br/>  - 10<br/>  - 8</span><span id="d18c" class="mm lh hu mg b fv ms mo l mp mq">cache: npm</span><span id="3ef8" class="mm lh hu mg b fv ms mo l mp mq">install:<br/>  - npm install<br/>  - npm install -g codecov</span><span id="5bea" class="mm lh hu mg b fv ms mo l mp mq">script:<br/>  - npm run lint<br/>  - npm run test<br/>  - codecov</span><span id="7327" class="mm lh hu mg b fv ms mo l mp mq">branches:<br/>  except:<br/>    - '/^v\d+\.\d+\.\d+$/'</span><span id="ad79" class="mm lh hu mg b fv ms mo l mp mq">jobs:<br/>  include:<br/>    - stage: deploy<br/>      if: branch == master &amp;&amp; !fork<br/>      node_js: 'node' # pre-installed version<br/>      script:<br/>        - npm install -g semantic-release@^15<br/>        - semantic-release</span></pre><h1 id="38a3" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">2.使用<code class="eh md me mf mg b">commitizen</code>和cz-conventive-changelog来捕获关于每个提交的更多细节</h1><p id="ea78" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la kf hn dt translated"><code class="eh md me mf mg b">semantic-release</code>需要一点帮助来实际计算新版本，尽管它并不真正理解你的代码做什么，这是理解是否有突破性变化的一个明显的先决条件，因此仍然依赖于开发人员告诉它。</p><p id="5b02" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">其方式是通过在先前版本和当前版本之间发生的提交消息。</p><p id="7383" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">考虑下面的例子:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="0c5e" class="mm lh hu mg b fv mn mo l mp mq">git commit -m 'unhelpful' <br/># semantic-release has no idea what you did</span><span id="a9e6" class="mm lh hu mg b fv ms mo l mp mq">git commit -m "feat(Customers): Add new customer API endpoints to be more human friendly, removed delete route and replaced it with deactivate</span><span id="e40d" class="mm lh hu mg b fv ms mo l mp mq">BREAKING CHANGE: The old /delete url is no longer supported."</span><span id="957f" class="mm lh hu mg b fv ms mo l mp mq"># semantic-release knows you wrote a new feature. That's a minor version bump. Also, there is a breaking change! This calls for a major bump instead!</span></pre><p id="f2c0" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated"><strong class="ki hv">现在的问题是，你希望人们知道和/或关心你应该如何编写提交消息的规则。</strong></p><p id="c6bd" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated"><em class="mh">别担心，有一个模块可以解决这个问题！</em></p><p id="fedc" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">它被称为commitizen，当用户运行它时，它会用一个向导提示用户创建他们的提交消息。为此，它会询问一系列问题。</p><p id="14fb" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">首先，要安装:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="74b4" class="mm lh hu mg b fv mn mo l mp mq">npm i --save-dev commitizen cz-conventional-changelog</span></pre><p id="cf1f" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated"><code class="eh md me mf mg b">commitizen</code>是提供向导的工具，<code class="eh md me mf mg b">cz-conventional-changelog</code>是描述所需提交格式的插件。</p><p id="8f39" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">在<code class="eh md me mf mg b">package.json</code>做如下修改:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="719e" class="mm lh hu mg b fv mn mo l mp mq">// package.json<br/>{<br/>  //...<br/>  scripts: { <br/>    <strong class="mg hv">"commit": "git-cz", </strong><br/>    // ... <br/>  },<br/>  //... <br/>  <strong class="mg hv">"config": {<br/>    "commitizen": {<br/>      "path": "./node_modules/cz-conventional-changelog"<br/>    }<br/>  }</strong><br/>}</span></pre><p id="7609" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">现在，我们可以使用<code class="eh md me mf mg b">npm run commit</code>来代替<code class="eh md me mf mg b">git commit -m ""</code>提交</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="fb3b" class="mm lh hu mg b fv mn mo l mp mq">➜ npm run commit</span><span id="c24d" class="mm lh hu mg b fv ms mo l mp mq">&gt; open-source-setup@0.0.0-development commit /Users/patrickscott/dev/patrickleet/open-source-setup<br/>&gt; git-cz</span><span id="096e" class="mm lh hu mg b fv ms mo l mp mq">/Users/patrickscott/dev/patrickleet/open-source-setup<br/>/Users/patrickscott/dev/patrickleet/open-source-setup<br/>cz-cli@2.9.6, cz-conventional-changelog@2.1.0</span><span id="5d27" class="mm lh hu mg b fv ms mo l mp mq">Line 1 will be cropped at 100 characters. All other lines will be wrapped after 100 characters.</span><span id="5ebe" class="mm lh hu mg b fv ms mo l mp mq">? Select the type of change that you're committing: chore:    Other changes that don't modify src or test files<br/>? What is the scope of this change (e.g. component or file name)? (press enter to skip)<br/> release<br/>? Write a short, imperative tense description of the change:<br/> added commitizen and cz-conventional-changelog<br/>? Provide a longer description of the change: (press enter to skip)<br/> These dependencies allow users to commit in the desired format by using npm run commit instead of git commit -m<br/>? Are there any breaking changes? No<br/>? Does this change affect any open issues? No<br/>[master 7a98de5] chore(release): added commitizen and cz-conventional-changelog<br/> 3 files changed, 5989 insertions(+)<br/> create mode 100644 .gitignore<br/> create mode 100644 package-lock.json</span></pre><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mt"><img src="../Images/c5148c3a7f8672c93fc946c7056ee8b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boMV3gBPTaaClFiFgY6nAw.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">Our nicely formatted commit message</figcaption></figure><blockquote class="my mz na"><p id="c070" class="kg kh mh ki b kj lb iv kl km lc iy ko nb ld kr ks nc le kv kw nd lf kz la kf hn dt translated"><strong class="ki hv">专业提示:</strong>您仍然会收到不遵循这些规则的拉请求——在这种情况下，选择“挤压并合并”而不是默认的“创建合并提交”。您将能够输入一个新的提交消息来触发一个新的发布。</p></blockquote><h1 id="b324" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">3.运行生成代码覆盖率报告的自动化测试</h1><p id="0081" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la kf hn dt translated">发布任何东西都不是很好的实践。这篇文章不是关于测试的，但是，如果你没有运行自动化测试作为你的发布过程的一部分，你就做错了。</p><p id="de66" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">我真的很喜欢<code class="eh md me mf mg b">jest</code>这个。因此，我将添加jest的最小设置。</p><p id="1ff8" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">无论您使用什么，生成覆盖报告是非常重要的！Jest通过简单地使用<code class="eh md me mf mg b">--coverage</code>标志就可以做到这一点。我还发现它的功能很容易使用。</p><p id="5d1c" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">要设置jest和报告覆盖范围，请进行以下更改:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="6999" class="mm lh hu mg b fv mn mo l mp mq">npm i --save-dev jest<br/>mkdir __tests__<br/>touch jest.config</span></pre><p id="41da" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">许多人喜欢把他们的jest配置放在他们的package.json中。我认为它已经够乱的了，所以我通常使用下面的<code class="eh md me mf mg b">jest.config</code></p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="5da7" class="mm lh hu mg b fv mn mo l mp mq">{<br/>  "testEnvironment": "node",<br/>  "modulePaths": [<br/>    "src",<br/>    "/node_modules/"<br/>  ],<br/>  "coverageThreshold": {<br/>    "global": {<br/>      "branches": 100,<br/>      "functions": 100,<br/>      "lines": 100,<br/>      "statements": 100<br/>    }<br/>  },<br/>  "collectCoverageFrom" : [<br/>    "src/**/*.js"<br/>  ]<br/>}</span></pre><p id="40a3" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">在package.json中:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="5aae" class="mm lh hu mg b fv mn mo l mp mq">  "scripts": {<br/>    "commit": "git-cz",<br/>    <strong class="mg hv">"test": "jest --config jest.json --coverage",</strong><br/>    "semantic-release": "semantic-release",<br/>    "travis-deploy-once": "travis-deploy-once"<br/>  },</span></pre><p id="76cd" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">我的测试存储库有0个文件和0个测试，所以为了快速解决这个问题，我在<a class="ae mr" href="https://github.com/patrickleet/open-source-setup/commit/840376c55c111008a5b06f4e118decba7e3eae5f" rel="noopener ugc nofollow" target="_blank">这个提交</a>中创建了两个文件。鉴于这已经是一篇有点长的文章，并且超出了范围，请随意查看那里的那些文件。</p><p id="fd46" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">您还需要将<code class="eh md me mf mg b">coverage</code>添加到您的<code class="eh md me mf mg b">.gitignore</code>文件中。</p><p id="a163" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这是运行<code class="eh md me mf mg b">npm run test</code>的新输出</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ne"><img src="../Images/375798d5867a680a14925738bc4dde4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WNd_NNRNrg0ys2wiUMHgWA.png"/></div></div></figure><p id="a85e" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">一个新的文件夹<code class="eh md me mf mg b">coverage</code>也随着结果生成。通过运行<code class="eh md me mf mg b">open ./coverage/lcov-report/index.html</code>来检查一下。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nf"><img src="../Images/e99bb94d990c8eaa51aa7cd536afb564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6eXQukdWZmpbCvWARqdimw.png"/></div></div></figure><h1 id="6712" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated"><strong class="ak"> 4。用Codecov维护覆盖标准</strong></h1><p id="ea17" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la kf hn dt translated">通过jest设置，项目现在输出一个<code class="eh md me mf mg b">coverage</code>文件夹。当你的项目是开源的并在Travis上运行时，这几乎是设置<code class="eh md me mf mg b">codecov</code>的唯一要求。</p><p id="d672" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">通过设置codecov，您将在自述文件上获得一个漂亮闪亮的徽章，宣传您经过良好测试的代码，以及所有Pull请求的自动注释，详细说明变更如何影响覆盖率。</p><p id="6e7a" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">我已经在上面的. travis.yml文件中包含了所需的更改，所以如果您继续学习的话，一切都准备好了。</p><p id="7c25" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">还可以前往<a class="ae mr" href="https://codecov.io/" rel="noopener ugc nofollow" target="_blank"> CodeCov </a>并使用GitHub登录创建一个帐户，并授予适当的权限。</p><h1 id="9402" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">5.确保一致的代码格式，并通过林挺代码来避免简单的错误</h1><p id="b44f" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la kf hn dt translated">在我们确保代码质量的同时，我们还希望确保所有代码在部署之前都通过了林挺测试。</p><p id="aae4" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">你喜欢什么标准就看你自己了！有的喜欢airbnb，有的更喜欢“标准”。</p><p id="5b21" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">选择对你和你的团队有用的东西，但是请选择一些东西！</p><p id="f0c8" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">我将使用名为<code class="eh md me mf mg b">standardjs</code>的标准，尽管它的名字如此，但它并不是一个标准。但我还是很喜欢。</p><p id="ed2b" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">让我们安装<code class="eh md me mf mg b">eslint</code>并运行设置。</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="465d" class="mm lh hu mg b fv mn mo l mp mq">npm i --save-dev eslint</span></pre><p id="10e6" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">运行<code class="eh md me mf mg b">npx eslint --init</code>将启动一个向导，为您的选择安装和配置正确的依赖项。</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="95c3" class="mm lh hu mg b fv mn mo l mp mq">➜ npx eslint --init<br/>? How would you like to configure ESLint? Use a popular style guide<br/>? Which style guide do you want to follow? Standard<br/>? What format do you want your config file to be in? JSON</span></pre><p id="4edf" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">结果，生成了一个非常简单的配置，<code class="eh md me mf mg b">.eslintrc.json</code>。</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="695d" class="mm lh hu mg b fv mn mo l mp mq">{<br/>    "extends": "standard"<br/>}</span></pre><p id="3553" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">为了执行lint，我们需要向<code class="eh md me mf mg b">package.json</code>添加一些脚本</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="ffd6" class="mm lh hu mg b fv mn mo l mp mq">  "scripts": {<br/>    "commit": "git-cz",<br/>    <strong class="mg hv">"lint": "eslint src __tests__",<br/>    "lint:fix": "eslint --fix src __tests__",</strong><br/>    "test": "jest --config jest.json --coverage",<br/>    "semantic-release": "semantic-release",<br/>    "travis-deploy-once": "travis-deploy-once"<br/>  },</span></pre><p id="c49b" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这个命令很简单，它使用<code class="eh md me mf mg b">.eslintrc.json</code>中的设置接收一个文件夹列表。我喜欢用<code class="eh md me mf mg b">--fix</code>创建第二个命令，以便在本地运行时自动修复问题。</p><p id="a63e" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这里有一个区别的例子</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="ef75" class="mm lh hu mg b fv mn mo l mp mq">➜  npm run lint</span><span id="8ba0" class="mm lh hu mg b fv ms mo l mp mq">&gt; open-source-setup@0.0.0-development lint /Users/patrickscott/dev/patrickleet/open-source-setup<br/>&gt; eslint src __tests__</span><span id="4ece" class="mm lh hu mg b fv ms mo l mp mq">/Users/patrickscott/dev/patrickleet/open-source-setup/src/index.js<br/>  1:44  error  Newline required at end of file but not found  eol-last</span><span id="7c2c" class="mm lh hu mg b fv ms mo l mp mq">/Users/patrickscott/dev/patrickleet/open-source-setup/__tests__/index.js<br/>  3:1  error  'describe' is not defined                      no-undef<br/>  4:3  error  'it' is not defined                            no-undef<br/>  6:5  error  'expect' is not defined                        no-undef<br/>  8:3  error  Newline required at end of file but not found  eol-last</span><span id="7ff0" class="mm lh hu mg b fv ms mo l mp mq">✖ 5 problems (5 errors, 0 warnings)<br/>  2 errors, 0 warnings potentially fixable with the `--fix` option.</span><span id="9237" class="mm lh hu mg b fv ms mo l mp mq">➜  npm run lint:fix</span><span id="2fea" class="mm lh hu mg b fv ms mo l mp mq">&gt; open-source-setup@0.0.0-development lint:fix /Users/patrickscott/dev/patrickleet/open-source-setup<br/>&gt; eslint --fix src __tests__</span><span id="2d38" class="mm lh hu mg b fv ms mo l mp mq">/Users/patrickscott/dev/patrickleet/open-source-setup/__tests__/index.js<br/>  3:1  error  'describe' is not defined  no-undef<br/>  4:3  error  'it' is not defined        no-undef<br/>  6:5  error  'expect' is not defined    no-undef</span><span id="ef1f" class="mm lh hu mg b fv ms mo l mp mq">✖ 3 problems (3 errors, 0 warnings)</span></pre><p id="45cf" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">第一次，它只告诉我们什么是错的。当包含fix标志时，5个错误中的2个可以被自动修复。</p><p id="87f5" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">剩下的三个错误是由于jest的工作方式，即假设这些全局变量将由测试运行程序定义。</p><p id="f395" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">我们可以通过修改<code class="eh md me mf mg b">.eslintrc.json</code>告诉<code class="eh md me mf mg b">eslint</code>这些不是问题来解决这个问题。</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="38e9" class="mm lh hu mg b fv mn mo l mp mq">{<br/>    "extends": "standard",<br/>    <strong class="mg hv">"globals": {<br/>        "describe": true,<br/>        "it": true,<br/>        "expect": true<br/>    }</strong><br/>}</span></pre><p id="a886" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">现在运行<code class="eh md me mf mg b">npm run lint</code>退出，没有错误。</p><p id="0291" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">我已经在第一个<code class="eh md me mf mg b">.travis.yml</code>文件中添加了这个。</p><p id="c0bd" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">有了那个，我就在推我的代码！但是我们还没有完成。然而，下一个工具希望我们在它被设置之前就能达到这一点。</p><p id="5589" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这是构建的<a class="ae mr" href="https://travis-ci.org/patrickleet/open-source-setup/jobs/370892229" rel="noopener ugc nofollow" target="_blank">结果，并且在</a><a class="ae mr" href="https://github.com/patrickleet/open-source-setup/releases/tag/v1.0.0" rel="noopener ugc nofollow" target="_blank"> Github </a>上创建了一个发布包，并发布到<a class="ae mr" href="https://www.npmjs.com/package/open-source-setup" rel="noopener ugc nofollow" target="_blank"> NPM </a>。</p><p id="ec4f" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">我鼓励你浏览Travis的工作lob并阅读输出，看看semantic-release是如何计算它的发布的。</p></div><div class="ab cl ng nh hc ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="hn ho hp hq hr"><p id="7e7f" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">在我们继续之前，让我们花一点时间把我们的自述文件写得漂亮一点(或者干脆一点)。为了合法，我们显然需要所有的徽章。</p><p id="c763" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">首先前往Travis，通过单击页面顶部附近的徽章获取徽章。将打开一个带有不同嵌入代码的弹出窗口。你会想要markdown的自述文件。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nn"><img src="../Images/dc623d773c9a46f6b3770071f8662872.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w9XCKrf6hvCvzhlCjzwPBg.png"/></div></div></figure><p id="6ea1" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">我认为它们放在标题下面看起来很好，所以把它贴在那里或顶部吧。</p><p id="30da" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">接下来，前往Codecov。导航到您的项目，并获取显示您的存储库代码覆盖率百分比的markdown标记。</p><p id="f58b" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">可以在<strong class="ki hv">设置</strong> | <strong class="ki hv">徽章</strong>部分找到。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff no"><img src="../Images/7d2d41842bb6b3fadb9bdd073412b20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0C2gO4DmFUcaQX9pvm8bDQ.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">Also apparently they have a GitHub app now which is even better that I should install.</figcaption></figure><p id="beee" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这是我的README.md文件:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="b674" class="mm lh hu mg b fv mn mo l mp mq"># open source setup</span><span id="1335" class="mm lh hu mg b fv ms mo l mp mq">[![Build Status](https://travis-ci.org/patrickleet/open-source-setup.svg?branch=master)](https://travis-ci.org/patrickleet/open-source-setup)</span><span id="7b1f" class="mm lh hu mg b fv ms mo l mp mq">[![codecov](https://codecov.io/gh/patrickleet/open-source-setup/branch/master/graph/badge.svg)](https://codecov.io/gh/patrickleet/open-source-setup)</span><span id="6090" class="mm lh hu mg b fv ms mo l mp mq">An example repository showing how I set up my open-source npm modules.</span></pre><h1 id="98bf" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">6.使用GreenKeeper保持您的依赖关系最新</h1><p id="488d" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la kf hn dt translated">应用程序中第一个过时的是依赖项。</p><p id="39c8" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">没关系。</p><p id="3a85" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">进展、新功能和安全修补程序，每天都在世界各地推送。</p><p id="7c1e" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">问题是要跟上他们。</p><p id="a18b" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">为此，我使用了<a class="ae mr" href="https://greenkeeper.io" rel="noopener ugc nofollow" target="_blank"> GreenKeeper.io </a>。</p><p id="ba05" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">GreenKeeper将通过读取它的package.json文件来监视你告诉它的任何注册表，并且每当你的包的一个依赖关系的新版本被更新时，它将创建一个新的Pull请求，使用<code class="eh md me mf mg b">cz-conventional-changelog</code>风格的提交消息！</p><p id="18ca" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这意味着，此时您需要做的就是，如果travis CI构建的Pull请求通过，请按merge。如果你注意的话，这很棒，因为这将使用<code class="eh md me mf mg b">semantic-release</code>触发一个新的版本！</p><p id="fd58" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">设置GreenKeeper有两个步骤。</p><ol class=""><li id="7a4b" class="np nq hu ki b kj lb km lc kp nr kt ns kx nt kf nu nv nw nx dt translated">遵循https://greenkeeper.io/docs.html#installation的<a class="ae mr" href="https://greenkeeper.io/docs.html#installation" rel="noopener ugc nofollow" target="_blank">的安装说明。这将指导您安装GreenKeeper“GitHub App ”,然后授予green keeper访问您的存储库的权限。对于每个选定的存储库，将提交一个初始拉请求，您可以合并该请求以完成对该存储库启用GreenKeeper。</a></li><li id="90e7" class="np nq hu ki b kj ny km nz kp oa kt ob kx oc kf nu nv nw nx dt translated">一旦您合并了那个PR，您会发现您需要完成一个额外的设置步骤来使锁文件保持最新。</li></ol><p id="8a43" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">不过，你只需要第一次安装GitHub应用程序，因为将来你创建的库会询问你是否想要启用它。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff od"><img src="../Images/89760e7c30c192b44856dda1a5b48a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3JsmJAWrpCSkGsFS9L9m_Q.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">I already had the Greenkeeper GitHub App installed</figcaption></figure><p id="679c" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">来自GreenKeeper的初始Pull请求可能需要一段时间才能进入新的存储库。</p><p id="73a3" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">因为我以前做过这个，我知道接下来会发生什么，所以我们必须对<code class="eh md me mf mg b">.travis.yml</code>文件进行一些更新。</p><p id="9aa0" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">一旦您合并了PR，greenkeeper会让您知道需要安装和配置的依赖项，以便它能够保持<code class="eh md me mf mg b">package-lock.json</code>最新。</p><p id="3ebb" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">让我们继续做下去，也许绿色守护者公关会在同一时间到来。</p><p id="40b6" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">在travis.yml中添加以下部分:</p><pre class="jk jl jm jn fq mi mg mj mk aw ml dt"><span id="d1f7" class="mm lh hu mg b fv mn mo l mp mq"><strong class="mg hv">before_install:<br/>  - npm install -g npm@latest<br/>  - npm install -g greenkeeper-lockfile@1</strong><br/><br/><strong class="mg hv">before_script: greenkeeper-lockfile-update</strong><br/><br/><strong class="mg hv">after_script: greenkeeper-lockfile-upload</strong></span></pre><p id="8de9" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">如果出于某种原因，您的初始PR仍然没有出现，并且已经超过30分钟，这可能意味着出现了问题(根据他们的文档)，此处提供了<a class="ae mr" href="https://greenkeeper.io/faq#no-initial-pr" rel="noopener ugc nofollow" target="_blank">故障排除步骤</a>。</p><p id="55f5" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">一旦来了就合并！第一个PR将升级您的所有依赖项，为其提供最新的基线，并将GreenKeeper徽章插入自述文件。如果需要，GreenKeeper会告诉你。</p><p id="09ed" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">这是我在本教程中从事的项目的公关。<br/><a class="ae mr" href="https://github.com/patrickleet/open-source-setup/pull/1" rel="noopener ugc nofollow" target="_blank">https://github.com/patrickleet/open-source-setup/pull/1</a></p><h1 id="323b" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">结论</h1><p id="312f" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la kf hn dt translated">这是用最少的努力维护您的开源项目的一个非常坚实的基线。</p><p id="ceb9" class="pw-post-body-paragraph kg kh hu ki b kj lb iv kl km lc iy ko kp ld kr ks kt le kv kw kx lf kz la kf hn dt translated">希望你觉得有用！</p><blockquote class="jv"><p id="77b9" class="jw jx hu bd jy jz oe of og oh oi kf ek translated"><em class="oj">有兴趣听听我的DevOps之旅，没有无用的AWS认证？</em> <a class="ae mr" href="https://hackernoon.com/my-journey-to-achieving-devops-bliss-without-useless-aws-certifications-a7cbf7c539d1" rel="noopener ugc nofollow" target="_blank"> <em class="oj">现在就在HackerNoon </em> </a> <em class="oj">上看。</em></p></blockquote><p id="7910" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la kf hn dt translated">请跟我来，留下一些掌声，看看我的其他文章。</p><blockquote class="my mz na"><p id="fefc" class="kg kh mh ki b kj lb iv kl km lc iy ko nb ld kr ks nc le kv kw nd lf kz la kf hn dt translated">你知道你可以给你喜欢的每篇文章打50分吗？Medium使用这些信息为作者最有用的内容付费！相当酷！</p><p id="8a99" class="kg kh mh ki b kj lb iv kl km lc iy ko nb ld kr ks nc le kv kw nd lf kz la kf hn dt translated">您可以通过点击/轻拍，然后按住拍手按钮来完成此操作。</p></blockquote></div></div>    
</body>
</html>