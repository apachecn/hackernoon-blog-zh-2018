<html>
<head>
<title>ReactiveSwift Extension</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应Swift扩展</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/reactiveswift-extension-36f7fb1ef10a?source=collection_archive---------22-----------------------#2018-04-25">https://medium.com/hackernoon/reactiveswift-extension-36f7fb1ef10a?source=collection_archive---------22-----------------------#2018-04-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="41ef" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">增加了对带有FRP的绑定操作符(</h2></div></div><div class="ab cl jj jk hc jl" role="separator"><span class="jm bw bk jn jo jp"/><span class="jm bw bk jn jo jp"/><span class="jm bw bk jn jo"/></div><div class="hn ho hp hq hr"><p id="0b10" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">I have experimented with different app architecture pattern recently and decided to work with <a class="ae km" href="https://hackernoon.com/tagged/mvvm" rel="noopener ugc nofollow" target="_blank"> MVVM </a>的更多支持，并为此使用了<a class="ae km" href="https://hackernoon.com/tagged/reactivecocoa" rel="noopener ugc nofollow" target="_blank">ReactiveCocoa</a>/ReactiveSwift。</p><p id="f1b7" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">像往常一样，我需要一些帮助器方法，并想在reactive中添加一些缺少的方法供我使用，并决定将它们添加到扩展中。</p><p id="0511" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">本文假设您对ReactiveCocoa/ReactiveSwift有经验，如果您没有，我建议您先去了解基本概念。</p><p id="43ef" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">让我们来看看这个扩展及其提供的帮助。</p><h2 id="8358" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jz ky kz la kd lb lc ld kh le lf lg lh dt translated"><strong class="ak"> 1。自定义绑定:</strong></h2><p id="c3bb" class="pw-post-body-paragraph jq jr hu js b jt li iv jv jw lj iy jy jz lk kb kc kd ll kf kg kh lm kj kk kl hn dt translated">我们可能使用了以下被动方式来更新UIView上的一些属性。</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="346d" class="kn ko hu ls b fv lw lx l ly lz">let showView = MutableProperty(false)</span><span id="80dc" class="kn ko hu ls b fv ma lx l ly lz">self.view.reactive.isHidden &lt;~ self.viewModel.showView</span></pre><p id="a002" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">这只是在“BindingTargetProvider”和“BindingSource”之间生成绑定。这里的“showView”是一个简单的可变属性。</p><p id="dd46" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">此代码的作用是根据showView mutableProperty的更改更新视图的“isHidden”属性。</p><p id="0c0a" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">到目前为止，这只是显示了这个绑定的默认行为。</p><p id="cb3e" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">通过查看<code class="eh mb mc md ls b">Reactive</code>结构定义，我们可以看到它是一个代理，用于托管<code class="eh mb mc md ls b">Base</code>的反应性扩展，这意味着我们需要扩展它来添加更多的反应性绑定。</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="f3ab" class="kn ko hu ls b fv lw lx l ly lz">/// A proxy which hosts reactive extensions of `Base`.</span><span id="2cd3" class="kn ko hu ls b fv ma lx l ly lz">public struct Reactive&lt;Base&gt; {</span><span id="9d70" class="kn ko hu ls b fv ma lx l ly lz">/// The `Base` instance the extensions would be invoked with.</span><span id="ebdc" class="kn ko hu ls b fv ma lx l ly lz">public let base: Base</span><span id="e5d3" class="kn ko hu ls b fv ma lx l ly lz">}</span></pre><p id="e9d9" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">现在我们想要的是添加一些不可用的绑定:<br/>首先我们将添加生成绑定的方法。</p><figure class="ln lo lp lq fq mf fe ff paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="fe ff me"><img src="../Images/472b37940da7c1b3cbbd158c836ca196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-IjYnd7v7NfYuxzYjBbUsQ.png"/></div></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">Add Method in Reactive Extension to make custom bindings.</figcaption></figure><p id="42ae" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">让我们通过一个例子来看看如何根据某些可变属性在UIView上使用*loaderToggling*。</p><p id="81a0" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">当Base: UIView作为加载器切换只在UIView实例上完成时，我们将扩展Reactive。</p><p id="a7d6" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">如您所见，此函数生成绑定，该绑定将基于来自mutableProperty的showLoader属性来切换loader。</p><figure class="ln lo lp lq fq mf fe ff paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="fe ff mq"><img src="../Images/0aaec79dc99f0cbe7bcd59deef45ddbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DkBYZPPiRkRFO5BOxhfT4A.png"/></div></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">Custom binding created for UIView show loader</figcaption></figure><p id="130e" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">设置绑定后，这可以用作任何其他绑定</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="7aa2" class="kn ko hu ls b fv lw lx l ly lz">self.disposable += self.view.reactive.showLoader &lt;~ self.viewModel.buyNowAction.isExecuting</span><span id="3763" class="kn ko hu ls b fv ma lx l ly lz">self.disposable += self.view.reactive.showLoader &lt;~ self.viewModel.showLoader.producer</span></pre><p id="6c71" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">下面你可以看到另一个在自定义类<code class="eh mb mc md ls b">FloatingLabelTextField</code>上添加反应属性的例子</p><figure class="ln lo lp lq fq mf fe ff paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="fe ff mr"><img src="../Images/c25e54471e73857a3dce5e09901972a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ecF8wbJ7oWFsA_oh82Fz4A.png"/></div></div></figure><h2 id="379b" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jz ky kz la kd lb lc ld kh le lf lg lh dt translated"><strong class="ak"> 2。</strong> <code class="eh mb mc md ls b"><strong class="ak">&lt;~</strong></code> <strong class="ak">绑定中允许可选:</strong></h2><p id="b368" class="pw-post-body-paragraph jq jr hu js b jt li iv jv jw lj iy jy jz lk kb kc kd ll kf kg kh lm kj kk kl hn dt translated">我们都使用过这个操作符<code class="eh mb mc md ls b">&lt;~</code>,如上所述，这是为了绑定“BindingTargetProvider”和“BindingSource”。如果你仔细阅读这个定义，你会发现它允许<code class="eh mb mc md ls b">Source.Value </code>是可选的，但不是BindingTargetProvider值。</p><p id="7857" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">让我们看看这意味着什么。</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="b416" class="kn ko hu ls b fv lw lx l ly lz">self.containerView.reactive.isHidden &lt;~ self.viewModel.showView</span></pre><p id="5246" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">在上面的语句中，视图不能是可选的。如果您碰巧有可选的视图，您将得到以下错误:</p><figure class="ln lo lp lq fq mf fe ff paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="fe ff ms"><img src="../Images/a52abd095ad2e7df57793ea7e315c810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ebg6wSwXradEr24-ZC6ZDA.png"/></div></div></figure><p id="a7ad" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">但是你可能会问，我们倾向于把视图“强行打开”,因为它总是被超级视图保留。</p><figure class="ln lo lp lq fq mf fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/9fb6a4209f8ce6f24ab7eeb0c5fd1458.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*K-iM7RqN5K4AyjEJaJ-MBw.jpeg"/></div></figure><p id="9032" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">首先，可以在superview保留的UIView之外的其他类上使用上述操作符。</p><p id="bd43" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">在我的例子中，我正在处理一个有多个目标的项目，它有多个故事板，但是有相同的控制器类，这要求我把IBOutlet设置为可选的。</p><figure class="ln lo lp lq fq mf fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/29e0caa9ba5203a3ba07a5c530637f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*fkKpw5d5cV6XfT3osjAxOw.jpeg"/></div></figure><p id="a2c1" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">让我们为可选的目标支持添加这个操作符:</p><figure class="ln lo lp lq fq mf fe ff paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="fe ff mv"><img src="../Images/c02db007dc8a0c8e56dd7fc45258bb89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MFYZO9_PWRk-7BWQJrFqtg.png"/></div></div></figure><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="ecff" class="kn ko hu ls b fv lw lx l ly lz">self.containerView?.reactive.isHidden &lt;~? self.viewModel.showView</span></pre><p id="4b19" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">现在这将工作，我们将能够使用如上所示的可选视图。</p><blockquote class="mw mx my"><p id="335b" class="jq jr mz js b jt ju iv jv jw jx iy jy na ka kb kc nb ke kf kg nc ki kj kk kl hn dt translated">我们将很快在ReactiveSwift中提出这个问题，这样就有可能在<code class="eh mb mc md ls b">ReactiveSwift</code>的未来版本中内置这个问题，而不需要使用扩展，但在此之前..请随意将它包含在您的代码中。</p></blockquote><p id="9016" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">以上要点可在<a class="ae km" href="https://gist.github.com/Ankit-Aggarwal/ac0086e051d7513e0764eb2d63629397" rel="noopener ugc nofollow" target="_blank">这里</a>找到。为了便于携带，它都在一个文件中。<br/>想怎么用就怎么用。</p></div><div class="ab cl jj jk hc jl" role="separator"><span class="jm bw bk jn jo jp"/><span class="jm bw bk jn jo jp"/><span class="jm bw bk jn jo"/></div><div class="hn ho hp hq hr"><p id="7179" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated"><strong class="js hv">你也可以看看我的其他文章:</strong></p><ul class=""><li id="7ceb" class="nd ne hu js b jt ju jw jx jz nf kd ng kh nh kl ni nj nk nl dt translated"><strong class="js hv">swifty webtc:</strong><a class="ae km" rel="noopener" href="/@aren.ankit/swiftywebrtc-789936b0e39b">https://medium.com/@aren.ankit/swiftywebrtc-789936b0e39b</a></li><li id="a38c" class="nd ne hu js b jt nm jw nn jz no kd np kh nq kl ni nj nk nl dt translated"><strong class="js hv">ui view+Extension:</strong><a class="ae km" rel="noopener" href="/@aren.ankit/uiview-extension-c1d3bfe33ecf">https://medium . com/@ aren . ankit/ui view-Extension-C1 D3 bfe 33 ECF</a></li><li id="e223" class="nd ne hu js b jt nm jw nn jz no kd np kh nq kl ni nj nk nl dt translated"><strong class="js hv"> ReactiveSwift扩展要点:</strong><a class="ae km" rel="noopener" href="/@aren.ankit/reactive-swift-codesnippet-fcc03232de78">https://medium . com/@ aren . ankit/reactive-swift-code snippet-FCC 03232 de 78</a></li><li id="dfd5" class="nd ne hu js b jt nm jw nn jz no kd np kh nq kl ni nj nk nl dt translated"><strong class="js hv">实时更改/渲染:</strong><a class="ae km" rel="noopener" href="/@aren.ankit/changing-object-state-at-runtime-e5593f97603d">https://medium . com/@ aren . ankit/changing-object-state-at-runtime-e 5593 f 97603d</a></li><li id="9a7a" class="nd ne hu js b jt nm jw nn jz no kd np kh nq kl ni nj nk nl dt translated"><a class="ae km" rel="noopener" href="/@aren.ankit/selectively-update-object-from-an-optional-new-value-91f7ef59973d">https://medium . com/@ aren . ankit/selectively-update-object-from-an-optional-new-value-91f 7 ef 59973d</a></li></ul></div><div class="ab cl jj jk hc jl" role="separator"><span class="jm bw bk jn jo jp"/><span class="jm bw bk jn jo jp"/><span class="jm bw bk jn jo"/></div><div class="hn ho hp hq hr"><h2 id="9c0b" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jz ky kz la kd lb lc ld kh le lf lg lh dt translated">感谢您的阅读！</h2><p id="2177" class="pw-post-body-paragraph jq jr hu js b jt li iv jv jw lj iy jy jz lk kb kc kd ll kf kg kh lm kj kk kl hn dt translated">如果你有任何问题，或者有任何事情要分享，欢迎在评论区发表评论。</p><figure class="ln lo lp lq fq mf"><div class="bz el l di"><div class="nr ns l"/></div></figure></div></div>    
</body>
</html>