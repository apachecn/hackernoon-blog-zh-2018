<html>
<head>
<title>Pimp your pet cage with Raspberry PI !</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用树莓酱给你的宠物笼拉皮条！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/pimp-your-pet-cage-with-raspberry-pi-716945e3f9a4?source=collection_archive---------18-----------------------#2018-04-27">https://medium.com/hackernoon/pimp-your-pet-cage-with-raspberry-pi-716945e3f9a4?source=collection_archive---------18-----------------------#2018-04-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/81a9774c6b77efb43cddff21ed186368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WrobCzTkMdOmgKaKx-6XTA.jpeg"/></div></div></figure><p id="96b1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这篇文章是关于如何用树莓派来侦察和喂养你的宠物的系列文章的一部分，不要错过第一步！</p><ul class=""><li id="03cf" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated"><a class="ae kj" href="https://hackernoon.com/spy-your-pet-with-a-raspberry-pi-camera-server-e71bb74f79ea" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">用树莓派相机服务器窥探你的宠物</strong> </a> <strong class="je hv"> </strong>我在这里描述如何设置树莓派和相机流服务器！</li><li id="269c" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated"><a class="ae kj" rel="noopener" href="/@michelparreno/how-to-access-your-raspberry-pi-camera-from-anywhere-544ab9e5bacc"> <strong class="je hv">如何从任何地方访问您的Raspberry Pi相机</strong> </a> <strong class="je hv"> </strong>在这里，您将学习如何配置一切以进行远程控制。</li><li id="d2e5" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated"><a class="ae kj" rel="noopener" href="/@michelparreno/build-a-connected-food-dispenser-with-raspberry-pi-19f5cdcc1541"> <strong class="je hv">用树莓Pi </strong> </a>搭建一个连接的食物分配器，在这里我们设置一个伺服电机来触发食物分配器。</li></ul><p id="188e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在前面的文章中，我们已经学习了如何构建一个摄像机服务器和一个自动售货机。现在是时候给我们相连的笼子添加最后一笔了。<strong class="je hv">当然是前面的纽扣啦！一个是当我们在家时关闭摄像头，另一个是手动触发食物分配器。</strong></p><h1 id="2feb" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">要求</h1><ol class=""><li id="b3be" class="ka kb hu je b jf ln jj lo jn lp jr lq jv lr jz ls kg kh ki dt translated">第一和第三个教程应该已经完成(从互联网访问是可选的)</li><li id="bef9" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz ls kg kh ki dt translated">如果你是初学者，我强烈建议你花一两个小时，向<a class="ae kj" href="http://camjam.me/?page_id=236" rel="noopener ugc nofollow" target="_blank"> CamJam </a>学习。这会让一切变得更容易理解。</li><li id="4bfd" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz ls kg kh ki dt translated">当然，树莓派和配置好的无线加密狗</li><li id="1f52" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz ls kg kh ki dt translated">一个树莓派的面包板。这将有助于你通过树莓派电子密码系统和插件的一切。</li><li id="efe0" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz ls kg kh ki dt translated">您选择的按钮。不过要小心，对于相机我们需要一个<a class="ae kj" href="https://thepihut.com/products/adafruit-16mm-illuminated-pushbutton-red-latching-on-off-switch" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">开关</strong> </a>，对于食物分配器需要一个<a class="ae kj" href="https://thepihut.com/products/adafruit-16mm-illuminated-pushbutton-yellow-momentary" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">瞬间</strong> </a>。</li><li id="4b64" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz ls kg kh ki dt translated">至少<a class="ae kj" href="https://thepihut.com/products/adafruit-through-hole-resistors-220-ohm-5-1-4w-pack-of-25" rel="noopener ugc nofollow" target="_blank"> 3个(100或220欧姆)</a>电阻，<a class="ae kj" href="https://thepihut.com/products/adafruit-through-hole-resistors-470-ohm-5-1-4w-pack-of-25" rel="noopener ugc nofollow" target="_blank"> 3个(470欧姆)电阻</a></li><li id="dd96" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz ls kg kh ki dt translated">用于原型制作的电线<a class="ae kj" href="https://thepihut.com/products/adafruit-premium-male-male-jumper-wires-20-x-12-300mm" rel="noopener ugc nofollow" target="_blank">公/公</a>和<a class="ae kj" href="https://thepihut.com/products/adafruit-premium-female-male-extension-jumper-wires-20-x-12" rel="noopener ugc nofollow" target="_blank">公/母</a>。你也可以选择<a class="ae kj" href="https://thepihut.com/products/prototyping-wire-spool-set" rel="noopener ugc nofollow" target="_blank">的全挡</a>。</li><li id="f06d" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz ls kg kh ki dt translated">(可选)对于最终的构建而不仅仅是原型制作:一个<a class="ae kj" href="https://thepihut.com/products/adafruit-perma-proto-quarter-sized-breadboard-pcb-single" rel="noopener ugc nofollow" target="_blank"> perma-proto </a>，一个烙铁和一些锡焊料。</li></ol><h1 id="bcc1" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">预防措施</h1><ul class=""><li id="876a" class="ka kb hu je b jf ln jj lo jn lp jr lq jv lr jz kf kg kh ki dt translated">当Pi打开时，不要操纵电线，这对你来说仍然是危险的，并且也可能永远破坏Pi。</li><li id="0b4a" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated">当心短路，仔细检查你的理论插头。虽然在我身上发生过很多次，但是对你的Pi来说还是有风险的。</li><li id="1fb4" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated">不要忘记电阻。我不放电阻烧坏了几个led，但更重要的是，它也会烧坏圆周率。</li><li id="b31f" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated">与电线颜色一致，电源为红色，接地为黑色，输出为橙色，输入为绿色等。这肯定会有很大帮助。</li></ul><h1 id="43d5" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">先决知识</h1><h2 id="d964" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">电学基础</h2><p id="84f5" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mh jp jq jr mi jt ju jv mj jx jy jz hn dt translated">如果你有兴趣深入了解我将要做的事情，我建议你快速浏览一下<a class="ae kj" href="https://www.electronics-notes.com/articles/basic_concepts/" rel="noopener ugc nofollow" target="_blank">电力基础概念</a>。<strong class="je hv">免责声明:</strong>我在这个项目中学到了很多，但请随时给我反馈，我可以改进我的设置！</p><h2 id="00a7" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">树莓派</h2><ul class=""><li id="4131" class="ka kb hu je b jf ln jj lo jn lp jr lq jv lr jz kf kg kh ki dt translated">电压:所有树莓派BCM引脚都是3.3V逻辑引脚。</li><li id="74b4" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated">输出引脚上的源电流或吸电流不得超过16 mA。</li><li id="3aa0" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated">您可以同时从所有GPIO输出获得的最大强度约为50 mA</li></ul><h2 id="df1d" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">发光二极管</h2><p id="04bd" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mh jp jq jr mi jt ju jv mj jx jy jz hn dt translated">它们只有在接线正确的情况下才能工作。负极引线(阴极)是较短的引线。根据制造商的规格，我们有:</p><ul class=""><li id="6c31" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">电压:1.8–2.2V(基本红色、绿色、黄色)，2.4–2.7V(白色、蓝色)</li><li id="ac04" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated"><strong class="je hv">建议使用电流:16–18mA |</strong>最大电流:20mA</li></ul><h2 id="41c2" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">电阻</h2><p id="621a" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mh jp jq jr mi jt ju jv mj jx jy jz hn dt translated">电阻器是限制通过电路的电量的一种方式。如您所见，当我们的微型led最多可处理20mA时，Pi引脚可提供高达50mA的电流。您可以<a class="ae kj" href="http://ledcalc.com/" rel="noopener ugc nofollow" target="_blank">计算</a>所需的准确电阻(大约60欧姆)，但由于可用电阻有限，220欧姆仍是一个不错的选择。然而，你绝对可以达到100欧姆！</p><h1 id="c507" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">让我们建立相机按钮！</h1><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mk"><img src="../Images/f4b73f6351300bc92c279d3f02658db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrgJzLUICIKOh-qFjSGEbw.jpeg"/></div></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek">Couldn’t get enough wires.. bye bye consistency 😆</figcaption></figure><h2 id="e7fe" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">试验板是如何工作的？</h2><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/3f3daf5fa39eda76e1ba56a478f70abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZTBfNk2dZewMsoLfhmEnkg.jpeg"/></div></div></figure><p id="68b1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">试验板是一个非常棒的原型和测试工具！你只需要在上面连接你的元件，或者直接插上电源。</p><p id="e81a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">面包板背后的魔力很简单。在边缘，你可以看到红色和蓝色的线，所有的点都是垂直连接的<em class="mu">(我用绿色突出显示了顶部的+)</em>。当一个信号进入一个点时，它被传播到整条线上。这基本上是我们将要放置Pi <strong class="je hv"> 3V引脚</strong>的地方，它将使一切和<strong class="je hv">接地引脚</strong>闭合电路。</p><p id="7ffa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在试验板的中心，情况正好相反。所有东西都是水平连接的，并被中间的空间分成两部分。示例:您在J30中放置一个3V发电机+(以蓝色突出显示)，信号将在F G H I 30中流动，但不会在B C D E中流动，因为它位于中间空间的另一侧。</p><h2 id="667d" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">上拉电阻原理</h2><p id="a5b7" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mh jp jq jr mi jt ju jv mj jx jy jz hn dt translated">那么我们需要什么呢？首先，我们需要在电路上插上一个按钮，并能够判断它是“开”还是“关”。如果我们检测到按钮是“开”的，我们启动摄像机服务器，并点亮按钮的led。如果它是关闭的，我们关闭服务器和led。如果你在家，就不需要整天开着摄像机了，对吗？</p><p id="0d16" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Raspberry Pi GPIO引脚有两种不同的模式。</p><ul class=""><li id="6d8c" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">中的<strong class="je hv">，用于检测输入信号</strong></li><li id="4f50" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated"><strong class="je hv"> OUT </strong>，可用于通过引脚发送3.3V信号</li></ul><p id="0987" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完美！我们将使用pin on IN模式来监听我们的按钮状态，并使用pin on OUT模式来点亮我们的按钮led！</p><p id="372b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了能够监听按钮状态，我们需要构建一个所谓的“上拉电阻”。我强烈推荐做这个教程<a class="ae kj" href="https://github.com/CamJam-EduKit/EduKit1/raw/master/CamJam%20Edukit%201%20-%20RPI.GPIO/CamJam%20EduKit%201%20%20-%20Worksheet%205%20(RPI.GPIO)%20-%20Button.pdf" rel="noopener ugc nofollow" target="_blank">来自CamJam </a> (PDF下载)。让我们按照下面的方案来分析电流。</p><p id="2d86" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mu">因为我购买了led按键，所以有四个引脚。2个引脚构成开关(大)，2个引脚构成led(小)。</em> <strong class="je hv"> <em class="mu">如果不买led按键，可以去掉步骤4和4bis。</em> </strong></p><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/6866712213cfdc046e81e9062efb9eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ar_Kv7jHIyuLiJcUaGJFAg.jpeg"/></div></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek"><strong class="bd mw">Red : 3V | Black : Ground | Green : BCM 9| Orange : BCM 23</strong></figcaption></figure><p id="c407" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">1:</strong><strong class="je hv">红线</strong>将3V引脚连接到试验板垂直线。</p><p id="b05b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> 2 : </strong>功率在470欧姆电阻内部流动。</p><p id="5c1b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> 3(按钮关闭):</strong>电源通过<strong class="je hv">绿线流回树莓派。</strong>Pi能够检测到该电源，并在代码分析时返回“真”。</p><p id="c6d4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> 3Bis(按钮on) : </strong>电源流入按钮，<strong class="je hv">然后接地，</strong>导致返回<strong class="je hv">绿线</strong>的电源太少。代码测试时返回“false”。</p><blockquote class="mx my mz"><p id="81c2" class="jc jd mu je b jf jg jh ji jj jk jl jm na jo jp jq nb js jt ju nc jw jx jy jz hn dt translated">所以基本上，当按下时，它返回<strong class="je hv">为“假”，当关闭</strong>时，它返回<strong class="je hv">为“真”。我知道，我知道…一开始很容易让人误解，对吗？</strong></p></blockquote><p id="1540" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> 4(代码检测按钮打开):</strong>我们向<strong class="je hv">橙色电线发送信号。</strong>这将通过一个100或220欧姆的电阻，并点亮按钮led。</p><p id="f20a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> 4bis(代码检测按钮关闭):</strong>我们切断了来自<strong class="je hv">橙线</strong>的信号，并通过这样做关闭了按钮led。</p><p id="8293" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的算法好吗？完美！</p><h2 id="443c" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">创建相机按钮脚本</h2><p id="c68c" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mh jp jq jr mi jt ju jv mj jx jy jz hn dt translated">就像<a class="ae kj" rel="noopener" href="/@michelparreno/build-a-connected-food-dispenser-with-raspberry-pi-19f5cdcc1541"> <strong class="je hv">中用树莓Pi </strong> </a> <strong class="je hv">，</strong>搭建一个连接的食物分发器，我们准备用Python和Rpi。GPIO库来创建我们的脚本。转到您的Pi并执行以下操作:</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="beb7" class="lt kq hu ne b fv ni nj l nk nl"># If you have followed previous tutorial<br/>cd /var/www/html/pet-feeder</span><span id="2c97" class="lt kq hu ne b fv nm nj l nk nl"># Create the file with execution rights<br/>touch camera_button.py<br/>chmod +x camera_button.py</span></pre><p id="bd90" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在用您选择的编辑器编辑该文件，让我们通过导入我们令人敬畏的GPIO库开始编写脚本吧！</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="4c9d" class="lt kq hu ne b fv ni nj l nk nl">##!/usr/bin/env python<br/>import RPi.GPIO as GPIO</span><span id="9849" class="lt kq hu ne b fv nm nj l nk nl"># set the mode to BCM to match BCM number and not physical slots<br/>GPIO.setmode(GPIO.BCM)</span></pre><p id="e459" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，让我们把我们在以前的方案中使用的BCM钉放入一些变量中。</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="2c18" class="lt kq hu ne b fv ni nj l nk nl">CAMERA_BTN_LED_OUTPUT = 23<br/>CAMERA_BTN_INPUT = 9</span></pre><p id="dd57" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们需要能够不断地监听按钮状态，并在它改变时获取代码。为此，我们将使用一个无限循环。当然，为了摆脱这个循环，我们添加了一个键盘监听器，所以我们可以通过按住CTRL + C几秒钟来停止脚本。</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="c306" class="lt kq hu ne b fv ni nj l nk nl">try:    <br/>  while True:<br/>    if GPIO.input(CAMERA_BTN_INPUT) == False:<br/>      print("CAMERA Pressed - button led ON")<br/>      GPIO.output(CAMERA_BTN_LED_OUTPUT, GPIO.HIGH)<br/>      # START the camera server<br/>    else<br/>      print("CAMERA OFF - button led OFF")<br/>      GPIO.output(CAMERA_BTN_LED_OUTPUT, GPIO.HIGH)<br/>      # STOP the camera server     <br/>except KeyboardInterrupt:<br/>  print 'interrupted!'<br/>  GPIO.cleanup()</span></pre><p id="6457" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">如何启动或停止摄像机服务器？</strong></p><p id="2fd0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">还记得我们在<a class="ae kj" href="https://hackernoon.com/spy-your-pet-with-a-raspberry-pi-camera-server-e71bb74f79ea" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">用树莓摄像头服务器</strong> </a> <strong class="je hv"> </strong>刺探我们的宠物吗？我们使用Motion作为流媒体服务器。还记得启用或禁用服务器是多么简单吗？<em class="mu">须藤服务动作(开始|停止)。我们如何在脚本中使用这个命令？轻松点。让我们导入<strong class="je hv"> os </strong>库。</em></p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="9553" class="lt kq hu ne b fv ni nj l nk nl"># at the top of the script<br/>import os</span></pre><p id="8ada" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后使用该库来启动我们的命令行！</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="afea" class="lt kq hu ne b fv ni nj l nk nl">command = 'sudo service motion stop'<br/>p = os.system(command)</span></pre><h2 id="76a9" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">脚本摘要</h2><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="4ff5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">来测试一下吧！</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="28d4" class="lt kq hu ne b fv ni nj l nk nl"># in your script folder<br/>python camera_button.py</span></pre><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="np no l"/></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek">Everything should be working for you too !</figcaption></figure><h1 id="43f4" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">让我们来制作食物分发器按钮！</h1><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nq"><img src="../Images/70bf4be1945d43796e95e259340f245c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IzHWsr72931MCYO8juSQ5g.jpeg"/></div></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek"><strong class="bd mw">Feed Green wire : BCM 25 | Feed Orange wire : BCM 22</strong></figcaption></figure><p id="4396" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意，你可以在<a class="ae kj" href="http://fritzing.org/projects/raspberry-pi-connected-pet-cage" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">上找到整个方案熔块</strong> </a>。</p><p id="215b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你想听最精彩的部分吗？这里没有额外的困难！和以前一样而已。可以看到，我们在方案中增加了第二个上拉电阻。然而，也有一个黄色的led，因为我认为这是一个好主意，增加一个食品分配器的led。当你远程触发喂食时，你会看到一个小led灯亮起！</p><p id="0149" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">这里的电阻是可选的</strong>，因为我们将有两个串联的发光二极管(一个在按钮内，一个在食物分配器上)，3.3V引脚就足够了。</p><h2 id="7c09" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">创建食品分发器按钮脚本</h2><p id="1dab" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mh jp jq jr mi jt ju jv mj jx jy jz hn dt translated">首先，让我们改变脚本的名字，因为我们要处理相机和分配器。</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="997c" class="lt kq hu ne b fv ni nj l nk nl"># in your script folder<br/>mv camera_button.py buttons_action.py</span></pre><p id="6785" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，打开文件，让我们添加新的BCM数变量</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="1a96" class="lt kq hu ne b fv ni nj l nk nl">FEED_BTN_LED_OUTPUT = 22<br/>FEED_BTN_INPUT = 25</span><span id="f8e3" class="lt kq hu ne b fv nm nj l nk nl"># Set INPUT to analyse incoming signal <br/>GPIO.setup(FEED_BTN_INPUT, GPIO.IN)<br/># Set OUPUT as a conditional 3V power pin<br/>GPIO.setup(FEED_BTN_LED_OUTPUT, GPIO.OUT)</span></pre><p id="320c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在呢？看看这个！我们只需要在代码中添加一个if/else语句来处理所有事情。</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="dc6b" class="lt kq hu ne b fv ni nj l nk nl">try:    <br/>  while True:<br/>    # ... if/else camera code ...</span><span id="3f50" class="lt kq hu ne b fv nm nj l nk nl">    # our brand new feed button listener<br/>    if GPIO.input(FEED_BTN_INPUT) == False:<br/>      print("FEED Pressed - button led ON")<br/>      GPIO.output(CAMERA_BTN_LED_OUTPUT, GPIO.HIGH)<br/>      # Launch the feed script<br/>    else<br/>      print("FEED OFF - button led OFF")<br/>      GPIO.output(FEED_BTN_LED_OUTPUT, GPIO.LOW)<br/>except KeyboardInterrupt:<br/>  print 'interrupted!'<br/>  GPIO.cleanup()</span></pre><p id="a4e1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">好的，但是我们如何启动提要脚本呢？我们使用<strong class="je hv"> os </strong>库，就像以前一样！</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="829d" class="lt kq hu ne b fv ni nj l nk nl"># Please find the detail of feed.py on the previous tutorial.<br/>command = 'python /var/www/html/pet-feeder/feed.py'<br/>p = os.system(command)</span></pre><h2 id="d956" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">脚本摘要</h2><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="d7c4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在测试一下！</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="6348" class="lt kq hu ne b fv ni nj l nk nl">python buttons_action.py</span></pre><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="np no l"/></div></figure><p id="94de" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的剧本准备好了！但是我们还没有完全倒下。我们必须解决两个问题:</p><ul class=""><li id="295d" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">让我们的脚本在一个<strong class="je hv">根</strong>上下文中执行，这样“sudo”命令才能工作</li><li id="9350" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated">让我们的脚本在Raspberry Pi启动时运行，这样我们就不必每次都重新启动它。</li></ul><h2 id="7381" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">创建可引导的守护程序脚本</h2><p id="7c8b" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mh jp jq jr mi jt ju jv mj jx jy jz hn dt translated">正确的方法是使用“初始化脚本”。这些文件存储在Pi的/etc/init.d/文件夹中。为了帮助您从头开始构建，该文件夹中有一个名为“skeleton”的模板文件。让我们复制粘贴它，并创建我们自己的脚本。</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="79a1" class="lt kq hu ne b fv ni nj l nk nl"># Let's create the script<br/>cd /etc/init.d<br/>cp skeleton petfeederbuttons<br/>sudo chmod +x petfeederbuttons</span><span id="e384" class="lt kq hu ne b fv nm nj l nk nl"># Now, let's edit the file<br/>sudo vi petfeederbuttons</span></pre><p id="7e0a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，为了使本教程简短易懂，我不打算详细介绍文件中的每一行。您所需要知道的是，我们必须在INFO头中声明我们的脚本信息。然后，我们必须定义脚本位置和基本命令:<strong class="je hv">开始，停止，重启</strong>！</p><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="6957" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太好了！现在，您应该能够执行这些命令了:</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="cf50" class="lt kq hu ne b fv ni nj l nk nl">sudo service petfeederbuttons start<br/>sudo service petfeederbuttons stop</span></pre><p id="9f11" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后一步！添加自动启动脚本:</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="e296" class="lt kq hu ne b fv ni nj l nk nl"># This creates a link to raspbian list of boot commands<br/>sudo update-rc.d petfeederbuttons defaults</span></pre><p id="6b65" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">重启你的Pi并直接测试你的按钮来看看结果！</p><h2 id="8678" class="lt kq hu bd kr lu lv lw kv lx ly lz kz jn ma mb ld jr mc md lh jv me mf ll mg dt translated">守护进程监听器和feeding脚本之间的兼容性。</h2><blockquote class="mx my mz"><p id="5c0a" class="jc jd mu je b jf jg jh ji jj jk jl jm na jo jp jq nb js jt ju nc jw jx jy jz hn dt translated">食物分发器的额外led在按下按钮时工作正常，但在我运行feed.py时不工作，为什么？？？</p></blockquote><p id="6414" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的守护程序正在运行按钮监听器脚本，该脚本正在等待按下feed按钮以触发feed.py。但是，当按钮未被按下时，守护程序会不断将GPIO输出设置为低</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="f5fc" class="lt kq hu ne b fv ni nj l nk nl">else<br/>      print("FEED OFF - button led OFF")<br/>      GPIO.output(FEED_BTN_LED_OUTPUT, GPIO.LOW)</span></pre><p id="8e34" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">也就是说关掉电源。那么，当我们手动或通过浏览器运行feed.py时会发生什么呢？我们额外的led将不会被点亮，因为守护进程👺会在几分之一秒内重新关闭它。这里有两种可能的解决方案:</p><ol class=""><li id="c1c2" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz ls kg kh ki dt translated">拿另一个BCM引脚来只控制led，并在feed.py中使用该引脚(而不是在buttons.py上)。这意味着只为feed.py启用led。</li><li id="fb29" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz ls kg kh ki dt translated">当feed.py被触发时，强制守护进程停止</li></ol><p id="7c29" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择您喜欢的解决方案！对我来说，我选择了第二条路(如果你想听我的意见，这是一条艰难的路)。这是解决方案，在您的feed.py脚本中。</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="74cd" class="lt kq hu ne b fv ni nj l nk nl">import subprocess</span><span id="4139" class="lt kq hu ne b fv nm nj l nk nl"># add this just before manipulating GPIO's</span><span id="c559" class="lt kq hu ne b fv nm nj l nk nl">subprocess.Popen(['sudo /etc/init.d/petfeederbuttons stop'], shell=True, stdout=FNULL, stderr=subprocess.STDOUT)</span><span id="4c4a" class="lt kq hu ne b fv nm nj l nk nl"># add this before cleaning up</span><span id="ac4e" class="lt kq hu ne b fv nm nj l nk nl">subprocess.Popen(['sudo /etc/init.d/petfeederbuttons start'], shell=True, stdout=FNULL, stderr=subprocess.STDOUT)</span></pre><p id="3fa3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是，我们的Apache服务器是在linux用户“www-data”下运行的。我们守护进程上的命令sudo需要root权限。那现在怎么办？</p><pre class="ml mm mn mo fq nd ne nf ng aw nh dt"><span id="20ae" class="lt kq hu ne b fv ni nj l nk nl"># let's give the rights to Apache to run start/stop commands on our daemon<br/>sudo visudo</span><span id="acf8" class="lt kq hu ne b fv nm nj l nk nl"># Add this line under the root line<br/>www-data ALL=(root) NOPASSWD: /etc/init.d/mochibuttons</span></pre><p id="875a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">瞧啊。现在你有了你的原型！！你只需要把它从试验板上拆下来，用perma-proto把它变成现实！</p><div class="ml mm mn mo fq ab cb"><figure class="nr iv ns nt nu nv nw paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/1fd48af8316bb806b03f406f3de4561c.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*NtEiHuEDMPJz6aKnwaaktA.jpeg"/></div></figure><figure class="nr iv nx nt nu nv nw paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/b1bf9425dc6af33c71e8a49e12197d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*OyNRBdHUhxAcz9RMigZFSw.jpeg"/></div></figure><figure class="nr iv ny nt nu nv nw paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/16027756fe99019055282e20413cfa7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*v4AvT-7Fby6stlQY1FzgUA.jpeg"/></div></figure></div><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="np no l"/></div></figure><h1 id="f374" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">后续步骤</h1><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div class="fe ff nz"><img src="../Images/b24062d5f4005630fbc777ff2ae06cc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*EyO2M4zK6Y-BlT-21UgLqw.jpeg"/></div></figure><p id="5a7e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在下一步是什么？只看你的想象力了！我个人决定创建一个react-native应用程序，并使用第二个教程<a class="ae kj" rel="noopener" href="/@michelparreno/how-to-access-your-raspberry-pi-camera-from-anywhere-544ab9e5bacc">中的URL从我的智能手机上远程控制相机和自动售货机！看一看！</a></p><p id="9667" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你想让我做最后一个关于我的react-native应用的教程，请在评论中告诉我！</p><p id="ef9c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">感谢大家阅读这个系列文章！</strong></p></div></div>    
</body>
</html>