<html>
<head>
<title>How I set up room-cleaning automation with Google Home, Home-Assistant and Xiaomi vacuum cleaner</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何用谷歌Home、家庭助手和小米吸尘器设置房间清洁自动化</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-set-up-room-cleaning-automation-with-google-home-home-assistant-and-xiaomi-vacuum-cleaner-9149e0267e6d?source=collection_archive---------0-----------------------#2018-04-28">https://medium.com/hackernoon/how-i-set-up-room-cleaning-automation-with-google-home-home-assistant-and-xiaomi-vacuum-cleaner-9149e0267e6d?source=collection_archive---------0-----------------------#2018-04-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/4140871143db7994843cbe461b2a1485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KqIavMt4icEtfaCTJEgFBw.jpeg"/></div></div></figure><p id="db62" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我使用运行在树莓Pi中的<a class="ae ka" href="https://www.home-assistant.io" rel="noopener ugc nofollow" target="_blank">家庭助手</a>作为主要中枢来自动化我所有的智能家居设备。它被设置为连接到我的<a class="ae ka" href="https://www.home-assistant.io/components/vacuum.xiaomi_miio/" rel="noopener ugc nofollow" target="_blank">小米Mi Roborock吸尘器</a>，具有启动、暂停和停靠吸尘器的基本接口。<a class="ae ka" href="https://itunes.apple.com/us/app/mi-home-xiaomi-smarthome/id957323480?mt=8" rel="noopener ugc nofollow" target="_blank">米家的应用</a>更先进，能够在扫描和清理房间时绘制我家的平面图。</p><p id="bac3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">真空吸尘器自动清洁整个房子的效果非常好。但如果我只想清洁家中的某个特定房间，我必须使用Mi Home应用程序在房屋平面图中的房间周围绘制一个矩形(区域)，以开始区域清洁。应用程序不会保存这个，所以每次我想打扫不同的房间时，我都必须重复相同的步骤。</p><p id="f368" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果我能实现自动化，那不是很好吗？这篇文章让我意识到实现这一点并不难。</p><blockquote class="kb"><p id="6f1c" class="kc kd hu bd ke kf kg kh ki kj kk jz ek translated">嘿谷歌，打扫卧室</p></blockquote><p id="0def" class="pw-post-body-paragraph jc jd hu je b jf kl jh ji jj km jl jm jn kn jp jq jr ko jt ju jv kp jx jy jz hn dt translated">目标是能够向Google Home发出命令，告诉吸尘器只清洁家中的一小块区域。下面是我一步一步做的事情:</p><ul class=""><li id="3e70" class="kq kr hu je b jf jg jj jk jn ks jr kt jv ku jz kv kw kx ky dt translated">找出房间一角的坐标，计算出坐标的比例</li><li id="33b4" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">绘制出家中每个房间的坐标</li><li id="e3d8" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">创建一个<a class="ae ka" href="https://ifttt.com/discover" rel="noopener ugc nofollow" target="_blank"> IFTTT </a>配方，用<a class="ae ka" href="https://ifttt.com/google_assistant" rel="noopener ugc nofollow" target="_blank"> Google Assistant作为触发器</a>，用<a class="ae ka" href="https://ifttt.com/maker_webhooks" rel="noopener ugc nofollow" target="_blank"> webhook作为动作</a>来调用我的家庭协助服务器。</li></ul><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff le"><img src="../Images/36987e2e5564e23588df59db3c571b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dk26fqiDfsp1OnXb8Bub8Q@2x.jpeg"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Testing app_goto_target command in service dev tool in Home-Assistant</figcaption></figure><p id="3df0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">家庭助理服务开发工具可以用来调用服务的任何设备连接到它。有一个名为<a class="ae ka" href="https://github.com/marcelrv/XiaomiRobotVacuumProtocol/blob/master/app_goto_target.md" rel="noopener ugc nofollow" target="_blank"> app_goto_target </a>的命令可以用来将吸尘器发送到任意坐标。</p><p id="4682" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">真空吸尘器的对接点总是具有坐标[25500，25500]。这是我书房的某个地方。通过反复试验，我算出了书房一角的坐标。它可以是房子里的任何一点。这将为以后绘制带比例尺的地图提供参考。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff le"><img src="../Images/4de61e41e8cddcefac6a8e391eb0fd9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2N1StButRmuOb1qkhM-_Yg@2x.jpeg"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Screenshot of the Mi Home app that is used to control the Xiaomi vacuum cleaner</figcaption></figure><p id="c534" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Mi Home应用程序规划了我的整个家居计划。我截取了一张截图，在Sketch中打开，覆盖网格，画出x轴和y轴。这为房子里的所有坐标提供了一个粗略的估计。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ln"><img src="../Images/b16fe7e55e3d324234ab01a6067c9942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wumLQx18xrgWJDg81wWVNQ@2x.jpeg"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Screenshot of my home plan created by the Mi Home app, with grids and coordinates overlaid in Sketch app. The green dot with coordinate [25500,25500] is the vacuum cleaner docking station.</figcaption></figure><p id="33d7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">真空吸尘器支持名为<a class="ae ka" href="https://github.com/marcelrv/XiaomiRobotVacuumProtocol/blob/master/app_zoned_clean.md" rel="noopener ugc nofollow" target="_blank"> app_zoned_clean </a>的区域清洁命令。它接受一个5位数的数组，每个数字描述一个名为zone的矩形—前两位是zone左下角的坐标，后两位是zone右上角的坐标，最后一位是清洁zone的次数。</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="lo lp l"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Service data for cleaning my bedroom. The 5-digit-number is formed by the coordinates of the bottom left corner [29500, 21000], top right corner [33200, 25000], and number of times to clean the area [1]</figcaption></figure><p id="63b0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">随着所有房间坐标的绘制，我在Home-Assistant中测试了它们，并在必要时做了一些小的调整。该区域可以比房间稍大，但不应与另一个房间重叠。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff le"><img src="../Images/d008f45ea9484e0854d349eaa5c2ded7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kpTr5BfItDqQzTZFQh4fkA@2x.jpeg"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Testing app_zoned_clean command in service dev tool in Home-Assistant</figcaption></figure><p id="b49f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">随着我家所有房间的地图绘制出来，下一步是创建IFTTT食谱，以允许Google Home与Home-Assistant通信，将这些命令发送到我的真空吸尘器。每个食谱都是通过选择Google Assistant作为IFTTT触发器，webhook作为action来创建的。</p><div class="lf lg lh li fq ab cb"><figure class="lq iv lr ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/7982c0056b7432dfc30991e6583ea283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*c-WJwH3x-G8LQt2vIgFwOw@2x.jpeg"/></div></figure><figure class="lq iv lw ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/a4ea9b2382cd79477a394462f5bc823b.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*GUb7FKPzlOC5YUSelNUEbw@2x.jpeg"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek lx di ly lz">Google Assistant as IFTTT Trigger, and Webhook as Action to call API in Home-Assistant</figcaption></figure></div><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ma"><img src="../Images/3ca67b9c247e2350cbde38f3eadff770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4D5cm-3JfPLWXnEdL_VzeA.jpeg"/></div></div></figure><p id="934b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">也可以创建一个配方，让真空吸尘器清洁该区域几次，因为第5位数字设置了清洁该区域的次数。</p><blockquote class="kb"><p id="4bea" class="kc kd hu bd ke kf kg kh ki kj kk jz ek translated">嘿谷歌，清理厨房三次</p></blockquote><div class="mb mc md me mf ab cb"><figure class="lq iv mg ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/f4567222a597846ca6fb3153b73bbb0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*8it2FOQ649xtnWe0n5VPNw@2x.jpeg"/></div></figure><figure class="lq iv mh ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/f1a4c9a7cf2fc05763387a5526f10a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*jcanyU4qf-LIjEzHK4r8QQ@2x.jpeg"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek mi di mj lz">Google Assistant as IFTTT Trigger, with option to say a phrase with a number</figcaption></figure></div><p id="a58c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mk">参数</em>字段接受一个区域的<em class="mk">阵列，因此可以创建一个自动清洁定制形状的区域。例如，当吸尘器在我的客厅拖地时，我想排除地毯所在的区域。</em></p><blockquote class="kb"><p id="8c33" class="kc kd hu bd ke kf kg kh ki kj kk jz ek translated">嘿谷歌，拖我的客厅</p></blockquote><figure class="mb mc md me mf iv"><div class="bz el l di"><div class="lo lp l"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Service data for app_zoned_clean with 4 zones to exclude the area in the middle.</figcaption></figure><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ml"><img src="../Images/0e32b5102b02f687c9be1ab43c12b25c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vlWLBdhji4XpEeILwRh_Xg.jpeg"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Screenshot of the Mi Home app showing the 4 zones in my living room, excluding the area where the rug is</figcaption></figure><p id="1e50" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就是这样。现在我可以让Google Home打扫家里的任何房间。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/c86bfca3ee565ad5d05b05961a7a5392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*suWNrFwVH8owZMlx2qC__w.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">IFTTT recipes to clean rooms with Google Home and Xiaomi vacuum cleaner</figcaption></figure><p id="3f64" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">相关帖子:</strong></p><p id="b7d7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" rel="noopener" href="/@honcheng/how-i-got-my-vacuum-cleaner-to-talk-back-to-me-via-telegram-d4b471b7598c">我如何让我的吸尘器通过电报与我对话。</a></p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="mn lp l"/></div></figure></div></div>    
</body>
</html>