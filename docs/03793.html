<html>
<head>
<title>How to authenticate for Pusher through Laravel Passport (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何通过Laravel护照认证推销商(第一部分)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-authenticate-for-pusher-through-laravel-passport-part-1-7269edda0276?source=collection_archive---------17-----------------------#2018-05-02">https://medium.com/hackernoon/how-to-authenticate-for-pusher-through-laravel-passport-part-1-7269edda0276?source=collection_archive---------17-----------------------#2018-05-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/56340696b23f1d65d4fc3ca0b2eee6ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7lu82O8S-0OtyMta."/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Photo by <a class="ae ih" href="https://unsplash.com/@cristina_gottardi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Cristina Gottardi</a> on <a class="ae ih" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="0b3a" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">假设您有一个Laravel应用程序、一个iOS应用程序和一些在这些应用程序之间推送的数据。iOS应用程序需要尽快(实时)显示来自Laravel应用程序的数据。这就是Pusher派上用场的地方。在这2篇文章系列的第一部分中，我们将设置Laravel来处理带有Laravel Passport的认证请求，并且我们将配置Pusher来发送事件。</p><p id="2760" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我创建了下图来说明这个过程:</p><figure class="kg kh ki kj fq hw fe ff paragraph-image"><div class="fe ff kf"><img src="../Images/d7c9f341f27f5bcfe4d8b6459cd20995.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*xoImElIpAQZh7AakzIHRLQ.png"/></div></figure><ol class=""><li id="d1fc" class="kk kl ik jj b jk jl jo jp js km jw kn ka ko ke kp kq kr ks dt translated">iOS应用程序尝试对私有通道进行鉴定。这是通过从Laravel应用程序请求访问来完成的。</li><li id="cd59" class="kk kl ik jj b jk kt jo ku js kv jw kw ka kx ke kp kq kr ks dt translated">如果认证成功，套接字令牌被发送回iOS。</li><li id="c701" class="kk kl ik jj b jk kt jo ku js kv jw kw ka kx ke kp kq kr ks dt translated">使用套接字令牌，iOS可以订阅Pusher中的私有通道。</li><li id="f3bd" class="kk kl ik jj b jk kt jo ku js kv jw kw ka kx ke kp kq kr ks dt translated">如果Laravel通过私有通道发送事件，iOS能够接收到它😃</li></ol><p id="dc05" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这看起来相当简单，但是认证过程比预期的要难一些。由于我找不到任何关于如何通过实现oauth的Laravel Passport进行身份验证的好教程，所以我想写一个简单的教程。</p><h2 id="895e" class="ky kz ik bd la lb lc ld le lf lg lh li js lj lk ll jw lm ln lo ka lp lq lr ls dt translated">设置推动器</h2><p id="99ff" class="pw-post-body-paragraph jh ji ik jj b jk lt jm jn jo lu jq jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">要使用Pusher作为广播服务，您可以在这里创建一个免费账户<a class="ae ih" href="https://dashboard.pusher.com/accounts/sign_up" rel="noopener ugc nofollow" target="_blank">。在pusher中创建一个名为laravel-pusher的应用程序，例如，当应用程序成功创建时，您将使用各种代码来实现Pusher。搜寻着<em class="ly">。env </em>实现。让它开着，因为我们以后会用到它。</a></p><h2 id="2bb6" class="ky kz ik bd la lb lc ld le lf lg lh li js lj lk ll jw lm ln lo ka lp lq lr ls dt translated">设置Laravel</h2><p id="447a" class="pw-post-body-paragraph jh ji ik jj b jk lt jm jn jo lu jq jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">使用以下命令设置一个新的Laravel项目:</p><pre class="kg kh ki kj fq lz ma mb mc aw md dt"><span id="c8d3" class="ky kz ik ma b fv me mf l mg mh">$ composer create-project laravel/laravel laravel-pusher</span></pre><p id="88d2" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将创建一个带有新的laravel项目的目录laravel-pusher。接下来，我们将安装Laravel Passport和Pusher依赖项:</p><pre class="kg kh ki kj fq lz ma mb mc aw md dt"><span id="e3e6" class="ky kz ik ma b fv me mf l mg mh">$ composer require laravel/passport pusher/pusher-php-server</span></pre><p id="38b6" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了简洁起见，我不会解释Laravel Passport的整个安装过程，但是这里的<a class="ae ih" href="https://laravel.com/docs/5.6/passport#installation" rel="noopener ugc nofollow" target="_blank">是文档提供的安装指南。</a></p><p id="e19a" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果我们敞开心扉。我们将看到各种环境变量。我们正在寻找的产品如下:</p><pre class="kg kh ki kj fq lz ma mb mc aw md dt"><span id="7664" class="ky kz ik ma b fv me mf l mg mh">PUSHER_APP_ID=<br/>PUSHER_APP_KEY=<br/>PUSHER_APP_SECRET=<br/>PUSHER_APP_CLUSTER=mt1</span></pre><p id="33b4" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们回到Pusher网站，你应该还在你的浏览器中，将代码从Pusher复制粘贴到你的。环境文件。Pusher_APP_CLUSTER变量不是由PUSHER提供的，而是填充您在创建PUSHER应用程序时选择的集群。</p><p id="824e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">另一个重要步骤是将<code class="eh mi mj mk ma b">BROADCAST_DRIVER</code>设置为<code class="eh mi mj mk ma b">pusher</code>。</p><p id="deaa" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因为iOS将请求访问订阅Pusher，所以我们需要创建一个HTTP路由来处理身份验证请求。我们将在routes/api.php中创建路由。</p><figure class="kg kh ki kj fq hw"><div class="bz el l di"><div class="ml mm l"/></div></figure><blockquote class="mn mo mp"><p id="179f" class="jh ji ly jj b jk jl jm jn jo jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd ke hn dt translated">因为路由放在routes/api.php文件中，所以它会自动以/api作为前缀。完整路径将是/api/broadcast/auth。</p></blockquote><p id="75a5" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">此路由指向一个尚不存在的控制器。创建控制器:</p><pre class="kg kh ki kj fq lz ma mb mc aw md dt"><span id="f654" class="ky kz ik ma b fv me mf l mg mh">php artisan make:controller Api\\BroadcastAuthController</span></pre><p id="c187" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将在app\Http\Controllers和控制器本身中创建一个名为Api的文件夹。以下方法将鉴定来自iOS应用程序的请求:</p><figure class="kg kh ki kj fq hw"><div class="bz el l di"><div class="ml mm l"/></div></figure><p id="e66b" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这个方法中，我们将使用传入通道名和套接字id直接调用推送器库。<code class="eh mi mj mk ma b">socket_auth</code>方法将创建一个套接字令牌，我们可以在将来来自iOS应用程序的请求中使用它。</p><h2 id="f144" class="ky kz ik bd la lb lc ld le lf lg lh li js lj lk ll jw lm ln lo ka lp lq lr ls dt translated">前端</h2><p id="8f5b" class="pw-post-body-paragraph jh ji ik jj b jk lt jm jn jo lu jq jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">我们将创建一个简单的文本输入来发送消息给Pusher。</p><figure class="kg kh ki kj fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mt"><img src="../Images/20a15386dff9a56275abc44d26e765f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oNxVONiR_blcN9HzBVL7Sw.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Enter a message to submit</figcaption></figure><p id="616e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">继续创建一个漂亮的主题网页或将我的表单HTML复制到你的<code class="eh mi mj mk ma b">welcome.blade.php</code></p><figure class="kg kh ki kj fq hw"><div class="bz el l di"><div class="ml mm l"/></div></figure><p id="1fdf" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，我们将在web.php中创建我们在上面的HTML中引用的路由:</p><figure class="kg kh ki kj fq hw"><div class="bz el l di"><div class="ml mm l"/></div></figure><p id="1117" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当发布到<code class="eh mi mj mk ma b">/broadcasting</code>时，我们将发送一个带有输入文本的事件。要向Laravel发送事件，我们可以为此创建一个单独的类:</p><pre class="kg kh ki kj fq lz ma mb mc aw md dt"><span id="7c2f" class="ky kz ik ma b fv me mf l mg mh">php artisan make:event SendMessage</span></pre><p id="cf76" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这个事件中，我们将设置一个名为<code class="eh mi mj mk ma b">$message</code>的类变量，该变量可用于iOS应用程序。记住，Laravel事件中的所有<code class="eh mi mj mk ma b">public</code>变量对于正在监听事件的应用程序都是可用的。课程的内容将是:</p><figure class="kg kh ki kj fq hw"><div class="bz el l di"><div class="ml mm l"/></div></figure><p id="bd16" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将在通道<code class="eh mi mj mk ma b">messages</code>中发送一个名为<code class="eh mi mj mk ma b">message.sent</code>的事件。消息的内容可以在<code class="eh mi mj mk ma b">$message</code>变量中找到。</p><blockquote class="mu"><p id="20c1" class="mv mw ik bd mx my mz na nb nc nd ke ek translated">打开Pusher仪表盘中的调试控制台，测试是否有事件发生！</p></blockquote><figure class="nf ng nh ni nj hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ne"><img src="../Images/c86673ea1e53609b6473e9d9fff27c49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-7k9LSjrc6gneXvMW4t5Q.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Pusher dashboard</figcaption></figure><p id="9608" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是我们将要构建两个可以通过websockets相互通信的应用程序系列的第1部分。这里的重点是通过Laravel Passport进行认证。你可以在<a class="ae ih" href="https://github.com/mratiebatie/laravel-pusher" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到本教程的所有代码。</p></div><div class="ab cl nk nl hc nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="hn ho hp hq hr"><p id="eccb" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj il"> Sjors van Dongen是一位荷兰人，对发展、创业和个人成长充满热情。他目前正在为他的数字访客注册软件</strong> <a class="ae ih" href="https://incheckert.nl" rel="noopener ugc nofollow" target="_blank"> <strong class="jj il">工作</strong></a></p></div></div>    
</body>
</html>