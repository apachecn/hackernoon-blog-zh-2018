<html>
<head>
<title>1 min* to run a service in Kubernetes — kapp tool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">1分钟*在Kubernetes-kapp工具中运行一项服务</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/1-min-to-run-a-service-in-kubernetes-kapp-tool-907fcec9f01a?source=collection_archive---------24-----------------------#2018-05-02">https://medium.com/hackernoon/1-min-to-run-a-service-in-kubernetes-kapp-tool-907fcec9f01a?source=collection_archive---------24-----------------------#2018-05-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/229c798834ea5b2a59f3ee2fe27c68fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KgpBG3aCIPEL61kAHQckrg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by Nick Fewings (<a class="ae jg" href="https://unsplash.com/@jannerboy62" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/@jannerboy62</a>)</figcaption></figure><p id="dd5a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我之前的一篇名为<a class="ae jg" href="https://hackernoon.com/from-makefile-to-go-semantic-versioning-service-on-kubernetes-3fae678db87c" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv">从Makefile到Kubernetes上的Go语义版本服务</strong> </a> <strong class="jj hv"> </strong>的文章中，我谈到了创建一个简单的Go服务，它运行在Kubernetes上并返回下一个语义版本。举个例子:你把类似这样的<code class="eh kf kg kh ki b">minor/0.1.0</code>发送给服务，服务用<code class="eh kf kg kh ki b">0.1.1</code>响应。</p><p id="1c8f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在那篇文章的结论中，我提到我的大部分时间都花在了解决Kubernetes部署文件(<a class="ae jg" href="http://helm.sh" rel="noopener ugc nofollow" target="_blank"> Helm </a>)和Makefile上，实际上我并没有在我的代码上花很多时间。</p><p id="1596" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">由于我做过一些React开发，我想起了一个叫做<code class="eh kf kg kh ki b">create-react-app</code>的工具——这个工具可以帮助你创建一个基本的React应用程序，你可以在几秒钟内构建并在浏览器中运行。我认为，如果在Kubernetes中有类似的应用程序/服务可以快速启动并运行，这将是非常有用的。</p><p id="5bbd" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这就是<a class="ae jg" href="https://github.com/peterj/kapp" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv"> kapp </strong> </a>工具的诞生——一个帮助你创建Go服务并让它们立刻在Kubernetes中运行的工具！</p><p id="6dc3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以从<a class="ae jg" href="https://github.com/peterj/kapp/releases" rel="noopener ugc nofollow" target="_blank">这里</a>下载该应用的第一版。完整的源代码可以在<a class="ae jg" href="https://github.com/peterj/kapp" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>上获得。</p><h1 id="d2f3" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated"><a class="ae jg" href="https://github.com/peterj/kapp" rel="noopener ugc nofollow" target="_blank"> kapp </a>快速概述</h1><p id="0440" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">安装了<strong class="jj hv"> kapp </strong>之后，您可以像这样创建您的第一个Go服务:</p><pre class="lm ln lo lp fq lq ki lr ls aw lt dt"><span id="539b" class="lu kk hu ki b fv lv lw l lx ly">cd $GOPATH/src/github.com/peterj<br/>kapp create helloworld --package github.com/peterj/helloworld</span></pre><p id="7f16" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将在当前文件夹下创建一个名为<code class="eh kf kg kh ki b">helloworld</code>的文件夹，其中包含以下文件:</p><pre class="lm ln lo lp fq lq ki lr ls aw lt dt"><span id="8daa" class="lu kk hu ki b fv lv lw l lx ly">helloworld<br/>├── .gitignore<br/>├── Dockerfile<br/>├── Makefile<br/>├── VERSION.txt<br/>├── docker.mk<br/>├── helm<br/>│   └── helloworld<br/>│       ├── Chart.yaml<br/>│       ├── templates<br/>│       │   ├── _helpers.tpl<br/>│       │   ├── deployment.yaml<br/>│       │   └── service.yaml<br/>│       └── values.yaml<br/>├── main.go<br/>└── version<br/>    └── version.go</span></pre><p id="e81f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您的服务会得到一个<code class="eh kf kg kh ki b">Dockerfile</code>，将它安装到Kubernetes的舵图，以及<code class="eh kf kg kh ki b">Makefile</code>和<code class="eh kf kg kh ki b">docker.mk</code>文件中的一些有用的Makefile目标。</p><p id="2541" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">看看下面的gif，它向你展示了如何创建一个新的应用程序，初始化它，构建它，并在本地运行它。</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lz"><img src="../Images/c29421eb31b795364c4b5354db26b6e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vz3x6E7XsMj_GlsVBo12oA.gif"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Create a new app and building it locally</figcaption></figure><h1 id="ac79" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">部署到Kubernetes</h1><p id="55db" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">现在您已经创建了应用程序，是时候在Kubernetes中部署和运行它了。从本地运行的应用程序(作为二进制文件)到在Kubernetes上的容器中运行的应用程序需要几个步骤:</p><ul class=""><li id="f118" class="ma mb hu jj b jk jl jo jp js mc jw md ka me ke mf mg mh mi dt translated">创建Dockerfile文件</li><li id="7239" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated">构建并标记Docker图像</li><li id="d754" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated">将图像推送到注册表</li><li id="48cf" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated">创建Kubernetes部署文件</li><li id="0113" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated">创建Kubernetes服务文件</li><li id="f4e9" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated">部署Kubernetes部署和服务</li></ul><p id="54e1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当你运行<strong class="jj hv"> kapp </strong>时，你已经为你的应用得到了一个<code class="eh kf kg kh ki b">Dockerfile</code>和掌舵图(Kubernetes部署，服务文件)。与Makefile一起，您还可以获得为您执行上述步骤的任务。</p><p id="f183" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们先从设置Docker注册表开始:</p><pre class="lm ln lo lp fq lq ki lr ls aw lt dt"><span id="1e3c" class="lu kk hu ki b fv lv lw l lx ly">$ docker login # you can skip this if you're already logged in<br/>$ export DOCKER_REGISTRY=[registry_username]</span></pre><p id="73cf" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">使用Docker注册表集，我们可以构建映像:</p><pre class="lm ln lo lp fq lq ki lr ls aw lt dt"><span id="19a8" class="lu kk hu ki b fv lv lw l lx ly">$ make build.image </span></pre><p id="0a6b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后我们可以将它推送到注册表中:</p><pre class="lm ln lo lp fq lq ki lr ls aw lt dt"><span id="a599" class="lu kk hu ki b fv lv lw l lx ly">$ make push.image</span></pre><p id="ba79" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后，我们可以将我们的应用程序部署到Kubernetes:</p><pre class="lm ln lo lp fq lq ki lr ls aw lt dt"><span id="4283" class="lu kk hu ki b fv lv lw l lx ly">$ make install.app</span></pre><p id="07af" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就是这样！您的应用程序现已在Kubernetes中部署并运行。此时，您可以为集群创建一个代理(例如<code class="eh kf kg kh ki b">kubectl proxy</code>)或者让一个终端在集群内部运行来访问您的服务。</p><h1 id="86f3" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">快速迭代</h1><p id="4a98" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">完成服务的初始部署后，您就可以快速迭代应用程序了。</p><p id="3aa7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以修改你的代码，也可以选择升级应用版本(<code class="eh kf kg kh ki b">make bump-version</code>)并运行:</p><pre class="lm ln lo lp fq lq ki lr ls aw lt dt"><span id="7471" class="lu kk hu ki b fv lv lw l lx ly">make upgrade</span></pre><p id="0d8d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">升级已经在Kubernetes上运行的现有应用程序。</p><h1 id="155f" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">结论</h1><p id="86d7" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">这是一个有趣的兼职项目，我可以用它来引导任何新的(Go)服务开发。该项目的源代码可在<a class="ae jg" href="https://github.com/peterj/kapp" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。所有公关和问题都非常受欢迎！</p><h1 id="798b" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">感谢阅读！</h1><p id="2b63" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">欢迎对本文的任何反馈！也可以在<a class="ae jg" href="http://twitter.com/pjausovec" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae jg" href="http://github.com/peterj" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上关注我。如果你喜欢这个并且想在我写更多东西的时候得到通知，你应该订阅<a class="ae jg" href="https://tinyletter.com/pjausovec" rel="noopener ugc nofollow" target="_blank">我的时事通讯</a>！</p><blockquote class="mo mp mq"><p id="3155" class="jh ji mr jj b jk jl jm jn jo jp jq jr ms jt ju jv mt jx jy jz mu kb kc kd ke hn dt translated"><strong class="jj hv"> * </strong>可能多，可能少，但是标题里有一些数字(最好小一点)还是比较流行的。我记得技术/编程书籍的标题是“10天学会X”。过了一会儿，标题中的那些日子变成了小时，现在我们说的是分钟…秒，接下来是微秒，纳秒？</p></blockquote></div></div>    
</body>
</html>