<html>
<head>
<title>How to Create Bitrise Step in Go — Flutter Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Go-Flutter示例中创建Bitrise步骤</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-create-bitrise-step-in-go-flutter-example-668cf4db1fd2?source=collection_archive---------17-----------------------#2018-05-07">https://medium.com/hackernoon/how-to-create-bitrise-step-in-go-flutter-example-668cf4db1fd2?source=collection_archive---------17-----------------------#2018-05-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/32160493e1fa928565df6d7e033698a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yD5m7YTIZN6RMsTA.png"/></div></div></figure><h2 id="5844" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">背景</h2><p id="e636" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated"><a class="ae kv" href="https://www.bitrise.io" rel="noopener ugc nofollow" target="_blank"> Bitrise.io </a>是一个持续集成和交付(CI/CD)平台即服务(PaaS)，主要专注于移动应用程序开发。<strong class="kc hv"> Bitrise提供了与流行的、广泛使用的工具的集成，如</strong><a class="ae kv" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv">grad le</strong></a><strong class="kc hv"/><a class="ae kv" href="https://www.xamarin.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv">Xamarin</strong></a><strong class="kc hv">或</strong> <a class="ae kv" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hv"> Xcode </strong> </a>。然而，针对利基和/或全新工具的集成可能不会立即可用。通常，最快的解决方案是编写一个专门的shell脚本。尽管如此，脚本也是最难在多个项目中重用的。</p><p id="d42b" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">此外，shell脚本通常不适合复杂的操作。有没有更好的办法？当然啦！在这篇文章中，我们将向你展示如何创建你自己的Bitrise步骤，以及如何发布它，这样每个人都可以使用它。</p><h2 id="520e" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">为什么是另一篇文章？</h2><p id="9e48" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">Bitrise <a class="ae kv" href="https://devcenter.bitrise.io/bitrise-cli/create-your-own-step/" rel="noopener ugc nofollow" target="_blank"> DevCenter </a>以及专用(访客)<a class="ae kv" href="https://blog.bitrise.io/how-to-create-and-share-your-own-bitrise-step" rel="noopener ugc nofollow" target="_blank"> blogpost </a>上提供了涉及创建步骤的说明。尽管如此，在本文中，<strong class="kc hv">我们将重点介绍Bitrise使用的主要语言</strong> <a class="ae kv" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hv"> Go </strong> </a> <strong class="kc hv">中的编程。对于非平凡步骤</strong>也是优选的。</p><h2 id="732f" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">问题是</h2><p id="664d" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated"><strong class="kc hv">At</strong><a class="ae kv" href="https://www.thedroidsonroids.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv">DroidsOnRoids</strong></a><strong class="kc hv">我们最近开始使用Flutter进行手机app开发。</strong> Flutter是跨平台移动应用开发SDK之一。你可以在文章中读到更多信息:<a class="ae kv" href="https://www.thedroidsonroids.com/blog/flutter-in-mobile-app-development-pros-and-risks-for-app-owners" rel="noopener ugc nofollow" target="_blank">在移动应用程序开发中摇摆——对应用程序所有者的好处&amp;风险</a>。</p><p id="f0a0" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated"><strong class="kc hv">我们开始使用Flutter，但是没有可用的Bitrise步骤。所以我们决定自己造一个！</strong></p><figure class="lc ld le lf fq iv fe ff paragraph-image"><div class="fe ff lb"><img src="../Images/480a710a949121efeab534b3a997ad7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*LZxbxUfaRuuR0JfX.gif"/></div></figure><h2 id="91bb" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">1.准备</h2><p id="a17f" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">在我们开始编码之前，我们需要准备好我们的环境。您可以使用您最喜欢的编辑器/IDE来处理源文件。如果你熟悉Android Studio或JetBrains的其他ide，你可能会对<a class="ae kv" href="https://www.jetbrains.com/go/" rel="noopener ugc nofollow" target="_blank"> GoLand </a>感兴趣。</p><p id="994c" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">除此之外，<strong class="kc hv">我们还需要一个</strong><a class="ae kv" href="https://www.bitrise.io/cli" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv">bit rise CLI</strong></a>。只需<a class="ae kv" href="https://devcenter.bitrise.io/bitrise-cli/installation/" rel="noopener ugc nofollow" target="_blank">安装</a>并通过调用<code class="eh lg lh li lj b">bitrise setup</code>进行设置。注意你需要一台Linux或者Mac的机器。用于Windows的CLI不可用。</p><p id="eba3" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">最后，<strong class="kc hv">我们将需要Go工具</strong>。你可以使用你的软件包管理器(apt-get，Homebrew等)来安装它。)或从<a class="ae kv" href="https://golang.org/dl/" rel="noopener ugc nofollow" target="_blank">项目网站</a>下载。</p><p id="fa16" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">接下来，我们实际上可以使用<code class="eh lg lh li lj b">bitrise :step create</code>创建一个步骤。注意冒号，这是需要的，因为<strong class="kc hv">:步骤</strong>在这里表示一个插件，而不是一个命令。请记住，我们必须选择<code class="eh lg lh li lj b">go</code>作为工具包。创建过程是交互式的，您将被要求一步一步地输入细节。就像这样:</p><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lk"><img src="../Images/48c20b2366c7f374bf77f1fae7f64ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PNiUoE6iZ-mmPQ0k5Md9xA.gif"/></div></div></figure><h2 id="f747" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">2.步骤属性</h2><p id="0b72" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">现在我们有了一个工作步骤框架，大多数属性都被设置为合理的默认值。然而，我们需要对其中的一些进行调整。首先，我们可以将<code class="eh lg lh li lj b">is_requires_admin_user</code>设置为<code class="eh lg lh li lj b">false</code>，因为执行Flutter命令不需要管理员/超级用户权限。接下来，我们可以添加依赖项。这里的每个依赖项都是一个<a class="ae kv" href="https://help.ubuntu.com/community/AptGet/Howto" rel="noopener ugc nofollow" target="_blank"> apt-get </a>(在Linux上)或<a class="ae kv" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank"> Homebrew </a>(在MacOS上)包。</p><p id="bb06" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">如何找出需要哪些依赖关系？一个好的起点是给定工具的文档。例如，Flutter在其文档中有一个<a class="ae kv" href="https://flutter.io/setup-macos/" rel="noopener ugc nofollow" target="_blank">入门:安装</a>章节，其中包含所需系统组件的列表。<a class="ae kv" href="https://flutter.io/setup-linux/" rel="noopener ugc nofollow" target="_blank"> Linux版本</a>也有。然而，事实证明，还有一个未列出的需求— <a class="ae kv" href="https://github.com/flutter/flutter/issues/17297" rel="noopener ugc nofollow" target="_blank"> libglu1-mesa </a>。</p><p id="6bfc" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">最后，<code class="eh lg lh li lj b">step.yml</code>文件中的<code class="eh lg lh li lj b">deps</code>部分应该是这样的:</p><figure class="lc ld le lf fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><h2 id="d20a" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">3.输入</h2><p id="f7a1" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">实际上，所有的Bitrise步骤都需要用户以某种方式进行配置。在颤振的情况下，他们可能想要<strong class="kc hv">选择他们想要运行的颤振命令</strong>，例如<code class="eh lg lh li lj b">test</code>和/或<code class="eh lg lh li lj b">build</code>。</p><p id="2e71" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">此外，能够<strong class="kc hv">指定精确的颤振版本</strong>将是有用的。可选地，它可以默认为当前值。</p><p id="7b8f" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">最后，我们还可以<strong class="kc hv">支持Flutter项目位于除了存储库根目录</strong>之外的其他地方的情况。最简单的方法是建立合理的默认值，但允许用户在需要时更改它。颤振步骤的完整输入部分如下所示:</p><figure class="lc ld le lf fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="d8a8" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">所有输入分别有名称:<code class="eh lg lh li lj b">version</code>、<code class="eh lg lh li lj b">working_dir</code>和<code class="eh lg lh li lj b">commands</code>。在名称之后，每个输入都包含一个默认值，如果用户没有在配置中明确设置它，就会使用这个默认值。<strong class="kc hv">注意其中一个不是硬编码文本而是环境变量</strong> - <code class="eh lg lh li lj b">$BITRISE_SOURCE_DIR</code>。它是由Bitrise CLI公开的。运行时，它将由实际值替换<a class="ae kv" href="https://devcenter.bitrise.io/getting-started/manage-your-bitrise-workflow/#environment-variable-replace-mode" rel="noopener ugc nofollow" target="_blank">。为了使这种替换生效，需要启用<code class="eh lg lh li lj b">is_expand</code>标志。图形工作流编辑器中的输入部分应如下所示:</a></p><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ln"><img src="../Images/3d3c37ae6afe378c8ee2e66065dd00b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*D9BwZMI2JsTO_6ok.png"/></div></div></figure><h2 id="658d" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">4.履行</h2><p id="59cb" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">我们的步骤将用<a class="ae kv" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>语言编写。它被用在几乎所有非琐碎的官方步骤中。此外，Bitrise提供了<a class="ae kv" href="https://github.com/bitrise-io/go-utils" rel="noopener ugc nofollow" target="_blank">go-utils</a>——一组在持续集成中有用的功能，因此<strong class="kc hv">没有必要从头开始实现一切，我们可以专注于业务逻辑</strong>。</p><h2 id="0ebb" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">✔️戈朗基础</h2><p id="7a0f" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">这篇文章并不是关于Go编程的教程。它将只解释在step开发过程中最重要的有用的东西。我还假设你有基本的编程知识，这里就不解释什么是string或者nil了。可以通过官方<a class="ae kv" href="https://tour.golang.org" rel="noopener ugc nofollow" target="_blank">巡讲</a>快速探索Go语言基础。</p><h2 id="a98e" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">错误处理</h2><p id="f0b8" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">在Golang中，没有可以被抛出以中断电流的异常。如果给定的函数调用可能失败，它将<code class="eh lg lh li lj b">error</code>作为最后一个返回值(函数可以返回多个值)。我们需要检查错误是否不是<code class="eh lg lh li lj b">nil</code>，以确定操作是否成功。如果错误是致命的，它通常会传播到<code class="eh lg lh li lj b">main</code>函数，我们可以将它打印到日志中，并以非零代码退出。</p><p id="4adb" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">请记住<strong class="kc hv">错误不应该被接受，而应该被记录或返回给调用者</strong>。Go lint会抱怨被忽略的错误。</p><h2 id="847b" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">属国</h2><p id="fa70" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">在撰写本文时，Go中还没有标准的内置依赖管理系统。Bitrise使用<a class="ae kv" href="https://golang.github.io/dep/docs/daily-dep.html" rel="noopener ugc nofollow" target="_blank"> dep </a> — <em class="lo">一个准备生产使用的官方实验</em>。Go没有附带Dep。必须单独安装<a class="ae kv" href="https://golang.github.io/dep/docs/installation.html" rel="noopener ugc nofollow" target="_blank">和</a>。</p><p id="c5e4" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">请注意，dep生成的文件需要签入版本控制系统。除了配置文件，还有所有依赖项的源代码。</p><h2 id="7d7b" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">✔️构型</h2><p id="1d13" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">步骤配置来自环境。所有前述的<a class="ae kv" href="#inputs" rel="noopener ugc nofollow">输入</a>成为环境变量。注意名称中的snake_case，这是Bitrise上的<a class="ae kv" href="https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md#input-naming-convention" rel="noopener ugc nofollow" target="_blank">约定</a>。用作多个输入值分隔符的管道字符(<code class="eh lg lh li lj b">|</code>)也遵循<a class="ae kv" href="https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md#list-of-values-in-outputs" rel="noopener ugc nofollow" target="_blank">约定</a>。</p><p id="70c5" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">使用<a class="ae kv" href="https://github.com/bitrise-tools/go-steputils" rel="noopener ugc nofollow" target="_blank"> go-steputils </a>可以将环境变量解析成可从Go代码中使用的对象。我们可以声明包含配置参数的结构，并让<code class="eh lg lh li lj b">stepconf</code>解析它:</p><figure class="lc ld le lf fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="4dbb" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">请注意，结构名称以大写字母开头。如果从另一个go文件访问该结构，则需要它。带省略号的注释只是为了让lint开心。每个结构字段都有一个带有相应环境变量名的标签。</p><p id="00f8" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">标签还可以包含属性，例如，给定字段是否是必需的，或者它是否应该表示目录的路径。如果不满足条件，解析将会失败。如果配置无效，我们需要用非零代码退出。</p><h2 id="e44f" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">✔️颤动逻辑</h2><p id="58c5" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">源代码的其余部分表示特定于Flutter调用的操作:</p><ol class=""><li id="83e3" class="lp lq hu kc b kd kw kh kx jn lr jr ls jv lt ku lu lv lw lx dt translated">确保Android SDK是最新的(仅当它存在时)— Flutter至少需要26.0.0</li><li id="4004" class="lp lq hu kc b kd ly kh lz jn ma jr mb jv mc ku lu lv lw lx dt translated">下载并解压缩Flutter SDK(目标路径特定于操作系统)</li><li id="177d" class="lp lq hu kc b kd ly kh lz jn ma jr mb jv mc ku lu lv lw lx dt translated">执行提供的颤振命令</li></ol><p id="0573" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">完整的源代码可以在<a class="ae kv" href="https://github.com/DroidsOnRoids/bitrise-step-flutter" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><h2 id="13ed" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">✔️暗示</h2><p id="0e05" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">在从零开始实现之前，首先检查类似的东西在Go标准库中或外部库中是否不存在。对文件、目录、路径、命令调用、打印日志等的操作。通常在CI中使用，因此它们可能存在于Bitrise开源回购协议中的某个地方，如<a class="ae kv" href="https://github.com/bitrise-tools/" rel="noopener ugc nofollow" target="_blank"> bitrise-tools </a>或<a class="ae kv" href="https://github.com/bitrise-io/go-utils" rel="noopener ugc nofollow" target="_blank"> go-utils </a>。</p><p id="53af" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">从终端添加对外部库invoke: <code class="eh lg lh li lj b">dep ensure -add &lt;import path&gt;</code>的依赖。其中<code class="eh lg lh li lj b">&lt;import path&gt;</code>是进口申报单中的数值，例如<code class="eh lg lh li lj b">github.com/bitrise-io/go-utils/pathutil</code>。</p><p id="5b19" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">如果您需要在某个操作成功或失败后执行清理，请使用<a class="ae kv" href="https://tour.golang.org/flowcontrol/12" rel="noopener ugc nofollow" target="_blank"> defer语句</a>。类似于Java/Kotlin中的<code class="eh lg lh li lj b">finally</code>块。<strong class="kc hv">请注意，您不能传播来自延迟函数的错误。</strong>但是，您也不应该忽略错误，而是应该记录错误:</p><figure class="lc ld le lf fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><h2 id="fddc" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">✔️测试和静态代码分析</h2><p id="c906" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">根据<a class="ae kv" href="https://github.com/bitrise-io/bitrise-steplib/blob/master/PULL_REQUEST_TEMPLATE.md" rel="noopener ugc nofollow" target="_blank"> StepLib pull请求模板</a>每个步骤都应该有<code class="eh lg lh li lj b">test</code>工作流。通常它由几个步骤组成:</p><ul class=""><li id="22a4" class="lp lq hu kc b kd kw kh kx jn lr jr ls jv lt ku md lv lw lx dt translated">单元测试</li><li id="fadc" class="lp lq hu kc b kd ly kh lz jn ma jr mb jv mc ku md lv lw lx dt translated">去<a class="ae kv" href="https://github.com/golang/lint" rel="noopener ugc nofollow" target="_blank">棉绒</a></li><li id="1f65" class="lp lq hu kc b kd ly kh lz jn ma jr mb jv mc ku md lv lw lx dt translated"><a class="ae kv" href="https://github.com/kisielk/errcheck" rel="noopener ugc nofollow" target="_blank"> errcheck </a> —附加的静态代码分析工具</li><li id="f605" class="lp lq hu kc b kd ly kh lz jn ma jr mb jv mc ku md lv lw lx dt translated">集成测试</li></ul><p id="015f" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">在StepLib中，有针对所有上述类型测试的步骤。下面是测试工作流的样子:</p><figure class="lc ld le lf fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="069b" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated"><em class="lo">切换工作方向</em>和<em class="lo">步骤测试</em>步骤在步骤创建过程中自动生成。集成测试通常需要一些合理的输入。如果某些输入是非公开的，例如API密钥/令牌等。你可以把它定义为<a class="ae kv" href="https://devcenter.bitrise.io/bitrise-cli/secrets/" rel="noopener ugc nofollow" target="_blank">秘密</a>。单元测试文件名应该带有<code class="eh lg lh li lj b">_test</code>后缀，以便正确识别。Bitrise上的单元测试通常使用<a class="ae kv" href="https://github.com/stretchr/testify" rel="noopener ugc nofollow" target="_blank">verify</a>框架进行断言。下面是简单的单元测试示例:</p><figure class="lc ld le lf fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="2cea" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated"><strong class="kc hv">请记住，如果一个步骤适用于像Flutter这样的所有平台(Android和iOS)，您应该在多个Bitrise </strong> <a class="ae kv" href="https://devcenter.bitrise.io/infrastructure/available-stacks/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hv">堆栈</strong> </a> <strong class="kc hv">上测试它。像<a class="ae kv" href="https://github.com/DroidsOnRoids/bitrise-step-trigger-bitrise-workflow" rel="noopener ugc nofollow" target="_blank">触发Bitrise工作流</a>或<a class="ae kv" href="https://github.com/bitrise-steplib/bitrise-step-build-router-start" rel="noopener ugc nofollow" target="_blank"> Bitrise开始构建</a>这样的步骤在这种情况下会很有用。</strong></p><h2 id="2e16" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">5.最后的润色</h2><p id="f67f" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">如果您的步骤准备好了，您可以请求将其发布到StepLib。为此，您必须首先派生出<a class="ae kv" href="https://github.com/bitrise-io/bitrise-steplib" rel="noopener ugc nofollow" target="_blank"> StepLib </a> repo，并将<code class="eh lg lh li lj b">bitrise.yml</code>中的<code class="eh lg lh li lj b">MY_STEPLIB_REPO_FORK_GIT_URL</code>环境变量设置为该派生的URL。您还需要在您的步骤的repo上有一个<a class="ae kv" href="http://semver.org" rel="noopener ugc nofollow" target="_blank"> semver </a>标记(例如<code class="eh lg lh li lj b">0.0.1</code>)。如果所有这些要求都得到满足，你就可以调用<code class="eh lg lh li lj b">bitrise run share-this-step</code>。请注意，它还将运行StepLib清单所需的审计，因此您不需要执行任何其他命令。</p><p id="f600" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">现在，您可以创建一个从StepLib fork到上游的pull请求，并等待Bitrise团队的审查。甚至可以在几分钟内回顾步骤😊：</p><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff me"><img src="../Images/5f43c019f96605e0c947fe3d01293394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gjcXsk8YOZHr7qpq.png"/></div></div></figure><p id="b635" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated">如果你发布一个已经存在的步骤的更新，你也应该在该步骤的GitHub repo上创建<a class="ae kv" href="https://help.github.com/articles/creating-releases/" rel="noopener ugc nofollow" target="_blank">发布说明</a>。它是<a class="ae kv" href="https://discuss.bitrise.io/t/monthly-release-of-bitrise-cli-tools-and-summary-of-updates-april-2018-cli-v1-15-0/4767" rel="noopener ugc nofollow" target="_blank"> StepLib changelog </a>的来源。</p><h2 id="4819" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">包裹</h2><p id="e953" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku hn dt translated">我希望我的文章能帮助你创建和发布你自己的Bitrise步骤。正如你在上面看到的，这不是很难。你需要记住，Bitrise为step贡献者提供25美元<a class="ae kv" href="https://github.com/bitrise-io/bitrise-contrib/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">的折扣</a>。</p><h2 id="cbec" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">资源</h2><ul class=""><li id="56ad" class="lp lq hu kc b kd ke kh ki jn mf jr mg jv mh ku md lv lw lx dt translated"><a class="ae kv" href="https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md" rel="noopener ugc nofollow" target="_blank">步骤开发指南</a></li><li id="d057" class="lp lq hu kc b kd ly kh lz jn ma jr mb jv mc ku md lv lw lx dt translated"><a class="ae kv" href="https://devcenter.bitrise.io/bitrise-cli/create-your-own-step/" rel="noopener ugc nofollow" target="_blank">比特莱斯发展中心</a></li><li id="5025" class="lp lq hu kc b kd ly kh lz jn ma jr mb jv mc ku md lv lw lx dt translated"><a class="ae kv" href="https://play.golang.org/" rel="noopener ugc nofollow" target="_blank">围棋语言游乐场</a></li></ul></div><div class="ab cl mi mj hc mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="hn ho hp hq hr"><p id="73f2" class="pw-post-body-paragraph ka kb hu kc b kd kw kf kg kh kx kj kk jn ky km kn jr kz kp kq jv la ks kt ku hn dt translated"><em class="lo">最初发布于</em> <a class="ae kv" href="https://www.thedroidsonroids.com/blog/how-to-create-bitrise-step-in-go-flutter-example" rel="noopener ugc nofollow" target="_blank"> <em class="lo"> iOS &amp; Android手机应用开发公司— Droids On Roids —波兰</em> </a> <em class="lo">。</em></p></div></div>    
</body>
</html>