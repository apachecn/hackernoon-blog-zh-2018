<html>
<head>
<title>How to Setup Bitcoin Historical Price Data for Algo Trading in Five Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在五分钟内设置Algo交易的比特币历史价格数据</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-setup-bitcoin-historical-price-data-for-algo-trading-in-five-minutes-485cd5a0b3ed?source=collection_archive---------7-----------------------#2018-05-08">https://medium.com/hackernoon/how-to-setup-bitcoin-historical-price-data-for-algo-trading-in-five-minutes-485cd5a0b3ed?source=collection_archive---------7-----------------------#2018-05-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/87f8c0e9baec1a106cedd926f31ab5e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6fyF3sdpTqTEs90ipm4YA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/dBI_My696Rk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Chris Liverani</a> on <a class="ae jg" href="https://unsplash.com/search/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="aff3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">羊驼平台现在<a class="ae jg" href="https://alpaca.markets/" rel="noopener ugc nofollow" target="_blank">接受报名</a>加入我们的algo交易等候名单，我们相信交易自动化是未来的趋势。</p><p id="7dac" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">算法交易的一大好处是你可以根据历史数据测试你的交易策略。尤其是对于你自己开发的新策略，如果不对照可靠的数据进行测试，你真的不知道它会如何执行。算法交易和T2软件开发没什么不同。今天，大多数好的软件代码都被持续测试。随着代码的发展，开发人员不断地用真实的用例来测试它，以确保修改不会导致将来的失败。当你放弃第一个版本时，你想测试你的算法。但是，当您在算法运行时进行更改或调整时，您也想测试算法。</p><h2 id="00cc" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">这里有一个你面临的问题；数据。</h2><p id="c6a1" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">虽然测试尽可能多的角度总是好的，但运行大量回测将是一项非常数据密集型的工作负载，需要访问足够多的数据来了解非常长的历史。这就是为什么您不能直接使用GDAX API来运行这个迭代。您需要出于自己的目的将数据存储在某个地方。</p><h1 id="7229" class="lf kg hu bd kh lg lh li kl lj lk ll kp lm ln lo ks lp lq lr kv ls lt lu ky lv dt translated">教程</h1><p id="5f19" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">因此，首先想到的问题总是如何获得数据并为成功的回溯测试做好准备。好了，今天我要告诉你<strong class="jj hv">如何使用</strong><a class="ae jg" href="https://hackernoon.com/marketstore-the-financial-time-series-database-is-now-open-source-fd04343f439" rel="noopener ugc nofollow" target="_blank"><strong class="jj hv">market store</strong></a><strong class="jj hv">来获取一个长期历史的</strong> <a class="ae jg" href="https://hackernoon.com/tagged/bitcoin" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv">比特币</strong> </a> <strong class="jj hv">价格数据，以便运行最准确的回溯测试</strong>。本安装教程将会很快完成。不要浪费你的时间设置这个和那个。你只需要:</p><ul class=""><li id="e1c3" class="lw lx hu jj b jk jl jo jp js ly jw lz ka ma ke mb mc md me dt translated">docker(Windows、Mac或Linux上均可)，</li><li id="5b96" class="lw lx hu jj b jk mf jo mg js mh jw mi ka mj ke mb mc md me dt translated">一种控制台终端，</li><li id="3578" class="lw lx hu jj b jk mf jo mg js mh jw mi ka mj ke mb mc md me dt translated">还有一大杯浓咖啡！☕</li></ul><p id="e619" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">找到了吗？好吧，我们开始吧。</p><h1 id="4d78" class="lf kg hu bd kh lg lh li kl lj lk ll kp lm ln lo ks lp lq lr kv ls lt lu ky lv dt translated">体系结构</h1><p id="b11b" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">这是当今系统的高级图。我们将使用docker容器启动一个MarketStore实例，并运行一个调用GDAX price API的后台工作程序，这样我们就可以快速地从它们的端点提取比特币的历史价格，并使它可供回溯测试客户端通过HTTP进行查询。</p><p id="9c26" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将使用python3 image和python anaconda为客户机启动另一个容器。我们使用名为pymarkestore的官方客户端包。你将从市场商店得到一个数据框架。</p><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mk"><img src="../Images/baedcdb21e7e74c85c1bcca7350896c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jk0TCagmSNfnoEzg0TO9yg.png"/></div></div></figure><h1 id="4f46" class="lf kg hu bd kh lg lh li kl lj lk ll kp lm ln lo ks lp lq lr kv ls lt lu ky lv dt translated">设置MarketStore服务器</h1><p id="0773" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">今天在DockerHub上公开了MarketStore docker镜像的官方版本，但是首先，让我们为服务器写一个配置文件。</p><p id="f136" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在github存储库中，你可以找到一个YAML格式的示例配置文件:<a class="ae jg" href="https://github.com/alpacahq/marketstore/blob/master/mkts.yml" rel="noopener ugc nofollow" target="_blank">https://github . com/alpacahq/market store/blob/master/mkts . yml</a>但是我把我们的示例放在这里。</p><pre class="ml mm mn mo fq mp mq mr ms aw mt dt"><span id="5702" class="kf kg hu mq b fv mu mv l mw mx">root_directory: /project/data/mktsdb<br/>listen_port: 5993<br/>log_level: info<br/>queryable: true<br/>stop_grace_period: 0<br/>wal_rotate_interval: 5<br/>enable_add: true<br/>enable_remove: false<br/>enable_last_known: false<br/>bgworkers:<br/> - module: gdaxfeeder.so<br/>   name: GdaxFetcher<br/>   config:<br/>     symbols:<br/>       - BTC<br/>     base_timeframe: "1D"<br/>     query_start: "2018-01-01 00:00"</span></pre><p id="892a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将配置服务器，以便它获取自2018年1月1日以来的1日棒线的GDAX历史价格API。将此配置保存为$PWD/mkts.yml文件。默认情况下，服务器监听端口5993。现在让我们打开服务器。</p><pre class="ml mm mn mo fq mp mq mr ms aw mt dt"><span id="d4d6" class="kf kg hu mq b fv mu mv l mw mx">$ docker run -v $PWD/mktsdb:/project/data/mktsdb -v $PWD/mkts.yml:/tmp/mkts.yml --net host alpacamarkets/marketstore:v2.1.1 marketstore -config /tmp/mkts.yml</span></pre><p id="fc37" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您还没有从DockerHub下载docker映像，服务器应该会自动从docker hub下载，并使用配置文件启动服务器进程。希望你会看到这样的东西。</p><pre class="ml mm mn mo fq mp mq mr ms aw mt dt"><span id="c814" class="kf kg hu mq b fv mu mv l mw mx">I0430 05:54:56.091770       1 log.go:14] Disabling "enable_last_known" feature until it is fixed...<br/>I0430 05:54:56.092200       1 log.go:14] Initializing MarketStore...<br/>I0430 05:54:56.092236       1 log.go:14] WAL Setup: initCatalog true, initWALCache true, backgroundSync true, WALBypass false:<br/>I0430 05:54:56.092340       1 log.go:14] Root Directory: /project/data/mktsdb<br/>I0430 05:54:56.097066       1 log.go:14] My WALFILE: WALFile.1525067696092950500.walfile<br/>I0430 05:54:56.097104       1 log.go:14] Found a WALFILE: WALFile.1525067686432055600.walfile, entering replay...<br/>I0430 05:54:56.100352       1 log.go:14] Beginning WAL Replay<br/>I0430 05:54:56.100725       1 log.go:14] Partial Read<br/>I0430 05:54:56.100746       1 log.go:14] Entering replay of TGData<br/>I0430 05:54:56.100762       1 log.go:14] Replay of WAL file /project/data/mktsdb/WALFile.1525067686432055600.walfile finished<br/>I0430 05:54:56.101506       1 log.go:14] Finished replay of TGData<br/>I0430 05:54:56.109380       1 plugins.go:14] InitializeTriggers<br/>I0430 05:54:56.110664       1 plugins.go:42] InitializeBgWorkers<br/>I0430 05:54:56.110742       1 log.go:14] Launching rpc data server...<br/>I0430 05:54:56.110800       1 log.go:14] Launching heartbeat service...<br/>I0430 05:54:56.110822       1 log.go:14] Enabling Query Access...<br/>I0430 05:54:56.110844       1 log.go:14] Launching tcp listener for all services...</span></pre><p id="f376" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您看到类似“响应错误:超出速率限制”的内容，这是一个好迹象，而不是坏迹象，因为这意味着后台工作人员成功地获取了价格数据并达到了速率限制。fetch worker将暂停一段时间，然后重新启动以自动赶上当前价格。你只需要保持运转。</p><h1 id="f404" class="lf kg hu bd kh lg lh li kl lj lk ll kp lm ln lo ks lp lq lr kv ls lt lu ky lv dt translated">客户端</h1><p id="de58" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">MarketStore为查询实现了JSON-RPC和MessagePack-RPC。MessagePack-RPC对于大型数据集的查询性能尤为重要。谢天谢地，已经有python和go客户端库了，所以你不必实现协议。在本文中，我们使用python。我们从另一个终端的miniconda3图像开始。</p><pre class="ml mm mn mo fq mp mq mr ms aw mt dt"><span id="6a65" class="kf kg hu mq b fv mu mv l mw mx">$ docker run -it --rm -v $PWD/client.py:/tmp/client.py --net host continuumio/miniconda3 bash<br/># pip install ipython pymarketstore</span></pre><p id="3c68" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们已经安装了ipython和pymarketstore，包括它们的依赖项。让我们从这个终端启动一个ipython shell并查询MarketStore数据。</p><pre class="ml mm mn mo fq mp mq mr ms aw mt dt"><span id="7336" class="kf kg hu mq b fv mu mv l mw mx"># ipython<br/>(base) root@hq-dev-01:/# ipython<br/>Python 3.6.4 |Anaconda, Inc.| (default, Jan 16 2018, 18:10:19)<br/>Type 'copyright', 'credits' or 'license' for more information<br/>IPython 6.3.1 -- An enhanced Interactive Python. Type '?' for help.</span><span id="66f9" class="kf kg hu mq b fv my mv l mw mx">In [1]: import pymarketstore as pymkts</span><span id="1867" class="kf kg hu mq b fv my mv l mw mx">In [2]: param = pymkts.Params('BTC', '1D', 'OHLCV', limit=100)</span><span id="f4cb" class="kf kg hu mq b fv my mv l mw mx">In [3]: df = pymkts.Client('<a class="ae jg" href="http://localhost:5993/rpc').query(param).first().df()" rel="noopener ugc nofollow" target="_blank">http://localhost:5993/rpc').query(param).first().df()</a></span><span id="3db7" class="kf kg hu mq b fv my mv l mw mx">In [4]: df[-10:]<br/>Out[4]:<br/>                              Open     High      Low    Close        Volume<br/>Epoch<br/>2018-04-14 00:00:00+00:00  7893.19  8150.00  7830.00  8003.11   9209.196953<br/>2018-04-15 00:00:00+00:00  8003.12  8392.56  8003.11  8355.25   9739.103514<br/>2018-04-16 00:00:00+00:00  8355.24  8398.98  7905.99  8048.93  13137.432715<br/>2018-04-17 00:00:00+00:00  8048.92  8162.50  7822.00  7892.10  10537.460361<br/>2018-04-18 00:00:00+00:00  7892.11  8243.99  7879.80  8152.05  10673.642535<br/>2018-04-19 00:00:00+00:00  8152.05  8300.00  8101.47  8274.00  11788.032811<br/>2018-04-20 00:00:00+00:00  8274.00  8932.57  8216.21  8866.27  16076.648797<br/>2018-04-21 00:00:00+00:00  8866.27  9038.87  8610.70  8915.42  11944.464063<br/>2018-04-22 00:00:00+00:00  8915.42  9015.00  8754.01  8795.01   7684.827002<br/>2018-04-23 00:00:00+00:00  8795.00  8991.00  8775.10  8940.00   3685.109169</span></pre><p id="abf6" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">瞧啊。您刚刚获得了数据帧格式的每日比特币价格。注意，第二行(param = …)决定了要查询的符号和时间范围，还有一些查询谓词，比如要查询的行数或日期范围。从这里，您可以做许多事情，包括计算指标，如移动平均线和布林线，或使用一些scipy包找到统计量异常。</p><h1 id="9f8a" class="lf kg hu bd kh lg lh li kl lj lk ll kp lm ln lo ks lp lq lr kv ls lt lu ky lv dt translated">结论</h1><p id="d03e" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">我想强调的是<strong class="jj hv">建立一个高性能的历史数据集来研究和开发一个交易算法</strong>是非常重要的，你可以通过我们刚刚走过的MarketStore快速完成。本文演示了如何处理来自GDAX的比特币价格，但是您也可以使用pymarketstore的write方法很容易地连接其他数据源。您也可以编写自己的自定义后台数据提取器。</p><p id="193d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">同样，当进行回溯测试时，查询性能将是至关重要的，因为您希望快速迭代以获得结果。现在你可能想知道MarketStore能有多快。我将在下一篇文章中用巨大的数据集展示闪电般的查询速度。</p><p id="74f4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">同时，<strong class="jj hv">如有任何问题请在评论中留下或就本教程</strong>咨询<a class="ae jg" href="https://twitter.com/AlpacaHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jj hv">@羊驼队</strong> </a> <strong class="jj hv">。</strong></p><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="mz na l"/></div></figure></div><div class="ab cl nb nc hc nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="hn ho hp hq hr"><figure class="ml mm mn mo fq iv fe ff paragraph-image"><a href="https://medium.com/automation-generation"><div class="fe ff ni"><img src="../Images/4d7d212ef68dd071daeaae0916d72f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgwdHnaQXAnW0LtrVSpdMA.png"/></div></a></figure><h2 id="0a5c" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">金融市场、算法交易、技术方面的新鲜帖请关注<a class="ae jg" rel="noopener" href="/@alpacahq">羊驼</a>和<a class="ae jg" href="https://medium.com/automation-generation" rel="noopener">自动化生成</a>。</h2><h2 id="175e" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">你可以找到我们<a class="ae jg" href="https://twitter.com/AlpacaHQ" rel="noopener ugc nofollow" target="_blank">@羊驼HQ </a>，如果你用twitter的话。</h2><figure class="ml mm mn mo fq iv fe ff paragraph-image"><a href="https://medium.com/automation-generation"><div class="fe ff nj"><img src="../Images/cdfe4e1b3df7ff7b28e2474ff8dfef1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xnDRs1aVpqUjToFRmk5Zw.png"/></div></a></figure></div><div class="ab cl nb nc hc nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="hn ho hp hq hr"><p id="0589" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你是一个黑客，并且可以创造一些在金融市场上工作的很酷的东西，请查看我们的项目"<a class="ae jg" href="https://alpaca.markets/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=strategy_list&amp;utm_content=part1" rel="noopener ugc nofollow" target="_blank">免佣金股票交易API </a>"，在那里我们免费提供简单的REST交易API和实时市场数据。</p><p id="10b0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">经纪服务由FINRA/SIPC成员Alpaca Securities LLC(<a class="ae jg" href="https://alpaca.markets/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=strategy_list&amp;utm_content=part1" rel="noopener ugc nofollow" target="_blank">Alpaca . markets</a>)提供。羊驼证券有限责任公司是AlpacaDB，Inc .的全资子公司。</p><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="nk na l"/></div></figure></div></div>    
</body>
</html>