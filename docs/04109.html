<html>
<head>
<title>Using Open Source Projects: A Recipe for Success, or Unmitigated Disaster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用开源项目:成功的秘诀，还是彻底的灾难</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/using-open-source-projects-a-recipe-for-success-or-unmitigated-disaster-784eff6713b1?source=collection_archive---------36-----------------------#2018-05-14">https://medium.com/hackernoon/using-open-source-projects-a-recipe-for-success-or-unmitigated-disaster-784eff6713b1?source=collection_archive---------36-----------------------#2018-05-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="e80d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">选择正确的开源项目就像玩扫雷游戏一样——走错一步，就会爆炸！你的系统失灵了。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/ab65cefa9467349b8fd9612a7e848c12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fi7EvTYOIC6c1x22d2berg.jpeg"/></div></div></figure><p id="00c8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在软件开发领域有一个流行的原则——DRY，也就是不要重复自己。开源项目的主要目的是共享，以避免每个人在可以制造引擎的时候制造轮子。对于一个像互联网和信息技术这样快节奏的行业来说，速度就是一切。开源资源节省了人力和时间，同时加快了业务发展的步伐。有什么不喜欢的？</p><p id="fc54" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，现实并不总是那么美好。基于开源的项目会带来一系列问题，比如停机或数据丢失。在某些情况下，各种各样的开源项目真的让人头疼。应该选择MySQL还是PostgreSQL？Memcached还是Redis？有棱角还是有反应？</p><p id="034a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是我根据与UC浏览器团队合作和开发开源项目的经验得出的一些想法、观察和个人经验。</p><h1 id="0315" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated"><strong class="ak">选拔阶段</strong></h1><h2 id="0be2" class="la kd hu bd ke lb lc ld ki le lf lg km jc lh li kq jg lj lk ku jk ll lm ky ln dt translated"><strong class="ak">根据业务需求选择项目</strong></h2><p id="43e9" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">因为许多开源选项往往是相似的(但同时又如此不同！)，我们在做选择时总是面临两难的境地。为了简化流程并确保选择适合最终目的，我们选择更加关注它如何满足平台需求，而不是什么是最好的。</p><p id="1d8c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在开发一个社交平台的过程中，我们发现了一个名为TT (Tokyo暴君)的开源解决方案，它是带有缓存的Memcache和带有持久存储的MySQL的完美替代品。我们认为这是一个很棒的解决方案，并广泛使用它——后来才意识到它不能完全取代MySQL，而且它看似神奇的功能有很多缺陷，需要很长时间才能熟悉。</p><p id="df35" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果业务需要1,000 TPS，那么20,000 TPS的解决方案和50000 TPS的解决方案实际上没有什么区别。系统架构可以在未来重新构建，以获得更高的TPS数，但是UNIX编程哲学规定，过早的优化是万恶之源。</p><h2 id="54d7" class="la kd hu bd ke lb lc ld ki le lf lg km jc lh li kq jg lj lk ku jk ll lm ky ln dt translated"><strong class="ak">评估项目成熟度</strong></h2><p id="1d86" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">新的开源项目通常会声称在性能、功能和新特性方面比以前的项目好得多。尽管它们很诱人，但它们都会携带病毒。编程天赋并不能保证一个项目的第一个版本是完美的。从事Windows、Linux和MySQL工作的开发人员是业内最优秀的，但他们仍然为他们的项目发布更新和错误修复。年轻的开源项目在应用于生产环境时会引入新的风险，其中最不严重的是系统停机(已经相当严重了)，最坏的情况是不可逆的数据丢失(完全是一场噩梦)。</p><p id="fee6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们使用TT时，发生了电源故障，导致文件损坏，无法通过重新启动系统来恢复。幸运的是，我们的日常备份实践挽救了这一天，但我们仍然丢失了停电当天的数据。紧接着，我们花了很多时间检查源代码，并通过自己编写新工具来恢复数据。谢天谢地，这些数据本质上不是金融数据；否则我们就有大麻烦了。</p><p id="e73e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么，如何检验开源项目是否成熟呢？查找以下内容:</p><p id="e132" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.<strong class="it hv">版本号</strong></p><p id="1f53" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除非完全必要，否则尽量避免使用版本0的项目。取而代之的是一个至少有1。x版出。更高的数字总是更安全的赌注。</p><p id="471d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.<strong class="it hv">使用该项目的公司数量</strong></p><p id="737a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">开源项目通常会在项目主页上列出使用它们的公司。寻找任何使用该项目的大公司，以及总数。</p><p id="ccc4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.<strong class="it hv">社区参与度</strong></p><p id="e1f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看使用该项目的社区是否活跃、帖子数量、回复、问题回复时间。</p><h2 id="579d" class="la kd hu bd ke lb lc ld ki le lf lg km jc lh li kq jg lj lk ku jk ll lm ky ln dt translated"><strong class="ak">别忘了操作和维护能力</strong></h2><p id="67eb" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">当我们选择一个开源项目时，我们通常更关注性能和可靠性等技术指标，而不是它促进操作和维护的能力。然而，操作和维护是将任何解决方案应用到在线生产环境中不可或缺的一部分。如果没有这一点，任何涉及故障排除的实例都可能陷入孤注一掷的境地。</p><p id="d4c9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以通过研究以下方面来检查项目的运营和维护能力:</p><p id="56df" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.<strong class="it hv">开源解决方案的日志是否完整</strong>:一些开源解决方案的日志文件非常简短，只有几行开始和停止的内容。这使得在出现问题时很难调查和解决问题。</p><p id="fb82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.<strong class="it hv">开源解决方案是否有维护工具</strong>:命令行和管理控制台帮助查看系统运行情况</p><p id="e125" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.<strong class="it hv">开源解决方案是否具有实时检测能力</strong>:这包括故障检测和恢复、告警、切换等。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lt"><img src="../Images/601b791ceea663934ac53d9a175c07b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DIsIDhrKJ2698uc9FXEDg.jpeg"/></div></div></figure><h1 id="d5a1" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated"><strong class="ak">活跃使用阶段</strong></h1><h2 id="0852" class="la kd hu bd ke lb lc ld ki le lf lg km jc lh li kq jg lj lk ku jk ll lm ky ln dt translated"><strong class="ak">深入学习，精心测试</strong></h2><p id="d914" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">许多人在观看了一些演示后，简单地复制和粘贴开放源代码，并将其部署到在线应用程序中。这肯定会危及主系统的健康及其可靠性，就像翻阅完驾驶手册后开车一样。</p><p id="0cf0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想起了一些轶事。有一次，团队中的一个人突发奇想决定使用elasticsearch，而没有完全弄清楚倒排索引并保留默认配置值。他们在第一次运行时就将其投入使用，并意识到节点ping时间太长，异常节点的消除太慢。结果呢？整个网站瘫痪了。</p><p id="a39a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有一次，很多团队没有充分研究就开始使用MySQL。业务部门最终抱怨MySQL运行太慢。罪魁祸首？最关键的参数(如innodb_buffer_pool_size、sync_binlog、innodb_log_file_size)要么配置错误，要么根本没有配置，从而导致性能低下。</p><p id="1f59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">研究和测试项目时:</p><p id="0d37" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.通过通读设计文档和可用的白皮书，旨在充分理解项目的原则</p><p id="8615" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.检查每个配置的作用和影响，并确定关键的配置项目</p><p id="078f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.针对多个场景进行性能测试</p><p id="e46b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.在您连续运行项目几天的情况下进行压力测试。观察CPU、内存、磁盘IO和其他指示器的波动。</p><p id="fc88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.进行故障测试:关机、断电、重启、切换等。</p><h2 id="0dd6" class="la kd hu bd ke lb lc ld ki le lf lg km jc lh li kq jg lj lk ku jk ll lm ky ln dt translated"><strong class="ak">小心涂抹，分阶段释放</strong></h2><p id="01a7" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">一旦研究和测试的第一阶段过去，所有的问题都解决了，我们能简单地向前推进吗？没那么快，海岸还没有清理。即使进行深入研究和多重测试，人们也必须保持谨慎，因为这些只能降低风险，而不能消除风险。</p><p id="56bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们使用TT时，我们实际上安排了一位专家来查看代码，并在执行之前进行一些测试。尽管这花了整整一个月的时间，我们在上线后仍然经历了许多问题。在线生产环境是一头复杂的野兽，最好谨慎对待。根据我们的经验，最好的方法是将项目用于次要业务，而不是核心业务，然后逐步推广到更重要的部分。</p><h2 id="f3f0" class="la kd hu bd ke lb lc ld ki le lf lg km jc lh li kq jg lj lk ku jk ll lm ky ln dt translated">期待最好的结果，做最坏的打算</h2><p id="ee7c" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">即使一切似乎进展顺利，也还不到高枕无忧的时候，尤其是在开始使用一个新的开源项目之后。如果运气必须把它的脸转过去，一个人可能会遇到一个无法修复的错误，或者更糟，一个世界上任何人都没有遇到过的错误。这种情况会对业务造成致命的打击，尤其是在涉及存储故障的情况下。</p><p id="fd16" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一些同事认识的一家企业有过使用MongoDB的惨痛经历。当机器停机时，他们丢失了一部分关键数据，他们试图恢复这些数据，但无济于事。更糟糕的是，他们没有后援。这个故事在我们自己的办公室里传播得很快，从那以后，O&amp;M团队反对使用MongoDB的每一个提议，即使是用于试验。</p><p id="34b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然仅仅因为这一点而完全反对一个项目可能有点极端，但这个故事仍然是一个警钟:当对重要的业务或数据使用开源项目时，明智的做法是保留一个更成熟的解决方案作为备份，而不是在出现问题时手足无措。例如，如果主要使用Redis，他们可以使用MySQL进行存储备份。尽管这会增加成本和复杂性，但这是防范失败风险的必要手段。</p><h1 id="e16a" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated"><strong class="ak">修改和二次开发阶段</strong></h1><h2 id="2671" class="la kd hu bd ke lb lc ld ki le lf lg km jc lh li kq jg lj lk ku jk ll lm ky ln dt translated"><strong class="ak">尽可能保持纯净</strong></h2><p id="329e" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">当我们发现一个开源项目的某些方面不能满足我们的需求时，我们很自然地会感到必须做出改变。如何着手进行这些变革是主要的挑战。</p><p id="805d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一种方法是分配几个人以适合特定业务需求的方式彻底改造项目，但是这并不理想，原因有两个。首先，这样的投资成本太高。与Redis同等规模的开源解决方案至少需要两个人花四周的时间才能完全修改。其次，做太多的修改会抹杀跟随和合并开源项目的进化版本的能力。</p><p id="1a55" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这使得开发监控和负载平衡等辅助系统更加可行。例如，如果我们想在Redis中添加一个集群函数，不需要改变它的实现。相反，增加一个代理层可以帮助达到同样的目的(Twitter的<a class="ae lu" href="http://www.cnblogs.com/gomysql/p/4413922.html" rel="noopener ugc nofollow" target="_blank"> Twemproxy </a>遵循同样的原则)。自从Redis开始用3.0版提供集群，我们所要做的就是从最初的解决方案切换到Redis 3.0。</p><p id="a7a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是如果你真的想改变开源系统呢？你可以直接向开发人员提出一个需求或者报告一个bug，但是他们不能保证快速的响应时间。所采用的方法确实取决于手头事情的紧急程度；对于不太紧急的情况，最好安排备份和应急措施。</p><h2 id="493d" class="la kd hu bd ke lb lc ld ki le lf lg km jc lh li kq jg lj lk ku jk ll lm ky ln dt translated"><strong class="ak">把一切都扔出窗外，创造你想要的轮子</strong></h2><p id="ab0a" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">不管我们是否选择开源项目，成本和收益之间的主要权衡仍然存在。有时候使用开源项目可能不是最好的方法。</p><p id="2f49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">软件和硬件领域之间最显著的区别是，当涉及到软件时，绝对没有结论性的行业标准——每个人都喜欢以自己喜欢的方式创建软件的过程。在硬件上，制造一个无法应用于车辆的独特尺寸的车轮，无论技术或产品质量有多好，都是一种资源浪费；这不是软件的限制，在软件中，任何创造出来的东西都仍然有用，组合也没有严格的定义。此外，对于大规模的应用程序，开源项目通常采用通用的处理解决方案。</p><p id="5324" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，由于业务类型的差异，通用解决方案可能不适合一刀切的应用。例如，Memcached通过一致性哈希提供集群，但是对于我们的一些业务来说，缓存崩溃会减慢整个业务的速度。这需要一个Memcached中没有的缓存备份功能。与此同时，当Redis没有集群时，我们指派了一个由大约两到四个人组成的团队，花了两个多月的时间来开发一套支持存储、备份和集群的缓存框架。基于这个框架，我们增加了跨数据中心同步，极大地提高了我们平台的可用性。</p><p id="b9ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用开源解决方案并依赖它们来实现特定的需求可能会非常耗时或者完全没有用。因此，如果现金流、人才库和时间允许，投资创建完全适合您的平台或服务的解决方案并不是一个糟糕的选择。毕竟，所有称职的科技公司都是这样做的——如果没有他们，我们一开始就不会有这么多好的开源项目。</p><p id="60ad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt">(Original article by Li Yunhua李运华)</p></div><div class="ab cl lv lw hc lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hn ho hp hq hr"><h1 id="c400" class="kc kd hu bd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz dt translated">阿里巴巴科技</h1><p id="01dc" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">关于阿里巴巴最新技术的第一手深度资讯→搜索<a class="ae lu" href="http://www.facebook.com/AlibabaTechnology" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">【阿里巴巴科技】</strong> </a>上<strong class="it hv">脸书</strong></p></div></div>    
</body>
</html>