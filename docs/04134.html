<html>
<head>
<title>Build a realtime map using Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Kotlinæ„å»ºå®æ—¶åœ°å›¾</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/build-a-realtime-map-using-kotlin-8f99ebd15fc?source=collection_archive---------16-----------------------#2018-05-15">https://medium.com/hackernoon/build-a-realtime-map-using-kotlin-8f99ebd15fc?source=collection_archive---------16-----------------------#2018-05-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="dc3d" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">è¦é˜…è¯»æœ¬æ•™ç¨‹ï¼Œéœ€è¦å¯¹Kotlinå’ŒNode.jsæœ‰åŸºæœ¬çš„äº†è§£ã€‚</p></blockquote><p id="a8a0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">é¡¾åæ€ä¹‰ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯æ˜¾ç¤ºåœ°å›¾ä¸Šæ ‡è®°çš„å®æ—¶ç§»åŠ¨ã€‚æ­¤åŠŸèƒ½åœ¨ä½ç½®è·Ÿè¸ªåº”ç”¨ä¸­å¾ˆå¸¸è§ã€‚æˆ‘ä»¬çœ‹åˆ°æ‰“è½¦åº”ç”¨å’Œè®¢é¤åº”ç”¨åˆ©ç”¨äº†è¿™æ ·çš„åŠŸèƒ½ã€‚Googleæä¾›äº†ä¸€ä¸ªéå¸¸ç®€å•çš„åœ°å›¾APIï¼Œæˆ‘ä»¬å°†åˆ©ç”¨å®ƒï¼Œè€Œå®æ—¶åŠŸèƒ½å°†ç”±Pusherè´Ÿè´£ã€‚</p><h1 id="1c8a" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">æˆ‘ä»¬å°†å»ºé€ ä»€ä¹ˆ</h1><p id="909b" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå°†åŸºäºæˆ‘ä»¬æ³¨å…¥å…¶ä¸­çš„åˆå§‹åæ ‡ä»æœåŠ¡å™¨æ¥æ”¶åæ ‡ã€‚æ”¶åˆ°è¿™äº›åæ ‡åï¼Œæˆ‘ä»¬ä¼šåœ¨åº”ç”¨ç¨‹åºä¸Šæ›´æ–°åœ°å›¾ã€‚</p><figure class="la lb lc ld fq le fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/64546f6f7e976743e782e20d792e4ef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*V1Z-O_yCf5KrrXTGJBpaAw.gif"/></div></figure><h1 id="cdd1" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">è¦æ±‚</h1><p id="ea9f" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹å†…å®¹:</p><ul class=""><li id="7e32" class="lh li hu ix b iy iz jc jd jt lj ju lk jv ll js lm ln lo lp dt translated"><a class="ae lq" href="https://developer.android.com/studio/archive.html" rel="noopener ugc nofollow" target="_blank">å®‰å“å·¥ä½œå®¤</a> â€”æ¨è3.0.1ä»¥ä¸Šç‰ˆæœ¬ã€‚</li><li id="b88e" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated"><a class="ae lq" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">å®‰è£…åœ¨æ‚¨æœºå™¨ä¸Šçš„èŠ‚ç‚¹JS </a>å’Œnpmã€‚</li><li id="92fc" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated">ä¸€ä¸ª<a class="ae lq" href="https://dashboard.pusher.com" rel="noopener ugc nofollow" target="_blank">æ¨æ†</a>åº”ç”¨ã€‚</li><li id="27fc" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated"><a class="ae lq" href="https://developers.google.com/maps/documentation/android-api/signup" rel="noopener ugc nofollow" target="_blank">è°·æ­Œåœ°å›¾APIé”®</a>ã€‚</li><li id="0e01" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated">å®‰è£…äº†Google PlayæœåŠ¡çš„Androidè®¾å¤‡ã€‚</li></ul><h1 id="acd2" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">æ„å»ºæˆ‘ä»¬çš„æœåŠ¡å™¨</h1><p id="9596" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">æˆ‘ä»¬å°†ä½¿ç”¨èŠ‚ç‚¹JSæ„å»ºæˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚æœåŠ¡å™¨ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆéšæœºåæ ‡ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ã€‚åœ¨å…¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code class="eh lw lx ly lz b">package.json</code>çš„æ–°æ–‡ä»¶ï¼Œå¹¶ç²˜è´´å¦‚ä¸‹å†…å®¹:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="059f" class="me jx hu lz b fv mf mg l mh mi">{<br/>    "main": "index.js",<br/>    "dependencies": {<br/>        "body-parser": "^1.16.0",<br/>        "express": "^4.14.1",<br/>        "pusher": "^1.5.1"<br/>    }<br/>}</span></pre><p id="4d9f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºåä¸º<code class="eh lw lx ly lz b">index.js</code>çš„æ–‡ä»¶å¹¶ç²˜è´´:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="0c36" class="me jx hu lz b fv mf mg l mh mi">// Load the required libraries<br/>let Pusher = require('pusher');<br/>let express = require('express');<br/>let bodyParser = require('body-parser');</span><span id="a390" class="me jx hu lz b fv mj mg l mh mi">// initialize express and pusher<br/>let app = express();<br/>let pusher = new Pusher(require('./config.js'));</span><span id="1063" class="me jx hu lz b fv mj mg l mh mi">// Middlewares<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: false }));</span><span id="0e63" class="me jx hu lz b fv mj mg l mh mi">// Generates 20 simulated GPS coords and sends to Pusher<br/>app.post('/simulate', (req, res, next) =&gt; {<br/>    let loopCount = 0<br/>    let operator  = 0.001000  <br/>    let longitude = parseFloat(req.body.longitude)<br/>    let latitude  = parseFloat(req.body.latitude)<br/>    <br/>    let sendToPusher = setInterval(() =&gt; {<br/>        loopCount++;</span><span id="513f" class="me jx hu lz b fv mj mg l mh mi">        // Calculate new coordinates and round to 6 decimal places...<br/>        longitude = parseFloat((longitude + operator).toFixed(7))<br/>        latitude  = parseFloat((latitude - operator).toFixed(7))</span><span id="0d7f" class="me jx hu lz b fv mj mg l mh mi">        // Send to pusher<br/>        pusher.trigger('my-channel', 'new-values', {longitude, latitude})</span><span id="3568" class="me jx hu lz b fv mj mg l mh mi">        if (loopCount === 20) {<br/>            clearInterval(sendToPusher)<br/>        }<br/>    }, 2000);</span><span id="7a22" class="me jx hu lz b fv mj mg l mh mi">    res.json({success: 200})<br/>})</span><span id="8969" class="me jx hu lz b fv mj mg l mh mi">// Index<br/>app.get('/', (req, res) =&gt; res.json("It works!"));</span><span id="387b" class="me jx hu lz b fv mj mg l mh mi">// Serve app<br/>app.listen(4000, _ =&gt; console.log('App listening on port 4000!'));</span></pre><p id="ef3f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸Šé¢çš„ä»£ç æ˜¯ä¸€ä¸ªå¿«é€Ÿåº”ç”¨ç¨‹åºã€‚åœ¨<code class="eh lw lx ly lz b">/simulate</code>è·¯çº¿ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨æ¨¡æ‹Ÿç»åº¦å’Œçº¬åº¦å€¼ï¼Œç„¶åå°†å®ƒä»¬å‘é€ç»™Pusherã€‚è¿™äº›å°†ç”±æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé€‰æ‹©ã€‚</p><blockquote class="ir is it"><p id="3f72" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡ç»åº¦å’Œçº¬åº¦å€¼é€šå¸¸ä»ç°å®åœºæ™¯ä¸­è¢«è·Ÿè¸ªçš„è®¾å¤‡è·å¾—ã€‚</em></p></blockquote><p id="8338" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æœ€åï¼Œæˆ‘ä»¬å°†åˆ›å»ºåä¸º<code class="eh lw lx ly lz b">config.js</code>çš„é…ç½®æ–‡ä»¶ã€‚å°†æ­¤ç‰‡æ®µç²˜è´´åˆ°æ­¤å¤„:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="fca9" class="me jx hu lz b fv mf mg l mh mi">module.exports = {<br/>    appId: 'PUSHER_APP_ID',<br/>    key: 'PUSHER_APP_KEY',<br/>    secret: 'PUSHER_APP_SECRET',<br/>    cluster: 'PUSHER_APP_CLUSTER',<br/>};</span></pre><p id="02bf" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç”¨æ¨åŠ¨å™¨ä»ªè¡¨æ¿ä¸Šçš„é”®æ›¿æ¢é‚£é‡Œçš„å€¼ã€‚ç„¶åï¼Œé€šè¿‡åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…æˆ‘ä»¬çš„æœåŠ¡å™¨æ‰€éœ€çš„æ¨¡å—:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="81c3" class="me jx hu lz b fv mf mg l mh mi">$ npm install</span></pre><p id="9806" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æˆ‘ä»¬çš„æœåŠ¡å™¨åº”è¯¥åœ¨ç«¯å£<strong class="ix hv"> 4000 </strong>ä¸Šå¯åŠ¨å¹¶è¿è¡Œã€‚</p><h1 id="c2ab" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">åœ¨Android Studioä¸­æ„å»ºæˆ‘ä»¬çš„å®æ—¶åœ°å›¾</h1><h1 id="0329" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">åˆ›å»ºæ–°çš„Androidé¡¹ç›®</h1><p id="3153" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">æ‰“å¼€Android studioå¹¶åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚è¾“å…¥æ‚¨çš„åº”ç”¨ç¨‹åºè¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬Kotlinæ”¯æŒï¼Œé€‰æ‹©ä¸€ä¸ªæœ€ä½çš„SDK(è¿™ä¸åº”è¯¥ä½äºAPI 14)ï¼Œé€‰æ‹©ä¸€ä¸ªç©ºæ´»åŠ¨ï¼Œå¹¶å®Œæˆè¯¥è¿‡ç¨‹ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„å¿«é€ŸGIF:</p><figure class="la lb lc ld fq le fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/4283e3862faaa54e7157b28fba57ef47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*50_QA8_AwbFF_fBmBq7j7Q.gif"/></div></figure><h1 id="88f5" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">æ·»åŠ åº”ç”¨ç¨‹åºä¾èµ–é¡¹</h1><p id="bb5c" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">è¿™ä¸ªæ¼”ç¤ºæœ‰å‡ ä¸ªä¾èµ–é¡¹ã€‚æˆ‘ä»¬éœ€è¦å®æ—¶åŠŸèƒ½çš„Pusherä¾èµ–ï¼Œè½»æ¾å°†åœ°å›¾é›†æˆåˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­çš„Google Maps APIï¼Œä»¥åŠè½»æ¾è®¿é—®æˆ‘ä»¬çš„æœåŠ¡å™¨çš„æ”¹è¿›ã€‚</p><p id="4623" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€æ‚¨çš„åº”ç”¨ç¨‹åºæ¨¡å—<code class="eh lw lx ly lz b">build.gradle</code>æ–‡ä»¶å¹¶ç²˜è´´ä»¥ä¸‹ä¾èµ–é¡¹:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="8fe5" class="me jx hu lz b fv mf mg l mh mi">// Pusher dependency<br/>implementation 'com.pusher:pusher-java-client:1.5.0'</span><span id="a990" class="me jx hu lz b fv mj mg l mh mi">// Google maps API<br/>implementation 'com.google.android.gms:play-services-maps:11.8.0'</span><span id="224a" class="me jx hu lz b fv mj mg l mh mi">// Retrofit dependencies<br/>implementation 'com.squareup.retrofit2:retrofit:2.3.0'<br/>implementation 'com.squareup.retrofit2:converter-scalars:2.3.0'</span></pre><p id="e0f5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åŒæ­¥æ‚¨çš„Gradleæ–‡ä»¶ï¼Œä»¥ä¾¿å¯ä»¥ä¸‹è½½åº“å¹¶ä½¿å…¶å¯ç”¨ã€‚</p><h1 id="34d1" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">æ„å»ºæˆ‘ä»¬çš„å¸ƒå±€</h1><p id="9e70" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">æ‰“å¼€<code class="eh lw lx ly lz b">activity_main.xml</code>å¹¶ç²˜è´´è¿™ä¸ª:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="13c4" class="me jx hu lz b fv mf mg l mh mi">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;FrameLayout xmlns:android="<a class="ae lq" href="http://schemas.android.com/apk/res/android" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"<br/>    xmlns:tools="<a class="ae lq" href="http://schemas.android.com/tools" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/tools</a>"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    android:orientation="vertical"&gt;<br/>    &lt;fragment xmlns:android="<a class="ae lq" href="http://schemas.android.com/apk/res/android" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"<br/>        xmlns:tools="<a class="ae lq" href="http://schemas.android.com/tools" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/tools</a>"<br/>        android:layout_marginTop="50dp"<br/>        android:id="@+id/map"<br/>        android:name="com.google.android.gms.maps.SupportMapFragment"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="match_parent"<br/>        tools:context="com.example.mapwithmarker.MapsMarkerActivity" /&gt;<br/>    &lt;Button<br/>        android:id="@+id/simulateButton"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:text="Simulate" /&gt;<br/>&lt;/FrameLayout&gt;</span></pre><p id="3e2a" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«åœ°å›¾å’ŒæŒ‰é’®çš„ç‰‡æ®µã€‚</p><h1 id="8641" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">è®¾ç½®Googleåœ°å›¾APIå¯†é’¥</h1><p id="05ce" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">æ­¤æ—¶ï¼Œæ‚¨åº”è¯¥å·²ç»è·å¾—äº†APIå¯†é’¥ã€‚ä½ å¯ä»¥æŒ‰ç…§è¿™é‡Œ<a class="ae lq" href="https://developers.google.com/maps/documentation/android-api/signup" rel="noopener ugc nofollow" target="_blank">çš„æ­¥éª¤</a>å»æ‹¿ã€‚æˆ‘ä»¬ç°åœ¨æƒ³ç”¨æˆ‘ä»¬çš„å¯†é’¥é…ç½®åº”ç”¨ç¨‹åºã€‚æ‰“å¼€ä½ çš„<code class="eh lw lx ly lz b">strings.xml</code>æ–‡ä»¶å¹¶ç²˜è´´è¿›å»ã€‚è¿™ä½äº<code class="eh lw lx ly lz b">name-of-project/app/src/main/res/values</code>:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="72ff" class="me jx hu lz b fv mf mg l mh mi">&lt;resources&gt;<br/>    &lt;!-- ... --&gt;<br/>    &lt;string name="google_maps_key"&gt;GOOGLE_MAPS_KEY&lt;/string&gt;<br/>&lt;/resources&gt;</span></pre><blockquote class="ir is it"><p id="73b8" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> âš ï¸å°†</em> <code class="eh lw lx ly lz b"><em class="hu">GOOGLE_MAPS_KEY</em></code> <em class="hu">å ä½ç¬¦æ›¿æ¢ä¸ºè°·æ­Œçš„å®é™…å…³é”®å­—ã€‚</em></p></blockquote><p id="cc1d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¯¥æ–‡ä»¶åŒ…å«åº”ç”¨ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ‰€æœ‰å­—ç¬¦ä¸²ã€‚åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰åŸå§‹å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨è¿™é‡Œã€‚å½“éœ€è¦å°†æ‚¨çš„åº”ç”¨ç¨‹åºç¿»è¯‘æˆå¤šç§è¯­è¨€æ—¶ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚</p><p id="29e6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ‰“å¼€<code class="eh lw lx ly lz b">AndroidManifest.xml</code>æ–‡ä»¶å¹¶å°†å®ƒä»¬ç²˜è´´åˆ°<code class="eh lw lx ly lz b">&lt;application&gt;</code>æ ‡ç­¾ä¸‹:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="4593" class="me jx hu lz b fv mf mg l mh mi">&lt;meta-data<br/>    android:name="com.google.android.gms.version"<br/>    android:value="<a class="ae lq" href="http://twitter.com/integer/google_play_services_vers" rel="noopener ugc nofollow" target="_blank">@integer/google_play_services_vers</a>ion" /&gt;<br/>&lt;meta-data<br/>    android:name="com.google.android.geo.API_KEY"<br/>    android:value="<a class="ae lq" href="http://twitter.com/string/google_maps_key" rel="noopener ugc nofollow" target="_blank">@string/google_maps_key</a>" /&gt;</span></pre><p id="f595" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±çŸ¥é“å¦‚ä½•ä»¥åŠåœ¨å“ªé‡Œè·å–æˆ‘ä»¬çš„å¯†é’¥ã€‚</p><h1 id="f9d0" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">å®‰è£…æ”¹è£…</h1><p id="fd0d" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">æˆ‘ä»¬å·²ç»æœ‰äº†ä½œä¸ºä¾èµ–é¡¹çš„æ”¹å‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦ä¸¤æ ·ä¸œè¥¿â€”â€”ä¸€ä¸ªæ˜¾ç¤ºè¦è®¿é—®çš„ç«¯ç‚¹/è·¯ç”±çš„æ¥å£å’Œæˆ‘ä»¬çš„æ”¹å‹å¯¹è±¡ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„Kotlinæ–‡ä»¶å<code class="eh lw lx ly lz b">ApiInterface.kt</code>å¹¶ç²˜è´´å®ƒ:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="c12a" class="me jx hu lz b fv mf mg l mh mi">import okhttp3.RequestBody<br/>import retrofit2.Call<br/>import retrofit2.http.Body<br/>import retrofit2.http.POST<br/>interface ApiInterface {<br/>    <a class="ae lq" href="http://twitter.com/POST" rel="noopener ugc nofollow" target="_blank">@POST</a>("/simulate")<br/>    fun sendCoordinates(<a class="ae lq" href="http://twitter.com/Body" rel="noopener ugc nofollow" target="_blank">@Body</a> coordinates: RequestBody): Call&lt;String&gt;<br/>}</span></pre><p id="0e41" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å› ä¸ºæˆ‘ä»¬åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­åªæå‡ºä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ”¹é€ å¯¹è±¡çš„èŒƒå›´é™åˆ¶åœ¨<code class="eh lw lx ly lz b">MainActivity.kt</code>ç±»ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å°†åœ¨ä¸€ä¸ªç±»ä¸­ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå‡½æ•°ã€‚å°†æ­¤å‡½æ•°ç²˜è´´åˆ°ç±»ä¸­:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="5f44" class="me jx hu lz b fv mf mg l mh mi">fun getRetrofitObject(): ApiInterface {<br/>    val httpClient = OkHttpClient.Builder()<br/>    val builder = Retrofit.Builder()<br/>            .baseUrl("<a class="ae lq" href="http://10.0.3.2:4000/" rel="noopener ugc nofollow" target="_blank">http://10.0.3.2:4000/</a>")<br/>            .addConverterFactory(ScalarsConverterFactory.create())<br/>    val retrofit = builder<br/>            .client(httpClient.build())<br/>            .build()<br/>    return retrofit.create(ApiInterface::class.java)<br/>}</span></pre><p id="a4b4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªGenymotionæ¨¡æ‹Ÿå™¨ï¼Œå®ƒçš„æœ¬åœ°ä¸»æœºåœ°å€æ˜¯<code class="eh lw lx ly lz b">10.0.3.2</code>ã€‚</p><p id="4f7f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å°†äº’è”ç½‘æƒé™æ·»åŠ åˆ°<code class="eh lw lx ly lz b">AndroidManifest.xml</code>æ–‡ä»¶:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="1d3d" class="me jx hu lz b fv mf mg l mh mi">&lt;uses-permission android:name="android.permission.INTERNET"/&gt;</span></pre><h1 id="a284" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">é…ç½®æˆ‘ä»¬çš„åœ°å›¾å¹¶è·å¾—å®æ—¶æ›´æ–°</h1><p id="4ad2" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">ä¸ºäº†åˆå§‹åŒ–å’Œä½¿ç”¨æ˜ å°„ï¼Œæˆ‘ä»¬çš„<code class="eh lw lx ly lz b">MainActivity.kt</code>ç±»å¿…é¡»å®ç°<code class="eh lw lx ly lz b">OnMapReadyCallback</code>æ¥å£å¹¶è¦†ç›–<code class="eh lw lx ly lz b">onMapReady</code>æ–¹æ³•ã€‚æˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®Pusheræ¥å®æ—¶ç›‘å¬äº‹ä»¶å’Œæ¥æ”¶æ¨¡æ‹Ÿåæ ‡ã€‚æ‰“å¼€ä½ çš„<code class="eh lw lx ly lz b">MainActivity.kt</code>å¹¶ç²˜è´´è¿™ä¸ª:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="0009" class="me jx hu lz b fv mf mg l mh mi">import android.support.v7.app.AppCompatActivity<br/>import android.os.Bundle<br/>import android.util.Log<br/>import com.google.android.gms.maps.*<br/>import com.google.android.gms.maps.model.MarkerOptions<br/>import com.google.android.gms.maps.model.LatLng<br/>import com.pusher.client.Pusher<br/>import com.pusher.client.PusherOptions<br/>import kotlinx.android.synthetic.main.activity_main.*<br/>import okhttp3.MediaType<br/>import okhttp3.OkHttpClient<br/>import org.json.JSONObject<br/>import retrofit2.Call<br/>import retrofit2.Callback<br/>import retrofit2.Response<br/>import retrofit2.Retrofit<br/>import retrofit2.converter.scalars.ScalarsConverterFactory<br/>import okhttp3.RequestBody<br/>import com.google.android.gms.maps.model.CameraPosition<br/>import com.google.android.gms.maps.model.Marker</span><span id="bcf6" class="me jx hu lz b fv mj mg l mh mi">class MainActivity : AppCompatActivity(), OnMapReadyCallback {</span><span id="ca48" class="me jx hu lz b fv mj mg l mh mi">    private lateinit var markerOptions:MarkerOptions</span><span id="cc2c" class="me jx hu lz b fv mj mg l mh mi">    private lateinit var marker:Marker</span><span id="92f0" class="me jx hu lz b fv mj mg l mh mi">    private lateinit var cameraPosition:CameraPosition</span><span id="bfde" class="me jx hu lz b fv mj mg l mh mi">    var defaultLongitude = -122.088426</span><span id="d84a" class="me jx hu lz b fv mj mg l mh mi">    var defaultLatitude  = 37.388064</span><span id="832c" class="me jx hu lz b fv mj mg l mh mi">    lateinit var googleMap:GoogleMap</span><span id="2fcc" class="me jx hu lz b fv mj mg l mh mi">    lateinit var pusher:Pusher</span><span id="8615" class="me jx hu lz b fv mj mg l mh mi">    override fun onCreate(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)</span><span id="90ca" class="me jx hu lz b fv mj mg l mh mi">        setContentView(R.layout.activity_main)</span><span id="053a" class="me jx hu lz b fv mj mg l mh mi">        markerOptions = MarkerOptions()</span><span id="1837" class="me jx hu lz b fv mj mg l mh mi">        val latLng = LatLng(defaultLatitude,defaultLongitude)</span><span id="8724" class="me jx hu lz b fv mj mg l mh mi">        markerOptions.position(latLng)</span><span id="f88a" class="me jx hu lz b fv mj mg l mh mi">        cameraPosition = CameraPosition.Builder()<br/>                .target(latLng)<br/>                .zoom(17f).build()<br/>    }</span><span id="9665" class="me jx hu lz b fv mj mg l mh mi">    override fun onMapReady(googleMap: GoogleMap?) {<br/>        this.googleMap = googleMap!!</span><span id="b9f8" class="me jx hu lz b fv mj mg l mh mi">        marker = googleMap.addMarker(markerOptions)<br/>        googleMap.animateCamera(CameraUpdateFactory.newCameraPosition(cameraPosition))<br/>    }<br/>}</span></pre><p id="8ca7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€äº›ç±»å˜é‡æ¥ä¿å­˜æˆ‘ä»¬çš„åˆå§‹åæ ‡å’Œå…¶ä»–åœ°å›¾å·¥å…·ï¼Œæ¯”å¦‚ç›¸æœºä½ç½®å’Œæ ‡è®°ä½ç½®ã€‚æˆ‘ä»¬åœ¨<code class="eh lw lx ly lz b">onCreate</code>å‡½æ•°ä¸­åˆå§‹åŒ–äº†å®ƒä»¬ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘æ¨¡æ‹ŸæŒ‰é’®æ·»åŠ äº†ä¸€ä¸ªç‚¹å‡»ç›‘å¬å™¨ã€‚</p><p id="8948" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…è¿˜æ˜¯åœ¨<code class="eh lw lx ly lz b">MainActivity.kt</code>ç±»ã€‚åœ¨<code class="eh lw lx ly lz b">onCreate</code>æ–¹æ³•ä¸­ï¼Œç²˜è´´è¿™ä¸ª:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="15ae" class="me jx hu lz b fv mf mg l mh mi">simulateButton.setOnClickListener {<br/>    callServerToSimulate()<br/>}</span></pre><p id="d1d5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œè°ƒç”¨<code class="eh lw lx ly lz b">callServerToSimulate</code>å‡½æ•°ã€‚åƒè¿™æ ·åœ¨ç±»å†…åˆ›å»ºä¸€ä¸ªå‡½æ•°<code class="eh lw lx ly lz b">callServerToSimulate</code>:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="922a" class="me jx hu lz b fv mf mg l mh mi">private fun callServerToSimulate() {<br/>    val jsonObject = JSONObject()<br/>    jsonObject.put("latitude",defaultLatitude)<br/>    jsonObject.put("longitude",defaultLongitude)<br/>    val body = RequestBody.create(<br/>        MediaType.parse("application/json"), <br/>        jsonObject.toString()<br/>    )<br/>    getRetrofitObject().sendCoordinates(body).enqueue(object:Callback&lt;String&gt;{<br/>        override fun onResponse(call: Call&lt;String&gt;?, response: Response&lt;String&gt;?) {<br/>            Log.d("TAG",response!!.body().toString())<br/>        }<br/>        override fun onFailure(call: Call&lt;String&gt;?, t: Throwable?) {<br/>            Log.d("TAG",t!!.message)<br/>        }<br/>    })<br/>}</span></pre><p id="da2b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†åˆå§‹åæ ‡å‘é€åˆ°æœåŠ¡å™¨ã€‚ç„¶åï¼ŒæœåŠ¡å™¨ç”ŸæˆäºŒåä¸ªç±»ä¼¼äºæœ€åˆå‘é€çš„åæ ‡ï¼Œå¹¶ä½¿ç”¨Pusherå°†å®ƒä»¬å‘é€åˆ°é€šé“<code class="eh lw lx ly lz b">my-channel</code>ï¼Œè§¦å‘<code class="eh lw lx ly lz b">new-values</code>äº‹ä»¶ã€‚</p><p id="4156" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨åœ°å›¾çš„è§†å›¾IDåˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ª<code class="eh lw lx ly lz b">SupportMapFragment</code>å¯¹è±¡:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="1e22" class="me jx hu lz b fv mf mg l mh mi">val mapFragment = supportFragmentManager.findFragmentById(R.id.map)  as  SupportMapFragment<br/>mapFragment.getMapAsync(this)<br/>setupPusher()</span></pre><p id="e7af" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥å°†<code class="eh lw lx ly lz b">setupPusher</code>å‡½æ•°æ·»åŠ åˆ°è¯¥ç±»ä¸­ï¼Œå®ƒçœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="2f7e" class="me jx hu lz b fv mf mg l mh mi">private fun setupPusher() {<br/>    val options = PusherOptions()<br/>    options.setCluster(PUSHER_CLUSTER)<br/>    pusher = Pusher(PUSHER_API_KEY, options)</span><span id="1696" class="me jx hu lz b fv mj mg l mh mi">    val channel = pusher.subscribe("my-channel")</span><span id="218d" class="me jx hu lz b fv mj mg l mh mi">    channel.bind("new-values") { channelName, eventName, data -&gt;<br/>        val jsonObject = JSONObject(data)<br/>        val lat:Double = jsonObject.getString("latitude").toDouble()<br/>        val lon:Double =  jsonObject.getString("longitude").toDouble()<br/>        <br/>        runOnUiThread {<br/>            val newLatLng = LatLng(lat, lon)<br/>            marker.position = newLatLng<br/>            cameraPosition = CameraPosition.Builder()<br/>                    .target(newLatLng)<br/>                    .zoom(17f).build()<br/>            googleMap.animateCamera(CameraUpdateFactory.newCameraPosition(cameraPosition))<br/>        }<br/>    }<br/>}</span></pre><p id="ab02" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æˆ‘ä»¬åœ¨è¿™é‡Œåˆå§‹åŒ–Pusherå¹¶ç›‘å¬åæ ‡æ›´æ–°ã€‚å½“æˆ‘ä»¬æ¥æ”¶åˆ°ä»»ä½•æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„æ ‡è®°å¹¶å°†æ‘„åƒæœºè§†å›¾ç§»å‘æ–°çš„ç‚¹ã€‚æ‚¨éœ€è¦ç”¨Pusherä»ªè¡¨ç›˜ä¸Šçš„æŒ‰é”®å’Œè¯¦ç»†ä¿¡æ¯æ›¿æ¢Pusherå‚æ•°ã€‚</p><p id="b102" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç„¶åæˆ‘ä»¬åœ¨ç±»ä¸­åˆ†åˆ«è°ƒç”¨<code class="eh lw lx ly lz b">onPause</code>å’Œ<code class="eh lw lx ly lz b">onResume</code>å‡½æ•°ä¸­çš„disconnectå’Œconnectå‡½æ•°ã€‚è¿™äº›å‡½æ•°ç»§æ‰¿è‡ªçˆ¶ç±»<code class="eh lw lx ly lz b">AppCompatActivity</code>:</p><pre class="la lb lc ld fq ma lz mb mc aw md dt"><span id="4b3e" class="me jx hu lz b fv mf mg l mh mi">override fun onResume() {<br/>    super.onResume()<br/>    pusher.connect()<br/>}</span><span id="5d8b" class="me jx hu lz b fv mj mg l mh mi">override fun onPause() {<br/>    super.onPause()<br/>    pusher.disconnect()<br/>}</span></pre><h1 id="2d37" class="jw jx hu bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">ç»“è®º</h1><p id="25ae" class="pw-post-body-paragraph iu iv hu ix b iy ku ja jb jc kv je jf jt kw ji jj ju kx jm jn jv ky jq jr js hn dt translated">æˆ‘ä»¬å·²ç»èƒ½å¤Ÿåˆ©ç”¨Pusherã€Kotlinå’Œè°·æ­Œåœ°å›¾APIçš„åŠ›é‡æ¥åˆ›å»ºä¸€ä¸ªå®æ—¶ä½ç½®è·Ÿè¸ªåº”ç”¨ç¨‹åºã€‚å¸Œæœ›ä½ å·²ç»ä»æ•™ç¨‹ä¸­å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨è¿™äº›çŸ¥è¯†ç”¨Pusherå’ŒKotlinæ„å»ºæ¼‚äº®çš„å®æ—¶åº”ç”¨ç¨‹åºã€‚</p><p id="ab44" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™ç¯‡æ–‡ç« æœ€åˆå‡ºç°åœ¨<a class="ae lq" href="https://pusher.com/tutorials/realtime-map-kotlin" rel="noopener ugc nofollow" target="_blank">æ¨æ‰‹</a>çš„åšå®¢ä¸Šã€‚</p></div></div>    
</body>
</html>