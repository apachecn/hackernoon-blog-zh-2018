<html>
<head>
<title>Deploying Angular Universal v6+ with Firebase 🚀 🔥</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase部署Angular Universal v6+🚀 🔥</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploying-angular-universal-v6-with-firebase-c86381ddd445?source=collection_archive---------1-----------------------#2018-05-16">https://medium.com/hackernoon/deploying-angular-universal-v6-with-firebase-c86381ddd445?source=collection_archive---------1-----------------------#2018-05-16</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/88a9f18c5ad7cc45cbdf919dfc974ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3kwBUDwz922s5nXIqg1MyQ.png"/></div></div></figure><p id="5e10" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">免责声明:这篇博文将是一个有重点的分步指南，介绍如何使用<a class="ae ka" href="https://hackernoon.com/tagged/firebase" rel="noopener ugc nofollow" target="_blank"> Firebase </a>托管来部署<a class="ae ka" href="https://hackernoon.com/tagged/angular" rel="noopener ugc nofollow" target="_blank"> Angular </a> Universal App。对于任何关于Angular Universal和服务器端渲染的解释，Angular在他们的网站上有一个很棒的文档。</p><p id="9f52" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你也可以在<a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到源代码。</p><h1 id="7159" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">要求</h1><ul class=""><li id="c274" class="kz la hu je b jf lb jj lc jn ld jr le jv lf jz lg lh li lj dt translated">node.js(我在本教程中使用的是8.11.1版)</li><li id="d7f2" class="kz la hu je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">Angular 6+(我写过一篇<a class="ae ka" href="https://hackernoon.com/deploy-angular-universal-w-firebase-ad70ea2413a1" rel="noopener ugc nofollow" target="_blank">类似文章</a>部署Angular &lt; v6)</li></ul><h1 id="de19" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">第一部分:设置角应用🛠</h1><h2 id="f73b" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">1.安装全局依赖项</h2><p id="5a7d" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">我们将在命令行中使用<code class="eh mg mh mi mj b">@angular/cli</code>和<code class="eh mg mh mi mj b">firebase-tools</code>来构建和部署您的应用程序。</p><ul class=""><li id="744c" class="kz la hu je b jf jg jj jk jn mk jr ml jv mm jz lg lh li lj dt translated"><a class="ae ka" href="https://github.com/angular/angular-cli" rel="noopener ugc nofollow" target="_blank"> @angular/cli ≥ 6.0.0 </a></li><li id="4f24" class="kz la hu je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://github.com/firebase/firebase-tools" rel="noopener ugc nofollow" target="_blank">firebase-tools 3 . 18 . 4版</a></li></ul><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/768cd57fdecb31802f9ce4a779308a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQQd6UtXpwar-jbMF3pUEw.png"/></div></div></figure><h2 id="a7ba" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">2.创建新的角度项目</h2><p id="efc6" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">使用<code class="eh mg mh mi mj b">@angular/cli</code>，我们将创建一个新的<code class="eh mg mh mi mj b">angular</code>应用程序。既然这样，我就把它命名为<code class="eh mg mh mi mj b">angular-universal-firebase</code>。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/7c26e3b68993aa8616404deda4f8a732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j_KxtH4ILTaEA3xS9pasgA.png"/></div></div></figure><h2 id="18e1" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">3.安装@ angular/平台服务器</h2><p id="77e0" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">为了构建和呈现您的<code class="eh mg mh mi mj b">universal</code>应用程序，我们需要安装<code class="eh mg mh mi mj b">@angular/platform-server</code>。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/cbb278ced69feb07fb871aedb6967ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h42o8HmgtcHuWYsFiiL2xw.png"/></div></div></figure><h2 id="ca47" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">4.添加服务器端渲染配置</h2><p id="9509" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">在<code class="eh mg mh mi mj b">@angular/cli@v6.0.0+</code>中，<code class="eh mg mh mi mj b">.angular-cli.json</code>改为<code class="eh mg mh mi mj b">angular.json</code>。这定义了我们的项目是如何构建的，以及这个项目的构建配置。我们希望在<code class="eh mg mh mi mj b">projects.PROJECT_NAME.architect</code>路径中为项目添加一个<code class="eh mg mh mi mj b">server</code>配置。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/a457c35bd49d494b5dc0520955d525fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F2raurBHDWLm0GL8MH3c6w.png"/></div></div></figure><p id="fbd7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意，我们已经添加了<code class="eh mg mh mi mj b">server</code>，它为我们的应用程序的服务器端版本定义了<code class="eh mg mh mi mj b">builder</code>和<code class="eh mg mh mi mj b">options</code>配置。</p><h2 id="9294" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">5.将项目输出修改到Firebase文件夹</h2><p id="c45a" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">为了简单起见，我们将在与构建服务器版本相同的目录中构建我们应用程序的浏览器版本，以便在Firebase中进行服务器端渲染。为此，将<code class="eh mg mh mi mj b">angular.json</code>的<code class="eh mg mh mi mj b">PROJECT_NAME.architect.build.options.outputPath</code>编辑为<code class="eh mg mh mi mj b">functions/dist/browser</code>。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/af5bb92a2910fec5321911bf0782ead3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-BX1wk-Lih_o2sOD3lvUw.png"/></div></div></figure><h2 id="a8de" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">6.为应用服务器版本创建必要的文件</h2><ul class=""><li id="f8e2" class="kz la hu je b jf lb jj lc jn ld jr le jv lf jz lg lh li lj dt translated"><code class="eh mg mh mi mj b">src/app/app.server.module.ts</code></li></ul><p id="edab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为应用程序的服务器版本创建一个新模块。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/f6656b5eab8ea07d4fa53dc33b385de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sssoZiqn1PZ_uY2MsRm2qA.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek"><a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase/blob/master/src/app/app.server.module.ts" rel="noopener ugc nofollow" target="_blank">https://github.com/aaronte/angular-universal-firebase/blob/master/src/app/app.server.module.ts</a></figcaption></figure><ul class=""><li id="1aaa" class="kz la hu je b jf jg jj jk jn mk jr ml jv mm jz lg lh li lj dt translated"><code class="eh mg mh mi mj b">src/main-ssr.ts</code></li></ul><p id="4ccd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为<code class="eh mg mh mi mj b">server</code>模块创建入口点。这是我们在<code class="eh mg mh mi mj b">angular.json</code>的服务器配置中引用的<code class="eh mg mh mi mj b">main</code>文件。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/e0e4c73cfcebf5077de825183b39670b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QsROjkEt3ECkwGeaIc4ZA.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek"><a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase/blob/master/src/main-ssr.ts" rel="noopener ugc nofollow" target="_blank">https://github.com/aaronte/angular-universal-firebase/blob/master/src/main-ssr.ts</a></figcaption></figure><ul class=""><li id="a8c3" class="kz la hu je b jf jg jj jk jn mk jr ml jv mm jz lg lh li lj dt translated"><code class="eh mg mh mi mj b">src/tsconfig.app-ssr.json</code></li></ul><p id="fc19" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为服务器版本创建<code class="eh mg mh mi mj b">tsconfig</code>。类似于浏览器版本，除了<code class="eh mg mh mi mj b">angularCompilerOptions.entryModule</code>将引用我们刚刚创建的服务器版本的入口模块。这在<code class="eh mg mh mi mj b">angular.json</code>中也被称为<code class="eh mg mh mi mj b">tsConfig</code>。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/2e7eeb2965a16b6490c5de87ed6844a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bGt6c-3EKL1HVuT3zRwq3Q.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek"><a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase/blob/master/src/tsconfig.app-ssr.json" rel="noopener ugc nofollow" target="_blank">https://github.com/aaronte/angular-universal-firebase/blob/master/src/tsconfig.app-ssr.json</a></figcaption></figure><h2 id="6f2d" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">7.在应用程序的浏览器模块中包含服务器转换</h2><p id="a9fb" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">由于我们在浏览器版本之前将您的应用的服务器版本发送到浏览器，因此在<code class="eh mg mh mi mj b">imports</code>中添加<code class="eh mg mh mi mj b">BrowserModule</code>时，我们需要添加<code class="eh mg mh mi mj b">.withServerTransition({ appId })</code>。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/49ad0c89530038656d35010e86f98a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fh0_InrbVLJOeVVovpiXPg.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek"><a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase/blob/master/src/app/app.module.ts" rel="noopener ugc nofollow" target="_blank">https://github.com/aaronte/angular-universal-firebase/blob/master/src/app/app.module.ts</a></figcaption></figure><p id="7e47" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们已经准备好构建应用程序的服务器和浏览器版本了！</p><h2 id="bc28" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">8.构建应用程序的浏览器和服务器版本</h2><p id="acfe" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">使用<code class="eh mg mh mi mj b">@angular/cli</code>，我们将构建两个版本的应用程序。</p><ul class=""><li id="5e3f" class="kz la hu je b jf jg jj jk jn mk jr ml jv mm jz lg lh li lj dt translated"><code class="eh mg mh mi mj b">ng build --prod</code>:这将使用<code class="eh mg mh mi mj b">prod</code>配置构建应用程序的浏览器版本。</li><li id="7dae" class="kz la hu je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><code class="eh mg mh mi mj b">ng run PROJECT_NAME:server</code>:这将构建应用程序的服务器版本。它将生成一个<code class="eh mg mh mi mj b">ngFactory</code>文件，我们可以用它来使用<code class="eh mg mh mi mj b">node</code>渲染我们的应用程序。</li></ul><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/b7c39ab68b9ccbf25bc028b40d944022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IWR36g2rW1Qhy0MUu5U9AQ.png"/></div></div></figure><p id="247d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当两个构建都完成后，您现在应该在您的<code class="eh mg mh mi mj b">root</code>目录中有一个<code class="eh mg mh mi mj b">functions</code>文件夹，其中有<code class="eh mg mh mi mj b">browser</code>和<code class="eh mg mh mi mj b">server</code>文件夹。厉害！！！🎉</p></div><div class="ab cl mw mx hc my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="hn ho hp hq hr"><h1 id="c2db" class="kb kc hu bd kd ke nd kg kh ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky dt translated">第二部分:使用Firebase部署🚀</h1><p id="2a24" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">[1] <em class="ni">在继续之前，您应该已经创建了一个firebase项目</em> <a class="ae ka" href="https://console.firebase.google.com" rel="noopener ugc nofollow" target="_blank"> <em class="ni">这里</em> </a> <em class="ni">。我把这个例子命名为</em> <code class="eh mg mh mi mj b"><em class="ni">angular-universal-firebase</em></code> <em class="ni">。</em></p><h2 id="9081" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">1.在命令行中登录到`<code class="eh mg mh mi mj b">firebase</code>'</h2><p id="ddd0" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">在命令行中使用您在[1]中创建firebase项目时使用的google帐户登录firebase。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/4c1ac196b1593b6aeff0b7250af70bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*blDVXknJOCCp5CkISJqI-Q.png"/></div></div></figure><h2 id="6376" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">2.在“angular”项目中初始化Firebase</h2><p id="1d5a" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">通过命令行初始化firebase配置:</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/b90c9725b770786c420a0b6dbf3e2e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mDLf8fulFCwqtec3lBcxDA.png"/></div></div></figure><ul class=""><li id="91f5" class="kz la hu je b jf jg jj jk jn mk jr ml jv mm jz lg lh li lj dt translated">选择<code class="eh mg mh mi mj b">Functions</code>和<code class="eh mg mh mi mj b">Hosting</code>进行功能设置</li></ul><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nj"><img src="../Images/fc23e269309fc5cda499dae6ef5f369a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_qrlXTjrFwVTwANMdPZNyg.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">Firebase set up configuration (Functions and Hosting)</figcaption></figure><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nk"><img src="../Images/ed9b13b3ed3317febd06e606a57c01e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*768NuV6Uzy67QGpLmjCTSg.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">Javascript as Cloud function language for simplicity</figcaption></figure><ul class=""><li id="7ab0" class="kz la hu je b jf jg jj jk jn mk jr ml jv mm jz lg lh li lj dt translated">选择您在[1]中创建的firebase项目。(对我来说，是<code class="eh mg mh mi mj b">angular-universal-firebase</code>。</li></ul><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div class="ab fr cl nl"><img src="../Images/16eca37dbe7c38c772d7daf6f47635fe.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EwE87izZt7lyKihzJHrmVg.png"/></div></figure><ul class=""><li id="3890" class="kz la hu je b jf jg jj jk jn mk jr ml jv mm jz lg lh li lj dt translated">接受此阶段的所有默认值；我们将在后面的步骤中配置其余部分。(在本教程中，我们将在<code class="eh mg mh mi mj b">Javascript</code>中编写我们的函数)。</li></ul><h2 id="7047" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">3.将包依赖项添加到“函数”</h2><p id="687b" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">由于我们通过<code class="eh mg mh mi mj b">firebase-functions</code>使用节点服务器，我们需要在<code class="eh mg mh mi mj b">functions/package.json</code>中包含<code class="eh mg mh mi mj b">angular</code>依赖项来呈现应用程序的服务器版本。</p><p id="8986" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ni">先不说:目前，我不知道有什么方法可以减轻这种依赖声明的重复，因为据我所知，你不能在任何</em> <code class="eh mg mh mi mj b"><em class="ni">firebase-functions</em></code> <em class="ni"> javascript文件中访问</em> <code class="eh mg mh mi mj b"><em class="ni">functions</em></code> <em class="ni">目录之外的文件。但是如果你知道一个方法，请让我知道！</em></p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/c32d751b6b514c87f46df97bd07a4e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3UGO-cwJuo4G2yoVE0WIw.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek"><a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase/blob/master/functions/package.json" rel="noopener ugc nofollow" target="_blank">https://github.com/aaronte/angular-universal-firebase/blob/master/functions/package.json</a></figcaption></figure><h2 id="b7a4" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">4.在`<code class="eh mg mh mi mj b">functions</code>'目录下安装包</h2><p id="c548" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">安装da依赖项！</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/b603f5124be4801d9cba94293e41c900.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JHPxb7ZRsga9MgtYs8WlQ.png"/></div></div></figure><h2 id="37d9" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">5.创建Firebase函数以服务于应用程序</h2><p id="3bea" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">我们将使用<code class="eh mg mh mi mj b">functions.https.onRequest</code> Firebase函数类型从我们的express服务器发送响应。该文件中有许多内容，但最值得注意的是:</p><ul class=""><li id="01b8" class="kz la hu je b jf jg jj jk jn mk jr ml jv mm jz lg lh li lj dt translated">正在导入在<strong class="je hv">部分I:步骤8 —服务器版本</strong>中生成的<code class="eh mg mh mi mj b">AppServerModuleNgFactory</code>。</li><li id="027b" class="kz la hu je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">创建一个<code class="eh mg mh mi mj b">index</code>变量，该变量获取我们从<strong class="je hv">第一部分生成的<code class="eh mg mh mi mj b">index.html</code>文件:步骤8 —浏览器版本</strong>。</li><li id="302c" class="kz la hu je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">使用<code class="eh mg mh mi mj b">renderModuleFactory</code>生成一个<code class="eh mg mh mi mj b">html</code>文件，我们用<code class="eh mg mh mi mj b">url</code>和<code class="eh mg mh mi mj b">document</code>参数作为响应发送该文件。</li><li id="9fd3" class="kz la hu je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><code class="eh mg mh mi mj b">url</code>参数决定了app要渲染的路线。指定这一点允许<code class="eh mg mh mi mj b">renderModuleFactory</code>构建该路线的html。</li><li id="3887" class="kz la hu je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><code class="eh mg mh mi mj b">document</code>是应该用于呈现的页面的完整文档HTML。在这种情况下，它将是该应用程序的浏览器版本<code class="eh mg mh mi mj b">index.html</code>。</li></ul><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/888f21a2ad540555c29a032ffc2d2953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q2janUW9L8lQ1uHRC9ry3g.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek"><a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase/blob/master/functions/index.js" rel="noopener ugc nofollow" target="_blank">https://github.com/aaronte/angular-universal-firebase/blob/master/functions/index.js</a></figcaption></figure><h2 id="872a" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">7.配置Firebase托管</h2><p id="5ed0" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">现在我们已经构建了呈现页面的函数，我们需要更改firebase主机配置来使用这个函数。更改<code class="eh mg mh mi mj b">firebase.json</code>中的<code class="eh mg mh mi mj b">hosting.rewrites</code>。第一个条目是通过我们的公共文件夹发送静态文件(css和js)。第二个条目是将所有请求指向<code class="eh mg mh mi mj b">ssr</code>函数。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/9c249ee58a3dae559a849d223c241d8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ortAeT1mrRQlIvVfIlzZzg.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek"><a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase/blob/master/firebase.json" rel="noopener ugc nofollow" target="_blank">https://github.com/aaronte/angular-universal-firebase/blob/master/firebase.json</a></figcaption></figure><h2 id="6c16" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">8.将“功能/分布/浏览器”的所有内容复制到“公共”</h2><p id="eb8e" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">因为我们希望像普通应用程序一样运行我们的应用程序，所以我们希望将构建浏览器平台所生成的所有文件放在public文件夹中。这意味着functions/dist/browser中的html、js、css等都应该出现在public文件夹中。注意:但是，我们必须将<code class="eh mg mh mi mj b">index.html</code>的名称改为<code class="eh mg mh mi mj b">index2.html</code>，因为如果firebase在<code class="eh mg mh mi mj b">public</code>文件夹中找到<code class="eh mg mh mi mj b">index.html</code>，它将不会运行<code class="eh mg mh mi mj b">ssr</code>函数。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/2985d03fb1c8e4c9583a13e61e70d197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UvDgvBF0D011vZt4ym4rTw.png"/></div></div></figure><h2 id="772d" class="lp kc hu bd kd lq lr ls kh lt lu lv kl jn lw lx kp jr ly lz kt jv ma mb kx mc dt translated">9.部署到火力基地🚀 🔥</h2><p id="be1d" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">如果一切顺利，您应该能够将您的应用程序部署到Firebase:</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/4c0449ec4bc71d277c0b909963e451df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GKavH_f9G51h22mTL9AXQ.png"/></div></div></figure></div><div class="ab cl mw mx hc my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="hn ho hp hq hr"><h1 id="fedd" class="kb kc hu bd kd ke nd kg kh ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky dt translated">就是这样！👍</h1><p id="0b6d" class="pw-post-body-paragraph jc jd hu je b jf lb jh ji jj lc jl jm jn md jp jq jr me jt ju jv mf jx jy jz hn dt translated">你可以在<a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase" rel="noopener ugc nofollow" target="_blank"> Github </a>上查看源代码。</p><p id="681d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我希望这篇教程在某些方面有所帮助！如果您有任何反馈或问题，请将它们添加到<a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase/issues" rel="noopener ugc nofollow" target="_blank"> Github问题</a>中，以确保每个查看代码的人都会受益。😄</p><p id="38bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">编码快乐！😃</p><figure class="mo mp mq mr fq iv"><div class="bz el l di"><div class="nm nn l"/></div></figure></div></div>    
</body>
</html>