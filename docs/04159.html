<html>
<head>
<title>Building a better file uploader for the web</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为web构建更好的文件上传程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/building-a-better-file-uploader-for-the-web-2fe97bfbb2d5?source=collection_archive---------5-----------------------#2018-05-16">https://medium.com/hackernoon/building-a-better-file-uploader-for-the-web-2fe97bfbb2d5?source=collection_archive---------5-----------------------#2018-05-16</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/676860846b5a05f920d7d7b0c97fc0da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G3idPwbQsKfS9uhknQ5QbQ.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="1a68" class="pw-subtitle-paragraph jc ie if bd b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ek translated">介绍Uppload，一个JavaScript上传小部件</h2></div><p id="0565" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">input元素是在1993年7月的第一个HTML+讨论文档中引入的，用于在web上的表单中输入数据。Dave Raggett在1997年1月发布的标志性的<a class="ae kq" href="https://www.w3.org/TR/2018/SPSD-html32-20180315/#input" rel="noopener ugc nofollow" target="_blank"> HTML 3.2参考规范</a>包含了来自施乐科学家Larry Masinter和Ernesto Nebel撰写的1995年备忘录<a class="ae kq" href="https://www.ietf.org/rfc/rfc1867.txt" rel="noopener ugc nofollow" target="_blank"> RFC1867 </a>的<code class="eh kr ks kt ku b">&lt;input type=file&gt;</code>，其中描述了带有文件提交的HTML表单:</p><blockquote class="kv kw kx"><p id="b249" class="ju jv ky jw b jx jy jg jz ka kb jj kc kz ke kf kg la ki kj kk lb km kn ko kp hn dt translated">目前，HTML表单允许表单的生产者向阅读表单的用户请求信息。这些表单已被证明在需要用户输入的各种应用程序中非常有用。然而，这种能力是有限的，因为HTML表单不提供要求用户提交数据文件的方法。需要从用户那里获取文件的服务提供商不得不实现定制的用户应用程序。</p></blockquote><p id="0f81" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">MIME类型<code class="eh kr ks kt ku b">multipart/form-data</code>和<code class="eh kr ks kt ku b">accept</code>属性——我们今天仍在使用它们来上传文件——都在20多年前的同一篇论文中有所描述。原生文件上传非常优雅，非常容易使用。我们都习惯了下面的语法:</p><pre class="lc ld le lf fq lg ku lh li aw lj dt"><span id="97e1" class="lk ll if ku b fv lm ln l lo lp">&lt;form method="post" enctype="multipart/form-data"&gt;<br/>    &lt;input type="file" accept="image/png" name="myFile"&gt;<br/>    &lt;button type="submit"&gt;Upload&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;?php<br/>    if (isset($_POST["myFile"]) {<br/>        move_uploaded_file($_FILES["myFile"]["tmp_name"], "./file");<br/>    }<br/>?&gt;</span></pre><p id="351f" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">然而今天，我们有了带有<code class="eh kr ks kt ku b">FileReader</code>、<code class="eh kr ks kt ku b">FileList</code>、<code class="eh kr ks kt ku b">Blob</code>等的<a class="ae kq" href="https://developer.mozilla.org/en-US/docs/Web/API/File" rel="noopener ugc nofollow" target="_blank">文件API </a>，这使得在客户端操作文件并将其上传到服务器变得非常容易。</p><p id="4260" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">并非每个浏览器都支持它们，但当你将它与新功能结合起来时，如让你在浏览器中拖放文件的<code class="eh kr ks kt ku b"><a class="ae kq" href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer" rel="noopener ugc nofollow" target="_blank">DataTransfer</a></code>和让你访问用户的摄像头和麦克风的<code class="eh kr ks kt ku b"><a class="ae kq" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream" rel="noopener ugc nofollow" target="_blank">MediaStream</a></code>，我们可以创造出非凡的用户体验。</p><p id="9a83" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">问题是构建定制的文件上传组件既困难又耗时，尤其是当您考虑维护不支持这些新API的浏览器的兼容性时。</p><h1 id="4117" class="lq ll if bd lr ls lt lu lv lw lx ly lz jl ma jm mb jo mc jp md jr me js mf mg dt translated">当前的景观</h1><div class="lc ld le lf fq ab cb"><figure class="mh hw mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><img src="../Images/65d31ad2e5019258d0b5946b3dcadba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*f25B1A8aZjinAfRucZu8EA.png"/></div></figure><figure class="mh hw mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><img src="../Images/2d483b2dc9df69c9e3d0b85b9e4e1e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*GdNqWq6V2HLCf1zXd8CJyg.png"/></div></figure><figure class="mh hw mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><img src="../Images/e92b60740002097de32bf94f93201de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*FNBi7iT2hIjV-o-f82UyeQ.png"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek mr di ms mt">Left to right: The file uploading widget of Filestack, Uploadcare, and Cloudinary</figcaption></figure></div><p id="a582" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">有许多服务提供文件上传小工具，但他们都进入了文件存储和内容交付的业务。</p><p id="0ca9" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">例如，Uploadcare可以让你免费上传高达500 MB的文件，他们的下一个计划是每月25美元的7.5 GB存储空间。相比之下，谷歌的Firebase免费提供5GB的存储空间，然后每GB 0.026美元，结果是便宜了128倍以上。亚马逊网络服务的S3存储稍微贵一点，为0.0390美元/GB，但仍然便宜85倍以上。</p><p id="7052" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">Cloudinary给你10GB的免费存储空间，这相对来说更好，直到你意识到他们的下一个计划每月收费99美元。Filestack还免费提供半g的流量，25 GB的流量开始收取49美元/月的费用。</p><h1 id="e649" class="lq ll if bd lr ls lt lu lv lw lx ly lz jl ma jm mb jo mc jp md jr me js mf mg dt translated">解决方案</h1><h2 id="2f4c" class="lk ll if bd lr mu mv mw lv mx my mz lz kd na nb mb kh nc nd md kl ne nf mf ng dt translated">一个开源文件上传小工具…</h2><p id="2088" class="pw-post-body-paragraph ju jv if jw b jx nh jg jz ka ni jj kc kd nj kf kg kh nk kj kk kl nl kn ko kp hn dt translated">Cloudinary、Filestack和其他公司提供了他们自己专有的JavaScript小部件——这可能对商业有益，但没有促进社区贡献，因此缺乏并感觉过时。Cloudinary看起来特别像是为Web 2.0时代而生的。我们想要的是一个麻省理工学院许可的，完全免费和开源的解决方案，鼓励扩展。</p><h2 id="13e3" class="lk ll if bd lr mu mv mw lv mx my mz lz kd na nb mb kh nc nd md kl ne nf mf ng dt translated">…适用于任何后端…</h2><p id="fab3" class="pw-post-body-paragraph ju jv if jw b jx nh jg jz ka ni jj kc kd nj kf kg kh nk kj kk kl nl kn ko kp hn dt translated">Uploadcare确实在BSD 2条款许可下开源了他们的小部件，但它只适用于他们的后端服务。它调用他们的API，将<code class="eh kr ks kt ku b">&lt;iframe&gt;</code>用于Instagram和Import from URL等服务，并且只允许你上传到你的Uploadcare帐户(你可以在premium计划中连接外部存储。)我们想要的是一个完全后端不可知的小部件；它应该可以与任何可以处理HTML表单上传的服务器一起工作，应该可以让你上传到任何第三方托管服务，如S3或Firebase。</p><h2 id="c109" class="lk ll if bd lr mu mv mw lv mx my mz lz kd na nb mb kh nc nd md kl ne nf mf ng dt translated">…并允许模块化服务…</h2><p id="5562" class="pw-post-body-paragraph ju jv if jw b jx nh jg jz ka ni jj kc kd nj kf kg kh nk kj kk kl nl kn ko kp hn dt translated">这三个小部件都支持拖放上传和从URL导入。Uploadcare是唯一一个支持点击用户网络摄像头中的图片的软件(这对于快速获取个人资料图片非常方便，尤其是在移动设备上)，其他软件集成了谷歌图片搜索，让你可以找到图片。我不能评论上传未经许可的照片的合法性，但知道它的存在是很有趣的。</p><p id="2e45" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">这些服务非常方便，但是当必须添加新功能时，需要不断更新和更大的包大小:</p><blockquote class="kv kw kx"><p id="c407" class="ju jv ky jw b jx jy jg jz ka kb jj kc kz ke kf kg la ki kj kk lb km kn ko kp hn dt translated">你不能跑来跑去给这些东西加个按钮。它们已经装船了。那你是做什么的？—史蒂夫·乔布斯，2007年iPhone发布会</p></blockquote><p id="6303" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">我们想要的是一种完全模块化的方法，允许开发人员基于他们感兴趣添加的服务创建自己的捆绑包，并在从CDN提供资产时动态加载这些服务。这将为webapps创建较小的包大小—选中拖放、相机和裁剪，您的包就创建好了。同样，当使用CDN时，只有使用网络摄像头或裁剪图像或从Instagram导入的用户才需要加载这些服务的代码。</p><p id="5e56" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">这也有助于开发人员非常容易地构建自己的服务和模块，以扩展小部件的功能范围。想要集成Google相册或YouTube视频的开发人员可以非常容易地编写一个模块，并通过上传程序动态加载它。它只是工作。</p><h2 id="0a53" class="lk ll if bd lr mu mv mw lv mx my mz lz kd na nb mb kh nc nd md kl ne nf mf ng dt translated">…优雅地降级</h2><p id="fd88" class="pw-post-body-paragraph ju jv if jw b jx nh jg jz ka ni jj kc kd nj kf kg kh nk kj kk kl nl kn ko kp hn dt translated">新的文件API带来了出色的UX——文件预览、拖放以及简单的Blob和数据URI操作。不幸的是，旧浏览器(5年前发布的)甚至不支持polyfills。这并不意味着小部件应该停止工作，而是应该退回到一个简单的HTML文件输入。</p><blockquote class="kv kw kx"><p id="20d2" class="ju jv ky jw b jx jy jg jz ka kb jj kc kz ke kf kg la ki kj kk lb km kn ko kp hn dt translated">在旧的浏览器中没有解决拖放问题的方法——它根本不被支持。图像预览也是如此。使用旧浏览器的用户仍然可以上传文件。只是看起来和感觉都不会很棒。但是，嘿，那是他们的错。——马蒂亚斯·梅诺代表Dropzone</p></blockquote><p id="d763" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">对于大多数用户来说，我们的小部件开箱后应该工作得很好，但是对于其他人来说也应该足够好。它绝对不应该对任何人都不起作用。</p><h1 id="9250" class="lq ll if bd lr ls lt lu lv lw lx ly lz jl ma jm mb jo mc jp md jr me js mf mg dt translated">向上传者问好</h1><p id="a809" class="pw-post-body-paragraph ju jv if jw b jx nh jg jz ka ni jj kc kd nj kf kg kh nk kj kk kl nl kn ko kp hn dt translated">Uppload是免费的、开源的、模块化的，可以与任何后端一起工作，并且是跨平台的。它适用于手机、台式机，甚至是11。它与常规的HTML文件上传后端一起工作，不需要额外的配置，并且具有内置的可扩展性支持，使得使用Firebase、S3和其他服务变得轻而易举。它是不依赖的，还带有Vue.js和React的包装器。</p><p id="5011" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">我们有一个<a class="ae kq" href="https://github.com/elninotech/uppload" rel="noopener ugc nofollow" target="_blank">任务列表</a>，我们目前正在工作，包括一个真正的模块化构建系统，增加浏览器支持和测试覆盖，更小的包，更多的模块，甚至更多的包装器。</p><figure class="lc ld le lf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nm"><img src="../Images/6d3b0340f0f9e098d661035efe7c0177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*votE6xIDQze--_kueFpr_w.gif"/></div></div></figure><h1 id="0992" class="lq ll if bd lr ls lt lu lv lw lx ly lz jl ma jm mb jo mc jp md jr me js mf mg dt translated"><a class="ae kq" href="https://elninotech.github.io/uppload/" rel="noopener ugc nofollow" target="_blank">📷尝试上传➡ </a> <a class="ae kq" href="https://github.com/elninotech/uppload" rel="noopener ugc nofollow" target="_blank"> GitHub </a> <a class="ae kq" href="https://www.npmjs.com/package/uppload" rel="noopener ugc nofollow" target="_blank"> NPM </a></h1><figure class="lc ld le lf fq hw fe ff paragraph-image"><div class="fe ff nn"><img src="../Images/2b20c3ea5fda73a9bc93acc02aaadcda.png" data-original-src="https://miro.medium.com/v2/resize:fit:140/format:webp/1*sFzVW5ixA1tlz582UzzB8A.png"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">By Michael. Uppload is an open-source file uploader with a hamster as a logo 🐹</figcaption></figure></div></div>    
</body>
</html>