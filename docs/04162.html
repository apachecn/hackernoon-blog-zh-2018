<html>
<head>
<title>What Are Hashed Timelock Contracts (HTLCs)? Application In Lightning Network &amp; Payment Channels</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是散列时间锁契约(HTLCs)？在闪电网络和支付渠道中的应用</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/what-are-hashed-timelock-contracts-htlcs-application-in-lightning-network-payment-channels-14437eeb9345?source=collection_archive---------8-----------------------#2018-05-16">https://medium.com/hackernoon/what-are-hashed-timelock-contracts-htlcs-application-in-lightning-network-payment-channels-14437eeb9345?source=collection_archive---------8-----------------------#2018-05-16</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/99dd52c3925cc97845775f127c0d35af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2V3YgRUXUj2yHs2M6Ej7Q.jpeg"/></div></div></figure><p id="72b4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://www.youtube.com/watch?v=UUstHqIp2XA" rel="noopener ugc nofollow" target="_blank">视频版本</a></p><p id="2d7f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">来自<a class="ae ka" href="https://en.bitcoin.it/wiki/Hashed_Timelock_Contracts" rel="noopener ugc nofollow" target="_blank">比特币维基</a>的定义:</p><blockquote class="kb kc kd"><p id="eabd" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated"><strong class="je hv">散列时间锁合同</strong>或<strong class="je hv"> HTLC </strong>是一类支付，它使用<a class="ae ka" href="https://en.bitcoin.it/wiki/Hashlock" rel="noopener ugc nofollow" target="_blank">散列锁</a>和<a class="ae ka" href="https://en.bitcoin.it/wiki/Timelock" rel="noopener ugc nofollow" target="_blank">时间锁</a>来要求收款人要么通过生成支付的加密证明来确认在截止日期之前收到支付，要么放弃要求支付的能力，将其返回给付款人。<a class="ae ka" href="https://en.bitcoin.it/wiki/Hashed_Timelock_Contracts#cite_note-russell_htlc-1" rel="noopener ugc nofollow" target="_blank">【1】</a></p><p id="2b88" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">然后，接收者生成的加密支付证明可用于触发其他支付中的其他操作，使HTLCs成为以比特币进行有条件支付的强大技术。</p></blockquote><h1 id="f929" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated"><a class="ae ka" href="https://en.bitcoin.it/wiki/Payment_channels" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">中的HTLCs支付渠道</strong> </a> <strong class="ak"> </strong>:</h1><p id="6319" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">HTLCs允许支付在<strong class="je hv">多个</strong>支付渠道之间安全地路由，这一点非常重要，因为对于一个人来说，与他/她正在交易的每个人打开一个支付渠道并不是最优的<strong class="je hv"/>。</p><p id="1df1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">HTLCs是更高级支付渠道设计的组成部分，如<a class="ae ka" href="https://en.bitcoin.it/wiki/Lightning_Network" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">闪电网络</strong> </a>所使用的支付渠道。</p><p id="aebb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如:<br/> <strong class="je hv">如果Alice有一个对Bob开放的通道，Bob有一个对Charlie开放的通道，Alice可以使用一个HTLC通过Bob向Charlie付款，而没有Bob在传输中窃取付款的任何风险</strong>。</p><p id="36ed" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们一步一步地了解交易将如何展开(<strong class="je hv">注意，在本例中，我们不讨论HTLCs的时间锁方面</strong>):</p><h2 id="dcfc" class="ll kj hu bd kk lm ln lo ko lp lq lr ks jn ls lt kw jr lu lv la jv lw lx le ly dt translated">第一步:</h2><p id="7ea9" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">1.爱丽丝想用1000 satoshis从查理那里买东西。</p><p id="ea51" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.爱丽丝为鲍勃打开一个支付通道，鲍勃为查理打开一个支付通道</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/e2ead50049c01f9cea28ec346fc0c43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*9rgdUV0Pln-ujdkCjl5rbQ.png"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">STEP 1</figcaption></figure><h2 id="1661" class="ll kj hu bd kk lm ln lo ko lp lq lr ks jn ls lt kw jr lu lv la jv lw lx le ly dt translated">第二步:</h2><p id="e48f" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">Charlie生成一个随机数(x)并生成它的sha 256 hash-h(x)。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/ec51e938d5c367020b197c19e9698911.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*p8aGlV6zbRaaKs0XVacsPQ.png"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">STEP 2</figcaption></figure><h2 id="eb11" class="ll kj hu bd kk lm ln lo ko lp lq lr ks jn ls lt kw jr lu lv la jv lw lx le ly dt translated">第三步:</h2><p id="557f" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">Charlie将生成的哈希交给Alice。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff mj"><img src="../Images/0b644a5509046c915934331d433ce004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*MpFR4ZSS10oBi875oWdXoQ.png"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">STEP 3</figcaption></figure><h2 id="13cc" class="ll kj hu bd kk lm ln lo ko lp lq lr ks jn ls lt kw jr lu lv la jv lw lx le ly dt translated">第四步:</h2><p id="7f65" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">Alice使用她的支付渠道向Bob支付1，000 satoshis，但是她将Charlie给她的散列添加到付款中，并且附加了一个附加条件:为了让Bob要求付款，他必须提供用于产生该散列的数据。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/36eee76847aaaba87385611f1685ec1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*U_RJ4BlyPd519sQ-qJ-Qzg.png"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">STEP 4</figcaption></figure><h2 id="5d00" class="ll kj hu bd kk lm ln lo ko lp lq lr ks jn ls lt kw jr lu lv la jv lw lx le ly dt translated">第五步:</h2><p id="8edd" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">Bob使用他给Charlie的支付渠道向Charlie支付1，000 satoshis，Bob添加了一份与Alice给Bob的付款相同的条件。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/c7aa0160ed5fd8b6ff3ec65fb8b0e3a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*AHAM7oShv-i_nUrrIkd1LA.png"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">STEP 5</figcaption></figure><p id="c24e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">最后:</strong></p><h2 id="095f" class="ll kj hu bd kk lm ln lo ko lp lq lr ks jn ls lt kw jr lu lv la jv lw lx le ly dt translated">第六步:</h2><p id="2938" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">B →C(步骤5中的交易通过)</p><p id="9447" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Charlie拥有用于生成哈希的原始数据(称为前映像)，因此Charlie可以使用它来完成付款，并从Bob处完全收到付款。通过这样做，Charlie必然使Bob可以获得前映像。</p><h2 id="da31" class="ll kj hu bd kk lm ln lo ko lp lq lr ks jn ls lt kw jr lu lv la jv lw lx le ly dt translated">第七步:</h2><p id="7782" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">A→B(步骤4中的交易通过)</p><p id="b788" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Bob使用该预映像来完成Alice给他的付款</p><p id="c440" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在上面的例子中，我们讨论了一个特殊的例子，在这个例子中，我们有一个中间人(Bob ),让我们的付款到达目的地。<br/>这种方法可以扩展，这样我们就可以跳过一个以上的媒介，这对公共/大众使用是必不可少的。</p><h2 id="cdd3" class="ll kj hu bd kk lm ln lo ko lp lq lr ks jn ls lt kw jr lu lv la jv lw lx le ly dt translated">旁注:</h2><p id="e1cb" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">理想的加密哈希函数有五个主要属性:</p><ul class=""><li id="d4ef" class="mm mn hu je b jf jg jj jk jn mo jr mp jv mq jz mr ms mt mu dt translated">它是<a class="ae ka" href="https://en.wikipedia.org/wiki/Deterministic_algorithm" rel="noopener ugc nofollow" target="_blank">确定性的</a>，所以相同的消息总是产生相同的散列</li><li id="914b" class="mm mn hu je b jf mv jj mw jn mx jr my jv mz jz mr ms mt mu dt translated">计算任何给定消息的哈希值都很快</li><li id="b772" class="mm mn hu je b jf mv jj mw jn mx jr my jv mz jz mr ms mt mu dt translated">除非尝试所有可能的消息，否则从消息的哈希值生成消息是不可行的</li><li id="c8aa" class="mm mn hu je b jf mv jj mw jn mx jr my jv mz jz mr ms mt mu dt translated">对消息的一个小的改变会导致哈希值的大范围改变，以至于新的哈希值看起来与旧的哈希值不相关</li><li id="dadb" class="mm mn hu je b jf mv jj mw jn mx jr my jv mz jz mr ms mt mu dt translated">找到两个具有相同散列值的不同消息是不可行的</li></ul></div></div>    
</body>
</html>