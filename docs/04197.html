<html>
<head>
<title>Feedback &amp; Odometry: Coursera’s Control of Mobile Robots with ROS and ROSbots — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反馈和里程计:Coursera用ROS和ROSbots控制移动机器人——第三部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/feedback-odometry-courseras-control-of-mobile-robots-with-ros-and-rosbots-part-3-e9d8e4df6df1?source=collection_archive---------6-----------------------#2018-05-17">https://medium.com/hackernoon/feedback-odometry-courseras-control-of-mobile-robots-with-ros-and-rosbots-part-3-e9d8e4df6df1?source=collection_archive---------6-----------------------#2018-05-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1af7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">欢迎来到我们的多部分<a class="ae jp" href="https://www.coursera.org/learn/mobile-robot" rel="noopener ugc nofollow" target="_blank"> Coursera的移动机器人控制</a> (CMR)系列的第3部分。这个系列用<a class="ae jp" href="http://www.ros.org" rel="noopener ugc nofollow" target="_blank"> ROS </a>和<a class="ae jp" href="http://www.rosbots.com" rel="noopener ugc nofollow" target="_blank"> ROSbots机器人</a>实现了从CMR学到的概念。</p><h2 id="2058" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">关于ROSbots</h2><p id="b9e3" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">ROSbots是一个<a class="ae jp" href="https://www.rosbots.com/purchase" rel="noopener ugc nofollow" target="_blank">面向制造者的ROS + OpenCV机器人套件</a>。基于Raspberry Pi和Arduino兼容的UNO板，ROSbots机器人套件迎合了制造商的愿望，非常容易实现你遇到的任何新的机器人概念。我们所有的代码都在Github 上<a class="ae jp" href="https://github.com/rosbots" rel="noopener ugc nofollow" target="_blank">开源。</a></p><h2 id="3beb" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">第2部分前情提要，第3部分有什么</h2><p id="4f85" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">回到我们的移动机器人控制系列的<a class="ae jp" rel="noopener" href="/@rosbots/unicycle-to-differential-drive-courseras-control-of-mobile-robots-with-ros-and-rosbots-part-2-6d27d15f2010">第2部分，我们写了使用独轮车模型直观地表示机器人动力学的便利性。但是由于我们的ROSbots机器人是差动驱动机器人，所以我们需要讨论独轮车模型如何与差动驱动模型动力学相关联。然后，我们遍历ROS代码，通过远程控制(RC)以系统的方式“驱动”我们的ROSbots机器人。</a></p><p id="3d6a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第3部分中，我们将利用差分驱动动力学来:</p><ol class=""><li id="37f4" class="kq kr hu it b iu iv iy iz jc ks jg kt jk ku jo kv kw kx ky dt translated">引入反馈的概念</li><li id="3082" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">描述我们的ROSbots车轮编码器传感器如何工作，以及</li><li id="099d" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">使用反馈和编码器读数，定义计算机器人姿态(位置和方向)所需的方程。</li></ol><p id="7664" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="le">免责声明</em>:在这篇文章中，我们实际上不会展示任何ROS代码，而会坚持谈论反馈和里程计背后的方程和概念。但是这为下一篇有ROS代码的文章做好了准备——保证！！</p><figure class="lg lh li lj fq lk fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff lf"><img src="../Images/dc2bc632109a250bfedd85b766c41bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EUZYW-RqaZlD5VvN_WuUVw.jpeg"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">ROSbots’ wheel encoders used for odometry</figcaption></figure><h2 id="22df" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">反馈需求</h2><p id="9793" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">即使我们成功地向机器人发送了驱动命令，我们也不能保证机器人已经执行了命令。数据包可能已经丢失。沉重的负载可能会使发动机熄火。</p><p id="2adf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了知道我们的机器人是否真的移动了，我们需要传感器传回一些信息。我们需要反馈。</p><p id="fc05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一般来说，我们在反馈系统中定义了几个组件:</p><ol class=""><li id="c9f1" class="kq kr hu it b iu iv iy iz jc ks jg kt jk ku jo kv kw kx ky dt translated">r → a <em class="le">参考</em>我们希望达到的目标(即我们希望达到的目标、我们希望跟踪的速度、我们希望遵循的路线)。</li><li id="63d4" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">u → r转化为一系列的<em class="le">输入</em>命令，我们想给我们的机器人，以帮助我们实现，跟踪r。</li><li id="228c" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">x →这是我们当前的<em class="le">状态</em>。我们的输入u通过一组称为动力学的规则影响状态，或者系统如何随时间演变。</li><li id="2d03" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">y →这是我们对当前状态的衡量。很多时候，实际上不可能直接观察到状态x。但是我们可以制造传感器来测量它。</li></ol><figure class="lg lh li lj fq lk fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/037e3b70ed98c60317f8bf1a65096760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*n7AUdMTxGtPtPNKW7H0lXA.png"/></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Credit: Magnus Egerstedt, Control of Mobile Robots, Georgia Ins&lt;tute of Technology</figcaption></figure><p id="9239" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">测量值y被反馈到系统的起点，以帮助我们调整输入值u。没有y和反馈过程，我们无法知道我们是否在跟踪我们的参考值，从而阻止我们实施有效、稳定的控制器来控制我们的机器人。</p><h2 id="456f" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">里程计</h2><p id="109a" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">与Coursera球场上使用的<a class="ae jp" href="http://gritslab.gatech.edu/Pickem/quickbot-a-robot-built-in-an-afternoon.html" rel="noopener ugc nofollow" target="_blank"> Quickbot机器人</a>和<a class="ae jp" href="https://en.wikipedia.org/wiki/Khepera_mobile_robot" rel="noopener ugc nofollow" target="_blank"> Khepera机器人</a>一样，我们的ROSbots机器人配备了测量车轮转速的车轮编码器。</p><p id="e8bc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的ROSbots机器人的编码器盘上的凹口干扰了速度传感器上U形臂顶端的灯开关。</p><figure class="lg lh li lj fq lk"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="1730" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当轮子转动时，凹口在阻挡和打开灯开关之间交替——即“滴答”。通过计算“滴答”的次数，你可以确定轮子旋转了多少。</p><p id="471b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过使用编码器，我们可以更新我们的机器人<a class="ae jp" href="https://en.wikipedia.org/wiki/Odometry" rel="noopener ugc nofollow" target="_blank">里程计</a>——它被定义为使用运动传感数据来更新机器人姿势，或者我们机器人的位置和方向。</p><p id="4001" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回忆由以下定义的姿势:</p><pre class="lg lh li lj fq ly lz ma mb aw mc dt"><span id="dae4" class="jq jr hu lz b fv md me l mf mg">x - position on the x-axis (ie in meters)</span><span id="9576" class="jq jr hu lz b fv mh me l mf mg">y - position on the y-axis (ie in meters)</span><span id="3ee4" class="jq jr hu lz b fv mh me l mf mg">φ - phi - angle of the unicycle counter clockwise from x-axis (ie in radians)</span></pre><p id="1744" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的独轮车模型的位置和角速度由下式定义:</p><pre class="lg lh li lj fq ly lz ma mb aw mc dt"><span id="c36a" class="jq jr hu lz b fv md me l mf mg">v - directional velocity</span><span id="32f4" class="jq jr hu lz b fv mh me l mf mg">w - angular velocity</span></pre><figure class="lg lh li lj fq lk fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/68e21f11947be3c655263cdd43114aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*lyaUl9ep-sWxUxUCG-kB2Q.png"/></div></figure><p id="337b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了更新里程计，我们需要使用几个等式来帮助我们根据差动驱动机器人的每个左右轮行驶的距离计算我们的位置和方向的变化。</p><h2 id="955d" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">每个轮子旋转了多远？</h2><p id="e5ca" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">第一个等式使用我们的编码器刻度来计算左右轮转动了多远，以米为单位</p><pre class="lg lh li lj fq ly lz ma mb aw mc dt"><span id="bc46" class="jq jr hu lz b fv md me l mf mg">D_left = 2 * pi * R * (nTicksLeft / nTotalTicks)<br/>D_right = 2 * pi * R * (nTicksRight / nTotalTicks)</span></pre><ol class=""><li id="19c0" class="kq kr hu it b iu iv iy iz jc ks jg kt jk ku jo kv kw kx ky dt translated">R →车轮的半径(米)</li><li id="9497" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">nTicksLeft/Right →我们采样的刻度数，比如说，每秒(以1 /秒为单位)。</li><li id="eef3" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">nTotalTicks →编码器盘每转的总刻度数</li></ol><p id="9b26" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为R的单位是米，所以ntickslew/Right的单位是1/秒，那么D_left和D_right的单位都是米/秒。</p><h2 id="d61e" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">我们的机器人的方向和角速度是多少？</h2><p id="fc42" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">使用D_left和D_right，我们可以计算用于表示独轮机器人动力学的方向和角速度——分别为v和w。</p><pre class="lg lh li lj fq ly lz ma mb aw mc dt"><span id="ac60" class="jq jr hu lz b fv md me l mf mg">v = (D_right + D_left) / 2.0 (ie. in meters per second)<br/>w = (D_right - D_left) / L (ie. in radians per second)</span></pre><p id="3970" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回想一下，L →我们机器人的轴距(即每弧度米数)</p><p id="9b48" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为在我们的例子中，我们每秒对编码器刻度采样一次，所以D_right和D_left都以米/秒为单位，所以v也以米/秒为单位。</p><p id="19e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为L的单位是米/弧度，所以w的单位是弧度/秒。</p><h2 id="5dd6" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">我们机器人的新姿势是什么？</h2><p id="57f7" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">对于独轮模型，姿势的变化定义如下:</p><pre class="lg lh li lj fq ly lz ma mb aw mc dt"><span id="b8a0" class="jq jr hu lz b fv md me l mf mg">dx/dt = v * cos(φ)<br/>dy/dt = v * sin(φ)<br/>dφ/dt = w</span></pre><p id="96d4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的例子中，dt是1秒——编码器滴答的采样速率。有了上一节中计算的v和w，我们就可以确定机器人在某个δT后的新姿态:</p><pre class="lg lh li lj fq ly lz ma mb aw mc dt"><span id="c3ea" class="jq jr hu lz b fv md me l mf mg">x' = x + (dx/dt * delta_t)<br/>y' = y + (dy/dt * delta_t)<br/>φ' = φ + (dφ/dt * delta_t)</span></pre><p id="369a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果delta_t = 1秒，那么x '、y '和φ'将代表我们的机器人在1秒后的新姿态。</p><h2 id="1bfe" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">结论</h2><p id="979a" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">在第3部分中，我们讨论了:</p><ol class=""><li id="f2fd" class="kq kr hu it b iu iv iy iz jc ks jg kt jk ku jo kv kw kx ky dt translated">控制系统中的反馈需求——特别是我们用来计算ROSbots差动驱动机器人姿态的系统。</li><li id="bfcc" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">如何使用速度编码器来测量差动驱动机器人的运动。</li><li id="5e88" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">概述了独轮车模型机器人的动力学。</li><li id="4713" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">我们需要用差动驱动机器人的速度编码器的运动测量值来计算独轮车的方向和角速度动力学</li><li id="5343" class="kq kr hu it b iu kz iy la jc lb jg lc jk ld jo kv kw kx ky dt translated">如何用独轮车的方向和角速度来计算机器人的姿态变化——位置和方向/方位。</li></ol><p id="b5ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在接下来的第4部分中，我们将看一些实现这些方程的ROS代码，并使用这些实现来驱动我们的ROSbots机器人到一个特定的位置。</p></div><div class="ab cl mj mk hc ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hn ho hp hq hr"><p id="02b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">像往常一样，关注@rosbots on Medium获取更新。在Instagram 和<a class="ae jp" href="https://www.facebook.com/hackrosbots" rel="noopener ugc nofollow" target="_blank">脸书</a>上关注我们吧！</p><p id="7adc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想合作，或者只是想打个招呼，请不要犹豫，提出问题、评论、总体反馈。</p><p id="2a92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你还没有这样做，<a class="ae jp" href="https://www.rosbots.com/purchase" rel="noopener ugc nofollow" target="_blank">在这里</a>购买你自己的ROSbots机器人来跟随。</p><p id="2a0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">谢谢！<br/>杰克“机器人制造商”</p></div></div>    
</body>
</html>