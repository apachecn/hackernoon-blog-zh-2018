<html>
<head>
<title>Real-time Chart in JavaScript with ChartJS and Hamoni Sync</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的实时图表与ChartJS和Hamoni同步</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/real-time-chart-in-javascript-with-chartjs-and-hamoni-sync-2fc7becd6852?source=collection_archive---------5-----------------------#2018-05-18">https://medium.com/hackernoon/real-time-chart-in-javascript-with-chartjs-and-hamoni-sync-2fc7becd6852?source=collection_archive---------5-----------------------#2018-05-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/5477c2955299f392d0228f8b5210cd11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0B3koJxrGjQCVNPZ."/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rawpixel.com</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a419" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">实时数据是在获取时显示的数据。它通常用于跟踪或监控系统，如交通GPS系统、拍卖/投标应用和股票交易应用。图表有助于数据的图形化表示，并帮助查看者轻松做出决定。</p><p id="5473" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这篇文章中，我将向你展示如何用JavaScript制作实时图表。我们将构建一个基本的投票web应用程序，其中包含一个投票页面，另一个页面包含一个显示投票结果的实时图表。这里有一个窥视我们将建立什么</p><figure class="kg kh ki kj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kf"><img src="../Images/0222c5446f9b74a4e5e6e69ae83437c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*J5lpPblJ752uD14TsrjS2Q.gif"/></div></div></figure><p id="c8ef" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我将使用<a class="ae jg" href="http://www.chartjs.org/" rel="noopener ugc nofollow" target="_blank"> Chart.js </a>和<a class="ae jg" href="https://www.hamoni.tech/" rel="noopener ugc nofollow" target="_blank"> Hamoni Sync </a>来构建它。js是一个简单的JavaScript图表库。Hamoni Sync是一个实时状态同步服务，使您能够实时同步您的应用程序状态。投票结果是我们希望实时显示给用户的状态。Hamoni Sync允许您定义应用程序的状态，同时避免围绕发布/订阅系统设计复杂的状态逻辑，从而使这一点变得更加容易。</p><h1 id="78ce" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">设置代码</h1><p id="4efb" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">我们将使用一个项目模板，其中已经有HTML页面和节点应用程序来提供静态文件。按照下面的说明进行设置</p><ol class=""><li id="506d" class="ln lo hu jj b jk jl jo jp js lp jw lq ka lr ke ls lt lu lv dt translated">通过在命令行运行<code class="eh lw lx ly lz b">git clone https://github.com/pmbanugo/realtime-chartjs-hamoni-starter.git</code>从GitHub克隆repo。如果你没有使用git，你可以在这里下载它。</li><li id="6fc7" class="ln lo hu jj b jk ma jo mb js mc jw md ka me ke ls lt lu lv dt translated">切换到项目目录<code class="eh lw lx ly lz b">cd realtime-chartjs-hamoni-starter</code></li><li id="92be" class="ln lo hu jj b jk ma jo mb js mc jw md ka me ke ls lt lu lv dt translated">通过运行<code class="eh lw lx ly lz b">npm install</code>安装依赖项。这将安装<a class="ae jg" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> express </a>和Hamoni同步节点模块。#后端</li></ol><p id="7949" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv"> server.js </strong>文件包含在<strong class="jj hv"> public </strong>文件夹中服务HTML页面的代码。第9–14行定义了投票应用程序的默认状态。它包含4名候选人，他们的票数为0。</p><pre class="kg kh ki kj fq mf lz mg mh aw mi dt"><span id="d2e5" class="mj kl hu lz b fv mk ml l mm mn">let voteData = [<br/>      { candidate: "Peter Mbanugo", vote: 0 },<br/>      { candidate: "Angela Daniels", vote: 0 },<br/>      { candidate: "Rose Philly", vote: 0 },<br/>      { candidate: "James Crump", vote: 0 }<br/>    ];</span></pre><p id="0a92" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">它还为投票定义了一个REST端点，从第18行到第30行定义。当收到投票时，我们可能希望将数据保存到数据库中，然后用最新的投票结果更新图表。图表状态将使用Hamoni Sync实时传达。在第40行，我声明了一个初始化Hamoni的语句，但是我们需要一个帐户ID和应用程序ID。</p><h1 id="e442" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">创建Hamoni帐户和应用程序</h1><p id="8733" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">登录Hamoni <a class="ae jg" href="https://dashboard.hamoni.tech/" rel="noopener ugc nofollow" target="_blank">仪表板</a>(如果您还没有帐户，请注册)。登录后，您可以点击<code class="eh lw lx ly lz b">Show Account ID</code>按钮查看您的帐户ID。我们需要一个Hamoni应用程序ID，因此我们需要从仪表板创建一个应用程序。应用程序是一个可以保存应用程序状态的容器。您通常希望为您的每个应用程序安装一个单独的Hamoni应用程序。</p><p id="ec88" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在“创建应用程序”标题下，输入应用程序名称，然后单击“创建”按钮。几秒钟之内，您应该会看到它被创建并显示在应用程序列表部分。</p><figure class="kg kh ki kj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/b1281506f081825de000ba7240c81dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IxgknQ9fz5Kf7QhW.png"/></div></div></figure><p id="03fb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">复制应用程序和帐户ID，并用<strong class="jj hv"> server.js </strong>中第40行的字符串值替换它们</p><h1 id="049b" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">在Hamoni中创建应用程序状态</h1><p id="2696" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">现在我们需要在Hamoni Sync中创建状态。为此，我们需要使用同步原语。同步原语是用来定义和操作状态的。它们基本上是一种对要存储的数据进行分类或区分的方式。有3种同步原语:</p><ol class=""><li id="4ff9" class="ln lo hu jj b jk jl jo jp js lp jw lq ka lr ke ls lt lu lv dt translated"><strong class="jj hv">值原语:</strong>这种状态保存用字符串、布尔或数字等数据类型表示的简单信息。它最适合于未读消息计数、切换等情况。</li><li id="7213" class="ln lo hu jj b jk ma jo mb js mc jw md ka me ke ls lt lu lv dt translated"><strong class="jj hv">对象原语:</strong>对象状态表示可以被建模为JavaScript对象的状态。一个示例用途可以是存储游戏的分数。</li><li id="263d" class="ln lo hu jj b jk ma jo mb js mc jw md ka me ke ls lt lu lv dt translated"><strong class="jj hv">列表原语:</strong>保存状态对象列表。状态对象是JavaScript对象。您可以根据项目在列表中的索引来更新项目。</li></ol><p id="b497" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这篇文章中，我将使用一个对象原语。</p><p id="a9c1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在<strong class="jj hv"> server.js </strong>中添加以下函数</p><pre class="kg kh ki kj fq mf lz mg mh aw mi dt"><span id="3aab" class="mj kl hu lz b fv mk ml l mm mn">function createState() {<br/>      hamoni<br/>        .createObject("election", voteData)<br/>        .then(statePrimitive =&gt; {<br/>          console.log("election state created");<br/>          state = statePrimitive;<br/>        })<br/>        .catch(console.log);<br/>    }</span></pre><p id="3019" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将使用变量`* vote data<code class="eh lw lx ly lz b">*.* Then we need to connect to the Hamoni Sync server. We do this by calling </code>hamoni . connect()<code class="eh lw lx ly lz b">. Add the following code below the function </code>create state()`创建一个名为<code class="eh lw lx ly lz b">*election*</code> * <em class="mp">和状态值的状态</em></p><pre class="kg kh ki kj fq mf lz mg mh aw mi dt"><span id="7ceb" class="mj kl hu lz b fv mk ml l mm mn">hamoni.connect().then(() =&gt; createState()).catch(console.log);</span></pre><p id="ec07" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果它成功地连接到服务器，我们调用<code class="eh lw lx ly lz b">createState()</code>函数为我们的图表创建状态。</p><h1 id="85ce" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">更新应用程序状态</h1><p id="6ed1" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">我们希望在新的投票到来时更新状态。保存我们状态的对象原语有一个<code class="eh lw lx ly lz b">update()</code>方法，可以用来更新状态。当用户调用我们API的<code class="eh lw lx ly lz b">/vote</code>端点时，我们将更新<em class="mp">选举</em>状态。在第27行下面，添加以下代码来更新状态</p><pre class="kg kh ki kj fq mf lz mg mh aw mi dt"><span id="0611" class="mj kl hu lz b fv mk ml l mm mn">app.post("/vote", function(req, res) {<br/>      ....<br/>      state.update(voteData);<br/>      ....<br/>    });</span></pre><p id="3289" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将更新状态并将更新广播到连接的客户端。</p><h1 id="a6d7" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">前端</h1><p id="d67a" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">我们的后端已经准备好接受投票并更新状态。现在我们需要建立前端发送投票和显示实时图表。</p><p id="6ac5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们在开始时克隆的starter模板有文件<strong class="jj hv"> public/vote.html </strong>和<strong class="jj hv"> public/js/vote.js. </strong>这些文件已经包含了在网页中显示表单的代码和发送到服务器的javascript。我在这里跳过了编写这段代码，因为它是一个基本的HTML表单和将表单数据发送到服务器的JavaScript。如果有任何令人困惑的地方，请留下评论。</p><p id="5a14" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">该图表将显示在<strong class="jj hv">index.html</strong>的公共文件夹内。<strong class="jj hv">index.html</strong>已经包含了Chart.js和Hamoni Sync的脚本标签(见第17和18行)</p><pre class="kg kh ki kj fq mf lz mg mh aw mi dt"><span id="f90e" class="mj kl hu lz b fv mk ml l mm mn">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://unpkg.com/hamoni-sync@0.2.0/hamoni.dev.js"&gt;&lt;/script&gt;</span></pre><h1 id="9889" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">呈现图表</h1><p id="c2fc" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">打开文件<strong class="jj hv"> public/index.js. </strong>添加下面的函数，在网页中呈现图表。</p><pre class="kg kh ki kj fq mf lz mg mh aw mi dt"><span id="5db3" class="mj kl hu lz b fv mk ml l mm mn">function renderChart(state) {<br/>      var ctx = document.getElementById("myChart").getContext("2d");<br/>      var chart = new Chart(ctx, {<br/>        // The type of chart we want to create<br/>        type: "bar",<br/>        // The data for our dataset<br/>        data: {<br/>          labels: state.map(s =&gt; s.candidate),<br/>          datasets: [<br/>            {<br/>              label: "Elections 2018",<br/>              backgroundColor: "rgb(255, 99, 132)",<br/>              borderColor: "rgb(255, 99, 132)",<br/>              data: state.map(s =&gt; s.vote)<br/>            }<br/>          ]<br/>        },<br/>        // Configuration options go here<br/>        options: {<br/>          scales: {<br/>            xAxes: [<br/>              {<br/>                time: {<br/>                  unit: "Vote"<br/>                },<br/>                gridLines: {<br/>                  display: false<br/>                },<br/>                ticks: {<br/>                  maxTicksLimit: 6<br/>                }<br/>              }<br/>            ],<br/>            yAxes: [<br/>              {<br/>                ticks: {<br/>                  min: 0,<br/>                  max: 30,<br/>                  maxTicksLimit: 10<br/>                },<br/>                gridLines: {<br/>                  display: true<br/>                }<br/>              }<br/>            ]<br/>          },<br/>          legend: {<br/>            display: true<br/>          }<br/>        }<br/>      });<br/>    }</span></pre><p id="2eba" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这个函数接受一个代表图表状态的参数。type选项指定了我们想要呈现的图表类型，在本例中是一个条形图。数据选项定义用于显示图表数据的属性。我想让你们注意两个重要的特性。首先是第8行的标签属性，<code class="eh lw lx ly lz b">labels: state.map(*s*</code></p><p id="492e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh lw lx ly lz b">*=&gt;*` `s.candidate)`<br/>It gets its value from the state. The chart state is an array of each electoral candidate and their vote. With that code, we’re setting the candidate’s name as labels for the chart. The second is `data: state.map(``*s*`</code></p><p id="bcef" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="mp"> = &gt; </em> s.vote)`第14行。它为图表设置数据。</p><p id="b82e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们需要检索图表状态并呈现图表。</p><h1 id="7210" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">获取状态和状态更新</h1><p id="fe73" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">为了检索图表状态，我们需要连接到Hamoni Sync。添加以下代码以获取状态和状态更新，然后基于此呈现图表:</p><pre class="kg kh ki kj fq mf lz mg mh aw mi dt"><span id="dab2" class="mj kl hu lz b fv mk ml l mm mn">let hamoni = new Hamoni("Account_ID", "APP_ID");<br/>hamoni<br/>  .connect()<br/>  .then(response =&gt; {<br/>    hamoni<br/>      .get("election")<br/>      .then(statePrimitive =&gt; {<br/>        renderChart(statePrimitive.get());</span><span id="94f9" class="mj kl hu lz b fv mq ml l mm mn">        statePrimitive.onUpdated(state =&gt; renderChart(state));<br/>      })<br/>      .catch(console.log);<br/>  })<br/>  .catch(error =&gt; console.log(error));</span></pre><p id="f158" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果客户端成功连接到Hamoni Sync，我们调用<code class="eh lw lx ly lz b">hamoni.get("election")</code>来获得我们的选举状态。如果成功，我们用状态值调用<code class="eh lw lx ly lz b">renderCharts()</code>。</p><p id="b070" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了得到状态更新的通知，我们用一个回调函数调用状态原语上的<code class="eh lw lx ly lz b">onUpdated()</code>,每次有更新时都应该执行这个回调函数。</p><p id="97eb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们可以测试我们的代码，看看它的工作情况。打开命令行并运行<code class="eh lw lx ly lz b">npm start</code>，然后打开浏览器并导航至<a class="ae jg" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> localhost:5000 </a>。</p><figure class="kg kh ki kj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kf"><img src="../Images/0222c5446f9b74a4e5e6e69ae83437c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*J5lpPblJ752uD14TsrjS2Q.gif"/></div></div></figure><p id="311a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">瞧啊。！🚀</p><p id="2a8e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">更轻松地制作实时图表状态。Chart.js很好用。Hamoni Sync减少了围绕发布/订阅系统设计复杂状态逻辑的开发时间和工作量，因为它包含了状态的概念。</p><p id="f9c6" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以在<a class="ae jg" href="https://github.com/pmbanugo/realtime-chartjs-hamoni" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得完成的源代码。</p><h1 id="9406" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">链接</h1><ul class=""><li id="8187" class="ln lo hu jj b jk li jo lj js mr jw ms ka mt ke mu lt lu lv dt translated"><a class="ae jg" href="https://www.hamoni.tech/" rel="noopener ugc nofollow" target="_blank">哈莫尼同步</a></li><li id="a226" class="ln lo hu jj b jk ma jo mb js mc jw md ka me ke mu lt lu lv dt translated"><a class="ae jg" href="http://www.chartjs.org/docs/latest/" rel="noopener ugc nofollow" target="_blank"> Chart.js </a></li><li id="a96f" class="ln lo hu jj b jk ma jo mb js mc jw md ka me ke mu lt lu lv dt translated"><a class="ae jg" href="http://expressjs.com/" rel="noopener ugc nofollow" target="_blank">快递</a></li></ul></div><div class="ab cl mv mw hc mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="hn ho hp hq hr"><p id="a0c8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">也在<a class="ae jg" href="https://dev.to/pmbanugo/real-time-chart-in-javascript-with-chartjs-and-hamoni-sync-1nkb" rel="noopener ugc nofollow" target="_blank">开发到</a>上共享</p></div></div>    
</body>
</html>