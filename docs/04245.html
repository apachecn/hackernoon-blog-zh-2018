<html>
<head>
<title>How to develop a Telegram chatbot on Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python上开发一个电报聊天机器人</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-develop-a-telegram-chatbot-on-python-acda22be3059?source=collection_archive---------17-----------------------#2018-05-18">https://medium.com/hackernoon/how-to-develop-a-telegram-chatbot-on-python-acda22be3059?source=collection_archive---------17-----------------------#2018-05-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/872c923101482a685e813017d460b725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bKS8ju5xzryMbOiVejYuDg.png"/></div></div></figure><p id="e2f4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">技术进步和自动化正开始影响人类经济和日常生活的许多领域。人工智能的快速发展迫使训练计算机来做人类的工作，并在商业中实现它们的用途。人工智能在商业中的主要应用之一是聊天机器人。</p><p id="d9f4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">NLP和聊天机器人在客户服务领域有很大的潜力，可以很容易地接受客户的订单，并就公司的服务向他们提供咨询。</p><p id="bc7d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在公司官方网站或Telegram、Slack或Facebook Messenger等流行的信使中的机器人的帮助下，支持中心的工作自动化是可能的。</p><p id="d34e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本文中，我们将向您简要介绍聊天机器人的开发，并分享我们用Python构建Telegram聊天机器人的经验。</p><h1 id="c2dc" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">项目简要说明</h1><p id="d682" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">如今，NLP已经成为一个非常重要的话题，因为它对非结构化文本数据有意义。例如，它可以用于商业，并创建智能机器人，这些机器人可以根据客户的请求、兴趣和特征对客户进行分类，并同时处理数百万个请求。</p><p id="8b2e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的项目允许创建聊天机器人，他们能够分析客户和顾问之间的实时对话。为了提高答案的质量和训练它处理更多的个案情况，教一个机器人是可能的。</p><p id="18cb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在线咨询意味着与客户进行面对面的咨询，并作为潜在买家影响他。为了做到这一点，顾问应该了解客户的概况(兴趣、词汇和心理类型)。大多数在线对话都是通过电话或短信进行的。该应用程序有几个库，用于理解人的声音并将其转换为文本数据。</p><p id="564b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">据此，本计画的想法是建立一个能够自我学习的互动系统，同时透过归类和处理客户的词汇形式来与客户沟通。我们的人工智能机器人的主要目的是识别实体集群——相关实体的群组。实体集群对许多活动非常有用。例如，我们可以分析客户请求，并根据兴趣组对其进行识别甚至排序。</p><h2 id="40f1" class="le kc hu bd kd lf lg lh kh li lj lk kl jn ll lm kp jr ln lo kt jv lp lq kx lr dt translated"><strong class="ak">工艺栈</strong></h2><p id="db26" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">前端:</p><ul class=""><li id="6f30" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">Javascript编程语言；</li><li id="abf0" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">JSON对象可视化工具；</li><li id="c69a" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">前端框架Twitter(脸书)引导；</li><li id="1b67" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">用于实时客户端-服务器连接的套接字。</li></ul><h1 id="dc48" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">技术选择</h1><p id="880c" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">该项目的架构基于Telegram及其用Python编程语言编写的后端部分。由于web客户端是项目的主要组成部分，因此最重要的决策之一就是为web应用程序的实现选择合适的框架。Python语言有几个“全栈”框架:Django、Grok、web2py、Giotto。</p><p id="acee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该应用程序是用Python编程语言编写的，以便统一开发和机器学习的过程。选择Django和Web2py框架进行开发。为了制作电报机器人并将其与电报服务集成，使用了电报机器人API。</p><p id="ff4e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了实现项目的人工智能部分，使用了以下Python库:</p><ul class=""><li id="4932" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated"><strong class="je hv"> NumPy </strong> —一个支持大型多维数组和矩阵的库。</li><li id="b994" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><strong class="je hv">SciPy(Scikit-learn)</strong>—Python编程语言的科学仪器开源库，包含优化和遗传算法模块。</li><li id="ccfd" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><strong class="je hv"> NLPK库</strong>—Python上用于符号和统计自然语言处理的一组库和程序。</li><li id="c63c" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><strong class="je hv"> Gensim Python库</strong>——基于机器学习的自动语言处理流行工具。在这个库中，实现了集群化和分布式语义算法(word和doc)。它可以解决主题建模的问题，并区分文本或文档的主要主题。</li><li id="2952" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><strong class="je hv"> Scrapy </strong> —从网页接收数据的最高效的Python库之一。</li></ul><p id="7682" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择工具的关键点是选择机器学习的库。在词法分析方面，我们决定选择Pyromorphy2，因为它支持俄语。选择TeleBot库来使用Telegram Bot API。web套接字的客户端实现是通过SocketIO库处理的。Flask-SocketIO库用于建立实时的客户端-服务器通信。它是一个结合Flask使用SocketIO库的工具，Flask是一个使用web套接字的方便框架。</p><h1 id="38b1" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">数据库</h1><p id="ba1b" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">为了创建一个基于人工智能的机器人，有必要使用问答数据库。客户端的查询和机器人的回复之间的时间间隔应该尽可能的小。为了实现这个目标，我们决定选择<strong class="je hv">Redis</strong>——一个高效的非关系数据库。关于问题和答案的信息存储为来自对话的消息块。这种方法的优点是:</p><ul class=""><li id="357a" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">它允许人们方便地找到记录的必要元素。</li><li id="0652" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">通过使用这种存储数据的方式，可以记录任意长度的对话，而不受哈希表中字段或关键字数量的任何限制。</li></ul><p id="3811" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为开发的主要目标是创建实时应用程序，所以使用了web套接字技术。它们将意味着允许实时客户机-服务器交互的交互式连接。与HTTP/HTTPS相比，web套接字能够与双向流一起工作，这将加快应用程序的工作。它们将有助于创建任何类型的实时软件:聊天机器人、物联网应用或多人在线游戏。</p><h1 id="7c7f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">机器学习的实现</h1><p id="a8f6" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">选择合适的机器学习算法是任何智能系统开发中的一个重要环节。机器学习的所有算法都可以细分为三种类型:</p><ul class=""><li id="23b8" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated"><strong class="je hv">如果有一个数据块具有其他数据块不清楚的特别明显的属性，并且有必要在工作时预测它们，则使用受控学习</strong>。</li><li id="94c4" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><strong class="je hv">非受控学习</strong>用于找出未标记数据集中的隐含关系。</li><li id="36f7" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><strong class="je hv">强化学习</strong>是上述类别的共生现象，意味着当没有标记或错误消息时，每一步或每一个动作都有某种特定类型的反馈。</li></ul><p id="404a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该项目的任务之一是根据数据库中的问题对答案进行分类。这些答案根据它们与相应类别的关系进行了分类。</p><p id="65b2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">机器学习是在决策树的帮助下进行的。其中一个代替了随机森林。这是一组处理投票的经过训练的树。基于其结果，随机森林根据指定的选择准备回复。为了实现选择合适的方案，使用了实施图备忘录。它是微软设计的模型，用于为特定任务选择机器学习算法(见下图)。</p><p id="a31d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">基于该方案，我们得出结论，当精度和学习速度是最高优先级时，随机森林算法是最适合于解决多类分类任务的算法。</p><h1 id="cf88" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">机器人训练过程</h1><p id="bf64" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">学习bot的过程包括几个阶段:</p><ul class=""><li id="2755" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated"><strong class="je hv">对话数据库预处理</strong> —此阶段完成后，只剩下与对话当前阶段相对应的那些集合。</li><li id="fa52" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><strong class="je hv">选择问题</strong> —完成上一阶段后，系统创建学习核心。在此阶段之前，每个问题的文本都被简化为常见形式。此外，所有单词都在词法分析器Pymorphy2的帮助下进行规范化。这样，每个单词都回到了最初的形式，分词也就简化成了不定式。它允许以相同的方式处理相同的单词，尽管上下文不同。</li><li id="2cf9" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><strong class="je hv">为问题的规范化选择创建TF-IDF矢量器</strong> —整个问题数据库的处理和随机森林的学习都基于矢量器。</li></ul><h1 id="d1fe" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">应用程序的工作流</h1><p id="f9c6" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">该应用程序包括一个网络客户端和一个基于Python的<strong class="je hv">电报聊天机器人</strong>。该应用程序的主要功能是:</p><ul class=""><li id="afad" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">客户信息的实时处理</li><li id="d204" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">为机器人的回复提供可能的变体</li><li id="ed90" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">实时处理bot的决策并向客户端发送回复</li></ul><p id="2d35" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">网络客户端由用于对话图工作的界面和用于发送消息的键盘组成。客户端与机器人的交互是使用电报机器人的经典选项。在启动应用程序时，也会启动两个流。其中一个是维护电报机器人的工作，第二个——应用的工作。客户端消息的处理是通过TeleBot库的工具“消息处理程序”来完成的。</p><p id="3b7d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用户的问题和答案的可能选项位于图表的顶部。单击其中一个答案后，其文本会自动显示在答案的空白处。</p><p id="d4eb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，系统等待客户端对发送的消息的回复。当它接收到该消息时，通过将用户的回答添加到具有所选消息的分支来重组该图。新的回复由应用程序准备。</p><h1 id="6295" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">该项目的主要挑战</h1><p id="23cd" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在进行该项目时，我们面临以下挑战:</p><ul class=""><li id="f598" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">实现客户信息的实时处理</li><li id="5c27" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">实时介绍顾问答案的可能变体</li><li id="08cf" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">实时处理顾问的决定，并将回复发送给客户</li><li id="9800" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">系统运行时对话数据库的动态扩展</li></ul><p id="ca12" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了应对这些挑战，我们实施了以下功能:</p><ul class=""><li id="8789" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">客户回答的预处理——创建一个词表的频率矩阵，找出最常用的词。</li><li id="4f1b" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">在自组织映射(SOM)的帮助下，搜索将具有相似意思的单词结合在一起的意义簇。这是一种人工神经网络，被训练产生训练样本输入空间的低维(通常是二维)离散化表示，称为<strong class="je hv">图</strong>。自组织映射不同于其他人工神经网络，因为它们应用<a class="ae ka" href="https://www.evernote.com/OutboundRedirect.action?dest=https%3A%2F%2Fen.m.wikipedia.org%2Fwiki%2FCompetitive_learning" rel="noopener ugc nofollow" target="_blank">竞争学习</a>而不是纠错学习。</li><li id="43e2" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">使用Redis进行数据存储，可以快速处理查询。</li></ul><h1 id="1a26" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="9964" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">尽管智能系统发展迅速，但这仅仅是它们在咨询领域应用的开始。这是因为在线咨询的实时处理的必要性，并且因为机器学习的算法需要大量时间用于预处理和学习本身。</p><p id="65e4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mg">原载于2018年5月18日</em><a class="ae ka" href="https://sloboda-studio.com/blog/how-to-develop-a-telegram-chatbot-on-python/" rel="noopener ugc nofollow" target="_blank"><em class="mg">【sloboda-studio.com】</em></a><em class="mg">。</em></p></div></div>    
</body>
</html>