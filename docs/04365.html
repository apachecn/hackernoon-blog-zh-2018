<html>
<head>
<title>Functional Testing of ASP.NET core 2.1 MVC Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ASP.NET核心2.1 MVC应用程序的功能测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/functional-testing-of-asp-net-core-2-1-mvc-application-d1651f997c3a?source=collection_archive---------11-----------------------#2018-05-23">https://medium.com/hackernoon/functional-testing-of-asp-net-core-2-1-mvc-application-d1651f997c3a?source=collection_archive---------11-----------------------#2018-05-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b93f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在ASP.NET核心2.1中，随着微软<a class="ae jp" href="https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing" rel="noopener ugc nofollow" target="_blank">的发布，建立<a class="ae jp" href="https://hackernoon.com/tagged/functional" rel="noopener ugc nofollow" target="_blank">功能</a>测试项目变得更加容易。AspNetCore . MVC . testing</a>nu get包。在这篇文章中，我们将建立一个功能测试项目。</p><h1 id="9550" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">先决条件</h1><p id="c574" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">要遵循本教程，您应该有-</p><ol class=""><li id="4eb9" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><a class="ae jp" href="https://www.microsoft.com/net/download/dotnet-core/sdk-2.1.300-rc1" rel="noopener ugc nofollow" target="_blank">。NET Core 2.1 RC1 SDK </a>和</li><li id="c3dc" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo ky kz la lb dt translated"><a class="ae jp" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>或<a class="ae jp" href="https://www.visualstudio.com/downloads/" rel="noopener ugc nofollow" target="_blank">Microsoft Visual Studio 2017</a>v 15.7预览版1或更新版本，安装在您的<a class="ae jp" href="https://hackernoon.com/tagged/system" rel="noopener ugc nofollow" target="_blank">系统上</a></li></ol><h1 id="ae05" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">创建测试项目</h1><p id="4347" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">创建一个文件夹并命名为<code class="eh lh li lj lk b">HelloWorld</code>，因为为什么不呢😜。打开文件夹内的<strong class="it hv"> PowerShell </strong>窗口(Shift + <code class="eh lh li lj lk b">right click</code>文件夹内任意位置，选择<code class="eh lh li lj lk b">Open PowerShell window here</code>，创建一个解决方案:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="f536" class="lt jr hu lk b fv lu lv l lw lx">dotnet new sln</span></pre><p id="8584" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在在<code class="eh lh li lj lk b">src</code>目录下创建一个基本的<strong class="it hv"> MVC </strong>项目，在<code class="eh lh li lj lk b">tests</code>目录下创建<strong class="it hv"> xunit </strong>项目；</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="4402" class="lt jr hu lk b fv lu lv l lw lx">dotnet new mvc -o .\src\HelloWorld.Mvc</span><span id="1a9c" class="lt jr hu lk b fv ly lv l lw lx">dotnet new xunit -o .\tests\HelloWorld.FunctionalTests</span></pre><p id="93bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将这两个项目添加到<strong class="it hv">解决方案</strong>:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="7bf6" class="lt jr hu lk b fv lu lv l lw lx">dotnet sln add .\src\HelloWorld.Mvc\HelloWorld.Mvc.csproj</span><span id="2d39" class="lt jr hu lk b fv ly lv l lw lx">dotnet sln add .\tests\HelloWorld.FunctionalTests\HelloWorld.FunctionalTests.csproj</span></pre><p id="fb32" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从<strong class="it hv">功能测试</strong>项目中引用<strong class="it hv"> MVC </strong>项目；</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="8d9f" class="lt jr hu lk b fv lu lv l lw lx">dotnet add .\tests\HelloWorld.FunctionalTests\HelloWorld.FunctionalTests.csproj reference .\src\HelloWorld.Mvc\HelloWorld.Mvc.csproj</span></pre><h1 id="c749" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">编写功能测试</h1><p id="4028" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">添加<a class="ae jp" href="https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing" rel="noopener ugc nofollow" target="_blank">微软。AspNetCore.Mvc.Testing </a>到功能测试项目:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="a529" class="lt jr hu lk b fv lu lv l lw lx">dotnet add .\tests\HelloWorld.FunctionalTests\HelloWorld.FunctionalTests.csproj package Microsoft.AspNetCore.Mvc.Testing -v 2.1.0-rc1-final</span></pre><p id="fa1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在在<strong class="it hv"> VS代码</strong>或<strong class="it hv"> Visual Studio 2017 15.7预览版1或更新版本</strong>中打开项目，在<strong class="it hv"> HelloWorld内创建一个新类。功能测试</strong>项目并将其命名为<code class="eh lh li lj lk b">HomePageShould.cs</code></p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="cf06" class="lt jr hu lk b fv lu lv l lw lx">using HelloWorld.Mvc;<br/>using Microsoft.AspNetCore.Mvc.Testing;<br/>using System.Net;<br/>using System.Net.Http;<br/>using System.Threading.Tasks;<br/>using Xunit;</span><span id="30b8" class="lt jr hu lk b fv ly lv l lw lx">namespace HelloWorld.FunctionalTests<br/>{<br/>    public class HomePageShould : IClassFixture&lt;WebApplicationFactory&lt;Startup&gt;&gt;<br/>    {<br/>        private readonly HttpClient _client;</span><span id="15c9" class="lt jr hu lk b fv ly lv l lw lx">        public HomePageShould(WebApplicationFactory&lt;Startup&gt; factory)<br/>        {<br/>            _client = factory.CreateClient();<br/>        }</span><span id="6d65" class="lt jr hu lk b fv ly lv l lw lx">        [Fact]<br/>        public async Task ReturnHttpStatusCodeOk()<br/>        {<br/>            var response = await _client.GetAsync("/");</span><span id="f69b" class="lt jr hu lk b fv ly lv l lw lx">            Assert.Equal(HttpStatusCode.OK, response.StatusCode);<br/>        }<br/>    }<br/>}</span></pre><h1 id="c6a2" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">运行测试</h1><p id="b819" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">现在运行<strong class="it hv">测试</strong>。它应该会失败，并显示错误消息</p><blockquote class="lz ma mb"><p id="6797" class="ir is mc it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">消息:系统。IO.FileNotFoundException:无法加载文件或程序集“Microsoft。AspNetCore，Version=2.1.0.0，Culture=neutral，public key token = ADB 9793829 ddae 60 '。系统找不到指定的文件。</p></blockquote><p id="2d82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要解决，加<a class="ae jp" href="https://www.nuget.org/packages/Microsoft.AspNetCore.App/" rel="noopener ugc nofollow" target="_blank">微软。AspNetCore.App </a> nuget包到<strong class="it hv">测试</strong>项目</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="5d2d" class="lt jr hu lk b fv lu lv l lw lx">dotnet add .\tests\HelloWorld.FunctionalTests\HelloWorld.FunctionalTests.csproj package Microsoft.AspNetCore.App -v 2.1.0-rc1-final</span></pre><p id="9d9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在从<code class="eh lh li lj lk b">Test</code>&gt;<code class="eh lh li lj lk b">Run</code>&gt;<code class="eh lh li lj lk b">All Tests</code>(Visual Studio 2017)或从<strong class="it hv"> PowerShell </strong>运行测试-</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="5178" class="lt jr hu lk b fv lu lv l lw lx">dotnet test .\tests\HelloWorld.FunctionalTests\HelloWorld.FunctionalTests.csproj</span></pre><p id="a07d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你应该看到幸福的绿色勾号。</p><figure class="ll lm ln lo fq mg"><div class="bz el l di"><div class="mh mi l"/></div></figure></div></div>    
</body>
</html>