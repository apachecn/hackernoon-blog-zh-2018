<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/hackernoon/implementing-firebaseauthstatelistener-using-shared-prefrences-in-flutter-b42e12f81eb2?source=collection_archive---------3-----------------------#2018-05-26">https://medium.com/hackernoon/implementing-firebaseauthstatelistener-using-shared-prefrences-in-flutter-b42e12f81eb2?source=collection_archive---------3-----------------------#2018-05-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><h2 id="c110" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">在Flutter中使用共享首选项实现FirebaseAuthStateListener。</h2><p id="7509" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">你好，✌️，</p><p id="d6bc" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">我一个月前开始颤抖。我在Flutter中开发了几个小应用，比如聊天应用<a class="ae jr" href="https://github.com/im-minion/Flutter-Chat-App" rel="noopener ugc nofollow" target="_blank">、</a><a class="ae jr" href="https://github.com/im-minion/Flutter-Blog-App-Firebase" rel="noopener ugc nofollow" target="_blank">博客应用</a>等等。我对提到的两个应用程序都使用了<a class="ae jr" href="https://hackernoon.com/tagged/firebase" rel="noopener ugc nofollow" target="_blank"> Firebase </a>。我在制作博客应用程序时意识到的一件事是关于firebase auth state listener。在flutter+firebase中，我没有找到像在Android<a class="ae jr" href="https://hackernoon.com/tagged/android" rel="noopener ugc nofollow" target="_blank">中那样的firebase身份验证状态监听器。(授权状态监听器检查并持续监控用户的存在状态，并分别显示Android方面的屏幕或活动)</a></p><p id="6732" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">因此，为了获得用户的当前状态，并在Flutter中显示相应的支架或材料应用程序或任何相应的组件，我在Flutter中使用了<a class="ae jr" href="https://pub.dartlang.org/packages/shared_preferences" rel="noopener ugc nofollow" target="_blank">“共享首选项”</a>库</p><p id="28ed" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">我目前已经使用了谷歌认证，但是你可以使用任何你想要的认证方法。</p><p id="b08c" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">在<a class="ae jr" href="https://github.com/im-minion/Flutter-Blog-App-Firebase" rel="noopener ugc nofollow" target="_blank"> Flutter博客应用</a>中，我声明了两个脚手架，即。loginScaffold和homeScaffold。并根据授权状态对它们进行了更改。<br/>如果用户已经登录，则显示主页文件夹，否则显示登录文件夹。之后，如果登录成功，loginScaffold将被homeScaffold替换。</p><p id="724c" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">使用共享首选项监听身份验证状态的步骤:</p><h2 id="b016" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">1.将库添加到pubspec.yaml并在HomePage.dart中导入</h2><pre class="js jt ju jv fq jw jx jy jz aw ka dt"><span id="0755" class="hs ht hu jx b fv kb kc l kd ke"><strong class="jx kf">dependencies:<br/>  flutter:<br/>    sdk: </strong>flutter</span><span id="f466" class="hs ht hu jx b fv kg kc l kd ke">  <strong class="jx kf">cupertino_icons: </strong>^0.1.0<br/>  <strong class="jx kf">shared_preferences: "^0.4.0"<br/>  .<br/>  .<br/>  .</strong></span></pre><p id="182b" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">然后导入到HomePage.dart作为</p><pre class="js jt ju jv fq jw jx jy jz aw ka dt"><span id="9744" class="hs ht hu jx b fv kb kc l kd ke">import ‘package:shared_preferences/shared_preferences.dart’;</span></pre><h2 id="f6e4" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">2.创建共享首选项的实例，并检查其中是否存在值:</h2><p id="7579" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">对于主屏幕，我使用了一个material应用程序，其“home:”属性取决于用户的当前状态，这意味着如果用户登录，它将显示homeScaffold，如果没有，则显示loginScaffold。<br/>如下:(代码不言自明:)</p><pre class="js jt ju jv fq jw jx jy jz aw ka dt"><span id="b4e9" class="hs ht hu jx b fv kb kc l kd ke"><strong class="jx kf">class </strong>HomePage <strong class="jx kf">extends </strong>StatefulWidget {<br/>  @override<br/>  HomePageState createState() =&gt; <strong class="jx kf">new </strong>HomePageState();<br/>}<br/><br/><strong class="jx kf">class </strong>HomePageState <strong class="jx kf">extends </strong>State&lt;HomePage&gt; {<br/>  bool <strong class="jx kf">loggedIn </strong>= <strong class="jx kf">false</strong>;  // this will check status</span><span id="025e" class="hs ht hu jx b fv kg kc l kd ke">Future&lt;Null&gt; _function() <strong class="jx kf">async </strong>{<br/>  <br/>    /**<br/>    This Function will be called every single time<br/>    when application is opened and it will check <br/>    if the value inside Shared Preference exist or not<br/>    **/</span><span id="1eef" class="hs ht hu jx b fv kg kc l kd ke">    SharedPreferences prefs;<br/>    prefs = <strong class="jx kf">await </strong>SharedPreferences.<em class="kh">getInstance</em>();<br/>    <strong class="jx kf">this</strong>.setState(() {<br/>      <strong class="jx kf">if </strong>(prefs.getString(<strong class="jx kf">"username"</strong>) != <strong class="jx kf">null</strong>) {<br/>        <strong class="jx kf">loggedIn </strong>= <strong class="jx kf">true</strong>;<br/>      } <strong class="jx kf">else </strong>{<br/>        <strong class="jx kf">loggedIn </strong>= <strong class="jx kf">false</strong>;<br/>      }<br/>    });<br/>  }  <br/>  . . . .</span><span id="7b89" class="hs ht hu jx b fv kg kc l kd ke">  Scaffold homeScaffold = /*define as required*/;<br/>  Scaffold loginScaffold = /*define as required*/;</span><span id="2100" class="hs ht hu jx b fv kg kc l kd ke">  @override<br/>  Widget build(BuildContext context) {<br/><strong class="jx kf">    return new </strong>MaterialApp(<br/>      title: <strong class="jx kf">"SimpleBlogApp"</strong>,<br/>      home: <strong class="jx kf">loggedIn </strong>? homeScaffold : loginScaffold);<br/>  }<br/>  ....<br/>  <br/>  @override<br/>  <strong class="jx kf">void </strong>initState() {<br/>    <strong class="jx kf">super</strong>.initState();<br/>    <strong class="jx kf">this</strong>._function();<br/>    ....<br/>  }<br/>}</span></pre><h2 id="f123" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">3.点击登录时，将调用_ensureLoggedIn()函数/方法，如果成功，则将他们的用户id、用户名、用户个人资料图像和用户电子邮件ID存储在共享首选项中，并使<strong class="ak"> loggedIn </strong>变量为真:</h2><pre class="js jt ju jv fq jw jx jy jz aw ka dt"><span id="c6cb" class="hs ht hu jx b fv kb kc l kd ke">Future&lt;Null&gt; _ensureLoggedIn() <strong class="jx kf">async </strong>{<br/>  <br/>  SharedPreferences prefs;<br/>  prefs = <strong class="jx kf">await </strong>SharedPreferences.<em class="kh">getInstance</em>();<br/>  <br/>  ........<br/>  <br/>  //sign in the user here and if it is successful then do following <br/>  <br/>  prefs.setString(<strong class="jx kf">"username"</strong>, user.<strong class="jx kf">displayName</strong>);<br/>  prefs.setString(<strong class="jx kf">"userid"</strong>, user.<strong class="jx kf">id</strong>);<br/>  prefs.setString(<strong class="jx kf">"useremail"</strong>, user.<strong class="jx kf">email</strong>);<br/>  prefs.setString(<strong class="jx kf">"userphotourl"</strong>, user.<strong class="jx kf">photoUrl</strong>);<br/>  <strong class="jx kf">this</strong>.setState(() {<br/>  /*<br/>     updating the value of <strong class="jx kf">loggedIn to true </strong>so it will <br/>     automatically trigger the screen to display homeScaffold.<br/>  */<br/>    <strong class="jx kf">loggedIn </strong>= <strong class="jx kf">true</strong>;<br/>    <strong class="jx kf">......</strong><br/>  });<br/>}</span></pre><h2 id="3fe7" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">5.当用户注销时，将共享首选项清除为:</h2><pre class="js jt ju jv fq jw jx jy jz aw ka dt"><span id="d972" class="hs ht hu jx b fv kb kc l kd ke">Future&lt;Null&gt; logoutUser() <strong class="jx kf">async </strong>{<br/>  <em class="kh">//logout user<br/>  </em>SharedPreferences prefs;<br/>  prefs = <strong class="jx kf">await </strong>SharedPreferences.<em class="kh">getInstance</em>();<br/>  <strong class="jx kf">await </strong>googleSignIn.signOut();<br/>  prefs.clear();<br/>  prefs.commit();<br/>  <strong class="jx kf">this</strong>.setState(() {<br/>  /*<br/>     updating the value of <strong class="jx kf">loggedIn to false </strong>so it will <br/>     automatically trigger the screen to display loginScaffold.<br/>  */<br/>    <strong class="jx kf">loggedIn </strong>= <strong class="jx kf">false</strong>;<br/>  });<br/>}</span></pre><p id="2cd5" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">你可以在GitHub上查看<a class="ae jr" href="https://github.com/im-minion/Flutter-Blog-App-Firebase" rel="noopener ugc nofollow" target="_blank"> Flutter博客app </a>项目里面的<a class="ae jr" href="https://github.com/im-minion/Flutter-Blog-App-Firebase/blob/master/lib/HomePage.dart" rel="noopener ugc nofollow" target="_blank"> HomePage.dart </a>文件。代码仅取自该文件。</p><p id="1179" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">对于我的更多颤振项目，看看我的<a class="ae jr" href="https://github.com/im-minion/" rel="noopener ugc nofollow" target="_blank"> GitHub简介</a>。</p><p id="9b61" class="pw-post-body-paragraph ir is hu it b iu jm iw ix iy jn ja jb ie jo jd je ii jp jg jh im jq jj jk jl hn dt translated">快乐编码😍<br/> Thanks✌️🙂</p><figure class="js jt ju jv fq ki"><div class="bz el l di"><div class="kj kk l"/></div></figure></div></div>    
</body>
</html>