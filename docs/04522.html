<html>
<head>
<title>Create Re-usable Services in SharePoint Framework (SPFx)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SharePoint Framework (SPFx)中创建可重用的服务</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/create-re-usable-services-in-sharepoint-framework-spfx-70f6cf6eee0d?source=collection_archive---------26-----------------------#2018-05-29">https://medium.com/hackernoon/create-re-usable-services-in-sharepoint-framework-spfx-70f6cf6eee0d?source=collection_archive---------26-----------------------#2018-05-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="511a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最近完成了一个相当复杂的SharePoint框架项目。我们顺着他<a class="ae jp" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank">反应过来的</a>路径跟了上去。这是我使用Angular作为我的主要框架大约两年后的第一个React项目。(这并不是反对Angular——如果SPFx对Angular有很好的支持，我可能会使用它)。</p><p id="fa3a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">React让我真正怀念的一件事是可重用服务的想法，这些服务将由NG运行时通过其依赖注入(DI)系统注入(<a class="ae jp" href="https://stackoverflow.com/questions/130794/what-is-dependency-injection" rel="noopener ugc nofollow" target="_blank">参见这里的DI总体讨论</a>)。我还是很怀念那个:)。</p><p id="01c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我从来没有处理过DI方面的事情，但是我非常想要我的可重用服务。</p><p id="c295" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">SPFx(至少当我在2017年11月/12月开始时)是非常面向组件的——你可以做web部件或扩展。这些组件可以很容易地重用，但是它们几乎总是有一个UI方面。我有很多服务类型的函数，它们没有UI，也不适合SPFx提供的web部件/扩展工具。</p><p id="48a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我通过将服务创建为单件来解决这个问题。下面的例子描述了一个“工作流服务”该服务知道如何迭代可用的SharePoint工作流、启动它们等。这是单身的一部分:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="42bf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这遵循了单例模式。您可以在这里查看更多细节:<a class="ae jp" href="https://stackoverflow.com/questions/30174078/how-to-define-singleton-in-typescript" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/30174078/how-to-define-singleton-in-typescript</a></p><p id="52a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我必须导入SPHttpContext，因为我几乎总是在我的服务中使用它。由于这些是单独的“普通”TS文件，它们不能从SPFx web部件的自动连接中受益。</p><p id="c4df" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是我如何从web部件初始化服务:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="6cd1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在上面的要点中，您可以看到我在两个服务“DocumentsService”和“WorfklowService”上调用initializeInstance()</p><p id="a062" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">即使web部件在页面上出现多次，或者多个web部件在同一页面上出现，您也可以安全地这样做。这是JavaScript是单线程的好例子。</p><p id="4485" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对我来说，我必须在web部件容器中完成这项工作，而不是在React组件本身中:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff jx"><img src="../Images/44b8021341e8ab5ca4a1918765ad337a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S6P5Cef89UBa_R-ImhztBg.png"/></div></div></figure><p id="abf2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">(同样，因为我需要传递http上下文，这是容易获得的地方；我本打算为此实现一个更优雅的方法，但是这样做太容易了，以至于有点“卡住”)</p><p id="0a16" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，需要调用服务上的方法的React组件(甚至是另一个服务)是这样工作的:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="4b82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第17行，我调用了WorkflowService上的getInstance()。这不会抛出错误，因为它已经被容器初始化了。</p><p id="91ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第19行，我调用了服务上的“startWFByDisplayName”方法。</p><p id="e15e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种方法效果很好。这很容易推理，很容易创建新的服务，也很容易知道什么时候出了问题(通常是因为我试图在还没有初始化的服务上获取Instance())。</p><p id="a448" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将所有可重复使用的服务放在“服务”文件夹中:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff ke"><img src="../Images/9071d5be7aaad0df724c02e1c0c76c44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJqChVGGGQfXS1-_8-zcKQ.png"/></div></div></figure><p id="f272" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">记住这些服务的“单一”性质是很重要的。主要的含义是，它们在每次页面加载时共享一组数据，因此，确实需要无状态。这对我来说从来都不是问题，尽管在早期，我确实忘记了这一点，并在完全理解其含义之前遇到了一些难以调试的问题。它实际上提高了性能——检索用户配置文件的服务只需一次，就可以将相同的配置文件返回给任何需要它的web部件(在我的例子中，我们几乎是每个页面上的每个web部件)。稍后我可能会就这个话题写一篇单独的简短博文。</p><p id="0418" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">希望这有用！微软很可能(如果他们还没有)为服务类型特性提供一些框架支持。与此同时，这样做的伎俩。</p><p id="8f82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"/><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="kf jw l"/></div></figure></div></div>    
</body>
</html>