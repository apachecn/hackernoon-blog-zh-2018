<html>
<head>
<title>How to dockerize any application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对任何应用程序进行归档</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-dockerize-any-application-b60ad00e76da?source=collection_archive---------1-----------------------#2018-05-31">https://medium.com/hackernoon/how-to-dockerize-any-application-b60ad00e76da?source=collection_archive---------1-----------------------#2018-05-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="df5d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如何对任何申请进行备案的10步清单。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/17fdd4ea1f6e8b4201b9947afc91c917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*cQmd2JsuqNwNelHh6bU-JA.jpeg"/></div></figure><p id="4a3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">互联网上已经有很多关于如何<a class="ae jy" href="https://hackernoon.com/tagged/dockerie" rel="noopener ugc nofollow" target="_blank">将</a>应用程序dockerize的教程，那么<em class="jp">为什么我要写另一个</em>？</p><p id="4b84" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我看到的大部分教程都是专注于某个<strong class="it hv">特定的</strong> <a class="ae jy" href="https://hackernoon.com/tagged/technology" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">技术</strong> </a>(比如Java或者Python)可能没有涵盖你所需要的。他们也没有<strong class="it hv">处理</strong>所有<strong class="it hv">相关</strong> <strong class="it hv">方面</strong>，这些方面对于在<strong class="it hv">开发</strong>和<strong class="it hv">运营</strong>团队之间建立明确定义的合同是必要的(这就是<strong class="it hv">集装箱化</strong>的意义)。</p><p id="3714" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我根据自己最近的<strong class="it hv">经历</strong>和<strong class="it hv">教训</strong> <strong class="it hv">学到的</strong>编制了以下步骤。这是一份清单，列出了你将在周围看到的其他指南所忽略的细节和事情。</p><p id="cb24" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">免责声明:<em class="jp">这是</em> <strong class="it hv"> <em class="jp">不是初学者</em> </strong> <em class="jp">指南。我建议您首先学习如何设置和使用docker的基础知识，并在创建和启动一些容器后再回到这里。</em></p><p id="60f0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们开始吧。</p><h1 id="3c62" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">1.选择基础图像</h1><p id="262c" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated"><a class="ae jy" href="https://hackernoon.com/tagged/technology" rel="noopener ugc nofollow" target="_blank">技术有许多</a>特有的基础图像，例如:</p><ul class=""><li id="137a" class="lc ld hu it b iu iv iy iz jc le jg lf jk lg jo lh li lj lk dt translated"><a class="ae jy" href="https://hub.docker.com/_/java/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/_/java/</a></li><li id="5aa2" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo lh li lj lk dt translated">【https://hub.docker.com/_/python/ T42】</li><li id="dfb4" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo lh li lj lk dt translated"><a class="ae jy" href="https://hub.docker.com/_/nginx/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/_/nginx/</a></li></ul><p id="0a96" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果它们都不适合你，你需要从一个基础操作系统开始，自己安装所有的东西。</p><p id="efff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大多数教程都是从Ubuntu开始的(比如ubuntu:16.04)，这并不一定是错误的。</p><p id="66c6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的建议是你可以考虑使用阿尔卑斯山的图片:</p><p id="e6c0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jy" href="https://hub.docker.com/_/alpine/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/_/alpine/</a></p><p id="d787" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它们提供了一个小得多的基本映像(小到5 MB)。</p><p id="7779" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意:“apt-get”命令对这些图像不起作用。Alpine使用自己包存储库和工具。详情请见:</p><p id="335b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jy" href="https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management" rel="noopener ugc nofollow" target="_blank">https://wiki . Alpine Linux . org/wiki/Alpine _ Linux _ package _ management</a></p><p id="5e73" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">【https://pkgs.alpinelinux.org/packages T2】号</p><h1 id="8bd9" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">2.安装必要的软件包</h1><p id="148d" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">这通常是微不足道的。你可能遗漏了一些细节:</p><p id="e1e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">a-)你需要在同一行写apt-get <strong class="it hv">更新</strong>和apt-get <strong class="it hv">安装</strong>(如果你在Alpine上使用apk也是一样)。这不仅是一种常见的做法，<strong class="it hv">你需要这样做</strong>，否则“apt-get update”临时镜像(层)可能会被缓存，之后可能不会立即更新你需要的包信息(见本讨论<a class="ae jy" href="https://forums.docker.com/t/dockerfile-run-apt-get-install-all-packages-at-once-or-one-by-one/17191" rel="noopener ugc nofollow" target="_blank">https://forums . docker . com/t/docker file-run-apt-get-install-all-packages-at-once-or-one-by-one/17191</a>)。</p><p id="d79b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">b-)仔细检查您是否只安装了您真正需要的<strong class="it hv"/><strong class="it hv"/>(假设您将在生产中运行容器)。我见过有人在他们的镜像中安装<strong class="it hv"> vim </strong>和其他<strong class="it hv">开发</strong> <strong class="it hv">工具</strong>。</p><p id="00f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果需要，为构建/调试/开发时间创建一个不同的docker文件。这不仅仅是图像大小的问题，还要考虑安全性、可维护性等等。</p><h1 id="8331" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">3.添加您的自定义文件</h1><p id="9261" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">改进你的文档的一些提示:</p><p id="ceac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">a-)理解复制和添加之间的区别:</p><p id="7394" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jy" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy" rel="noopener ugc nofollow" target="_blank">https://docs . docker . com/develop/develop-images/docker file _ best-practices/# add-or-copy</a></p><p id="f2b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">b-)(尝试)遵循文件系统关于放置文件的约定:</p><p id="2f5e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jy" href="http://www.pathname.com/fhs/" rel="noopener ugc nofollow" target="_blank">http://www.pathname.com/fhs/</a></p><p id="bfd4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如对于解释型应用(PHP，Python)，使用<em class="jp"> /usr/src </em>文件夹。</p><p id="4ad9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">c-)检查您正在添加的文件的属性。如果需要执行权限，就不需要在你的镜像上添加新层(运行chmod +x …)。只需修复代码库中的原始属性。</p><p id="b32a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">即使您使用的是Windows，也没有理由这样做，请参见:</p><div class="lq lr fm fo ls lt"><a href="https://stackoverflow.com/questions/21691202/how-to-create-file-execute-mode-permissions-in-git-on-windows" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">如何在Windows上的Git中创建文件执行模式权限？</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">没有必要分两次提交，您可以在一次提交中添加文件并将其标记为可执行…</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">stackoverflow.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh jw lt"/></div></div></a></div><h1 id="2170" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">4.定义哪个用户将(或可以)运行您的容器</h1><p id="f254" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">首先，休息一下，看看下面这篇<strong class="it hv">伟大的</strong>文章:</p><div class="lq lr fm fo ls lt"><a rel="noopener follow" target="_blank" href="/@mccode/understanding-how-uid-and-gid-work-in-docker-containers-c37a01d01cf"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">理解uid和gid如何在Docker容器中工作</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">了解用户名、组名、用户id(uid)和组id(GID)如何在</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">medium.com</p></div></div><div class="mc l"><div class="mi l me mf mg mc mh jw lt"/></div></div></a></div><p id="d040" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">读完这篇文章你会明白:</p><p id="12c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">a-)如果您的应用程序需要访问用户或组表(<em class="jp"> /etc/passwd </em>或<em class="jp"> /etc/group </em>)，您只需要使用特定的(固定ID)用户运行您的容器。</p><p id="26dd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">b-)尽可能避免以root身份运行你的容器。</p><p id="3cf9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不幸的是，不难发现一些流行的应用程序需要您使用特定的id来运行它们(例如，uid:gid = 1000:1000的<a class="ae jy" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html" rel="noopener ugc nofollow" target="_blank">弹性搜索</a>)。</p><p id="dcec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽量不要成为另一个…</p><h1 id="0e02" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">5.定义暴露的端口</h1><p id="f0f1" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">这通常是一个非常琐碎的过程，请不要让你的容器以root用户身份运行，因为你想让它暴露一个特权低端口(80)。只需公开一个非特权端口(例如8080)并在容器执行期间映射它。</p><p id="435e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种差异来自很久以前:</p><p id="a4ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jy" href="https://www.w3.org/Daemon/User/Installation/PrivilegedPorts.html" rel="noopener ugc nofollow" target="_blank">https://www . w3 . org/Daemon/User/Installation/privileged ports . html</a></p><h1 id="c5bc" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">6.定义入口点</h1><p id="76f3" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">最普通的方法:马上运行你的可执行文件。</p><p id="7496" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一个更好的方法是:创建一个"<em class="jp"> docker-entrypoint.sh </em>"脚本，您可以在其中使用环境变量来挂钩诸如配置之类的事情(下面将详细介绍):</p><p id="65dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是很常见的做法，举几个例子:</p><div class="lq lr fm fo ls lt"><a href="https://github.com/elastic/elasticsearch-docker/tree/master/build/elasticsearch/bin" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">弹性/弹性搜索-docker</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">弹性搜索-docker -官方弹性搜索docker图片</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">github.com</p></div></div><div class="mc l"><div class="mj l me mf mg mc mh jw lt"/></div></div></a></div><div class="lq lr fm fo ls lt"><a href="https://github.com/docker-library/postgres/tree/de8ba87d50de466a1e05e111927d2bc30c2db36d/10" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">docker-图书馆/postgres</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">Postgres-Docker Postgres官方形象包装</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">github.com</p></div></div><div class="mc l"><div class="mk l me mf mg mc mh jw lt"/></div></div></a></div><h1 id="9128" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">7.定义配置方法</h1><p id="5708" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">每个应用程序都需要某种参数化。基本上有两条路可以走:</p><p id="0f49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1-)使用特定于应用程序的配置文件:您将需要记录格式、字段、位置等等(如果您有一个复杂的环境，应用程序跨越不同的技术，这并不好)。</p><p id="953e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2-)使用(操作系统)环境变量:简单高效。</p><p id="45fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你认为这不是现代的或推荐的方法，记住这是十二因素的一部分:</p><div class="lq lr fm fo ls lt"><a href="https://12factor.net/config" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">十二因素应用程序</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">构建现代化、可扩展、可维护的软件即服务应用的方法。</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">12factor.net</p></div></div></div></a></div><p id="5c5d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这并不意味着您需要扔掉您的配置文件并重构您的应用程序的配置机制。</p><p id="e660" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">只需使用一个简单的<a class="ae jy" href="https://linux.die.net/man/1/envsubst" rel="noopener ugc nofollow" target="_blank"> envsubst </a>命令来替换一个配置模板(在<em class="jp"> docker-entrypoint.sh </em>内，因为它需要在运行时执行)。</p><p id="66ab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">示例:</p><div class="lq lr fm fo ls lt"><a href="https://docs.docker.com/samples/library/nginx/#using-environment-variables-in-nginx-configuration" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">nginx</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">Nginx的官方版本。GitHub repo:https://github.com/nginxinc/docker-nginx图书馆参考这个内容是…</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">docs.docker.com</p></div></div><div class="mc l"><div class="ml l me mf mg mc mh jw lt"/></div></div></a></div><p id="dc82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将封装特定于应用程序的配置文件，在容器内布局和细节。</p><h1 id="c564" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">8.将您的数据具体化</h1><p id="1074" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">黄金法则是:<strong class="it hv">不要在容器</strong>中保存任何持久数据。</p><p id="60ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">容器文件系统应该是暂时的，短暂的。因此，任何用户生成的内容、数据文件、流程输出都应该保存在<strong class="it hv">挂载的</strong> <strong class="it hv">卷</strong>或<strong class="it hv">绑定挂载的</strong>(也就是说，在容器内链接的基本操作系统的文件夹上)。</p><p id="b878" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">老实说，我在挂载卷方面没有太多经验，我一直倾向于将数据保存在一个<strong class="it hv">绑定</strong> <strong class="it hv">挂载</strong>上，使用之前创建的文件夹<strong class="it hv">仔细地使用<strong class="it hv">配置</strong> <strong class="it hv">管理</strong>工具(如Salt Stack)定义<strong class="it hv">。</strong></strong></p><p id="050c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如<strong class="it hv">精心</strong>创造了<strong class="it hv"/>，我的意思是这样的:</p><ol class=""><li id="6810" class="lc ld hu it b iu iv iy iz jc le jg lf jk lg jo mm li lj lk dt translated">我在基本操作系统上创建了一个非特权用户(和组)。</li><li id="a68d" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo mm li lj lk dt translated">所有绑定文件夹(-v)都是使用该用户作为所有者创建的。</li><li id="7ee0" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo mm li lj lk dt translated">相应地授予权限(仅授予该特定用户和组，其他用户无权访问)。</li><li id="8ae8" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo mm li lj lk dt translated">容器将以此用户运行。</li><li id="f29c" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo mm li lj lk dt translated">你将完全控制这一切。</li></ol><h1 id="814b" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">9.确保您也处理日志</h1><p id="018e" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">我意识到我之前的“<strong class="it hv">持久</strong> <strong class="it hv">数据</strong>”远不是一个精确的定义，日志有时会落入灰色区域。你应该如何处理它们？</p><p id="fb23" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你正在创建一个新的应用程序，并希望它遵守<a class="ae jy" href="https://hackernoon.com/tagged/docker" rel="noopener ugc nofollow" target="_blank"> docker </a>约定，那么根本不应该写日志<strong class="it hv">文件</strong>。应用程序应该使用<strong class="it hv"> stdout </strong>和<strong class="it hv"> stderr </strong>作为<strong class="it hv">事件</strong> <strong class="it hv">流</strong>。就像环境变量推荐一样，它也是十二因素中的<a class="ae jy" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank">之一。参见:</a></p><div class="lq lr fm fo ls lt"><a href="https://12factor.net/logs" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">十二因素应用程序</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">构建现代化、可扩展、可维护的软件即服务应用的方法。</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">12factor.net</p></div></div></div></a></div><p id="04bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Docker将自动捕获你发送到<strong class="it hv"> stdout </strong>的所有内容，并通过“<strong class="it hv"> docker </strong>和<strong class="it hv"> logs </strong>命令使其可用:</p><p id="8949" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jy" href="https://docs.docker.com/engine/reference/commandline/logs/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/reference/commandline/logs/</a></p><p id="4707" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，在一些实际案例中，这是非常困难的。如果您正在运行一个简单的nginx容器，您将至少有两种不同类型的日志文件:</p><ul class=""><li id="6772" class="lc ld hu it b iu iv iy iz jc le jg lf jk lg jo lh li lj lk dt translated">HTTP访问日志</li><li id="ec1e" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo lh li lj lk dt translated">错误日志</li></ul><p id="d2c5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于不同的结构、配置和预先存在的实现，在标准输出上传输它们可能并不容易。</p><p id="3fc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这种情况下，只需按照上一节所述处理日志文件，并确保循环使用它们。</p><h1 id="5ae4" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">10.旋转日志和其他仅附加文件</h1><p id="eb04" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">如果您的应用程序正在写日志文件或附加任何可以无限增长<strong class="it hv"/>的文件，您需要担心文件<strong class="it hv">旋转</strong>。</p><p id="bd59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这对于防止服务器耗尽<strong class="it hv">空间</strong>，应用数据<strong class="it hv">保留</strong>策略(当涉及GDPR和其他数据法规时，这一点至关重要)至关重要。</p><p id="1a4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您正在使用<strong class="it hv">绑定</strong>挂载<strong class="it hv">挂载</strong>，您可以依靠基础操作系统的一些帮助，并使用您将用于本地旋转配置的相同工具，即<strong class="it hv"> logrotate </strong>(此处为手动<a class="ae jy" href="https://linux.die.net/man/8/logrotate" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="15ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最近发现的一个简单而完整的例子是这个:</p><div class="lq lr fm fo ls lt"><a href="https://www.aerospike.com/docs/operations/configure/log/logrotate.html" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">配置-日志旋转</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">使用Linux工具logrotate和Aerospike内存中的NoSQL数据库来管理日志循环。</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">www.aerospike.com</p></div></div></div></a></div><p id="7575" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另一个很好的例子:</p><div class="lq lr fm fo ls lt"><a href="https://www.digitalocean.com/community/tutorials/how-to-manage-logfiles-with-logrotate-on-ubuntu-16-04" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">如何在Ubuntu 16.04 | DigitalOcean上用Logrotate管理日志文件</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">Logrotate是一个系统实用程序，用于管理日志文件的自动旋转和压缩。如果日志文件不是…</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">www.digitalocean.com</p></div></div><div class="mc l"><div class="mn l me mf mg mc mh jw lt"/></div></div></a></div><p id="26d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt">—</p><p id="106a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你有任何反馈，请告诉我。看看我在https://hackernoon.com/@htssouza的其他技术文章</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mo mp l"/></div></figure></div></div>    
</body>
</html>