<html>
<head>
<title>Build a ride sharing iOS app with push notifications.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ„å»ºä¸€ä¸ªå¸¦æœ‰æ¨é€é€šçŸ¥çš„ä¹˜è½¦å…±äº«iOSåº”ç”¨ç¨‹åºã€‚</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/build-a-ride-sharing-ios-app-with-push-notifications-96a5e2324cc?source=collection_archive---------9-----------------------#2018-06-01">https://medium.com/hackernoon/build-a-ride-sharing-ios-app-with-push-notifications-96a5e2324cc?source=collection_archive---------9-----------------------#2018-06-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="f483" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">è¦å­¦ä¹ æœ¬æ•™ç¨‹ï¼Œæ‚¨éœ€è¦ä¸€å°å®‰è£…äº†Xcodeçš„Macã€Xcodeå’ŒSwiftçš„çŸ¥è¯†ã€JavaScript(åŒ…æ‹¬Node.js)çš„åŸºç¡€çŸ¥è¯†ã€ä¸€ä¸ªPusherå¸æˆ·å’Œå®‰è£…åœ¨æ‚¨æœºå™¨ä¸Šçš„Cocoapodsã€‚</p></blockquote><p id="dc22" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åƒ<a class="ae jw" href="https://uber.com" rel="noopener ugc nofollow" target="_blank">ä¼˜æ­¥</a>å’Œ<a class="ae jw" href="https://lyft.com" rel="noopener ugc nofollow" target="_blank"> Lyft </a>è¿™æ ·çš„æ‹¼è½¦åº”ç”¨å¯ä»¥è®©ä¹˜å®¢å‘ä»–ä»¬æ‰€åœ¨åœ°åŒºçš„å¸æœºè¯·æ±‚æ­è½¦ã€‚å½“ä¹˜å®¢è¯·æ±‚æ­è½¦æ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šå°½å¿«æ‰¾åˆ°å¸æœºã€‚å¦‚æœä¹˜å®¢åœ¨ç­‰å¾…æ—¶å…³é—­äº†åº”ç”¨ç¨‹åºï¼Œä»–ä»¬éœ€è¦ä¸€ç§æ–¹å¼æ¥é€šçŸ¥ä»–ä»¬æ±½è½¦æ­£åœ¨è·¯ä¸Šï¼Œä¸€æ—¦æ±½è½¦åˆ°è¾¾ï¼Œä»–ä»¬å°±ä¼šå†æ¬¡æ”¶åˆ°é€šçŸ¥ã€‚</p><p id="ca38" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„è™šæ‹Ÿä¹˜è½¦å…±äº«åº”ç”¨ç¨‹åºï¼Œé‡ç‚¹å…³æ³¨å¦‚ä½•é›†æˆPusherçš„Beams APIæ¥æä¾›äº‹åŠ¡æ€§æ¨é€é€šçŸ¥ã€‚</p><p id="6ba0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æˆ‘ä»¬å°†åˆ¶ä½œä¸¤ä¸ªiOSåº”ç”¨ç¨‹åºæ¥æ»¡è¶³å¸æœºå’Œéª‘æ‰‹çš„éœ€æ±‚ï¼Œå¹¶åˆ¶ä½œä¸€ä¸ªNode.jsåº”ç”¨ç¨‹åºæ¥æ”¯æŒä»–ä»¬ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æ·»åŠ æ¨é€é€šçŸ¥ï¼Œæé†’å¸æœºæœ‰æ–°çš„ä¹˜è½¦è¯·æ±‚ï¼Œå¹¶æé†’ä¹˜å®¢ä»–ä»¬æœ‰å¸æœºåœ¨è·¯ä¸Šï¼Œä¸€æ—¦ä»–ä»¬åˆ°è¾¾ã€‚</p><h1 id="de8b" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">å…ˆå†³æ¡ä»¶</h1><ul class=""><li id="dfe7" class="kv kw hu ix b iy kx jc ky jt kz ju la jv lb js lc ld le lf dt translated">å®‰è£…äº†Xcodeçš„Macã€‚<a class="ae jw" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank">åœ¨è¿™é‡Œä¸‹è½½Xcodeã€‘ã€‚</a></li><li id="208c" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated">Xcodeä½¿ç”¨çŸ¥è¯†ã€‚</li><li id="405c" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated"><a class="ae jw" href="https://developer.apple.com/swift/" rel="noopener ugc nofollow" target="_blank">è¿…æ·</a>çš„çŸ¥è¯†ã€‚</li><li id="8233" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated">æ¨é”€è´¦æˆ·ã€‚<a class="ae jw" href="http://pusher.com" rel="noopener ugc nofollow" target="_blank">åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ª</a>ã€‚</li><li id="8e64" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated">ä¸€ä¸ªè°·æ­Œåœ°å›¾APIå¯†é’¥ã€‚<a class="ae jw" href="https://developers.google.com/maps/documentation/ios-sdk/get-api-key" rel="noopener ugc nofollow" target="_blank">åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ª</a>ã€‚</li><li id="b2f0" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated">JavaScript/Node.jsåŸºç¡€çŸ¥è¯†(<a class="ae jw" href="https://www.w3schools.com/nodejs/default.asp" rel="noopener ugc nofollow" target="_blank">æŸ¥çœ‹æœ¬æ•™ç¨‹</a>)ã€‚</li><li id="7d5a" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated">å®‰è£…åœ¨æ‚¨çš„æœºå™¨ä¸Šçš„Cocoapods <a class="ae jw" href="https://guides.cocoapods.org/using/getting-started.html" rel="noopener ugc nofollow" target="_blank">ã€‚</a></li></ul><p id="c35d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸€æ—¦æœ‰äº†è¦æ±‚ï¼Œå°±å¼€å§‹å§ã€‚</p><h1 id="67e1" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">å…³äºæˆ‘ä»¬çš„åº”ç”¨</h1><p id="007c" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ¶ä½œä¸‰ä¸ªåº”ç”¨ç¨‹åº:</p><ul class=""><li id="bb1c" class="kv kw hu ix b iy iz jc jd jt lo ju lp jv lq js lc ld le lf dt translated">åç«¯åº”ç”¨ç¨‹åº(ä½¿ç”¨Node.jsçš„Web)ã€‚è¿™å°†æ˜¯ä¸¤ä¸ªiOSåº”ç”¨ç¨‹åºçš„åŠ¨åŠ›ä¹‹å®¶ã€‚å®ƒå°†åŒ…å«åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ç«¯ç‚¹ã€‚å®ƒè¿˜å°†è´Ÿè´£å‘å„ä¸ªè®¾å¤‡å‘é€æ¨é€é€šçŸ¥ã€‚</li><li id="6c8d" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated">éª‘æ‰‹åº”ç”¨ç¨‹åº(ä½¿ç”¨Swiftçš„iOS)ã€‚è¿™å°†æ˜¯éª‘æ‰‹ç”¨æ¥è¯·æ±‚ä¹˜è½¦çš„åº”ç”¨ç¨‹åºã€‚</li><li id="725f" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated">é©±åŠ¨ç¨‹åºåº”ç”¨ç¨‹åº(ä½¿ç”¨Swiftçš„iOS)ã€‚è¿™å°†æ˜¯å¸æœºç”¨æ¥æ¥å—ä¹˜å®¢è¯·æ±‚çš„åº”ç”¨ç¨‹åºã€‚é©¾é©¶å‘˜å°†èƒ½å¤Ÿæ ¹æ®æƒ…å†µæ›´æ–°æ¸¸ä¹è®¾å¤‡çš„çŠ¶æ€ã€‚</li></ul><p id="f966" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™æ˜¯æˆ‘ä»¬å®Œæˆåçš„å±å¹•å½•åƒ:</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lr"><img src="../Images/548dc782328fc68406d9ecb5abda2b95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bQtPGsJOOEnY2UhjqnR3zA.gif"/></div></div></figure><blockquote class="ir is it"><p id="5acf" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡æˆ‘ä»¬ä¸ä¼šè¿‡å¤šå…³æ³¨æ‹¼è½¦åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬å°†ä¸»è¦å…³æ³¨å¦‚ä½•å°†æ¨é€é€šçŸ¥é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚</em></p></blockquote><h1 id="5016" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">æ„å»ºåç«¯åº”ç”¨ç¨‹åº(API)</h1><p id="a56b" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æˆ‘ä»¬é¦–å…ˆè¦æ„å»ºçš„æ˜¯APIã€‚æˆ‘ä»¬å°†æ·»åŠ æ”¯æŒæˆ‘ä»¬çš„iOSåº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€åˆ‡ï¼Œç„¶ååœ¨ç¨åæ·»åŠ æ¨é€é€šçŸ¥ã€‚</p><p id="3bf3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">é¦–å…ˆï¼Œä¸ºAPIåˆ›å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ã€‚åœ¨ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf mg b">package.json</code>çš„æ–°æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­ç²˜è´´ä»¥ä¸‹å†…å®¹:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="6019" class="ml jy hu mg b fv mm mn l mo mp">{<br/>      "main": "index.js",<br/>      "scripts": {},<br/>      "dependencies": {<br/>        "body-parser": "^1.18.2",<br/>        "express": "^4.16.2",<br/>        "pusher": "^1.5.1",<br/>        "pusher-push-notifications-node": "^0.10.1"<br/>      }<br/>    }</span></pre><p id="5c87" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œåœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="8e31" class="ml jy hu mg b fv mm mn l mo mp">$ npm install</span></pre><p id="0a8f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°†å®‰è£…æ‰€æœ‰åˆ—å‡ºçš„ä¾èµ–é¡¹ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨ä¸<code class="eh md me mf mg b">package.json</code>æ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code class="eh md me mf mg b">index.js</code>æ–‡ä»¶ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="cbe3" class="ml jy hu mg b fv mm mn l mo mp">// --------------------------------------------------------<br/>    // Pull in the libraries<br/>    // --------------------------------------------------------</span><span id="fd26" class="ml jy hu mg b fv mq mn l mo mp">    const app = require('express')()<br/>    const bodyParser = require('body-parser')<br/>    const config = require('./config.js')<br/>    const Pusher = require('pusher')<br/>    const pusher = new Pusher({<br/>        appId: 'PUSHER_APP_ID',<br/>        key: 'PUSHER_APP_KEY',<br/>        secret: 'PUSHER_APP_SECRET',<br/>        cluster: 'PUSHER_APP_CLUSTER',<br/>        encrypted: true<br/>    })</span><span id="6419" class="ml jy hu mg b fv mq mn l mo mp">    // --------------------------------------------------------<br/>    // In-memory database<br/>    // --------------------------------------------------------</span><span id="0388" class="ml jy hu mg b fv mq mn l mo mp">    let rider = null<br/>    let driver = null<br/>    let user_id = null<br/>    let status = "Neutral"</span><span id="ea7c" class="ml jy hu mg b fv mq mn l mo mp">    // --------------------------------------------------------<br/>    // Express Middlewares<br/>    // --------------------------------------------------------</span><span id="2f80" class="ml jy hu mg b fv mq mn l mo mp">    app.use(bodyParser.json())<br/>    app.use(bodyParser.urlencoded({extended: false}))</span><span id="f6b0" class="ml jy hu mg b fv mq mn l mo mp">    // --------------------------------------------------------<br/>    // Helpers<br/>    // --------------------------------------------------------</span><span id="513c" class="ml jy hu mg b fv mq mn l mo mp">    function uuidv4() {<br/>        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {<br/>            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r &amp; 0x3 | 0x8);<br/>            return v.toString(16);<br/>        });<br/>    }</span><span id="1677" class="ml jy hu mg b fv mq mn l mo mp">    // --------------------------------------------------------<br/>    // Routes<br/>    // --------------------------------------------------------</span><span id="d8e7" class="ml jy hu mg b fv mq mn l mo mp">    // ----- Rider --------------------------------------------</span><span id="4221" class="ml jy hu mg b fv mq mn l mo mp">    app.get('/status', (req, res) =&gt; res.json({ status }))</span><span id="6566" class="ml jy hu mg b fv mq mn l mo mp">    app.get('/request', (req, res) =&gt; res.json(driver))</span><span id="751d" class="ml jy hu mg b fv mq mn l mo mp">    app.post('/request', (req, res) =&gt; {<br/>        user_id = req.body.user_id<br/>        status = "Searching"<br/>        rider = { name: "Jane Doe", longitude: -122.088426, latitude: 37.388064 }</span><span id="cf97" class="ml jy hu mg b fv mq mn l mo mp">        pusher.trigger('cabs', 'status-update', { status, rider })<br/>        res.json({ status: true })</span><span id="ffca" class="ml jy hu mg b fv mq mn l mo mp">    })<br/>    app.delete('/request', (req, res) =&gt; {<br/>        driver = null<br/>        status = "Neutral"<br/>        pusher.trigger('cabs', 'status-update', { status })<br/>        res.json({ status: true })<br/>    })</span><span id="4ba2" class="ml jy hu mg b fv mq mn l mo mp">    // ----- Driver ------------------------------------------</span><span id="5990" class="ml jy hu mg b fv mq mn l mo mp">    app.get('/pending-rider', (req, res) =&gt; res.json(rider))</span><span id="9de9" class="ml jy hu mg b fv mq mn l mo mp">    app.post('/status', (req, res) =&gt; {<br/>        status = req.body.status</span><span id="85dc" class="ml jy hu mg b fv mq mn l mo mp">        if (status == "EndedTrip" || status == "Neutral") {<br/>            rider = driver = null<br/>        } else {<br/>            driver = { name: "John Doe" }<br/>        }</span><span id="c5c5" class="ml jy hu mg b fv mq mn l mo mp">        pusher.trigger('cabs', 'status-update', { status, driver })<br/>        res.json({ status: true })<br/>    })</span><span id="4800" class="ml jy hu mg b fv mq mn l mo mp">    // ----- Misc ---------------------------------------------</span><span id="7c1a" class="ml jy hu mg b fv mq mn l mo mp">    app.get('/', (req, res) =&gt; res.json({ status: "success" }))</span><span id="89b6" class="ml jy hu mg b fv mq mn l mo mp">    // --------------------------------------------------------<br/>    // Serve application<br/>    // --------------------------------------------------------</span><span id="5d33" class="ml jy hu mg b fv mq mn l mo mp">    app.listen(4000, _ =&gt; console.log('App listening on port 4000!'))</span></pre><blockquote class="ir is it"><p id="1522" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡æ‚¨éœ€è¦å°†</em> <code class="eh md me mf mg b"><em class="hu">PUSHER_APP_*</em></code> <em class="hu">é”®æ›¿æ¢ä¸ºæ¨æ†ä»ªè¡¨æ¿ä¸Šçš„çœŸå®é”®ã€‚</em></p></blockquote><p id="7510" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè·å–åº”ç”¨ç¨‹åºè¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€äº›å˜é‡æ¥ä¿å­˜æ•°æ®ï¼Œä½œä¸ºå†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨ã€‚ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªUUIDç”Ÿæˆå™¨å‡½æ•°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥ç”Ÿæˆå¯¹è±¡çš„IDã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè·¯çº¿:</p><ul class=""><li id="d70e" class="kv kw hu ix b iy iz jc jd jt lo ju lp jv lq js lc ld le lf dt translated"><code class="eh md me mf mg b">POST /request</code>ä¿å­˜å¯¹é©±åŠ¨ç¨‹åºçš„æ–°è¯·æ±‚ã€‚</li><li id="59da" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated"><code class="eh md me mf mg b">GET /request</code>è·å–å¤„ç†è¯·æ±‚çš„é©±åŠ¨ç¨‹åºã€‚</li><li id="b228" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated">å–æ¶ˆæ­è½¦è¯·æ±‚ã€‚</li><li id="01df" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated"><code class="eh md me mf mg b">GET /pending-order</code>è·å–æŒ‚èµ·çš„è¯·æ±‚ã€‚</li><li id="fff4" class="kv kw hu ix b iy lg jc lh jt li ju lj jv lk js lc ld le lf dt translated"><code class="eh md me mf mg b">POST /status</code>æ”¹å˜æ¸¸ä¹è®¾å¤‡çš„çŠ¶æ€ã€‚</li></ul><p id="ced4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°±æ˜¯æˆ‘ä»¬ç°åœ¨åœ¨APIä¸­æ‰€éœ€è¦çš„ï¼Œå½“æˆ‘ä»¬éœ€è¦å‘é€æ¨é€é€šçŸ¥æ—¶ï¼Œæˆ‘ä»¬å°†å†æ¬¡è®¿é—®å®ƒã€‚å¦‚æœæ‚¨æƒ³æµ‹è¯•APIæ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œé‚£ä¹ˆåœ¨æ‚¨çš„ç»ˆç«¯ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="cc1a" class="ml jy hu mg b fv mm mn l mo mp">$ node index.js</span></pre><p id="c109" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°†å¯åŠ¨ä¸€ä¸ªç›‘å¬ç«¯å£<strong class="ix hv"> 4000 </strong>çš„æ–°èŠ‚ç‚¹æœåŠ¡å™¨ã€‚</p><h1 id="1207" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">æ„å»ºéª‘å£«åº”ç”¨ç¨‹åº</h1><p id="57d9" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æˆ‘ä»¬éœ€è¦åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯æ„å»ºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚å¯åŠ¨Xcodeå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„â€œå•ä¸€åº”ç”¨ç¨‹åºâ€é¡¹ç›®ã€‚æˆ‘ä»¬å°†æŠŠè¿™ä¸ªé¡¹ç›®å‘½åä¸º<strong class="ix hv"> RiderClientã€‚</strong></p><p id="f87d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œé€€å‡ºXcodeï¼Œåœ¨åˆšåˆšåˆ›å»ºçš„Xcodeé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf mg b">Podfile</code>çš„æ–°æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶ä¸­ç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="4453" class="ml jy hu mg b fv mm mn l mo mp">platform :ios, '11.0'<br/><br/>    target 'RiderClient' do<br/>      use_frameworks!<br/>      pod 'GoogleMaps', '~&gt; 2.6.0'<br/>      pod 'PusherSwift', '~&gt; 5.1.1'<br/>      pod 'Alamofire', '~&gt; 4.6.0'<br/>    end</span></pre><p id="6fd7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†é¡¹ç›®éœ€è¦è¿è¡Œçš„ä¾èµ–é¡¹ã€‚<strong class="ix hv">è®°å¾—æŠŠä¸Šé¢çš„</strong> <code class="eh md me mf mg b"><strong class="ix hv">target</strong></code> <strong class="ix hv">æ”¹æˆä½ é¡¹ç›®çš„åå­—ã€‚</strong>ç°åœ¨ï¼Œåœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ä¾èµ–é¡¹:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="b5cc" class="ml jy hu mg b fv mm mn l mo mp">$ pod install</span></pre><p id="9fc4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å®‰è£…å®Œæˆåï¼Œæ‰“å¼€ç”±Cocoapodsç”Ÿæˆçš„Xcodeå·¥ä½œç©ºé—´æ–‡ä»¶ã€‚è¿™å°†é‡æ–°å¯åŠ¨Xcodeã€‚</p><p id="7979" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å½“Xcodeé‡æ–°å¯åŠ¨åï¼Œæ‰“å¼€<code class="eh md me mf mg b">Main.storyboard</code>æ–‡ä»¶ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåˆ›å»ºæ•…äº‹æ¿ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•è®¾è®¡æ•…äº‹æ¿çš„æˆªå›¾:</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mr"><img src="../Images/f5dc54d897c0fb850a68817c635bd572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G3ZRMdwb_kSUaNXuDAkyvw.png"/></div></div></figure><p id="c882" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸»è§†å›¾æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ˜¾ç¤ºæ¸¸ä¹è®¾å¤‡çŠ¶æ€ã€é©¾é©¶å‘˜è¯¦ç»†ä¿¡æ¯å’ŒCTAæŒ‰é’®çš„è§†å›¾ã€‚</p><blockquote class="ir is it"><p id="a164" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡CTAæ˜¯</em> <strong class="ix hv"> <em class="hu">å·å¬è¡ŒåŠ¨</em> </strong> <em class="hu">çš„ç¼©å†™ã€‚</em></p></blockquote><p id="c59e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨Xcodeä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf mg b">MainController.swift</code>çš„æ–°æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸Šé¢ä¸»è§†å›¾æ§åˆ¶å™¨çš„è‡ªå®šä¹‰ç±»ã€‚æ¥ä¸‹æ¥ç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="0144" class="ml jy hu mg b fv mm mn l mo mp">import UIKit<br/>    import Alamofire<br/>    import GoogleMaps</span><span id="f08f" class="ml jy hu mg b fv mq mn l mo mp">    class MainViewController: UIViewController, GMSMapViewDelegate {<br/>        var latitude = 37.388064<br/>        var longitude = -122.088426<br/>        var locationMarker: GMSMarker!</span><span id="883d" class="ml jy hu mg b fv mq mn l mo mp">        @IBOutlet weak var mapView: GMSMapView!<br/>        @IBOutlet weak var loadingIndicator: UIActivityIndicatorView!<br/>        @IBOutlet weak var loadingOverlay: UIView!<br/>        @IBOutlet weak var orderButton: UIButton!<br/>        @IBOutlet weak var orderStatusView: UIView!<br/>        @IBOutlet weak var orderStatus: UILabel!<br/>        @IBOutlet weak var cancelButton: UIButton!<br/>        @IBOutlet weak var driverDetailsView: UIView!</span><span id="0334" class="ml jy hu mg b fv mq mn l mo mp">        override func viewDidLoad() {<br/>            super.viewDidLoad()<br/>            mapView.camera = GMSCameraPosition.camera(withLatitude:latitude, longitude:longitude, zoom:15.0)<br/>            mapView.delegate = self<br/>            locationMarker = GMSMarker(position: CLLocationCoordinate2D(latitude: latitude, longitude: longitude))<br/>            locationMarker.map = mapView<br/>            orderStatusView.layer.cornerRadius = 5<br/>            orderStatusView.layer.shadowOffset = CGSize(width: 0, height: 0)<br/>            orderStatusView.layer.shadowColor = UIColor.black.cgColor<br/>            orderStatusView.layer.shadowOpacity = 0.3</span><span id="df98" class="ml jy hu mg b fv mq mn l mo mp">            updateView(status: .Neutral, msg: nil)<br/>        }<br/>    }</span></pre><p id="a1e6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æœ‰è§†å›¾æ§åˆ¶å™¨ç±»ã€‚åœ¨<code class="eh md me mf mg b">viewDidLoad</code>æˆ‘ä»¬å»ºç«‹äº†è°·æ­Œåœ°å›¾ï¼Œå¹¶è°ƒç”¨äº†<code class="eh md me mf mg b">updateView</code>æ–¹æ³•ã€‚<code class="eh md me mf mg b">updateView</code>æ–¹æ³•æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå®ƒåªæ˜¯æ ¹æ®<code class="eh md me mf mg b">RideStatus</code>æ”¹å˜æ˜¾ç¤ºçš„è§†å›¾ã€‚å°†æ–¹æ³•æ·»åŠ åˆ°ç±»ä¸­:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="b2a3" class="ml jy hu mg b fv mm mn l mo mp">private func updateView(status: RideStatus, msg: String?) {<br/>        switch status {<br/>        case .Neutral:<br/>            driverDetailsView.isHidden = true<br/>            loadingOverlay.isHidden = true<br/>            orderStatus.text = msg != nil ? msg! : "ğŸ’¡ Tap the button below to get a cab."<br/>            orderButton.setTitleColor(UIColor.white, for: .normal)<br/>            orderButton.isHidden = false<br/>            cancelButton.isHidden = true<br/>            loadingIndicator.stopAnimating()</span><span id="ee44" class="ml jy hu mg b fv mq mn l mo mp">        case .Searching:<br/>            loadingOverlay.isHidden = false<br/>            orderStatus.text = msg != nil ? msg! : "ğŸš• Looking for a cab close to you..."<br/>            orderButton.setTitleColor(UIColor.clear, for: .normal)<br/>            loadingIndicator.startAnimating()<br/>        case .FoundRide, .Arrival:<br/>            driverDetailsView.isHidden = false<br/>            loadingOverlay.isHidden = true</span><span id="dc8c" class="ml jy hu mg b fv mq mn l mo mp">            if status == .FoundRide {<br/>                orderStatus.text = msg != nil ? msg! : "ğŸ˜ Found a ride, your ride is on it's way"<br/>            } else {<br/>                orderStatus.text = msg != nil ? msg! : "â° Your driver is waiting, please meet outside."<br/>            }</span><span id="dd4d" class="ml jy hu mg b fv mq mn l mo mp">            orderStatus.text = msg != nil ? msg! : "ğŸ˜ Found a ride, your ride is on it's way"<br/>            orderButton.isHidden = true<br/>            cancelButton.isHidden = false<br/>            loadingIndicator.stopAnimating()<br/>        case .OnTrip:<br/>            orderStatus.text = msg != nil ? msg! : "ğŸ™‚ Your ride is in progress. Enjoy."<br/>            cancelButton.isEnabled = false<br/>        case .EndedTrip:<br/>            orderStatus.text = msg != nil ? msg! : "ğŸŒŸ Ride complete. Have a nice day!"<br/>            orderButton.setTitleColor(UIColor.white, for: .normal)<br/>            driverDetailsView.isHidden = true<br/>            cancelButton.isEnabled = true<br/>            orderButton.isHidden = false<br/>            cancelButton.isHidden = true<br/>        }<br/>    }</span></pre><p id="5327" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥æ˜¯è°ƒç”¨å‘APIå‘é€è¯·æ±‚çš„<code class="eh md me mf mg b">sendRequest</code>æ–¹æ³•çš„<code class="eh md me mf mg b">orderButtonPressed</code>æ–¹æ³•ã€‚ä¸‹ä¸€ä¸ªæ–¹æ³•æ˜¯<code class="eh md me mf mg b">cancelButtonPressed</code>ï¼Œå®ƒä¹Ÿè°ƒç”¨<code class="eh md me mf mg b">sendRequest</code>æ–¹æ³•ã€‚</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="88d2" class="ml jy hu mg b fv mm mn l mo mp">@IBAction func orderButtonPressed(_ sender: Any) {<br/>        updateView(status: .Searching, msg: nil)<br/><br/>        sendRequest(.post) { successful in<br/>            guard successful else {<br/>                return self.updateView(status: .Neutral, msg: "ğŸ˜” No drivers available.")<br/>            }<br/>        }<br/>    }<br/><br/>    @IBAction func cancelButtonPressed(_ sender: Any) {<br/>        sendRequest(.delete) { successful in<br/>            guard successful == false else {<br/>                return self.updateView(status: .Neutral, msg: nil)<br/>            }<br/>        }<br/>    }<br/><br/>    private func sendRequest(_ method: HTTPMethod, handler: @escaping(Bool) -&gt; Void) {<br/>        let url = AppConstants.API_URL + "/request"<br/>        let params = ["user_id": AppConstants.USER_ID]<br/><br/>        Alamofire.request(url, method: method, parameters: params)<br/>            .validate()<br/>            .responseJSON { response in<br/>                guard response.result.isSuccess,<br/>                    let data = response.result.value as? [String:Bool],<br/>                    let status = data["status"] else { return handler(false) }<br/><br/>                handler(status)<br/>            }<br/>    }</span></pre><h1 id="cc0c" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">ä½¿ç”¨Pusheré›†æˆå®æ—¶æ›´æ–°</h1><p id="7857" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç»™è§†å›¾æ§åˆ¶å™¨æ·»åŠ ä¸€äº›æ¨é€åŠŸèƒ½ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥å®æ—¶è·å–å¯¹<code class="eh md me mf mg b">RideStatus</code>çš„æ›´æ”¹ã€‚</p><p id="5499" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">é¦–å…ˆï¼Œæ‚¨éœ€è¦<code class="eh md me mf mg b">import</code>Pusher swift SDK:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="fa5a" class="ml jy hu mg b fv mm mn l mo mp">import PusherSwift</span></pre><p id="68f2" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç„¶ååœ¨ç±»çš„é¡¶éƒ¨å®šä¹‰<code class="eh md me mf mg b">pusher</code>å˜é‡:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="64bc" class="ml jy hu mg b fv mm mn l mo mp">let pusher = Pusher(<br/>        key: AppConstants.PUSHER_API_KEY,<br/>        options: PusherClientOptions(host: .cluster(AppConstants.PUSHER_API_CLUSTER))<br/>    )</span></pre><p id="a23b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œå°†ä»¥ä¸‹æ–¹æ³•æ·»åŠ åˆ°è¯¥ç±»ä¸­:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="0b1d" class="ml jy hu mg b fv mm mn l mo mp">private func listenForUpdates() {<br/>        let channel = pusher.subscribe("cabs")<br/><br/>        let _ = channel.bind(eventName: "status-update") { data in<br/>            if let data = data as? [String:AnyObject] {<br/>                if let status = data["status"] as? String, <br/>                let rideStatus = RideStatus(rawValue: status) {<br/>                    self.updateView(status: rideStatus, msg: nil)<br/>                }<br/>            }<br/>        }<br/><br/>        pusher.connect()<br/>    }</span></pre><p id="9b60" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸Šé¢çš„æ–¹æ³•åªæ˜¯è®¢é˜…äº†ä¸€ä¸ªPusheré€šé“ï¼Œå¹¶ç»‘å®šåˆ°é€šé“ä¸Šçš„<code class="eh md me mf mg b">status-update</code>äº‹ä»¶ã€‚å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œè°ƒç”¨<code class="eh md me mf mg b">updateView</code>æ–¹æ³•ã€‚</p><p id="e714" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æœ€ååœ¨<code class="eh md me mf mg b">viewDidLoad</code>æ–¹æ³•çš„åº•éƒ¨ï¼Œæ·»åŠ ä¸€ä¸ªå¯¹<code class="eh md me mf mg b">listenForUpdates</code>æ–¹æ³•çš„è°ƒç”¨:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="59dc" class="ml jy hu mg b fv mm mn l mo mp">listenForUpdates()</span></pre><p id="0c26" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨ï¼Œå½“åç«¯åº”ç”¨ç¨‹åºè§¦å‘ä¸€ä¸ªçŠ¶æ€æ›´æ–°äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬çš„rideråº”ç”¨ç¨‹åºå°†è·å–å®ƒï¼Œå¹¶æ ¹æ®éœ€è¦æ›´æ”¹UIã€‚</p><h1 id="9c99" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">è®¾ç½®è°·æ­Œåœ°å›¾</h1><p id="7d2c" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ‰“å¼€æ‚¨çš„<code class="eh md me mf mg b">AppDelegate</code>ç±»å¹¶å¯¼å…¥ä»¥ä¸‹å†…å®¹:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="7631" class="ml jy hu mg b fv mm mn l mo mp">import GoogleMaps</span></pre><p id="f627" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢<code class="eh md me mf mg b">application(didFinishLaunchingWithOptions:)</code>æ–¹æ³•:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="72ad" class="ml jy hu mg b fv mm mn l mo mp">func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {<br/>        GMSServices.provideAPIKey(AppConstants.GOOGLE_API_KEY)<br/>        return true<br/>    }</span></pre><h1 id="c8a6" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">å®šä¹‰å¯†é’¥å’Œä¹˜åçŠ¶æ€</h1><p id="9744" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf mg b">AppConstants.swift</code>çš„æ–°æ–‡ä»¶ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="9b62" class="ml jy hu mg b fv mm mn l mo mp">import Foundation</span><span id="b412" class="ml jy hu mg b fv mq mn l mo mp">    class AppConstants {<br/>        static let GOOGLE_API_KEY = "GOOGLE_MAPS_API_KEY"<br/>        static let PUSHER_API_KEY = "PUSHER_APP_KEY"<br/>        static let PUSHER_API_CLUSTER = "PUSHER_APP_CLUSTER"<br/>        static let API_URL = "http://127.0.0.1:4000"<br/>        static let USER_ID = UUID().uuidString<br/>    }</span></pre><blockquote class="ir is it"><p id="3bd0" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">âš ï¸æ‚¨éœ€è¦ç”¨å„è‡ªä»ªè¡¨æ¿ä¸­çš„å®é™…å€¼æ›¿æ¢ä¸Šé¢çš„å ä½ç¬¦ã€‚</p></blockquote><p id="31a5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf mg b">RideStatus.swift</code>çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œå®šä¹‰æ‰€æœ‰å¯ç”¨çš„æ¸¸ä¹è®¾å¤‡çŠ¶æ€:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="c3a9" class="ml jy hu mg b fv mm mn l mo mp">import Foundation<br/><br/>    enum RideStatus: String {<br/>        case Neutral = "Neutral"<br/>        case Searching = "Searching"<br/>        case FoundRide = "FoundRide"<br/>        case Arrived = "Arrived"<br/>        case OnTrip = "OnTrip"<br/>        case EndedTrip = "EndedTrip"<br/>    }</span></pre><p id="1e2c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°±æ˜¯å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„å…¨éƒ¨å†…å®¹ã€‚è®©æˆ‘ä»¬ç»§ç»­åˆ›å»ºRideråº”ç”¨ç¨‹åºã€‚</p><p id="1a8d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æˆ‘ä»¬éœ€è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯ä¿®æ”¹<code class="eh md me mf mg b">info.plist</code>æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦åœ¨<code class="eh md me mf mg b">plist</code>æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ï¼Œä»¥å…è®¸è¿æ¥åˆ°æˆ‘ä»¬çš„æœ¬åœ°æœåŠ¡å™¨:</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff ms"><img src="../Images/dd2b1f47a2b0f361ef0a0695bba2e24d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9fjgt3fWphj1p2D0.png"/></div></div></figure><p id="2fea" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è®©æˆ‘ä»¬è½¬åˆ°rideråº”ç”¨ç¨‹åºã€‚</p><h1 id="d557" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">æ„å»ºé©±åŠ¨ç¨‹åºåº”ç”¨ç¨‹åº</h1><p id="30a4" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">å¯åŠ¨Xcodeå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„â€œå•ä¸€åº”ç”¨ç¨‹åºâ€é¡¹ç›®ã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„é¡¹ç›®å‘½åä¸º<strong class="ix hv"> RiderDriverã€‚</strong></p><p id="0fcc" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œé€€å‡ºXcodeï¼Œåœ¨åˆšåˆšåˆ›å»ºçš„Xcodeé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf mg b">Podfile</code>çš„æ–°æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶ä¸­ç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="7f6f" class="ml jy hu mg b fv mm mn l mo mp">platform :ios, '11.0'<br/><br/>    target 'RiderDriver' do<br/>      use_frameworks!<br/>      pod 'PusherSwift', '~&gt; 5.1.1'<br/>      pod 'Alamofire', '~&gt; 4.6.0'<br/>      pod 'GoogleMaps', '~&gt; 2.6.0'<br/>      pod 'PushNotifications'<br/>    end</span></pre><p id="acd4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†é¡¹ç›®éœ€è¦è¿è¡Œçš„ä¾èµ–é¡¹ã€‚<strong class="ix hv">è®°å¾—æŠŠä¸Šé¢çš„</strong> <code class="eh md me mf mg b"><strong class="ix hv">target</strong></code> <strong class="ix hv">æ”¹æˆä½ é¡¹ç›®çš„åå­—ã€‚</strong>ç°åœ¨åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ä¾èµ–é¡¹:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="4549" class="ml jy hu mg b fv mm mn l mo mp">$ pod install</span></pre><p id="c769" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å®‰è£…å®Œæˆåï¼Œæ‰“å¼€ç”±Cocoapodsç”Ÿæˆçš„Xcodeå·¥ä½œç©ºé—´æ–‡ä»¶ã€‚è¿™å°†é‡æ–°å¯åŠ¨Xcodeã€‚</p><p id="f32a" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å½“Xcodeé‡æ–°å¯åŠ¨åï¼Œæ‰“å¼€<code class="eh md me mf mg b">Main.storyboard</code>æ–‡ä»¶ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåˆ›å»ºæ•…äº‹æ¿ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•è®¾è®¡æ•…äº‹æ¿çš„æˆªå›¾:</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mt"><img src="../Images/49facf88721cfb979520e7e86d0c498d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuScyTCWuJAixtseiS6ycg.png"/></div></div></figure><p id="6a43" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸»è§†å›¾æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ˜¾ç¤ºéª‘æ‰‹ä¿¡æ¯çš„è§†å›¾ï¼Œä»¥åŠæ”¹å˜æ¸¸ä¹è®¾å¤‡çŠ¶æ€æ‰€éœ€çš„æŒ‰é’®ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªéšè—çš„è§†å›¾ï¼Œå½“æ²¡æœ‰æœªå†³è¯·æ±‚æ—¶å°†ä¼šæ˜¾ç¤ºã€‚</p><p id="5eb5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨Xcodeä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf mg b">MainController.swift</code>çš„æ–°æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸Šé¢ä¸»è§†å›¾æ§åˆ¶å™¨çš„è‡ªå®šä¹‰ç±»ã€‚æ¥ä¸‹æ¥ç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="b6b5" class="ml jy hu mg b fv mm mn l mo mp">import UIKit<br/>    import Alamofire<br/>    import GoogleMaps</span><span id="c127" class="ml jy hu mg b fv mq mn l mo mp">    class MainViewController: UIViewController, GMSMapViewDelegate {<br/>        var status: RideStatus!<br/>        var locationMarker: GMSMarker!</span><span id="6dbe" class="ml jy hu mg b fv mq mn l mo mp">        @IBOutlet weak var riderName: UILabel!    <br/>        @IBOutlet weak var mapView: GMSMapView!<br/>        @IBOutlet weak var requestView: UIView!<br/>        @IBOutlet weak var noRequestsView: UIView!<br/>        @IBOutlet weak var cancelButton: UIButton!<br/>        @IBOutlet weak var statusButton: UIButton!</span><span id="077f" class="ml jy hu mg b fv mq mn l mo mp">        override func viewDidLoad() {<br/>            super.viewDidLoad()<br/>            status = .Neutral<br/>            requestView.isHidden = true<br/>            cancelButton.isHidden = true<br/>            noRequestsView.isHidden = false<br/>            Timer.scheduledTimer(<br/>                timeInterval: 2,<br/>                target: self,<br/>                selector: #selector(findNewRequests),<br/>                userInfo: nil,<br/>                repeats: true<br/>            )<br/>        }<br/>    }</span></pre><p id="4a5d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated"><code class="eh md me mf mg b">viewDidLoad</code>è®¾ç½®ç”¨æˆ·ç•Œé¢çš„åˆå§‹è®¾ç½®ã€‚ç„¶åæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªæ¯2ç§’è§¦å‘ä¸€æ¬¡<code class="eh md me mf mg b">findNewRequests</code>æ–¹æ³•çš„å®šæ—¶å™¨ã€‚è®©æˆ‘ä»¬æ¥å®šä¹‰è¿™ä¸ªæ–¹æ³•ã€‚å°†ä¸‹é¢çš„æ–¹æ³•æ·»åŠ åˆ°ç±»ä¸­:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="25f2" class="ml jy hu mg b fv mm mn l mo mp">@objc private func findNewRequests() {<br/>        guard status == .Neutral else { return }</span><span id="92b7" class="ml jy hu mg b fv mq mn l mo mp">        Alamofire.request(AppConstants.API_URL + "/pending-rider")<br/>            .validate()<br/>            .responseJSON { response in<br/>                guard response.result.isSuccess,<br/>                    let data = response.result.value as? [String:AnyObject] else { return }</span><span id="743f" class="ml jy hu mg b fv mq mn l mo mp">                self.loadRequestForRider(Rider(data: data))<br/>            }<br/>    }</span></pre><p id="e4f0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¯¥æ–¹æ³•å°†å‘åç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¦‚æœæœ‰æŒ‚èµ·çš„è¯·æ±‚ï¼Œå®ƒä¼šå°†å…¶åŠ è½½åˆ°UIã€‚ä½†æ˜¯ï¼Œé™¤éæ¸¸ä¹è®¾å¤‡çŠ¶æ€ä¸º<code class="eh md me mf mg b">Neutral</code>ï¼Œå¦åˆ™ä¸ä¼šè§¦å‘è¯·æ±‚ã€‚</p><p id="d1ff" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥è®©æˆ‘ä»¬å®šä¹‰å½“æœ‰ä¸€ä¸ªå¾…å®šçš„ä¹˜åè¯·æ±‚æ—¶è°ƒç”¨çš„<code class="eh md me mf mg b">loadRequestsForRider</code>æ–¹æ³•:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="7ce9" class="ml jy hu mg b fv mm mn l mo mp">private func loadRequestForRider(_ rider: Rider) {<br/>        mapView.camera = GMSCameraPosition.camera(withLatitude:rider.latitude, longitude:rider.longitude, zoom:15.0)<br/>        mapView.delegate = self</span><span id="6e5e" class="ml jy hu mg b fv mq mn l mo mp">        locationMarker = GMSMarker(position: CLLocationCoordinate2D(latitude: rider.latitude, longitude: rider.longitude))<br/>        locationMarker.map = mapView</span><span id="3d8a" class="ml jy hu mg b fv mq mn l mo mp">        status = .Searching<br/>        cancelButton.isHidden = false<br/>        statusButton.setTitle("Accept Trip", for: .normal)</span><span id="8b53" class="ml jy hu mg b fv mq mn l mo mp">        riderName.text = rider.name<br/>        requestView.isHidden = false<br/>        noRequestsView.isHidden = true<br/>    }</span></pre><p id="20c2" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¯¥æ–¹æ³•åªéœ€ä½¿ç”¨å‘å‡ºè¯·æ±‚çš„éª‘æ‰‹çš„ç»åº¦å’Œçº¬åº¦æ¥åŠ è½½è°·æ­Œåœ°å›¾ã€‚ç„¶åï¼Œå®ƒè¿˜å‡†å¤‡UIæ¥æ˜¾ç¤ºè¯·æ±‚ã€‚</p><p id="0eb8" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥è¦å®šä¹‰çš„æ–¹æ³•æ˜¯æ ¹æ®å„ç§äº‹ä»¶æ”¹å˜æ¸¸ä¹è®¾å¤‡çŠ¶æ€å’Œæ›´æ–°UIçš„æ–¹æ³•:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="3091" class="ml jy hu mg b fv mm mn l mo mp">private func sendStatusChange(_ status: RideStatus, handler: @escaping(Bool) -&gt; Void) {<br/>        let url = AppConstants.API_URL+"/status"<br/>        let params = ["status": status.rawValue]</span><span id="95fd" class="ml jy hu mg b fv mq mn l mo mp">        Alamofire.request(url, method: .post, parameters: params).validate()<br/>            .responseJSON { response in<br/>                guard response.result.isSuccess,<br/>                    let data = response.result.value as? [String: Bool] else { return handler(false) }</span><span id="fa25" class="ml jy hu mg b fv mq mn l mo mp">                handler(data["status"]!)<br/>            }<br/>    }</span><span id="3b0e" class="ml jy hu mg b fv mq mn l mo mp">    private func getNextStatus(after status: RideStatus) -&gt; RideStatus {<br/>        switch self.status! {<br/>        case .Neutral,<br/>                .Searching: return .FoundRide<br/>        case .FoundRide: return .Arrived<br/>        case .Arrived: return .OnTrip<br/>        case .OnTrip: return .EndedTrip<br/>        case .EndedTrip: return .Neutral<br/>        }<br/>    }</span><span id="dff3" class="ml jy hu mg b fv mq mn l mo mp">    @IBAction func cancelButtonPressed(_ sender: Any) {<br/>        if status == .FoundRide || status == .Searching {<br/>            sendStatusChange(.Neutral) { successful in<br/>                if successful {<br/>                    self.status = .Neutral<br/>                    self.requestView.isHidden = true<br/>                    self.noRequestsView.isHidden = false<br/>                }<br/>            }<br/>        }<br/>    }</span><span id="22a5" class="ml jy hu mg b fv mq mn l mo mp">    @IBAction func statusButtonPressed(_ sender: Any) {<br/>        let nextStatus = getNextStatus(after: self.status)</span><span id="2416" class="ml jy hu mg b fv mq mn l mo mp">        sendStatusChange(nextStatus) { successful in<br/>            self.status = self.getNextStatus(after: nextStatus)</span><span id="3e21" class="ml jy hu mg b fv mq mn l mo mp">            switch self.status! {<br/>            case .Neutral, .Searching:<br/>                self.cancelButton.isHidden = true<br/>            case .FoundRide:<br/>                self.cancelButton.isHidden = false<br/>                self.statusButton.setTitle("Announce Arrival", for: .normal)<br/>            case .Arrived:<br/>                self.cancelButton.isHidden = false<br/>                self.statusButton.setTitle("Start Trip", for: .normal)<br/>            case .OnTrip:<br/>                self.cancelButton.isHidden = true<br/>                self.statusButton.setTitle("End Trip", for: .normal)<br/>            case .EndedTrip:<br/>                self.status = .Neutral<br/>                self.noRequestsView.isHidden = false<br/>                self.requestView.isHidden = true<br/>                self.statusButton.setTitle("Accept Trip", for: .normal)<br/>            }<br/>        }<br/>    }</span></pre><p id="4993" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated"><code class="eh md me mf mg b">sendStatusChange</code>æ˜¯ä¸€ä¸ªåŠ©æ‰‹æ–¹æ³•ï¼Œå®ƒå‘APIå‘é€è¯·æ±‚æ¥æ”¹å˜æ¸¸ä¹è®¾å¤‡çš„çŠ¶æ€ã€‚<code class="eh md me mf mg b">getNextStatus</code>æ˜¯ä¸€ä¸ªhelperæ–¹æ³•ï¼Œå®ƒä»ä¼ é€’ç»™å®ƒçš„æ–¹æ³•ä¸­è¿”å›ä¸‹ä¸€ä¸ª<code class="eh md me mf mg b">RideStatus</code>ã€‚</p><p id="01f8" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å½“æŒ‰ä¸‹å–æ¶ˆæŒ‰é’®å¹¶è¯·æ±‚å–æ¶ˆæ¸¸ä¹è®¾å¤‡æ—¶ï¼Œè§¦å‘<code class="eh md me mf mg b">cancelButtonPressed</code>ã€‚æœ€åï¼Œ<code class="eh md me mf mg b">statusButtonPressed</code>åªæ˜¯æ ¹æ®æ¸¸ä¹è®¾å¤‡çš„å½“å‰çŠ¶æ€å‘é€ä¸€ä¸ªæ”¹å˜çŠ¶æ€çš„è¯·æ±‚ã€‚å®ƒè¿˜ä¼šæ›´æ–°UIä»¥é€‚åº”å®ƒè¢«æ›´æ”¹åˆ°çš„çŠ¶æ€ã€‚</p><h1 id="87ba" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">ä½¿ç”¨Pusheré›†æˆå®æ—¶æ›´æ–°</h1><p id="8274" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç»™è§†å›¾æ§åˆ¶å™¨æ·»åŠ ä¸€äº›PusheråŠŸèƒ½ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥å®æ—¶è·å–å¯¹<code class="eh md me mf mg b">RideStatus</code>çš„æ›´æ”¹ã€‚</p><p id="0c3c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">é¦–å…ˆï¼Œæ‚¨éœ€è¦<code class="eh md me mf mg b">import</code>Pusher swift SDK:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="bc46" class="ml jy hu mg b fv mm mn l mo mp">import PusherSwift</span></pre><p id="8c97" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç„¶ååœ¨ç±»çš„é¡¶éƒ¨å®šä¹‰<code class="eh md me mf mg b">pusher</code>å˜é‡:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="c91b" class="ml jy hu mg b fv mm mn l mo mp">let pusher = Pusher(<br/>        key: AppConstants.PUSHER_API_KEY,<br/>        options: PusherClientOptions(host: .cluster(AppConstants.PUSHER_API_CLUSTER))<br/>    )</span></pre><p id="cb6e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œå°†ä»¥ä¸‹æ–¹æ³•æ·»åŠ åˆ°è¯¥ç±»ä¸­:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="72b0" class="ml jy hu mg b fv mm mn l mo mp">private func listenForStatusUpdates() {<br/>        let channel = pusher.subscribe(channelName: "cabs")</span><span id="3fd9" class="ml jy hu mg b fv mq mn l mo mp">        let _ = channel.bind(eventName: "status-update") { data in<br/>            if let data = data as? [String: AnyObject] {<br/>                if let status = data["status"] as? String, let rideStatus = RideStatus(rawValue: status) {<br/>                    if rideStatus == .Neutral {<br/>                        self.status = .Neutral<br/>                        self.cancelButtonPressed(UIButton())<br/>                    }<br/>                }<br/>            }<br/>        }</span><span id="b445" class="ml jy hu mg b fv mq mn l mo mp">        pusher.connect()<br/>    }</span></pre><p id="af10" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸Šé¢çš„æ–¹æ³•åªæ˜¯è®¢é˜…äº†ä¸€ä¸ªæ¨é€é€šé“ï¼Œå¹¶ç»‘å®šåˆ°é€šé“ä¸Šçš„<code class="eh md me mf mg b">status-update</code>äº‹ä»¶ã€‚å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå–æ¶ˆæŒ‰é’®å‡½æ•°è¢«è°ƒç”¨ã€‚</p><p id="666b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æœ€ååœ¨<code class="eh md me mf mg b">viewDidLoad</code>æ–¹æ³•çš„åº•éƒ¨ï¼Œæ·»åŠ ä¸€ä¸ªå¯¹<code class="eh md me mf mg b">listenForStatusUpdates</code>æ–¹æ³•çš„è°ƒç”¨:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="6d40" class="ml jy hu mg b fv mm mn l mo mp">listenForStatusUpdates()</span></pre><p id="3d8c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨ï¼Œå½“åç«¯åº”ç”¨ç¨‹åºè§¦å‘ä¸€ä¸ªçŠ¶æ€æ›´æ–°äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†è·å–å®ƒï¼Œå¹¶æ ¹æ®éœ€è¦æ›´æ”¹UIã€‚</p><h1 id="0820" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">è®¾ç½®è°·æ­Œåœ°å›¾</h1><p id="4d5d" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ‰“å¼€æ‚¨çš„<code class="eh md me mf mg b">AppDelegate</code>ç±»å¹¶å¯¼å…¥ä»¥ä¸‹å†…å®¹:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="69a4" class="ml jy hu mg b fv mm mn l mo mp">import GoogleMaps</span></pre><p id="a592" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢<code class="eh md me mf mg b">application(didFinishLaunchingWithOptions:)</code>æ–¹æ³•:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="2dd2" class="ml jy hu mg b fv mm mn l mo mp">func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {<br/>        GMSServices.provideAPIKey(AppConstants.GOOGLE_API_KEY)<br/>        return true<br/>    }</span></pre><h1 id="00c9" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">å®šä¹‰å¯†é’¥å’Œä¹˜åçŠ¶æ€</h1><p id="614b" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="eh md me mf mg b">AppConstants.swift</code>çš„æ–°æ–‡ä»¶ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="d928" class="ml jy hu mg b fv mm mn l mo mp">class AppConstants {<br/>        static let GOOGLE_API_KEY = "GOOGLE_API_KEY"<br/>        static let PUSHER_KEY = "PUSHER_API_KEY"<br/>        static let PUSHER_CLUSTER = "PUSHER_API_CLUSTER"<br/>        static let API_URL = "http://127.0.0.1:4000"<br/>        static let PUSH_NOTIF_INSTANCE_ID = "PUSHER_NOTIFICATION_INSTANCE_ID"<br/>        static let USER_ID = UUID().uuidString<br/>    }</span></pre><blockquote class="ir is it"><p id="c771" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> âš ï¸æ‚¨éœ€è¦å°†ä¸Šé¢çš„å ä½ç¬¦æ›¿æ¢ä¸ºå„è‡ªä»ªè¡¨æ¿ä¸­çš„å®é™…å€¼ã€‚</em></p></blockquote><p id="c227" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸¤ä¸ªåä¸º<code class="eh md me mf mg b">Rider.swift</code>å’Œ<code class="eh md me mf mg b">RideStatus.swift</code>çš„æ–‡ä»¶ï¼Œç„¶åå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°æ–‡ä»¶ä¸­:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="f4c4" class="ml jy hu mg b fv mm mn l mo mp">// Rider.swift<br/>    import Foundation</span><span id="7303" class="ml jy hu mg b fv mq mn l mo mp">    struct Rider {<br/>        let name: String<br/>        let longitude: Double<br/>        let latitude: Double</span><span id="d4f0" class="ml jy hu mg b fv mq mn l mo mp">        init(data: [String:AnyObject]) {<br/>            self.name = data["name"] as! String<br/>            self.longitude = data["longitude"] as! Double<br/>            self.latitude = data["latitude"] as! Double<br/>        }<br/>    }</span><span id="60c6" class="ml jy hu mg b fv mq mn l mo mp">// RideStatus.swift<br/>    import Foundation</span><span id="358b" class="ml jy hu mg b fv mq mn l mo mp">    enum RideStatus: String {<br/>        case Neutral = "Neutral"<br/>        case Searching = "Searching"<br/>        case FoundRide = "FoundRide"<br/>        case Arrived = "Arrived"<br/>        case OnTrip = "OnTrip"<br/>        case EndedTrip = "EndedTrip"<br/>    }</span></pre><p id="dfd1" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">éª‘æ‰‹åº”ç”¨ç¨‹åºåˆ°æ­¤ä¸ºæ­¢ã€‚æˆ‘ä»¬éœ€è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯ä¿®æ”¹<code class="eh md me mf mg b">info.plist</code>æ–‡ä»¶ï¼Œå°±åƒæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­åšçš„é‚£æ ·ã€‚</p><p id="8250" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥è¿è¡Œå®ƒä»¬æ¥æŸ¥çœ‹å®ƒä»¬çš„è¿è¡Œæƒ…å†µã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨åº”ç”¨ç¨‹åºä¸­æ·»åŠ æ¨é€é€šçŸ¥ã€‚æˆ‘ä»¬éœ€è¦è¿™æ ·åšï¼Œè¿™æ ·å½“åº”ç”¨ç¨‹åºæœ€å°åŒ–æ—¶ï¼Œç”¨æˆ·å¯ä»¥çŸ¥é“æœåŠ¡ä¸Šæœ‰ä¸€ä¸ªäº‹ä»¶ã€‚</p><p id="b5ab" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è®©æˆ‘ä»¬æ¥è®¾ç½®æ¨é€é€šçŸ¥ã€‚</p><h1 id="ec6b" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">å‘æˆ‘ä»¬çš„iOSåº”ç”¨ç¨‹åºæ·»åŠ æ¨é€é€šçŸ¥</h1><p id="6136" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯è®©æˆ‘ä»¬çš„æœåŠ¡å™¨èƒ½å¤Ÿå‘é€æ¨é€é€šçŸ¥ã€‚</p><p id="5af4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ­¤æ—¶ï¼Œåº”ç”¨ç¨‹åºå¼€ç®±å³å¯æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬ç°åœ¨éœ€è¦å‘åº”ç”¨ç¨‹åºæ·»åŠ æ¨é€é€šçŸ¥ï¼Œä»¥ä½¿å…¶æ›´å…·å¸å¼•åŠ›ï¼Œå³ä½¿ç”¨æˆ·å½“å‰æ²¡æœ‰ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºã€‚</p><blockquote class="ir is it"><p id="9aa9" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> âš ï¸æ‚¨éœ€è¦</em> <a class="ae jw" href="https://developer.apple.com/programs/enroll/" rel="noopener ugc nofollow" target="_blank"> <em class="hu">æ³¨å†Œè‹¹æœå¼€å‘è€…è®¡åˆ’</em> </a> <em class="hu">æ‰èƒ½ä½¿ç”¨æ¨é€é€šçŸ¥åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œæ¨é€é€šçŸ¥ä¸èƒ½åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œï¼Œå› æ­¤æ‚¨éœ€è¦ä¸€ä¸ªå®é™…çš„iOSè®¾å¤‡æ¥æµ‹è¯•ã€‚</em></p></blockquote><p id="7ef7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">Pusherçš„<a class="ae jw" href="https://pusher.com/push-notifications" rel="noopener ugc nofollow" target="_blank"> Beams API </a>å¯¹åŸç”ŸiOSåº”ç”¨æœ‰ä¸€æµçš„æ”¯æŒã€‚æ‚¨çš„iOSåº”ç”¨ç¨‹åºå®ä¾‹è®¢é˜…äº†<strong class="ix hv">å…´è¶£</strong>ï¼›ç„¶åï¼Œæ‚¨çš„æœåŠ¡å™¨å‘è¿™äº›å…´è¶£å‘é€æ¨é€é€šçŸ¥ã€‚è®¢é˜…è¯¥å…´è¶£çš„æ¯ä¸ªåº”ç”¨å®ä¾‹éƒ½å°†æ”¶åˆ°é€šçŸ¥ï¼Œå³ä½¿è¯¥åº”ç”¨å½“æ—¶æœªåœ¨è®¾å¤‡ä¸Šæ‰“å¼€ã€‚</p><p id="d993" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æœ¬èŠ‚ä»‹ç»å¦‚ä½•è®¾ç½®iOSåº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿é€šè¿‡Pusheræ¥æ”¶å…³äºæ‚¨çš„é£Ÿå“äº¤ä»˜è®¢å•çš„äº¤æ˜“æ¨é€é€šçŸ¥ã€‚</p><h1 id="99c0" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">é…ç½®APN</h1><p id="86c7" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">Pusherä¾é è‹¹æœæ¨é€é€šçŸ¥æœåŠ¡(APNs)ä»£è¡¨ä½ å‘iOSåº”ç”¨ç”¨æˆ·å‘é€æ¨é€é€šçŸ¥ã€‚å½“æˆ‘ä»¬å‘é€æ¨é€é€šçŸ¥æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‚¨çš„APNså¯†é’¥ã€‚æœ¬é¡µå°†æŒ‡å¯¼æ‚¨å®Œæˆè·å–APNså¯†é’¥çš„è¿‡ç¨‹ï¼Œä»¥åŠå¦‚ä½•å°†å¯†é’¥æä¾›ç»™Pusherã€‚</p><p id="6080" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç‚¹å‡»<a class="ae jw" href="https://developer.apple.com/account" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>è¿›å…¥è‹¹æœå¼€å‘è€…ä»ªè¡¨æ¿ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„å¯†é’¥ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/bf7f8bb42415d9b09ec0c962f4f7a76b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*sLUJGDbwWL4ef5wQ."/></div></figure><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/2dc9a5c356607d8ed04164032a233e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*qIP__o6ST22oPkBs.gif"/></div></figure><p id="a609" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åˆ›å»ºå¯†é’¥åï¼Œä¸‹è½½å®ƒã€‚è¯·å¦¥å–„ä¿ç®¡ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ç”¨åˆ°å®ƒã€‚</p><blockquote class="ir is it"><p id="7889" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> âš ï¸ä½ å¿…é¡»å¦¥å–„ä¿ç®¡ç”Ÿæˆçš„å¯†é’¥ï¼Œå› ä¸ºä¸€æ—¦ä¸¢å¤±å°±æ— æ³•æ‰¾å›ã€‚</em></p></blockquote><h1 id="f99a" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">åˆ›å»ºæ‚¨çš„Pusheråº”ç”¨ç¨‹åº</h1><p id="13a6" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æ¥ä¸‹æ¥ä½ éœ€è¦åšçš„æ˜¯ä»<a class="ae jw" href="https://dash.pusher.com" rel="noopener ugc nofollow" target="_blank"> Pusherä»ªè¡¨æ¿</a>åˆ›å»ºä¸€ä¸ªæ–°çš„Pusher Pushé€šçŸ¥åº”ç”¨ç¨‹åºã€‚</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mv"><img src="../Images/111de1ef9702ada2bf7f35b885549ce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MfRs3THsH3Tb6byg.png"/></div></div></figure><p id="d9b6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åˆ›å»ºåº”ç”¨ç¨‹åºåï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªå¿«é€Ÿå¯åŠ¨å‘å¯¼ï¼Œå®ƒå°†å¸®åŠ©æ‚¨è®¾ç½®åº”ç”¨ç¨‹åºã€‚</p><p id="092b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸ºäº†é…ç½®æ¨é€é€šçŸ¥ï¼Œæ‚¨éœ€è¦ä»Appleè·å¾—ä¸€ä¸ªAPNså¯†é’¥ã€‚è¿™ä¸æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­ä¸‹è½½çš„å¯†é’¥ç›¸åŒã€‚è·å¾—å¯†é’¥åï¼Œå°†å…¶ä¸Šä¼ åˆ°å¿«é€Ÿå…¥é—¨å‘å¯¼ã€‚</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mv"><img src="../Images/a43e0475eaaac62779cc610b7a73fdd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NP67Q60tjAK7Zhrd.png"/></div></div></figure><p id="a4f0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¾“å…¥æ‚¨çš„Appleå›¢é˜ŸIDã€‚ä½ å¯ä»¥ä»<a class="ae jw" href="https://developer.apple.com/account/#/membership" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>è·å–å›¢é˜ŸIDã€‚ç‚¹å‡»ç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥ã€‚</p><h1 id="4d8d" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">æ›´æ–°æ‚¨çš„éª‘æ‰‹åº”ç”¨ç¨‹åºä»¥æ”¯æŒæ¨é€é€šçŸ¥</h1><p id="f566" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">åœ¨æ‚¨çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœæ‚¨è¿˜æ²¡æœ‰ï¼Œè¯·æ‰“å¼€<code class="eh md me mf mg b">Podfile</code>å¹¶å°†ä»¥ä¸‹podæ·»åŠ åˆ°ä¾èµ–é¡¹åˆ—è¡¨ä¸­:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="4b83" class="ml jy hu mg b fv mm mn l mo mp">pod 'PushNotifications'</span></pre><p id="a005" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨åƒå‰é¢ä¸€æ ·è¿è¡Œ<code class="eh md me mf mg b">pod install</code>å‘½ä»¤æ¥è·å–é€šçŸ¥åŒ…ã€‚æ¥ä¸‹æ¥æ‰“å¼€<code class="eh md me mf mg b">AppDelegate</code>ç±»å¹¶å¯¼å…¥<code class="eh md me mf mg b">PushNotifications</code>åŒ…:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="b051" class="ml jy hu mg b fv mm mn l mo mp">import PushNotifications</span></pre><p id="6a58" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨ï¼Œä½œä¸º<code class="eh md me mf mg b">AppDelegate</code>ç±»çš„ä¸€éƒ¨åˆ†ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="335c" class="ml jy hu mg b fv mm mn l mo mp">let pushNotifications = PushNotifications.shared</span><span id="4c5d" class="ml jy hu mg b fv mq mn l mo mp">    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {<br/>      // [...]</span><span id="0532" class="ml jy hu mg b fv mq mn l mo mp">      self.pushNotifications.start(instanceId: "PUSHER_NOTIF_INSTANCE_ID")<br/>      self.pushNotifications.registerForRemoteNotifications()</span><span id="3f97" class="ml jy hu mg b fv mq mn l mo mp">      // [...]</span><span id="c93d" class="ml jy hu mg b fv mq mn l mo mp">      return true<br/>    }</span><span id="92bd" class="ml jy hu mg b fv mq mn l mo mp">    func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {<br/>      // [...]</span><span id="152a" class="ml jy hu mg b fv mq mn l mo mp">      self.pushNotifications.registerDeviceToken(deviceToken) {<br/>        try? self.pushNotifications.subscribe(interest: "rider_\(AppConstants.USER_ID)")<br/>      }</span><span id="5a9c" class="ml jy hu mg b fv mq mn l mo mp">      // [...]<br/>    }</span></pre><blockquote class="ir is it"><p id="c1a3" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡å°†</em> <code class="eh md me mf mg b"><em class="hu">PUSHER_PUSH_NOTIF_INSTANCE_ID</em></code> <em class="hu">æ›¿æ¢ä¸ºPusheråº”ç”¨ç¨‹åºç»™ä½ çš„å¯†é’¥ã€‚</em></p></blockquote><p id="89fa" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨<code class="eh md me mf mg b">application(didFinishLaunchingWithOptions:)</code>æ–¹æ³•ä¸­è®¾ç½®äº†æ¨é€é€šçŸ¥ï¼Œç„¶åæˆ‘ä»¬è®¢é˜…äº†<code class="eh md me mf mg b">application(didRegisterForRemoteNotificationsWithDeviceToken:)</code>æ–¹æ³•ä¸­çš„å…´è¶£ã€‚</p><p id="ac56" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åŠ¨æ€å…´è¶£æ¼”ç¤ºäº†å¦‚ä½•è½»æ¾åœ°ä¸ºç‰¹å®šè®¾å¤‡æˆ–ç”¨æˆ·ä½¿ç”¨ç‰¹å®šå…´è¶£ã€‚åªè¦æœåŠ¡å™¨æ¨é€è‡³æ­£ç¡®çš„å…´è¶£ï¼Œæ‚¨å°±å¯ä»¥æ”¾å¿ƒï¼Œè®¢é˜…è¯¥å…´è¶£çš„è®¾å¤‡å°†ä¼šæ”¶åˆ°æ¨é€é€šçŸ¥ã€‚</p><p id="e016" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºåº”ç”¨ç¨‹åºå¯ç”¨æ¨é€é€šçŸ¥ã€‚åœ¨é¡¹ç›®å¯¼èˆªå™¨ä¸­ï¼Œé€‰æ‹©æ‚¨çš„é¡¹ç›®ï¼Œå¹¶ç‚¹å‡»<em class="iw">åŠŸèƒ½</em>é€‰é¡¹å¡ã€‚<a class="ae jw" href="http://help.apple.com/xcode/mac/current/#/devdfd3d04a1" rel="noopener ugc nofollow" target="_blank">æ‰“å¼€å¼€å…³ï¼Œå¯ç”¨æ¨é€é€šçŸ¥</a>ã€‚</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mv"><img src="../Images/4456d38db19f54991c6fb16d147bcc6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WaRPOSiBcHdqNdIW.png"/></div></div></figure><h1 id="6856" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">æ›´æ–°æ‚¨çš„é©±åŠ¨ç¨‹åºåº”ç”¨ç¨‹åºä»¥æ”¯æŒæ¨é€é€šçŸ¥</h1><p id="991b" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">ä½ çš„rideråº”ç”¨ç¨‹åºä¹Ÿéœ€è¦èƒ½å¤Ÿæ¥æ”¶æ¨é€é€šçŸ¥ã€‚è¯¥è¿‡ç¨‹ç±»ä¼¼äºä¸Šé¢çš„è®¾ç½®ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯æˆ‘ä»¬å°†åœ¨<code class="eh md me mf mg b">AppDelegate</code>ä¸­è®¤è´­çš„åˆ©æ¯ï¼Œè¿™å°†æ˜¯<strong class="ix hv"> ride_requests </strong>ã€‚</p><h1 id="1301" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">å‘iOSä¸Šçš„æ¨é€é€šçŸ¥æ·»åŠ ä¸°å¯Œçš„æ“ä½œ</h1><h1 id="f3e3" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">å‘iOSä¸Šçš„æ¨é€é€šçŸ¥æ·»åŠ ä¸°å¯Œçš„æ“ä½œ</h1><p id="f125" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æŒ‰ç…§ç›®å‰çš„æƒ…å†µï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†èƒ½å¤Ÿæ¥æ”¶æ¨é€é€šçŸ¥ï¼Œä½†è®©æˆ‘ä»¬æ›´è¿›ä¸€æ­¥ï¼Œå‘åº”ç”¨ç¨‹åºæ·»åŠ ä¸°å¯Œçš„æ“ä½œã€‚è¿™å°†å¢åŠ é€šçŸ¥çš„å‚ä¸åº¦ã€‚</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/7e64b058f37d57e056ae854a8c6d1b17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*WnSS7TAG8UXPBnV4.gif"/></div></figure><p id="531e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">é¦–å…ˆï¼Œæ‰“å¼€<code class="eh md me mf mg b">AppDelegate</code>ç±»å¹¶å¯¼å…¥ä»¥ä¸‹ç±»:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="356c" class="ml jy hu mg b fv mm mn l mo mp">import PushNotifications<br/>    import UserNotifications</span></pre><p id="fe38" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦ç”¨ç±»æ‰©å±•<code class="eh md me mf mg b">AppDelegate</code>ã€‚ç„¶åæ·»åŠ ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="f6bf" class="ml jy hu mg b fv mm mn l mo mp">func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {<br/>        // [...]    </span><span id="fc48" class="ml jy hu mg b fv mq mn l mo mp">        let center = UNUserNotificationCenter.current()<br/>        center.delegate = self</span><span id="d9e9" class="ml jy hu mg b fv mq mn l mo mp">        let cancelAction = UNNotificationAction(<br/>            identifier: "cancel", <br/>            title: "Reject", <br/>            options: [.foreground]<br/>        )</span><span id="1721" class="ml jy hu mg b fv mq mn l mo mp">        let acceptAction = UNNotificationAction(<br/>            identifier: "accept", <br/>            title: "Accept Request", <br/>            options: [.foreground]<br/>        )</span><span id="26b5" class="ml jy hu mg b fv mq mn l mo mp">        let category = UNNotificationCategory(<br/>            identifier: "DriverActions", <br/>            actions: [acceptAction, cancelAction], <br/>            intentIdentifiers: []<br/>        )</span><span id="c927" class="ml jy hu mg b fv mq mn l mo mp">        center.setNotificationCategories([category])</span><span id="16dc" class="ml jy hu mg b fv mq mn l mo mp">        // [...]</span><span id="fa2e" class="ml jy hu mg b fv mq mn l mo mp">        return true<br/>    }</span></pre><p id="04e5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†å¸Œæœ›æ¨é€é€šçŸ¥æ˜¾ç¤ºçš„<a class="ae jw" href="https://developer.apple.com/documentation/usernotifications/unnotificationaction" rel="noopener ugc nofollow" target="_blank">åŠ¨ä½œ</a>ã€‚</p><p id="c52e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨åŒä¸€ä¸ª<code class="eh md me mf mg b">AppDelegate</code>ç±»ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼Œå½“åœ¨æ¨é€é€šçŸ¥ä¸­é€‰æ‹©åŠ¨ä½œæ—¶ï¼Œè¯¥æ–¹æ³•å°†å¤„ç†è¿™äº›åŠ¨ä½œ:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="6241" class="ml jy hu mg b fv mm mn l mo mp">func userNotificationCenter(_ center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping () -&gt; Void) {<br/>        let name = Notification.Name("status")</span><span id="be3a" class="ml jy hu mg b fv mq mn l mo mp">        if response.actionIdentifier == "cancel" {<br/>            NotificationCenter.default.post(name: name, object: nil, userInfo: ["status": RideStatus.Neutral])<br/>        }</span><span id="73ac" class="ml jy hu mg b fv mq mn l mo mp">        if response.actionIdentifier == "accept" {<br/>            NotificationCenter.default.post(name: name, object: nil, userInfo: ["status": RideStatus.FoundRide])<br/>        }</span><span id="290e" class="ml jy hu mg b fv mq mn l mo mp">        completionHandler()<br/>    }</span></pre><p id="f48b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨ç‚¹å‡»æ¨é€é€šçŸ¥åŠ¨ä½œæ—¶å‘é€ä¸€ä¸ªæœ¬åœ°é€šçŸ¥ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨è§†å›¾æ§åˆ¶å™¨ä¸­æ·»åŠ ä¸€ä¸ªè§‚å¯Ÿå™¨ï¼Œå®ƒå°†åœ¨æ”¶åˆ°é€šçŸ¥æ—¶è§¦å‘ä¸€äº›ä»£ç ã€‚</p><p id="a7b1" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€<code class="eh md me mf mg b">MainViewController</code>ç±»å¹¶åœ¨<code class="eh md me mf mg b">viewDidLoad</code>æ–¹æ³•ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="ce2b" class="ml jy hu mg b fv mm mn l mo mp">NotificationCenter.default.addObserver(<br/>        self,<br/>        selector: #selector(changeStatusFromPushNotification),<br/>        name: Notification.Name("status"),<br/>        object: nil<br/>    )</span></pre><p id="9510" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œå°†<code class="eh md me mf mg b">changeStatusFromPushNotification</code>æ–¹æ³•æ·»åŠ åˆ°è¯¥ç±»ä¸­:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="783a" class="ml jy hu mg b fv mm mn l mo mp">@objc private func changeStatusFromPushNotification(notification: Notification) {<br/>        guard<br/>            let data = notification.userInfo as? [String: RideStatus],<br/>            let status = data["status"] else { return }</span><span id="0162" class="ml jy hu mg b fv mq mn l mo mp">        sendStatusChange(status) { successful in<br/>            guard successful else { return }</span><span id="ff5a" class="ml jy hu mg b fv mq mn l mo mp">            if status == .Neutral {<br/>                self.status = .FoundRide<br/>                self.cancelButtonPressed(UIButton())<br/>            }</span><span id="95f8" class="ml jy hu mg b fv mq mn l mo mp">            if status == .FoundRide {<br/>                self.status = .Searching<br/>                self.statusButtonPressed(UIButton())<br/>            }<br/>        }<br/>    }</span></pre><p id="aff0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™ä¸ªå›è°ƒåªæ˜¯è§¦å‘äº†æˆ‘ä»¬åœ¨å‰é¢çš„æ•™ç¨‹ä¸­å·²ç»å®šä¹‰çš„<code class="eh md me mf mg b">sendStatusChange</code>æ–¹æ³•ã€‚</p><h1 id="d3b7" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">åˆ›å»ºæˆ‘ä»¬çš„é€šçŸ¥æœåŠ¡æ‰©å±•</h1><p id="82c5" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºé€šçŸ¥æœåŠ¡æ‰©å±•ã€‚</p><blockquote class="ir is it"><p id="890b" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡å½“åœ¨iOSåº”ç”¨ç¨‹åºä¸­æ”¶åˆ°é€šçŸ¥æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›èƒ½å¤Ÿä¸‹è½½å†…å®¹ä»¥å“åº”é€šçŸ¥ï¼Œæˆ–è€…åœ¨å†…å®¹æ˜¾ç¤ºç»™ç”¨æˆ·ä¹‹å‰å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚åœ¨iOS 10ä¸­ï¼Œè‹¹æœç°åœ¨å…è®¸åº”ç”¨ç¨‹åºé€šè¿‡ä¸€ä¸ªæ–°çš„</em> <strong class="ix hv"> <em class="hu">é€šçŸ¥æœåŠ¡æ‰©å±•</em> </strong> <em class="hu">æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚â€” </em> <a class="ae jw" href="https://code.tutsplus.com/tutorials/ios-10-notification-service-extensions--cms-27550" rel="noopener ugc nofollow" target="_blank"> <em class="hu">ä»£ç </em> </a></p></blockquote><p id="a93b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨Xcodeä¸­ï¼Œè½¬åˆ°<strong class="ix hv">æ–‡ä»¶&gt;æ–°å»º&gt;ç›®æ ‡â€¦â€¦</strong>ï¼Œé€‰æ‹©<strong class="ix hv">é€šçŸ¥æœåŠ¡æ‰©å±•</strong>ï¼Œç„¶åç»™ç›®æ ‡å‘½åï¼Œç‚¹å‡»<strong class="ix hv">å®Œæˆ</strong>ã€‚</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mv"><img src="../Images/2844765b765c8c406a9ac34d26c64b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oEHpO7fj6paC4_Tk.png"/></div></div></figure><p id="6073" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å¦‚æœæ‚¨åœ¨Xcodeçš„æ–‡ä»¶æµè§ˆå™¨ä¸­æŸ¥çœ‹ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°æ·»åŠ äº†ä¸¤ä¸ªæ–°æ–‡ä»¶çš„æ–°ç›®æ ‡:<code class="eh md me mf mg b">NotificationService.swift</code>å’Œ<code class="eh md me mf mg b">info.plist</code>ã€‚æˆ‘ä»¬å°†ä¿®æ”¹è¿™äº›æ–‡ä»¶ï¼Œä»¥ç¡®ä¿å®ƒä¸ºæˆ‘ä»¬çš„æ¨é€é€šçŸ¥è·å–å¹¶æä¾›æ­£ç¡®çš„ä¿¡æ¯ã€‚</p><p id="23a7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€<code class="eh md me mf mg b">NotificationService</code>ç±»å¹¶ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢<code class="eh md me mf mg b">didReceive</code>æ–¹æ³•:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="775a" class="ml jy hu mg b fv mm mn l mo mp">override func didReceive(_ request: UNNotificationRequest, withContentHandler contentHandler: @escaping (UNNotificationContent) -&gt; Void) {<br/>        self.contentHandler = contentHandler<br/>        bestAttemptContent = (request.content.mutableCopy() as? UNMutableNotificationContent)</span><span id="3fe6" class="ml jy hu mg b fv mq mn l mo mp">        func failEarly() {<br/>            contentHandler(request.content)<br/>        }</span><span id="c32b" class="ml jy hu mg b fv mq mn l mo mp">        guard<br/>            let content = (request.content.mutableCopy() as? UNMutableNotificationContent),<br/>            let apnsData = content.userInfo["data"] as? [String: Any],<br/>            let mapURL = apnsData["attachment-url"] as? String,<br/>            let attachmentURL = URL(string: mapURL.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed)!),<br/>            let imageData = try? NSData(contentsOf: attachmentURL, options: NSData.ReadingOptions()),<br/>            let attachment = UNNotificationAttachment.create(imageFileIdentifier: "image.png", data: imageData, options: nil)<br/>        else {<br/>            return failEarly()<br/>        }</span><span id="9c86" class="ml jy hu mg b fv mq mn l mo mp">        content.attachments = [attachment]<br/>        contentHandler(content.copy() as! UNNotificationContent)<br/>    }</span></pre><p id="51dc" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾è·å–æ¨é€é€šçŸ¥çš„å†…å®¹ã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨é€šçŸ¥ä¸­æ˜¾ç¤ºåœ°å›¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›ä»æ¨é€é€šçŸ¥çš„è‡ªå®šä¹‰æ•°æ®ä¸­è·å¾—ä¸€ä¸ªé™æ€åœ°å›¾URLã€‚æˆ‘ä»¬ä½¿ç”¨å®ƒå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ª<code class="eh md me mf mg b">attachment</code>æ¥æ·»åŠ åˆ°æ¨é€çš„å†…å®¹ä¸­ã€‚æˆ‘ä»¬æœ€ç»ˆå°†<code class="eh md me mf mg b">content</code>ä¼ é€’ç»™<code class="eh md me mf mg b">contentHandler</code>ã€‚</p><p id="2d9c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œå°†ä»¥ä¸‹æ‰©å±•åæ·»åŠ åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="7289" class="ml jy hu mg b fv mm mn l mo mp">extension UNNotificationAttachment {</span><span id="3978" class="ml jy hu mg b fv mq mn l mo mp">        static func create(imageFileIdentifier: String, data: NSData, options: [NSObject : AnyObject]?) -&gt; UNNotificationAttachment? {<br/>            let fileManager = FileManager.default<br/>            let tmpSubFolderName = ProcessInfo.processInfo.globallyUniqueString<br/>            let tmpSubFolderURL = NSURL(fileURLWithPath: NSTemporaryDirectory()).appendingPathComponent(tmpSubFolderName, isDirectory: true)</span><span id="f275" class="ml jy hu mg b fv mq mn l mo mp">            do {<br/>                try fileManager.createDirectory(at: tmpSubFolderURL!, withIntermediateDirectories: true, attributes: nil)<br/>                let fileURL = tmpSubFolderURL?.appendingPathComponent(imageFileIdentifier)<br/>                try data.write(to: fileURL!, options: [])<br/>                let imageAttachment = try UNNotificationAttachment(identifier: imageFileIdentifier, url: fileURL!, options: options)<br/>                return imageAttachment<br/>            } catch let error {<br/>                print("error \(error)")<br/>            }</span><span id="ddce" class="ml jy hu mg b fv mq mn l mo mp">            return nil<br/>        }<br/>    }</span></pre><p id="ecb6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated"><code class="eh md me mf mg b">create</code>æ–¹æ³•å°†é™æ€åœ°å›¾ä¿å­˜åˆ°è®¾å¤‡ä¸Šçš„ä¸€ä¸ªä¸´æ—¶ä½ç½®ï¼Œè¿™æ ·å°±ä¸å¿…ä»URLåŠ è½½äº†ã€‚</p><p id="3520" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æˆ‘ä»¬æƒ³è¦åšçš„æœ€åä¸€ä¸ªæ›´æ”¹æ˜¯åœ¨<code class="eh md me mf mg b">info.plist</code>æ–‡ä»¶ä¸­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æƒ³è¦æ³¨å†Œæ¨é€é€šçŸ¥çš„æ‰€æœ‰åŠ¨ä½œæ ‡è¯†ç¬¦ã€‚æ‰“å¼€<code class="eh md me mf mg b">info.plist</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹å›¾ä¸­é«˜äº®æ˜¾ç¤ºçš„å†…å®¹ï¼›</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mv"><img src="../Images/a59cf7903c8676e11ced34d1ccf2a45b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XNkiY139HJPGFDQi.png"/></div></div></figure><p id="af8f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°±æ˜¯æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºç«¯éœ€è¦åšçš„å…¨éƒ¨å·¥ä½œã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ç¡®ä¿APIå‘é€æ¨é€é€šçŸ¥ã€‚</p><h1 id="0916" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">ä»Node.js APIå‘é€æ¨é€é€šçŸ¥</h1><p id="a6b6" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">åœ¨Node.jsé¡¹ç›®ä¸­ï¼Œæ‰“å¼€æˆ‘ä»¬çš„<code class="eh md me mf mg b">index.js</code>æ–‡ä»¶å¹¶å¯¼å…¥æ¨é€é€šçŸ¥åŒ…:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="b324" class="ml jy hu mg b fv mm mn l mo mp">const PushNotifications = require('pusher-push-notifications-node')<br/>    const pushNotifications = new PushNotifications({<br/>        instanceId: 'YOUR_INSTANCE_ID_HERE',<br/>        secretKey: 'YOUR_SECRET_KEY_HERE'<br/>    })</span></pre><blockquote class="ir is it"><p id="5f62" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡æ‚¨åº”è¯¥ç”¨Pusherä»ªè¡¨æ¿ä¸­çš„å€¼æ›¿æ¢å ä½ç¬¦å€¼ã€‚</em></p></blockquote><p id="896c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ·»åŠ ä»¥ä¸‹åŠ©æ‰‹å‡½æ•°:</p><pre class="ls lt lu lv fq mh mg mi mj aw mk dt"><span id="b937" class="ml jy hu mg b fv mm mn l mo mp">function sendRiderPushNotificationFor(status) {<br/>        switch (status) {<br/>            case "Neutral":<br/>                var alert = {<br/>                    "title": "Driver Cancelled :(",<br/>                    "body": "Sorry your driver had to cancel. Open app to request again.",<br/>                }<br/>                break;<br/>            case "FoundRide":<br/>                var alert = {<br/>                    "title": "ğŸš• Found a ride",<br/>                    "body": "The driver is on the way."<br/>                }<br/>                break;<br/>            case "Arrived":<br/>                var alert = {<br/>                    "title": "ğŸš• Driver is waiting",<br/>                    "body": "The driver outside, please meet him."                <br/>                }<br/>                break;<br/>            case "OnTrip":<br/>                var alert = {<br/>                    "title": "ğŸš• You are on your way",<br/>                    "body": "The driver has started the trip. Enjoy your ride."<br/>                }<br/>                break;<br/>            case "EndedTrip":<br/>                var alert = {<br/>                    "title": "ğŸŒŸ Ride complete",<br/>                    "body": "Your ride cost $15. Open app to rate the driver."<br/>                }<br/>                break;<br/>        }<br/>        if (alert != undefined) {<br/>            pushNotifications.publish(['rider'], {apns: {aps: {alert, sound: "default"}}})<br/>                .then(resp =&gt; console.log('Just published:', resp.publishId))<br/>                .catch(err =&gt; console.log('Error:', err))<br/>        }<br/>    }</span><span id="cfab" class="ml jy hu mg b fv mq mn l mo mp">    function sendDriverPushNotification() {<br/>        pushNotifications.publish(['ride_requests'], {<br/>            "apns": {<br/>                "aps": {<br/>                    "alert": {<br/>                        "title": "ğŸš— New Ride Request",<br/>                        "body": `New pick up request from ${rider.name}.`,<br/>                    },<br/>                    "category": "DriverActions",<br/>                    "mutable-content": 1,<br/>                    "sound": 'default'<br/>                },<br/>                "data": {<br/>                    "attachment-url": "https://maps.google.com/maps/api/staticmap?markers=color:red|37.388064,-122.088426&amp;zoom=13&amp;size=500x300&amp;sensor=true"<br/>                }<br/>            }<br/>        })<br/>        .then(response =&gt; console.log('Just published:', response.publishId))<br/>        .catch(error =&gt; console.log('Error:', error));<br/>    }</span></pre><p id="bd48" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸Šé¢æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯<code class="eh md me mf mg b">sendRiderPushNotificationFor</code>ï¼Œå®ƒæ ¹æ®æ—…è¡Œçš„çŠ¶æ€å‘ä¹˜å®¢å‘é€é€šçŸ¥ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯<code class="eh md me mf mg b">sendDriverPushNotification</code>,å®ƒåªæ˜¯å‘å¸æœºå‘é€ä¸€ä¸ªé€šçŸ¥ã€‚</p><p id="fab7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨<code class="eh md me mf mg b">sendDriverPushNotification</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¨é€é€šçŸ¥çš„æ ¼å¼ä¸ç¬¬ä¸€ä¸ªç•¥æœ‰ä¸åŒã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ”¯æŒä¸°å¯Œçš„åŠ¨ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŒ‡å®š<code class="eh md me mf mg b">category</code>é”®å’Œ<code class="eh md me mf mg b">mutable-content</code>é”®ã€‚<code class="eh md me mf mg b">category</code>å¿…é¡»åŒ¹é…æˆ‘ä»¬åœ¨<code class="eh md me mf mg b">AppDelegate</code>ä¸­æŒ‡å®šçš„åç§°ã€‚</p><p id="6c60" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åœ¨å„è‡ªçš„è·¯å¾„ä¸­è°ƒç”¨ä¸Šé¢çš„å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°åº”è¯¥æ·»åŠ åˆ°<code class="eh md me mf mg b">POST /status</code>è·¯å¾„ä¸­ï¼Œåœ¨<code class="eh md me mf mg b">pusher.trigger</code>æ–¹æ³•è°ƒç”¨ä¹‹ä¸Šã€‚ç¬¬äºŒä¸ªå‡½æ•°åº”è¯¥åœ¨<code class="eh md me mf mg b">pusher.trigger</code>æ–¹æ³•è°ƒç”¨ä¸Šé¢çš„<code class="eh md me mf mg b">POST /request</code>è·¯å¾„ä¸­è¢«è°ƒç”¨ã€‚</p><p id="6602" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨ï¼Œå½“æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨æˆ‘ä»¬çš„è®¾å¤‡ä¸Šè·å¾—æ¨é€é€šçŸ¥ã€‚</p><blockquote class="ir is it"><p id="7033" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> âš ï¸åœ¨iOSä¸Šä½¿ç”¨æ¨é€é€šçŸ¥æ—¶ï¼ŒæœåŠ¡å™¨å¿…é¡»é‡‡ç”¨HTTPSã€‚</em></p></blockquote><p id="0922" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°±æ˜¯ä½¿ç”¨Pusheræ·»åŠ æ¨é€é€šçŸ¥çš„å…¨éƒ¨å†…å®¹ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºè¿è¡Œçš„å±å¹•è®°å½•:</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/3825dcdd0ae415b86bbc5000e6cc6171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*jOOYO9xM2c8QDyGT.gif"/></div></figure><h1 id="57c0" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">ç»“è®º</h1><p id="d94e" class="pw-post-body-paragraph iu iv hu ix b iy kx ja jb jc ky je jf jt ll ji jj ju lm jm jn jv ln jq jr js hn dt translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„ä¹˜è½¦å…±äº«æœåŠ¡ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Pusherå‘é€å…·æœ‰ä¸°å¯Œæ“ä½œçš„æ¨é€é€šçŸ¥ã€‚å¸Œæœ›ä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨Pusheræ¥ç®€åŒ–å‘ç”¨æˆ·å‘é€æ¨é€é€šçŸ¥çš„è¿‡ç¨‹ã€‚</p><p id="bed5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">èµ„æºåº“çš„æºä»£ç å¯ä»¥åœ¨<a class="ae jw" href="https://github.com/neoighodaro/ride-sharing-app" rel="noopener ugc nofollow" target="_blank"> GitHub </a>ä¸Šè·å¾—ã€‚</p><p id="6387" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æœ¬å¸–æœ€æ—©å‘è¡¨åœ¨<a class="ae jw" href="https://pusher.com/tutorials/ride-sharing-app-push-notifications" rel="noopener ugc nofollow" target="_blank">æ¨æ‰‹</a>ä¸Šã€‚</p></div></div>    
</body>
</html>