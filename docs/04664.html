<html>
<head>
<title>Deploy your Node.js app in production and use BitBucket to automate your deployment.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在生产中部署Node.js应用程序，并使用BitBucket来自动化部署。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploy-your-node-js-app-in-production-and-use-bitbucket-to-automate-your-deployment-50b07b18914c?source=collection_archive---------3-----------------------#2018-06-02">https://medium.com/hackernoon/deploy-your-node-js-app-in-production-and-use-bitbucket-to-automate-your-deployment-50b07b18914c?source=collection_archive---------3-----------------------#2018-06-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="f1e4" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">在本教程中，我们将创建一个示例Node.js服务器，将其推送到BitBucket并使用PM2，我们将在生产中自动部署。</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff jj"><img src="../Images/7bc629975863b4bdbeae89a6ec583912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*O9pNM7iQS8hEybZoDXZabg.png"/></div><figcaption class="jr js fg fe ff jt ju bd b be z ek">BitBucket</figcaption></figure><h2 id="e3d0" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">为什么是BitBucket？为什么不是Git？</h2><blockquote class="kt ku kv"><p id="e0f8" class="kw kx ky kz b la lb iv lc ld le iy lf lg lh li lj lk ll lm ln lo lp lq lr ls hn dt translated">Bitbucket是Atlassian拥有的基于web的版本控制库托管服务，用于使用Mercurial或Git版本控制系统的源代码和开发项目。Bitbucket提供商业计划和免费账户。—维基。</p></blockquote><p id="f0eb" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">与Git相比，我想到的唯一区别是，我们可以拥有任意数量的私有存储库，但在Git中不能，而在后者中我们只能拥有一个。如果您不想共享您的代码并使其保密，您可以使用BitBucket。如果你还没有帐户，你可以得到一个@<a class="ae lt" href="https://bitbucket.org/" rel="noopener ugc nofollow" target="_blank">https://bitbucket.org/</a></p><h1 id="2407" class="lu jw hu bd jx lv lw lx kb ly lz ma kf ja mb jb kj jd mc je kn jg md jh kr me dt translated">创建一个样本Node.js服务器</h1><h2 id="a123" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">快速发电机</h2><p id="267b" class="pw-post-body-paragraph kw kx hu kz b la mf iv lc ld mg iy lf kg mh li lj kk mi lm ln ko mj lq lr ls hn dt translated">让我们使用express-generator在几秒钟内安装一个示例Node.js服务器。将express-generator安装为全局模块。打开您的终端并发出以下命令。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="5e4c" class="jv jw hu ml b fv mp mq l mr ms">$ sudo npm install -g express-generator</span></pre><p id="3f2c" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">导航到所需的目录并执行以下命令。这将安装一个名为<code class="eh mt mu mv ml b">my-app</code>的示例应用程序。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="d047" class="jv jw hu ml b fv mp mq l mr ms">$ express — view=hbs my-app</span></pre><p id="0200" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">导航到您的应用程序<code class="eh mt mu mv ml b">my-app</code>。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="2046" class="jv jw hu ml b fv mp mq l mr ms">$ cd my-app</span></pre><p id="a6ca" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">让我们安装运行应用程序所需的模块。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="5fbf" class="jv jw hu ml b fv mp mq l mr ms">$ sudo npm install</span></pre><p id="537d" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">使用以下命令启动应用程序。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="5300" class="jv jw hu ml b fv mp mq l mr ms">$ sudo npm start</span></pre><p id="db27" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">默认情况下，这将在端口3000上运行应用程序。你可以在<code class="eh mt mu mv ml b"><a class="ae lt" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a></code>查看你的申请，你会在这里看到下面的屏幕。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="fe ff mw"><img src="../Images/5547728d31e2bce5ccecaeabb0ebe4c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WxQRRuwCVn1E5nIOydqpSw.png"/></div></div><figcaption class="jr js fg fe ff jt ju bd b be z ek">Express application welcome screen.</figcaption></figure></div><div class="ab cl nb nc hc nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="hn ho hp hq hr"><h1 id="5b32" class="lu jw hu bd jx lv ni lx kb ly nj ma kf ja nk jb kj jd nl je kn jg nm jh kr me dt translated">在BitBucket中上传您的代码</h1><p id="bae7" class="pw-post-body-paragraph kw kx hu kz b la mf iv lc ld mg iy lf kg mh li lj kk mi lm ln ko mj lq lr ls hn dt translated">在初始设置过程中，需要遵循几个步骤。因此，让我们从创建一个SSH密钥开始，从本地机器向您的BitBucket帐户进行身份验证。</p><p id="006e" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">总共有两种类型的认证，称为<code class="eh mt mu mv ml b">SSH</code>和<code class="eh mt mu mv ml b">HTTPS</code>。</p><p id="f985" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">这是一个一次性的过程，我们不想使用<code class="eh mt mu mv ml b">HTTPS</code>选项进行身份验证，因为每当我们从您的机器拉取、推送或提交时，我们都需要提供我们的凭据。</p><p id="443d" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">SSH认证机制如下。</p><ol class=""><li id="60a5" class="nn no hu kz b la lb ld le kg np kk nq ko nr ls ns nt nu nv dt translated">生成新的SSH密钥。</li><li id="34a2" class="nn no hu kz b la nw ld nx kg ny kk nz ko oa ls ns nt nu nv dt translated">将您的ssh密钥添加到SSH代理中</li><li id="d8e0" class="nn no hu kz b la nw ld nx kg ny kk nz ko oa ls ns nt nu nv dt translated">将SSH密钥添加到您的GitHub帐户</li></ol><h2 id="7a37" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">步骤1:生成新的SSH密钥。</h2><p id="9a31" class="pw-post-body-paragraph kw kx hu kz b la mf iv lc ld mg iy lf kg mh li lj kk mi lm ln ko mj lq lr ls hn dt translated">开放终端。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="349a" class="jv jw hu ml b fv mp mq l mr ms">$ cd ~/.ssh/ #To navigate to your default SSH key location.</span></pre><p id="b056" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">粘贴以下文本，替换为您的BitBucket电子邮件地址。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="5b4a" class="jv jw hu ml b fv mp mq l mr ms">$ ssh-keygen -t rsa -b 4096 -C "<em class="ky">your_email@example.com</em>"</span></pre><p id="c70a" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">这将创建一个新的ssh密钥，使用提供的电子邮件作为标签。</p><p id="b45b" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">当提示您“输入保存密钥的文件”时，请按Enter键。这接受默认的文件位置。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="528d" class="jv jw hu ml b fv mp mq l mr ms">Enter a file in which to save the key (/Users/<em class="ky">you</em>/.ssh/id_rsa): <em class="ky">[Press enter]</em></span></pre><p id="1a3f" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">在提示符下，按enter键两次，不输入任何密码。就这样，您已经成功地创建了名为<code class="eh mt mu mv ml b">id_rsa</code>的SSH密钥。</p><h2 id="e067" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">步骤2:将您的ssh密钥添加到SSH代理中</h2><p id="ee30" class="pw-post-body-paragraph kw kx hu kz b la mf iv lc ld mg iy lf kg mh li lj kk mi lm ln ko mj lq lr ls hn dt translated">在后台启动ssh-agent。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="e784" class="jv jw hu ml b fv mp mq l mr ms">$ eval "$(ssh-agent -s)"</span></pre><p id="7860" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">将您的ssh私有密钥添加到SSH代理中。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="01aa" class="jv jw hu ml b fv mp mq l mr ms">$ ssh-add -K ~/.ssh/id_rsa</span></pre><h2 id="f5f8" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">步骤3:向GitHub帐户添加新的SSH密钥</h2><p id="e902" class="pw-post-body-paragraph kw kx hu kz b la mf iv lc ld mg iy lf kg mh li lj kk mi lm ln ko mj lq lr ls hn dt translated">将SSH密钥复制到剪贴板。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="5179" class="jv jw hu ml b fv mp mq l mr ms">$ pbcopy &lt; ~/.ssh/id_rsa.pub<br/># Copies the contents of the id_rsa.pub file to your clipboard</span></pre><p id="1e8f" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">如果没有pbcopy，可以使用任何编辑器打开该文件并复制其全部内容。我使用sublime，如果你想在sublime编辑器中打开上面的文件，发出下面的命令。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="6408" class="jv jw hu ml b fv mp mq l mr ms">$ subl ~/.ssh/id_rsa.pub <br/># Either issue this or above command. Don't execute both.</span></pre><p id="aaad" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">让我们转到我们的BitBucket帐户并粘贴密钥。导航到您的BitBucket帐户设置，然后单击SSH密钥。(参考图片)。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="fe ff ob"><img src="../Images/e7a986e89348f1ba8ee314f181e98886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*scsYmd9L_Rs1KjPyAhv3iw.png"/></div></div><figcaption class="jr js fg fe ff jt ju bd b be z ek">BitBucket Account Settings Page.</figcaption></figure><p id="0beb" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">点击添加键，并根据您的意愿给出标签名称。让我把它命名为我的SSH密钥。在“密钥”框中，粘贴复制的密钥并单击“添加密钥”。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="fe ff oc"><img src="../Images/fe3aa6f7766f60131265e93b96ce1cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZUrHR32ZG5bK6xnMi1zQBg.png"/></div></div></figure><p id="74e5" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">就是这样。现在，您已经通过身份验证，可以从终端执行BitBucket帐户中的操作。让我们推送我们的代码，稍后在EC2中部署它。</p><h2 id="ca80" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">在BitBucket中部署代码。</h2><p id="f002" class="pw-post-body-paragraph kw kx hu kz b la mf iv lc ld mg iy lf kg mh li lj kk mi lm ln ko mj lq lr ls hn dt translated">首先，让我们在BitBucket中创建一个存储库，我们将把代码放在那里。</p><p id="85f5" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">转到在您的BitBucket帐户中创建存储库，或单击此<a class="ae lt" href="https://bitbucket.org/repo/create" rel="noopener ugc nofollow" target="_blank"> URL </a>导航到回购创建页面。看起来像下面。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="fe ff od"><img src="../Images/feebe7a6861a2b74479ca05e7976d1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xjUPAbTKwphoQ2bCDq6uzg.png"/></div></div></figure><p id="33f9" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">输入名为<code class="eh mt mu mv ml b">my-app</code>的应用程序名称，然后点击<code class="eh mt mu mv ml b">Create repository</code>。</p><p id="03e0" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated"><strong class="kz hv">注意:目前不包括README。在图像中，我已经包含了自述文件。</strong></p><p id="5a48" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">您将被导航至您的回购来源页面。单击右上角的克隆按钮。有关信息，请参考图像。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="fe ff oe"><img src="../Images/8fdf29c519bc183fa47e20eff6be1b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYjRaXTAqEDJhT6SmHaUUw.png"/></div></div></figure><p id="92c1" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">并复制图像中给出的突出显示的文本。由于我们将把这个回购提交给我们的本地应用程序，<code class="eh mt mu mv ml b">git clone</code>是不需要的。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="fe ff of"><img src="../Images/48ff7f9ed289ec348821b520f19ee43f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTdFT3SDG6nAx_CwcReiGA.png"/></div></div></figure><p id="9f21" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">创建一个名为。gitignore在你的根目录下忽略不必要的文件上传到我们的BitBucket repo。粘贴以下内容并保存文件。有关结构的更多信息，请参考完整的存储库源代码。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="781a" class="jv jw hu ml b fv mp mq l mr ms"># See <a class="ae lt" href="http://help.github.com/ignore-files/" rel="noopener ugc nofollow" target="_blank">http://help.github.com/ignore-files/</a> for more about ignoring files.</span><span id="3590" class="jv jw hu ml b fv og mq l mr ms"># dependencies<br/>node_modules</span><span id="66a5" class="jv jw hu ml b fv og mq l mr ms"># testing<br/>coverage</span><span id="69f0" class="jv jw hu ml b fv og mq l mr ms"># production<br/>build</span><span id="f25e" class="jv jw hu ml b fv og mq l mr ms"># misc<br/>.DS_Store<br/>.env<br/>npm-debug.log</span></pre><p id="fe25" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">现在导航到您的应用程序目录(<code class="eh mt mu mv ml b">cd /my-app</code>)并逐一执行以下命令，将您的本地回购链接到您的BitBucket回购并推送您的更改。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="6b26" class="jv jw hu ml b fv mp mq l mr ms">git init<br/>git add --all<br/>git commit -m "Initial Commit"<br/>git remote add origin <a class="ae lt" href="mailto:git@bitbucket.org" rel="noopener ugc nofollow" target="_blank">git@bitbucket.org</a>:Balasubramani/my-app.git<br/>git pull origin master<br/>git push -u origin master</span></pre><p id="86d3" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">搞定了。您的存储库现在在Bitbucket Server中可用。</p><p id="1053" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">如果您在发布<code class="eh mt mu mv ml b">git pull origin master</code>时遇到任何类似合并问题的错误，只需键入<code class="eh mt mu mv ml b">:q!</code>并按回车键退出并放弃提交消息。现阶段没有必要。</p></div><div class="ab cl nb nc hc nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="hn ho hp hq hr"><h1 id="707f" class="lu jw hu bd jx lv ni lx kb ly nj ma kf ja nk jb kj jd nl je kn jg nm jh kr me dt translated">在EC2中部署您的应用</h1><h2 id="6637" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">亚马逊EC2</h2><p id="882c" class="pw-post-body-paragraph kw kx hu kz b la mf iv lc ld mg iy lf kg mh li lj kk mi lm ln ko mj lq lr ls hn dt translated">如果您知道Amazon EC2实例，并且知道如何配置和使用它，那么您不需要做任何事情。</p><p id="e18a" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">但是，如果您不知道，您可以浏览下面的链接并设置您的远程实例ready，这是托管Node.js服务器所必需的。</p><div class="oh oi fm fo oj ok"><a rel="noopener follow" target="_blank" href="/full-stack-web-development-from-scratch-to/make-your-amazon-ec2-instance-up-and-running-ab80120eb23"><div class="ol ab ej"><div class="om ab on cl cj oo"><h2 class="bd hv fv z el op eo ep oq er et ht dt translated">启动并运行您的Amazon EC2实例。</h2><div class="or l"><h3 class="bd b fv z el op eo ep oq er et ek translated">在这一部分，我们将创建一个Amazon帐户EC2实例，并通过SSH连接到该实例。</h3></div><div class="os l"><p class="bd b gc z el op eo ep oq er et ek translated">medium.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy jp ok"/></div></div></a></div><p id="bca6" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated"><strong class="kz hv">注意:您需要一个服务器(EC2实例)来部署您的生产就绪Node.js服务器。</strong></p><h2 id="50ae" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">PM2设置</h2><blockquote class="kt ku kv"><p id="a8dc" class="kw kx ky kz b la lb iv lc ld le iy lf lg lh li lj lk ll lm ln lo lp lq lr ls hn dt translated">生产Node.js应用程序的高级流程管理器。</p></blockquote><p id="c1b9" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">让我们在本地存储库中配置PM2，它将实际完成我们的部署工作。</p><p id="ea22" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">发出以下命令，在根目录下安装PM2。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="4efc" class="jv jw hu ml b fv mp mq l mr ms">$ sudo npm i pm2 --save-dev</span></pre><p id="2647" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">在根目录中，创建一个名为ecosystem.config.js的文件，并将以下内容添加到其中。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="3266" class="jv jw hu ml b fv mp mq l mr ms">module.exports = {<br/> apps: [<br/>  {<br/>   name: "my-app",<br/>   script: "./bin/www",<br/>   env: {<br/>    PORT: 3000,<br/>    NODE_ENV: "production"<br/>   }<br/>  }<br/> ],<br/> deploy: {<br/>  production: {<br/>   user: "ubuntu",<br/>   host: "ec2-xx-xxx-xxx-xx.us-east-2.compute.amazonaws.com",<br/>   key: "~/.ssh/AWS-EC2-INSTANCE-LIVE.pem",<br/>   ref: "origin/master",<br/>   repo: "<a class="ae lt" href="mailto:git@bitbucket.org" rel="noopener ugc nofollow" target="_blank">git@bitbucket.org</a>:Balasubramani/my-app.git",<br/>   path: "/home/ubuntu/my-app",<br/>   "post-deploy":<br/>    "npm install &amp;&amp; pm2 startOrRestart ecosystem.config.js"<br/>  }<br/> }<br/>};</span></pre><p id="2432" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">记得用您的Amazon实例主机、PEM密钥位置替换您的主机，并更新您的回购链接(您之前已经复制了该链接，即突出显示的文本)。希望你记得)。</p><p id="080e" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">一切都已准备就绪。我们开始吧。</p><p id="f25d" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">当然了。在终端中从根目录运行下面的命令，在远程服务器上设置应用程序。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="98d2" class="jv jw hu ml b fv mp mq l mr ms">$ sudo pm2 deploy ecosystem.config.js production setup</span></pre><p id="69a7" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">这将在EC2实例中配置我们的应用程序。</p><p id="0652" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">最后，发出下面的命令，在远程服务器上使用PM2托管并运行您的应用程序。</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="66b1" class="jv jw hu ml b fv mp mq l mr ms">$ sudo pm2 deploy ecosystem.config.js production</span></pre><p id="f113" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">万岁！！！Node.js服务器现在位于生产服务器中，可以使用了。</p><p id="608e" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">登录到您的远程服务器并键入</p><pre class="jk jl jm jn fq mk ml mm mn aw mo dt"><span id="a7ff" class="jv jw hu ml b fv mp mq l mr ms">$ sudo pm2 status</span></pre><p id="18b9" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">查看你的申请状态。</p><p id="6f8f" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">现在，您的应用程序正在远程服务器上运行。要检查，添加3000作为一个端口以及您的远程IP地址，以检查应用程序运行…</p><p id="6488" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated"><em class="ky">例如:http:// &lt;你的远程ip地址&gt; :3000 </em></p><p id="d15e" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated"><strong class="kz hv">注意:您需要在EC2实例的安全组中允许端口3000。参考上面的</strong> <a class="ae lt" rel="noopener" href="/full-stack-web-development-from-scratch-to/make-your-amazon-ec2-instance-up-and-running-ab80120eb23"> <strong class="kz hv">链接</strong> </a> <strong class="kz hv">关于如何允许远程服务器上的安全组中的端口。</strong></p><p id="b191" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">你可以在这里下载最终的GitHub应用<a class="ae lt" href="https://github.com/BalasubramaniM/nodejs-pm2-ec2-app" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5bc9" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">在下一个教程中，让我们映射我们的自定义域，配置Nginx并向Node.js服务器添加SSL层。</p><p id="a240" class="pw-post-body-paragraph kw kx hu kz b la lb iv lc ld le iy lf kg lh li lj kk ll lm ln ko lp lq lr ls hn dt translated">谢谢你。</p></div></div>    
</body>
</html>