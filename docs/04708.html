<html>
<head>
<title>React — redux for lazy developers. Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React —为懒惰的开发人员提供redux。第二部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/react-redux-for-lazy-developers-part-2-d0c60123592f?source=collection_archive---------12-----------------------#2018-06-04">https://medium.com/hackernoon/react-redux-for-lazy-developers-part-2-d0c60123592f?source=collection_archive---------12-----------------------#2018-06-04</a></blockquote><div><div class="ff gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><p id="6702" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">在本文中，我将继续讨论使用redux-lazy创建react redux应用程序。</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div class="el em je"><img src="../Images/92f64228f13ab328fc74268c7be206a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*zt51JVTHHPY_Uy5S_FXa7w.jpeg"/></div></figure><p id="3a7c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">根据我的经验，我发现我花了很多时间来复制/粘贴代码，以便使用存储。每次我都应该创建动作类型、动作创建者和缩减者。甚至容器在大多数情况下都是相同的。</p><p id="539b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">这就是为什么我创建了一个新的库——redux-lazy。</p></div><div class="ab cl jm jn gr jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hc hd he hf hg"><p id="cd3f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我喜欢用函数式风格编写react应用程序——我创建函数组件作为纯函数:<strong class="ii hk"> props = &gt; JSX </strong>。</p><p id="cb3b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">它有助于测试所有代码，每个功能都有自己的单一责任，没有副作用，易于编写和支持代码。如你所知，大约80%的时间我们支持现有的代码。因此，让代码更具声明性可以节省我们的时间和金钱。</p><p id="f326" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">但首先我想分享我以前文章的有用链接:</p><div class="jt ju eu ew jv jw"><a rel="noopener follow" target="_blank" href="/@evheniybystrov/react-redux-for-lazy-developers-b551f16a456f"><div class="jx ab gm"><div class="jy ab jz cl cj ka"><h2 class="bd hk fi z kb kc kd ke kf kg kh hi dt translated">React —为懒惰的开发人员提供redux</h2><div class="ki l"><h3 class="bd b fi z kb kc kd ke kf kg kh gg translated">每次在react应用程序中使用redux时，我们都要花费大量时间来创建动作类型、动作创建者、减少者…大多数…</h3></div><div class="kj l"><p class="bd b fp z kb kc kd ke kf kg kh gg translated">medium.com</p></div></div><div class="kk l"><div class="kl l km kn ko kk kp jk jw"/></div></div></a></div><p id="9af7" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">和</p><div class="jt ju eu ew jv jw"><a href="https://blog.cloudboost.io/react-functional-way-c533fceda2ce" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab gm"><div class="jy ab jz cl cj ka"><h2 class="bd hk fi z kb kc kd ke kf kg kh hi dt translated">反应:功能方式</h2><div class="ki l"><h3 class="bd b fi z kb kc kd ke kf kg kh gg translated">正如您可能知道的，使用react可以使用函数或类——使用无状态和有状态组件。在…</h3></div><div class="kj l"><p class="bd b fp z kb kc kd ke kf kg kh gg translated">blog.cloudboost.io</p></div></div><div class="kk l"><div class="kq l km kn ko kk kp jk jw"/></div></div></a></div><p id="1c29" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">当我使用<a class="ae kr" href="https://redux-observable.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk">的重复效果</strong> </a>作为副作用时，我将所有逻辑放入<a class="ae kr" href="https://redux-observable.js.org/docs/basics/Epics.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk">史诗</strong> </a>。React只是一个视图层。所有redux的东西我都只用作存储epics的数据和事件的getter/setter。</p><p id="5fd1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">如果你看看这些关系:</p><p id="7993" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated"><strong class="ii hk">组件(视图)&lt; - &gt;存储(数据库)&lt; - &gt;史诗(逻辑)</strong></p><p id="cdcf" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">您可以看到，视图层只是一个显示来自我们商店(redux)的数据的模板。我们应该在组件中看到商店中的每个变化。</p><p id="662b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">商店工作不仅仅是看。我们在epics中捕捉每个存储动作，并对其进行处理，以生成不同的内容，如ajax请求、更改存储数据(获取响应和清除表单……)。</p><p id="3936" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">为了编写代码和测试，我花了大约50%的时间在逻辑上，大约20%在组件上，大约30%在存储上。</p><p id="bfd7" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">每次获取/设置要存储的数据时，我们需要创建动作类型、动作创建者、减少者和容器，这要花费我们30%的时间。</p><p id="7e14" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">之后我试着节省了这段时间，创建了<a class="ae kr" href="https://www.npmjs.com/package/redux-lazy" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> redux-lazy </strong> </a>。</p><p id="8bd3" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">因此，接下来我将展示如何创建经典的react redux应用程序，添加测试以覆盖所有代码，并将redux内容(类型、动作、reducer……)切换到redux-lazy。</p><p id="3cd4" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">但是首先，我想重复一遍:</p><ul class=""><li id="0e74" class="ks kt hj ii b ij ik in io ir ku iv kv iz kw jd kx ky kz la dt translated">React只是一个视图层，</li><li id="728e" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated">纯功能:<strong class="ii hk"> props = &gt; jsx </strong>，</li><li id="bd2e" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated">没有其他东西…</li></ul><p id="8e2a" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">Redux是我们的店。相同的:</p><ul class=""><li id="8963" class="ks kt hj ii b ij ik in io ir ku iv kv iz kw jd kx ky kz la dt translated">纯功能(动作创建者，还原者)，</li><li id="3237" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated">没有副作用，</li><li id="a1ca" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated">没有逻辑，</li><li id="d13e" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated">只需获取/设置要存储的数据(CRUD)，</li><li id="3809" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated">史诗中的所有逻辑。</li></ul></div><div class="ab cl jm jn gr jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hc hd he hf hg"><p id="bb22" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们需要安装<a class="ae kr" href="https://nodejs.org/uk/" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">node . js</strong></a><a class="ae kr" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">NPM</strong></a>。之后安装<a class="ae kr" href="https://yarnpkg.com/lang/en/" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk">纱</strong> </a>和<a class="ae kr" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk">创建-反应-应用</strong> </a>就像在<a class="ae kr" rel="noopener" href="/@evheniybystrov/react-redux-for-lazy-developers-b551f16a456f"> <strong class="ii hk">上一篇</strong> </a>一样。并创建项目:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="2a7d" class="ll lm hj lh b fi ln lo l lp lq">mkdir redux-app<br/>cd redux-app<br/>create-react-app .</span></pre><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lr"><img src="../Images/cdad92777f7da3692f853dd4dc4c78f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*itC1ZqcbaXSCzm-XEZGgsg.png"/></div></div></figure><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lr"><img src="../Images/cc37cf102097df1d03402d0f47ab336d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tOoHj_5cOzmCjD3w-sYq6w.png"/></div></div></figure><p id="deb1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">并运行它:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="b206" class="ll lm hj lh b fi ln lo l lp lq">yarn start</span></pre><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lr"><img src="../Images/a2539c7005a0f8828741891c45ea9746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jG20IjI5fdlIPb6ueH91Mg.png"/></div></div></figure><p id="ceb0" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">结果:</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lw"><img src="../Images/7f6f1442771662d6ee40cbfed477348b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLxAYULqUN2N2uhn_ams-g.png"/></div></div></figure><p id="2081" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">让我们安装<a class="ae kr" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> redux </strong> </a>和<a class="ae kr" href="https://github.com/reduxjs/react-redux" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> react-redux </strong> </a>:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="b2bc" class="ll lm hj lh b fi ln lo l lp lq">yarn add redux react-redux</span></pre><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lr"><img src="../Images/427b6f46acb19c8cb186a1a085a399ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wXK3kZ-EDlYChM0fhQHE6A.png"/></div></div></figure><p id="eadc" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我喜欢创建单个责任模块，并在那里保存所有代码，如react组件、redux和epics之类的东西。</p><p id="2e3b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">但是首先关于我们的应用程序…</p><p id="65b6" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们将使用<a class="ae kr" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">JSONPlaceholder</strong></a>服务创建一个表单来提交帖子。接下来，我们将创建另一个模块来处理注释。</p><p id="f403" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated"><strong class="ii hk">第一步</strong>:我们要创建目录，清空文件。</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="88d6" class="ll lm hj lh b fi ln lo l lp lq">mkdir -p src/modules/post<br/>mkdir src/modules/post/components<br/>mkdir src/modules/post/containers<br/>mkdir src/modules/post/types<br/>mkdir src/modules/post/actions<br/>mkdir src/modules/post/reducer<br/>mkdir src/modules/post/epics</span><span id="daa9" class="ll lm hj lh b fi lx lo l lp lq">touch src/modules/post/index.js<br/>touch src/modules/post/components/index.jsx<br/>touch src/modules/post/containers/index.js<br/>touch src/modules/post/types/index.js<br/>touch src/modules/post/actions/index.js<br/>touch src/modules/post/reducer/index.js<br/>touch src/modules/post/epics/index.js</span></pre><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lr"><img src="../Images/ba2102dff0f0a938491aa86b99b51853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JmCiJFXKPieJZMKsdfocw.png"/></div></div></figure><p id="395e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">你能在<a class="ae kr" href="https://github.com/evheniy/redux-app" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> github </strong> </a>上找到的所有代码。</p><p id="4937" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们的树:</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lr"><img src="../Images/2ae1e96a9dd835bacd904e8ccec4009b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jRySNN1Z4Yy4TBxcLZhuuw.png"/></div></div></figure><p id="8675" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">不要忘记安装<a class="ae kr" href="https://github.com/evgenyrodionov/redux-logger" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> redux-logger </strong> </a>。如果您需要检查当前状态，这很有用:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="2052" class="ll lm hj lh b fi ln lo l lp lq">yarn add redux-logger</span></pre><p id="c7ad" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">和<a class="ae kr" href="https://www.npmjs.com/package/prop-types" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk">道具类型</strong></a>——它有助于验证react组件属性:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="74b0" class="ll lm hj lh b fi ln lo l lp lq">yarn add prop-types</span></pre><p id="76eb" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated"><strong class="ii hk">下一步</strong>:我们需要创建store和reducers。</p><p id="e5aa" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">减速器:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="b322" class="ll lm hj lh b fi ln lo l lp lq">touch src/reducers.js</span></pre><p id="a04b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">带代码:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="cc2c" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ combineReducers } <strong class="lh hk">from </strong>'redux';<br/><br/><strong class="lh hk">import </strong>post <strong class="lh hk">from </strong>'./modules/post/reducer';<br/><br/><strong class="lh hk">export default </strong>combineReducers({ post });</span></pre><p id="a41e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">并存储:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="0f7c" class="ll lm hj lh b fi ln lo l lp lq">touch src/store.js</span></pre><p id="32f0" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">带代码:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="5fb4" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ createStore, applyMiddleware } <strong class="lh hk">from </strong>'redux';<br/><strong class="lh hk">import </strong>logger <strong class="lh hk">from </strong>'redux-logger';<br/><br/><strong class="lh hk">import </strong>reducers <strong class="lh hk">from </strong>'./reducers';<br/><br/><strong class="lh hk">const </strong>store = createStore(<br/>    reducers,<br/>    applyMiddleware(logger)<br/>);<br/><br/><strong class="lh hk">export default </strong>store;</span></pre><p id="a442" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">并更新<strong class="ii hk"> src/index.js </strong>:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="8a20" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>React <strong class="lh hk">from </strong>'react';<br/><strong class="lh hk">import </strong>ReactDOM <strong class="lh hk">from </strong>'react-dom';<br/><strong class="lh hk">import { Provider } from 'react-redux';</strong><br/><strong class="lh hk">import </strong>'./index.css';<br/><strong class="lh hk">import </strong>App <strong class="lh hk">from </strong>'./App';<br/><strong class="lh hk">import store from './store';</strong><br/><strong class="lh hk">import </strong>registerServiceWorker <strong class="lh hk">from </strong>'./registerServiceWorker';<br/><br/>ReactDOM.render(<br/>    <strong class="lh hk">&lt;Provider store={store}&gt;<br/>        &lt;App /&gt;<br/>    &lt;/Provider&gt;,</strong><br/>    document.getElementById('root')<br/>);<br/>registerServiceWorker();</span></pre><h2 id="230a" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">发布模块代码:</h2><p id="0eaf" class="pw-post-body-paragraph ig ih hj ii b ij mr il im in ms ip iq ir mt it iu iv mu ix iy iz mv jb jc jd hc dt translated">要发送一个帖子，我们需要有可能改变标题，主体和提交形式。对于每个点，我们需要有行动类型和行动创建者:</p><h2 id="6fd9" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">动作类型(src/modules/post/types/index . js):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="9851" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">export const </strong>POST_TITLE = '@@post/TITLE';<br/><strong class="lh hk">export const </strong>POST_BODY = '@@post/BODY';<br/><strong class="lh hk">export const </strong>POST_SUBMIT = '@@post/SUBMIT';</span></pre><p id="da8c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">为了避免冲突，我喜欢给类型加上前缀，比如<strong class="ii hk"> @@post </strong> /TITLE。</p><h2 id="567e" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">动作创建者(src/modules/post/actions/index . js):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="c89e" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{<br/>    POST_TITLE,<br/>    POST_BODY,<br/>    POST_SUBMIT,<br/>} <strong class="lh hk">from </strong>'../types';<br/><br/><strong class="lh hk">export const </strong>titleAction = title =&gt; ({<br/>    type: POST_TITLE,<br/>    title,<br/>});<br/><br/><strong class="lh hk">export const </strong>bodyAction = body =&gt; ({<br/>    type: POST_BODY,<br/>    body,<br/>});<br/><br/><strong class="lh hk">export const </strong>submitAction = () =&gt; ({<br/>    type: POST_SUBMIT,<br/>});</span></pre><h2 id="606d" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">reducer(src/modules/post/reducer/index . js):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="52b8" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ POST_TITLE, POST_BODY } <strong class="lh hk">from </strong>'../types';<br/><br/><strong class="lh hk">const </strong>defaultState = {<br/>    title: '',<br/>    body: '',<br/>};<br/><br/><strong class="lh hk">export default </strong>(state = defaultState, action) =&gt; {<br/>    <strong class="lh hk">switch </strong>(action.type) {<br/>        <strong class="lh hk">case </strong>POST_TITLE:<br/>        <strong class="lh hk">case </strong>POST_BODY:<br/>            <strong class="lh hk">return </strong>{ ...state, ...action };<br/>        <strong class="lh hk">default</strong>:<br/>            <strong class="lh hk">return </strong>state;<br/>    }<br/>};</span></pre><p id="1ef2" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">这里我改变了标题和正文的状态。要提交表单，我不需要对store进行任何操作(更改)。</p><h2 id="4c8a" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">容器(src/modules/post/containers/index . js):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="39bb" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ connect } <strong class="lh hk">from </strong>'react-redux';<br/><strong class="lh hk">import </strong>* <strong class="lh hk">as </strong>actions <strong class="lh hk">from </strong>'../actions';<br/><br/><strong class="lh hk">const </strong>mapStateToProps = state =&gt; state.post;<br/><strong class="lh hk">const </strong>mapDispatchToProps = { ...actions };<br/><br/><strong class="lh hk">export default </strong>connect(mapStateToProps, mapDispatchToProps);</span></pre><p id="e0af" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们有一个简单的容器。因为我们只处理post数据，所以它只处理post的部分存储和所有动作创建者。</p><p id="6761" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">在下一篇文章中，我将展示如何组合来自商店不同部分的数据，并用<a class="ae kr" href="https://github.com/reduxjs/reselect" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk">重新选择</strong> </a>来记忆。</p><h2 id="d088" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">组件(src/modules/post/components/index . jsx):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="cd30" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>React <strong class="lh hk">from </strong>'react';<br/><strong class="lh hk">import </strong>PropTypes <strong class="lh hk">from </strong>'prop-types';<br/><br/><strong class="lh hk">const </strong>PostComponent = props =&gt; (<br/>    &lt;form onSubmit={(event) =&gt; {<br/>        event.preventDefault();<br/>        props.submitAction();<br/>    }}&gt;<br/>        &lt;h1&gt;Our form example&lt;/h1&gt;<br/>        &lt;div&gt;<br/>            &lt;input<br/>                type="text"<br/>                onChange={event =&gt; props.titleAction(event.target.value)}<br/>                value={props.title}<br/>            /&gt;<br/>        &lt;/div&gt;<br/>        &lt;div&gt;<br/>            &lt;textarea<br/>                onChange={event =&gt; props.bodyAction(event.target.value)}<br/>                value={props.body}<br/>            /&gt;<br/>        &lt;/div&gt;<br/>        &lt;div&gt;<br/>            &lt;input type="submit" value="Submit" /&gt;<br/>        &lt;/div&gt;<br/>    &lt;/form&gt;<br/>);<br/><br/>PostComponent.propTypes = {<br/>    title: PropTypes.string.isRequired,<br/>    body: PropTypes.string.isRequired,<br/>    titleAction: PropTypes.func.isRequired,<br/>    bodyAction: PropTypes.func.isRequired,<br/>    submitAction: PropTypes.func.isRequired,<br/>};<br/><br/><strong class="lh hk">export default </strong>PostComponent;</span></pre><p id="050d" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们的组件是一个纯函数，它获取属性并返回JSX代码。</p><p id="0c94" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">这里您可以看到正确类型验证。所有属性都是必需的，因为我们每次都从reducer存储post数据。</p><h2 id="aaa8" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">以及我们的post模块入口点(src/modules/post/index.js):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="a2af" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>PostComponent <strong class="lh hk">from </strong>'./components';<br/><strong class="lh hk">import </strong>PostContainer <strong class="lh hk">from </strong>'./containers';<br/><br/><strong class="lh hk">export default </strong>PostContainer(PostComponent);</span></pre><p id="3908" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">最后一件事——我们需要更新<strong class="ii hk"> src/App.jsx </strong>来呈现我们的post模块:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="6677" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>React, { Component } <strong class="lh hk">from </strong>'react';<br/><strong class="lh hk">import </strong>logo <strong class="lh hk">from </strong>'./logo.svg';<br/><strong class="lh hk">import </strong>'./App.css';<br/><strong class="lh hk">import Post from './modules/post';</strong><br/><br/><strong class="lh hk">class </strong>App <strong class="lh hk">extends </strong>Component {<br/>  render() {<br/>    <strong class="lh hk">return </strong>(<br/>      &lt;div className="App"&gt;<br/>        &lt;header className="App-header"&gt;<br/>          &lt;img src={logo} className="App-logo" alt="logo" /&gt;<br/>          &lt;h1 className="App-title"&gt;Welcome to React&lt;/h1&gt;<br/>        &lt;/header&gt;<br/>        <strong class="lh hk">&lt;Post /&gt;</strong><br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}<br/><br/><strong class="lh hk">export default </strong>App;</span></pre><p id="29da" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">和结果:</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lw"><img src="../Images/6fa2ffc455e40b7d202d0d12010b9408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51zM1-KKmQfuZpsRBpo5NA.png"/></div></div></figure><p id="4dbc" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">不完美，但是这篇文章不是关于UI/UX的。</p><p id="331e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">让我们检查一下我们的行动…</p><h2 id="9042" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">标题更改:</h2><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lw"><img src="../Images/35e3a9bf4bd4973b3ed39b47d8332ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NSQtDrlP_ATANcGzgvy0Sg.png"/></div></div></figure><h2 id="acd9" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">身体变化:</h2><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lw"><img src="../Images/7b894a8168ef9c5423dcdc156bd5bcd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3fyJUhRgD8tWxnb32rixSQ.png"/></div></div></figure><h2 id="58a8" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">并提交:</h2><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lw"><img src="../Images/09ad5ee5396d1bad5f35e5a61fd9e350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_sVk8Sfo0fSv4xVmu3v9ng.png"/></div></div></figure><p id="65b2" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">目前就这些。我们刚刚创建了一个简单的react-redux应用程序。下一步是测试。</p></div><div class="ab cl jm jn gr jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hc hd he hf hg"><p id="44d9" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我喜欢使用单一责任包，为开发(yeps，wpb，redux-lazy)和测试创建自己的框架。我将使用下一个包:</p><ul class=""><li id="f3f9" class="ks kt hj ii b ij ik in io ir ku iv kv iz kw jd kx ky kz la dt translated"><a class="ae kr" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> mocha </strong> </a> —运行在Node.js上和浏览器中的功能丰富的JavaScript测试框架，让异步测试变得简单有趣。</li><li id="b3af" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated"><a class="ae kr" href="http://www.chaijs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk">柴</strong> </a> —一个用于<a class="ae kr" href="http://nodejs.org" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk">节点</strong> </a>和浏览器的BDD / TDD断言库，可以愉快地与任何javascript测试框架配对。</li><li id="d59f" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated"><a class="ae kr" href="http://sinonjs.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">sinon</strong></a>—JavaScript的独立测试间谍、存根和模拟。适用于任何单元测试框架。</li><li id="bd02" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated"><a class="ae kr" href="http://airbnb.io/enzyme/" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">enzyme</strong></a>—React的JavaScript测试实用程序，它使断言、操作和遍历React组件的输出变得更加容易。</li><li id="dfdb" class="ks kt hj ii b ij lb in lc ir ld iv le iz lf jd kx ky kz la dt translated"><a class="ae kr" href="https://istanbul.js.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">NYC</strong></a>—JavaScript测试覆盖工具。</li></ul><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="3a69" class="ll lm hj lh b fi ln lo l lp lq">yarn add mocha chai sinon enzyme nyc enzyme-adapter-react-16 -D</span></pre><p id="6708" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">一件小事。要制作生产就绪的应用程序，你不应该忘记代码质量和安全性。对于这个东西，我使用了<a class="ae kr" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> eslint </strong> </a>和<a class="ae kr" href="https://www.npmjs.com/package/eslint-config-airbnb" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> airbnb config </strong> </a>和<a class="ae kr" href="https://github.com/nodesecurity/nsp" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> nsp </strong> </a> —节点安全平台命令行工具:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="624d" class="ll lm hj lh b fi ln lo l lp lq">yarn add eslint eslint-config-airbnb eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react nsp jsdom redux-mock-store babel-register -D</span></pre><p id="7c02" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">Jsdom是许多web标准的纯JavaScript实现，特别是WHATWG DOM和HTML标准，用于Node.js。</p><p id="291e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated"><a class="ae kr" href="https://github.com/arnaudbenard/redux-mock-store" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">Redux-mock-store</strong></a>—一个模拟商店，用于测试您的Redux异步动作创建器和中间件。</p><p id="c0ae" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">为了运行所有命令，我使用了<a class="ae kr" href="https://www.npmjs.com/package/npm-run-all" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">npm-run-all</strong></a>——一个CLI工具来并行或顺序运行多个NPM脚本:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="73ed" class="ll lm hj lh b fi ln lo l lp lq">yarn add npm-run-all</span></pre><p id="c25e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">和更新package.json脚本部分:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="6b3c" class="ll lm hj lh b fi ln lo l lp lq">"scripts": {<br/>  "start": "react-scripts start",<br/>  "build": "react-scripts build",<br/>  "eject": "react-scripts eject",<br/>  <strong class="lh hk">"test": "npm-run-all test:*",<br/>  "test:security": "nsp check",<br/>  "test:lint": "eslint . --ext .js,.jsx"</strong><br/>},</span></pre><p id="1255" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">和一些配置(只需在项目根目录下创建这些文件):</p><h2 id="39dc" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">。埃斯林提尼奥勒</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="d372" class="ll lm hj lh b fi ln lo l lp lq">build<br/>coverage<em class="mw"><br/></em>src/registerServiceWorker.js</span></pre><h2 id="7da8" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">。eslintrc</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="f184" class="ll lm hj lh b fi ln lo l lp lq">{<br/>  "parser": "babel-eslint",<br/>  "extends": "airbnb",<br/>  "env": {<br/>    "browser": <strong class="lh hk">true</strong>,<br/>    "node": <strong class="lh hk">true</strong>,<br/>    "mocha": <strong class="lh hk">true<br/>  </strong>}<br/>}</span></pre><p id="29bf" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">让我们运行它:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="2040" class="ll lm hj lh b fi ln lo l lp lq">yarn test</span></pre><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lr"><img src="../Images/4e2c568c7c654350fa641d738dae83a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PT9Kvaf-oPgyQIiqjcCQ4Q.png"/></div></div></figure><p id="3cf3" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们看到了很多来自eslint的错误和警告。这有助于所有团队保持相同的代码风格。修复后:</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lr"><img src="../Images/23ee5405c6a4c8c7e4ca0d35b13e0751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxri36Mbtr-Fasib_qLL7A.png"/></div></div></figure><p id="dabc" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">你可以在<a class="ae kr" href="https://github.com/evheniy/redux-app" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> github资源库</strong> </a>中找到所有改动。</p><p id="683b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">别忘了关于<a class="ae kr" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> axios </strong> </a>:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="0016" class="ll lm hj lh b fi ln lo l lp lq">yarn add axios</span></pre><p id="8284" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我喜欢这个客户端，因为我可以在客户端和后端使用它。它可以通过超时取消请求。你甚至可以用它作为<a class="ae kr" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> graphQL </strong> </a>客户端。</p><h2 id="842f" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">下一步是测试…</h2><p id="6ccf" class="pw-post-body-paragraph ig ih hj ii b ij mr il im in ms ip iq ir mt it iu iv mu ix iy iz mv jb jc jd hc dt translated">首先，我们需要创建使用jsdom的助手:</p><p id="3670" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">tests/helper.js :</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="9cfb" class="ll lm hj lh b fi ln lo l lp lq">require('babel-register')({<br/>  presets: [<br/>    'react',<br/>    'env',<br/>  ],<br/>  plugins: [<br/>    'transform-object-rest-spread',<br/>  ],<br/>});</span><span id="612d" class="ll lm hj lh b fi lx lo l lp lq"><strong class="lh hk">const </strong>{ configure } = require('enzyme');<br/><strong class="lh hk">const </strong>Adapter = require('enzyme-adapter-react-16');<br/><br/><strong class="lh hk">const </strong>axios = require('axios');<br/><strong class="lh hk">const </strong>httpAdapter = require('axios/lib/adapters/http');<br/><br/>axios.defaults.host = 'http://localhost:3000';<br/>axios.defaults.adapter = httpAdapter;<br/><br/>configure({ adapter: <strong class="lh hk">new </strong>Adapter() });<br/><br/><strong class="lh hk">const </strong>{ JSDOM } = require('jsdom');<br/><br/><strong class="lh hk">const </strong>exposedProperties = ['window', 'navigator', 'document'];<br/><br/><strong class="lh hk">const </strong>{ window } = <strong class="lh hk">new </strong>JSDOM('', { url: 'http://localhost' });<br/>global.document = window.document;<br/>global.window = window;<br/>Object.keys(document.defaultView).forEach((property) =&gt; {<br/>  <strong class="lh hk">if </strong>(<strong class="lh hk">typeof </strong>global[property] === 'undefined') {<br/>    exposedProperties.push(property);<br/>    global[property] = document.defaultView[property];<br/>  }<br/>});<br/><br/>global.navigator = {<br/>  userAgent: 'node.js',<br/>};<br/><br/>global.localStorage = {<br/>  setItem() {},<br/>};<br/><br/>global.documentRef = document;</span></pre><p id="ef21" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我添加了babel-register来为旧的ES5编译一个新的ES标准(impors，object spread…)。之后，我配置了酶适配器和axios客户端。以及最重要的部分— jsdom配置。</p><h2 id="d580" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">。nycrc</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="19fc" class="ll lm hj lh b fi ln lo l lp lq">{<br/>  "extension": [".js",".jsx"],<br/>  "require": ["./tests/helper.js"],<br/>  "exclude": [<br/>    "node_modules",<br/>    "build",<br/>    "coverage",<br/>    "tests",<br/>    "src/registerServiceWorker.js"<br/>  ],<br/>  "check-coverage": true,<br/>  "per-file": false,<br/>  "statements": 80,<br/>  "branches": 80,<br/>  "functions": 80,<br/>  "lines": 80,<br/>  "reporter": [<br/>    "lcov",<br/>    "text",<br/>    "text-summary",<br/>    "html"<br/>  ],<br/>  "all": true<br/>}</span></pre><p id="bb1e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">这是纽约市的配置。我们用它来获取代码覆盖率信息。</p><p id="c693" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">正如您在config中看到的——我们需要测试js/jsx文件，添加我们的助手并从测试中排除一些目录和文件。其他参数有助于覆盖率报告。</p><p id="67de" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">要运行它，在<strong class="ii hk"> package.json </strong>中添加一行:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="538a" class="ll lm hj lh b fi ln lo l lp lq">"scripts": {<br/>  "start": "react-scripts start",<br/>  "build": "react-scripts build",<br/>  "eject": "react-scripts eject",<br/>  "test": "npm-run-all test:*",<br/>  "test:security": "nsp check",<br/>  "test:lint": "eslint . --ext .js,.jsx",<br/>  <strong class="lh hk">"test:coverage": "nyc mocha --timeout 5000 tests/**/*.{js,jsx}"</strong><br/>},</span></pre><p id="0d96" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">这里我们用mocha运行nyc，我们设置测试超时和测试文件的路径。</p><p id="5fe9" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">如果您只想运行摩卡而不想运行nyc:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="0a71" class="ll lm hj lh b fi ln lo l lp lq">mocha --timeout 5000 --require tests/helper.js tests/**/*.{js,jsx}</span></pre><p id="8a53" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">现在我们可以运行测试了:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="440f" class="ll lm hj lh b fi ln lo l lp lq">yarn test</span></pre><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em mx"><img src="../Images/3d70489fd4fbee15648bb44cbe439087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RlV372DKqriIfyXU9-hR6Q.png"/></div></div></figure><p id="3689" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们没有通过，因为我们没有任何测试。</p><p id="82a3" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">让我们创建它…</p><h2 id="0c7e" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">动作类型(<strong class="ak">测试/模块/发布/类型/索引. js </strong>):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="27bc" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ expect } <strong class="lh hk">from </strong>'chai';<br/><strong class="lh hk">import </strong>* <strong class="lh hk">as </strong>types <strong class="lh hk">from </strong>'../../../../src/modules/post/types';<br/><br/>describe('Testing post module types', () =&gt; {<br/>  it('should test POST_TITLE', () =&gt; {<br/>    expect(types.POST_TITLE).to.be.equal('@@post/TITLE');<br/>  });<br/><br/>  it('should test POST_BODY', () =&gt; {<br/>    expect(types.POST_BODY).to.be.equal('@@post/BODY');<br/>  });<br/><br/>  it('should test POST_SUBMIT', () =&gt; {<br/>    expect(types.POST_SUBMIT).to.be.equal('@@post/SUBMIT');<br/>  });<br/>});</span></pre><p id="e30f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">每次测试我都需要从<strong class="ii hk">柴</strong>包中导入<strong class="ii hk">期望</strong>工具。这有助于用BDD风格做决定。每次测试应从<strong class="ii hk">开始，描述</strong>部分，并包括<strong class="ii hk">到</strong>部分。</p><h2 id="1f17" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">动作创建者(<strong class="ak">测试/模块/发布/动作/索引. js </strong>):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="cd4b" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ expect } <strong class="lh hk">from </strong>'chai';<br/><strong class="lh hk">import </strong>* <strong class="lh hk">as </strong>actions <strong class="lh hk">from </strong>'../../../../src/modules/post/actions';<br/><strong class="lh hk">import </strong>* <strong class="lh hk">as </strong>types <strong class="lh hk">from </strong>'../../../../src/modules/post/types';<br/><br/>describe('Testing post module actions', () =&gt; {<br/>  it('should test titleAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>title = 'title';<br/><br/>    <strong class="lh hk">const </strong>action = actions.titleAction(title);<br/><br/>    expect(action).to.be.a('object');<br/><br/>    expect(action.type).to.be.equal(types.POST_TITLE);<br/>    expect(action.title).to.be.equal(title);<br/>  });<br/><br/>  it('should test bodyAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>body = 'body';<br/><br/>    <strong class="lh hk">const </strong>action = actions.bodyAction(body);<br/><br/>    expect(action).to.be.a('object');<br/><br/>    expect(action.type).to.be.equal(types.POST_BODY);<br/>    expect(action.body).to.be.equal(body);<br/>  });<br/><br/>  it('should test submitAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>action = actions.submitAction();<br/><br/>    expect(action).to.be.a('object');<br/><br/>    expect(action.type).to.be.equal(types.POST_SUBMIT);<br/>  });<br/>});</span></pre><p id="a781" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">如你所见，我们使用纯函数。没有副作用。使用相同的参数总是得到相同的结果。易于测试—只需运行它并检查结果。</p><p id="47e6" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">动作创建者总是返回至少有一个属性的对象——动作类型。这是与商店合作的必要参数，我们应该每次都测试它。</p><h2 id="5041" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">容器(测试/模块/发布/容器/索引. jsx):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="bc4e" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>React <strong class="lh hk">from </strong>'react';<br/><strong class="lh hk">import </strong>{ mount } <strong class="lh hk">from </strong>'enzyme';<br/><strong class="lh hk">import </strong>{ expect } <strong class="lh hk">from </strong>'chai';<br/><strong class="lh hk">import </strong>{ spy } <strong class="lh hk">from </strong>'sinon';<br/><strong class="lh hk">import </strong>configureMockStore <strong class="lh hk">from </strong>'redux-mock-store';<br/><strong class="lh hk">import </strong>{ Provider } <strong class="lh hk">from </strong>'react-redux';<br/><br/><strong class="lh hk">import </strong>PostContainer <strong class="lh hk">from </strong>'../../../../src/modules/post/containers';<br/><br/>describe('Testing post module containers', () =&gt; {<br/>  it('should test containers with login', () =&gt; {<br/>    <strong class="lh hk">const </strong>Component = spy(() =&gt; <strong class="lh hk">null</strong>);<br/>    <strong class="lh hk">const </strong>Container = PostContainer(Component);<br/><br/>    <strong class="lh hk">const </strong>title = 'title';<br/>    <strong class="lh hk">const </strong>body = 'body';<br/><br/>    <strong class="lh hk">const </strong>mockStore = configureMockStore([]);<br/>    <strong class="lh hk">const </strong>store = mockStore({<br/>      post: {<br/>        title,<br/>        body,<br/>      },<br/>    });<br/><br/>    <strong class="lh hk">const </strong>wrapper = mount(&lt;Provider store={store}&gt;&lt;Container /&gt;&lt;/Provider&gt;);<br/><br/>    expect(wrapper.find(Component)).to.have.length(1);<br/><br/>    <strong class="lh hk">const </strong>props = wrapper.find(Component).props();<br/><br/>    expect(props.title).to.be.equal(title);<br/>    expect(props.body).to.be.equal(body);<br/>    expect(props.titleAction).to.be.a('function');<br/>    expect(props.bodyAction).to.be.a('function');<br/>    expect(props.submitAction).to.be.a('function');<br/>  });<br/>});</span></pre><p id="4e60" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">在这个测试中，我们使用<strong class="ii hk"> mount </strong>，因为我们需要使用存储。由于redux是单例的，要运行每个测试，我们应该清除它。Redux-mock-store对此有所帮助。</p><p id="9e50" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">接下来，我们创建商店，安装容器并检查组件道具。我们不需要真组件，用sinon <strong class="ii hk"> spy </strong>就行了。</p><h2 id="1582" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">组件(<strong class="ak">测试/模块/post/containers/index.jsx </strong>):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="936c" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>React <strong class="lh hk">from </strong>'react';<br/><strong class="lh hk">import </strong>{ shallow } <strong class="lh hk">from </strong>'enzyme';<br/><strong class="lh hk">import </strong>{ expect } <strong class="lh hk">from </strong>'chai';<br/><strong class="lh hk">import </strong>{ spy } <strong class="lh hk">from </strong>'sinon';<br/><br/><strong class="lh hk">import </strong>PostComponent <strong class="lh hk">from </strong>'../../../../src/modules/post/components';<br/><br/>describe('Testing post module PostComponent', () =&gt; {<br/>  <strong class="lh hk">const </strong>title = 'title';<br/>  <strong class="lh hk">const </strong>body = 'body';<br/>  <strong class="lh hk">const </strong>titleAction = () =&gt; 1;<br/>  <strong class="lh hk">const </strong>bodyAction = () =&gt; 1;<br/>  <strong class="lh hk">const </strong>submitAction = () =&gt; 1;<br/><br/>  <strong class="lh hk">const </strong>props = {<br/>    title,<br/>    body,<br/>    titleAction,<br/>    bodyAction,<br/>    submitAction,<br/>  };<br/><br/>  it('should test PostComponent', () =&gt; {<br/>    <strong class="lh hk">const </strong>wrapper = shallow(&lt;PostComponent {...props} /&gt;);<br/><br/>    expect(wrapper.find('form')).to.have.length(1);<br/><br/>    expect(wrapper.find('h1')).to.have.length(1);<br/>    expect(wrapper.find('h1').props().children).to.be.equal('Our form example');<br/><br/>    expect(wrapper.find('div')).to.have.length(3);<br/><br/>    expect(wrapper.find('input')).to.have.length(2);<br/><br/>    <strong class="lh hk">const </strong>titleProps = wrapper.find('input').first().props();<br/>    expect(titleProps.type).to.be.equal('text');<br/>    expect(titleProps.value).to.be.equal(title);<br/>    expect(titleProps.onChange).to.be.a('function');<br/><br/>    expect(wrapper.find('textarea')).to.have.length(1);<br/><br/>    <strong class="lh hk">const </strong>bodyProps = wrapper.find('textarea').props();<br/>    expect(bodyProps.value).to.be.equal(body);<br/>    expect(bodyProps.onChange).to.be.a('function');<br/><br/>    <strong class="lh hk">const </strong>submitProps = wrapper.find('input').last().props();<br/>    expect(submitProps.type).to.be.equal('submit');<br/>    expect(submitProps.value).to.be.equal('Submit');<br/>  });<br/><br/>  it('should test PostComponent titleAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>onChange = spy();<br/><br/>    <strong class="lh hk">const </strong>wrapper = shallow(&lt;PostComponent {...props} <strong class="lh hk">titleAction</strong>={onChange} /&gt;);<br/><br/>    expect(wrapper.find('input')).to.have.length(2);<br/><br/>    <strong class="lh hk">const </strong>titleProps = wrapper.find('input').first().props();<br/>    expect(titleProps.type).to.be.equal('text');<br/>    expect(titleProps.value).to.be.equal(title);<br/>    expect(titleProps.onChange).to.be.a('function');<br/><br/>    wrapper.find('input').first().simulate('change', { target: { value: 'test' } });<br/>    expect(onChange.withArgs('test').calledOnce).to.be.equal(<strong class="lh hk">true</strong>);<br/>  });<br/><br/>  it('should test PostComponent bodyAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>onChange = spy();<br/><br/>    <strong class="lh hk">const </strong>wrapper = shallow(&lt;PostComponent {...props} <strong class="lh hk">bodyAction</strong>={onChange} /&gt;);<br/><br/>    expect(wrapper.find('textarea')).to.have.length(1);<br/><br/>    <strong class="lh hk">const </strong>bodyProps = wrapper.find('textarea').props();<br/>    expect(bodyProps.value).to.be.equal(body);<br/>    expect(bodyProps.onChange).to.be.a('function');<br/><br/>    wrapper.find('textarea').simulate('change', { target: { value: 'test' } });<br/>    expect(onChange.withArgs('test').calledOnce).to.be.equal(<strong class="lh hk">true</strong>);<br/>  });<br/><br/>  it('should test PostComponent submitAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>onChange = spy();<br/>    <strong class="lh hk">const </strong>preventDefault = spy();<br/><br/>    <strong class="lh hk">const </strong>wrapper = shallow(&lt;PostComponent {...props} <strong class="lh hk">submitAction</strong>={onChange} /&gt;);<br/><br/>    expect(wrapper.find('form')).to.have.length(1);<br/><br/>    wrapper.find('form').simulate('submit', { preventDefault });<br/>    expect(onChange.calledOnce).to.be.equal(<strong class="lh hk">true</strong>);<br/>    expect(preventDefault.calledOnce).to.be.equal(<strong class="lh hk">true</strong>);<br/>  });<br/>});</span></pre><p id="efd4" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">为了测试每个组件(如果它是作为一个纯函数创建的)，我们只需要制作<strong class="ii hk"> shallow </strong>渲染和测试道具。有时候我们需要模拟DOM动作，比如<strong class="ii hk">点击</strong>或者<strong class="ii hk">提交</strong>。</p><h2 id="2c50" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">入口点(测试/模块/发布/索引. jsx):</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="cc79" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>React <strong class="lh hk">from </strong>'react';<br/><strong class="lh hk">import </strong>{ mount } <strong class="lh hk">from </strong>'enzyme';<br/><strong class="lh hk">import </strong>{ expect } <strong class="lh hk">from </strong>'chai';<br/><strong class="lh hk">import </strong>{ spy } <strong class="lh hk">from </strong>'sinon';<br/><strong class="lh hk">import </strong>configureMockStore <strong class="lh hk">from </strong>'redux-mock-store';<br/><strong class="lh hk">import </strong>{ Provider } <strong class="lh hk">from </strong>'react-redux';<br/><br/><strong class="lh hk">import </strong>PostModule <strong class="lh hk">from </strong>'../../../src/modules/post';<br/><strong class="lh hk">import </strong>PostComponent <strong class="lh hk">from </strong>'../../../src/modules/post/components';<br/><br/>describe('Testing post module', () =&gt; {<br/>  it('should test post module', () =&gt; {<br/>    <strong class="lh hk">const </strong>title = 'title';<br/>    <strong class="lh hk">const </strong>body = 'body';<br/><br/>    <strong class="lh hk">const </strong>mockStore = configureMockStore([]);<br/>    <strong class="lh hk">const </strong>store = mockStore({<br/>      post: {<br/>        title,<br/>        body,<br/>      },<br/>    });<br/><br/>    <strong class="lh hk">const </strong>wrapper = mount(&lt;Provider store={store}&gt;&lt;PostModule /&gt;&lt;/Provider&gt;);<br/><br/>    expect(wrapper.find(PostComponent)).to.have.length(1);<br/><br/>    <strong class="lh hk">const </strong>props = wrapper.find(PostComponent).props();<br/><br/>    expect(props.title).to.be.equal(title);<br/>    expect(props.body).to.be.equal(body);<br/>    expect(props.titleAction).to.be.a('function');<br/>    expect(props.bodyAction).to.be.a('function');<br/>    expect(props.submitAction).to.be.a('function');<br/>  });<br/>});</span></pre><p id="c4a4" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">同容器试验一样。</p><p id="e7f3" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">如果我们禁用对除我们的模块之外的所有其他代码的检查:</p><h2 id="21de" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">。nycrc</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="d2a7" class="ll lm hj lh b fi ln lo l lp lq">{<br/>  "extension": [".js",".jsx"],<br/>  "require": ["./tests/helper.js"],<br/>  "exclude": [<br/>    "node_modules",<br/>    "build",<br/>    "coverage",<br/>    "tests",<br/>    "src/registerServiceWorker.js",<br/>    <strong class="lh hk">"src/*.*"</strong><br/>  ],<br/>  "check-coverage": true,<br/>  "per-file": false,<br/>  "statements": 80,<br/>  "branches": 80,<br/>  "functions": 80,<br/>  "lines": 80,<br/>  "reporter": [<br/>    "lcov",<br/>    "text",<br/>    "text-summary",<br/>    "html"<br/>  ],<br/>  "all": true<br/>}</span></pre><p id="8c74" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们有完整的代码覆盖:</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em mx"><img src="../Images/9f518ddbddd64dd994bc4cb486052ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KzTaIHnqPxiKsIbg-hMbSQ.png"/></div></div></figure></div><div class="ab cl jm jn gr jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hc hd he hf hg"><p id="83d1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">因此，正如你所看到的，我们花了很多时间来创建和测试redux的东西。为了节省时间，我创建了redux-lazy。我在<a class="ae kr" rel="noopener" href="/@evheniybystrov/react-redux-for-lazy-developers-b551f16a456f"> <strong class="ii hk">上一部</strong> </a>中描述过。现在我要删除所有redux代码，用7行代码代替。</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="5f5e" class="ll lm hj lh b fi ln lo l lp lq">yarn add redux-lazy</span></pre><p id="33f1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">并添加到我们的模块(<strong class="ii hk">src/modules/post/rl/index . js</strong>):</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="2894" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>RL <strong class="lh hk">from </strong>'redux-lazy';<br/><br/><strong class="lh hk">const </strong>rl = <strong class="lh hk">new </strong>RL('post');<br/>rl.addAction('title', { title: '' });<br/>rl.addAction('body', { body: '' });<br/>rl.addAction('submit');<br/><br/><strong class="lh hk">const </strong>result = rl.flush();<br/><br/><strong class="lh hk">export default </strong>result;</span></pre><p id="fa75" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">让我们更新我们的行动和减速器:</p><h2 id="9c48" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">动作创建者:</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="1484" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>rl <strong class="lh hk">from </strong>'../rl';<br/><br/><strong class="lh hk">const {<br/>  POST_TITLE,<br/>  POST_BODY,<br/>  POST_SUBMIT,<br/>} = rl.types;</strong><br/><br/><strong class="lh hk">export const </strong>titleAction = title =&gt; ({<br/>  type: POST_TITLE,<br/>  title,<br/>});<br/><br/><strong class="lh hk">export const </strong>bodyAction = body =&gt; ({<br/>  type: POST_BODY,<br/>  body,<br/>});<br/><br/><strong class="lh hk">export const </strong>submitAction = () =&gt; ({<br/>  type: POST_SUBMIT,<br/>});</span></pre><h2 id="8683" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">减速器:</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="cb36" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>rl <strong class="lh hk">from </strong>'../rl';<br/><br/><strong class="lh hk">const {<br/>  POST_TITLE,<br/>  POST_BODY,<br/>} = rl.types;</strong><br/><br/><strong class="lh hk">const </strong>defaultState = {<br/>  title: '',<br/>  body: '',<br/>};<br/><br/><strong class="lh hk">export default </strong>(state = defaultState, action) =&gt; {<br/>  <strong class="lh hk">switch </strong>(action.type) {<br/>    <strong class="lh hk">case </strong>POST_TITLE:<br/>    <strong class="lh hk">case </strong>POST_BODY:<br/>      <strong class="lh hk">return </strong>{ ...state, ...action };<br/>    <strong class="lh hk">default</strong>:<br/>      <strong class="lh hk">return </strong>state;<br/>  }<br/>};</span></pre><h2 id="8ef2" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">类型测试:</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="9ad5" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ expect } <strong class="lh hk">from </strong>'chai';<br/><strong class="lh hk">import </strong>rl <strong class="lh hk">from </strong>'../../../../src/modules/post/rl';<br/><br/><strong class="lh hk">const </strong>{ types } = rl;<br/><br/>describe('Testing post module types', () =&gt; {<br/>  it('should test POST_TITLE', () =&gt; {<br/>    expect(types.POST_TITLE).to.be.equal('@@post/TITLE');<br/>  });<br/><br/>  it('should test POST_BODY', () =&gt; {<br/>    expect(types.POST_BODY).to.be.equal('@@post/BODY');<br/>  });<br/><br/>  it('should test POST_SUBMIT', () =&gt; {<br/>    expect(types.POST_SUBMIT).to.be.equal('@@post/SUBMIT');<br/>  });<br/>});</span></pre><p id="c380" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">测试之后，我们看到了相同的结果。让我们删除类型文件并再次运行测试。没关系。</p><p id="3c15" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">因此，我们至少可以将手动创建类型和冗余创建类型结合起来。</p><p id="4e73" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated"><strong class="ii hk">下一步</strong>:动作创建者。</p><h2 id="4bdc" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">减速器:</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="c7f0" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ connect } <strong class="lh hk">from </strong>'react-redux';<br/><strong class="lh hk">import </strong>rl <strong class="lh hk">from </strong>'../rl';<br/><br/><strong class="lh hk">const { actions } = rl;</strong><br/><br/><strong class="lh hk">const </strong>mapStateToProps = state =&gt; state.post;<br/><strong class="lh hk">const </strong>mapDispatchToProps = { ...actions };<br/><br/><strong class="lh hk">export default </strong>connect(mapStateToProps, mapDispatchToProps);</span></pre><h2 id="4189" class="ll lm hj bd ly lz ma mb mc md me mf mg ir mh mi mj iv mk ml mm iz mn mo mp mq dt translated">和测试:</h2><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="c146" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ expect } <strong class="lh hk">from </strong>'chai';<br/><strong class="lh hk">import </strong>rl <strong class="lh hk">from </strong>'../../../../src/modules/post/rl';<br/><br/><strong class="lh hk">const { types, actions } = rl;</strong><br/><br/>describe('Testing post module actions', () =&gt; {<br/>  it('should test titleAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>title = 'title';<br/><br/>    <strong class="lh hk">const </strong>action = actions.titleAction(<strong class="lh hk">{ title }</strong>);<br/><br/>    expect(action).to.be.a('object');<br/><br/>    expect(action.type).to.be.equal(types.POST_TITLE);<br/>    expect(<strong class="lh hk">action.payload.title</strong>).to.be.equal(title);<br/>  });<br/><br/>  it('should test bodyAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>body = 'body';<br/><br/>    <strong class="lh hk">const </strong>action = actions.bodyAction(<strong class="lh hk">{ body }</strong>);<br/><br/>    expect(action).to.be.a('object');<br/><br/>    expect(action.type).to.be.equal(types.POST_BODY);<br/>    expect(<strong class="lh hk">action.payload.body</strong>).to.be.equal(body);<br/>  });<br/><br/>  it('should test submitAction', () =&gt; {<br/>    <strong class="lh hk">const </strong>action = actions.submitAction();<br/><br/>    expect(action).to.be.a('object');<br/><br/>    expect(action.type).to.be.equal(types.POST_SUBMIT);<br/>  });<br/>});</span></pre><p id="5883" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated"><strong class="ii hk">下一步</strong>:减速器(<strong class="ii hk"> src/reducers.js </strong>)</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="994f" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>{ combineReducers } <strong class="lh hk">from </strong>'redux';<br/><br/><strong class="lh hk">import </strong>rl <strong class="lh hk">from </strong>'./modules/post/rl';<br/><br/><strong class="lh hk">const </strong>{ nameSpace: postNameSpace, reducer: postReducer } = rl;<br/><br/><strong class="lh hk">export default </strong>combineReducers({ [postNameSpace]: postReducer });</span></pre><p id="00b8" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们可以删除它。</p><p id="7b59" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated"><strong class="ii hk">最后一步</strong>是容器。如果它如此简单(只是来自模块的状态的一部分和来自模块的所有动作)，我们也可以从redux-lazy中得到它。</p><p id="2dd8" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们最后的切入点:</p><pre class="jf jg jh ji ey lg lh li lj aw lk dt"><span id="9ddd" class="ll lm hj lh b fi ln lo l lp lq"><strong class="lh hk">import </strong>PostComponent <strong class="lh hk">from </strong>'./components';<br/><strong class="lh hk">import </strong>rl <strong class="lh hk">from </strong>'./rl';<br/><br/><strong class="lh hk">const </strong>{ Container: PostContainer } = rl;<br/><br/><strong class="lh hk">export default </strong>PostContainer(PostComponent);</span></pre><p id="1884" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">如果我们运行我们的应用程序，我们会看到相同的结果:</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lw"><img src="../Images/4851b1df40ed343e54afc337b678bb85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CmNBHmWEL9aYSR8-MXHszQ.png"/></div></div></figure><p id="26af" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">如果我们进行测试:</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em mx"><img src="../Images/6ebcef60e0fab27f953ea2166955a7f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gD6NGX02J2Iqj0jjUjEi-g.png"/></div></div></figure><p id="db7f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">我们可以看到相同的测试，相同的功能，但代码更少。让我们看看树:</p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em mx"><img src="../Images/34aa9439fadf188248793dd7356ab099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOeI0aMxVEQgOV5xyU6Ghg.png"/></div></div></figure><p id="3410" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">您可以在浏览器中打开覆盖率报告。只要打开<strong class="ii hk"> coverage/index.html </strong></p><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lw"><img src="../Images/4bc2e9cff9bc70a93c8966bdf11d0f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssTwfm0mMkZOkmpbmh05Iw.png"/></div></div></figure><figure class="jf jg jh ji ey jj el em paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="el em lw"><img src="../Images/4997bd4a64589aa9a13d9a3b686126a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4RwGbFdupR5Deruwv_x6Nw.png"/></div></div></figure></div><div class="ab cl jm jn gr jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hc hd he hf hg"><p id="4f47" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">这篇文章比我计划的要大。所以我可以在下一部分给出更多的例子。</p><p id="92eb" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">但是本文的主要目标是展示使用redux-lazy使用redux有多快和多容易。我们制作了许多代码行来获取/设置要存储的数据。</p><p id="bdd9" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">在第一份代码覆盖率报告中，我们有27行代码。现在我们有16个。同样的功能，我们减少了59%的代码。</p><p id="b04e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">再一次...一些开发人员在reducer中加入了很多逻辑(保存前更改数据br)。但是很难支撑。所有代码都应该像纯函数一样简单:</p><p id="eae1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated"><strong class="ii hk">道具= &gt; JSX </strong></p><p id="973c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">有什么容易的？</p><p id="6218" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc dt translated">保持你的组件和存储的纯净，把所有的逻辑转移到特殊的工具上，比如redux-observable和redux-lazy。</p><div class="jt ju eu ew jv jw"><a href="https://hackernoon.com/react-redux-for-lazy-developers-part-3-319b639a22c3" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab gm"><div class="jy ab jz cl cj ka"><h2 class="bd hk fi z kb kc kd ke kf kg kh hi dt translated">React —为懒惰的开发人员提供redux。第三部分</h2><div class="ki l"><h3 class="bd b fi z kb kc kd ke kf kg kh gg translated">这是关于创建react redux应用程序系列的最后一部分。</h3></div><div class="kj l"><p class="bd b fp z kb kc kd ke kf kg kh gg translated">hackernoon.com</p></div></div><div class="kk l"><div class="my l km kn ko kk kp jk jw"/></div></div></a></div></div></div>    
</body>
</html>