<html>
<head>
<title>Keep passwords and secrets out of your logs with Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go将密码和机密从您的日志中删除</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/keep-passwords-and-secrets-out-of-your-logs-with-go-a2294a9546ce?source=collection_archive---------14-----------------------#2018-06-04">https://medium.com/hackernoon/keep-passwords-and-secrets-out-of-your-logs-with-go-a2294a9546ce?source=collection_archive---------14-----------------------#2018-06-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="938b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当使用分布式系统时，通常日志越多越好——复杂之处在于开放可见性，同时保守敏感信息的私密性和安全性。这并不容易，只要问问<a class="ae jp" href="https://hackernoon.com/tagged/github" rel="noopener ugc nofollow" target="_blank"> GitHub </a>和Twitter最近谁发现自己在记录原始密码。</p><p id="d861" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">GitHub和Twitter事件的细节没有公开，但我猜是一个<a class="ae jp" href="https://hackernoon.com/tagged/engineer" rel="noopener ugc nofollow" target="_blank">工程师</a>在没有意识到后果的情况下改变了日志级别配置或记录了请求体。</p><p id="46d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">事实是，这就是工作的现实——在这样复杂的系统中，没有人能够知道每一个变化的后果，尤其是在技术人员流动速度如此之快的情况下。如果我们要解决这样的问题，我们需要更深入。</p><p id="71ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">墨菲定律引发了这样的问题:任何可能出错的事情都会出错——如果你留下一个陷阱，就会有人走进去。我们不要那样做。在写Go的时候，我会做以下事情来避免这样的陷阱，并防止秘密被记录。</p><p id="49ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设您有一个注册请求，如下所示:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="cd9e" class="jz ka hu jv b fv kb kc l kd ke">type CreateUserRequest struct {<br/>    Credentials Credentials `json:”credentials”`<br/>}</span><span id="5951" class="jz ka hu jv b fv kf kc l kd ke">type Credentials struct {<br/>    Email string `json:”email”`<br/>    Password string `json:”password”`<br/>}</span></pre><p id="4c67" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设您正在登录JSON进行Elasticsearch:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="291a" class="jz ka hu jv b fv kb kc l kd ke">// logger we’re using<br/>logger := log.NewJSONLogger(os.Stdout)</span><span id="f768" class="jz ka hu jv b fv kf kc l kd ke">// request we decoded<br/>request := CreateUserRequest{<br/>    Credentials: Credentials{<br/>        Email: “<a class="ae jp" href="mailto:bilbro@theshire.net" rel="noopener ugc nofollow" target="_blank">bilbro@theshire.net</a>”,<br/>        Password: “theonering”,<br/>    },<br/>}</span><span id="3982" class="jz ka hu jv b fv kf kc l kd ke">// our call to log the request<br/>logger.Log(“request”, request)</span><span id="fb90" class="jz ka hu jv b fv kf kc l kd ke">// the output<br/>{“request”:{“credentials” {“email”:”<a class="ae jp" href="mailto:bilbro@theshire.net" rel="noopener ugc nofollow" target="_blank">bilbro@theshire.net</a>”,”password”:”theonering”}}}</span></pre><p id="0e1d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">结果是用户的密码被记录。不太好。</p><p id="4ce8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了解决这个问题，我们将实现自己的MarshalJSON来编辑用户的密码。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="4c1f" class="jz ka hu jv b fv kb kc l kd ke">func (co Credentials) MarshalJSON() ([]byte, error) {<br/>    type credentials Credentials<br/>    cn := credentials(co)<br/>    cn.Password = "[REDACTED]"<br/>    return json.Marshal((*credentials)(&amp;cn))<br/>}</span></pre><p id="35a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，当我们记录相同的请求时，用户的密码不会被记录:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="7f90" class="jz ka hu jv b fv kb kc l kd ke">// the output<br/>{“request”:{“credentials”:{“email”:”<a class="ae jp" href="mailto:bilbro@theshire.net" rel="noopener ugc nofollow" target="_blank">bilbro@theshire.net</a>”,”password”:”[REDACTED]”}}}</span></pre><p id="01cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，无论是谁登录，也无论是在何时何地登录，都不可能记录用户的密码——至少如果您使用这个实现来记录JSON。如果您以另一种格式登录，同样的技术也适用，并且应该有相应的封送方法供您实现。</p><p id="7c8c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt">–</p><p id="0059" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请向<a class="ae jp" href="https://twitter.com/travisjeffery" rel="noopener ugc nofollow" target="_blank"> @travisjeffery </a>问好。</p><p id="1921" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">击中👏如果你觉得这有用，请分享。</p><p id="0420" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感谢阅读。</p><figure class="jq jr js jt fq kg"><div class="bz el l di"><div class="kh ki l"/></div></figure></div></div>    
</body>
</html>