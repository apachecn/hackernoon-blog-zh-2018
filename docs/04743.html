<html>
<head>
<title>Why the Java community should embrace GraalVM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么Java社区应该接受GraalVM</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/why-the-java-community-should-embrace-graalvm-abd3ea9121b5?source=collection_archive---------0-----------------------#2018-06-05">https://medium.com/hackernoon/why-the-java-community-should-embrace-graalvm-abd3ea9121b5?source=collection_archive---------0-----------------------#2018-06-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1c5c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Java发展成为一个<a class="ae jp" href="https://blogs.oracle.com/theaquarium/opening-up-ee-update" rel="noopener ugc nofollow" target="_blank">厂商中立的平台</a>，<a class="ae jp" href="https://jcp.org/aboutJava/communityprocess/ec-public/materials/2017-08-15/JCP-EC-Minutes-August-2017.html" rel="noopener ugc nofollow" target="_blank">移动到六个月发布一次</a>，在最近的版本中平台的进步是非常受欢迎的。作为一个社区，我们见证了Java平台的有趣转变——从一个每两年发布一次新特性的非常稳定的平台(即参见Java 7 &amp; Java 8发布日期)转变为一个快速发展的平台，并且必须与快速发展的新玩家竞争。从我的角度来看，阅读这场辩论并了解企业在很长一段时间后将如何采用这些快速创新真的很有趣，他们已经习惯了在支持创新和不可预测的变化的稳定性之间进行权衡。</p><p id="36fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管Java 9在去年的发布中带来了巨大的进步(即模块化——T4项目拼图)，但我认为围绕两个真正有趣的jep——<a class="ae jp" href="http://openjdk.java.net/jeps/243" rel="noopener ugc nofollow" target="_blank">JEP 243</a>和<a class="ae jp" href="http://openjdk.java.net/jeps/295" rel="noopener ugc nofollow" target="_blank"> JEP 295 </a>并没有太多的讨论。两者都带来了令人敬畏的新功能，可以使Java平台领先于其他平台几个步骤！</p><h1 id="e4aa" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">如果你有一个通用的虚拟机会怎么样？</h1><p id="80cd" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated"><a class="ae jp" href="http://graalvm.org" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> GraalVM </strong> </a>是Oracle实验室开发的一个研究项目，已经在Twitter上投入使用，他们甚至为这个非常棒的项目做出了贡献(参见Christian Thalinger的这篇<a class="ae jp" href="https://www.youtube.com/watch?v=G-vlQaPMAxg" rel="noopener ugc nofollow" target="_blank"> JavaOne talk </a>关于为什么Graal非常适合Twitter)。Graal是一个可以插入Hotspot VM的JIT编译器。JIT基本上是将JVM字节码(由您的<em class="kt"> javac </em>命令生成)翻译成机器码的组件，机器码是您的底层执行环境(即您的处理器)可以理解的语言——所有这些都是在运行时动态发生的！Graal的目标是取代用C++编写的旧的C2编译器。Java社区的主要贡献者明确表示，维护现有的编译器代码已经成为一项艰巨的任务。GraalVM之所以吸引人，是因为最终您可以在您日常使用的标准开发环境中调试JIT编译器，因为它是用Java编写的，开发人员可以更容易地投入其中。</p><p id="3d41" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么，我们怎么会有另一个可以插入甚至用Java编写的JIT编译器呢？！</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff ku"><img src="../Images/e3b1245ac0b74cd8ecf2a0d1d6c2e8f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mG2EvxLK13IY4_AoT9B2Ww.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Slide from <a class="ae jp" href="https://www.youtube.com/watch?v=mMmOntDWSgw" rel="noopener ugc nofollow" target="_blank">Devoxx talk</a> by Thomas Wurethinger</figcaption></figure><p id="f5e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这一切都要感谢JDK 9中提供的<strong class="it hv"> JVMCI </strong> (Java级JVM编译器接口)。编译器接口允许您将附加的Java编译器(如Graal)插入到JVM中。最重要的是，你会发现<strong class="it hv"> Truffle </strong>框架，它使你能够为除Java &amp; Scala之外的其他语言构建解释器和实现。如果你想运行一种新的编程语言，你只需将它与Truffle集成，框架就会为你生成优化的机器代码。如你所见，已经有了R、Ruby、Javascript甚至C/C++的语言实现。在写这篇文章的时候，我看到Golang支持的GitHub有一个问题，看起来不用花太多时间，我们就会看到它与Truffle的集成。在性能方面，GraalVM团队在几次会谈中展示了他们的一些语言实现甚至比现有的更快。</p><h1 id="4b95" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">为什么我对GraalVM如此热情？</h1><p id="86df" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated"><strong class="it hv">多语言</strong> —所有语言(甚至基于LLVM的语言)共享相同的VM及其功能。在这里，您可以看到我如何在Java中嵌入一个Javascript内置函数并打印结果:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff lk"><img src="../Images/fea99561ee8a6ae4daa3c4900c77b60b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x9-F5aE9p69b_OWNpTYNew.png"/></div></div></figure><p id="793e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我使用的是GraalVM 1.0(基于JDK 8)。让我们编译并运行:</p><p id="7044" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kt">bin/javac ~/apps/graal VM-1 . 0 . 0-rc1/sum num . Java</em></p><p id="f112" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kt"> java -cp。SumNum </em></p><p id="ef7c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它打印结果:3</p><p id="f72c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我很好奇在运行时异常的情况下会发生什么——我将调用一些未定义的函数，而不是调用<em class="kt"> parseInt </em>:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff ll"><img src="../Images/1191036cbb25912df62d8879ff31406c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gqy1unSqg4a_xpMewhDORg.png"/></div></div></figure><p id="e5e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这只是一个简单的例子，但你可以做得更深入。最后，我可以使用R提供的强大的可视化库和我的Javascript数据结构——是的，就是这么简单！使用Graal，在平台之间共享对象要容易得多；)您不必再包装或重写您的库。</p><p id="3556" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">显然，Graal中的互操作性是在为我的任务选择最佳语言和编译时静态代码分析之间的权衡。</p><p id="dd49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">语言不可知工具</strong> —除了Java &amp; Scala，所有语言都与Truffle框架对话。因此，您可以使用同一套工具来进行监控、调试和分析。厉害！就性能而言，它使开发体验变得更加容易。目前，Graal实现它的方式非常有限。它们与Chrome开发工具协议集成在一起。调试正在运行的虚拟机非常容易。你需要做的就是用<em class="kt"> inspect </em>参数运行你的脚本，它会打开一个端口，你可以使用Chrome开发工具调试任何你想调试的语言:R，Python等等。查看他们的<a class="ae jp" href="https://www.graalvm.org/docs/reference-manual/tools/" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息。</p><p id="9e56" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">在<a class="ae jp" href="https://www.youtube.com/watch?v=wBegU4d4GRc" rel="noopener ugc nofollow" target="_blank">中引起我注意的事情</a></strong>Oracle的一次演讲是关于Chris如何使用<em class="kt"> jvisualvm </em>工具来剖析一个Ruby应用程序，他甚至可以进行线程转储。很酷，不是吗？！；)</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff lm"><img src="../Images/582fc881bb16e38f00596c9100371708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FcMZMgNIQH-7JGVs4YQVYA.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek"><a class="ae jp" href="https://www.youtube.com/watch?v=wBegU4d4GRc" rel="noopener ugc nofollow" target="_blank">Oracle Developers </a>— Run Programs Faster with GraalVM</figcaption></figure><p id="1ddc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这表明拥有一个抽象平台是多么强大。现在你所要做的就是闭上你的眼睛，梦想用如此强大的能力可以实现伟大的事情。</p><p id="6f14" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">性能</strong> — Graal基准测试报告显示，由于GraalVM执行对象分配的方式，其几乎所有实现都实现了巨大的性能提升:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff ln"><img src="../Images/69122c6d631084607cf625031dfbdb46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*310NJCyl0QF6aPDbBxsbBA.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek"><a class="ae jp" href="https://www.youtube.com/watch?v=8AYESZIaacg" rel="noopener ugc nofollow" target="_blank">Thomas Wuerthinger talk at Devoxx</a></figcaption></figure><p id="4443" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Thomas提到他们<a class="ae jp" href="http://www.graalvm.org/docs/examples/java-performance-examples/" rel="noopener ugc nofollow" target="_blank">看到了Java Streams </a>的巨大改进，lambdas和他们最近的基准测试甚至显示了各种实现的更好的数字。Chris Seaton在博客中写道“TruffleRuby无疑是最快的Ruby实现，通常比其他实现快10倍，同时仍然实现了几乎所有的语言和标准库”。Twitter在产品中运行GraalVM，特别是因为它在Scala服务中的性能改进。他们说这为他们省了钱。</p><p id="fd4f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就互操作性而言，Thomas在Devoxx的演讲中展示了在同一过程中调用一种语言到另一种语言的优势。基准测试清楚地表明，您可以削减上下文切换和对象编组/解组的成本:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff lo"><img src="../Images/68b2e9582a8e52a0bcdc76a2a880d0cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qfG2WCqADp1ZgxxdbYwRcw.png"/></div></div></figure><p id="8835" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">GraalVM 的一个更有趣的项目是底层VM。我把它作为“性能”部分的一部分，但是<strong class="it hv">比那个</strong>更有野心。<strong class="it hv">底层VM </strong>是用Java编写的<strong class="it hv"> AOT </strong>(超前)编译器(参见<a class="ae jp" href="http://openjdk.java.net/jeps/295" rel="noopener ugc nofollow" target="_blank">JEP 295</a>——JDK 9中集成的AOT编译器比较老，我不确定JDK 10和JDK 11中集成了什么)。它使用GraalVM提前创建一个可执行的二进制Mach-O或ELF映像，该映像不需要在<a class="ae jp" href="https://hackernoon.com/tagged/hotspot-vm" rel="noopener ugc nofollow" target="_blank"> Hotspot VM </a>上运行，而是在底层VM本身上运行。编译需要一些时间，但是最终你有了一个可执行的二进制文件，你可以在任何你想运行的地方运行:服务器，移动设备，等等。这里很酷的一点是，它提前执行了所有的优化和打包，因此生成的映像启动时间要快得多(根据他们的文档，您将有更低的运行时内存开销，因为它在编译时执行所有的优化):</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff lp"><img src="../Images/da05b7418a8e65d68888e4cc29e7a5a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SMCMOOuqHNXEfZTmT7WGAQ.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">AOT my polyglot sample program</figcaption></figure><p id="9ea7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如您在上面的截图中看到的，编译我的示例多语言程序花费了2分多钟，但是它的执行时间要快得多(查看基准测试的<a class="ae jp" href="http://www.graalvm.org/docs/reference-manual/aot-compilation/" rel="noopener ugc nofollow" target="_blank"> GraalVM参考</a>)。据我所知，有各种各样的限制，但我立即想到的第一个优势是，随着我的系统扩展，我可以比以前更快地旋转新容器。我看到<a class="ae jp" rel="noopener" href="/graalvm/instant-netty-startup-using-graalvm-native-image-generation-ed6f14ff7692">这篇</a>博客文章解释了如何创建一个即时的Netty启动映像；所以想象一下你可以用它做多少伟大的事情。</p></div><div class="ab cl lq lr hc ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><p id="55a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了推动JVM平台向前发展，Oracle似乎正朝着正确的方向前进。根据<a class="ae jp" href="http://openjdk.java.net/jeps/317" rel="noopener ugc nofollow" target="_blank"> JEP 317 </a>，Graal在JDK 10中变得更加完整。现在，只需添加几个命令行选项，编译器之间的转换就变得更加简单。如果您没有使用JDK 10，您可以从GraalVM网站下载其中一个版本(在编写GraalVM 1.0时，它是基于JDK 8的)，并且已经与其他语言运行时打包在一起，因此您可以轻松地尝试多语言编程。</p><p id="b756" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望你有足够的信息来帮助你开始。我希望甲骨文将继续在这个伟大的项目上投入时间。</p><p id="912b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">玩得开心！</p><p id="2a6c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">埃兰</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="lx ly l"/></div></figure></div></div>    
</body>
</html>