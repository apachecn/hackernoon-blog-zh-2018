<html>
<head>
<title>How to host a Single Page Application with AWS CloudFront and Lambda@Edge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用AWS CloudFront和Lambda@Edge托管单页面应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-host-a-single-page-application-with-aws-cloudfront-and-lambda-edge-39ce7b036da2?source=collection_archive---------5-----------------------#2018-06-05">https://medium.com/hackernoon/how-to-host-a-single-page-application-with-aws-cloudfront-and-lambda-edge-39ce7b036da2?source=collection_archive---------5-----------------------#2018-06-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="8804" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">配置CloudFront以支持推送状态URL</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/01d28b3f4388c449301650b020849eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4pR9T8PpOTfbQtjV80-VA.jpeg"/></div></div></figure><p id="ae78" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">这似乎是一个简单的方法，然而我被浪费在配置静态网站托管的<a class="ae kr" href="https://hackernoon.com/tagged/aws" rel="noopener ugc nofollow" target="_blank"> AWS </a>上的时间震惊了，一定有更好的方法:</p><p id="33f5" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">— <strong class="jx hv">无服务器</strong>:我们将托管静态资产，所以不要再浪费服务器了<br/> — <strong class="jx hv">廉价且超高性能</strong>:通过利用AWS CDN，我们将获得世界一流的全球分发和缓存，只需几分钱<br/> — <strong class="jx hv">自动化</strong>:这不是AWS控制台的教程。我咨询的一些营销机构通常会每周部署新的登录页面或静态网站。如果这也是你经常做的事情，那么花一个小时把它自动化成一个按钮式的过程是值得的，不是吗？</p><h2 id="50f4" class="ks kt hu bd ku kv kw kx ky kz la lb lc ke ld le lf ki lg lh li km lj lk ll lm dt translated">关于自动化</h2><p id="bbe9" class="pw-post-body-paragraph jv jw hu jx b jy ln iv ka kb lo iy kd ke lp kg kh ki lq kk kl km lr ko kp kq hn dt translated">即使是很小的事情，自动化也有非常强大的力量。随着时间的推移，其好处远远超过节省时间的总和，它将减少人为错误，提高服务的可靠性，让您的员工忙于更高价值的工作，并通过消除无聊的低价值任务来提高员工的士气。它改善了你的全球业务。</p><blockquote class="ls"><p id="241d" class="lt lu hu bd lv lw lx ly lz ma mb kq ek translated">游戏改变者:有了Lambda@Edge，我们现在可以配置CloudFront来支持<em class="mc">推送状态URL</em></p></blockquote><p id="1abb" class="pw-post-body-paragraph jv jw hu jx b jy md iv ka kb me iy kd ke mf kg kh ki mg kk kl km mh ko kp kq hn dt translated">到目前为止，在CloudFront上托管SPA的问题是，我们无法支持<em class="mi">推送状态URL</em>，因为CloudFront不提供“无所不包”的配置，也就是说，我们无法为域的任何请求提供相同的<code class="eh mj mk ml mm b">index.html</code>文件。解决方案是使用散列状态的“丑陋”的URL，这对于大多数人来说是一个障碍。</p><p id="db61" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">2017年，AWS发布了Lambda@Edge，这是一种在云“边缘”运行Lambda功能的服务，即在CDN查询其缓存之前/之后立即运行:</p><ul class=""><li id="e91e" class="mn mo hu jx b jy jz kb kc ke mp ki mq km mr kq ms mt mu mv dt translated"><em class="mi">查看器请求</em>:CloudFront收到查看器的请求后</li><li id="8902" class="mn mo hu jx b jy mw kb mx ke my ki mz km na kq ms mt mu mv dt translated"><em class="mi">原点请求</em>:在CloudFront转发请求给原点之前</li><li id="4e19" class="mn mo hu jx b jy mw kb mx ke my ki mz km na kq ms mt mu mv dt translated"><em class="mi">原点响应:【CloudFront收到原点响应后</em></li><li id="7ae3" class="mn mo hu jx b jy mw kb mx ke my ki mz km na kq ms mt mu mv dt translated"><em class="mi">查看器响应</em>:CloudFront将响应转发给查看器之前</li></ul><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff nb"><img src="../Images/b92dd0e172a4f6848decdf5b3de39d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*BMFkeiwzlYyIV6YbYwb1QA.jpeg"/></div></figure><p id="7994" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">这将让我们重写<em class="mi">源请求</em>上的请求，以便我们总是为所有推送状态路由请求服务<code class="eh mj mk ml mm b">index.html</code>。快乐的日子！</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nc nd l"/></div><figcaption class="ne nf fg fe ff ng nh bd b be z ek">Our origin-request Lambda@Edge function</figcaption></figure><h2 id="eb6a" class="ks kt hu bd ku kv kw kx ky kz la lb lc ke ld le lf ki lg lh li km lj lk ll lm dt translated">我需要什么？</h2><ul class=""><li id="2011" class="mn mo hu jx b jy ln kb lo ke ni ki nj km nk kq ms mt mu mv dt translated">在您的AWS帐户中注册为托管区域的现有域名</li><li id="91ab" class="mn mo hu jx b jy mw kb mx ke my ki mz km na kq ms mt mu mv dt translated">适用于所有子域的通配符SSL证书</li><li id="8d62" class="mn mo hu jx b jy mw kb mx ke my ki mz km na kq ms mt mu mv dt translated">在您的机器上安装和配置的<code class="eh mj mk ml mm b">terraform</code>和<code class="eh mj mk ml mm b">aws</code> CLI</li><li id="48b3" class="mn mo hu jx b jy mw kb mx ke my ki mz km na kq ms mt mu mv dt translated">要部署的虚拟React或Vue应用程序</li></ul><h2 id="251f" class="ks kt hu bd ku kv kw kx ky kz la lb lc ke ld le lf ki lg lh li km lj lk ll lm dt translated">给我看看地形模块！</h2><p id="a022" class="pw-post-body-paragraph jv jw hu jx b jy ln iv ka kb lo iy kd ke lp kg kh ki lq kk kl km lr ko kp kq hn dt translated">我已经发布了一个<a class="ae kr" href="https://hackernoon.com/tagged/terraform" rel="noopener ugc nofollow" target="_blank"> Terraform </a>模块，它可以为您完成所有繁重的工作:</p><div class="nl nm fm fo nn no"><a href="https://github.com/li0nel/terraform-aws-single-page-application" rel="noopener  ugc nofollow" target="_blank"><div class="np ab ej"><div class="nq ab nr cl cj ns"><h2 class="bd hv fv z el nt eo ep nu er et ht dt translated">li0 nel/terraform-AWS-单页-应用程序</h2><div class="nv l"><h3 class="bd b fv z el nt eo ep nu er et ek translated">terra form-aws-single-page-application-terra form模块，允许您使用Git Push在AWS上部署spa</h3></div><div class="nw l"><p class="bd b gc z el nt eo ep nu er et ek translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc jt no"/></div></div></a></div><p id="27b3" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">将示例文件复制到您的SPA根文件夹:<br/> <code class="eh mj mk ml mm b">wget https://raw.githubusercontent.com/li0nel/terraform-aws-single-page-application/master/examples/main.tf<br/>wget https://raw.githubusercontent.com/li0nel/terraform-aws-single-page-application/master/examples/outputs.tf<br/>wget https://raw.githubusercontent.com/li0nel/terraform-aws-single-page-application/master/examples/terraform.tfvars</code> <br/> <code class="eh mj mk ml mm b">wget https://raw.githubusercontent.com/li0nel/terraform-aws-single-page-application/master/examples/variables.tf</code></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nc nd l"/></div><figcaption class="ne nf fg fe ff ng nh bd b be z ek">This will pull the Terraform module from the Terraform registry</figcaption></figure><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nc nd l"/></div></figure><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nc nd l"/></div></figure><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nc nd l"/></div></figure><p id="4ee1" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">用您的<code class="eh mj mk ml mm b">aws</code> CLI配置文件名称、应用程序名称和域名替换<code class="eh mj mk ml mm b">terraform.tfvars</code>中的值。确保您拥有<em class="mi">美国东部-1 </em>地区<code class="eh mj mk ml mm b">*.cdn.mydomain.com</code>的现有证书。</p><p id="bf68" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">运行<code class="eh mj mk ml mm b">terraform init</code>，然后运行<code class="eh mj mk ml mm b">terraform apply</code>，等待S3桶、Lambda函数和CloudFront分布被创建:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff od"><img src="../Images/5acf7a45709856bf7ba3c543c093f1f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQNKle-QloQDoQ0kAC1R-Q.png"/></div></div></figure><p id="2f30" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">现在，您可以在本地编译您的前端资产，并将它们直接推送到S3存储桶来部署您的应用程序:</p><p id="95ad" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated"><code class="eh mj mk ml mm b">yarn build &amp;&amp; aws s3 cp --recursive --acl=public-read build/ s3://$(terraform output s3_bucket)</code></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff od"><img src="../Images/e23cdcc8b410afbf799be292ccba6fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dq6UJ_VHWxDF4RfCFA2xTw.png"/></div></div></figure><p id="b460" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">另一种方法是使用由Terraform模块创建的CodeCommit Git存储库和CodePipeline管道，让AWS构建您的应用程序，运行您的测试并在S3上部署。</p><p id="3a0a" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">不管怎样，您的应用程序现在运行在CloudFront上了！</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oe"><img src="../Images/807cab78468478bc661d469528c9b804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YtdVF3ZdUhnGUCWabcPjLQ.png"/></div></div><figcaption class="ne nf fg fe ff ng nh bd b be z ek">The push-state URL working properly when refreshing the page</figcaption></figure><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="of nd l"/></div></figure></div><div class="ab cl og oh hc oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="hn ho hp hq hr"><p id="c1a0" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated"><em class="mi">莱昂内尔是总部位于伦敦的初创公司Wi5的首席技术官，也是《面向未来的工程文化课程</em>  <em class="mi">的作者。你可以在【https://getlionel.com】<a class="ae kr" href="https://getlionel.com" rel="noopener ugc nofollow" target="_blank"><em class="mi"/></a>上联系他</em></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="of nd l"/></div></figure></div></div>    
</body>
</html>