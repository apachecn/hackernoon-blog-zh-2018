<html>
<head>
<title>Thoughts on gRPC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于gRPC的思考</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/thoughts-on-grpc-c7ff8dcf8476?source=collection_archive---------6-----------------------#2018-06-06">https://medium.com/hackernoon/thoughts-on-grpc-c7ff8dcf8476?source=collection_archive---------6-----------------------#2018-06-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/022cefed4e48c1e28b686d73cdaa1d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9pQvj1UAqt8CAeMpsmjmw.jpeg"/></div></div></figure><p id="41b3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Go和gRPC已经成为最近微服务的流行选择。gRPC是一种高效的有线通信协议。构建在http/2和protobuf之上(理论上也支持其他序列化协议)，这应该更快，网络开销更少，是一个高效的协议。</p><h2 id="12e8" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated"><strong class="ak">什么是http/2 </strong></h2><p id="c837" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">Http 2是Http协议的下一个版本(http 1.1是最常用的当前版本)。关于http 2.0有几点需要注意</p><ol class=""><li id="c52d" class="la lb hu je b jf jg jj jk jn lc jr ld jv le jz lf lg lh li dt translated">它支持连接多路复用。因此，如果有多个并行请求从一个服务器发送到另一个服务器，所有的响应都可以通过一个连接一起、交错地发送，与通过单独的连接发送响应相比，速度更快。</li><li id="056f" class="la lb hu je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li dt translated">在http 1.1中，标头是作为二进制数据而不是纯文本进行压缩和传输的。</li><li id="2f65" class="la lb hu je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li dt translated">连接重用也意味着ssl握手的开销更少。</li><li id="8bc1" class="la lb hu je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li dt translated">目前大部分实现只支持https模式(虽然这似乎不是一个要求，只是目前实现在浏览器中的一种做法)，使其更加安全。</li></ol><p id="88c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果http 2.0这么好，为什么不是所有人都用？</p><h2 id="ced7" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated"><strong class="ak">陷阱</strong></h2><ol class=""><li id="fed5" class="la lb hu je b jf kv jj kw jn lo jr lp jv lq jz lf lg lh li dt translated">主要是针对web用例。RFC谈到了这一点，核心焦点是浏览器用例。虽然也可以用于非浏览器场景。</li><li id="9458" class="la lb hu je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li dt translated">如果只涉及一个请求响应，多路复用实际上会增加开销。在基于代理或dns的循环方案的情况下，每个请求可能被路由到不同的下游，多路复用不能很好地工作。在同一个请求上下文中同时对同一个服务进行多个下游调用的可能性也较小。因此在这种情况下多路复用可能效率不高。</li><li id="f7d4" class="la lb hu je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li dt translated">非浏览器用例中的标题数量通常是有限的。在浏览器用例中，较大的标题大小可能主要归因于cookies。头的数量越少，压缩增益就越小。</li><li id="760f" class="la lb hu je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li dt translated">压缩的二进制标题也意味着检查变得困难，并且需要升级工具集。</li></ol><h2 id="4e93" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated"><strong class="ak">什么是protobuf </strong></h2><p id="73c8" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">Protobuf是一种用于有线通信的消息协议。作为一种二进制传输协议，它将数据压缩成一种紧凑的格式，以便高效、快速地进行数据传输。使用protobuf的客户端库有几种语言版本。Golang有原生的protobuf支持。</p><h2 id="a284" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated"><strong class="ak">序列化协议简史</strong></h2><p id="dfd9" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">很久以前，XML是一种默认的序列化格式，Java的日益流行可以归功于它的兴起。</p><p id="fde6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然xml对于人和机器来说都很容易读/写/操作，但是它太冗长了，而且对于较大的有效负载来说，它有很高的开销。</p><p id="9322" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">随着javascript的流行，另一种很酷的序列化格式也开始流行，即JSON。JSON的大小要小得多，仍然完全可读，也不那么冗长。</p><p id="94a4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然JSON可读性很强，但是它的规范似乎不是很清楚，而且有时不同的库会对它有不同的解释。解析JSON似乎也更加耗费CPU资源。golang中默认的JSON解析器实际上似乎更慢。</p><p id="54ad" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为，更大的有效载荷导致更高的网络传输成本，一种替代方法是在传输之前压缩数据，然后在另一端解压缩。这种技术非常流行，事实上大多数现代浏览器都支持gzip压缩，并且默认启用，这有助于减少有效负载的大小。因此，对于基于json/xml的服务，通常启用压缩，这在很大程度上减少了有效负载的大小。</p><p id="1ff0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了更有效地打包数据，需要更好的选项。专注于核心需求，而不是作为一个通用的序列化解决方案，许多公司开发了自己的协议，这些协议附加了较少的元数据，从而减少了有效负载的大小。</p><p id="2426" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Protobuff就是这样一种选择。它是在Google内部开发的，后来开源了。节俭是另一个由脸书开发的，后来开源了。</p><p id="00d6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">要问的几个问题</strong></p><ol class=""><li id="c777" class="la lb hu je b jf jg jj jk jn lc jr ld jv le jz lf lg lh li dt translated">协议对我们感兴趣的语言有库支持吗(考虑客户端和服务器语言)</li><li id="2ca6" class="la lb hu je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li dt translated">如果需要的话，它有从命令行手动请求响应的工具吗(主要用于调试和测试)</li><li id="d6d9" class="la lb hu je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li dt translated">API的用户会习惯使用它吗？一般来说，浏览器在处理gzip时对json/xml有很好的支持。类似地，其他流行的工具如curl、postman支持json/xml，但需要gRPC的良好支持。</li></ol><p id="7263" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">参考文献</strong>:</p><p id="e193" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae lr" href="https://cdn-1.wp.nginx.com/wp-content/uploads/2015/09/NGINX_HTTP2_White_Paper_v4.pdf" rel="noopener ugc nofollow" target="_blank">https://cdn-1 . WP . NGINX . com/WP-content/uploads/2015/09/NGINX _ http 2 _ White _ Paper _ v4 . pdf</a></p><div class="ls lt fm fo lu lv"><a href="https://http2.github.io/faq/#what-about-non-browser-users-of-http" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab ej"><div class="lx ab ly cl cj lz"><h2 class="bd hv fv z el ma eo ep mb er et ht dt translated">HTTP/2常见问题</h2><div class="mc l"><h3 class="bd b fv z el ma eo ep mb er et ek translated">这些是关于HTTP/2的常见问题。</h3></div><div class="md l"><p class="bd b gc z el ma eo ep mb er et ek translated">http2.github.io</p></div></div></div></a></div><div class="ls lt fm fo lu lv"><a href="https://grpc.io/docs/guides/#working-with-protocol-buffers" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab ej"><div class="lx ab ly cl cj lz"><h2 class="bd hv fv z el ma eo ep mb er et ht dt translated">grpc /指南</h2><div class="mc l"><h3 class="bd b fv z el ma eo ep mb er et ek translated">一个高性能、开源的通用RPC框架。客户端应用程序可以直接调用服务器上的方法…</h3></div><div class="md l"><p class="bd b gc z el ma eo ep mb er et ek translated">grpc.io</p></div></div><div class="me l"><div class="mf l mg mh mi me mj ja lv"/></div></div></a></div><div class="ls lt fm fo lu lv"><a href="https://news.ycombinator.com/item?id=12796556" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab ej"><div class="lx ab ly cl cj lz"><h2 class="bd hv fv z el ma eo ep mb er et ht dt translated">解析JSON是雷区|黑客新闻</h2><div class="mc l"><h3 class="bd b fv z el ma eo ep mb er et ek translated">第三，解析一切都是雷区，包括HTML。我们作为一个团体投入了大量的集体努力…</h3></div><div class="md l"><p class="bd b gc z el ma eo ep mb er et ek translated">news.ycombinator.com</p></div></div></div></a></div><figure class="mk ml mm mn fq iv"><div class="bz el l di"><div class="mo mp l"/></div></figure></div></div>    
</body>
</html>