<html>
<head>
<title>Microservices for Startups: An Interview with Isaac Mosquera of Armory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初创企业的微服务:军械库的艾萨克·莫斯克拉访谈</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/microservices-for-startups-an-interview-with-isaac-mosquera-of-armory-eefa4e77cddc?source=collection_archive---------8-----------------------#2018-06-06">https://medium.com/hackernoon/microservices-for-startups-an-interview-with-isaac-mosquera-of-armory-eefa4e77cddc?source=collection_archive---------8-----------------------#2018-06-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="2474" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">这次采访是为我们的</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">创业微服务</em> </a> <em class="jp">电子书做的。一定要去看看关于微服务的实用建议。感谢Isaac的时间和投入！</em></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff jr"><img src="../Images/851ac98263b86028d976b14733e34d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/0*_kjX9vsZyozdiGIw."/></div></figure><p id="9383" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" href="https://twitter.com/imosquera?lang=en" rel="noopener ugc nofollow" target="_blank"><em class="jp">is AAC mosque ra</em></a><em class="jp">是</em> <a class="ae jq" href="http://www.armory.io/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">军械库</em> </a> <em class="jp">的CTO，帮助软件团队更好、更快地运送软件。</em></p><p id="299a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于上下文，您的工程团队有多大？您是否正在使用微服务，能否概括介绍一下您是如何使用它们的？</p><p id="e800" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们目前的团队非常小，只有5名工程师，但我们致力于一个名为Spinnaker的开源部署工具，该工具由网飞在2015年开源。网飞使用它来部署超过2000个微服务，每天大约4000次。我们通过微服务和Spinnaker帮助企业客户实现这一速度。</p><p id="9e38" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们认为部署是获得微服务价值的关键组成部分。如果部署的开销很高，将一个整体拆分成更小的组件只会增加整体的复杂性。拥有正确的工具策略和方法，包括部署，是成功的关键</p><p id="8c98" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">你是从整体开始，后来采用微服务的吗？如果是，采用微服务的动机是什么？</strong></p><p id="a34b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们看到许多财富500强的客户已经通过打破现有的整体结构走上了微服务的道路。对许多这样的组织来说，其价值在于可以灵活地向一个组件添加特性，而不会影响另一个组件。假设每个特性的软件开发生命周期都缩短了。目前，关于是否迁移到微服务几乎没有争议，而是哪些服务将在何时迁移。</p><p id="1fae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为一个团队/工程组织，你是如何看待微服务的主题和定义的？</p><p id="b9ad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们不断看到关于微服务的讨论，以及它们在组织中的意义。因为每个组织都在向这种类型的架构发展，所以每个公司对微服务和最佳实践都有不同的理解。此外，微服务的任何实例都在不断变化，因此我们需要帮助组织根据最佳实践部署他们的微服务。</p><p id="484e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">采用微服务后，您是否改变了团队的组织或运营方式？</strong></p><p id="b50d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这几乎总是如此，并成为康威定律的逆定律，“设计系统的组织…被限制生产这些组织的通信结构的副本的设计。”现在软件架构驱动通信，而不是通信驱动软件设计。团队不仅操作和组织不同，而且需要一套新的工具和过程来支持这种类型的架构，即DevOps。随着整体被分割成更小的部分，更小的团队和他们的角色变得更加明显。最擅长或强烈希望解决某一特定类型问题的工程师现在可以被分配到这些微服务中。</p><p id="d3bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">技术选择的自由度有多大？你们是否都同意坚持使用一个堆栈，或者是否有尝试新堆栈的灵活性？</p><p id="0942" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在几乎所有的情况下，工程团队都可以自主地运作，但同时拥有一条“铺设好的道路”,这条道路拥有一套受支持的工具。主要的工具集通常是由于特定于该公司的遗留原因而设置的。我们通常会看到一组JVM语言和一种脚本语言(Python/Ruby/JavaScript ),以获得编码风格的灵活性。使用这些语言没有严格的要求，但是在团队中众所周知，这些语言可以大规模工作，并且有最好的工具支持。</p><p id="a99e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">你有没有把一个单一的应用程序分解成更小的微服务？如果是的话，你能给我们介绍一下这个过程吗？</strong></p><p id="f03e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一步是包括对应用程序有贡献的人(或团队领导),并开始讨论什么是功能组。随着时间的推移，这变得显而易见，也不那么有争议了[尽管事实上]在重新设计应用程序时总是存在紧张。在与处理代码的有影响力的人讨论之后，我们开始讨论不同的组件将如何被拆分。</p><p id="57c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下一步是创建一个计划。将一个整体拆分成微服务不是一朝一夕的事情。从最容易的、没有争议的组件开始是一个很好的起点。</p><p id="20e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我们执行计划。我们开始尽可能快速迭代地部署新服务，以展示成功。向非工程组织展示成功是至关重要的，因为对这种变化的支持必须通过牺牲产品和功能来获得额外的稳定性和灵活性。我们通常将部署步骤、SLA/SLO和生产部署数量作为KPI来衡量，以展示工程组织之外的价值。</p><p id="8222" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">将一个整体拆分成微服务时，有哪些无法预见的问题和经验教训？</strong></p><p id="c360" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一些功能和代码在微服务中变得多余。例如，与用户注册服务通信的服务将需要反序列化用户对象。虽然这可能会在一些代码库中重复，但如果逻辑足够简单，那也没关系。</p><p id="4461" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们看到的一个特殊问题是，两个微服务负责一个数据库中的一个模式。一开始这是骗人的，因为一个服务是读的，另一个是写的。当一个服务的部署需要另一个服务的部署时，这种类型的问题确实会降低您的速度，并且违背了微服务的目的。</p><p id="62ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你如何确定服务边界？你团队中的讨论是什么样的？</p><p id="3c3b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">起初，这些关于功能分组的讨论似乎是显而易见的。但随着时间的推移，新的商业逻辑将变得更加困难。或者在两个服务中重复一些逻辑？例如，我们有一个维护用户事件的服务，然后发送到日志中。我们引入了处理这些事件并做出运行时决策的功能。决策应该由事件引擎本身决定，还是创建一个全新的服务来处理这个业务逻辑？最终我们的决定是将它包含在同一个服务中，如果产品团队需要额外的功能，我们会决定以后再移动它。</p><p id="183a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您希望如何访问数据对于确定这些界限至关重要。在一个客户站点，他们维护着大量的用户数据。但是根据法律，有些数据比其他数据更敏感。例如，电子邮件、地址和真实姓名必须分离到不同的服务中，这样数据就可以只由一个来源管理。</p><p id="cf73" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">你从尺码服务中学到了什么？</strong></p><p id="bb7c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">越小越好，但是重用大部分工具需要严格的方法。容器化一切都有帮助，因为它内部化了应用程序特定的细节，并允许服务器环境在不同设备之间保持一致。构建工具、监控、警报等。应该放入一组通用的工具中，减少开发的开销，但更重要的是在生产中操作微服务。如果您注意到您的微服务仍然很大，这可能是由于缺少工具。投资工具而不是“更多特性”是我们在这些组织中看到的常见变化。</p><p id="4af6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对您的开发流程或运营和部署流程有何影响？出现了哪些挑战，你是如何解决的？</strong></p><p id="276a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们在以下领域遇到了一些挑战:依赖性管理、部署、监控、警报、SLA/SLO、安全性、团队间通信、日志记录和调试实践。</p><p id="a1d4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们与客户一起解决这些问题的方法是在真正的DevOps商店中进行运营。这一点至关重要，因为微服务会在上面列出的许多领域中以重复的形式带来开销。构建优秀的工具是让微服务发挥作用的唯一途径。</p><p id="9526" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其次，像对待客户一样对待应用程序开发人员和工具的用户是很重要的。这样做的结果不仅会改进内部开发人员的工具，还会激励您的团队走向成功的度量标准。对于我们的一个客户，我们将工具/服务的采用作为衡量成功的一种方式。简单地问“他们在使用内部工具吗？”是驱动更好的内部工具的足够好的度量。</p><p id="1a84" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于需要访问数据源的代码已经变得非常少，审计数据源变得非常容易。</p><p id="7d9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对您的测试方式有何影响？</strong></p><p id="b8e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就工时而言，集成测试很容易出错，而且成本很高。投资回报根本不存在。每个单独的集成测试都带来了用例的小范围覆盖。如果您考虑到您的应用程序的所有代码路径组合都与另一个应用程序的代码路径相耦合，那么需要编写的测试数量很容易就会激增到一个无法实现的数字。</p><p id="91e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">相反，我们指导我们的客户关注单元测试覆盖范围、将证明应用关键领域完全失败的少数集成测试、SLA/SLO等额外指标、额外警报、金丝雀部署和一键式回滚。</p><p id="ada8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">服务间集成测试违背了微服务的目的。如果您正在测试系统作为一个整体是如何工作的，那么从概念上讲，您已经做错了一些事情，因为这些服务应该是松散耦合的。相反，当一个子服务失败时，在代码中构建一个“应急计划”是一个更好的途径。例如，网飞使用一种服务来预测你将在你的提要中看到什么，但是当这种服务失败时，它会退回到提要的缓存版本，因此不存在失败。</p><p id="e92e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">微服务对安全性和控制数据访问有何影响？</strong></p><p id="3064" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">数据的安全性显著提高，因为团队只需访问更多离散数据集中的数据。数据可以按服务进行隔离，这样密码就不会与PPI等其他敏感用户数据存储在一起。</p><p id="9945" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据组织的规模，这种差异会很大，因为请求访问您的服务数据的另一个服务可能在该国的另一个地方。我们发现有三种方法可以解决这个问题:</p><ul class=""><li id="5c90" class="jz ka hu it b iu iv iy iz jc kb jg kc jk kd jo ke kf kg kh dt translated">Mutual TLS:这非常安全，因为它依赖于授予访问数据的服务的证书。缺点是管理双方的证书。网飞创建了一个名为Lemur的服务来帮助管理证书。</li><li id="7aa1" class="jz ka hu it b iu ki iy kj jc kk jg kl jk km jo ke kf kg kh dt translated">基于令牌的认证:这具有易于实现的优点</li><li id="aab6" class="jz ka hu it b iu ki iy kj jc kk jg kl jk km jo ke kf kg kh dt translated">安全组:这些更难实现，因为在VPC范围内实现和在安全组中计算资源变得更加困难。</li></ul><p id="d9dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">您是否遇到过在微服务架构中管理数据一致性的问题？</strong></p><p id="2508" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重要的是，您没有管理一个数据模型的多个服务。我们遇到了这个问题，其中一个微服务控制模式版本并写入表，另一个微服务直接从数据库读取。这意味着每当我们部署一个服务时，它都要求我们部署另一个服务，因此将这两个“微服务”耦合在一起，这违背了架构的目的。</p><p id="9754" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">再次感谢Isaac的时间和投入！这次采访是为我们的</em> <a class="ae jq" href="https://buttercms.com/books/microservices-for-startups/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">创业微服务</em> </a> <em class="jp">电子书做的。一定要去看看关于微服务的实用建议。</em></p></div><div class="ab cl kn ko hc kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hn ho hp hq hr"><p id="469e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文原载于</em><a class="ae jq" href="https://buttercms.com/blog/microservices-for-startups-an-interview-with-isaac-mosquera-of-armory" rel="noopener ugc nofollow" target="_blank"><em class="jp">buttercms.com</em></a><em class="jp">。这是《创业公司的微服务</em> 》一书采访系列的一部分。新章节一发布，你就可以通过电子邮件收到。</p><p id="a6c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢这篇文章，请在下面鼓掌帮助它传播！更多类似内容，请关注我们的<a class="ae jq" href="https://twitter.com/ButterCMS" rel="noopener ugc nofollow" target="_blank"><em class="jp">Twitter</em></a><em class="jp">和</em> <a class="ae jq" href="https://buttercms.com/blog/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">订阅我们的博客</em> </a> <em class="jp">。</em></p><p id="2aa0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想在你的网站上添加一个博客或者内容管理系统，而不要在Wordpress、 <a class="ae jq" href="https://buttercms.com/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">上浪费时间，你应该试试黄油内容管理系统</em> </a> <em class="jp">。</em></p></div></div>    
</body>
</html>