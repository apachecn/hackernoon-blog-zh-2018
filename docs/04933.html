<html>
<head>
<title>Liberate your UI Development: Setup a Mock API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解放您的UI开发:设置一个模拟API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/liberate-your-ui-development-setup-a-mock-api-9b6167d06ffa?source=collection_archive---------16-----------------------#2018-06-11">https://medium.com/hackernoon/liberate-your-ui-development-setup-a-mock-api-9b6167d06ffa?source=collection_archive---------16-----------------------#2018-06-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/ba4546c88bbca1baddc9a9dcf92df875.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*vbHHO9b6m9xv8JJe426fsA.jpeg"/></div></figure><p id="760b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">你在工作场所听到过这些说法吗:</p><ul class=""><li id="12e0" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke dt translated">我不能。API又停机了。</li><li id="01af" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">我被封锁了。我需要更新API，然后才能继续。</li><li id="d99d" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">我没能完成多少工作。VPN坏了，我连不上API。</li><li id="dd33" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">我花了半天时间反复让应用程序进入一个特定的状态。开枪打我。</li></ul><p id="4162" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">对正常运行的API的依赖是一种拖累。它会减缓发展。它迫使你在有网络连接的地方工作。这会让你的应用程序很难进入特定的状态。如果API下降，你就完了。</p><p id="a7c6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">您可以通过使用模拟API来解决所有这些问题。模拟API是一个拦截<code class="eh kk kl km kn b">XHR</code>和/或<code class="eh kk kl km kn b">fetch</code>请求并返回模拟数据的实用程序。通过在应用程序中引入模拟API，您将:</p><ul class=""><li id="f812" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke dt translated">再也不会被损坏或不可用的API阻止。</li><li id="3ffc" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">在开始开发之前，永远不需要等待API的特性更新。一旦您与API团队就API合同达成一致，您就可以与他们并行工作。</li><li id="b217" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">让您可以轻松地在应用程序中模拟特定的状态。</li></ul><p id="8edc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">听起来很棒？确实是！</p><h2 id="2c04" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jj kz la lb jn lc ld le jr lf lg lh li dt translated">分为四个步骤的模拟API</h2><p id="5ff8" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">建立一个模拟API非常容易。你可以这样做:</p><ol class=""><li id="b998" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv lo kc kd ke dt translated">安装一个<code class="eh kk kl km kn b">fetch</code>和/或<code class="eh kk kl km kn b">XHR</code>模拟工具——安装什么将取决于你的应用程序的需求。</li><li id="8abc" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv lo kc kd ke dt translated">创建模拟数据。</li><li id="34ee" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv lo kc kd ke dt translated">配置API模拟。</li><li id="c534" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv lo kc kd ke dt translated">配置您的应用程序打开和关闭API模拟。</li></ol><p id="8a11" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">一点术语:<em class="lp">夹具</em>。夹具是一种允许您处理样本数据的工具。我们将使用术语<em class="lp"> fixtures </em>来指代模拟API和它返回的数据。</p><h2 id="7ac6" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jj kz la lb jn lc ld le jr lf lg lh li dt translated">示例应用程序</h2><p id="6c51" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">在本教程中，我们将采用一个现有的应用程序——Contact Manager——并添加装置来模拟它的API。联系人管理器仅使用<code class="eh kk kl km kn b">fetch.</code>。我们将使用<code class="eh kk kl km kn b">fetchMock</code>，这是一个模拟使用<code class="eh kk kl km kn b">fetch</code>发出的http请求的实用程序。</p><p id="4e7a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">联系人管理器使用公开可用的JSONPlaceholder API的<code class="eh kk kl km kn b">users</code>资源。更多细节你可以去见https://jsonplaceholder.typicode.com/。</p><p id="9ae7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">你可以从这里克隆这个应用:<a class="ae lq" href="https://github.com/joe-crick/contact-manager" rel="noopener ugc nofollow" target="_blank">https://github.com/joe-crick/contact-manager</a>。克隆完成后，通过运行以下命令下载依赖项:</p><p id="d3be" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><code class="eh kk kl km kn b">yarn</code>或<code class="eh kk kl km kn b">npm i</code></p><h2 id="1942" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jj kz la lb jn lc ld le jr lf lg lh li dt translated">装置</h2><p id="e1fd" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated"><code class="eh kk kl km kn b">fetchMock</code>的安装是标准的:<br/> <code class="eh kk kl km kn b">yarn add fetchMock -D</code>或<code class="eh kk kl km kn b">npm i fetchMock -D</code></p><p id="cd10" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><em class="lp">注意</em>:标志<code class="eh kk kl km kn b">-D</code>将模块保存为一个devDependency。</p><h2 id="2c77" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jj kz la lb jn lc ld le jr lf lg lh li dt translated">创建模拟数据</h2><p id="313b" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">您的模拟数据必须与从API返回的结果的数据定义相匹配。联系人管理器使用一种资源— <code class="eh kk kl km kn b">users</code>。<code class="eh kk kl km kn b">users</code>资源返回一组<code class="eh kk kl km kn b">user</code>对象。</p><p id="a40f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">首先，我们将创建一个名为<code class="eh kk kl km kn b">fixtures</code>的文件夹来保存夹具数据和API模拟。在这个文件夹中，我们将创建一个名为<code class="eh kk kl km kn b">users.js</code>的文件。<code class="eh kk kl km kn b">users.js</code>将包含一小组与<code class="eh kk kl km kn b">users</code>资源定义的数据形式相匹配的用户数据:</p><figure class="lr ls lt lu fq iv"><div class="bz el l di"><div class="lv lw l"/></div></figure><h2 id="2355" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jj kz la lb jn lc ld le jr lf lg lh li dt translated">配置API模拟</h2><p id="c2c1" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">接下来，我们将添加一个名为<code class="eh kk kl km kn b">fixtures.js</code>的文件。在这个文件中，我们将定义我们的设备将模拟哪些资源:</p><figure class="lr ls lt lu fq iv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="e12e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建一个简单的API模拟需要三样东西:</p><ol class=""><li id="5282" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv lo kc kd ke dt translated">HTTP方法</li><li id="3fd7" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv lo kc kd ke dt translated">URI匹配器</li><li id="a7d1" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv lo kc kd ke dt translated">响应数据</li></ol><p id="1997" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> HTTP方法<br/> </strong> <code class="eh kk kl km kn b">fetchMock</code>为所有HTTP方法(GET、POST、PUT、&amp; c .)提供嘲讽。要使用特定的方法，只需从<code class="eh kk kl km kn b">fetchMock</code>对象中调用它——例如<code class="eh kk kl km kn b">fetchMock.get</code>或<code class="eh kk kl km kn b">fetchMock.post</code>。</p><p id="1327" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> URI匹配器</strong> <br/> <code class="eh kk kl km kn b">fetchMock</code>也有几种不同的方式可以匹配一个资源URL，包括:</p><ul class=""><li id="743a" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke dt translated">字符串文字</li><li id="5b39" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">全球</li><li id="838d" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">正则表达式</li><li id="4f74" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">还有更多…</li></ul><p id="a917" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">上面，我使用了正则表达式。</p><p id="1ed4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">响应数据</strong> <br/>我们从<code class="eh kk kl km kn b">users.js</code>导入我们创建的响应数据。对于对<code class="eh kk kl km kn b">users</code>的<code class="eh kk kl km kn b">GET</code>调用，我们返回所有用户。对于来自<code class="eh kk kl km kn b">PUT</code>更新用户的响应，我们返回第一个用户。</p><p id="89c5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">特定应用状态</strong> <br/>实现一个模拟API可以让你完全控制模拟API返回的响应。这个很厉害。例如，它可以帮助您更轻松地针对特定情况(独特的应用程序状态和错误)开发应用程序。</p><p id="3968" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们通过一个例子来说明如何使用错误状态来实现这一点。在<code class="eh kk kl km kn b">fixtures</code>文件夹中，添加一个名为<code class="eh kk kl km kn b">error-fixtures.js</code>的文件。</p><figure class="lr ls lt lu fq iv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="78d6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><code class="eh kk kl km kn b">fetchMock</code>允许你传入一个<code class="eh kk kl km kn b"><a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/API/Response" rel="noopener ugc nofollow" target="_blank">Response</a></code>对象作为它的返回值。通过传入一个状态为500的<code class="eh kk kl km kn b">Response</code>对象，我们可以生成一个服务器错误。</p><p id="43d8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在，无论何时您想要测试您的应用程序将如何响应用户更新的API错误，您都可以很容易地做到。使用这种设置，每次尝试更新用户时都会产生一个错误。</p><p id="34b7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">关于如何使用<code class="eh kk kl km kn b">fetchMock</code>的完整细节，请参见其<a class="ae lq" href="http://www.wheresrhys.co.uk/fetch-mock/api" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h2 id="b53a" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jj kz la lb jn lc ld le jr lf lg lh li dt translated">配置您的应用程序来打开和关闭API模拟</h2><p id="384f" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">该过程的最后一步是配置您的应用程序，以便您可以轻松地打开和关闭设备。有很多方法可以做到这一点。我们将采取一种简化的方法。在<code class="eh kk kl km kn b">fixtures</code>文件夹下，创建一个名为<code class="eh kk kl km kn b">set-fixtures.js</code>的文件。</p><figure class="lr ls lt lu fq iv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="1127" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">上面的代码在window对象上设置了一个函数<code class="eh kk kl km kn b">toggleFixtures,</code>,允许您轻松地打开或关闭设备。<code class="eh kk kl km kn b">toggleFixtures</code>依赖于<code class="eh kk kl km kn b">localStorage</code>中设置的项目<code class="eh kk kl km kn b">fixtures</code>。如果<code class="eh kk kl km kn b">fixtures</code>项为真，我们打开设备，反之亦然。最后，所有这一切只有在环境不是生产的情况下才会发生。</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff lx"><img src="../Images/9790768f0c656ee298ddce30699669f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*XadGvEXnfttxA4bC18TrKw.gif"/></div></div></figure><h2 id="6069" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jj kz la lb jn lc ld le jr lf lg lh li dt translated">其他选项</h2><p id="aa5c" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">如果你的应用程序只使用<code class="eh kk kl km kn b">fetch</code>，那么<code class="eh kk kl km kn b">fetchMock</code>是很棒的。如果你需要其他东西，或者其他东西，还有其他选择。以下是一些例子:</p><ul class=""><li id="2ef3" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke dt translated"><code class="eh kk kl km kn b">can-fixture</code>是Bitovi的人们开发的实用程序。他们开发了CanJS和DoneJS框架。<code class="eh kk kl km kn b">can-fixture</code>专为与XHR合作而设计。你可以在这里找到更多信息:<a class="ae lq" href="https://canjs.com/doc/can-fixture.html" rel="noopener ugc nofollow" target="_blank">https://canjs.com/doc/can-fixture.html</a></li><li id="8bd2" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated"><code class="eh kk kl km kn b">xhr-mock</code>是另一个嘲笑XHR的工具。它是由詹姆斯·纽维尔开发的。你可以在这里找到更多关于<code class="eh kk kl km kn b">xhr-mock</code>的信息:【https://www.npmjs.com/package/xhr-mock】T21。</li></ul><p id="7ada" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">图表QL </strong></p><ul class=""><li id="ca4f" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke dt translated"><code class="eh kk kl km kn b">graphql-tools</code>。模仿GraphQL api是一个有点不同的过程。阅读这篇文章以获得更多关于创建GraphQL模拟的信息:<a class="ae lq" href="https://www.apollographql.com/docs/graphql-tools/mocking.html" rel="noopener ugc nofollow" target="_blank">https://www . apollographql . com/docs/graph QL-tools/mocking . html</a></li></ul><h2 id="1fad" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jj kz la lb jn lc ld le jr lf lg lh li dt translated">摘要</h2><p id="e0d9" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">为您的应用程序创建一个模拟API使您能够在没有后端实现的情况下构建UI组件和特性。这个:</p><ul class=""><li id="a072" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke dt translated">将您的UI开发从后端依赖和问题中解放出来。</li><li id="9b5a" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">使在应用程序中模拟特定的情况变得容易。</li><li id="cd00" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">允许您脱机工作和测试应用程序。</li></ul></div></div>    
</body>
</html>