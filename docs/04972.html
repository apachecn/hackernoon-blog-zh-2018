<html>
<head>
<title>Don’t Lose Your Head With iTerm2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要被iTerm2冲昏了头脑</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/dont-lose-your-head-with-iterm2-4a6fafbca6b?source=collection_archive---------10-----------------------#2018-06-12">https://medium.com/hackernoon/dont-lose-your-head-with-iterm2-4a6fafbca6b?source=collection_archive---------10-----------------------#2018-06-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="486c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://www.iterm2.com/" rel="noopener ugc nofollow" target="_blank"> iTerm2 </a>是一款终端应用，我用它来运行MacOS上的所有东西。iTerm2是Terminal的替代品，它提供了许多改变外观和感觉的主题特性。我在iTerm2中运行一切，从git命令到运行实时服务器，搜索文本和编辑文件。但是有一件事一直困扰着我——运行长流程。长进程总是隐藏当前提示和工作目录。我安装了<a class="ae jp" href="http://ohmyz.sh/" rel="noopener ugc nofollow" target="_blank"> Oh My Zsh </a>，它添加了这个漂亮的提示，显示当前的工作目录和我正在使用的git分支，但是当运行长进程时，提示超出了缓冲区，我对此一无所知。</p><p id="c985" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦您运行一个进程，终端中的所有内容都将失去上下文——状态栏显示正在运行的任务，如果任务足够冗长，提示符将脱离缓冲区，并且不可见。状态栏、标签名称和我能想到的一切都不会显示当前的工作目录或任何关于我在哪里的信息。我甚至不能运行<code class="eh jq jr js jt b">pwd</code>，因为一个进程正在运行。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="fe ff ju"><img src="../Images/479ec4fff52d23db529ad9083e5755c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LzTgfrPZnoWRWHoXuhdtg.png"/></div></div></figure><p id="068b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我经常做的一件事是在命令末尾用<code class="eh jq jr js jt b">&amp;</code>运行任务，例如<code class="eh jq jr js jt b">npm i &amp;</code>，它在后台运行进程，并留下交互可用的提示。您可以通过在它们之间添加<code class="eh jq jr js jt b">&amp;</code>来并行运行几个流程。当一个进程在后台运行时，你不能用<code class="eh jq jr js jt b">cmd+C</code>中断它，相反你需要用<code class="eh jq jr js jt b">kill [pid]</code>或<code class="eh jq jr js jt b">killall [name]</code>命令显式终止它。我有时会运行<code class="eh jq jr js jt b">killall node</code>,但这会杀死所有在任何地方运行的节点进程。</p><p id="44f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要终止一个特定的进程，你需要知道pid，要做到这一点，你需要记住你在运行什么。你可以运行<code class="eh jq jr js jt b">ps -ef | grep [what you are running]</code>来获得pid，例如<code class="eh jq jr js jt b">ps -ef | grep node</code>会给你所有的节点进程。iTerm2为每个面板提供了一个显示带有PID<strong class="it hv">的所有过程的面板。只需点击<code class="eh jq jr js jt b">cmd+shft+B</code>或<strong class="it hv">工具带→显示工具带</strong>，然后检查<strong class="it hv">工具带→作业</strong>以查看包含流程名称和每个流程的pid的作业面板。</strong></p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="fe ff kg"><img src="../Images/d3f7abd7aa43653b093ea0b0fb45b085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJ7nK8r9JSM2mjBz5GTNvg.png"/></div></div></figure><p id="472b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要终止一个进程，您可以选择它并按下<strong class="it hv">选择信号→终止</strong>，或者在控制台中执行<code class="eh jq jr js jt b">kill [pid]</code>从面板中知道确切的pid。</p><p id="0fb4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在并行运行多个进程时遇到的一个小问题是输出——因为输出流从不同的进程获得更新，所以它不整洁且难以理解。我更喜欢运行一个阻塞进程，这样我就可以随时知道我在哪里。使用iTerm2徽章可以解决这个问题。</p><p id="277a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">徽章是显示在终端会话右上角的大文本标签。您可以使用<strong class="it hv">项目2 →首选项→个人资料→常规→徽章</strong>更新该文本。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="fe ff kh"><img src="../Images/2012c9577f5b8b01aa3a9d68919c5687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vh8o7iALcDDAZFGSmYHKhw.png"/></div></div></figure><p id="a119" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">徽章可以有静态值，就像上面的例子一样，也可以通过脚本变量有动态值。让我们尝试实现我们首先想要的，我们将尝试设置徽章如下:<code class="eh jq jr js jt b">[git repo] git:([git branch])</code>就像我在我的提示。</p><p id="7774" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们希望创建某种包含文本的变量，并将其设置为badge字段。为了创建和更新变量，我们需要安装iTerm2 <a class="ae jp" href="https://www.iterm2.com/documentation-shell-integration.html" rel="noopener ugc nofollow" target="_blank"> shell integration </a>。这是一个常见的集成，可以与<strong class="it hv">项目2 - &gt;安装外壳集成</strong>一起安装。</p><p id="6486" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">外壳集成允许创建变量和使用它们，我们想创建一个变量，将持有徽章文本，正如我们所描述的。在配置启动脚本中，对我来说是<code class="eh jq jr js jt b">~/.zshrc,</code>添加以下内容:</p><pre class="jv jw jx jy fq ki jt kj kk aw kl dt"><span id="d90e" class="km kn hu jt b fv ko kp l kq kr"><strong class="jt hv">function </strong>iterm2_print_user_vars() {<br/>  iterm2_set_user_var gitStatus "$(gitStatus)"<br/>}<br/><br/><strong class="jt hv">function </strong>getGitStatus {<br/>  <strong class="jt hv">if </strong>[[ $(git status 2&gt; /dev/<strong class="jt hv">null</strong>) = "" ]] then<br/>    echo "$(topDir)"<br/>  <strong class="jt hv">else<br/>    </strong>echo "$(getGitProjectDir)$(topDir) git:($(getGitBranch))$(isGitBranchDirty)"<br/>  fi<br/>}<br/><br/><strong class="jt hv">function </strong>getGitProjectDir {<br/>  basename $(git rev-parse --show-toplevel 2&gt; /dev/<strong class="jt hv">null </strong>) 2&gt; /dev/<strong class="jt hv">null<br/></strong>}<br/><br/><strong class="jt hv">function </strong>topDir {<br/>  <strong class="jt hv">if </strong>[[ $(basename $(pwd)) = $(getGitProjectDir) ]] then<br/>   echo ""<br/>  <strong class="jt hv">else<br/>   </strong>echo "/$(basename $(pwd))"<br/>  fi<br/>}<br/><br/><strong class="jt hv">function </strong>getGitBranch {<br/>  basename $(git branch 2&gt; /dev/<strong class="jt hv">null </strong>| grep \* | cut -c3-) 2&gt; /dev/<strong class="jt hv">null<br/></strong>}<br/><br/><strong class="jt hv">function </strong>isGitBranchDirty {<br/>  [[ $(git diff --shortstat 2&gt; /dev/<strong class="jt hv">null </strong>| tail -n1) != "" ]] &amp;&amp; echo "⚡ "<br/>}</span></pre><p id="2a42" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一个函数— <code class="eh jq jr js jt b">item2_print_user_vars</code>是这里的主要函数，将在终端中运行任何命令后运行。它使用下面的函数用我们想要的更新<code class="eh jq jr js jt b">gitStatus</code>变量:</p><p id="9fa4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> getGitStatus </strong> —如果当前目录不是git存储库，则返回当前目录。</p><p id="e7e5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> getGitProjectDir </strong> —返回git repo名称。</p><p id="e8f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> topDir </strong> —如果当前目录不是主repo文件夹，则返回当前目录。当真实项目在主回购目录的子目录中时，这对于monorepos是有用的。</p><p id="8e60" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> getGitBranch </strong> —返回当前git分支。</p><p id="3a03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> isGitBranchDirty </strong> —如果我们有panding变更，返回“⚡”。</p><p id="51cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，要使用我们创建的变量，我们只需将它添加到徽章文本中，就像我们之前使用静态值一样。我们将在<strong class="it hv">ITER m2→首选项→个人资料→常规→徽章</strong>插入<code class="eh jq jr js jt b">\(user.gitProjectDir)</code>和walla中将其添加为徽章文本！下次有什么变化，你会在终端的徽章上看到，永远不会惊慌失措。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="fe ff kh"><img src="../Images/9bd92aa6edd1b55b42f0257ddc9ef9cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3qF8a6pBAPfcj_jZudcRLw.png"/></div></div></figure></div></div>    
</body>
</html>