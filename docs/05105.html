<html>
<head>
<title>Integrate CloudwaysCDN with Laravel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将CloudwaysCDN与Laravel集成</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/integrate-cloudwayscdn-with-laravel-b569c4cc1a03?source=collection_archive---------15-----------------------#2018-06-17">https://medium.com/hackernoon/integrate-cloudwayscdn-with-laravel-b569c4cc1a03?source=collection_archive---------15-----------------------#2018-06-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="eac6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">内容交付网络(CDN)是位于整个网络的服务器群中托管的中间服务器的排列。CDN的目标是尽可能快地传送内容，而不管托管网站的服务器在哪里。从技术角度来说，CDN提供web缓存、负载平衡和请求路由，以确保快速的页面加载速度。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/935515b77b708d83454fa6f072c65778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ar4Moa9inU77EJg8R-UQMA.jpeg"/></div></figure><h2 id="0eb3" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">CDN如何为您的业务增值</h2><p id="5be0" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">不管你的业务性质如何，CDN都会为你的网站增加价值。如果您对服务交付感兴趣，CDN可以确保更快地将您的服务交付给客户。同样，如果你是一个产品或者一个平台，一个CDN可以让所有的访问者和用户享受你的产品而不会有延迟。</p><p id="04b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在所有情况下，CDN都是网站和业务流程的重要补充。CDN提供的高页面加载速度确保访问者能够更快地访问您的服务和产品(通常会带来更多的转化)。</p><p id="0554" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">CDN的工作原理是存储网站静态内容的副本，并将其提供给客户端。这意味着来自客户端的请求不是由原始服务器完成，而是由最近的CDN服务器完成。这导致了快速的页面加载速度，因为数据是从最近的CDN服务器提供的。</p><p id="8147" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了方便用户，Cloudways推出了CloudwaysCDN，以确保所有Laravel应用程序都能为用户提供良好的UX。在本文中，我将向您展示将Cloudways CDN与您的Laravel应用程序集成是多么容易。</p><p id="128a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">出于本文的目的，我假设您有一个Laravel应用程序部署在Cloudways托管的Laravel web主机上。如果您不是这种情况，我强烈建议您尝试一下Cloudways。只需注册一个试用版，然后按照下面的GIF进行服务器和应用程序设置。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff ky"><img src="../Images/53a8bbe498e4b3c7ae5f22d1f1bef97b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cozG6FFvVUgnYtq-RdpL5Q.gif"/></div></div></figure><h2 id="e409" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">CDN请求流</h2><p id="766e" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">以下是CDN如何与您的网站一起工作。您网站上所有静态资产的URL都被替换为CDN URL。比如:<a class="ae kx" href="http://mywebsite.com/img/logo.png" rel="noopener ugc nofollow" target="_blank">T3、T5变成了</a><a class="ae kx" href="http://cdn.mycdnprovider.com/img/logo.png" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">、</strong> </a>。在这种情况下，文件logo.png将由CDN服务器提供，而不是托管文件的原始服务器。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff ld"><img src="../Images/9164a0f2d27464aa067e9c85525c5264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IkIsUC9QbveXfEbX"/></div></div></figure><p id="4414" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">CDN有两种方式将数据从您的网站带入其网络。第一种方式是手动方式，即手动转移记录。在第二种方法中，内容被自动引入。在这两种方法中，CDN继续指向网站资产，直到链接被改变。在这种情况下，CDN通常负责刷新链接。</p><p id="aa06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将从演示为您的Laravel应用程序启用CloudwaysCDN的简单过程开始。</p><h2 id="c368" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">为Laravel应用程序启用CloudwaysCDN</h2><p id="6abb" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">首先单击应用程序管理选项末尾的<strong class="it hv"> CloudwaysCDN </strong>选项。在打开的屏幕中，当您单击选项卡时，您将看到CDN配置屏幕。在这里，您将找到要插入网站URL字段的应用程序的URL，然后单击“创建”按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff le"><img src="../Images/144c762fe6cac7dfab5994776dfca471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E2_NSr2iMb-JC907"/></div></div></figure><p id="9b54" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，您将获得Laravel应用程序新生成的URL:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff le"><img src="../Images/921492b3904ec0d41cd411fd36e2cfe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7oZwD25amZ-0uTHH"/></div></div></figure><h2 id="4446" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">这里需要注意几件事:</h2><ul class=""><li id="0311" class="lf lg hu it b iu ks iy kt jc lh jg li jk lj jo lk ll lm ln dt translated">您可以在此屏幕上查看带宽使用情况。</li><li id="0485" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">您可以使用清除按钮清除CDN缓存中的旧内容。</li><li id="37de" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">您可以随时删除您的订阅</li></ul><h2 id="0b8f" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">将CloudwaysCDN与Laravel应用程序集成</h2><p id="7cf7" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">创造了<strong class="it hv">。/app/helpers.php </strong>文件并更新。/composer.json如下</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="384a" class="jx jy hu lu b fv ly lz l ma mb">“autoload”: {</span><span id="a569" class="jx jy hu lu b fv mc lz l ma mb">“classmap”: [</span><span id="76ec" class="jx jy hu lu b fv mc lz l ma mb">…</span><span id="f11c" class="jx jy hu lu b fv mc lz l ma mb">],</span><span id="0665" class="jx jy hu lu b fv mc lz l ma mb">…</span><span id="1c9f" class="jx jy hu lu b fv mc lz l ma mb">“files”: [</span><span id="be93" class="jx jy hu lu b fv mc lz l ma mb">“app/helpers.php”</span><span id="928f" class="jx jy hu lu b fv mc lz l ma mb">]</span><span id="16a3" class="jx jy hu lu b fv mc lz l ma mb">},</span></pre><p id="36ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要实现Laravel CDN，需要在整个应用程序中使用全球范围的容量。为此，请在申请信封中附上helpers.php的记录。将附带的代码放入记录中。执行命令<strong class="it hv"> composer dump-autoload </strong>来转储自动加载程序，然后将以下代码添加到您的<strong class="it hv">中。/app/helpers.php </strong>。</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="3a85" class="jx jy hu lu b fv ly lz l ma mb">&lt;?php</span><span id="e4e8" class="jx jy hu lu b fv mc lz l ma mb">// global CDN link helper function</span><span id="7b75" class="jx jy hu lu b fv mc lz l ma mb">function cdn( $asset ){</span><span id="b66f" class="jx jy hu lu b fv mc lz l ma mb">// Verify if KeyCDN URLs are present in the config file</span><span id="dcda" class="jx jy hu lu b fv mc lz l ma mb">if( !Config::get(‘app.cdn’) )</span><span id="1819" class="jx jy hu lu b fv mc lz l ma mb">return asset( $asset );</span><span id="0613" class="jx jy hu lu b fv mc lz l ma mb">// Get file name incl extension and CDN URLs</span><span id="3d8b" class="jx jy hu lu b fv mc lz l ma mb">$cdns = Config::get(‘app.cdn’);</span><span id="f150" class="jx jy hu lu b fv mc lz l ma mb">$assetName = basename( $asset );</span><span id="d3e1" class="jx jy hu lu b fv mc lz l ma mb">// Remove query string</span><span id="0a70" class="jx jy hu lu b fv mc lz l ma mb">$assetName = explode(“?”, $assetName);</span><span id="5c3a" class="jx jy hu lu b fv mc lz l ma mb">$assetName = $assetName[0];</span><span id="9412" class="jx jy hu lu b fv mc lz l ma mb">// Select the CDN URL based on the extension</span><span id="6019" class="jx jy hu lu b fv mc lz l ma mb">foreach( $cdns as $cdn =&gt; $types ) {</span><span id="affd" class="jx jy hu lu b fv mc lz l ma mb">if( preg_match(‘/^.*\.(‘ . $types . ‘)$/i’, $assetName) )</span><span id="3a92" class="jx jy hu lu b fv mc lz l ma mb">return cdnPath($cdn, $asset);</span><span id="cfd3" class="jx jy hu lu b fv mc lz l ma mb">}</span><span id="9fc5" class="jx jy hu lu b fv mc lz l ma mb">// In case of no match use the last in the array</span><span id="5396" class="jx jy hu lu b fv mc lz l ma mb">end($cdns);</span><span id="9fc2" class="jx jy hu lu b fv mc lz l ma mb">return cdnPath( key( $cdns ) , $asset);</span><span id="d242" class="jx jy hu lu b fv mc lz l ma mb">}</span><span id="6653" class="jx jy hu lu b fv mc lz l ma mb">function cdnPath($cdn, $asset) {</span><span id="5a2e" class="jx jy hu lu b fv mc lz l ma mb">return “//” . rtrim($cdn, “/”) . “/” . ltrim( $asset, “/”);</span><span id="c4e6" class="jx jy hu lu b fv mc lz l ma mb">}</span></pre><p id="ef74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果在<strong class="it hv">中没有定义CDN URLs，将调用标准asset()函数。/config/app.php </strong>配置文件。</p><h2 id="18a9" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">设置URL</h2><p id="9bd8" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">现在，打开<strong class="it hv"> app/config/app.php </strong>或者您的环境的配置文件。将您的CDN域添加到app.php中，如下例所示:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="1020" class="jx jy hu lu b fv ly lz l ma mb">‘cdn’ =&gt; [</span><span id="7331" class="jx jy hu lu b fv mc lz l ma mb">“77728–356013-raikfcquaxqncofqfm.stackpathdns.com” =&gt; “css|js|eot|woff|ttf,jpg|jpeg|png|gif|svg”</span><span id="d3f6" class="jx jy hu lu b fv mc lz l ma mb">],</span></pre><p id="4e0d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样。一切都准备好了。只需用新的cdn()函数替换视图中的asset()函数。例如，我使用了以下代码来链接bootstrap.css文件</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="de5c" class="jx jy hu lu b fv ly lz l ma mb">&lt;link rel=”stylesheet” href=”{{ cdn(‘css/bootstrap.css’) }}”&gt;</span></pre><h2 id="a1b6" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">全球助手</h2><p id="3183" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">在视图中使用全局助手功能:</p><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="b6a0" class="jx jy hu lu b fv ly lz l ma mb">&lt;img src=”{{ cdn( “/img/yourImg.png” ) }}” alt=”Your Image loaded from KeyCDN” /&gt;</span></pre><h2 id="1b88" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">将CDN用于图像的示例:</h2><pre class="jq jr js jt fq lt lu lv lw aw lx dt"><span id="16fc" class="jx jy hu lu b fv ly lz l ma mb">&lt;img class=”img-responsive” src=”{{cdn(‘images/iphone.png’)}}” alt=”iphone”&gt;</span></pre><p id="a718" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在文件中用cdn()替换所有asset()函数，显著提高应用程序的性能。</p><h2 id="8d2f" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">结论</h2><p id="cd75" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">设置可配置且可行的CDN的关键理念是:</p><ul class=""><li id="b4ee" class="lf lg hu it b iu iv iy iz jc md jg me jk mf jo lk ll lm ln dt translated">利用一个全球变量有效地获得你的CDN的网址</li><li id="fe1f" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">用CDN变量作为静态资产URL的前缀</li><li id="7a2b" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">利用设置记录来表征CDN变量</li><li id="2ee0" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">将您的CDN设置为从inception服务器获取资产</li><li id="d359" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">通过将您的资产放入一个正式的注册表来否定它们</li><li id="1e53" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">利用URL重写讽刺已形成的注册表</li><li id="a618" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">在配置记录中保留一个重现号</li></ul><p id="3485" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">拥有CDN可以让您的应用堆栈在执行和服务器负载方面获得各种优势。CDN使您能够存储不经常更改的特定记录/档案，甚至是偶尔更改的文档。这将减少您的应用程序服务器需要处理的IO活动，另外还会降低传输速度。对客户来说，这意味着更好的执行。</p><p id="cf8f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Cloudways与StackPath(以前称为MaxCDN)合作，为CloudwaysCDN提供一键激活。请注意，对于单个网站，每25GB带宽的月订阅费用为1美元。</p></div></div>    
</body>
</html>