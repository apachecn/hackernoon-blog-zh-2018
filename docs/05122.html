<html>
<head>
<title>React — redux for lazy developers. Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React —为懒惰的开发人员提供redux。第三部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/react-redux-for-lazy-developers-part-3-319b639a22c3?source=collection_archive---------9-----------------------#2018-06-18">https://medium.com/hackernoon/react-redux-for-lazy-developers-part-3-319b639a22c3?source=collection_archive---------9-----------------------#2018-06-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="05b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是关于创建react redux应用程序系列的最后一部分。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/8d526dbf1cfaf6dcf7b026bc0f5d3834.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*Vg5b1em7KX2XLQpp1hJmmw.png"/></div></figure><p id="3094" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在前两部分中，我描述了如何创建经典的react redux应用程序，然后我对应用程序post模块进行了全面的测试，并用7行代码<a class="ae jx" href="https://github.com/evheniy/redux-lazy" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> redux Lazy </strong> </a>替换了所有的redux内容(动作类型、动作创建者、缩减者和容器)，这是一个为使Redux开发更具声明性而创建的库。</p><p id="96bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，我将展示如何使用<a class="ae jx" href="https://redux-observable.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> redux-observable </strong> </a>、<a class="ae jx" href="https://github.com/acdlite/recompose" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> recompose </strong> </a>和<a class="ae jx" href="https://github.com/reduxjs/reselect" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> reselect </strong> </a>在react redux应用程序中添加逻辑。</p></div><div class="ab cl jy jz hc ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hn ho hp hq hr"><p id="0471" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">链接到以前的部分:</p><div class="kf kg fm fo kh ki"><a href="https://hackernoon.com/react-redux-for-lazy-developers-b551f16a456f" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">React —为懒惰的开发人员提供redux</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">每次在react应用程序中使用redux时，我们都要花费大量时间来创建动作类型、动作创建者、减少者…大多数…</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">hackernoon.com</p></div></div><div class="kr l"><div class="ks l kt ku kv kr kw jv ki"/></div></div></a></div><p id="a3f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和</p><div class="kf kg fm fo kh ki"><a rel="noopener follow" target="_blank" href="/@evheniybystrov/react-redux-for-lazy-developers-part-2-d0c60123592f"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">React —为懒惰的开发人员提供redux。第二部分</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">在本文中，我将继续讨论使用redux-lazy创建react redux应用程序。</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">medium.com</p></div></div><div class="kr l"><div class="kx l kt ku kv kr kw jv ki"/></div></div></a></div><p id="25ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将使用第二部分的代码。可以在<a class="ae jx" href="https://github.com/evheniy/redux-app" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> github </strong> </a>上找到。</p></div><div class="ab cl jy jz hc ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hn ho hp hq hr"><p id="2234" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我更新了<a class="ae jx" href="https://github.com/evheniy/redux-lazy" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">redux-lazy</strong></a><strong class="it hv">:</strong><a class="ae jx" href="https://github.com/evheniy/redux-lazy/blob/master/docs/options.md" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">options docs</strong></a>，new <a class="ae jx" href="https://github.com/evheniy/redux-lazy/tree/master/tests" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> tests </strong> </a> …</p><p id="26ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在小的重构之后，你可以得到和使用redux一样的结果(甚至更好——见表单<strong class="it hv"> onSubmit </strong>):</p><h2 id="ed8e" class="ky kz hu bd la lb lc ld le lf lg lh li jc lj lk ll jg lm ln lo jk lp lq lr ls dt translated">rl . js(src/模块/post/rl/index.js)</h2><p id="d96b" class="pw-post-body-paragraph ir is hu it b iu lt iw ix iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo hn dt translated">之前:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="00a7" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>RL <strong class="lz hv">from </strong>'redux-lazy';<br/><br/><strong class="lz hv">const </strong>rl = <strong class="lz hv">new </strong>RL('post');<br/>rl.addAction('title', { title: '' });<br/>rl.addAction('body', { body: '' });<br/>rl.addAction('submit');<br/><br/><strong class="lz hv">const </strong>result = rl.flush();<br/><br/><strong class="lz hv">export default </strong>result;</span></pre><p id="5821" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="f70d" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>RL <strong class="lz hv">from </strong>'redux-lazy';<br/><br/><strong class="lz hv">const </strong>rl = <strong class="lz hv">new </strong>RL('post');<br/>rl.addAction(<br/>  'title',<br/>  { title: '' },<br/>  <strong class="lz hv">{ isFormElement: true, asParams: 'title' },</strong><br/>);<br/>rl.addAction(<br/>  'body',<br/>  { body: '' },<br/>  <strong class="lz hv">{ isFormElement: true, asParams: 'body' },</strong><br/>);<br/>rl.addAction(<br/>  'submit',<br/>  {},<br/>  <strong class="lz hv">{ isForm: true },</strong><br/>);<br/><br/><strong class="lz hv">const </strong>result = rl.flush();<br/><br/><strong class="lz hv">export default </strong>result;</span></pre><h2 id="374d" class="ky kz hu bd la lb lc ld le lf lg lh li jc lj lk ll jg lm ln lo jk lp lq lr ls dt translated">组件(src/modules/post/components/index . jsx)</h2><p id="d89f" class="pw-post-body-paragraph ir is hu it b iu lt iw ix iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo hn dt translated">之前:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="dd2c" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>React <strong class="lz hv">from </strong>'react';<br/><strong class="lz hv">import </strong>PropTypes <strong class="lz hv">from </strong>'prop-types';<br/><br/><strong class="lz hv">const </strong>PostComponent = props =&gt; (<br/>  &lt;form<br/>    <strong class="lz hv">onSubmit={(event) =&gt; {<br/>      event.preventDefault();<br/>      props.submitAction();<br/>    }}</strong><br/>  &gt;<br/>    &lt;h1&gt;Our form example&lt;/h1&gt;<br/>    &lt;div&gt;<br/>      &lt;input<br/>        type="text"<br/>        <strong class="lz hv">onChange={event =&gt; props.titleAction({ title: event.target.value })}</strong><br/>        value={props.title}<br/>      /&gt;<br/>    &lt;/div&gt;<br/>    &lt;div&gt;<br/>      &lt;textarea<br/>        <strong class="lz hv">onChange={event =&gt; props.bodyAction({ body: event.target.value })}</strong><br/>        value={props.body}<br/>      /&gt;<br/>    &lt;/div&gt;<br/>    &lt;div&gt;<br/>      &lt;input type="submit" value="Submit" /&gt;<br/>    &lt;/div&gt;<br/>  &lt;/form&gt;<br/>);<br/><br/>PostComponent.propTypes = {<br/>  title: PropTypes.string.isRequired,<br/>  body: PropTypes.string.isRequired,<br/>  titleAction: PropTypes.func.isRequired,<br/>  bodyAction: PropTypes.func.isRequired,<br/>  submitAction: PropTypes.func.isRequired,<br/>};<br/><br/><strong class="lz hv">export default </strong>PostComponent;</span></pre><p id="89d5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="4832" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>React <strong class="lz hv">from </strong>'react';<br/><strong class="lz hv">import </strong>PropTypes <strong class="lz hv">from </strong>'prop-types';<br/><br/><strong class="lz hv">const </strong>PostComponent = props =&gt; (<br/>  <strong class="lz hv">&lt;form onSubmit={props.submitAction}&gt;</strong><br/>    &lt;h1&gt;Our form example&lt;/h1&gt;<br/>    &lt;div&gt;<br/>      &lt;input<br/>        type="text"<br/>        <strong class="lz hv">onChange={props.titleAction}</strong><br/>        value={props.title}<br/>      /&gt;<br/>    &lt;/div&gt;<br/>    &lt;div&gt;<br/>      &lt;textarea<br/>        <strong class="lz hv">onChange={props.bodyAction}</strong><br/>        value={props.body}<br/>      /&gt;<br/>    &lt;/div&gt;<br/>    &lt;div&gt;<br/>      &lt;input type="submit" value="Submit" /&gt;<br/>    &lt;/div&gt;<br/>  &lt;/form&gt;<br/>);<br/><br/>PostComponent.propTypes = {<br/>  title: PropTypes.string.isRequired,<br/>  body: PropTypes.string.isRequired,<br/>  titleAction: PropTypes.func.isRequired,<br/>  bodyAction: PropTypes.func.isRequired,<br/>  submitAction: PropTypes.func.isRequired,<br/>};<br/><br/><strong class="lz hv">export default </strong>PostComponent;</span></pre><p id="e762" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">无<strong class="it hv">有效载荷</strong>动作:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mh"><img src="../Images/d410d0a8e2d43a0535b461cdce65438e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lOB3ivEUWN_amBK4re5d1g.png"/></div></div></figure><p id="68c8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">再一次...</p><p id="b145" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Store是一个<em class="mm">数据库</em>。设置器是<em class="mm">动作</em> <em class="mm">创建器</em>和<em class="mm">减速器</em>，获取器是<em class="mm">选择器</em>用于<a class="ae jx" href="https://github.com/reduxjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options" rel="noopener ugc nofollow" target="_blank">连接<strong class="it hv">mapStateToProps</strong>和</a>。所有逻辑应该在其他地方。<strong class="it hv">归约器或动作内部没有逻辑。</strong>这可能就像存储过程一样——有很多逻辑，却没有好的测试方法。</p></div><div class="ab cl jy jz hc ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hn ho hp hq hr"><p id="f5d5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如我之前说过的，我喜欢以函数的方式使用React。我使用像纯函数一样的组件。</p><p id="55ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很容易描述为一个JS箭头函数:<strong class="it hv">道具= &gt; JSX </strong>。</p><p id="b649" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您需要添加本地状态或react组件生命周期时，您可以使用<a class="ae jx" href="https://github.com/acdlite/recompose" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">重组</strong></a>——一个用于功能组件和高阶组件的react实用程序带。</p><p id="c40f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我用一些例子写了另一篇文章:</p><div class="kf kg fm fo kh ki"><a href="https://blog.cloudboost.io/react-functional-way-c533fceda2ce" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">反应:功能方式</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">正如您可能知道的，使用react可以使用函数或类——使用无状态和有状态组件。在…</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">blog.cloudboost.io</p></div></div><div class="kr l"><div class="mn l kt ku kv kr kw jv ki"/></div></div></a></div><p id="7180" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用recompose<a class="ae jx" href="https://github.com/acdlite/recompose/blob/master/docs/API.md#lifecycle" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">life cycle</strong></a>来获取组件渲染时的post数据。</p><p id="9afa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们需要安装它:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="e071" class="ky kz hu lz b fv md me l mf mg">yarn add recompose</span></pre><p id="cdf4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我们应该为我们的组件——高阶组件(HOC)创建包装器。让我们创建<strong class="it hv">src/modules/post/containers/life cycle . js</strong>:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="d27e" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>{ lifecycle } <strong class="lz hv">from </strong>'recompose';<br/><br/><strong class="lz hv">export default </strong>lifecycle({<br/>  componentDidMount() {<br/>    <strong class="lz hv">this</strong>.props.loadAction();<br/>  },<br/>});</span></pre><p id="2c07" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并更新我们的Redux Lazy模型(<strong class="it hv">src/modules/post/rl/index . js</strong>):</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="fe22" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>RL <strong class="lz hv">from </strong>'redux-lazy';<br/><br/><strong class="lz hv">const </strong>rl = <strong class="lz hv">new </strong>RL('post');<br/><br/>rl.addAction('title', { title: '' }, { isFormElement: <strong class="lz hv">true</strong>, asParams: 'title' });<br/>rl.addAction('body', { body: '' }, { isFormElement: <strong class="lz hv">true</strong>, asParams: 'body' });<br/>rl.addAction('submit', {}, { isForm: <strong class="lz hv">true </strong>});<br/>rl.addAction('load');<br/>rl.addAction('loaded', { title: '', body: '' }, { asParams: ['title', 'body'] });<br/>rl.addAction('error', { error: <strong class="lz hv">null </strong>}, { asParams: 'error' });<br/><br/><strong class="lz hv">const </strong>result = rl.flush();<br/><br/><strong class="lz hv">const </strong>{<br/>  nameSpace,<br/>  actions: {<br/>    bodyAction,<br/>    errorAction,<br/>    loadAction,<br/>    loadedAction,<br/>    submitAction,<br/>    titleAction,<br/>  },<br/>  types: {<br/>    POST_BODY,<br/>    POST_ERROR,<br/>    POST_LOAD,<br/>    POST_LOADED,<br/>    POST_SUBMIT,<br/>    POST_TITLE,<br/>  },<br/>} = result;<br/><br/><strong class="lz hv">export default </strong>result;<br/><br/><strong class="lz hv">export </strong>{<br/>  nameSpace,<br/>  bodyAction,<br/>  errorAction,<br/>  loadAction,<br/>  loadedAction,<br/>  submitAction,<br/>  titleAction,<br/>  POST_BODY,<br/>  POST_ERROR,<br/>  POST_LOAD,<br/>  POST_LOADED,<br/>  POST_SUBMIT,<br/>  POST_TITLE,<br/>};</span></pre><p id="1e13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我添加了<strong class="it hv">加载动作</strong>来开始加载post数据，<strong class="it hv">加载动作</strong> —显示我们没有错误，<strong class="it hv">错误动作</strong> —如果我们有问题，将错误保存在存储中，然后我们可以在页面上显示它。</p><p id="090f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我导出<strong class="it hv">名称空间</strong>、<strong class="it hv">类型</strong>和<strong class="it hv">动作</strong>以避免每次当我需要在其他地方(如epics或tests)导入时变得不可思议。</p><p id="96bc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要在模块入口点(<strong class="it hv">src/modules/Post/index . js</strong>)包装我们的Post组件:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="39c5" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>PostComponent <strong class="lz hv">from </strong>'./components';<br/><strong class="lz hv">import </strong>rl <strong class="lz hv">from </strong>'./rl';<br/><strong class="lz hv">import </strong>lifecycleContainer <strong class="lz hv">from </strong>'./containers/lifecycle';<br/><br/><strong class="lz hv">const </strong>{ Container: PostContainer } = rl;<br/><br/><strong class="lz hv">export default </strong>PostContainer(<strong class="lz hv">lifecycleContainer</strong>(PostComponent));</span></pre><p id="bf5d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">检查一下:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mo"><img src="../Images/b721fbabc43ecffef3840f90f5ca8acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iec5Nywsdr0gNCf3FRyvXA.png"/></div></div></figure><p id="2dfa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以在开始时看到我们的负载动作。</p><p id="1cae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的下一步是制作ajax请求并管理副作用。</p></div><div class="ab cl jy jz hc ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hn ho hp hq hr"><p id="f9aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有很多工具可以使用redux来处理异步操作。由于redux是完全功能，它没有副作用。你应该使用其他工具来管理它，如<a class="ae jx" href="https://github.com/reduxjs/redux-thunk" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> redux-thunk </strong> </a>、<a class="ae jx" href="https://www.npmjs.com/package/redux-promise" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> redux-promise </strong> </a>、<a class="ae jx" href="https://github.com/redux-saga/redux-saga" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> redux-saga </strong> </a>或<a class="ae jx" href="https://redux-observable.js.org/" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">redux-observable</strong></a>。</p><p id="cee8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关于redux-thunk和redux-promise你可以在文章中读到:</p><div class="kf kg fm fo kh ki"><a rel="noopener follow" target="_blank" href="/magnetis-backstage/redux-side-effects-and-me-89c104a4b149"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">减少副作用和我</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">思维，传奇，效果和循环。一些冗余副作用中间件之我见。</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">medium.com</p></div></div><div class="kr l"><div class="mp l kt ku kv kr kw jv ki"/></div></div></a></div><p id="4dcf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我不用这些工具，因为它是为做一些小动作而设计的。例如，为app发出一个ajax请求...但是如果你正在开发一个很棒的应用，你需要管理很多东西，比如ajax请求，同时做很多动作…</p><p id="0116" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以我看只有两种方式:还原-传奇和还原-可观察。</p><p id="b63f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我选择redux observable是因为它是FRP的实现——使用<a class="ae jx" href="https://rxjs-dev.firebaseapp.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> Rx.js </strong> </a>的函数式反应式编程。它更具声明性——代码更少，意义更大。</p><p id="3553" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以阅读更多关于redux-observable的内容:</p><div class="kf kg fm fo kh ki"><a href="https://redux-observable.js.org/" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">介绍冗余-可观察</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">编辑描述</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">redux-observable.js.org</p></div></div><div class="kr l"><div class="mq l kt ku kv kr kw jv ki"/></div></div></a></div><p id="382a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">观看精彩的视频演示:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mr ms l"/></div></figure><p id="0cef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您想阅读一些文章来比较这两种工具:</p><div class="kf kg fm fo kh ki"><a href="https://hackmd.io/s/H1xLHUQ8e" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">Redux-Saga v . s . Redux-Observable-HackMD</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">Redux-Saga v . s . Redux-Observable = = = # # # Redux-Saga v . s . Redux-Observable 1。金属模型2。侧面</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">hackmd.io</p></div></div><div class="kr l"><div class="mt l kt ku kv kr kw jv ki"/></div></div></a></div><p id="0f42" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和</p><div class="kf kg fm fo kh ki"><a href="https://shift.infinite.red/redux-observable-epics-vs-redux-sagas-8e53610c0eda" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">冗余可观察史诗vs冗余传奇</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">我为什么要在乎？</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">红色</p></div></div><div class="kr l"><div class="mu l kt ku kv kr kw jv ki"/></div></div></a></div><p id="3405" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我完全推荐阅读第一个链接。</p></div><div class="ab cl jy jz hc ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hn ho hp hq hr"><p id="82fe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">可重复观察的主要模式是史诗。每次当你分派动作时，redux使用reducers、中间件和订阅的工具。</p><p id="3869" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每次调度动作时，redux-observable都会运行作为动作类型的处理程序创建的epics。</p><p id="d102" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们开始创建第一部epic之前，我们需要安装它:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="f583" class="ky kz hu lz b fv md me l mf mg">yarn add redux-observable@0.19.0 <!-- -->rxjs@5</span></pre><p id="ab06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们很少等待redux-observable发布时，我们应该使用Rx.js版本5。</p><p id="0bdb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要使用redux-observable ( <a class="ae jx" href="https://redux-observable.js.org/docs/basics/SettingUpTheMiddleware.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">见文档</strong> </a>)我们需要创建根epic，我们可以从我们的模块导入epic，并将其作为中间件添加到我们的商店。</p><h2 id="54e1" class="ky kz hu bd la lb lc ld le lf lg lh li jc lj lk ll jg lm ln lo jk lp lq lr ls dt translated">src/epics.js</h2><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="7717" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>{ combineEpics } <strong class="lz hv">from </strong>'redux-observable';<br/><br/><strong class="lz hv">import </strong>postEpics <strong class="lz hv">from </strong>'./modules/post/epics';<br/><br/><strong class="lz hv">const </strong>rootEpic = combineEpics(postEpics);<br/><br/><strong class="lz hv">export default </strong>rootEpic;</span></pre><h2 id="c3e2" class="ky kz hu bd la lb lc ld le lf lg lh li jc lj lk ll jg lm ln lo jk lp lq lr ls dt translated">src/store.js</h2><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="e258" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>{ createStore, applyMiddleware } <strong class="lz hv">from </strong>'redux';<br/><strong class="lz hv">import { createEpicMiddleware } from 'redux-observable';</strong><br/><strong class="lz hv">import </strong>logger <strong class="lz hv">from </strong>'redux-logger';<br/><br/><strong class="lz hv">import </strong>reducers <strong class="lz hv">from </strong>'./reducers';<br/><strong class="lz hv">import rootEpic from './epics';<br/></strong><br/><strong class="lz hv">const epicMiddleware = createEpicMiddleware(rootEpic);</strong><br/><br/><strong class="lz hv">const </strong>store = createStore(<br/>  reducers,<br/>  applyMiddleware(logger, <strong class="lz hv">epicMiddleware</strong>),<br/>);<br/><br/><strong class="lz hv">export default </strong>store;</span></pre><p id="ebe4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将在下一篇文章中展示如何使用代码分割和动态导入缩减器和史诗，这要感谢我的新库— <a class="ae jx" href="https://github.com/evheniy/wpb" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> wpb </strong> </a>。</p><p id="b270" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">记住，我们使用https://jsonplaceholder.typicode.com/的<a class="ae jx" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank">服务来获取帖子数据。这只是一个例子。</a></p><p id="4574" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的后期模块epic:</p><h2 id="be1e" class="ky kz hu bd la lb lc ld le lf lg lh li jc lj lk ll jg lm ln lo jk lp lq lr ls dt translated">src/modules/post/epics/index . js</h2><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="841a" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>{ combineEpics } <strong class="lz hv">from </strong>'redux-observable';<br/><br/><strong class="lz hv">import </strong>loadEpic <strong class="lz hv">from </strong>'./load';<br/><br/><strong class="lz hv">export default </strong>combineEpics(loadEpic);</span></pre><p id="409f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们有不止一部史诗，我们需要把它结合起来。</p><p id="95d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于这个例子，我将只显示load epic，但是您可以添加submit epic来更新服务器上的故事。</p><h2 id="7aad" class="ky kz hu bd la lb lc ld le lf lg lh li jc lj lk ll jg lm ln lo jk lp lq lr ls dt translated">src/modules/post/epics/load.js</h2><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="522a" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>'rxjs';<br/><strong class="lz hv">import </strong>{ Observable } <strong class="lz hv">from </strong>'rxjs/Observable';<br/><br/><strong class="lz hv">import </strong>axios <strong class="lz hv">from </strong>'axios';<br/><br/><strong class="lz hv">import </strong>{<br/>  POST_LOAD,<br/>  loadedAction,<br/>  titleAction,<br/>  bodyAction,<br/>  errorAction,<br/>} <strong class="lz hv">from </strong>'../rl';<br/><br/><strong class="lz hv">const </strong>loadEpic = action$ =&gt; action$<br/>  .ofType(POST_LOAD)<br/>  .switchMap(() =&gt; {<br/>    <strong class="lz hv">const </strong>request = axios<br/>      .get('https://jsonplaceholder.typicode.com/posts/1')<br/>      .then(({ data }) =&gt; data);<br/><br/>    <strong class="lz hv">return </strong>Observable<br/>      .fromPromise(request)<br/>      .switchMap(({ title, body }) =&gt; Observable<br/>        .of(loadedAction())<br/>        .concat(Observable.of(titleAction(title)))<br/>        .concat(Observable.of(bodyAction(body))));<br/>  })<br/>  .catch(error =&gt; Observable.of(errorAction(error)));<br/><br/><strong class="lz hv">export default </strong>loadEpic;</span></pre><p id="c249" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一次可能会比较复杂。</p><p id="3b04" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，我导入了<strong class="it hv"> POST_LOAD </strong>动作类型来运行epic(我们有来自recompose<strong class="it hv">life cycle container</strong>的带有此动作的事件)和动作:<strong class="it hv">loaded</strong>——以显示我们有一个良好的响应或<strong class="it hv">error</strong>——如果我们有问题。<strong class="it hv"> Title </strong>和<strong class="it hv"> body </strong>我们用来设置数据到我们商店的动作。</p><p id="6a1c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<strong class="it hv">observable . from Promise()</strong>我们可以从axios创建的promise创建流。</p><p id="13f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我们可以创建一个新的流—<strong class="it hv">(loaded action())</strong>。</p><p id="455e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和从响应中设置标题和正文的concat流。</p><p id="dc17" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们有一个错误，我们需要捕捉它，并返回一个新的错误数据流(每次我们需要返回流)。</p><p id="f99d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以检查结果:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mv"><img src="../Images/d15ce0a50d8420615a793a6dac36221e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v6Zp6nEOPNri0Qe-kFeTIg.png"/></div></div></figure><p id="6e2a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们组件的小更新:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="6df8" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>React <strong class="lz hv">from </strong>'react';<br/><strong class="lz hv">import </strong>PropTypes <strong class="lz hv">from </strong>'prop-types';<br/><br/><strong class="lz hv">const </strong>PostComponent = props =&gt; (<br/>  &lt;form onSubmit={props.submitAction}&gt;<br/>    &lt;h1&gt;Our form example&lt;/h1&gt;<br/>    &lt;div&gt;<br/>      &lt;input<br/>        type="text"<br/>        onChange={props.titleAction}<br/>        value={props.title}<br/>      /&gt;<br/>    &lt;/div&gt;<br/>    &lt;div&gt;<br/>      &lt;textarea<br/>        onChange={props.bodyAction}<br/>        value={props.body}<br/>      /&gt;<br/>    &lt;/div&gt;<br/>    &lt;div&gt;<br/>      &lt;input type="submit" value="Submit" /&gt;<br/>    &lt;/div&gt;<br/>    <strong class="lz hv">{props.error &amp;&amp; (<br/>      &lt;div&gt;<br/>        {props.error.message}<br/>      &lt;/div&gt;<br/>    )}</strong><br/>  &lt;/form&gt;<br/>);<br/><br/>PostComponent.propTypes = {<br/>  title: PropTypes.string.isRequired,<br/>  body: PropTypes.string.isRequired,<br/>  <strong class="lz hv">error: PropTypes.objectOf(PropTypes.any),</strong><br/>  titleAction: PropTypes.func.isRequired,<br/>  bodyAction: PropTypes.func.isRequired,<br/>  submitAction: PropTypes.func.isRequired,<br/>};<br/><br/><strong class="lz hv">PostComponent.defaultProps = {<br/>  error: null,<br/>};</strong><br/><br/><strong class="lz hv">export default </strong>PostComponent;</span></pre><p id="c635" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在表单中添加了错误消息。</p><p id="1578" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了模拟错误，我将把url改为<a class="ae jx" href="https://jsonplaceholder.typicode.com/posts/test" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/posts/test</a>并检查结果:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mv"><img src="../Images/42a06e750968d69295917e1ddd68ed01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WzRm1EFj8qfScejvisgV6w.png"/></div></div></figure><p id="941c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们可以在页面上显示错误，以查看错误url的404页面未找到错误。</p><p id="dcea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和测试:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="6007" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>nock <strong class="lz hv">from </strong>'nock';<br/><strong class="lz hv">import </strong>{ expect } <strong class="lz hv">from </strong>'chai';<br/><strong class="lz hv">import </strong>{ ActionsObservable } <strong class="lz hv">from </strong>'redux-observable';<br/><br/><strong class="lz hv">import </strong>{<br/>  loadAction,<br/>  loadedAction,<br/>  titleAction,<br/>  bodyAction,<br/>  POST_ERROR,<br/>} <strong class="lz hv">from </strong>'../../../../src/modules/post/rl';<br/><br/><strong class="lz hv">import </strong>epics <strong class="lz hv">from </strong>'../../../../src/modules/post/epics';<br/><br/>describe('Testing post module loadEpic', () =&gt; {<br/>  it('should test loadEpic without error', (done) =&gt; {<br/>    <strong class="lz hv">const </strong>title = 'title';<br/>    <strong class="lz hv">const </strong>body = 'body';<br/><br/>    nock('https://jsonplaceholder.typicode.com')<br/>      .get('/posts/1')<br/>      .reply(200, { title, body });<br/><br/>    <strong class="lz hv">const </strong>action$ = ActionsObservable.<em class="mm">of</em>(loadAction());<br/><br/>    <strong class="lz hv">const </strong>expectedOutputActions = [<br/>      loadedAction(),<br/>      titleAction(title),<br/>      bodyAction(body),<br/>    ];<br/><br/>    epics(action$)<br/>      .toArray()<br/>      .subscribe((actualOutputActions) =&gt; {<br/>        expect(actualOutputActions).to.be.eql(expectedOutputActions);<br/>        done();<br/>      });<br/>  });<br/><br/>  it('should test loadEpic with error', (done) =&gt; {<br/>    <strong class="lz hv">const </strong>message = 'Request failed with status code 404';<br/><br/>    nock('https://jsonplaceholder.typicode.com')<br/>      .get('/posts/1')<br/>      .reply(404);<br/><br/>    <strong class="lz hv">const </strong>action$ = ActionsObservable.<em class="mm">of</em>(loadAction());<br/><br/>    epics(action$)<br/>      .toArray()<br/>      .subscribe((actualOutputActions) =&gt; {<br/>        expect(actualOutputActions).to.have.length(1);<br/><br/>        expect(actualOutputActions[0].type).to.be.equal(POST_ERROR);<br/>        expect(actualOutputActions[0].error.message).to.be.equal(message);<br/>        done();<br/>      });<br/>  });<br/>});</span></pre><p id="a1bf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我使用<a class="ae jx" href="https://www.npmjs.com/package/nock" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> nock </strong> </a>来模拟HTTP请求。</p><p id="a2f2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要测试epic，您只需要使用ActionsObservable创建一个流。然后把它作为第一个参数放入epic(第二个是store)并订阅输出。</p><p id="96f7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您不仅可以将epics用于ajax请求。您可以切换新动作:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="d784" class="ky kz hu lz b fv md me l mf mg">action$ =&gt; actions$.ofType(REQUEST1).mapTo(request2Action)</span></pre><p id="ce1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">带商店:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="4d44" class="ky kz hu lz b fv md me l mf mg">(action$, store) =&gt; actions$<br/>  .ofType(REQUEST1)<br/>  .switchMap((action) =&gt; {<br/>    const state = store.getState();</span><span id="6f19" class="ky kz hu lz b fv mw me l mf mg">    console.log(action, state);</span><span id="ffa3" class="ky kz hu lz b fv mw me l mf mg">    return Observable.of(newAction());<br/>  });</span></pre></div><div class="ab cl jy jz hc ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hn ho hp hq hr"><p id="81c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我可以就此打住。但是我想说几句关于性能的话。</p><p id="2fb0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最近的更新(<strong class="it hv"> isForm </strong>和<strong class="it hv"> isFormElement </strong> options)帮助我使用Redux Lazy actions作为react组件中的链接。避免无用渲染的好东西。</p><p id="4bed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是我们不应该忘记react-redux connect HOC。为了从存储中获取数据，我们需要使用选择器。当我们使用Redux惰性容器时，我们不应该考虑这个问题，因为它太简单了，它使用对象链接来存储数据:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="eb31" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>{ connect } <strong class="lz hv">from </strong>'react-redux';<br/><strong class="lz hv">import </strong>post, { nameSpace } <strong class="lz hv">from </strong>'../rl';<br/><br/><strong class="lz hv">const </strong>mapStateToProps = state =&gt; state[nameSpace];<br/><strong class="lz hv">const </strong>mapDispatchToProps = { ...post.actions };<br/><br/><strong class="lz hv">export default </strong>connect(mapStateToProps, mapDispatchToProps);</span></pre><p id="6a01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，如果我需要在将数据放入组件或从其他模块获取数据之前更改数据，每次我都会获得一个新的对象，React会一次又一次地重新呈现它，即使数据始终是相同的。</p><p id="61ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jx" href="https://github.com/reduxjs/reselect" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">重新选择</strong></a>—Redux的选择器库，帮助我们解决这个问题。</p><p id="79df" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们安装它，我将展示如何使用。</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="df25" class="ky kz hu lz b fv md me l mf mg">yarn add reselect</span></pre><p id="4265" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们复杂的容器:</p><pre class="jq jr js jt fq ly lz ma mb aw mc dt"><span id="c00e" class="ky kz hu lz b fv md me l mf mg"><strong class="lz hv">import </strong>{ connect } <strong class="lz hv">from </strong>'react-redux';<br/><strong class="lz hv">import </strong>{ createSelector } <strong class="lz hv">from </strong>'reselect';<br/><br/><strong class="lz hv">import </strong>post, { nameSpace } <strong class="lz hv">from </strong>'../rl';<br/><br/><strong class="lz hv">const </strong>postSelector = state =&gt; ({<br/>  title: state[nameSpace].title,<br/>  body: state[nameSpace].body,<br/>  titleLength: state[nameSpace].title.length,<br/>  bodyLength: state[nameSpace].body.length,<br/>});<br/><br/><strong class="lz hv">const </strong>mapStateToProps = createSelector(<br/>  postSelector,<br/>  newPost =&gt; newPost,<br/>);<br/><strong class="lz hv">const </strong>mapDispatchToProps = { ...post.actions };<br/><br/><strong class="lz hv">export default </strong>connect(mapStateToProps, mapDispatchToProps);</span></pre><p id="5ba1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我添加了<strong class="it hv">标题长度</strong>和<strong class="it hv">正文长度</strong>作为属性，只是为了举例。在真正的应用程序中，你可以从商店中获得部分或一些部分，并将其合并。无论如何，如果没有重新选择，您每次都会创建一个新对象，即使数据相同，react也会重新渲染组件。</p><p id="2aeb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重新选择检查新对象内部的数据，并在每次链接时从内存返回相同的对象。React将看到相同的链接，不会重新渲染组件。</p></div><div class="ab cl jy jz hc ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hn ho hp hq hr"><p id="6a4d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是关于Redux Lazy系列的最后一部分。请在评论中提出你的问题，别忘了在<a class="ae jx" href="https://github.com/evheniy/redux-lazy" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> github </strong> </a>上发表。</p></div></div>    
</body>
</html>