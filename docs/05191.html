<html>
<head>
<title>Getting a Handle on Spiralling AWS Lambda Cost in ~15 sec</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在大约15秒内控制螺旋上升的AWS Lambda成本</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/getting-a-handle-on-spiralling-aws-lambda-cost-in-15-sec-5c6e47f85ada?source=collection_archive---------42-----------------------#2018-06-19">https://medium.com/hackernoon/getting-a-handle-on-spiralling-aws-lambda-cost-in-15-sec-5c6e47f85ada?source=collection_archive---------42-----------------------#2018-06-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/371115ee4b7315f52a0c7eb0f4a54016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAW7_jqGJaJLK0nlp6DM_Q.png"/></div></div></figure><p id="b51e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">AWS Lambda函数在入门时可能看起来价格低廉。尽管开发人员可以限制其最大内存大小和最大函数执行时间，但由于多种原因，成本仍有可能失控。这可能是因为DDoS攻击，每个函数的内存分配过多，或者代码中的错误意外地无数次调用一个函数！</p><blockquote class="ka kb kc"><p id="3bb1" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">在这篇文章中，我们将带你了解Lambda函数的成本，以及可视化控制台如何帮助你在大约15秒内获得清晰的结果(跳到第4点，立即观看它的运行！).</p></blockquote><h1 id="9363" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">影响AWS Lambda成本的因素:</h1><p id="72af" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">在顶层，看起来AWS只对Lambda函数运行的时间收费。实际上，它取决于:</p><p id="cd23" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">–执行/请求的数量</p><p id="1ac2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">–功能运行的时间范围(四舍五入到最接近的100毫秒)</p><p id="822b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">–函数的内存大小</p><p id="6c98" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如:如果一个函数使用512 MB，并且在一个月内被调用500万次(每次调用持续一秒钟)，那么仅这个Lambda的月成本就是36.8072美元。考虑一下你将在所有功能上花费多少美元！</p><blockquote class="ka kb kc"><p id="2e83" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">理想情况下，你必须在内存分配、调用次数和函数运行时间之间保持一个健康的平衡，以避免超额支付的风险。监控lambda函数的最优性必须是你常规审计的一部分。否则，花费可能高达数百美元。 </p></blockquote><p id="5cbf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">以下是监控这些功能以实现成本优化的几种方法:</p><h1 id="0d43" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">#1传统的手动方法:</h1><h2 id="fd10" class="lk ki hu bd kj ll lm ln kn lo lp lq kr jn lr ls kv jr lt lu kz jv lv lw ld lx dt translated">(根据功能的数量，需要几分钟到几小时。)</h2><p id="5c72" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">每次Lambda执行时，都会打印一条记录:</p><pre class="ly lz ma mb fq mc md me mf aw mg dt"><span id="e969" class="lk ki hu md b fv mh mi l mj mk">Duration: 1000 ms Billed Duration: 500 ms Memory Size: 512 MB Max Memory Used: 25 MB</span></pre><p id="c441" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面的记录清楚地显示了该函数只使用了512 MB中的25 MB。在这种情况下，一个128 MB内存的函数也能很好地工作，并且每月节省数百美元。但是，如果分配的空间小得多，函数可能会在执行前就被丢弃。</p><blockquote class="ka kb kc"><p id="710c" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><strong class="je hv"> <em class="hu">在那个账号上，定期监控Lambda记录。然而，这种方法的挑战是，您必须花费大量的时间和精力来监控每个功能。功能越多，你就必须投入更多的时间和精力去了解它们的性能。</em>T9】</strong></p></blockquote><p id="c389" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是为什么全球几个云工程师<a class="ae ml" href="https://s3.amazonaws.com/lambda-tools/pricing-calculator.html" rel="noopener ugc nofollow" target="_blank">使用AWS计算器</a>或在启动前测试功能，使用不同的内存分配、执行时间和运行时间，然后计算成本。</p><h1 id="a33e" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">#2成本探索方法:</h1><h2 id="5a27" class="lk ki hu bd kj ll lm ln kn lo lp lq kr jn lr ls kv jr lt lu kz jv lv lw ld lx dt translated">(如果所有的Lambda函数都被适当地标记，需要几分钟。)</h2><p id="24ed" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">使用<em class="kd"> AWS Cost Explorer </em>，您可以密切监控周、月或季度的价格，并根据服务、地区、AZ、使用类型、标签名称等进一步细分。</p><figure class="ly lz ma mb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/8d08ccd46e09cfb9d0d335087d88d98f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iKFykTyxQeL0qt8QZR8O8w.png"/></div></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek"><em class="mr">Cost of Lambda function that triggers RabbitMQ</em></figcaption></figure><p id="8f6d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">尽管有成本细节，AWS控制台不提供对实际问题领域的可见性。当一个问题发生时，你可以计算出Lambda函数的成本是否已经失控。</p><p id="701e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您已经正确标记了您的Lambdas，您可以在控制台中查看这些标记的函数本周的价格，并发现问题函数以采取进一步的行动。如果没有，几乎不可能找到罪魁祸首函数。因此，一些开发人员使用CloudWatch警报来获得函数超出设定限制时的通知。</p><h1 id="3d1b" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">#3第三方工具方法:</h1><h2 id="72f3" class="lk ki hu bd kj ll lm ln kn lo lp lq kr jn lr ls kv jr lt lu kz jv lv lw ld lx dt translated">(根据功能的数量，需要几分钟到几小时)</h2><p id="cd5a" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">市场上有几个第三方工具可用，比如GitHub上的这个<a class="ae ml" href="https://github.com/concurrencylabs/aws-pricing-tools/tree/master/functions" rel="noopener ugc nofollow" target="_blank">酷工具，它以近乎实时的方式</a> <strong class="je hv">计算AWS Lambda成本。</strong>即使有这样的工具，你也必须输入所有的细节才能手动获得费用明细。你必须筛选数据来理解整个画面。</p><h1 id="0238" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">#4使用可视控制台:</h1><h2 id="976a" class="lk ki hu bd kj ll lm ln kn lo lp lq kr jn lr ls kv jr lt lu kz jv lv lw ld lx dt translated">(需要大约15秒，不管函数是否被标记！)</h2><p id="e542" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">通过<strong class="je hv">内存、运行时、执行时间、代码大小、子网等来监控Lambda成本的一种新方法是使用可视化控制台。</strong></p><p id="948b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">比如TotalCloud最先进的内置滤镜的界面。这些过滤器有助于根据几个参数(如内存利用率、运行时间、执行等)对资源进行分组。在多个层面上。控制台的成本分析器在3D空间中分析这些分组资源的开销。最重要的是，这个界面可以帮助你获得Lambda使用的可视上下文，并在几秒钟内实时处理开销。观看下面的视频了解更多信息。</p><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="ms mt l"/></div></figure><h1 id="2e5c" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">总结:</h1><p id="0e56" class="pw-post-body-paragraph jc jd hu je b jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv lj jx jy jz hn dt translated">如果您观察下表，就会发现监控Lambda的性能和成本所花费的时间和精力:</p><blockquote class="ka kb kc"><p id="ce2c" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><strong class="je hv"><em class="hu">–手动方式:分钟到小时取决于功能数量</em> </strong></p><p id="ea02" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><strong class="je hv"><em class="hu">–成本浏览器方式:几分钟，当且仅当您正确标记所有Lambda函数</em> </strong></p><p id="58c2" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><strong class="je hv"><em class="hu">–total cloud方式:~ 15秒，不管你是否标记了函数！此外，您可以在单一控制台上对成本和性能一目了然。</em>T19】</strong></p></blockquote><p id="3c29" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">AWS Lambda function的按使用付费计费模式，只在执行过程中开启，无疑节省了计算资源和成本。也就是说，密切关注次优功能，同时实时跟踪其成本也同样重要。</p></div><div class="ab cl mu mv hc mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hn ho hp hq hr"><p id="24eb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kd">原载于2018年6月19日</em><a class="ae ml" href="http://blog.totalcloud.io/getting-a-handle-on-spiralling-aws-lambda-cost-in-sec/" rel="noopener ugc nofollow" target="_blank"><em class="kd">blog . total cloud . io</em></a><em class="kd">。</em></p></div></div>    
</body>
</html>