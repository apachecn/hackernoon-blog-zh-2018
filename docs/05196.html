<html>
<head>
<title>How to run multiple apps on a single EC2 instance with Nginx and map your custom domain?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Nginx在单个EC2实例上运行多个app，并映射自己的自定义域？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-run-multiple-apps-on-a-single-ec2-instance-with-nginx-and-map-your-custom-domain-2640630ce1e7?source=collection_archive---------2-----------------------#2018-06-20">https://medium.com/hackernoon/how-to-run-multiple-apps-on-a-single-ec2-instance-with-nginx-and-map-your-custom-domain-2640630ce1e7?source=collection_archive---------2-----------------------#2018-06-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="9d57" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">在本教程中，我们将在EC2实例中托管一个单独的React和Node.js应用程序，并映射我们的自定义域。</h2></div><p id="3aad" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是我第一次尝试在我的EC2实例上运行多个(Node.js &amp; React JS)应用程序，幸运的是，我成功了。我想确保没有人会像我一样在EC2中设置多个实例时感到沮丧。实际上实现起来很容易，因为有很多答案已经充斥在StackOverflow中，但没有一个是实用的。这让我有机会写这篇文章并帮助他人，因为我知道，分享是关爱。</p><p id="2ccb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">必需:</strong>在自定义域中运行我们的客户端和在子域中运行服务器会更棒(例如:<a class="ae kf" href="https://tamilakam.in" rel="noopener ugc nofollow" target="_blank">https://tamila kam . in</a>&amp;<a class="ae kf" href="https://api.tamilakam.in." rel="noopener ugc nofollow" target="_blank">https://API . tamila kam . in .</a>您可以通过@ <a class="ae kf" href="https://in.godaddy.com/" rel="noopener ugc nofollow" target="_blank"> GoDaddy </a>或任何其他域注册商获得一个域名，域名是完成剩余步骤的必备条件。</p><p id="fd06" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我希望你已经知道Nginx的配置设置。如果没有，不要担心。我们将在学习本教程时设置它。</p><h2 id="7993" class="kg kh hu bd ki kj kk kl km kn ko kp kq js kr ks kt jw ku kv kw ka kx ky kz la dt translated">在生产中部署Node.js应用程序并映射您的自定义域。</h2><p id="ec7d" class="pw-post-body-paragraph jj jk hu jl b jm lb iv jo jp lc iy jr js ld ju jv jw le jy jz ka lf kc kd ke hn dt translated">我已经完成了在生产中部署node.js应用程序的教程。你可以通过@</p><div class="lg lh fm fo li lj"><a rel="noopener follow" target="_blank" href="/full-stack-web-development-from-scratch-to/deploy-your-node-js-app-in-production-and-use-bitbucket-to-automate-your-deployment-50b07b18914c"><div class="lk ab ej"><div class="ll ab lm cl cj ln"><h2 class="bd hv fv z el lo eo ep lp er et ht dt translated">在生产中部署Node.js应用程序，并使用BitBucket来自动化部署。</h2><div class="lq l"><h3 class="bd b fv z el lo eo ep lp er et ek translated">在本教程中，我们将创建一个示例Node.js服务器，将其推送到BitBucket并使用PM2，我们将自动…</h3></div><div class="lr l"><p class="bd b gc z el lo eo ep lp er et ek translated">medium.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx ly lj"/></div></div></a></div><p id="80dd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在上面的教程中，我刚刚在生产环境中托管了一个Node.js应用程序。使用amazon EC2默认URL和端口号，我们可以访问服务器。</p><p id="f956" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是现在，在本教程中，我们将映射我们的自定义域以指向我们的远程服务器。</p><p id="5114" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">注意:在本教程中，我们将使用端口4500来运行我们的服务器。</strong></p><p id="b48f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我假设你已经有了Amazon EC2实例及其连接过程的经验。如果您不是，请浏览下面的链接，完成提供的步骤，并在继续之前准备好您的远程实例。</p><div class="lg lh fm fo li lj"><a rel="noopener follow" target="_blank" href="/full-stack-web-development-from-scratch-to/make-your-amazon-ec2-instance-up-and-running-ab80120eb23"><div class="lk ab ej"><div class="ll ab lm cl cj ln"><h2 class="bd hv fv z el lo eo ep lp er et ht dt translated">启动并运行您的Amazon EC2实例。</h2><div class="lq l"><h3 class="bd b fv z el lo eo ep lp er et ek translated">在这一部分，我们将创建一个Amazon帐户EC2实例，并通过SSH连接到该实例。</h3></div><div class="lr l"><p class="bd b gc z el lo eo ep lp er et ek translated">medium.com</p></div></div><div class="ls l"><div class="lz l lu lv lw ls lx ly lj"/></div></div></a></div><p id="fb6c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">步骤1 </strong>:在互联网域名注册机构DNS设置中提供您的Amazon EC2 <code class="eh ma mb mc md b">IPv4 Public IP</code>地址。</p><p id="cde9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">从Amazon控制台获取IPv4公共IP地址。这就像<code class="eh ma mb mc md b">18.xxx.xxx.15</code></p><figure class="mf mg mh mi fq mj fe ff paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="fe ff me"><img src="../Images/22b7248e59cc342c45045a16cdda52dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OToOFGaRZBIztl-AMSvIoQ.png"/></div></div></figure><p id="7ec9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">添加一条记录，其值如下。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="3b1f" class="kg kh hu md b fv mt mu l mv mw">Type: A<br/>Name: api // Sub domain so we can access it like api.tamilakam.in<br/>Value: 18.xxx.xxx.15 // <!-- -->IPv4 Public IP<br/>TTL: 600 seconds</span></pre><p id="8b7c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">更多信息请参考下图。也添加其他A记录，这样我们就不需要再来这里进行客户端应用程序配置了。</p><figure class="mf mg mh mi fq mj fe ff paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="fe ff mx"><img src="../Images/fc70dec5aa833de52f85d37ef940ec0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jy6doBLKK8sk_06CNhYBmg.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">DNS Management page — Add Records.</figcaption></figure><p id="8ddd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">步骤2 </strong>:让我们首先从终端使用下面的命令连接到我们的远程实例。(在所需位置替换您的EC2 url)</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="5f0d" class="kg kh hu md b fv mt mu l mv mw">$ ssh -i ~/.ssh/AWS-EC2-INSTANCE-LIVE.pem ubuntu@ec2-xx-xxx-xx-xx.us-east-2.compute.amazonaws.com</span></pre><p id="8e73" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">第三步</strong>:在EC2中，指定一个端口来运行Node.js服务器。</p><p id="55c1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在亚马逊控制台中点击<code class="eh ma mb mc md b">NETWORK &amp; SECURITY</code>下的<code class="eh ma mb mc md b">Security Groups</code>。</p><figure class="mf mg mh mi fq mj fe ff paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="fe ff me"><img src="../Images/7ed6e2864eaa9fb24aa575967c89f1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HhUMorYI8tVVuOswh-KCWQ.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Click Security Groups.</figcaption></figure><p id="cd53" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">右键单击实例的安全组，然后单击<code class="eh ma mb mc md b">Edit inbound rules</code>。</p><p id="c5f1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">点击<code class="eh ma mb mc md b">Add Rule</code>。添加如下配置，如下图所示，并点击<code class="eh ma mb mc md b">Save</code>。</p><figure class="mf mg mh mi fq mj fe ff paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="fe ff nc"><img src="../Images/7dce6f7553ea6dcf7501349d751cadf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-V6h3gcz3gGo3HtX-vRjTQ.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Security group config rule.</figcaption></figure><p id="8abe" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">端口4500表示我们将在这个端口运行Node.js服务器。添加运行服务器的端口。</p><p id="1eb5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">第四步</strong>:安装Nginx并配置</p><p id="8ee2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Ubuntu自带包管理器，<strong class="jl hv"> <em class="nd"> apt-get </em> </strong>。使用<strong class="jl hv"> <em class="nd"> apt-get </em> </strong>，我们可以在一个命令中安装<strong class="jl hv"> <em class="nd"> nginx </em> </strong>。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="3798" class="kg kh hu md b fv mt mu l mv mw">$ sudo apt-get install nginx</span></pre><p id="1016" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv"> <em class="nd"> apt-get </em> </strong>在安装后会自动运行nginx，所以你现在应该让它在端口<code class="eh ma mb mc md b">80</code>上运行，通过在浏览器中输入你的公共DNS URL进行检查。</p><figure class="mf mg mh mi fq mj fe ff paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="fe ff ne"><img src="../Images/ba194af4c22956c269b707da100b35a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHNMS-8Fqg-shegUomHRag.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Nginx welcome page.</figcaption></figure><p id="762b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果这不起作用，您可能需要手动启动它。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="ba8d" class="kg kh hu md b fv mt mu l mv mw">$ sudo /etc/init.d/nginx start</span></pre><p id="e0a4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在让我们配置Nginx来运行Node.js服务器。</p><p id="5e4c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如何设置<strong class="jl hv"> <em class="nd"> nginx </em> </strong>配置？配置以任何名称存储在<code class="eh ma mb mc md b">sites-available</code>的纯文本文件中。将它们链接到<code class="eh ma mb mc md b">sites-enabled</code>文件夹会导致它们在<strong class="jl hv"> <em class="nd"> nginx </em> </strong>启动时被读取和使用。所有的配置通过<strong class="jl hv"> <em class="nd"> nginx </em> </strong>组合在一起。</p><p id="8ead" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以使用cat查看这个配置。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="d75f" class="kg kh hu md b fv mt mu l mv mw">$ cat /etc/nginx/sites-<!-- -->available<!-- -->/default</span></pre><p id="f76a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们首先从<code class="eh ma mb mc md b">sites-enabled</code>中删除默认配置，我们将把它留在<code class="eh ma mb mc md b">sites-available</code>中以供参考。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="9893" class="kg kh hu md b fv mt mu l mv mw">$ sudo rm /etc/nginx/sites-<!-- -->enabled<!-- -->/default</span></pre><p id="70bc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们用域名在<code class="eh ma mb mc md b">sites-available</code>中创建一个配置文件。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="f42a" class="kg kh hu md b fv mt mu l mv mw">$ sudo nano /etc/nginx/sites-<!-- -->available<!-- -->/api.tamilakam.in</span></pre><p id="fdd4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">下面是我们将要使用的配置。将其输入文件并保存，替换<code class="eh ma mb mc md b">server_name</code>字段中的自定义域。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="473d" class="kg kh hu md b fv mt mu l mv mw">server {<br/>    listen 80;<br/>    server_name api.tamilakam.in;<br/>    location / {<br/>        proxy_set_header X - Real - IP $remote_addr;<br/>        proxy_set_header Host $http_host;<br/>        proxy_pass http: //127.0.0.1:4500;<br/>    }<br/>}</span></pre><p id="c1f5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将把所有HTTP流量从端口<code class="eh ma mb mc md b">80</code>转发到端口<code class="eh ma mb mc md b">4500</code>。</p><p id="2a95" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们监听运行Node.js服务器的端口4500，并将其重定向到api.tamilakam.in。</p><p id="f3f4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">链接<code class="eh ma mb mc md b">sites-enabled</code>中的配置文件(这将使文件看起来像是在<code class="eh ma mb mc md b">sites-enabled</code>中实际复制的)。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="0b0e" class="kg kh hu md b fv mt mu l mv mw">$ sudo ln -s /etc/nginx/sites-available/api.tamilakam.in /etc/nginx/sites-enabled/api.tamilakam.in</span></pre><p id="5fb4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae kf" href="https://kb.iu.edu/d/abbe" rel="noopener ugc nofollow" target="_blank">如果你不熟悉符号链接，可以在这里阅读更多。</a></p><p id="c945" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">重启<strong class="jl hv"> <em class="nd"> nginx </em> </strong>让新配置生效。</p><pre class="mf mg mh mi fq mp md mq mr aw ms dt"><span id="10e5" class="kg kh hu md b fv mt mu l mv mw">$ sudo service nginx restart</span></pre><p id="cdd8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就是这样。访问<a class="ae kf" href="https://api.tamilakam.in" rel="noopener ugc nofollow" target="_blank"> https://api.tamilakam.in </a>我们的Node.js API服务器就准备好了。</p><h2 id="6534" class="kg kh hu bd ki kj kk kl km kn ko kp kq js kr ks kt jw ku kv kw ka kx ky kz la dt translated">在生产中部署您的React应用程序并映射您的自定义域。</h2><p id="d68c" class="pw-post-body-paragraph jj jk hu jl b jm lb iv jo jp lc iy jr js ld ju jv jw le jy jz ka lf kc kd ke hn dt translated">你可以参考下面的链接，我已经创建了一个完整的React示例应用程序，上传到BitBucket，并作为一个生产应用程序托管在配置了Nginx的Amazon EC2实例中。</p><p id="a295" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">按照下面的教程，您可以使用相同的实例来运行客户端。</p><p id="cdc7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">是的。现在，我们在Amazon EC2的同一个实例中运行服务器和客户机。</p><p id="4029" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你有任何疑问，请在评论中告诉我。</p><p id="dd97" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">谢谢你。</p><p id="e08b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">参考资料:</p><div class="lg lh fm fo li lj"><a href="https://hackernoon.com/tutorial-creating-and-managing-a-node-js-server-on-aws-part-2-5fbdea95f8a1" rel="noopener  ugc nofollow" target="_blank"><div class="lk ab ej"><div class="ll ab lm cl cj ln"><h2 class="bd hv fv z el lo eo ep lp er et ht dt translated">教程:在AWS上创建和管理Node.js服务器，第2部分</h2><div class="lq l"><h3 class="bd b fv z el lo eo ep lp er et ek translated">在第1部分中，我们启动了一个服务器，在端口3000上响应HTTP请求。在本教程中，我们将再看4个…</h3></div><div class="lr l"><p class="bd b gc z el lo eo ep lp er et ek translated">hackernoon.com</p></div></div><div class="ls l"><div class="nf l lu lv lw ls lx ly lj"/></div></div></a></div><div class="lg lh fm fo li lj"><a rel="noopener follow" target="_blank" href="/full-stack-web-development-from-scratch-to/deploy-your-node-js-app-in-production-and-use-bitbucket-to-automate-your-deployment-50b07b18914c"><div class="lk ab ej"><div class="ll ab lm cl cj ln"><h2 class="bd hv fv z el lo eo ep lp er et ht dt translated">在生产中部署Node.js应用程序，并使用BitBucket来自动化部署。</h2><div class="lq l"><h3 class="bd b fv z el lo eo ep lp er et ek translated">在本教程中，我们将创建一个示例Node.js服务器，将其推送到BitBucket并使用PM2，我们将自动…</h3></div><div class="lr l"><p class="bd b gc z el lo eo ep lp er et ek translated">medium.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx ly lj"/></div></div></a></div></div></div>    
</body>
</html>