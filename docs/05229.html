<html>
<head>
<title>Up and Running with Ubuntu, Nvidia, Cuda, CuDNN, TensorFlow, and PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">启动并运行Ubuntu、Nvidia、Cuda、CuDNN、TensorFlow和PyTorch</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/up-and-running-with-ubuntu-nvidia-cuda-cudnn-tensorflow-and-pytorch-a54ec2ec907d?source=collection_archive---------1-----------------------#2018-06-21">https://medium.com/hackernoon/up-and-running-with-ubuntu-nvidia-cuda-cudnn-tensorflow-and-pytorch-a54ec2ec907d?source=collection_archive---------1-----------------------#2018-06-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="ef6f" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">深入了解如何在Ubuntu 18.04上安装深度学习框架并使用您的Nvidia GPU。</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/b6406116a5c252ae5b0733f777544d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0htNXqv_vmH2C41O1UQniQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Ignore my old dusty PS3, I was able to find an orange Nvidia logo to match!</figcaption></figure><p id="024a" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated"><strong class="kb hv">本文和信息是截至2018年6月25日的最新/更新信息</strong></p><p id="fd46" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">建立和训练深度学习模型是一项艰巨的任务。确保您的环境、软件包和GPU协调工作会增加这一努力。本指南相当深入地帮助了相对不熟悉Linux的用户。Ubuntu最新的长期支持(LTS) 18.04大约在4月底发布，所以我决定擦除我当前的Linux盒子，从头开始。包括安装我的深度学习环境。由于18.04相对较新，在确定要安装哪些软件包时可能会有些混乱。希望这篇文章有助于减轻这些担忧。我已经使用这个设置一个多月了，没有任何问题，但是如果你已经或者想要使用Ubuntu 16.04 LTS，这些说明应该也可以。不管怎样，我慢慢地走完这个过程，并提供所有终端输入和大部分输出。我也不只是展示我在做什么，而是试图为Linux/深度学习的新手解释为什么。</p><p id="86c5" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">希望这对你有所帮助！让我们开始吧…</p><h1 id="07f8" class="kv kw hu bd kx ky kz la lb lc ld le lf ja lg jb lh jd li je lj jg lk jh ll lm dt translated">序文</h1><p id="9fa5" class="pw-post-body-paragraph jz ka hu kb b kc ln iv ke kf lo iy kh ki lp kk kl km lq ko kp kq lr ks kt ku hn dt translated"><strong class="kb hv">首选硬件</strong></p><ul class=""><li id="4588" class="ls lt hu kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated">英伟达GTX 1070(我假设你有一个英伟达图形处理器)</li><li id="7892" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">华硕微型ATX B150M-A D3</li><li id="6f31" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">16千兆字节内存</li><li id="2dd8" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">英特尔酷睿I5–6500 3.2 GHz</li></ul><p id="69a0" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated"><strong class="kb hv">首选软件</strong></p><ul class=""><li id="999e" class="ls lt hu kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated">Ubuntu  18.04 LTS(桌面版)</li><li id="13f8" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated"><a class="ae mg" href="https://conda.io/miniconda.html" rel="noopener ugc nofollow" target="_blank"> Miniconda </a>(也可以用<a class="ae mg" href="https://anaconda.org/" rel="noopener ugc nofollow" target="_blank"> Anaconda </a> —主<a class="ae mg" href="https://stackoverflow.com/questions/45421163/anaconda-vs-miniconda" rel="noopener ugc nofollow" target="_blank">差</a>)</li><li id="4014" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">Python 3.6(通过miniconda)</li><li id="72a9" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated"><a class="ae mg" href="https://gnometerminator.blogspot.com/p/introduction.html" rel="noopener ugc nofollow" target="_blank">我的终端的终结符</a></li><li id="db43" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated"><a class="ae mg" href="https://github.com/tmux/tmux/wiki" rel="noopener ugc nofollow" target="_blank"> Tmux </a>终端复用器(深度学习的必备工具)</li><li id="648c" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated"><a class="ae mg" href="https://www.sublimetext.com/3" rel="noopener ugc nofollow" target="_blank"> SublimeText </a>作为我的文本编辑器</li><li id="f0e9" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated"><a class="ae mg" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VSCode </a>作为我的主要代码编辑器。以前是Atom…</li></ul><p id="bf85" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated"><strong class="kb hv">我在这篇文章中使用了以下惯例</strong></p><ul class=""><li id="9c9f" class="ls lt hu kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated">任何前进到<strong class="kb hv"> $ </strong>并被<strong class="kb hv">加粗的</strong>都是让你键入终端并运行的命令。不要包括美元符号。</li><li id="5e6c" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">任何以<strong class="kb hv"> # </strong>开头并且是<em class="mh">斜体</em>的内容都是一个注释，是为了提供更多清晰的信息。不要将这些添加到终端。</li><li id="ea8b" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">任何跳过的行都是控制台输出。基本上，运行命令后您可能会看到什么。我将不包括一些输出，特别是如果它很长，或者不是很有建设性。</li></ul><p id="17f0" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">这里有一个例子:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="20f6" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ run this comman</strong>d <em class="mh">#comment about the command, do not include this<br/># comment about the proceeding output from the above command<br/>    </em>some output that is potentially important…<br/>    ack! test failed!!!<br/>    Why did it fail? who knows… StackExchange Knows!</span></pre></div><div class="ab cl ms mt hc mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hn ho hp hq hr"><h1 id="4c25" class="kv kw hu bd kx ky mz la lb lc na le lf ja nb jb lh jd nc je lj jg nd jh ll lm dt translated"><strong class="ak"> GPU兼容性</strong></h1><p id="252a" class="pw-post-body-paragraph jz ka hu kb b kc ln iv ke kf lo iy kh ki lp kk kl km lq ko kp kq lr ks kt ku hn dt translated">首要任务是确保您的GPU具有足够高的计算分数。TensorFlow的文档说明:</p><blockquote class="ne nf ng"><p id="d052" class="jz ka mh kb b kc kd iv ke kf kg iy kh nh kj kk kl ni kn ko kp nj kr ks kt ku hn dt translated">具有CUDA计算能力的GPU卡3.0或更高版本用于从源代码构建，3.5或更高版本用于我们的二进制文件。</p></blockquote><p id="a2d1" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">我们不会从源代码构建TensorFlow，而是使用他们预先构建的二进制文件。因此你需要3.5分或更高的分数。打开您的终端并运行:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="783b" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo lshw -C display | grep product</strong><br/>    product: GP104 [GeForce GTX 1070]</span></pre><p id="7628" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在你已经有了你的GPU模型，你可以用Nvidia的网站交叉引用它来确定你的计算能力。在我的情况下，这是6.1分，所以我可以走了。</p><p id="6e9b" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">接下来，我们要确保Ubuntu可用的所有软件包都是最新最好的，然后我们要安装/升级它们。运行:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="d5fb" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo apt update</strong><br/><strong class="mj hv">$ sudo apt upgrade</strong> <em class="mh">#will ask you Y/n if you want to upgrade</em></span></pre><p id="ebf2" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">接下来我们将安装GPU驱动程序。</p></div><div class="ab cl ms mt hc mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hn ho hp hq hr"><h1 id="2ee0" class="kv kw hu bd kx ky mz la lb lc na le lf ja nb jb lh jd nc je lj jg nd jh ll lm dt translated"><strong class="ak">英伟达驱动</strong></h1><p id="c3c7" class="pw-post-body-paragraph jz ka hu kb b kc ln iv ke kf lo iy kh ki lp kk kl km lq ko kp kq lr ks kt ku hn dt translated">Ubuntu预装了通用的GPU驱动程序。这些驱动程序不是高度优化的，我们不想牺牲任何性能。您首先需要为您的GPU找到并安装最新的Nvidia驱动程序。这篇好的<a class="ae mg" href="https://askubuntu.com/questions/61396/how-do-i-install-the-nvidia-drivers/61433#61433" rel="noopener ugc nofollow" target="_blank"> StackExchange帖子</a>中列出了几个选项:</p><blockquote class="ne nf ng"><p id="83c8" class="jz ka mh kb b kc kd iv ke kf kg iy kh nh kj kk kl ni kn ko kp nj kr ks kt ku hn dt translated"><strong class="kb hv">英伟达PPA </strong> —出色的性能。它通过使用PPA中包含的驱动程序(每一代Nvidia卡都不相同，这将在下面解释)来为大多数卡开箱即用。</p><p id="9de7" class="jz ka mh kb b kc kd iv ke kf kg iy kh nh kj kk kl ni kn ko kp nj kr ks kt ku hn dt translated"><strong class="kb hv"> Ubuntu默认推荐驱动* </strong> — Ubuntu做了一项惊人的工作，根据你使用的卡来计算你需要哪种Nvidia驱动。</p><p id="ad8a" class="jz ka mh kb b kc kd iv ke kf kg iy kh nh kj kk kl ni kn ko kp nj kr ks kt ku hn dt translated"><strong class="kb hv">新版本</strong> —这是Nvidia驱动程序的开源实现。他们也做了令人惊叹的工作，虽然他们不能与官方驱动程序或PPA的驱动程序相提并论(最新的Nvidia卡更是如此)，但他们每周所做的开发速度、承诺、奉献和进步，使人相信这是一个值得拥有和推广的选择。</p><p id="e42d" class="jz ka mh kb b kc kd iv ke kf kg iy kh nh kj kk kl ni kn ko kp nj kr ks kt ku hn dt translated"><strong class="kb hv">Nvidia官方网站</strong> —这是官方驱动程序(和PPA的一样)，但不同的是，它们不会自动升级，在更新、卸载和安装时会出现一些问题(非常罕见，但会发生)。</p></blockquote><p id="d234" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">在研究了哪个驱动程序最适合使用之后，我选择了Ubuntu的PPA。官方的Nvidia驱动程序已经知道了T2 X服务器的问题，需要更多的努力才能让它正常工作。不，谢谢…默认的Ubuntu驱动缺乏性能。新驱动程序虽然看起来不错，开源也不错，但它的性能并不好。添加Ubuntu PPA是最好的选择，因为他们有最新的Nvidia官方驱动程序，并已在Ubuntu上测试过，所以这应该是一个平稳的安装。好的，为此运行以下命令:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="ba8e" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo add-apt-repository ppa:graphics-drivers/ppa</strong></span></pre><p id="6221" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">这个命令将把PPA库添加到Ubuntu的打包系统中。这是什么意思？Ubuntu是基于Debian Linux构建的，因此使用了Debian的dpkg打包系统。这个系统为Ubuntu提供了要安装的应用。高级包工具(APT)允许您从终端轻松地与dpkg交互。它监督软件包的依赖性，并升级操作系统中的大量软件。</p><p id="82ba" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">接下来，您需要确定需要安装哪个驱动程序。转到<a class="ae mg" href="https://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa" rel="noopener ugc nofollow" target="_blank"> PPA库</a>，向下滚动到页面底部。基于Ubuntu 18.04，我可以在nvidia-driver-390和nvidia-driver-396之间选择。我选择390是因为它已经存在了很长时间，因此更多潜在的错误和问题将会被发现。</p><p id="c271" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">运行以下命令安装驱动程序。</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="e2c1" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo apt install nvidia-driver-390</strong></span></pre><p id="45af" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">继续用书签标记你的标签，是时候重启你的电脑了！当你重新开始运作时，我仍会在这里…</p><p id="d4fb" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">太好了，你回来了。希望如此！好的，让我们检查一下，确保驱动程序安装正确:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="ce96" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ nvidia-smi</strong></span></pre><p id="f05c" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">您的输出应该类似于下图，除了您的驱动程序版本号可能不同，以及您的GPU和进程。如果是的话，恭喜你！你有Nvidia驱动程序。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nk"><img src="../Images/f17543d56b30e4ee6369b259ede0afa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ID1kdzdkSBrzcDugBhqzBQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">output of nvidia-smi</figcaption></figure><p id="c87a" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">总结一下驱动程序部分，你要确保APT不会升级你的驱动程序。记得您将PPA添加到APT，现在它负责管理该软件。请务必阻止我们正在安装的软件升级。</p><p id="9984" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">让GPU支持工作需要不同硬件和软件的配合。为了确保兼容性，我们将要求Ubuntu不要更新某些软件。您可以随时取消此保留。运行:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="4e62" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo apt-mark hold nvidia-driver-390</strong><br/>    nvidia-driver-390 set on hold.<br/><em class="mh"># To reverse this operation run:<br/># sudo apt-mark unhold package_name</em></span></pre><p id="b4a9" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在轮到CUDA了！</p></div><div class="ab cl ms mt hc mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hn ho hp hq hr"><h1 id="c5e9" class="kv kw hu bd kx ky mz la lb lc na le lf ja nb jb lh jd nc je lj jg nd jh ll lm dt translated"><strong class="ak">安装CUDA 9.0 </strong></h1><p id="9da8" class="pw-post-body-paragraph jz ka hu kb b kc ln iv ke kf lo iy kh ki lp kk kl km lq ko kp kq lr ks kt ku hn dt translated">问题是CUDA 9.0 vs 9.1。据我所知，如果从源代码构建，9.1版本似乎可以工作，而从二进制文件安装时，9.0版本可以开箱即用。从二进制文件安装使这个过程不那么乏味，让我们继续这样做。</p><p id="09af" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">继续打开<a class="ae mg" href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html" rel="noopener ugc nofollow" target="_blank"> CUDA文档</a>。这些说明可能很难遵循，但是让我们一步一步来。</p><p id="288d" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">首先我们要检查你安装了什么gcc和g++版本。</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="5552" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ gcc — version</strong><br/>    gcc (Ubuntu 7.3.0–16ubuntu3) 7.3.0<br/><strong class="mj hv">$ g++ — version</strong><br/>    g++ (Ubuntu 7.3.0–16ubuntu3) 7.3.0</span></pre><p id="76ea" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">当您安装PPA Nvidia驱动程序时，这些驱动程序也安装了gcc和g++ 7 . x版。这很好，但是TensorFlow和cuDNN需要6.x版才能兼容。我们将暂时搁置这个问题，但在某个时候测试会失败，我们将在安装CUDA后解决这个问题。</p><p id="b482" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">让我们安装内核头文件。更多关于Linux头文件的信息，请点击<a class="ae mg" href="https://askubuntu.com/questions/598948/what-does-linux-headers-uname-r-do" rel="noopener ugc nofollow" target="_blank">这里</a>，尤其是<a class="ae mg" href="https://answers.launchpad.net/ubuntu/+question/54157" rel="noopener ugc nofollow" target="_blank">这里</a>。本质上，内核头文件是用于编译内核和任何其他应用程序/软件(在这种情况下是CUDA)的文件，它们依赖于这些头文件中的信息。要安装run:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="9295" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo apt install linux-headers-$(uname -r)</strong><br/>    Reading package lists… Done<br/>    Building dependency tree<br/>    Reading state information… Done<br/>    linux-headers-4.15.0–23-generic is already the newest version      (4.15.0–23.25).<br/>    linux-headers-4.15.0–23-generic set to manually installed.</span></pre><p id="64e2" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在你需要下载CUDA并安装它。你可以从这个官方<a class="ae mg" href="https://developer.nvidia.com/cuda-90-download-archive" rel="noopener ugc nofollow" target="_blank"> Nvidia存档</a>中抓取CUDA 9.0。请看下图，看看要选择哪些选项。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nl"><img src="../Images/c5cfadc1f68e2ee69b879ea38f23903d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9u7ufh18thOy8P0Mpf81YA.png"/></div></div></figure><p id="c45c" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">下载完成后，运行以下命令:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="cfef" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ cd Downloads/</strong> <em class="mh">#navigate to where the .deb file downloaded<br/></em><strong class="mj hv">$ sudo dpkg -i cuda-repo-ubuntu1704–9–0-local_9.0.176–1_amd64.deb</strong><br/>    Selecting previously unselected package cuda-repo-ubuntu1704–9–0-local.<br/>    (Reading database … 224086 files and directories currently installed.)<br/>    Preparing to unpack cuda-repo-ubuntu1704–9–0-local_9.0.176–1_amd64.deb …<br/>    Unpacking cuda-repo-ubuntu1704–9–0-local (9.0.176–1) …<br/>    Setting up cuda-repo-ubuntu1704–9–0-local (9.0.176–1) …<br/>    The public CUDA GPG key does not appear to be installed.<br/>    To install the key, run this command:<br/>    sudo apt-key add /var/cuda-repo-9–0-local/7fa2af80.pub <em class="mh"># run the command the command they provide to install the GPG key<br/></em><strong class="mj hv">$ sudo apt-key add /var/cuda-repo-9–0-local/7fa2af80.pub<br/>$ sudo apt update</strong><br/><strong class="mj hv">$ sudo apt install cuda</strong> <em class="mh">#might take a few minutes to finish</em></span></pre><p id="cbed" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">恭喜你！安装了CUDA 9.0。让我们从更新中也保留这个包:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="3d1a" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo apt-mark hold cuda</strong></span></pre><p id="10a8" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">最后，你需要在你的。bashrc文件。这个隐藏文件位于您的主目录中。您需要在您的。bashrc文件:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="b2f3" class="mn kw hu mj b fv mo mp l mq mr">export PATH=/usr/local/cuda-9.0/bin${PATH:+:${PATH}}</span></pre><p id="e4b6" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">你可以使用任何你喜欢的文本编辑器，或者nano或者vim。但是打开你的。bashrc文件，并将其添加到文件的末尾，保存并关闭。您需要为启动一个新的终端会话(关闭并重新打开您的终端)。bashrc文件更改以加载。。bashrc是一个shell脚本，每次启动会话时bash都会运行它。您正在添加PATH变量，以便可以在您的路径中找到CUDA。</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="8a57" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ subl .bashrc</strong> <em class="mh">#opens .bashrc file in sublime text, I copy pasta the above line of code then save and close sublime.<br/></em><strong class="mj hv">$ cat .bashrc | grep cuda</strong><br/>export PATH=/usr/local/cuda-9.0/bin${PATH:+:${PATH}} <em class="mh">#you should see this output</em></span></pre><p id="d9df" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">伟大的CUDA准备接受考验！</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="c928" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ cd <em class="mh">#navigate back to home<br/></em>$ cat /proc/driver/nvidia/version</strong><br/>    NVRM version: NVIDIA UNIX x86_64 Kernel Module 390.67 Fri Jun 1 04:04:27 PDT 2018<br/>    GCC version: gcc version 7.3.0 (Ubuntu 7.3.0–16ubuntu3)<br/><strong class="mj hv">$ nvcc — version</strong><br/>    nvcc: NVIDIA (R) Cuda compiler driver<br/>    Copyright © 2005–2017 NVIDIA Corporation<br/>    Built on Fri_Sep__1_21:08:03_CDT_2017<br/>    Cuda compilation tools, release 9.0, V9.0.176</span></pre><p id="cea3" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">如果一切正常，那么CUDA已经安装并正常工作。GCC仍然是7.x版本，但是我们将很快修复它。现在让我们来对付cuDNN。</p></div><div class="ab cl ms mt hc mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hn ho hp hq hr"><h1 id="da9b" class="kv kw hu bd kx ky mz la lb lc na le lf ja nb jb lh jd nc je lj jg nd jh ll lm dt translated"><strong class="ak"> cuDNN </strong></h1><p id="46cf" class="pw-post-body-paragraph jz ka hu kb b kc ln iv ke kf lo iy kh ki lp kk kl km lq ko kp kq lr ks kt ku hn dt translated">在cuDNN上查看官方<a class="ae mg" href="https://docs.nvidia.com/deeplearning/sdk/cuDNN-install/index.html#installcuda" rel="noopener ugc nofollow" target="_blank">文档</a>。我们将逐步完成这些。首先你需要确保你已经在<a class="ae mg" href="https://developer.nvidia.com" rel="noopener ugc nofollow" target="_blank"> Nvidia的开发者项目</a>创建了一个免费账户。一旦你注册，验证你的电子邮件并准备好，你可以从<a class="ae mg" href="https://developer.nvidia.com/rdp/cuDNN-download" rel="noopener ugc nofollow" target="_blank">这个链接</a>登录，它会直接带你到下载cuDNN页面。按照下图中的步骤找到特定的cuDNN版本。基于TensorFlow当时对最佳兼容性的建议，我选择cuDNN版本7.0.5而不是7.1.4。</p><p id="51c7" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">一旦在下载页面同意这些条款，然后在列表的底部寻找存档cuDNN版本的链接。7.0.5是一个存档的稳定版本。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nm"><img src="../Images/b5e84de782f3519e2d1c16bc9e847e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jpqWPJ98hBEj3fBI-Li4aQ.png"/></div></div></figure><p id="3374" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">这将带你到档案，在那里你可以找到cuDNN v7.0.5 for CUDA 9.0。</p><p id="e994" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">下载以下所有三个。deb文件:</p><ul class=""><li id="e966" class="ls lt hu kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated">用于Ubuntu16.04的cuDNN v7.0.5运行时库(Deb)</li><li id="48e4" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">适用于Ubuntu16.04的cuDNN v7.0.5开发人员库(Deb)</li><li id="23ba" class="ls lt hu kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">适用于Ubuntu16.04 (Deb)的cuDNN v7.0.5代码示例和用户指南</li></ul><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nn"><img src="../Images/4e727437b342f805f0b997074088f9b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cSInr02xIO4y9LseZlOn7w.png"/></div></div></figure><p id="1e61" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">下载后，运行以下命令:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="78b6" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ cd Downloads/</strong> <em class="mh">#navigate to where you downloaded them<br/># Start with the runtime file<br/></em><strong class="mj hv">$ sudo dpkg -i libcuDNN7_7.0.5.15–1+cuda9.0_amd64.deb</strong><br/>    Selecting previously unselected package libcuDNN7.<br/>    (Reading database … 236355 files and directories currently installed.)<br/>    Preparing to unpack libcuDNN7_7.0.5.15–1+cuda9.0_amd64.deb …<br/>    Unpacking libcuDNN7 (7.0.5.15–1+cuda9.0) …<br/>    Setting up libcuDNN7 (7.0.5.15–1+cuda9.0) …<br/>    Processing triggers for libc-bin (2.27–3ubuntu1) …<br/>    /sbin/ldconfig.real: /usr/local/cuda-9.0/targets/x86_64-linux/lib/libcuDNN.so.7 is not a symbolic link</span><span id="7ad7" class="mn kw hu mj b fv no mp l mq mr"><em class="mh"># then the developer file — dev typically includes the source code<br/></em><strong class="mj hv">$ sudo dpkg -i libcuDNN7-dev_7.0.5.15–1+cuda9.0_amd64.deb</strong><br/>    (Reading database … 236362 files and directories currently installed.)<br/>    Preparing to unpack libcuDNN7-dev_7.0.5.15–1+cuda9.0_amd64.deb  <br/>    Unpacking libcuDNN7-dev (7.0.5.15–1+cuda9.0) over (7.0.5.15 1+cuda9.0) …<br/>    Setting up libcuDNN7-dev (7.0.5.15–1+cuda9.0) …<br/>    update-alternatives: using /usr/include/x86_64-linux    gnu/cuDNN_v7.h to provide /usr/include/cuDNN.h (libcuDNN) in auto mode</span><span id="62d7" class="mn kw hu mj b fv no mp l mq mr"><em class="mh"># finally the doc file — necessary for running the installation test<br/></em><strong class="mj hv">$ sudo dpkg -i libcuDNN7-doc_7.0.5.15–1+cuda9.0_amd64.deb</strong><br/>    Selecting previously unselected package libcuDNN7-doc.<br/>    (Reading database … 236362 files and directories currently installed.)<br/>    Preparing to unpack libcuDNN7-doc_7.0.5.15–1+cuda9.0_amd64.deb …<br/>    Unpacking libcuDNN7-doc (7.0.5.15–1+cuda9.0) …<br/>    Setting up libcuDNN7-doc (7.0.5.15–1+cuda9.0) …</span></pre><p id="f0d4" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">太好了，还不算太糟。让我们测试cuDNN安装。</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="c6c8" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ cd</strong> <em class="mh">#back to home<br/></em><strong class="mj hv">$ cp -r /usr/src/cuDNN_samples_v7/ $HOME</strong> <em class="mh">#copy the test mnist files over to home.<br/></em><strong class="mj hv">$ cd $HOME/cuDNN_samples_v7/mnistcuDNN</strong><br/><strong class="mj hv">$ make clean &amp;&amp; make</strong><br/>    rm -rf *o<br/>    rm -rf mnistcuDNN<br/>    /usr/local/cuda/bin/nvcc -ccbin g++ -I/usr/local/cuda/include -IFreeImage/include -m64 -gencode arch=compute_30,code=sm_30 -gencode arch=compute_35,code=sm_35 -gencode arch=compute_50,code=sm_50 -gencode arch=compute_53,code=sm_53 -gencode arch=compute_53,code=compute_53 -o fp16_dev.o -c fp16_dev.cu<br/>    In file included from /usr/local/cuda/include/host_config.h:50:0,<br/>    from /usr/local/cuda/include/cuda_runtime.h:78,<br/>    from &lt;command-line&gt;:0:<br/>    /usr/local/cuda/include/crt/host_config.h:119:2: error: <em class="mh">#error — unsupported GNU version! gcc versions later than 6 are not supported!<br/>    #error — unsupported GNU version! gcc versions later than 6 are not supported!<br/>    </em>^~~~~<br/>    Makefile:203: recipe for target ‘fp16_dev.o’ failed<br/>    make: *** [fp16_dev.o] Error 1</span></pre><p id="78ce" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在我们遇到了gcc/++ 7的问题。现在，我们需要缓解这个gcc问题。让我们安装gcc 6.x和g++ 6.x，然后我们可以创建一个符号链接来告诉cuDNN寻找版本6。我们也可以安装版本7。</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="23dc" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo apt install gcc-6 g++-6</strong><br/>    <em class="mh"># ln -s makes a symbolic link so cuda looks for gcc version 6 where we tell it to look.<br/></em><strong class="mj hv">$ sudo ln -s /usr/bin/gcc-6 /usr/local/cuda/bin/gcc<br/>$ sudo ln -s /usr/bin/g++-6 /usr/local/cuda/bin/g+</strong>+</span></pre><p id="7f92" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">到底什么是符号链接？</p><blockquote class="ne nf ng"><p id="f0c5" class="jz ka mh kb b kc kd iv ke kf kg iy kh nh kj kk kl ni kn ko kp nj kr ks kt ku hn dt translated">符号链接也称为软链接，是一种指向另一个文件的特殊文件，很像Windows中的快捷方式或Macintosh别名。与硬链接不同，符号链接不包含目标文件中的数据。它只是指向文件系统中某处的另一个条目。这种差异赋予了符号链接某些硬链接所不具备的品质，如链接到目录或通过NFS联网的远程计算机上的文件的能力。此外，当你删除一个目标文件时，指向该文件的符号链接变得不可用，而硬链接会保留文件的内容<a class="ae mg" href="https://kb.iu.edu/d/abbe" rel="noopener ugc nofollow" target="_blank">https://kb.iu.edu/d/abbe</a></p></blockquote><p id="2c50" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">好了，让我们再次尝试这个测试，确保gcc6和g++6正常工作。</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="3b19" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ make clean &amp;&amp; make</strong><br/>    rm -rf *o<br/>    rm -rf mnistcuDNN<br/>    /usr/local/cuda/bin/nvcc -ccbin g++ -I/usr/local/cuda/include -IFreeImage/include -m64 -gencode arch=compute_30,code=sm_30 -gencode arch=compute_35,code=sm_35 -gencode arch=compute_50,code=sm_50 -gencode arch=compute_53,code=sm_53 -gencode arch=compute_53,code=compute_53 -o fp16_dev.o -c fp16_dev.cu<br/>    g++ -I/usr/local/cuda/include -IFreeImage/include -o fp16_emu.o -c fp16_emu.cpp<br/>    g++ -I/usr/local/cuda/include -IFreeImage/include -o mnistcuDNN.o -c mnistcuDNN.cpp<br/>    /usr/local/cuda/bin/nvcc -ccbin g++ -m64 -gencode arch=compute_30,code=sm_30 -gencode arch=compute_35,code=sm_35 -gencode arch=compute_50,code=sm_50 -gencode arch=compute_53,code=sm_53 -gencode arch=compute_53,code=compute_53 -o mnistcuDNN fp16_dev.o fp16_emu.o mnistcuDNN.o -LFreeImage/lib/linux/x86_64 -LFreeImage/lib/linux -lcudart -lcublas -lcuDNN -lfreeimage -lstdc++ -lm</span></pre><p id="1be2" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">到目前为止一切顺利，最后，cuDNN使用著名的MNIST数图像数据集进行了内部前馈卷积网络测试:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="22e5" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ ./mnistcuDNN</strong><br/>    cuDNNGetVersion() : 7005 , cuDNN_VERSION from cuDNN.h : 7005 (7.0.5)<br/>    Host compiler version : GCC 6.4.0<br/>    There are 1 CUDA capable devices on your machine :<br/>    device 0 : sms 15 Capabilities 6.1, SmClock 1784.5 Mhz, MemSize (Mb) 8116, MemClock 4004.0 Mhz, Ecc=0, boardGroupID=0<br/>    Using device 0<br/>    Testing single precision<br/>    Loading image data/one_28x28.pgm<br/>    Performing forward propagation …<br/>    Testing cuDNNGetConvolutionForwardAlgorithm …<br/>    Fastest algorithm is Algo 1<br/>    Testing cuDNNFindConvolutionForwardAlgorithm …<br/>    ^^^^ cuDNN_STATUS_SUCCESS for Algo 1: 0.027648 time requiring 3464 memory<br/><em class="mh">#… lots of additional lines ...<br/># ... Final few lines should say ...<br/></em>Result of classification: 1 3 5<br/>Test passed!</span></pre><p id="342b" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">厉害！cuDNN在工作。下一项任务…你猜对了。阻止这些包被更新和删除(您可以删除。deb文件也在您的下载中/)我们在之前的MNIST测试中使用的复制样本目录:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="48b1" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ sudo apt-mark hold libcuDNN7 libcuDNN7-dev libcuDNN7-doc</strong> <em class="mh">#These are the three .deb files we installed<br/>    </em>libcuDNN7 set on hold.<br/>    libcuDNN7-dev set on hold.<br/>    libcuDNN7-doc set on hold.<br/><strong class="mj hv">$ rm -r cuDNN_samples_v7/</strong></span></pre><p id="c443" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在我们正进入最后冲刺阶段。是时候安装我们的深度学习框架了。首先是TensorFlow，因为它通常比pytorch更挑剔。</p></div><div class="ab cl ms mt hc mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hn ho hp hq hr"><h1 id="77c7" class="kv kw hu bd kx ky mz la lb lc na le lf ja nb jb lh jd nc je lj jg nd jh ll lm dt translated"><strong class="ak">深度学习框架</strong></h1><p id="2a39" class="pw-post-body-paragraph jz ka hu kb b kc ln iv ke kf lo iy kh ki lp kk kl km lq ko kp kq lr ks kt ku hn dt translated">首先用conda创建一个新的虚拟环境。我称之为“张量流”。下面我对用pip初始化env和在env创建后不安装pip做了一个评论。曾经有(可能仍然有)一个潜在的错误，如果你在创建了一个env之后安装pip，那么不管你是否在一个激活的env中，pip安装都会全局地安装软件包。这是非常不可取的行为。解决方案是用画中画初始化。这个bug现在可能已经减轻了。</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="f1b1" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ cd<br/>$ conda create -n tensorflow python=3.6 pip numpy</strong> <em class="mh">#remember to initialize the env with pip here.<br/># activate your conda environment<br/></em><strong class="mj hv">$ conda source activate tensorflow</strong><br/><em class="mh"># now your user and hostname will be prepended with a (tensorflow) e.g. below<br/># keil@yuki-bot:~$<br/># (tensorflow) keil@yuki-bot:~$</em></span></pre><p id="d8d6" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在对于张量流。我从TensorFlow的<a class="ae mg" href="https://www.tensorflow.org/install/install_linux#the_url_of_the_tensorflow_python_package" rel="noopener ugc nofollow" target="_blank">网站</a>得到了下面的网址。重要的是要确保你正在安装软件包:tensorflow-gpu而不是tensorflow。否则你不会做太多的GPU计算…</p><p id="c5d3" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">我抓取了python 3.6 GPU支持url，在页面底部找到。我们来装吧！</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="92f1" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ pip install — ignore-installed — upgrade</strong> <a class="ae mg" href="https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.8.0-cp36-cp36m-linux_x86_64.whl" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow_gpu-1.8.0-cp36-cp36m-linux_x86_64.whl</a><br/><strong class="mj hv">$ conda list | grep tensor</strong> <em class="mh">#should show something like the following<br/>    </em>tensorboard 1.8.0 &lt;pip&gt;<br/>    tensorflow-gpu 1.8.0 &lt;pip&gt; <em class="mh">#this should say tensorflow-gpu… not tensorflow</em></span></pre><p id="a37a" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在，我们可以通过在控制台中启动python repl并导入tensorflow库来测试tensorflow安装。</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="1138" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ python</strong><br/>    Python 3.6.5 |Anaconda, Inc.| (default, Apr 29 2018, 16:14:5<br/>    [GCC 7.2.0] on linux<br/>    Type “help”, “copyright”, “credits” or “license” for more information.<br/><strong class="mj hv">&gt;&gt;&gt; import tensorflow as tf<br/>&gt;&gt;&gt; hello = tf.constant(‘Hello, TensorFlow!’)<br/>&gt;&gt;&gt; sess = tf.Session()</strong><em class="mh"><br/># some warning messages and other verbose output...</em> tensorflow/core/common_runtime/gpu/gpu_device.cc:1356] Found device 0 with properties:<br/>    name: GeForce GTX 1070 major: 6 minor: 1 memoryClockRate(GHz): 1.7845<br/>    pciBusID: 0000:01:00.0<br/>    totalMemory: 7.93GiB freeMemory: 7.46GiB<br/>    2018–06–18 15:54:49.570548: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1435] Adding visible gpu devices: 0<br/>    2018–06–18 15:54:49.763041: I tensorflow/core/common_runtime/gpu/gpu_device.cc:923] Device interconnect StreamExecutor with strength 1 edge matrix:<br/>    2018–06–18 15:54:49.763069: I tensorflow/core/common_runtime/gpu/gpu_device.cc:929] 0<br/>    2018–06–18 15:54:49.763089: I tensorflow/core/common_runtime/gpu/gpu_device.cc:942] 0: N<br/>    2018–06–18 15:54:49.763303: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1053] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 7205 MB memory) -&gt; physical GPU (device: 0, name: GeForce GTX 1070, pci bus id: 0000:01:00.0, compute capability: 6.1)</span><span id="c238" class="mn kw hu mj b fv no mp l mq mr"><strong class="mj hv">&gt;&gt;&gt; print(sess.run(hello))</strong><br/>    b’Hello, TensorFlow!’<br/><strong class="mj hv">&gt;&gt;&gt; exit()</strong></span></pre><p id="e392" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">很好，看起来都不错。恭喜你，你已经安装了支持GPU的TensorFlow。而且你不需要用APT持有tensorflow，康达负责管理tensorflow的升级。</p><p id="da75" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在停用tensorflow conda env并为pytorch创建一个:</p><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="0f0d" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ source deactivate tensorflow<br/>$ conda create -n pytorch python=3.6 pip numpy<br/>$ conda source activate pytorch</strong></span></pre><p id="f2f0" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">转到pytorch网站，生成一个命令来安装pytorch。下图显示了我选择的选项:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff np"><img src="../Images/0d48e0478177605e0d20571259cfc036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYpNT8kfhy0J58zqrtrHDA.png"/></div></div></figure><pre class="jk jl jm jn fq mi mj mk ml aw mm dt"><span id="ec65" class="mn kw hu mj b fv mo mp l mq mr"><strong class="mj hv">$ conda install pytorch torchvision cuda90 -c pytorch<br/>$ conda list | grep torch</strong><br/><em class="mh"># packages in environment at /home/keil/miniconda3/envs/pytorch:<br/>    </em>cuda90 1.0 h6433d27_0 pytorch<br/>    pytorch 0.4.0 py36_cuda9.0.176_cuDNN7.1.2_1 [cuda90] pytorch<br/>    torchvision 0.2.1 py36_1 pytorch<br/><strong class="mj hv">$ python</strong> <em class="mh">#start the python interpreter to test pytorch for GPU support<br/>    </em>Python 3.6.5 |Anaconda, Inc.| (default, Apr 29 2018, 16:14:56)<br/>    [GCC 7.2.0] on linux<br/>    Type “help”, “copyright”, “credits” or “license” for more information.</span><span id="7b14" class="mn kw hu mj b fv no mp l mq mr"><strong class="mj hv">&gt;&gt;&gt; import torch<br/>&gt;&gt;&gt; torch.cuda.current_device()</strong><br/>    0<br/><strong class="mj hv">&gt;&gt;&gt; torch.cuda.device(0)</strong><br/>    &lt;torch.cuda.device object at 0x7faff01a8860&gt;<br/><strong class="mj hv">&gt;&gt;&gt; torch.cuda.get_device_name(0)</strong><br/>    ‘GeForce GTX 1070’<br/><strong class="mj hv">&gt;&gt;&gt; exit()<br/>$ source deactivate pytorch</strong></span></pre><p id="5475" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">厉害！Pytorch看起来不错。</p><p id="c5de" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">就这样了。你们都完了。您已经安装了tensorflow和pytorch，它们都在自己的conda虚拟env中有GPU支持。你安装了CUDA 9.0，cuDNN 7.0.5，gcc/g++ 6.0，Ubuntu最新的nvidia官方GPU驱动，以及最新的内核头文件。</p><p id="26de" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">希望所有这些对你有用，并且你在这个过程中学到了一些东西。获得GPU对深度学习框架的支持的最大挑战是确保所有不同版本的东西都能很好地协同工作。这只是需要一些研究和阅读Ubuntu，Nvidia，TensorFlow和Pytorch的官方文件。除此之外，大部分都是简单的命令拷贝。</p><p id="d354" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">我发现有用的高质量信息网站是StackExchange，尤其是Nvidia <a class="ae mg" href="https://devtalk.nvidia.com/" rel="noopener ugc nofollow" target="_blank">开发者表单</a>。当阅读在线论坛时，确保信息是最新的。很多答案和问题都是旧的，不再适合。我相信这个帖子很快也会过时。必要时我会尽量更新。</p><p id="a21c" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">感谢你苦读这篇文章。深度学习愉快！</p><p id="8357" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">干杯，</p><p id="8b86" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">狭海峡</p></div></div>    
</body>
</html>