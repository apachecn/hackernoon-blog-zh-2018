<html>
<head>
<title>JS Template Literals on Steroids</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">类固醇上的JS模板文字</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/js-template-literals-on-steroids-679dca679e00?source=collection_archive---------13-----------------------#2018-06-26">https://medium.com/hackernoon/js-template-literals-on-steroids-679dca679e00?source=collection_archive---------13-----------------------#2018-06-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="8c0a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">模板文字就是我们过去称之为“模板字符串”的东西，用于嵌入表达式的字符串插值。这些特性在python和ruby等其他语言中已经存在很长时间了，最初是在ECMAScript 6中引入javascript的。使用模板文字，我们可以把难看的字符串串联在一起，当我们有嵌入的表达式和换行符时使用。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/c2ecc8799e9967e49273ca344f8e9ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wll59rbGg2dZgvb1"/></div></div></figure><h1 id="4b5f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">基本用法</h1><p id="4805" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">最常见的用法是构建一个由字符串和从表达式计算出的值组成的字符串。要在一个字符串中嵌入一个表达式，我们需要做的就是用像<code class="eh le lf lg lh b">${expression}</code>这样的花括号添加表达式。</p><p id="6335" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，要生成带有文本的本地化日期，我们可以编写以下代码:</p><pre class="jq jr js jt fq li lh lj lk aw ll dt"><span id="60b7" class="lm kc hu lh b fv ln lo l lp lq">`Today is ${new Intl.DateTimeFormat('en-US').format(new Date())}`</span></pre><h1 id="5e3e" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">高级用法</h1><p id="ec60" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">这个特性不仅仅是字符串和表达式的组合。我们可以通过实现一个<strong class="it hv">标签函数</strong>来构建最终结果，给定表达式的字符串和值，该标签函数构成最终结果。</p><p id="5db4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Tag functions是另一个允许将构建字符串的逻辑提取到函数中的工具。标签功能可用于HTML转义、本地化、标记、翻译等。我们通过在模板文字表达式之前调用标签函数来使用它，例如<code class="eh le lf lg lh b">fn`Today is ${new Date()}`</code>其中fn是标签函数。</p><h2 id="05db" class="lm kc hu bd kd lr ls lt kh lu lv lw kl jc lx ly kp jg lz ma kt jk mb mc kx md dt translated">实施</h2><p id="f8be" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">标签函数界面看起来像:</p><pre class="jq jr js jt fq li lh lj lk aw ll dt"><span id="b3c5" class="lm kc hu lh b fv ln lo l lp lq">function fn(strings, ...values): string</span></pre><p id="e808" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中<code class="eh le lf lg lh b">strings</code>是由表达式分隔的字符串数组，<code class="eh le lf lg lh b">values</code>是表达式值。例如<code class="eh le lf lg lh b">fn`Today is ${today} and Tomorrow is ${tomorrow}`</code>执行fn作为<code class="eh le lf lg lh b">fn(['Today is ', ' and Tomorrow is '], '6/23/2018', '6/24/2018')</code>。</p><p id="058d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">标签函数的实现应该总是返回一个字符串，例如考虑到<code class="eh le lf lg lh b">strings</code>和<code class="eh le lf lg lh b">values.</code>，在我们可以实现<code class="eh le lf lg lh b">fmtDate</code>标签函数之前，得到一个本地化的而不是本地化的:</p><pre class="jq jr js jt fq li lh lj lk aw ll dt"><span id="b2a0" class="lm kc hu lh b fv ln lo l lp lq">function fmtDate(strings, date) {<br/>  const str0 = strings[0];<br/>  const str1 = strings[1];<br/>  const strDate = new Intl.DateTimeFormat('en-US').format(date);<br/>  return `${str0}${strDate}${str1}`;<br/>}</span><span id="347a" class="lm kc hu lh b fv me lo l lp lq">fmtDate`Today is ${new Date()}`; // <!-- -->“Today is 6/23/2018”</span></pre><p id="a152" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">更进一步，将所有日期本地化:</p><pre class="jq jr js jt fq li lh lj lk aw ll dt"><span id="89f1" class="lm kc hu lh b fv ln lo l lp lq">function fmtVar(v) {<br/>  return (v instanceof Date) ?<br/>    new Intl.DateTimeFormat('en-US').format(v) : v;<br/>}</span><span id="9464" class="lm kc hu lh b fv me lo l lp lq">function fmtString(strings, ...values) {<br/>  return values.reduce((acc, v, idx) =&gt; <br/>    acc + fmtVar(v) + strings[idx + 1], strings[0]);<br/>}</span><span id="86b7" class="lm kc hu lh b fv me lo l lp lq">fmtString`Today is ${today} and tomorrow is ${tomorrow}`; <br/>// <!-- -->“Today is 6/23/2018 and tomorrow is 6/24/2018"</span></pre><p id="5fe1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，在上面的例子中，<code class="eh le lf lg lh b">fmtStrings</code>是一个通用的格式化函数，它可以用来格式化任何使用<code class="eh le lf lg lh b">fmtVar</code>的东西，后者根据类型格式化一个参数。我们可以使用这种组合来格式化我们想要的任何变量。</p><h2 id="9edb" class="lm kc hu bd kd lr ls lt kh lu lv lw kl jc lx ly kp jg lz ma kt jk mb mc kx md dt translated">现有原始数据实现</h2><p id="334e" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">标签函数的常见用法是从模板字符串中获取原始数据。例如<code class="eh le lf lg lh b">first ${'\n'} second</code>实际结果为“第一\n秒”而不换行。我们可以使用<code class="eh le lf lg lh b">String.raw</code>静态方法来做这件事。</p><pre class="jq jr js jt fq li lh lj lk aw ll dt"><span id="1d23" class="lm kc hu lh b fv ln lo l lp lq">String.raw`first ${'\n'} second`; // "first \n second"</span></pre><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mf"><img src="../Images/9ecc2cc5a4548900d39d71a6b7a6051a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FVMYfJ-lm1x4ZEjJ"/></div></div></figure><h1 id="ce75" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">最后</h1><p id="2a5c" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">处理字符串时，模板文字可能是一把散弹枪，不仅用于表达式，还用于组成更复杂的字符串。翻译、本地化等等可以很好地利用这个工具。它甚至可以用作模板引擎，我知道Polymer在提供<code class="eh le lf lg lh b">html`&lt;template&gt;`</code>功能的组件类中创建内嵌组件模板时使用了它。</p><p id="a5ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另一方面，应该非常小心地使用模板文字。标签函数的使用和实现并不是那么直接，可能变得不可预测和难以理解。将它作为工具箱中的另一个工具。</p></div></div>    
</body>
</html>