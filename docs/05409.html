<html>
<head>
<title>How to Build Realtime Updating Leaderboards in Unity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Unity中建立实时更新的排行榜</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-realtime-updating-leaderboards-in-unity-1f30545af17a?source=collection_archive---------21-----------------------#2018-06-27">https://medium.com/hackernoon/how-to-build-realtime-updating-leaderboards-in-unity-1f30545af17a?source=collection_archive---------21-----------------------#2018-06-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0837" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">为什么是排行榜？</strong></p><p id="1719" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">排行榜是视频游戏中最古老的<a class="ae jp" href="https://www.gamasutra.com/blogs/JoeHanson/20180507/317700/Level_Up_Engagement_and_Put_the_Social_in_Multiplayer_Games.php" rel="noopener ugc nofollow" target="_blank">社交功能之一，用于提高玩家之间的竞争水平。全球记分牌产生更长的游戏时间，吸引了大多数玩家。此外，排行榜通过激励玩家获得更高的排名，有助于提高玩家的参与度和忠诚度。如果一个玩家在排名中下滑，他们通常会试图重新确立自己的位置。</a></p><p id="8dd5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以使用PubNub建立排行榜，让<a class="ae jp" href="https://www.pubnub.com/solutions/realtime-updates/" rel="noopener ugc nofollow" target="_blank">实时更新</a>。实时记分很重要，因为它给用户即时反馈，增加了玩家的满意度。</p><h1 id="e4d0" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">建立统一</h1><p id="163a" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">首先，查看我的<a class="ae jp" href="https://github.com/JordanSchuetz/Realtime-Unity-Leaderboards-with-PubNub" rel="noopener ugc nofollow" target="_blank"> GitHub </a>并克隆/下载回购。如果您还没有安装Unity，请在此处安装它<a class="ae jp" href="https://unity3d.com/get-unity/download" rel="noopener ugc nofollow" target="_blank">。repo包含一个包含所有项目文件的Assets文件夹。打开Unity，进入<strong class="it hv">文件- &gt;打开项目</strong>，选择文件夹。在Unity中加载项目需要一些时间。完成后，打开您的<strong class="it hv">项目</strong>选项卡中的Assets文件夹，双击</a><a class="ae jp" href="https://hackernoon.com/tagged/leaderboard" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">排行榜</strong> </a> Unity场景。</p><p id="6f69" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您点击<strong class="it hv">排行榜</strong>场景时，您应该会看到:</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/0f3e3b17df16b3a52b6e40a6f5ee64dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zpm-Iw0AQvOrq-RV.png"/></div></div></figure><p id="e805" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要尝试演示，请单击顶部的播放按钮。</p><p id="034b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果出现以下错误，请按照以下步骤操作:</p><blockquote class="lf lg lh"><p id="2c27" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated"><em class="hu">无法加载场景“排行榜”,因为它尚未添加到构建设置或资产包尚未加载。</em></p></blockquote><p id="47e5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要解决这个问题，请转到<strong class="it hv">文件- &gt;构建设置</strong>。点击<strong class="it hv">添加开放场景</strong>按钮。然后回到你的项目选项卡，双击<strong class="it hv">排行榜</strong>，回到你的构建设置，再次点击<strong class="it hv">添加开放场景</strong>。然后在您的项目选项卡中，再次双击排行榜场景并运行项目。</p><h1 id="656e" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">运行项目</h1><p id="5dd3" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">现在你的项目已经设置好了，点击<strong class="it hv"> Run </strong>按钮。当您运行项目时，PubNub <a class="ae jp" href="https://github.com/JordanSchuetz/Realtime-Unity-Leaderboards-with-PubNub/blob/master/Assets/leaderBoard.cs#L52" rel="noopener ugc nofollow" target="_blank">触发消息</a>被发送到PubNub函数。在下面的截图中可以看到，当<a class="ae jp" href="https://www.pubnub.com/docs/blocks/tutorials/kv-store" rel="noopener ugc nofollow" target="_blank"> KV Store </a>中没有存储分数时，它会用“未设置”填写每一个未填写的条目。下面我将通过输入用户名和分数向KV商店添加更多条目。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/3b86a899fddfb726d9292c626eef5b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4iLhlwzag6F3KZ8i.png"/></div></div></figure><p id="1f0e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们添加更多条目。劳拉、詹姆斯和鲍勃刚刚被添加到下面的高分名单中。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/a9274294c601385e138b133c8185a32a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q1bWoK9rmow-yhQW.png"/></div></div></figure><p id="acea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们把斯蒂芬加入名单。如您所见，由于他的得分高于Bob，但低于James，因此他排名第五。所有连接到<a class="ae jp" href="https://hackernoon.com/tagged/game" rel="noopener ugc nofollow" target="_blank">游戏</a>的玩家将会看到这个分数的实时更新。这个逻辑是在PubNub函数中使用KV存储和数组排序完成的。单击下面的“尝试我们的演示”按钮，了解它是如何工作的。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/a7c1888d0ea04d009a5339ab528bfe24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8PA1CpRifwdrKmHw.png"/></div></div></figure><figure class="ku kv kw kx fq ky fe ff paragraph-image"><a href="https://jordanschuetz.github.io/Realtime-Unity-Leaderboards-with-PubNub/webgldemo/index.html"><div class="fe ff lm"><img src="../Images/b8c562b6badc1efc450fdadbf73311b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*40jD9e46d1Y9oMpO.png"/></div></a></figure><p id="ea2c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="li">打开两个窗口实时查看高分更新</em></p><h1 id="9338" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">它是如何工作的？</h1><p id="3a57" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">创建排行榜可能是一项复杂的任务，因为当新分数添加到列表中时，您希望所有用户都能看到相同的信息。使用PubNub和PubNub函数可以无缝地为您的应用程序创建自定义排行榜。</p><p id="b43e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在主文件夹中，我创建了一个名为<a class="ae jp" href="https://github.com/JordanSchuetz/Realtime-Unity-Leaderboards-with-PubNub/blob/master/Assets/leaderBoard.cs" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">排行榜</strong> </a> <strong class="it hv"> </strong>的脚本，用于处理所有数据的发送和接收。在<strong class="it hv"> Start() </strong>函数中，我们首先定义一些组件和变量。当前演示使用的是我的个人pub/sub键。您必须进入并替换您自己的pub/sub键，您可以在<a class="ae jp" href="https://dashboard.pubnub.com/login" rel="noopener ugc nofollow" target="_blank"> PubNub管理仪表板</a>中找到这些键。在管理仪表板中创建一个新应用程序，并将您的发布/订阅密钥复制到<strong class="it hv"> leaderBoard.cs </strong>代码中。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/88085641a5c475a9d6e0fa11bc386560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QCfxu2zmLm2hui0l.png"/></div></div></figure><p id="c2fe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在上面的代码中，我们将每个玩家的UUID设为一个随机数。但是，如果您正在创建您的游戏，您会希望将此号码与一个唯一的用户名相关联，这样人们就不会在您的实时排行榜中使用相同的用户名。</p><p id="debd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面的代码是整个<strong class="it hv"> leaderBoard.cs </strong>文档。当脚本第一次运行时，它初始化PubNub，并向PubNub函数发送一个Fire消息。这个fire对象告诉函数发送回存储在数据库(KV Store)中的最新数据。当客户端从PubNub函数得到响应时，它运行<strong class="it hv"> pubnub。SubscribeCallback </strong>并遍历字典，替换自上次更新以来发生变化的任何数据。</p><p id="32b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> TaskOnClick </strong>函数获取您在输入字段中输入的信息，并将该数据发布到PubNub函数，然后该函数更新当前订阅了<strong class="it hv"> my_channel2 </strong>的所有客户端。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff ln"><img src="../Images/c95482bbd39761ffdf00747fa413cb4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YILFIEReJ4DdwHQaKPn3Gg.png"/></div></div></figure><p id="4afe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了让排行榜起作用，我们现在必须设置一个PubNub函数。要创建一个函数，请转到PubNub管理仪表板，然后单击您的应用程序。在左侧，单击Functions按钮，并创建一个新模块。确保您正在收听正确的频道名称，在本例中，我将我的频道称为“<strong class="it hv"> my_channel </strong>”。</p><p id="6af4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在函数中，我们首先必须导入KV Store和PubNub依赖项。接下来，我们<strong class="it hv"> JSON </strong>解析从Unity客户端收到的消息，并将消息内容放入名为username和score的变量中。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/a98d7f2f3d95e482fb8497f3ed443d43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1LGvBGn5kdyV6TMt.png"/></div></div></figure><p id="9cc7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们使用<strong class="it hv"> db.get </strong>来检查KV存储器中是否存储了任何数据。如果没有，我们使用<strong class="it hv"> db.set </strong>创建一个字符串格式来表示数据的结构。一旦数据在KV存储中，我们使用<strong class="it hv">value . score . some(item =&gt;{ })遍历数组；。</strong>我们使用原型，因为我们希望能够在循环结束时返回true，以便在条目被正确替换后取消循环。当循环完成时，它通过发送pubnub.publish消息将新的更新值发送给订阅了<strong class="it hv"> my_channel2 </strong>的所有客户端。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lo"><img src="../Images/ad1d40edb599edba20842abd237224eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XEyo1wJOmLqSoWh2_EOz4g.png"/></div></div></figure><p id="2303" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就这样，伙计们！使用PubNub和Unity创建自定义排行榜超级简单。</p><h1 id="b865" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">调试和构建</h1><p id="426b" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">当您开始构建您的项目时，您可能会遇到这样一个错误:</p><pre class="ku kv kw kx fq lp lq lr ls aw lt dt"><span id="068f" class="lu jr hu lq b fv lv lw l lx ly">error CS0234: The type or namespace name 'TestTools' does not exist in the namespace 'UnityEngine'. Are you missing a reference? CS0246: The type or namespace name 'NUnit' could not be found. Are you missing an assembly reference?</span></pre><p id="0145" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要解决这个问题，请转到:窗口-&gt;测试运行程序-&gt;选择播放模式</p><p id="2a2c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将被要求启用播放模式。然后重置编辑器。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/11d1c37ccc4c94d7606fe8b1a04dae36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5VvWBsr-JFlOxeiK.png"/></div></div></figure><p id="3424" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，当您开始构建项目时，这些错误应该会被删除。</p><h1 id="2ac7" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">包扎</h1><p id="8141" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">用Unity来设置PubNub简单而无缝。此外，如果您有数百万用户同时玩您的游戏，PubNub可以扩展并支持该延迟和流量。要下载Unity SDK，请访问我们的<a class="ae jp" href="https://www.pubnub.com/docs/unity3d-c-sharp/pubnub-c-sharp-sdk" rel="noopener ugc nofollow" target="_blank"> Unity文档</a>。你可以在我的<a class="ae jp" href="https://github.com/JordanSchuetz/Realtime-Unity-Leaderboards-with-PubNub" rel="noopener ugc nofollow" target="_blank"> GitHub这里</a>下载我的演示项目。感谢阅读干杯！</p></div><div class="ab cl lz ma hc mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hn ho hp hq hr"><p id="f7ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">【www.pubnub.com】最初发表于<a class="ae jp" href="https://www.pubnub.com/blog/realtime-highscores-leaderboards-in-unity/" rel="noopener ugc nofollow" target="_blank"><em class="li"/></a><em class="li">。</em></p><figure class="ku kv kw kx fq ky"><div class="bz el l di"><div class="mg mh l"/></div></figure></div></div>    
</body>
</html>