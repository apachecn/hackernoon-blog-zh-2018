<html>
<head>
<title>I’m a College Student, and I’m Still Building my Robo-Advisor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是一名大学生，我还在建造我的机器人顾问</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/im-a-college-student-and-i-m-still-building-my-robo-advisor-928110fe5bf1?source=collection_archive---------7-----------------------#2018-06-28">https://medium.com/hackernoon/im-a-college-student-and-i-m-still-building-my-robo-advisor-928110fe5bf1?source=collection_archive---------7-----------------------#2018-06-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b9c5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">所有用于设置的代码和外部指令等。可以在</em> <a class="ae jq" href="https://hackernoon.com/tagged/github" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> GitHub </em> </a> <em class="jp">资源库</em> <a class="ae jq" href="https://github.com/alpacahq/roboadvisor" rel="noopener ugc nofollow" target="_blank"> <em class="jp">这里找到。</em> </a> <em class="jp">这是一个帖子，是Quantopian中</em><a class="ae jq" href="https://hackernoon.com/tagged/robo-advisor" rel="noopener ugc nofollow" target="_blank"><em class="jp">robo advisor</em></a><em class="jp">的续篇。你可以在Hackernoon </em> <a class="ae jq" href="https://hackernoon.com/i-am-a-college-student-and-i-built-my-own-robo-advisor-3f31b39dab50" rel="noopener ugc nofollow" target="_blank"> <em class="jp">这里</em> </a> <em class="jp">找到第一部分，或者在羊驼的博客</em> <a class="ae jq" href="https://blog.alpaca.markets/blog/2018/6/8/i-am-a-college-student-and-i-built-my-own-roboadvisor" rel="noopener ugc nofollow" target="_blank"> <em class="jp">这里</em> </a> <em class="jp">。</em></p><div class="jr js fm fo jt ju"><a href="https://blog.alpaca.markets/blog/2018/6/8/i-am-a-college-student-and-i-built-my-own-roboadvisor" rel="noopener  ugc nofollow" target="_blank"><div class="jv ab ej"><div class="jw ab jx cl cj jy"><h2 class="bd hv fv z el jz eo ep ka er et ht dt translated">我是一名大学生，我建立了自己的机器人顾问</h2><div class="kb l"><h3 class="bd b fv z el jz eo ep ka er et ek translated">我叫饶，是羊驼的一名实习生，致力于构建一个开源的robo advisor。我在…方面没有太多经验</h3></div><div class="kc l"><p class="bd b gc z el jz eo ep ka er et ek translated">博客.羊驼.市场</p></div></div><div class="kd l"><div class="ke l kf kg kh kd ki kj ju"/></div></div></a></div><p id="d426" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大家好，我是羊驼的实习生饶。大约两周前，我在HackerNoon上发表了一篇关于我一直在研究的机器人顾问的文章。在过去的两周里，我把工作转移到了线下，用Zipline推动开发。在那段时间里，我学到了一些技巧和诀窍，我想与你分享。</p><figure class="kl km kn ko fq kp fe ff paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="fe ff kk"><img src="../Images/86a1809f2edb852b30031e5befa67518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQ3-q8aqVHZ4_4AIBODbvA.jpeg"/></div></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">I’m…still…working…</figcaption></figure><h1 id="7173" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">滑索——什么，什么时候，为什么，在哪里，如何？</h1><p id="293b" class="pw-post-body-paragraph ir is hu it b iu lx iw ix iy ly ja jb jc lz je jf jg ma ji jj jk mb jm jn jo hn dt translated">我们现在已经在Quantopian上创建了一个功能性的robo advisor。但是，IDE限制了我们工作的规模和复杂性。为了进一步扩展这个机器人顾问，最好是用Zipline在本地做我们未来的工作。</p><p id="0d74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种转变提供了优势。我们可以使用多个文件、配置文件，并像开发任何其他python应用程序一样开发出robo-advisor。摆脱单一的文件格式意味着我们的工作可以更有条理，单个的功能不那么臃肿(后面会详细介绍)。</p><p id="0622" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，这不是所有的玫瑰。在Zipline中开发也有自己的挑战。但是，如果我能做到，你也能！</p><p id="d577" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本地机器上安装zipline并不像“pip install zipline”那么简单。它有几个依赖项，每个操作系统略有不同。您可以在这里找到所有必要的安装说明<a class="ae jq" href="http://www.zipline.io/install.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="f137" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在安装过程中犯了几个错误，所以我建议您在虚拟环境中运行zipline，或者按照我的个人喜好，在Docker容器中运行。我已经附上了完成的容器和相应的Dockerfile文件。花些时间，弄清楚你的开发环境。准备好了吗？让我们开始吧。</p><h1 id="0c99" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">Zipline命令—捆绑和执行</h1><p id="e3b7" class="pw-post-body-paragraph ir is hu it b iu lx iw ix iy ly ja jb jc lz je jf jg ma ji jj jk mb jm jn jo hn dt translated">在本地打开新的python文件。从Quantopian IDE中复制并粘贴您的代码。现在，我们准备好了——拉着你走。我们还没有准备好。Quantopian的IDE是一个很棒的开发环境。它负责后台进程，让您可以专注于您的算法。</p><p id="579f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们需要历史数据来运行我们的算法。Zipline使用一种叫做bundles的东西来读取数据。要使用这些包，需要首先接收它们，这可以使用以下命令来完成:</p><pre class="kl km kn ko fq mc md me mf aw mg dt"><span id="1e5a" class="mh la hu md b fv mi mj l mk ml">$zipline ingest -b &lt;bundle&gt;</span></pre><p id="211b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Zipline提供了两个包，quandl和quantopian-quandl。要接收quandl，您需要创建一个帐户，然后获得一个API密钥。你不需要为quantopian-quandl。Zipline还提供了通过编写自定义摄取函数来创建自定义包的选项。这将留待以后的文章讨论。</p><p id="b56f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Quandl和quantopian-quandl都不提供ETF数据，所以我提供了一个定制的羊驼捆绑包。本地安装这个包的说明可以在GitHub repository readme中找到。</p><p id="e28f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用以下格式运行zipline代码:</p><pre class="kl km kn ko fq mc md me mf aw mg dt"><span id="914d" class="mh la hu md b fv mi mj l mk ml">$zipline run -f &lt;filename&gt; -b &lt;bundle&gt; --start &lt;date&gt; --end &lt;date&gt;</span></pre><p id="4593" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以看到Quantopian的许多GUI输入都是使用Zipline从命令行配置的。</p><h2 id="c8ba" class="mh la hu bd lb mm mn mo lf mp mq mr lj jc ms mt ln jg mu mv lr jk mw mx lv my dt translated">码头集装箱:</h2><p id="6322" class="pw-post-body-paragraph ir is hu it b iu lx iw ix iy ly ja jb jc lz je jf jg ma ji jj jk mb jm jn jo hn dt translated">我创建了一个运行python 3.6的docker容器，安装了zipline和必要的依赖项。如果您对在本地安装zipline犹豫不决，您可以从<a class="ae jq" href="https://hub.docker.com/r/alpacamarkets/roboadvisor/" rel="noopener ugc nofollow" target="_blank"> docker hub </a>中取出容器，并在环境中进行试验。</p><p id="49b0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用以下命令运行映像:</p><pre class="kl km kn ko fq mc md me mf aw mg dt"><span id="7863" class="mh la hu md b fv mi mj l mk ml">$docker run -it alpaca/roboadvisor /bin/bash</span></pre><h1 id="fdaa" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">第一个滑索例子——买入并持有</h1><p id="b8e6" class="pw-post-body-paragraph ir is hu it b iu lx iw ix iy ly ja jb jc lz je jf jg ma ji jj jk mb jm jn jo hn dt translated">就像我最初投资Quantopian一样，我用简单的买入并持有策略投资了Zipline。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="mz na l"/></div></figure><p id="b042" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是一些需要记住的区别。首先，所有自定义功能，如订单、符号等。不再自动包含，必须手动导入(<em class="jp">从zipline.api导入* </em>)。接下来，这是相当愚蠢的，但现在我们不在Quantopian的IDE中，我们不再使用log.info来跟踪事务，而是打印语句。</p><p id="5600" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们使用前面的格式运行代码，并从1月到6月运行测试:</p><pre class="kl km kn ko fq mc md me mf aw mg dt"><span id="fe43" class="mh la hu md b fv mi mj l mk ml">$zipline run -f buy-and-hold.py -b alpaca --start 2018-01-01 --end 2018-06-01</span></pre><p id="20a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果没有语法错误，Zipline会吐出一大堆数据。我们怎么知道我们是对的？滚动直到从STDOUT中找到下表:</p><figure class="kl km kn ko fq kp fe ff paragraph-image"><div class="fe ff nb"><img src="../Images/8f28e2e925418a93aaa9ee0a74393a2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*01NMJgMlPSQk9DeoqlhSbg.png"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Look at the cumulative alpha value from the last simulated trading day (2018–06–01)</figcaption></figure><p id="2b93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">找到累积的alpha值(相对于基准的性能)，并将其与在Quantopian上运行相同算法时的累积alpha值进行比较。它们应该是非常相似的值。</p><p id="e4de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们已经很好地了解了Zipline是如何工作的，所以我们可以继续实现我们的单宇宙算法的其余部分(距离计算和重新平衡)。我花了一整篇文章来讨论这个实现，所以我认为没有必要重新讨论它。如果你还没有读过那本书，我建议你读一读——这是一本很棒的书！(完全公正的观点)</p><h1 id="86b7" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">多重宇宙</h1><p id="27b9" class="pw-post-body-paragraph ir is hu it b iu lx iw ix iy ly ja jb jc lz je jf jg ma ji jj jk mb jm jn jo hn dt translated">在上一篇文章中，我展示了如何通过在initialize函数中添加多个字典来扩展算法，以覆盖所有可能的先锋宇宙。但是，如果我们想实现所有六个先锋宇宙，我们将完成一个臃肿的摄取功能，这看起来并不漂亮。</p><p id="2406" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但现在我们离开了量子乌托邦，来到了高空滑索！我们可以将代码分布在多个文件中，所以让我们开始吧。</p><p id="5269" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了被算法使用，一个宇宙需要两组信息。第一个是符号集，第二个是基于风险的权重分布。从符号函数的工作方式来看，每个宇宙的符号列表都需要在初始化函数中设置。</p><p id="e707" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，权重是没有绑定到任何zipline.api函数的字典，所以我们实际上可以在一个单独的文件中配置它们。ConfigParser包可以读入存储在外部。ini文件。更重要的是，它以类似于字典(键/值)的结构存储数据，并且易于调用和组织。</p><p id="7b2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们需要安装软件包:</p><pre class="kl km kn ko fq mc md me mf aw mg dt"><span id="e32d" class="mh la hu md b fv mi mj l mk ml">$pip3 install ConfigParser</span></pre><p id="17e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装好软件包后，就可以创建INI文件了。INI文件包含基于风险级别的分配信息。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="mz na l"/></div></figure><p id="4eb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">INI文件被分成几个部分，新的部分由括号中的部分标题描述。章节标题很像字典中的一个键，是组织输入的一种有用的方式。这个文件把每一个先锋宇宙都组织成了自己的一部分。如果你想添加你自己的宇宙，叉出要点，用括号内的宇宙名称创建一个新的部分，并在它下面列出信息。</p><p id="3fc6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">机器人顾问的算法将输入解析为字典。虽然INI文件的工作方式很像一个字典，但是我们仍然需要编写一个函数来将它翻译成字典。</p><pre class="kl km kn ko fq mc md me mf aw mg dt"><span id="559b" class="mh la hu md b fv mi mj l mk ml">def section_to_dict(section):<br/>    config = ConfigParser()<br/>    config.read('universe-config.ini')<br/>    out_dict = {}<br/>    for key in config[section]:<br/>        out_dict[int(key)] = ast.literal_eval(config[section][key])<br/>    return(out_dict)</span></pre><p id="dc1a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">configparser被初始化，然后读取给定的INI文件。读取的部分作为用户输入给出。如果我们回头参考INI文件，我们会看到值采用key = value的形式。所以就像字典一样，我们可以遍历INI部分的关键字。在每种情况下，每个键/值对都被添加到字典中。(<em class="jp">注意:如果你收到一个密钥错误，那是因为你的config.ini文件的路径是错误的</em></p><p id="8993" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有两件事需要注意。在INI文件中，一切都是字符串，但是我们的算法期望一个整数/元组键值对。对于键，将它们转换成整数就足够了，但是对于元组，我们必须对值进行解串。为此，我发现ast.literal_evalto是效果最好的函数。</p><p id="296e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，让我们将这种检索基于权重的分配的新方法与我们的robo-advisor算法相结合:</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="mz na l"/></div></figure><p id="3f57" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经在初始化中列出了每个宇宙的所有符号。这个宇宙的权重是通过在INI文件的适当部分调用section_to_dict来确定的。</p><p id="4eed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，您可以随意添加任意数量的宇宙！</p><h1 id="e3d6" class="kz la hu bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">下一步是什么？</h1><p id="63da" class="pw-post-body-paragraph ir is hu it b iu lx iw ix iy ly ja jb jc lz je jf jg ma ji jj jk mb jm jn jo hn dt translated">从这里开始，我对可视化Zipline回溯测试的所有输出数据感兴趣。在我的下一篇文章中，我希望探索原始数据中不同的可视化效果。</p><p id="56b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">由</em> <a class="ae jq" rel="noopener" href="/@raobvinnakota">到<em class="jp">饶</em>到</a></p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="nc na l"/></div></figure></div><div class="ab cl nd ne hc nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="hn ho hp hq hr"><figure class="kl km kn ko fq kp fe ff paragraph-image"><a href="https://medium.com/automation-generation"><div class="fe ff nk"><img src="../Images/4d7d212ef68dd071daeaae0916d72f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgwdHnaQXAnW0LtrVSpdMA.png"/></div></a></figure><h2 id="0a5c" class="mh la hu bd lb mm mn mo lf mp mq mr lj jc ms mt ln jg mu mv lr jk mw mx lv my dt translated">请关注<a class="ae jq" rel="noopener" href="/@alpacahq">羊驼</a>和<a class="ae jq" href="https://medium.com/automation-generation" rel="noopener">自动化生成</a>关于金融市场、算法交易、技术的新帖子。</h2><h2 id="175e" class="mh la hu bd lb mm mn mo lf mp mq mr lj jc ms mt ln jg mu mv lr jk mw mx lv my dt translated">你可以找到我们<a class="ae jq" href="https://twitter.com/AlpacaHQ" rel="noopener ugc nofollow" target="_blank">@羊驼HQ </a>，如果你用twitter的话。</h2><figure class="kl km kn ko fq kp fe ff paragraph-image"><a href="https://medium.com/automation-generation"><div class="fe ff nl"><img src="../Images/cdfe4e1b3df7ff7b28e2474ff8dfef1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xnDRs1aVpqUjToFRmk5Zw.png"/></div></a></figure></div><div class="ab cl nd ne hc nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="hn ho hp hq hr"><p id="0589" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你是一名黑客，并且可以创造一些在金融市场中工作的很酷的东西，<strong class="it hv">请查看我们的项目“</strong> <a class="ae jq" href="https://alpaca.markets/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=strategy_list&amp;utm_content=part1" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">无佣金股票交易API </strong> </a> <strong class="it hv">”,在那里我们免费提供简单的REST交易API和实时市场数据。</strong></p><p id="dfc5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经纪服务由FINRA/SIPC成员羊驼证券有限责任公司(<a class="ae jq" href="https://alpaca.markets/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=strategy_list&amp;utm_content=part1" rel="noopener ugc nofollow" target="_blank">羊驼.市场</a>)提供。羊驼证券有限责任公司是AlpacaDB，Inc .的全资子公司。</p></div><div class="ab cl nd ne hc nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="hn ho hp hq hr"><p id="67a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">特别感谢Hitoshi、Yoshi和其他羊驼队成员在我设计滑索和Docker时提供的所有帮助和技术支持。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="nm na l"/></div></figure></div></div>    
</body>
</html>