<html>
<head>
<title>React-SASS-PM2-EC2-Production-App mapped with a custom domain and secured with SSL layer.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">react-SASS-PM2-EC2-Production-App使用自定义域进行映射，并使用SSL层进行保护。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/react-sass-pm2-ec2-production-app-mapped-with-a-custom-domain-and-secured-with-ssl-layer-c678e752a4ab?source=collection_archive---------7-----------------------#2018-06-30">https://medium.com/hackernoon/react-sass-pm2-ec2-production-app-mapped-with-a-custom-domain-and-secured-with-ssl-layer-c678e752a4ab?source=collection_archive---------7-----------------------#2018-06-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="9bb2" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">在本教程中，我们将使用<a class="ae jj" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>创建一个示例react应用程序，在其中配置SASS并将其上传到GitHub，在EC2中部署应用程序，配置DNS和Nginx，最后我们将映射我们的自定义域并为其添加SSL层。</h2></div><p id="3172" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">更清楚地说，这是我们现在要学习的议程。</p><ol class=""><li id="de91" class="kg kh hu jm b jn jo jq jr jt ki jx kj kb kk kf kl km kn ko dt translated">创建React应用</li><li id="252a" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">配置SASS</li><li id="8ff2" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">在GitHub上传我们的代码</li><li id="3470" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">在EC2实例中配置SSH访问</li><li id="0c93" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">PM2构型</li><li id="ef42" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">EC2配置</li><li id="35fe" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">DNS配置—(域强制)</li><li id="701c" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">Nginx配置</li><li id="cc26" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">部署应用程序</li><li id="6009" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">使用“让我们加密”添加SSL证书</li></ol><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff ku"><img src="../Images/eacd77212af66fab22fe81579dc1e799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ynI6TcTzZpKlVx_HkRYwOw.png"/></div></div></figure><h2 id="d968" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">创建React应用</h2><p id="e81d" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">让我们使用<a class="ae jj" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>创建一个基本的react应用程序</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="09da" class="lg lh hu mh b fv ml mm l mn mo">$ npx create-react-app react-sass-pm2-production-app<br/>$ cd react-sass-pm2-production-app<br/>$ npm start</span></pre><p id="8558" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在，您将被自动重定向到<a class="ae jj" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>，在这里您将看到您的react应用程序在几秒钟内构建完成。</p><h2 id="bc99" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">配置SASS</h2><p id="2373" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">在<code class="eh mp mq mr mh b">src</code>文件夹中创建一个名为<code class="eh mp mq mr mh b">styles</code>的文件夹，并在其中创建一个名为<code class="eh mp mq mr mh b">style.sass</code>的文件。</p><p id="afd1" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">SASS文件应该被正确地转换成CSS。只有完全符合要求的SASS文件才能被转换。所以我将安装一个名为<a class="ae jj" href="https://github.com/badsyntax/SassBeautify" rel="noopener ugc nofollow" target="_blank">SASS美化</a>的包，它将使用一个特殊的命令来美化我们的SASS文件。</p><p id="43b3" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果你正在使用Sublime文本编辑器，请击掌。我将一步一步地指导你安装和配置它。</p><p id="240c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">其他人——请原谅我。这些只是可选的，你甚至可以手动编写代码。但是，我建议您在编辑器中配置相同的包，以使您的代码更加完美。</p><p id="ed76" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">打开你的sublime，按下<code class="eh mp mq mr mh b">Cmd+Shift+P</code>，输入<code class="eh mp mq mr mh b">Install Package</code>，按下回车键，打开安装包菜单。现在输入sass美化并按回车键安装软件包。</p><p id="cf1f" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这个插件使用<code class="eh mp mq mr mh b">sass-convert</code>，所以你需要安装sass。阅读<a class="ae jj" href="http://sass-lang.com/download.html" rel="noopener ugc nofollow" target="_blank"> sass下载页面</a>查看安装选项。</p><p id="188f" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">就是这样。您已经配置了您的美化包。我们来加点代码，美化一下。</p><p id="5b70" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在此之前，让我们指定命令运行萨斯美化打算和保存。这个插件没有设置任何默认的键绑定，因此你需要自己指定。</p><p id="46a7" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在您的键映射文件(首选项&gt;&gt;键绑定-用户)中，添加一个下面的自定义键绑定并保存它。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="7cc7" class="lg lh hu mh b fv ml mm l mn mo">[<br/>    {<br/>        "keys": ["alt+w"],<br/>        "command": "sass_beautify"<br/>    }<br/>]</span></pre><p id="2ef5" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在，将下面的代码粘贴到您的<code class="eh mp mq mr mh b">style.sass</code>文件中，并按下<code class="eh mp mq mr mh b">alt+w</code>键，以自动保存文件。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="8676" class="lg lh hu mh b fv ml mm l mn mo">$font-stack:    Helvetica<strong class="mh hv">,</strong> sans-serif<br/>$primary-color: #333<br/><br/>body<br/>  <strong class="mh hv">font</strong>: 100% $font-stack<br/>  <strong class="mh hv">color</strong>: $primary-color</span></pre><p id="731c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">您可以看到文件的目的和保存。</p><p id="dace" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果您无意中看到以下错误，</p><p id="df80" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><code class="eh mp mq mr mh b"><strong class="jm hv">There was an error beautifying your Sass:/System/Library/Frameworks/Ruby.framework/Versions/2.3/usr/lib/ruby/2.3.0/universal-darwin17/rbconfig.rb:214:</strong></code></p><p id="fe0e" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这意味着有一些行打算使用<code class="eh mp mq mr mh b">tab</code>键。让我们通过使用<code class="eh mp mq mr mh b">Cmd+A</code>选项选择sass文件中的所有内容，点击空格(在Sublime中右下角可用)并选择<code class="eh mp mq mr mh b">Convert Indentation to Spaces</code>，将其转换为空格。</p><p id="e065" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在你可以成功地美化你的代码了。</p><p id="a7c5" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">让我们进一步配置，在保存时自动将我们的SASS文件转换成CSS文件。</p><p id="0efa" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">打开一个新的终端，在你的根目录下，给出下面的命令并按下<code class="eh mp mq mr mh b">enter</code>键。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="e462" class="lg lh hu mh b fv ml mm l mn mo">$ sudo sass --watch src/styles/:public/stylesheets/</span></pre><p id="8466" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在你可以看到你的sass，如果你在等待修改，一旦你按下<code class="eh mp mq mr mh b">alt+w</code>你就可以把你的Sass文件保存并转换成CSS文件。</p><p id="badd" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在打开<code class="eh mp mq mr mh b">public</code>文件夹中的<code class="eh mp mq mr mh b">index.html</code>文件，添加下面的链接标签来引用你转换后的css文件。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="9582" class="lg lh hu mh b fv ml mm l mn mo">&lt;link rel="stylesheet" type="text/css" href="%PUBLIC_URL%/stylesheets/style.css"&gt;</span></pre><p id="92a5" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">您已经成功配置了SASS。</p><h2 id="7eda" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">在GitHub上传我们的代码</h2><p id="aa91" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">在初始设置过程中，需要遵循几个步骤。因此，让我们从创建一个SSH密钥开始，从您的本地机器认证您的GitHub帐户。</p><p id="006e" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">总共有两种类型的认证，称为<code class="eh mp mq mr mh b">SSH</code>和<code class="eh mp mq mr mh b">HTTPS</code>。</p><p id="f985" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这是一个一次性过程，我们不想使用<code class="eh mp mq mr mh b">HTTPS</code>选项进行身份验证，因为每当我们从您的机器拉取、推送或提交时，我们都需要提供我们的凭据。</p><p id="443d" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">SSH认证机制如下。</p><ol class=""><li id="60a5" class="kg kh hu jm b jn jo jq jr jt ki jx kj kb kk kf kl km kn ko dt translated">生成新的SSH密钥。</li><li id="34a2" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">将您的ssh密钥添加到SSH代理中</li><li id="d8e0" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">将SSH密钥添加到您的GitHub帐户</li></ol><p id="7a37" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jm hv">步骤1:生成新的SSH密钥。</strong></p><p id="6e08" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">打开终端并导航到默认的<code class="eh mp mq mr mh b">ssh</code>文件夹位置。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="349a" class="lg lh hu mh b fv ml mm l mn mo">$ cd ~/.ssh/ #To navigate to your default SSH key location.</span></pre><p id="b056" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">粘贴以下文本，替换为您的GitHub电子邮件地址。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="5b4a" class="lg lh hu mh b fv ml mm l mn mo">$ ssh-keygen -t rsa -b 4096 -C "<em class="ms">your_email@example.com</em>"</span></pre><p id="c70a" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这将创建一个新的ssh密钥，使用提供的电子邮件作为标签。</p><p id="b45b" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">当提示您“输入保存密钥的文件”时，请按Enter键。这接受默认的文件位置。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="528d" class="lg lh hu mh b fv ml mm l mn mo">Enter a file in which to save the key (/Users/<em class="ms">you</em>/.ssh/id_rsa): <em class="ms">[Press enter]</em></span></pre><p id="1a3f" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在提示符下，按enter键两次，不输入任何密码。就这样，您已经成功地创建了名为<code class="eh mp mq mr mh b">id_rsa</code>的SSH密钥。</p><p id="e067" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jm hv">步骤2:将您的SSH密钥添加到ssh-agent </strong></p><p id="ee30" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在后台启动ssh-agent。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="e784" class="lg lh hu mh b fv ml mm l mn mo">$ eval "$(ssh-agent -s)"</span></pre><p id="7860" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">将您的ssh私有密钥添加到SSH代理中。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="01aa" class="lg lh hu mh b fv ml mm l mn mo">$ ssh-add -K ~/.ssh/id_rsa</span></pre><p id="f5f8" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jm hv">第三步:给你的GitHub账户添加一个新的SSH密钥</strong></p><p id="e902" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">将SSH密钥复制到剪贴板。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="5179" class="lg lh hu mh b fv ml mm l mn mo">$ pbcopy &lt; ~/.ssh/id_rsa.pub<br/># Copies the contents of the id_rsa.pub file to your clipboard</span></pre><p id="1e8f" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果没有pbcopy，可以使用任何编辑器打开该文件并复制其全部内容。我使用sublime，如果你想在sublime编辑器中打开上面的文件，发出下面的命令。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="6408" class="lg lh hu mh b fv ml mm l mn mo">$ subl ~/.ssh/id_rsa.pub <br/># Either issue this or above command. Don't execute both.</span></pre><p id="7f3c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">复制文本。</p><p id="aaad" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在，让我们转到我们的GitHub帐户并粘贴密钥。导航到您的GitHub帐户设置并点击<code class="eh mp mq mr mh b">SSH and GPG keys</code>。(参考图片)。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff mt"><img src="../Images/7bbfea0a2ea83ed8de8ca3e9dea54f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXbR2g9mhfXsjkg-kFpUYA.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">Note the Highlighted text.</figcaption></figure><p id="a481" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">单击左上角的New SSH key按钮，添加您的SSH密钥。</p><p id="7126" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">根据你的意愿给出标题，将复制的文本粘贴到关键部分并添加关键。</p><p id="5c74" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">就是这样。现在，您已经通过身份验证，可以从您的终端执行GitHub帐户中的操作。让我们推送我们的代码，稍后在EC2中部署它。</p><p id="85d7" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">让我们在GitHub中为我们的应用程序创建一个存储库。</p><p id="85f5" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在您的GitHub帐户中创建存储库，或点击此<a class="ae jj" href="https://github.com/new" rel="noopener ugc nofollow" target="_blank"> URL </a>导航至repo创建页面。看起来像下面。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff my"><img src="../Images/d21e2c4e077d2dc95aa3a3c6461cb203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N6ssvJ1oYoWMDjMR5VIvlA.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">GitHub repo creation page.</figcaption></figure><p id="3a5b" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">给出你的库名、描述、repo访问，你就可以避免<code class="eh mp mq mr mh b">README</code>。<code class="eh mp mq mr mh b">gitignore</code>选项，因为当你使用<a class="ae jj" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>创建应用程序时，你的项目中已经有了这些选项。</p><p id="bbd2" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">是时候将这个存储库与我们的本地项目联系起来了。转到您的回购页面，通过单击右侧的框复制突出显示的框中的文本(参考下图)。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff mz"><img src="../Images/64f9336cde7412bc75cffce031be998d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VCVWp6SGSr-RiDFbKK3VQA.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">Copy the highlighted text.</figcaption></figure><p id="3b07" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在转到您的本地repo目录，逐一执行下面的命令来初始化、提交和推送您的代码到GitHub。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="50cb" class="lg lh hu mh b fv ml mm l mn mo">$ git init<br/>$ <!-- -->git remote add origin &lt;copied_url&gt;<br/>$ git add -A<br/>$ git commit -m "Initial Commit."<br/>$ git push origin master</span></pre><p id="e0db" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">您的代码现在位于您的远程存储库中。在GitHub检查您的代码。</p><h2 id="b45e" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">在EC2实例中配置SSH访问</h2><p id="8912" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">当我们使用PM2部署我们的应用程序时，在您的远程实例中重复上面的一些步骤，以允许您的服务器使用SSH访问从您的GitHub repo中提取代码。</p><p id="e9ca" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在执行以下步骤之前，您需要连接到您的远程实例。如果您不知道此连接，请在继续之前参考此<a class="ae jj" rel="noopener" href="/full-stack-web-development-from-scratch-to/make-your-amazon-ec2-instance-up-and-running-ab80120eb23">链接</a>。</p><p id="f5dd" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在远程终端中发出以下命令。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="4bc7" class="lg lh hu mh b fv ml mm l mn mo">$ cd ~/.ssh/ #To navigate to your default SSH key location.<br/>$ ssh-keygen -t rsa -b 4096 -C "<em class="ms">your_email@example.com</em>"</span></pre><p id="8ed3" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">当提示您“输入保存密钥的文件”时，请按Enter键。这接受默认的文件位置。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="2025" class="lg lh hu mh b fv ml mm l mn mo">Enter a file in which to save the key (/Users/<em class="ms">you</em>/.ssh/id_rsa): <em class="ms">[Press enter]</em></span></pre><p id="4e56" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在提示符下，按enter键两次，不输入任何密码。就这样，您已经成功地创建了名为<code class="eh mp mq mr mh b">id_rsa</code>的SSH密钥。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="c856" class="lg lh hu mh b fv ml mm l mn mo">$ eval "$(ssh-agent -s)"<br/>$ ssh-add -K ~/.ssh/id_rsa<br/>$ pbcopy &lt; ~/.ssh/id_rsa.pub # (or - cat ~/.ssh/id_rsa.pub) and copy</span></pre><p id="521c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">进入你的GitHub账户设置，像上面一样添加SSH密钥。</p><h2 id="3f40" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">PM2构型</h2><p id="60e9" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">让我们在本地存储库中配置PM2，它将实际完成我们的部署工作。</p><blockquote class="na nb nc"><p id="0919" class="jk jl ms jm b jn jo iv jp jq jr iy js nd ju jv jw ne jy jz ka nf kc kd ke kf hn dt translated">基本上，PM2是专门为Node.js设计的，而不是为客户端应用设计的。但是在这里，我们将在PM2的帮助下自动化我们的部署，因此，我们将使用它从GitHub中提取代码，并在我们的远程服务器(EC2实例)上运行。</p></blockquote><p id="5b29" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jm hv">注意:该应用程序不会在PM2进程中运行。</strong></p><p id="f121" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果您知道Amazon EC2实例，并且知道如何配置和使用它，那么您不需要做任何事情。</p><p id="e18a" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">但是，如果您不知道，您可以浏览下面的链接并设置您的远程实例ready，这是托管Node.js服务器所必需的。</p><div class="ng nh fm fo ni nj"><a rel="noopener follow" target="_blank" href="/full-stack-web-development-from-scratch-to/make-your-amazon-ec2-instance-up-and-running-ab80120eb23"><div class="nk ab ej"><div class="nl ab nm cl cj nn"><h2 class="bd hv fv z el no eo ep np er et ht dt translated">启动并运行您的Amazon EC2实例。</h2><div class="nq l"><h3 class="bd b fv z el no eo ep np er et ek translated">在这一部分，我们将创建一个Amazon帐户EC2实例，并通过SSH连接到该实例。</h3></div><div class="nr l"><p class="bd b gc z el no eo ep np er et ek translated">medium.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx le nj"/></div></div></a></div><p id="bca6" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jm hv">注意:您需要一个服务器(EC2实例)来部署您的生产就绪React应用程序。</strong></p><p id="ea22" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">发出以下命令，在根目录下安装PM2。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="4efc" class="lg lh hu mh b fv ml mm l mn mo">$ sudo npm i pm2 --save-dev</span></pre><p id="a700" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在根目录中，创建一个名为ecosystem.config.js的文件，并将以下内容添加到其中。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="645c" class="lg lh hu mh b fv ml mm l mn mo">module.exports = {<br/>  apps: [<br/>    {<br/>      name: "react-sass-pm2-production-app",<br/>      env: {<br/>        PORT: 3000,<br/>        NODE_ENV: "production"<br/>      }<br/>    }<br/>  ],<br/>  deploy: {<br/>    production: {<br/>      user: "ubuntu",<br/>      host: "ec2-xx-xxx-xxx-xx.us-east-2.compute.amazonaws.com",<br/>      key: "~/.ssh/AWS-EC2-INSTANCE-LIVE.pem",<br/>      ref: "origin/master",<br/>      repo: "<a class="ae jj" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:BalasubramaniM/react-sass-pm2-production-app.git",<br/>      path: "/home/ubuntu/react-app",<br/>      "post-deploy":<br/>        "npm install &amp;&amp; npm run build &amp;&amp; sudo cp -r build/* /var/www/react-sass-pm2-production-app.in/"<br/>    }<br/>  }<br/>};</span></pre><p id="68f8" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这里，在<code class="eh mp mq mr mh b">apps</code>中，我们给出了我们的应用程序名称、端口和节点环境。在<code class="eh mp mq mr mh b">deploy</code>部分，我们将配置命名为生产，并给出用户、主机、密钥、引用、回购、路径和部署后命令。</p><p id="fa8e" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">记得用您的Amazon实例主机、PEM密钥位置替换您的主机，并更新您的回购链接(您之前已经复制了该链接，即突出显示的文本)。希望你记得)。</p><p id="6c7f" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">请注意部署后命令。稍后，在我们的远程实例中配置Nginx之后，我们将了解这些命令。</p><p id="56a1" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">PM2已成功配置。</p><h2 id="a60d" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">EC2配置</h2><p id="4a5c" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">正如您在PM2配置中看到的，我们给定了一个端口号3000，因此我们需要允许EC2上的这个端口在这个端口上运行我们的应用程序。</p><p id="3efb" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在你的亚马逊控制台页面点击<code class="eh mp mq mr mh b">NETWORK &amp; SECURITY</code>下的<code class="eh mp mq mr mh b">Security Groups</code>。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff my"><img src="../Images/7ed6e2864eaa9fb24aa575967c89f1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HhUMorYI8tVVuOswh-KCWQ.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">Click Security Groups.</figcaption></figure><p id="cd53" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">右键单击实例的安全组，然后单击<code class="eh mp mq mr mh b">Edit inbound rules</code>。</p><p id="c5f1" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">点击<code class="eh mp mq mr mh b">Add Rule</code>。添加如下配置，如下图所示，并点击<code class="eh mp mq mr mh b">Save</code>。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff ny"><img src="../Images/bcefd15a660a75f9b8e503161705464e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eM0_tlABr42-fMtNGR223A.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">Security group config rule.</figcaption></figure><p id="8abe" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jm hv">注意:在这里将您的端口添加为3000，React应用程序正在其中运行，并添加端口443用于SSL访问。</strong></p><h2 id="f266" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">DNS配置</h2><p id="b81a" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated"><strong class="jm hv">必选:</strong>在自定义域中运行我们的react app会更牛逼(例如:<a class="ae jj" href="https://tamilakam.in" rel="noopener ugc nofollow" target="_blank"> https://tamilakam.in </a>)。因此，您可以获得一个@ <a class="ae jj" href="https://in.godaddy.com/" rel="noopener ugc nofollow" target="_blank"> GoDaddy </a>或通过任何其他域名注册商，域名是必需的，以完成剩余的步骤。</p><p id="d9b9" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">从现在开始，我将使用我的网站<a class="ae jj" href="https://www.tamilakam.in/" rel="noopener ugc nofollow" target="_blank"> tamilakam.in </a>作为下面的参考，以获得您的理解。请将<code class="eh mp mq mr mh b">tamilakam.in</code>替换为您的域名。</p><p id="4dba" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在您的互联网域名注册服务商DNS设置中提供您的Amazon EC2 <code class="eh mp mq mr mh b">IPv4 Public IP</code>地址。</p><p id="cde9" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">从Amazon控制台获取IPv4公共IP地址。这就像<code class="eh mp mq mr mh b">18.xxx.xxx.15</code></p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff my"><img src="../Images/22b7248e59cc342c45045a16cdda52dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OToOFGaRZBIztl-AMSvIoQ.png"/></div></div></figure><p id="7ec9" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在您的DNS提供商设置页面中添加两个具有如下值的<strong class="jm hv"> A类型</strong>记录。更多信息请参考下图。</p><p id="ccd7" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">首先是记录。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="3b1f" class="lg lh hu mh b fv ml mm l mn mo">Type: A<br/>Name: www. // Sub domain so we can access it like <a class="ae jj" href="https://tamilakam.in/" rel="noopener ugc nofollow" target="_blank">www.tamilakam.in</a><br/>Value: 18.xxx.xxx.15 // <!-- -->IPv4 Public IP<br/>TTL: 600 seconds</span></pre><p id="b06b" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">第二张唱片。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="8c6b" class="lg lh hu mh b fv ml mm l mn mo">Type: A<br/>Name: @ // To access our site with <a class="ae jj" href="https://tamilakam.in/" rel="noopener ugc nofollow" target="_blank">tamilakam.in</a><br/>Value: 18.xxx.xxx.15 // <!-- -->IPv4 Public IP<br/>TTL: 600 seconds</span></pre><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff nz"><img src="../Images/fc70dec5aa833de52f85d37ef940ec0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jy6doBLKK8sk_06CNhYBmg.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">DNS Management page — Add Records.</figcaption></figure><p id="8fa2" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在这里，我添加了三个A型记录。我将在下面解释这些。</p><ol class=""><li id="da71" class="kg kh hu jm b jn jo jq jr jt ki jx kj kb kk kf kl km kn ko dt translated">第一条记录是当用户键入域名name.com时加载页面。泰米尔语。(必需)。</li><li id="8f89" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">第二条记录是加载Node.js API服务器。你可以参考这个<a class="ae jj" rel="noopener" href="/full-stack-web-development-from-scratch-to/deploy-your-node-js-app-in-production-and-use-bitbucket-to-automate-your-deployment-50b07b18914c">链接</a>和这个<a class="ae jj" rel="noopener" href="/full-stack-web-development-from-scratch-to/how-to-run-multiple-apps-on-a-single-ec2-instance-with-nginx-and-map-your-custom-domain-2640630ce1e7">链接</a>，我在那里托管了我的Node.js应用程序，并在中使用名为<a class="ae jj" href="https://api.tamilakam.in/" rel="noopener ugc nofollow" target="_blank"> api.tamilakam .的子域加载它。(可选)。</a></li><li id="2209" class="kg kh hu jm b jn kp jq kq jt kr jx ks kb kt kf kl km kn ko dt translated">第三条记录是当用户在中键入<a class="ae jj" href="https://tamilakam.in/" rel="noopener ugc nofollow" target="_blank"> www.tamilakam .时加载页面。(必需)。</a></li></ol><p id="48e8" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我们已经成功配置了DNS。等待5分钟，让更改得到反映，因为您已将TTL值设置为600秒。</p><h2 id="61f0" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">Nginx配置</h2><p id="63e9" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">让我们首先从终端使用下面的命令连接到我们的远程实例。(在所需位置替换您的EC2 URL)</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="5f0d" class="lg lh hu mh b fv ml mm l mn mo">$ ssh -i ~/.ssh/AWS-EC2-INSTANCE-LIVE.pem ubuntu@ec2-xx-xxx-xx-xx.us-east-2.compute.amazonaws.com</span></pre><p id="a8c3" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">安装Nginx并在您的远程服务器上进行配置。</p><p id="8ee2" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">Ubuntu自带包管理器，<strong class="jm hv"> <em class="ms"> apt-get </em> </strong>。使用<strong class="jm hv"> <em class="ms"> apt-get </em> </strong>，我们可以在一个命令中安装<strong class="jm hv"> <em class="ms"> nginx </em> </strong>。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="3798" class="lg lh hu mh b fv ml mm l mn mo">$ sudo apt-get install nginx</span></pre><p id="1016" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jm hv"> <em class="ms"> apt-get </em> </strong>安装后会自动运行nginx，因此您现在应该可以在端口<code class="eh mp mq mr mh b">80</code>上运行它，通过在浏览器中输入您的公共DNS URL进行检查。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff oa"><img src="../Images/ba194af4c22956c269b707da100b35a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHNMS-8Fqg-shegUomHRag.png"/></div></div><figcaption class="mu mv fg fe ff mw mx bd b be z ek">Nginx welcome page.</figcaption></figure><p id="762b" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果这不起作用，您可能需要手动启动它。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="ba8d" class="lg lh hu mh b fv ml mm l mn mo">$ sudo /etc/init.d/nginx start</span></pre><p id="e0a4" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在让我们配置Nginx来运行Node.js服务器。</p><p id="5e4c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如何设置<strong class="jm hv"> <em class="ms"> nginx </em> </strong>配置？配置以任何名称存储在<code class="eh mp mq mr mh b">sites-available</code>中的纯文本文件中。将它们链接到<code class="eh mp mq mr mh b">sites-enabled</code>文件夹会导致它们在<strong class="jm hv"> <em class="ms"> nginx </em> </strong>启动时被读取和使用。所有的配置通过<strong class="jm hv"> <em class="ms"> nginx </em> </strong>组合在一起。</p><p id="8ead" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">您可以使用cat查看这个配置。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="d75f" class="lg lh hu mh b fv ml mm l mn mo">$ cat /etc/nginx/sites-<!-- -->available<!-- -->/default</span></pre><p id="f76a" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">让我们首先从<code class="eh mp mq mr mh b">sites-enabled</code>中移除默认配置，我们将把它留在<code class="eh mp mq mr mh b">sites-available</code>中以供参考。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="9893" class="lg lh hu mh b fv ml mm l mn mo">$ sudo rm /etc/nginx/sites-<!-- -->enabled<!-- -->/default</span></pre><p id="70bc" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">让我们用域名在<code class="eh mp mq mr mh b">sites-available</code>中创建一个配置文件。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="f42a" class="lg lh hu mh b fv ml mm l mn mo">$ sudo nano /etc/nginx/sites-<!-- -->available<!-- -->/tamilakam.in</span></pre><p id="4a72" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">并将以下内容添加到其中，按下<code class="eh mp mq mr mh b">Ctrl+x</code>，键入<code class="eh mp mq mr mh b">yes</code>并回车保存。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="9377" class="lg lh hu mh b fv ml mm l mn mo">server {<br/>  listen 80;<br/>  server_name tamilakam.in <a class="ae jj" href="http://www.tamilakam.in" rel="noopener ugc nofollow" target="_blank">www.tamilakam.in</a>;<br/>  location / {<br/>   root /var/www/tamilakam.in;<br/>   index index.html;<br/>   try_files $uri /index.html;<br/>  }<br/>}</span></pre><p id="9b4a" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">链接<code class="eh mp mq mr mh b">sites-enabled</code>中的配置文件(这将使文件看起来像是在<code class="eh mp mq mr mh b">sites-enabled</code>中复制的)。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="0b0e" class="lg lh hu mh b fv ml mm l mn mo">$ sudo ln -s /etc/nginx/sites-available/tamilakam.in /etc/nginx/sites-enabled/tamilakam.in</span></pre><p id="5fb4" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果不熟悉符号链接，请在此阅读更多相关内容。</p><p id="32dc" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在上面的代码块中，我们监听默认端口80，并以两种格式提供了我们的服务器名。我们还提供了location，当使用根和默认索引文件选项点击服务器名称时，将提供这个位置。</p><p id="a4fe" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">正如您所看到的<code class="eh mp mq mr mh b">root</code>选项，我们将其命名为<code class="eh mp mq mr mh b">/var/www/tamilakam.in</code>。这个位置充当我们的应用程序的源。因此，让我们在该位置添加我们的React app minified(生产)版本代码。</p><p id="0d10" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">导航到那个位置并创建一个名为<code class="eh mp mq mr mh b">tamilakam.in</code>的文件。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="32de" class="lg lh hu mh b fv ml mm l mn mo">$ cd /var/www<br/>$ sudo nano tamilakam.in</span></pre><p id="c3db" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在让我们回到PM2配置文件中的部署后命令。在那里，您给出了如下命令。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="933a" class="lg lh hu mh b fv ml mm l mn mo">"post-deploy":<br/>        "npm install &amp;&amp; npm run build &amp;&amp; sudo cp -r build/* /var/www/tamilakam.in/"</span></pre><p id="1e78" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">让我告诉你它是做什么的。从GitHub下载您的代码后，它会执行<code class="eh mp mq mr mh b">npm install first</code>，然后运行<code class="eh mp mq mr mh b">npm run build</code>进行生产优化构建，最后将这个优化构建复制到我们刚才创建的位置<code class="eh mp mq mr mh b">/var/www/tamilakam.in</code>。</p><p id="7810" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">重启<strong class="jm hv"> <em class="ms"> nginx </em> </strong>使新配置生效。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="10e5" class="lg lh hu mh b fv ml mm l mn mo">$ sudo service nginx restart</span></pre><p id="aa7c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">你完了。让我们从本地终端运行几个命令，这样我们就可以在几秒钟内将React应用程序部署到生产环境中。</p><p id="72a8" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">要检查您提供的配置是否正确，请发出以下命令。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="edf6" class="lg lh hu mh b fv ml mm l mn mo">$ sudo nginx -t</span></pre><p id="880f" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果您遇到任何错误，您需要在您的服务器块上工作(您已经在<code class="eh mp mq mr mh b">sites-available</code>文件夹中创建了服务器块)。请在评论中告诉我，以便我们尝试解决它。</p><h2 id="ac95" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">部署应用程序</h2><p id="c5a3" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">从本地机器上的应用程序根目录中，发出下面的命令，在远程服务器上设置我们的应用程序。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="c33d" class="lg lh hu mh b fv ml mm l mn mo">$ sudo pm2 deploy ecosystem.config.js production setup</span></pre><p id="c945" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这将在EC2实例中配置我们的应用程序。</p><p id="0652" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">最后，发出下面的命令，在远程服务器上使用PM2托管并运行您的应用程序。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="66b1" class="lg lh hu mh b fv ml mm l mn mo">$ sudo pm2 deploy ecosystem.config.js production</span></pre><p id="f113" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">万岁！！！您的React应用程序现在位于生产服务器中，可以使用了。</p><p id="cdd8" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">访问<a class="ae jj" href="https://api.tamilakam.in" rel="noopener ugc nofollow" target="_blank"> https://tamilakam.in </a>检查你的申请。</p><h2 id="4395" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">使用“让我们加密”添加SSL证书</h2><p id="591e" class="pw-post-body-paragraph jk jl hu jm b jn mb iv jp jq mc iy js jt md jv jw jx me jz ka kb mf kd ke kf hn dt translated">是时候使用安全套接字层来保护我们的站点了。</p><p id="73ff" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">Let's Encrypt是一个证书颁发机构(CA ),它提供了一种获取和安装免费的<a class="ae jj" href="https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs" rel="noopener ugc nofollow" target="_blank"> TLS/SSL证书</a>的简单方法，从而在web服务器上启用加密的HTTPS。</p><p id="63aa" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">在这里，您将使用Certbot为Ubuntu 16.04上的Nginx获取一个免费的SSL证书，并将您的证书设置为自动续订。</p><p id="166a" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">连接到您的远程实例，并在EC2终端中键入以下命令。</p><p id="7e08" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">首先，添加存储库。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="a9cb" class="lg lh hu mh b fv ml mm l mn mo">$ sudo add-apt-repository ppa:certbot/certbot</span></pre><p id="cea9" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">你需要按<code class="eh mp mq mr mh b">ENTER</code>来接受。然后，更新包列表以获取新存储库的包信息。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="ac9c" class="lg lh hu mh b fv ml mm l mn mo">$ sudo apt-get update</span></pre><p id="508c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">最后用<code class="eh mp mq mr mh b">apt-get</code>安装Certbot的Nginx包。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="7c59" class="lg lh hu mh b fv ml mm l mn mo">$ sudo apt-get install python-certbot-nginx</span></pre><p id="324e" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">Certbot现在可以使用了，但是为了让它为Nginx配置SSL，我们需要验证Nginx的一些配置。</p><p id="568c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">重启Nginx以使效果生效。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="246c" class="lg lh hu mh b fv ml mm l mn mo">$ sudo systemctl reload nginx</span></pre><p id="1ee4" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">Certbot现在可以找到正确的<code class="eh mp mq mr mh b">server</code>块并更新它。</p><p id="e0ec" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">接下来，我们将更新防火墙以允许HTTPS流量。发出这组命令，并参考参考部分中的<a class="ae jj" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-let-s-encrypt-with-nginx-server-blocks-on-ubuntu-16-04" rel="noopener ugc nofollow" target="_blank">链接</a>以获取有关命令的更多信息。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="a1d5" class="lg lh hu mh b fv ml mm l mn mo">$ sudo ufw status<br/>$ sudo ufw allow 'Nginx Full'<br/>$ sudo ufw delete allow 'Nginx HTTP'</span></pre><p id="a1e5" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我们现在准备运行Certbot并获取我们的证书。</p><p id="07e0" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">获取SSL证书。(别忘了更换你的域名)</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="8ce3" class="lg lh hu mh b fv ml mm l mn mo">$ sudo certbot — nginx -d example.com -d <a class="ae jj" href="http://www.example.com" rel="noopener ugc nofollow" target="_blank">www.example.com</a></span></pre><p id="1e5a" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果这是您第一次运行<code class="eh mp mq mr mh b">certbot</code>，系统会提示您输入电子邮件地址并同意服务条款。完成后，<code class="eh mp mq mr mh b">certbot</code>将与Let's Encrypt服务器通信，然后运行一个挑战来验证您是否控制了您正在申请证书的域。</p><p id="4540" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果成功，<code class="eh mp mq mr mh b">certbot</code>将询问您希望如何配置您的HTTPS设置。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="9ec9" class="lg lh hu mh b fv ml mm l mn mo">Output</span><span id="b659" class="lg lh hu mh b fv ob mm l mn mo">Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.<br/>-------------------------------------------------------------------------------<br/>1: No redirect - Make no further changes to the webserver configuration.<br/>2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for<br/>new sites, or if you're confident your site works on HTTPS. You can undo this<br/>change by editing your web server's configuration.<br/>-------------------------------------------------------------------------------<br/>Select the appropriate number [1-2] then [enter] (press 'c' to cancel):</span></pre><p id="b240" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">选择选项2(默认——将您的所有请求重定向到安全的HTTPS访问),然后点击<code class="eh mp mq mr mh b">ENTER</code>。配置将被更新，Nginx将重新加载以获取新的设置。<code class="eh mp mq mr mh b">certbot</code>将以一条消息结束，告诉您该过程已成功完成，并且您的证书存储在何处:</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="9f7f" class="lg lh hu mh b fv ml mm l mn mo">Output</span><span id="ca7d" class="lg lh hu mh b fv ob mm l mn mo">IMPORTANT NOTES:<br/> - Congratulations! Your certificate and chain have been saved at<br/>   /etc/letsencrypt/live/example.com/fullchain.pem. Your cert will<br/>   expire on 2017-10-23. To obtain a new or tweaked version of this<br/>   certificate in the future, simply run certbot again with the<br/>   "certonly" option. To non-interactively renew *all* of your<br/>   certificates, run "certbot renew"<br/> - Your account credentials have been saved in your Certbot<br/>   configuration directory at /etc/letsencrypt. You should make a<br/>   secure backup of this folder now. This configuration directory will<br/>   also contain certificates and private keys obtained by Certbot so<br/>   making regular backups of this folder is ideal.<br/> - If you like Certbot, please consider supporting our work by:<br/><br/>   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate<br/>   Donating to EFF:                    https://eff.org/donate-le</span></pre><p id="b1a7" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">您的证书已被下载、安装和加载。</p><p id="ede0" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">重启Nginx。</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="1f7d" class="lg lh hu mh b fv ml mm l mn mo">$ sudo systemctl reload nginx</span></pre><p id="c806" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在，试着用<code class="eh mp mq mr mh b">https://</code>重新加载你的网站，注意你浏览器的安全指示器。它应该表明该网站是适当的安全，通常有一个绿色的锁图标。如果你用<a class="ae jj" href="https://www.ssllabs.com/ssltest/" rel="noopener ugc nofollow" target="_blank"> SSL实验室服务器测试</a>来测试你的服务器，它会得到A级。</p><p id="faf7" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">最后，让我们测试一下续订流程。</p><p id="2ccc" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">为了测试更新过程，您可以使用<code class="eh mp mq mr mh b">certbot</code>进行一次试运行:</p><pre class="kv kw kx ky fq mg mh mi mj aw mk dt"><span id="054d" class="lg lh hu mh b fv ml mm l mn mo">$ sudo certbot renew — dry-run</span></pre><p id="0420" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果您没有看到错误，那么您就一切就绪了。必要时，Certbot将更新您的证书并重新加载Nginx以获取更改。如果自动续订过程失败，Let's Encrypt会向您指定的电子邮件地址发送一封邮件，在您的证书即将过期时发出警告。</p><p id="c103" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果您对使用Certbot有进一步的疑问，<a class="ae jj" href="https://certbot.eff.org/docs/" rel="noopener ugc nofollow" target="_blank">他们的文档</a>是一个很好的起点。</p><p id="9208" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我们已经保护了我们的React应用程序。</p><p id="0b8c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果你对以上步骤有任何疑问，欢迎在评论区提出来，我会尽快回复。</p><p id="38a8" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">因为它很大，你可能会在建立你的项目时遇到任何问题。请检查我的其他教程，以便你可以找到任何解决你的问题的方法。</p><p id="5286" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">谢谢你。</p><p id="fd7c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">最终应用可在<a class="ae jj" href="https://github.com/BalasubramaniM/react-sass-pm2-production-app" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="3d94" class="lg lh hu bd li lj lk ll lm ln lo lp lq jt lr ls lt jx lu lv lw kb lx ly lz ma dt translated">参考资料:</h2></div><div class="ab cl oc od hc oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="hn ho hp hq hr"><div class="kv kw kx ky fq nj"><a rel="noopener follow" target="_blank" href="/full-stack-web-development-from-scratch-to/how-to-run-multiple-apps-on-a-single-ec2-instance-with-nginx-and-map-your-custom-domain-2640630ce1e7"><div class="nk ab ej"><div class="nl ab nm cl cj nn"><h2 class="bd hv fv z el no eo ep np er et ht dt translated">如何用Nginx在单个EC2实例上运行多个app，并映射自己的自定义域？</h2><div class="nq l"><h3 class="bd b fv z el no eo ep np er et ek translated">在本教程中，我们将在EC2实例中托管一个单独的React和Node.js应用程序，并映射我们的自定义域。</h3></div><div class="nr l"><p class="bd b gc z el no eo ep np er et ek translated">medium.com</p></div></div><div class="ns l"><div class="oj l nu nv nw ns nx le nj"/></div></div></a></div><div class="ng nh fm fo ni nj"><a rel="noopener follow" target="_blank" href="/full-stack-web-development-from-scratch-to/m-e-r-n-stack-application-using-passport-for-authentication-920b1140a134"><div class="nk ab ej"><div class="nl ab nm cl cj nn"><h2 class="bd hv fv z el no eo ep np er et ht dt translated">米（meter的缩写））使用Passport进行身份验证的E.R.N堆栈应用程序。</h2><div class="nq l"><h3 class="bd b fv z el no eo ep np er et ek translated">在本教程中，我们将在React应用程序中集成用于注册或登录目的的Google sign-in</h3></div><div class="nr l"><p class="bd b gc z el no eo ep np er et ek translated">medium.com</p></div></div><div class="ns l"><div class="ok l nu nv nw ns nx le nj"/></div></div></a></div><div class="ng nh fm fo ni nj"><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-let-s-encrypt-with-nginx-server-blocks-on-ubuntu-16-04" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab ej"><div class="nl ab nm cl cj nn"><h2 class="bd hv fv z el no eo ep np er et ht dt translated">如何在Ubuntu 16.04 | DigitalOcean上设置Let's Encrypt with Nginx服务器块</h2><div class="nq l"><h3 class="bd b fv z el no eo ep np er et ek translated">在本教程中，您将使用Certbot为Ubuntu 16.04上的Nginx获取一个免费的SSL证书，并设置您的…</h3></div><div class="nr l"><p class="bd b gc z el no eo ep np er et ek translated">www.digitalocean.com</p></div></div><div class="ns l"><div class="ol l nu nv nw ns nx le nj"/></div></div></a></div></div></div>    
</body>
</html>