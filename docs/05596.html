<html>
<head>
<title>What I Talk About When I Talk About Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当我谈论伐木时，我谈论的是</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/what-i-talk-about-when-i-talk-about-logging-36237fad7336?source=collection_archive---------17-----------------------#2018-07-03">https://medium.com/hackernoon/what-i-talk-about-when-i-talk-about-logging-36237fad7336?source=collection_archive---------17-----------------------#2018-07-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/f7218bf0b8ae9adb67003322b114c1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n82g8y5dIPyeGd7kcdvr3A.jpeg"/></div></div></figure><p id="c8fd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我处理日志和分析已经有一段时间了，遇到了很多关于这个话题的困惑。不仅在高级管理层或其他高级别非技术会议上，甚至在不熟悉日志不同方面的技术人员中也是如此。这启发了我写一个简短的概述。<br/> <br/>说到日志记录，有五个不同的方面需要考虑。<br/> <br/> <strong class="je hv"> 1。事件记录<br/> </strong>记录和日志分析的原因可能各不相同，从处理系统性能的需要到金融欺诈或内部威胁。不管是什么原因，重要的是在你的系统中记录一些东西，以便有东西可以分析。在一天结束时，这一切都追溯到日志事件的质量。</p><p id="2a6f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">决定记录什么和在哪里记录是相当棘手的:你不能记录所有的事情(负载问题、分析问题、合规性问题等)，但你仍然需要分析以达到你的目标。对于内部开发，开发记录器和记录有意义的事件是额外的开销。对于开箱即用的产品，总是存在日志格式、日志细节等问题。简而言之，重要的是定义您对事件日志记录的要求，并确保在系统中发生操作时创建日志事件。没有这一步，就没有什么可分析的。或者从另一个角度来看——如果您不打算分析任何东西，您可能也不需要日志记录的开销。<br/> <br/> <strong class="je hv"> 2。收集、处理和归档</strong> <br/>日志分析不应给生产系统带来额外的负载。此外，保护日志文件以防受到攻击也很重要:对手往往会删除他们的行动痕迹，最好的方法是删除任何可能暴露他们行动的日志。</p><p id="f8fc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在某些情况下，系统管理员和日志分析师不在同一个用户权限域内。因此，仅仅为了访问日志文件而授予对生产系统的访问权是不明智的。</p><p id="8e2f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是为什么必须将日志文件传输到更合适的位置，例如设置了适当访问权限和归档保留策略的中央日志服务器。在远程日志存储库中进行的任何类型的加载和分析都不会对生产环境产生影响，并且远程位置通过保护您的事件免受直接危害，为您提供了一个额外的事件完整性层。</p><p id="1218" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对此有不同的解决方案(从<a class="ae ka" href="http://syslog-ng.com/" rel="noopener ugc nofollow" target="_blank"> Syslog </a>服务器到<a class="ae ka" href="https://www.splunk.com" rel="noopener ugc nofollow" target="_blank"> Splunk </a>、<a class="ae ka" href="https://www.elastic.co" rel="noopener ugc nofollow" target="_blank"> ElasticSearch </a>等)，但由于目标是尽可能保持日志的原始性，一个简单的Syslog服务器和一个分布式结构化文件系统就足够了。原始日志可能会占用一些磁盘空间，但是如果您不得不重新评估系统中发生的事情，或者如果您在下一步(事件处理)中犯了一个错误，那么拥有原始日志是有好处的:如果您有原始日志，您可以随时“回到原始来源”并查看系统最初记录的关于自身的内容。如果您在收集事件的同时对它们进行汇总，那么您已经忽略了一些会在以后的阶段提供益处的事件或方面。如果没有这个步骤，在分析日志时会产生额外的开销。<br/> <br/> <strong class="je hv"> 3。用户事件识别、日志丰富和事件处理</strong> <br/>您可以从日志文件中获得几个事件，这些事件本身可能不会透露太多信息。要理解日志事件背后的操作，以某种其他方式关联、聚合或处理日志事件可能很重要。这就是我所说的“正常化阶段”或“创造一个有意义的事件”——这就是我们真正追求的。例如，从外国成功登录您的系统可能不是您感兴趣的事情。但是，如果在此事件之前，来自同一个国家的不同用户帐户登录失败了12次，那么这可能是值得注意的。</p><p id="427a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是日志分析的实质性部分之一。许多安全信息和事件管理(SIEM)解决方案试图用它们的通用解决方案来帮助您，但不幸的是，它们还不够好:您可能需要一些更定制的解决方案，而通用的SIEM解决方案无法提供您正在寻找的东西。<br/> <br/> <strong class="je hv"> 4。通知和警报</strong> <br/>如果您处理日志分析很好，但如果您在某些事件发生时有自动报告(例如通知或警报)就更好了。不是每个人都有能力每天查看日志。但是，您可能希望知道事件是否超出了基线或阈值。因此，如果您有正在寻找的量化阈值，自动警报或仪表板可以让您快速了解有趣的事件。没有这个，你可能会错过系统中的重要活动。</p><p id="edc6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将警报数量保持在最低是很重要的。如果你被一大堆警报搞得筋疲力尽，通知的价值就会贬值，最终你可能会对这些警报视而不见。它们应该像周末一样:难得到想要庆祝，但足够频繁到知道提醒系统仍在工作。</p><p id="ad69" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从您自己的定制电子邮件脚本到监控解决方案(例如<a class="ae ka" href="https://www.nagios.com" rel="noopener ugc nofollow" target="_blank"> nagios </a>或<a class="ae ka" href="https://www.zabbix.com" rel="noopener ugc nofollow" target="_blank"> zabbix </a>监控解决方案)，有多种警报解决方案可以代表您触发不同的操作，但最终您应该使用最适合您工作习惯的解决方案。如果你使用<a class="ae ka" href="http://slack.com" rel="noopener ugc nofollow" target="_blank"> Slack </a>进行日常交流，那么你可能会考虑一个可以向各个Slack频道发送通知的解决方案。<br/> <br/> <strong class="je hv"> 5。日志分析、事件处理和根本原因识别</strong> <br/>虽然这一步是作为最后一步提到的，但却是最关键的一步。要做的第一件事是建立对系统基线的理解。简单地说，试着理解什么是正常的，什么是你系统中的常见问题。多亏了日志分析，您的系统的总体情况得以展现。</p><p id="6020" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">花时间阅读你的日志并分析你所看到的会给你很多洞察力。在处理分析的时候，你可以回答第一个问题:你首先需要记录什么(点1)。它也给了你关于你应该长期保持多长时间和什么样的事件的答案(第2点)。接下来，您将获得关于实际发生的事件的输入:日志事件关联的任何类型的输入都假设您知道您在寻找什么(第3点)。那么，警报的基线(什么是正常的，什么是不正常的)只能来自您系统中的现有情况(第4点)。当然，当前的问题本身是:如果您不能快速、有效地分析您的日志文件以及您可能拥有的任何日志格式，您就无法处理事件或找到问题的根本原因(还要记住，日志格式可能会改变)。</p><p id="b70a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为这种分析找到灵活的工具并不容易:大多数SIEM解决方案和日志解析器使用预定义的日志事件模式，这意味着当您必须分析日志时，开发人员已经多次更改了日志格式，实际上没有任何有用的信息被保存到数据库中。还有一个基于数据量的价格许可问题。我发现一个非常好的选择是<a class="ae ka" href="http://spectx.com" rel="noopener ugc nofollow" target="_blank"> SpectX </a>。在旅途中定义日志格式的模式，访问来自不同来源(例如平面文件、数据库、s3存储库等)的日志事件，并将它们相互关联，这为您提供了在几秒钟内遍历整个日志存储库的灵活性。与结构化的平面文件日志服务器一起，它是一个真正强大的组合，可以让您了解组织系统的健康状况。<br/> <br/>可能并不是所有提到的方面都适用于您的场景，但是在开始处理日志之前，一定要仔细考虑这些主题。</p></div></div>    
</body>
</html>