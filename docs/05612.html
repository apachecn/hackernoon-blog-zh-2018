<html>
<head>
<title>Writing Better Redux’s Code with TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TypeScript编写更好的Redux代码</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/writing-better-reduxs-code-with-typescript-b7a3c1209bca?source=collection_archive---------0-----------------------#2018-07-04">https://medium.com/hackernoon/writing-better-reduxs-code-with-typescript-b7a3c1209bca?source=collection_archive---------0-----------------------#2018-07-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0cb1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果使用得当，打字功能可以帮助我们写出更好的代码。这篇文章是关于如何使用TypeScript类型系统和Redux来创建完全类型化的状态管理存储。</p><blockquote class="jp jq jr"><p id="6437" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hn dt translated">我假设您已经知道redux，可能还知道一点TypeScript。我感谢任何投入，我只是最近才尝试实现这一点，我愿意接受任何改进。这是一篇非常固执己见和主观的文章。</p></blockquote><p id="3651" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我以前用JS写Redux，然后把它的动作和类型定义为常量。对我来说，看到这样的事情并不稀奇。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="ab3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面代码的问题是，“AUTH_TYPES”不能作为一个整体来更改，但这可能会发生。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="a06b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以通过把这些常数变成常数来解决这个问题。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="7fb1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们不必担心意外地(或故意地)改变动作类型常量。</p><p id="dabc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们的减速器可以参考开关盒上的那些常数了，大家都很开心！</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="f18d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在假设我们添加了另一个动作类型，但是我们忘记了在依赖于它的某个reducer上处理它。嗯，别担心，我们有人保持系统每108分钟运行一次。</p><p id="c8eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">即使忘记添加动作类型处理程序的可能性很低(我的意思是你决定添加动作类型的时候也是你必须添加其处理程序的时候)，我们将看到TypeScript如何帮助我们确保所有的动作类型都得到正确处理。</p></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><p id="796e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我个人认为，当使用Redux时，我们必须编写的样板文件数量是巨大的，当维护巨大的样板文件代码时，我们可能会以大量的不一致结束(多个动作类型，reducer处理错误的动作类型)。这就是TypeScript的用武之地(不过，我并不是说您不会再编写样板代码)。</p><h1 id="d899" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">Redux，见打字稿</h1><p id="3419" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">现在，根据上面的代码，我们可以看到我们有这些问题:</p><ol class=""><li id="114a" class="ln lo hu it b iu iv iy iz jc lp jg lq jk lr jo ls lt lu lv dt translated">动作类型常量很难维护。</li><li id="9de4" class="ln lo hu it b iu lw iy lx jc ly jg lz jk ma jo ls lt lu lv dt translated">我们必须编写许多动作创建器来包装那些动作类型常量。</li><li id="210a" class="ln lo hu it b iu lw iy lx jc ly jg lz jk ma jo ls lt lu lv dt translated">可能有不一致的地方。</li><li id="c38c" class="ln lo hu it b iu lw iy lx jc ly jg lz jk ma jo ls lt lu lv dt translated">我们可能会忘记在我们的reducers上处理新的动作类型。</li></ol><p id="2232" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可能不会遇到所有这些问题，我只遇到了第1、2、3和4个问题(顺便说一下)。</p><p id="6438" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，让我们试着解决这些问题。</p><h2 id="3c48" class="mb kl hu bd km mc md me kq mf mg mh ku jc mi mj ky jg mk ml lc jk mm mn lg mo dt translated">问题#1 —使用类型脚本类型而不是常量</h2><p id="fdb6" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">现在，即使我正在使用TypeScript和Redux，我过去也是编写与上面相同的代码，在上面我将我的动作类型定义为常量。现在，我没有那样做，而是尝试扔掉那些类型常量，而使用TypeScript类型。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="a74b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将接口AuthStore定义为我们的存储模式，这意味着我们的存储看起来就是这样。</p><p id="11dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是我们如何定义动作类型常量。我们使用TypeScript接口来实际定义动作的外观，而不是仅仅将动作类型名称作为字符串常量。</p><p id="0294" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在你可能想知道，什么是PayloadedAction 和Action ？这是一个简单的界面，看起来像这样:</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="e890" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，SetTokenAction实际上会是这样的:</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="5bf6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">而FlushTokenAction只是一个没有任何负载的动作。</p><p id="1008" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们分开创建Action和PayloadedAction的原因是，我们可以有一个正确类型的Action创建者。你会在下面读到更多。</p><p id="3186" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们的常量被定义为一个类型，我们可以把它们称为它的类型。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="633c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">等等，但是我们把常量写成了一个字符串！如果我们输错了怎么办？嗯，你不能，TypeScript检查并确保那里只写了“auth/set-token”或“auth/flush-token”。</p><figure class="jw jx jy jz fq ka fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff mp"><img src="../Images/6856ef7dd6f9106898cb78043d6821e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qL8u7G5aLhMT1zNJBJKV7Q.png"/></div></div></figure><p id="8af7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你使用的是Visual Studio代码，它会告诉你它在那里接受什么字符串常量。实际字符串常量作为常量！</p><p id="0f1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们确信，reducer将准确地处理我们为TokenActions定义的类型。AuthStore["token"]的使用也确保了reducer的返回类型与我们的存储模式相匹配。</p><h2 id="7060" class="mb kl hu bd km mc md me kq mf mg mh ku jc mi mj ky jg mk ml lc jk mm mn lg mo dt translated">问题# 2——我们创建了自己的类型感知动作创建器</h2><p id="a21a" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">现在，我们仍然需要逐个定义动作创建者，但至少我们将创建一个动作创建者的创建者，它是类型感知的，并且与我们最初的接口定义相匹配。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="19fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着createPayloadedAction应该接受payloaded操作类型定义，并且它将创建的类型和有效负载将与提供的类型定义相匹配。</p><p id="b1c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">createAction也是一样的，只是没有有效负载。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="5d5e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的setTokenAction将变成如下所示的函数:</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="188d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并且它是类型感知的，您将正确地获得代码完成。</p><figure class="jw jx jy jz fq ka fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff mw"><img src="../Images/5b2de8220a2a9f5d26e1867f4861e0de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wQ_sb5U6ScdQqk30O9RBKg.png"/></div></div></figure><p id="3234" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您不喜欢定义一个动作创建者，您仍然可以通过在调用dispatch时提供其类型来调度一个类型感知的动作。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><h2 id="f749" class="mb kl hu bd km mc md me kq mf mg mh ku jc mi mj ky jg mk ml lc jk mm mn lg mo dt translated">问题# 3——我们上面所做的解决了这个问题</h2><p id="8a76" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">当我们使用TypeScript来检查我们键入的所有内容时，不一致是可以避免的。</p><p id="3799" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，每当缩减器接受一个新的动作时，我们必须定义动作的类型，然后我们必须更新缩减器，因为TypeScript检查所有的东西，我们将有很小的机会出现不一致。</p><figure class="jw jx jy jz fq ka fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff mx"><img src="../Images/40a190bcbd30bed2d478afcbc600dd75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rc_-94DWfGUzO-FmY10O3A.png"/></div></div></figure><p id="9595" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果类型没有作为TokenActions包含，我们将得到一个错误，如果返回类型不符合我们的模式，我们也将得到一个错误。开发过程中的错误是一种幸福，生产过程中的错误是一场爆炸。</p><h2 id="c56a" class="mb kl hu bd km mc md me kq mf mg mh ku jc mi mj ky jg mk ml lc jk mm mn lg mo dt translated">问题# 4——已解决，TypeScript检查您是否涵盖了所有开关情况</h2><p id="cb34" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">这里不需要做任何步骤，我们构建和键入代码的方式帮助我们避免了这个问题。</p><p id="a904" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">TypeScript知道，在这里的默认情况下，所有的动作类型都已经被处理了，所以如果您尝试键入“action ”,然后打开代码完成，它不会提示您任何其他内容。这样，您就知道您处理了所有的代码案例(类型将变成never)。</p><figure class="jw jx jy jz fq ka fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff my"><img src="../Images/c76194bdb04d0d5fdaa577e417ec6549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zlHDqSM-lcXX9TociZ0zZw.png"/></div></div></figure><p id="bf47" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">编辑:感谢<a class="ae mz" rel="noopener" href="/@matt.dekrey?source=post_header_lockup">马修·德克雷</a>指出这一点:</p><p id="7ee7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然您的编辑器可能会告诉您操作的类型现在是never，但是您可以创建一个实用函数来断言传递给该函数的任何内容都应该是never类型(当您处理所有案例时会发生这种情况)，如果您错过了一些案例，它实际上会导致一个错误。</p><figure class="jw jx jy jz fq ka"><div class="bz el l di"><div class="kb kc l"/></div></figure><figure class="jw jx jy jz fq ka fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff na"><img src="../Images/f6e4aa12c3cf61b7ba333c8ffa1fa4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zb6daGDtyYab0fNFCh5ugg.png"/></div></div></figure><p id="fc20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你错过了一个案例，</p><pre class="jw jx jy jz fq nb nc nd ne aw nf dt"><span id="3a4d" class="mb kl hu nc b fv ng nh l ni nj">[ts] Argument of type 'FlushTokenAction' is not assignable to parameter of type 'never'.</span></pre><p id="b768" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如Matthew指出的，在assertNever内部抛出一个错误是可能的。然而，因为Redux将调用所有的reducer，而不管它接收到什么动作类型，并让reducer决定它们是否应该对传递的动作做出反应，所以它将总是被调用，从而导致总是出现错误代码。</p><p id="142c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在有一些TypeScript没有检查的东西，例如当我们的减速器上有重复的开关情况时:</p><figure class="jw jx jy jz fq ka fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff nk"><img src="../Images/1c2ebcf5e515fcfc28e87dfd323d7edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAmTxft40SfU5oOXEPlaDA.png"/></div></div></figure><p id="5b16" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，我们也可以使用TSLint来防止这种情况，启用该选项:</p><pre class="jw jx jy jz fq nb nc nd ne aw nf dt"><span id="1e62" class="mb kl hu nc b fv ng nh l ni nj"><strong class="nc hv">"no-duplicate-switch-case"</strong>: true</span></pre></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><h1 id="1065" class="kk kl hu bd km kn nl kp kq kr nm kt ku kv nn kx ky kz no lb lc ld np lf lg lh dt translated">结论</h1><p id="9b69" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">TypeScript类型系统是强大的，我们实际上可以删除那些action类型常量和那些无聊的action creator样板代码，这些代码实际上为我们提供了类型系统，帮助我们确保我们的代码是一致的。</p><p id="119c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本例中使用的代码可以在https://github.com/adityapurwa/typescript-redux<a class="ae mz" href="https://github.com/adityapurwa/typescript-redux" rel="noopener ugc nofollow" target="_blank">的</a>查看</p><p id="3e41" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">希望我们都从这篇文章中学到了一些东西！</p></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><p id="a2b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">阿迪蒂亚·普尔瓦</p></div></div>    
</body>
</html>