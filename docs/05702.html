<html>
<head>
<title>Don’t be the bad cop in pull request reviews — Let software do that job</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要在拉式请求评审中扮演坏警察——让软件来完成这项工作</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/dont-be-the-bad-cop-in-pull-request-reviews-let-software-do-that-job-1eb9e574c2d1?source=collection_archive---------1-----------------------#2018-07-08">https://medium.com/hackernoon/dont-be-the-bad-cop-in-pull-request-reviews-let-software-do-that-job-1eb9e574c2d1?source=collection_archive---------1-----------------------#2018-07-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="9ee3" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">并努力庆祝成就！</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/e2a65cc553f01e9c5be1364f5dbc1a1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rTFebvOqhjdAvuVB.jpg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Credit: <a class="ae jz" href="https://nerdist.com/tv-cap-inspector-gadget-on-netflix-ducktales-is-back-lady-gaga-in-american-horror-story-more/" rel="noopener ugc nofollow" target="_blank">Internet</a></figcaption></figure><p id="f5b4" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">访问http://www.mikenikles.com的<a class="ae jz" href="http://www.mikenikles.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv"/></a><strong class="kc hv">获取我的最新博文。</strong></p><p id="210e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">你上一次审查一个pull请求并提醒作者添加一个链接到你的bug跟踪系统是什么时候？添加一个缺失的标签怎么样？也许您找到了一个未设置审阅者/受托人的公开PR。</p><p id="7d9d" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我肯定有过这样的经历，很长一段时间，当我写下这样的评论时，我并没有想太多。有时，我甚至没有留下评论，只是简单地修复它。直到几年前我开始正式领导工程团队时，我才开始关注我自己的，也关注我的团队在工作中的生产力和整体幸福感。</p><h1 id="51f9" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">虚构的吉米不断告诉我该做什么</h1><p id="b13e" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">谁是虚构的吉米？可能是任何人，通常是高级工程师或已经在公司工作了一段时间的人(我曾经是，可能现在仍然是虚构的吉米，对不起团队！).就是这个人给公关添加评论，比如“请在公关标题中提到bug ticket #”或者如果你在一个不太友好的环境中，比如“缺少到吉拉的链接！”或者“标签！”。</p><p id="fd1f" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">虚构的吉米是好意，他真的是。不幸的是，新团队成员或工作经验较少的人可能不理解这一点。看，一些在软件行业工作多年的人理解一致性、定义良好的过程的重要性，以及在一定程度上需要挑剔。这是我们随着时间慢慢建立起来的理解。</p><p id="25dc" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">对于收到这样反馈的作者来说，这可能没什么大不了的——起初……但随着时间的推移，我真的相信人们开始对这样的评论感到消极。这导致了完全不必要的紧张，没有人谈论。</p><p id="8b3e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">那么，我们能做些什么呢？</p><h1 id="e428" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">救援的危险</h1><blockquote class="lt lu lv"><p id="0a12" class="ka kb lw kc b kd ke iv kf kg kh iy ki lx kk kl km ly ko kp kq lz ks kt ku kv hn dt translated">危险在您的CI过程中运行，并给团队机会自动化常见的代码审查杂务。</p><p id="5585" class="ka kb lw kc b kd ke iv kf kg kh iy ki lx kk kl km ly ko kp kq lz ks kt ku kv hn dt translated">这为您的构建提供了另一个逻辑步骤，通过这种危险可以帮助您在日常代码审查中轻松完成机械任务。</p><p id="0cc2" class="ka kb lw kc b kd ke iv kf kg kh iy ki lx kk kl km ly ko kp kq lz ks kt ku kv hn dt translated">你可以用危险来规范你的团队。让人类去思考更难的问题。</p><p id="14e6" class="ka kb lw kc b kd ke iv kf kg kh iy ki lx kk kl km ly ko kp kq lz ks kt ku kv hn dt translated">这是由于根据您用JavaScript或TypeScript创建的规则将消息留在PRs中的危险。</p><p id="37d1" class="ka kb lw kc b kd ke iv kf kg kh iy ki lx kk kl km ly ko kp kq lz ks kt ku kv hn dt translated">随着时间的推移，随着规则的遵守，消息被修改以反映代码评审的当前状态。</p></blockquote><p id="c6dc" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">这是取自Danger<a class="ae jz" href="http://danger.systems/js/" rel="noopener ugc nofollow" target="_blank">网站</a>的官方描述。我最近花了一点时间来安装和配置危险。他们的<a class="ae jz" href="http://danger.systems/js/guides/getting_started.html" rel="noopener ugc nofollow" target="_blank">入门</a>指南包含您需要的信息。或者，将<code class="eh ma mb mc md b">danger</code>作为依赖项添加到您的项目中，并运行<code class="eh ma mb mc md b">yarn danger init</code>或NPM的等效命令。它是一个交互式命令行工具，引导您完成安装过程。不到半个小时。</p><blockquote class="me"><p id="e0d3" class="mf mg hu bd mh mi mj mk ml mm mn kv ek translated">在我继续之前，让我澄清一下，Danger(就像虚构的Jimmy)在拉请求中添加了注释，以提醒人们他们忘记做的事情，他们可以对拉请求进行改进，等等。我相信来自人类和软件的信息在心理上的差异会产生很大的不同。此外，随着你继续阅读，你会看到，当人们做得好的时候，我们可以用某种方式使用危险来做出鼓励和激励的评论——甚至自动化一些常见的任务！</p></blockquote><h2 id="f502" class="mo kx hu bd ky mp mq mr lc ms mt mu lg kj mv mw li kn mx my lk kr mz na lm nb dt translated">我们最初的<code class="eh ma mb mc md b">dangerfile.js</code></h2><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nc nd l"/></div></figure><h2 id="dce9" class="mo kx hu bd ky mp ne mr lc ms nf mu lg kj ng mw li kn nh my lk kr ni na lm nb dt translated">对持续集成的更改</h2><p id="8b8f" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">在大多数情况下，这就像在您的管道中添加<code class="eh ma mb mc md b">yarn danger ci</code>一样简单。危险网站有许多CI系统的<a class="ae jz" href="http://danger.systems/js/guides/getting_started.html#setting-up-danger-to-run-on-your-ci" rel="noopener ugc nofollow" target="_blank">示例</a>。</p><h2 id="31c4" class="mo kx hu bd ky mp ne mr lc ms nf mu lg kj ng mw li kn nh my lk kr ni na lm nb dt translated">导致拉取请求</h2><p id="d5bf" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">作为设置过程的一部分，您将创建一个危险机器人用户。当<code class="eh ma mb mc md b">yarn danger ci</code>运行时，用户将结果作为对拉请求的注释发布。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nj"><img src="../Images/a34c07ec24e37d7ce88c3d70031da1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XG_S9ZVaTCuMFa_Dj0GeMg.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Danger results posted as a PR comment</figcaption></figure><p id="cc88" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">假设我修复了最后一个问题，并将票证URL添加到PR主体中。下次<code class="eh ma mb mc md b">yarn danger ci</code>运行时，它会更新现有的注释。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nk"><img src="../Images/46b0b52d333c1c7302e3b8f9f55e60db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWbnVKEGS09ybGdjjUB8XA.png"/></div></div></figure><p id="0b70" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">注意到编辑过的<em class="lw">下拉菜单了吗？这是Github <a class="ae jz" href="https://blog.github.com/changelog/2018-05-24-comment-edit-history/" rel="noopener ugc nofollow" target="_blank">引入</a>的新功能，它与Danger更新自己评论的方式非常契合。</em></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff nl"><img src="../Images/4cb54e970571a7422b42128fef1a3bda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*cuxpdzDj79ZVhQrfTqd0NQ.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Danger’s comment edit history</figcaption></figure><h2 id="3573" class="mo kx hu bd ky mp ne mr lc ms nf mu lg kj ng mw li kn nh my lk kr ni na lm nb dt translated">庆祝成就</h2><p id="6499" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">正如你在我们的<code class="eh ma mb mc md b">Dangerfile.js</code>顶部看到的，我要求团队成员回顾<a class="ae jz" href="http://danger.systems/js/usage/culture.html" rel="noopener ugc nofollow" target="_blank">http://danger.systems/js/usage/culture.html</a>。这是对变得越来越重要的事情的一个很好的总结:团队快乐。</p><p id="93b8" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">软件工程师面临一个又一个挑战，一个又一个死胡同。失败的测试、错误、性能和安全问题以及产品需求变更只是需要处理的几种情况。现在这里有另一个工具，它发布一个拉请求注释，并告诉我该做什么。为什么不用危险来庆祝成就呢？</p><p id="245a" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">让团队知道他们做得好。这是一个能走很长路的小姿态！一些想法:</p><ul class=""><li id="d8be" class="nm nn hu kc b kd ke kg kh kj no kn np kr nq kv nr ns nt nu dt translated">删除的代码比添加的代码多。</li><li id="8b0c" class="nm nn hu kc b kd nv kg nw kj nx kn ny kr nz kv nr ns nt nu dt translated">一个开发者开了一个PR来改进文档。</li><li id="b29e" class="nm nn hu kc b kd nv kg nw kj nx kn ny kr nz kv nr ns nt nu dt translated">有人修改了那段没人想碰的代码。</li><li id="ae98" class="nm nn hu kc b kd nv kg nw kj nx kn ny kr nz kv nr ns nt nu dt translated">分享一个新的、随机的激励性引语怎么样，就像Slack加载它时所做的那样？</li></ul><h1 id="94b3" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">但是等等，危险可以做的更多！</h1><p id="3930" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">到目前为止，我们看了Danger分析公关的能力，让作者知道该做什么或庆祝他们的成就。</p><p id="0fa2" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">在阅读<a class="ae jz" href="http://danger.systems/js/reference.html" rel="noopener ugc nofollow" target="_blank"> API参考文档</a>时，我注意到以下评论:</p><pre class="jk jl jm jn fq oa md ob oc aw od dt"><span id="4886" class="mo kx hu md b fv oe of l og oh">// An authenticated API so you can extend danger’s behavior by using the <a class="ae jz" href="https://developer.github.com/v3/" rel="noopener ugc nofollow" target="_blank">GitHub v3 API</a>.</span></pre><p id="4ecb" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">它可以在<code class="eh ma mb mc md b">danger.github.api</code>获得，并提供了大量的功能，在<a class="ae jz" href="https://octokit.github.io/rest.js/" rel="noopener ugc nofollow" target="_blank">这里</a>有详细的说明。</p><p id="50b2" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">在我们的例子中，<a class="ae jz" href="https://hackernoon.com/one-vs-many-why-we-moved-from-multiple-git-repos-to-a-monorepo-and-how-we-set-it-up-f4abb0cfe469" rel="noopener ugc nofollow" target="_blank">我们有一个包含NPM包和服务的monorepo </a>。为了直观地显示拉请求修改了什么，我们为每个包和服务添加了标签。PR的作者应该为他们修改的每个包和服务添加一个标签。</p><p id="b9db" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我从一开始就知道，我不能要求我的团队手动完成这项工作。如果我写的代码和我的团队写的一样多，我就不会想去做，所以我为什么要让他们去做呢？</p><p id="2ee9" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">有了危险，这现在可以自动化了！它总是同步的，没有人需要手动做任何事情。代码对于我们的回购结构来说过于具体，无法完整共享，但大致如下:</p><pre class="jk jl jm jn fq oa md ob oc aw od dt"><span id="336d" class="mo kx hu md b fv oe of l og oh">// Get a list of all files in this PR<br/>const allTouchedFiles = danger.git.created_files.concat(<br/>  danger.git.modified_files,<br/>  danger.git.deleted_files<br/>)</span><span id="ef08" class="mo kx hu md b fv oi of l og oh">// Determine the unique packages / services that changed<br/>const uniquePackagesAndServices = [/* Your way of figuring that out */]</span><span id="b54b" class="mo kx hu md b fv oi of l og oh">// Add labels<br/>danger.github.api.issues.addLabels({<br/>  labels: uniquePackagesAndServices<br/>})</span></pre><h1 id="9a00" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">结论</h1><p id="dbdf" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">有了危险，我们再一次自动化了小块重复的工作，这些工作曾经花费我们很多时间，或者在不同程度上造成了挫败感。我们甚至有一个工具来庆祝微小的成功，作为个人拉动请求的一部分。</p><p id="809d" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">对我来说最有希望的是<code class="eh ma mb mc md b">danger.github.api</code>,因为这为潜在的非常好的自动化过程打开了大门。</p><p id="8e07" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">你使用危险吗？我很想看看你的<code class="eh ma mb mc md b">Dangerfile</code>，并了解你用它做什么。请在评论中告诉我。</p><p id="038b" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt">👏 ❤️</p></div></div>    
</body>
</html>