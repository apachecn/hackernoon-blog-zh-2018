<html>
<head>
<title>Benchmarked Serverless observability tools, got very disappointed</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基准无服务器可观测性工具，非常失望</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/benchmarked-serverless-observability-tools-got-very-disappointed-e54f5e3381bf?source=collection_archive---------11-----------------------#2018-07-10">https://medium.com/hackernoon/benchmarked-serverless-observability-tools-got-very-disappointed-e54f5e3381bf?source=collection_archive---------11-----------------------#2018-07-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a19a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">可观察性是指排除应用程序中可能发生的未知问题的能力。如果你不熟悉，推荐你观看QCon 2018的<a class="ae jp" href="https://www.infoq.com/presentations/observable-distributed-ststems" rel="noopener ugc nofollow" target="_blank">如何构建可观测分布式系统</a>和<a class="ae jp" href="https://www.infoq.com/presentations/serverless-observability" rel="noopener ugc nofollow" target="_blank">无服务器可观测性的现在和未来</a>。</p><p id="ce22" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇文章中，我将向您解释一些最著名的<a class="ae jp" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>可观察性工具在我的测试场景中的表现，同时我将通过概述每个工具的优缺点来补充。我在基于Node.js的无服务器应用上测试了这些工具。它部署在<a class="ae jp" href="https://hackernoon.com/tagged/aws" rel="noopener ugc nofollow" target="_blank"> AWS </a>上，使用代理集成。你可以在我的Github 里找到代码<a class="ae jp" href="https://github.com/azarboon/blog-benchmark-observability" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e631" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">页（page的缩写）s:自从我发表这个帖子以来，一些供应商已经改善了他们的负面点/测试结果。我打算写一篇修改后的博文，测试他们的说法，反映他们的变化。在此之前，请阅读他们在本文末尾的评论，以了解他们声称的改进。</p><h2 id="26ef" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">目录</h2><ul class=""><li id="b1dc" class="kl km hu it b iu kn iy ko jc kp jg kq jk kr jo ks kt ku kv dt translated"><a class="ae jp" rel="noopener" href="/p/e54f5e3381bf#8abc">测试场景</a></li><li id="a128" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><a class="ae jp" rel="noopener" href="/p/e54f5e3381bf#5d95"> AWS X射线</a></li><li id="0667" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><a class="ae jp" rel="noopener" href="/p/e54f5e3381bf#0618">仪表板鸟</a></li><li id="d02b" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><a class="ae jp" rel="noopener" href="/p/e54f5e3381bf#aa4d">桑德拉</a></li><li id="ee00" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><a class="ae jp" rel="noopener" href="/p/e54f5e3381bf#e406"> IOPipe </a></li><li id="a583" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><a class="ae jp" rel="noopener" href="/p/e54f5e3381bf#861c">解决方法</a></li><li id="e96b" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><a class="ae jp" rel="noopener" href="/p/e54f5e3381bf#d5cf">结论</a></li></ul><h1 id="8abc" class="lb jr hu bd js lc ld le jw lf lg lh ka li lj lk kd ll lm ln kg lo lp lq kj lr dt translated">测试场景</h1><p id="640a" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">我通过用Gatling执行负载测试，针对三种场景测试了所有这些工具:</p><ul class=""><li id="f8b1" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">测试场景1:由于大量并发用户和重复，Lambda函数超时。提醒一下:目前，Lambda内置的度量“节流”不会显示超时错误。</li><li id="0c15" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">测试场景2: Lambda函数<a class="ae jp" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-lambda-proxy-integrations.html#api-gateway-simple-proxy-for-lambda-output-format" rel="noopener ugc nofollow" target="_blank">没有合适的格式</a>；“body”属性尚未字符串化。这个错误可能是由于疏忽造成的。</li><li id="7b0c" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">测试场景3: Dynamodb抛出ConditionalCheckFailedException，因为应用程序试图为分区键记录一个具有重复值的项目。</li></ul><p id="3acf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在场景1和2中，用户收到<em class="ly"> 502错误网关</em>和含糊的响应“内部服务器错误”。这就是为什么需要一个合适的可观测性工具来解决这些问题，尤其是在大型分布式应用程序的情况下。</p><p id="13ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果一个工具通过了测试，意味着它能够检测到问题，并显示给管理员。这可以使他/她更快地进行故障诊断。如果工具未能满足上述标准，结果将被标记为失败。然而，有些工具部分通过了测试，在这种情况下，我解释了它们的行为。</p><h1 id="5d95" class="lb jr hu bd js lc ld le jw lf lg lh ka li lj lk kd ll lm ln kg lo lp lq kj lr dt translated">自动气象站X射线</h1><p id="670d" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated"><strong class="it hv">结果</strong></p><ul class=""><li id="79fd" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated"><strong class="it hv">测试1:部分通过:</strong>从几周前开始有了新的改进:现在在超时错误的情况下，X射线显示有错误，但仍然没有澄清是什么问题。所以它希望用户猜出来或者用其他工具来解决问题。此外，UI令人困惑:在一个地方，它表明有一个错误，但下面几行，它表明没有错误(图1)。显然，他们的新改进仍在开发中。</li><li id="1cd3" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><strong class="it hv">测试2:失败。</strong>根据x光检查，一切正常，即使最终用户出现错误。</li><li id="e6e1" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><strong class="it hv">测试三:通过。</strong>表示有错误，同时显示异常堆栈跟踪。</li></ul><figure class="ma mb mc md fq me fe ff paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="fe ff lz"><img src="../Images/cb1b1c1caaa2935b16df9673e4fa7941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EIWdEPkmDmgWSYEBn1ohDw.png"/></div></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">Pic1: X-Ray doesn’t clarify what is the error type. Also UI is contradictory, by hovering on the clock icon, it shows “no faults or error”.</figcaption></figure><p id="b3a4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">优点</strong></p><ul class=""><li id="0d6c" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">Lambda内置了X射线代理。代理以批处理和异步方式发送数据，因此使用它不会给函数增加额外的延迟。</li><li id="5e96" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">快速响应的支持团队。你可以在<a class="ae jp" href="https://forums.aws.amazon.com/forum.jspa?forumID=241&amp;start=0" rel="noopener ugc nofollow" target="_blank"> AWS开发者论坛</a>与他们交流</li><li id="999e" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">AWS的托管服务。因此，它应该在功能上更加丰富，并且更加符合AWS的最佳实践。</li></ul><p id="3a2c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">缺点</strong></p><ul class=""><li id="8165" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">令人困惑的UI:除了图1，您还可以看看图2:尽管我选择了查看有错误的跟踪，但我看到每个跟踪都有令人困惑的“200”响应。200响应表示X射线服务已返回响应，并不意味着跟踪成功。这不是大多数用户期望看到的，并且会导致错误的解释。崔琰在他的博客文章<a class="ae jp" href="https://theburningmonk.com/2017/06/aws-x-ray-and-lambda-the-good-the-bad-and-the-ugly/" rel="noopener ugc nofollow" target="_blank">中提到了这个问题。更糟糕的是，尽管一年过去了，这个问题还没有得到解决。</a></li><li id="86a8" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">集成速度缓慢:尽管如此，<a class="ae jp" href="https://docs.aws.amazon.com/xray/latest/devguide/xray-services.html" rel="noopener ugc nofollow" target="_blank">很少有AWS服务</a>与X射线集成。因此，如果您正在使用DynamoDb或S3，X-Ray会为您提供推断的细分市场(这意味着缺乏细节)，因为即使在撰写本文时，这些服务还没有与X-Ray积极集成。</li><li id="9428" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">不成熟:仍有提升空间。例如，他们需要添加更多的功能来更好地调试，特别是以更简单、更简洁的方式加入<a class="ae jp" rel="noopener" href="/@azarboon/overcome-x-rays-issue-for-debugging-892498b14346">自定义错误</a>。<a class="ae jp" href="https://forums.aws.amazon.com/message.jspa?messageID=850436#850436" rel="noopener ugc nofollow" target="_blank">显然，他们正在努力使Lambda生成的片段可以访问</a>。</li></ul><figure class="ma mb mc md fq me fe ff paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="fe ff lz"><img src="../Images/19c3fe522cb7cda737bfbaf153765253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wuLud-oTjT3aCuoflYNN2A.png"/></div></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">Pic2: Buggy traces are shown with a 200 response, which is confusing.</figcaption></figure><h1 id="0618" class="lb jr hu bd js lc ld le jw lf lg lh ka li lj lk kd ll lm ln kg lo lp lq kj lr dt translated">仪表板鸟</h1><p id="af9b" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated"><strong class="it hv">结果</strong></p><ul class=""><li id="04d5" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated"><strong class="it hv">测试1:通过</strong></li><li id="47dc" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><strong class="it hv">测试2:失败</strong></li><li id="9f32" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><strong class="it hv">测试3:部分通过</strong>。Dashbird的用户界面不清楚，可能会令人困惑:在较高层次上，它显示跟踪成功，但深入到跟踪中，它显示错误(图3)。令人惊讶的是，这与X射线的结果不同，尽管Dashbird的痕迹是基于X射线的。它的行为是合理的，因此“一个异常不一定意味着函数失败。”这是真的，但是如果在跟踪中有异常，用户至少应该得到通知(例如，从高级图片)，并且在跟踪上只显示绿色和漂亮的“成功”是误导的。同时，在我看来，出现异常通常意味着有问题，值得调查，除非异常已经被主动捕获和处理。</li></ul><figure class="ma mb mc md fq me fe ff paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="fe ff lz"><img src="../Images/bfb500ac3c43514c5a662610a0ccb952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5oRHUpraLHED3uXSCuE41Q.png"/></div></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">Pic3: Dashbird shows a buggy trace as successful, and user should investigate all traces, dig them thoroughly to find if there is an exception.</figcaption></figure><p id="3603" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">优点</strong></p><ul class=""><li id="843a" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">非常容易设置，Dashbird的CloudFormation模板几乎可以做任何事情。一旦建立了CloudFormation堆栈，Dashbid就开始观察所有区域中的所有函数(从安全角度来看，这可能是不好的。我已经在缺点部分解决了这个问题)</li><li id="e879" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">有很好的用户界面和一些很好的功能，如实时跟踪，实现对特定功能的实时监控，以及警报功能。</li><li id="325c" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">从CloudWatch日志和AWS X射线获取数据。所以它不会给你的函数增加额外的延迟。</li><li id="c724" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">有一个友好和支持的客户服务。</li><li id="f3dd" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">显示整个函数执行时间的日志，而不仅仅是错误。这使得调试更加容易(图4)</li></ul><figure class="ma mb mc md fq me fe ff paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="fe ff lz"><img src="../Images/d59fe93ed114320d27c29a18c52fffa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k1Kuu9yobd3vijqSKr4hVQ.png"/></div></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">Pic4: Example log of a buggy trace, Dashbird shows logs from the whole function execution time.</figcaption></figure><p id="3d06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">缺点</strong></p><ul class=""><li id="0721" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">文档已经过时并且容易引起误解:在“入门”部分，它要求您设置特定的IAM策略。但是这个策略没有任何效果，它在那里只是因为文档没有被更新。</li><li id="4172" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">提供很少的、基本的和有些误导性的统计数据，例如平均持续时间和平均内存使用量。<a class="ae jp" href="https://www.dynatrace.com/news/blog/why-averages-suck-and-percentiles-are-great/" rel="noopener ugc nofollow" target="_blank">平均值是web性能分析的误导因素，</a>因此团队需要提供基于百分位数的统计数据。</li><li id="23d1" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">显示冷启动，但单独启动。需要冷启动统计数据。</li><li id="ebf0" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">继承了CloudWatch(例如粒度、延迟)和X-Ray的限制，因为它是基于它们的。</li><li id="9014" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">有一个主要的安全问题:它可以访问您的所有数据，并且您不能限制它。你可以在Dashbird应用中过滤数据，但这并不能阻止它接收你的数据。</li></ul><p id="45f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">致谢:</p><p id="e378" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感谢Dashbird的联合创始人Taavi rehemgi延长了我的试用期，让我能够调查他们的SaaS。</p><h1 id="aa4d" class="lb jr hu bd js lc ld le jw lf lg lh ka li lj lk kd ll lm ln kg lo lp lq kj lr dt translated">桑德拉</h1><p id="6af2" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated"><strong class="it hv">结果</strong></p><ul class=""><li id="f3d4" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated"><strong class="it hv">测试1:失败</strong></li><li id="8589" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><strong class="it hv">测试2:失败</strong></li><li id="3a67" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><strong class="it hv">测试3:失败</strong></li></ul><p id="dfed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">优点</strong></p><ul class=""><li id="2ba4" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">易于设置。</li><li id="9994" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">仪器的代码，这使桑德拉能够提供深入的技术概述。此外，这也可以替代AWS X射线。</li><li id="0a8f" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">利用<a class="ae jp" href="https://serverless.com/blog/state-of-serverless-observability-why-we-built-thundra/" rel="noopener ugc nofollow" target="_blank">异步发布</a>，因此不会给函数执行时间增加额外的延迟。</li><li id="3f77" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">有信息丰富图表和仪表板。此外，它还提供了一个清晰的功能列表，以及它们的统计数据(包括每个功能经历的冷启动总数)</li><li id="d63a" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">在安全性方面比Dashbird等公司更保守。它不需要访问你所有的数据。</li><li id="e5b9" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">是建立在一个好主意的基础上的，至少有一种方法可以替代x光，这很好。</li><li id="0959" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">拥有友好和支持的客户支持</li></ul><p id="ca49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我与它的产品经理讨论了对Node.js应用程序的支持。显然，桑德拉专注于Java应用程序，其Node.js相关功能远远落后。我还没有时间研究它的Java特性，但是如果有人正在使用基于Java的无服务器应用，我推荐他/她看看桑德拉。</p><p id="616f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">缺点</strong></p><ul class=""><li id="4812" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">对Node.js的支持不好，在写这篇文章的时候，我没有看到任何令人信服的理由用桑德拉来观察我的Node.js应用。</li><li id="8f7c" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">统计基于平均值，<a class="ae jp" href="https://www.dynatrace.com/news/blog/why-averages-suck-and-percentiles-are-great/" rel="noopener ugc nofollow" target="_blank">这是误导</a>。</li></ul><h1 id="e406" class="lb jr hu bd js lc ld le jw lf lg lh ka li lj lk kd ll lm ln kg lo lp lq kj lr dt translated">IOPipe</h1><p id="7231" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated"><strong class="it hv">结果</strong></p><ul class=""><li id="cdee" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated"><strong class="it hv">测试1:通过</strong></li><li id="4daa" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><strong class="it hv">测试2:失败</strong></li><li id="66a5" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated"><strong class="it hv">测试3:失败</strong></li></ul><p id="73cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">优点</strong></p><ul class=""><li id="5aa1" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">提供很少的基于百分点的统计数据</li><li id="4109" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">易于设置</li><li id="f6a6" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">具有警报功能</li><li id="6b75" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">具有搜索功能:您可以通过不同的关键字搜索您的调用，例如来自CW的requestId。然而，我粗略的初步猜测是，要对一个复杂的分布式应用程序进行故障排除，您可能需要使用一个复杂而全面的日志记录工具，而不是IOPipe。但是这当然取决于您的用例。</li></ul><p id="25e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">缺点</strong></p><ul class=""><li id="f226" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo ks kt ku kv dt translated">在他们目前的方法中，IOPpipe将数据同步发送到自己的系统；这给函数执行时间增加了额外的延迟，并且违背了在<a class="ae jp" href="https://d1.awsstatic.com/whitepapers/serverless-architectures-with-aws-lambda.pdf" rel="noopener ugc nofollow" target="_blank">带AWS Lambda的无服务器架构</a>中描述的最佳实践“在Lambda函数代码中捕获指标，并使用Lambda中提供的日志记录机制记录它。”IOPipe方法在<a class="ae jp" href="https://theburningmonk.com/2017/09/tips-and-tricks-for-logging-and-monitoring-aws-lambda-functions/" rel="noopener ugc nofollow" target="_blank">日志记录和监控AWS Lambda函数的提示和技巧</a>以及<a class="ae jp" href="https://dashbird.io/docs/learn/competitors-comparison/" rel="noopener ugc nofollow" target="_blank">dash bird vs Datadog vs io pipe</a>中有进一步的研究。这是一个严重的问题，这就是为什么我不推荐使用IOPpipe，除非他们解决了这个问题。似乎他们的团队正在研究这个问题，并试图提出一个<a class="ae jp" href="https://hub.iopipe.com/iopipe-faq/what-is-the-overhead-of-iopipe" rel="noopener ugc nofollow" target="_blank">异步和优化的替代方案</a>。还是等结果吧！</li><li id="d5c8" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">不显示冷启动的统计数据</li><li id="5ba4" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">不提供跟踪。</li><li id="b70a" class="kl km hu it b iu kw iy kx jc ky jg kz jk la jo ks kt ku kv dt translated">只显示错误堆栈跟踪的日志，这可能不太方便。如果像Dashbird那样显示整个函数的日志，会很有帮助。</li></ul><h1 id="861c" class="lb jr hu bd js lc ld le jw lf lg lh ka li lj lk kd ll lm ln kg lo lp lq kj lr dt translated">工作区</h1><p id="d48a" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">要检测错误，您可以主动采取行动并使用监控，而不是与可观察性工具协作。建议使用CloudWatch。Lambda内置了代理来发送日志到CloudWatch，使用它不会给你的函数增加额外的延迟，除非你发布定制的指标。</p><p id="1701" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了以优化的方式实现目标，您可以<a class="ae jp" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/MonitoringPolicyExamples.html" rel="noopener ugc nofollow" target="_blank">创建度量过滤器</a>。例如，对于错误场景1，您的指标过滤器可以有一个过滤器模式，如“任务超时时间”。然后，Metric filter在您的日志事件中进行搜索，只要找到匹配项，它就会增加相应CloudWatch指标的值。随后，您可以为该指标设置CloudWatch警报，并通过SNS等方式发布。此外，为了充分发挥CloudWatch的潜力，您可以通过JSON使用<a class="ae jp" href="https://stackify.com/what-is-structured-logging-and-why-developers-need-it/" rel="noopener ugc nofollow" target="_blank">结构化日志</a>。</p><h1 id="d5cf" class="lb jr hu bd js lc ld le jw lf lg lh ka li lj lk kd ll lm ln kg lo lp lq kj lr dt translated">结论</h1><p id="3168" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">我没有时间调查所有的无服务器可观察性工具，但是根据我对最突出的工具的调查，所有的工具都不成熟，或者在某种程度上不完整，需要改进。没有一个单一的解决方案可以让你完全完美地观察你的分布式应用。</p><p id="85ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">令人惊讶的是，有些问题，比如错误2，还没有被任何解决方案解决(甚至在CloudWatch日志中也没有)。但这个错误可能是由于疏忽而发生的，因为我遇到了这个问题，当时我的朋友想知道为什么最终用户会出现错误，并要求我调试他的应用程序。一切看起来都很好，没有错误或异常，但最终用户得到了错误。调试了大约一个小时后，我唯一想到的是输出格式。我是对的。他忘记了JSON.strinigfy()函数输出的body属性，AWS代理集成正在悄悄失败。这是一个简单的应用程序，但是想象一下如果这发生在一个大而复杂的分布式应用程序中会怎么样？你应该怎么找到它？</p><p id="ba0a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了实现可观察性，您需要串联使用不同的解决方案，并通过结构化日志记录获得深度监控的帮助。Pierre Vincent在他的QCon演讲<a class="ae jp" href="https://www.infoq.com/presentations/observable-distributed-ststems" rel="noopener ugc nofollow" target="_blank">中提到了这个问题</a>。</p><p id="02f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的3个测试场景只是例子。你认为应该优先观察的其他问题和错误是什么？你知道其他比上述工具更好的工具吗？你对实践中无服务器可观测性的现状有什么看法？</p><p id="9b1c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">脚注</strong></p><ol class=""><li id="c2ae" class="kl km hu it b iu iv iy iz jc lv jg lw jk lx jo mp kt ku kv dt translated">这只是我的看法。</li></ol><figure class="ma mb mc md fq me"><div class="bz el l di"><div class="mq mr l"/></div></figure></div></div>    
</body>
</html>