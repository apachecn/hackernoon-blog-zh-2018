<html>
<head>
<title>Build a REST API in 5 Minutes with PubNub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PubNub在5分钟内构建一个REST API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-a-rest-api-in-5-minutes-with-pubnub-38a5a982946e?source=collection_archive---------16-----------------------#2018-07-19">https://medium.com/hackernoon/build-a-rest-api-in-5-minutes-with-pubnub-38a5a982946e?source=collection_archive---------16-----------------------#2018-07-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/cdcc64d0d42086640760b8ab1cbc3056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t1gx8YZ7b_SlPTjc.png"/></div></div></figure><p id="26bd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">开发者需要API。每一家提供基于互联网的服务的科技公司都公开了一个应用程序编程接口，让开发人员更快地完成工作，让T2更聪明。</p><p id="a1ab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">构建一个API需要一个经验丰富的开发团队考虑所有的业务逻辑、安全性、网络负载和系统成本，以使公司成功地为客户服务。</p><p id="4dc2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://dashboard.pubnub.com/signup?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank"> <em class="kb">在这里注册</em> </a> <em class="kb">到</em> <strong class="je hv"> <em class="kb">获取自己的API密匙</em> </strong> <em class="kb">并访问</em><a class="ae ka" href="https://hackernoon.com/tagged/pubnub" rel="noopener ugc nofollow" target="_blank"><strong class="je hv"><em class="kb">PubNub</em></strong></a><strong class="je hv"><em class="kb">函数</em> </strong> <em class="kb">这样你就可以构建自己的API </em> <strong class="je hv"> <em class="kb">现在</em> </strong> <em class="kb">。</em></p><h1 id="ed03" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">API开发</h1><p id="f256" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">制作一个API所需的时间和精力可能非常昂贵。PubNub的产品和DevRel团队深谙工程团队必须克服的障碍，以产生一个令人敬畏的API。考虑到这些挑战，PubNub Functions工程团队已经构建了<strong class="je hv"> On Request </strong>事件处理程序特性，使开发人员能够在几分钟而不是几个月内全局部署无服务器<a class="ae ka" href="https://hackernoon.com/tagged/rest-api" rel="noopener ugc nofollow" target="_blank"> REST API </a>。</p><p id="9846" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">而不是</strong>抽出时间来</p><ul class=""><li id="af9c" class="lf lg hu je b jf jg jj jk jn lh jr li jv lj jz lk ll lm ln dt translated">选择云托管提供商</li><li id="e871" class="lf lg hu je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated">购买域名并设置DNS</li><li id="68ab" class="lf lg hu je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated">配置Kubernetes集群</li><li id="4fb0" class="lf lg hu je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated">将应用代码和微服务归档</li><li id="1869" class="lf lg hu je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated">将代码全局部署到几个存在点</li></ul><p id="4fc1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">…你可以通过点击一个按钮将你的代码部署到一个<strong class="je hv"> PubNub函数事件处理器</strong>，或者用<a class="ae ka" href="https://www.pubnub.com/docs/blocks/cli-api?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank"> PubNub命令行接口</a>部署一行代码。</p><h1 id="5449" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">PubNub函数</h1><p id="981f" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">PubNub函数是JavaScript事件处理程序，可以在传输中的PubNub消息上执行，或者在HTTPS上以RESTful API的请求/响应风格执行。如果你熟悉<a class="ae ka" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和<a class="ae ka" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>，那么On Request事件处理程序的开发将成为你的第二天性。</p><p id="9a77" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">部署代码可以在命令行上使用npm上的<code class="eh lt lu lv lw b">pubnub-cli</code>来完成，也可以通过CI/CD来完成，就像本教程中的<a class="ae ka" href="https://www.pubnub.com/blog/ci-cd-deploy-pubnub-functions-cli/?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank">一样。</a></p><p id="fc41" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用命令行进行部署，<a class="ae ka" href="https://www.pubnub.com/docs/blocks/cli-api?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank">参见这个工具</a>。</p><p id="9646" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">PubNub函数是无服务器的。无需担心部署流程、维护基础架构或扩展。我们在世界各地有几个同时部署您的代码的地点。这将确保您的用户无论身在何处都能获得极低的延迟体验<strong class="je hv">。</strong></p><figure class="ly lz ma mb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lx"><img src="../Images/af78b3907dc7eeb18e3700c04fdc82d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bYQ-ftwOQPAIAzQD.png"/></div></div></figure><p id="9868" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，在 <a class="ae ka" href="https://dashboard.pubnub.com/signup?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> PubNub </strong> </a>创建一个永久<strong class="je hv">免费账户，然后点击仪表板中的<strong class="je hv">功能选项卡</strong>。根据请求</strong>创建一个<strong class="je hv">模块</strong>和一个类型为<strong class="je hv">的事件处理程序。</strong></p><figure class="ly lz ma mb fq iv fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/b44c8d7a932273ce87f3890b43c2e85f.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*iZDXpzECxufdP13a.png"/></div></figure><p id="34bb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">按下右边的play按钮，使用左边的UI进行测试<strong class="je hv"> GET </strong>、<strong class="je hv"> POST </strong>、<strong class="je hv"> PUT </strong>、<strong class="je hv"> DELETE </strong>请求。</p><figure class="ly lz ma mb fq iv fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/fbed7bb158188cdd771456d957165205.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*nuJJ2ujH9qUPaHaR.png"/></div></figure><p id="a135" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">左边的<strong class="je hv">复制URL </strong>按钮给出了这个API可以访问的公共URL。结尾的<strong class="je hv">路径</strong>可以调整，但是URL本身是不可变的。</p><p id="a114" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kb">其余API示例在我的</em> <a class="ae ka" href="https://github.com/ajb413/pfunc-rest-api-example" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> <em class="kb"> GitHub库</em> </strong> </a> <em class="kb">中的一个事件处理程序中演示。</em></p><p id="ee6c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kb">使用</em> <a class="ae ka" href="https://www.pubnub.com/docs/blocks/cli-api?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank"> <em class="kb">功能CLI </em> </a> <em class="kb">或仪表盘中的编辑器部署功能代码。</em></p><p id="4175" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kb">接下来，在您喜欢的web浏览器中运行</em><strong class="je hv"><em class="kb">index.html</em></strong><em class="kb">文件，直接与您的REST API进行交互。</em></p><h1 id="18b4" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">例子</h1><p id="8d7f" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">这个repo中的事件处理程序展示了如何在API中发挥作用。每个路由URL参数都有一个指向JavaScript函数的控制器对象。</p><p id="a994" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为开发人员，您为每个控制器分配路径名，如代码片段所示。应该为使用的每个HTTP请求方法(如GET、POST、PUT、PATCH和DELETE)定义函数定义。方法是这些对象中的键，JavaScript函数是值。方法字符串被转换成<strong class="je hv">小写</strong>，所以像<strong class="je hv">获取</strong>、<strong class="je hv">发布</strong>、<strong class="je hv">放置</strong>、<strong class="je hv">修补</strong>，或者<strong class="je hv">删除</strong>那样定义你的函数。</p><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="md me l"/></div></figure><p id="b280" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最底层的代码根据请求方法和URL参数(如<strong class="je hv"> route </strong>)选择要执行的函数。如果在后端没有定义路线，则返回<strong class="je hv"> 404 </strong>。</p><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="md me l"/></div></figure><p id="2c7d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">以下功能是为账户<strong class="je hv">的API路径执行的控制器</strong>。account是一个JSON对象，包含各种客户数据。KV Store功能的使用类似于数据库，通过指定的<strong class="je hv"> ID </strong>检索/存储对象。这些函数展示了如何在您的API中实现基本的<strong class="je hv">创建</strong>、<strong class="je hv">读取</strong>、<strong class="je hv">更新</strong>或<strong class="je hv">销毁</strong>功能。</p><h1 id="c7ce" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">REST API的CRUD方法</h1><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="md me l"/></div></figure><h1 id="df6f" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">返回一个HTML响应</h1><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="md me l"/></div></figure><h1 id="d2c8" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">代理一个或多个外部API请求</h1><p id="5148" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">在一次事件处理程序执行中，最多可以发出3个<code class="eh lt lu lv lw b">xhr</code>请求。可以使用JavaScript promises将它们链接起来。</p><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="md me l"/></div></figure><p id="6560" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">同样，需要秘密API密钥的API请求可以在使用<a class="ae ka" href="https://www.pubnub.com/docs/blocks/vault-module?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank">库</a>的函数中正确实现。通过在事件处理程序编辑器页面中点击<strong class="je hv">我的秘密</strong>向模块添加秘密密钥。</p><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="md me l"/></div></figure><h1 id="375b" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">测试REST API</h1><p id="8a1f" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">我已经创建了一个HTML文件，可以在web浏览器中打开它来测试API功能。如果你还没有，将你的代码部署到PubNub函数中，作为一个<strong class="je hv">请求</strong>事件处理程序(在这里注册一个永远免费的账户<a class="ae ka" href="https://dashboard.pubnub.com/signup?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank">)。</a></p><p id="2ccb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，复制live REST API的URL，并将其粘贴到HTML文件的第50行。您可以在PubNub函数事件处理程序编辑器页面中找到该URL点击左侧的<strong class="je hv">复制网址</strong>按钮。</p><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="md me l"/></div></figure><p id="e79e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">保存文件，用Chrome或FireFox等现代浏览器打开。</p><figure class="ly lz ma mb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mf"><img src="../Images/a010871469d47bac1f02a23679a8224e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g3P5st76Va93_2b5.png"/></div></div></figure><p id="7fff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，使用UI<strong class="je hv">选择一个单选按钮</strong>。它们中的每一个都对应于PubNub函数中的一个端点。选择一个使用普通JavaScript的<strong class="je hv"> XMLHttpRequest </strong>准备适当的请求。要执行，按下<strong class="je hv">发送请求</strong>按钮。在您按下按钮后，JavaScript代码将请求和响应细节写入屏幕。</p><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="md me l"/></div></figure><h1 id="1967" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">警报和监控</h1><p id="f971" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">想知道您的API是否正在经历宕机？将<code class="eh lt lu lv lw b">pubnub</code>模块包含在您的事件处理程序中，并在发生<strong class="je hv">时发布到通道。catch </strong>块执行。这可以配置为弹性搜索和寻呼功能。您也可以将此repo用于<a class="ae ka" href="https://github.com/bigoper/pubnub-monitoring-functions" rel="noopener ugc nofollow" target="_blank">持续监控应用</a>。</p><h1 id="614e" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">成功！</h1><p id="1108" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">你现在可以看到PubNub函数非常强大。使用该系统部署的事件处理程序可以在任何时候处理大量的请求。用这个<a class="ae ka" href="https://github.com/ajb413/pfunc-rest-api-example" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>做自己的REST API。如果您有任何问题或需要一些建议，请联系devrel@pubnub.com。</p></div><div class="ab cl mg mh hc mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hn ho hp hq hr"><p id="da95" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kb">原载于</em><a class="ae ka" href="https://www.pubnub.com/blog/build-a-rest-api-in-5-minutes-with-pubnub/?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-June-24" rel="noopener ugc nofollow" target="_blank"><em class="kb">www.pubnub.com</em></a><em class="kb">。</em></p><figure class="ly lz ma mb fq iv"><div class="bz el l di"><div class="mn me l"/></div></figure></div></div>    
</body>
</html>