<html>
<head>
<title>How to prepare your iOS app for UI testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•å‡†å¤‡æ‚¨çš„iOSåº”ç”¨ç¨‹åºè¿›è¡ŒUIæµ‹è¯•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/a-developer-and-tester-friendly-guide-to-ui-testing-on-ios-71fbd20f22a8?source=collection_archive---------12-----------------------#2018-07-23">https://medium.com/hackernoon/a-developer-and-tester-friendly-guide-to-ui-testing-on-ios-71fbd20f22a8?source=collection_archive---------12-----------------------#2018-07-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="a4f5" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">ä¸ºä½ çš„iOSåº”ç”¨ç¼–å†™ç¨³å®šä¸€è‡´çš„UIæµ‹è¯•</h2></div><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="jo jp l"/></div></figure><p id="a2a8" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">å»å¹´ï¼Œæˆ‘ä¸æˆ‘ä»¬çš„æµ‹è¯•äººå‘˜å¯†åˆ‡åˆä½œï¼Œå°†ç¬¬ä¸€ä¸ªUIæµ‹è¯•ç›®æ ‡æ·»åŠ åˆ°æˆ‘ä»¬çš„iOSé¡¹ç›®ä¸­ã€‚æˆ‘ä»¬æœ‰ä¸€äº›ç®€å•çš„ç›®æ ‡æ¥è¡¡é‡æˆ‘ä»¬çš„æˆåŠŸ:</p><ul class=""><li id="c46b" class="km kn hu js b jt ju jw jx jz ko kd kp kh kq kl kr ks kt ku dt translated">ç¼–å†™æ˜“äºç»´æŠ¤çš„æµ‹è¯•ã€‚</li><li id="2f03" class="km kn hu js b jt kv jw kw jz kx kd ky kh kz kl kr ks kt ku dt translated">ä»æµ‹è¯•ä¸­æŠ½è±¡å‡ºappå†…éƒ¨æ¥çº¿å’Œæ¶æ„ã€‚</li><li id="670d" class="km kn hu js b jt kv jw kw jz kx kd ky kh kz kl kr ks kt ku dt translated">ä¸€ä¸ªç®€å•çš„æœºåˆ¶æ¥<a class="ae la" href="https://github.com/AliSoftware/OHHTTPStubs" rel="noopener ugc nofollow" target="_blank">å­˜æ ¹</a>ç›¸å…³çš„APIè°ƒç”¨(ä½¿ç”¨<a class="ae la" href="https://www.charlesproxy.com/" rel="noopener ugc nofollow" target="_blank">æŸ¥å°”æ–¯</a>æˆ–<a class="ae la" href="https://itunes.apple.com/app/charles-proxy/id1134218562?mt=8" rel="noopener ugc nofollow" target="_blank">æŸ¥å°”æ–¯ä»£ç†</a>æ‰¾åˆ°ç›¸å…³çš„è°ƒç”¨)ã€‚</li></ul></div><div class="ab cl lb lc hc ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hn ho hp hq hr"><h2 id="7467" class="li lj hu bd lk ll lm ln lo lp lq lr ls jz lt lu lv kd lw lx ly kh lz ma mb mc dt translated">æ‚¨å®é™…æµ‹è¯•çš„æ˜¯ä»€ä¹ˆ</h2><p id="7061" class="pw-post-body-paragraph jq jr hu js b jt md iv jv jw me iy jy jz mf kb kc kd mg kf kg kh mh kj kk kl hn dt translated">ä¾‹å¦‚ï¼Œä¸ºäº†ç¡®ä¿ä½ æµ‹è¯•çš„æ˜¯ä½ çš„åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯ä½ çš„åç«¯ï¼ŒæŠŠä½ æ‰€æœ‰çš„APIè°ƒç”¨éƒ½æˆªæ‰æ˜¯ä¸ªå¥½ä¸»æ„ã€‚è¿™ä¹Ÿä¿è¯äº†ä¸€è‡´æ€§ã€ç¨³å®šæ€§å’Œä¸é‚£ä¹ˆè„†å¼±çš„UIæµ‹è¯•ã€‚</p><p id="c841" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">ä½ çš„ç›®æ ‡ä¸åº”è¯¥æ˜¯æµ‹è¯•ä½ çš„åç«¯æˆ–å®ƒå’Œå‰ç«¯ä¹‹é—´çš„é›†æˆï¼Œè€Œæ˜¯å­¤ç«‹åœ°æµ‹è¯•åº”ç”¨ç¨‹åºï¼Œå¹¶ç¡®è®¤å®ƒåœ¨ä¸€äº›é¢„å…ˆç¡®å®šçš„æ¡ä»¶ä¸‹ä¸€è‡´åœ°å·¥ä½œã€‚</p></div><div class="ab cl lb lc hc ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hn ho hp hq hr"><h1 id="df62" class="mi lj hu bd lk mj mk ml lo mm mn mo ls ja mp jb lv jd mq je ly jg mr jh mb ms dt translated">è®¾ç½®äº‹ç‰©</h1><p id="ac18" class="pw-post-body-paragraph jq jr hu js b jt md iv jv jw me iy jy jz mf kb kc kd mg kf kg kh mh kj kk kl hn dt translated">å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºè¿˜æ²¡æœ‰UIæµ‹è¯•ç›®æ ‡ï¼Œæ‚¨å°†ä¸å¾—ä¸è½¬åˆ°<code class="eh mt mu mv mw b"><strong class="js hv">File</strong> &gt; <strong class="js hv">New</strong> &gt; <strong class="js hv">Target</strong> &gt; <strong class="js hv">iOS UI Testing Bundle</strong></code>æ·»åŠ ä¸€ä¸ªã€‚</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="fe ff mx"><img src="../Images/9845c4a5d64622e25453f23d74c79645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ugTelnO1Rljmpqxug8ApmQ.png"/></div></div></figure><h2 id="864e" class="li lj hu bd lk ll lm ln lo lp lq lr ls jz lt lu lv kd lw lx ly kh lz ma mb mc dt translated">XCTestæ¡†æ¶å¦‚ä½•å·¥ä½œ</h2><p id="a3f8" class="pw-post-body-paragraph jq jr hu js b jt md iv jv jw me iy jy jz mf kb kc kd mg kf kg kh mh kj kk kl hn dt translated">è®©å¤§å¤šæ•°äººæ„Ÿåˆ°å›°æƒ‘çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œä½ ä¸èƒ½åœ¨ä½ çš„<code class="eh mt mu mv mw b"><strong class="js hv">XCTestCase</strong></code>ä¸­å­˜æ ¹ä½ çš„APIè°ƒç”¨ï¼Œå› ä¸ºå®ƒåªæ˜¯æ‰“å¼€ä½ çš„åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥ä½ åœ¨é‚£é‡Œåšçš„ä»»ä½•å­˜æ ¹éƒ½å°†ä¸¢å¤±ã€‚</p><p id="0cd3" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">ä½ å¿…é¡»ä½¿ç”¨<a class="ae la" href="https://developer.apple.com/documentation/xctest/xcuiapplication/1500477-launcharguments" rel="noopener ugc nofollow" target="_blank"> launch arguments </a>æ¥ä»£æ›¿ï¼Œè®©ä½ çš„åº”ç”¨ç¨‹åºçŸ¥é“å®ƒå¤„äºUIæµ‹è¯•æ¨¡å¼ï¼Œä»€ä¹ˆAPIè°ƒç”¨éœ€è¦å­˜æ ¹ã€‚</p><h2 id="ef55" class="li lj hu bd lk ll lm ln lo lp lq lr ls jz lt lu lv kd lw lx ly kh lz ma mb mc dt translated">å¦‚ä½•å­˜æ ¹ä½ çš„APIè°ƒç”¨</h2><p id="5dc8" class="pw-post-body-paragraph jq jr hu js b jt md iv jv jw me iy jy jz mf kb kc kd mg kf kg kh mh kj kk kl hn dt translated">å½“æ¶‰åŠåˆ°å‘ä½ çš„åº”ç”¨è¿”å›è™šå‡æ•°æ®(é¢„å…ˆå†³å®šçš„å“åº”)æ—¶ï¼Œä½ æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œæ¯”å¦‚æ¨¡ä»¿å­˜å‚¨åº“(ç®¡ç†è€…ï¼Œç­‰ç­‰..åŸºäºæ‚¨çš„åº”ç”¨ç¨‹åºæ¶æ„)åè®®ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯åœ¨å‘¼å«å®é™…åˆ°è¾¾ç½‘ç»œå±‚ä¹‹å‰é¿å¼€å®ƒã€‚</p><p id="541b" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">å¦ä¸€ä¸ªé€‰æ‹©æ˜¯é˜»æ­¢ä½ çš„åº”ç”¨ç¨‹åºåœ¨æµ‹è¯•ä¸­å¯èƒ½å‘å‡ºçš„æ‰€æœ‰webè°ƒç”¨ã€‚ä½¿ç”¨<a class="ae la" href="https://github.com/AliSoftware/OHHTTPStubs" rel="noopener ugc nofollow" target="_blank">ohhttpsubs</a>æ—¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå®é™…ä¸Šæ‰§è¡Œäº†å­˜å‚¨åº“ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œå½“æ‚¨è®¿é—®ç½‘ç»œå±‚æ—¶<a class="ae la" href="https://github.com/AliSoftware/OHHTTPStubs" rel="noopener ugc nofollow" target="_blank">ohhttpsubs</a>ä¼šè¿”å›é¢„å…ˆå“åº”æˆ–é”™è¯¯ã€‚ä¸ç¬¬ä¸€ä¸ªé€‰é¡¹ä¸åŒï¼Œè¿™å®é™…ä¸Šä¼šæš´éœ²å­˜å‚¨åº“ä¸­éšè—çš„é”™è¯¯ã€‚</p><h2 id="28e1" class="li lj hu bd lk ll lm ln lo lp lq lr ls jz lt lu lv kd lw lx ly kh lz ma mb mc dt translated">ä¸€ä¸ªç®€å•çš„ç»“æ„æ¥å­˜æ ¹ç°æœ‰çš„å’Œæœªæ¥çš„APIè°ƒç”¨</h2><p id="28a8" class="pw-post-body-paragraph jq jr hu js b jt md iv jv jw me iy jy jz mf kb kc kd mg kf kg kh mh kj kk kl hn dt translated">åœ¨æˆ‘ä»¥å‰ç¼–å†™å¯ç»´æŠ¤çš„UIæµ‹è¯•çš„å°è¯•ä¸­ï¼Œä¸»è¦æ˜¯åœ¨Androidä¸Šï¼Œæ¨¡ä»¿å­˜å‚¨åº“æ–¹æ³•æ€»æ˜¯å¾ˆæ£˜æ‰‹ï¼Œç‰¹åˆ«æ˜¯ä»æµ‹è¯•äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šæ¯å¤©éƒ½åœ¨ä»£ç åº“ä¸Šå·¥ä½œã€‚å¦ä¸€æ–¹é¢ï¼Œæ‚¨å¯ä»¥è½»æ¾è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæ‰¾å‡ºåº”ç”¨ç¨‹åºå‘å‡ºçš„æ‰€æœ‰è¯·æ±‚åŠå…¶å“åº”ï¼Œå¹¶è½»æ¾å¤„ç†å®ƒä»¬ï¼Œè€Œä¸å¿…æ‹…å¿ƒä»£ç ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p id="bfd4" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">æˆ‘ä»ç„¶æƒ³è®©ä»£ç æ¸…æ™°ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå®¹æ˜“åœ°æ˜ å°„åˆ°æˆ‘ä»¬çš„APIç»“æ„/æ–‡æ¡£ä¸­ã€‚ä»»ä½•RESTåç«¯éƒ½æœ‰ä¸åŒçš„APIï¼Œæ¯ä¸ªAPIéƒ½æœ‰ä¸€å †ç«¯ç‚¹ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä»£ç çœ‹èµ·æ¥çš„æ ·å­ã€‚æˆ‘ç”šè‡³å¯èƒ½ä¼šè€ƒè™‘å°†æ¥è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰è¿™äº›ä»£ç ã€‚</p><pre class="jj jk jl jm fq ne mw nf ng aw nh dt"><span id="d6f9" class="li lj hu mw b fv ni nj l nk nl"><strong class="mw hv">protocol </strong>StubApi {   <br/>}</span><span id="4e03" class="li lj hu mw b fv nm nj l nk nl"><strong class="mw hv">protocol </strong>StubEndpoint {<br/>    <br/>    <strong class="mw hv">var </strong>path: String { <strong class="mw hv">get </strong>}<br/>    <strong class="mw hv">var </strong>name: String { <strong class="mw hv">get </strong>}<br/>    <strong class="mw hv">var </strong>type: String { <strong class="mw hv">get </strong>}<br/>    <strong class="mw hv">var </strong>method: HttpMethod { <strong class="mw hv">get </strong>}<br/>    <strong class="mw hv">var </strong>params: [String: String]? { <strong class="mw hv">get </strong>}<br/>    <br/>}</span><span id="a8a9" class="li lj hu mw b fv nm nj l nk nl"><strong class="mw hv">extension </strong>StubEndpoint {<br/>    <br/>    // Helper serialization function.<br/>    <strong class="mw hv">func </strong>toDictionary() -&gt; [String: String] {<br/>        <strong class="mw hv">var </strong>dictionary = [String: String]()<br/>        dictionary["path"] = path<br/>        dictionary["name"] = name<br/>        dictionary["type"] = type<br/>        dictionary["method"] = method.rawValue<br/>        <br/>        <strong class="mw hv">if let </strong>params = params {<br/>            <strong class="mw hv">let </strong>json = <strong class="mw hv">try</strong>! JSONSerialization.data(withJSONObject: params, options: JSONSerialization.WritingOptions())<br/>            dictionary["params"] = String(data: json, encoding: String.Encoding(rawValue: String.Encoding.utf8.rawValue))<br/>        }<br/>        <br/>        <strong class="mw hv">return </strong>dictionary<br/>    }<br/>    <br/>}</span></pre><p id="adae" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">æˆ‘è¿˜åŒ…æ‹¬äº†<code class="eh mt mu mv mw b"><strong class="js hv">StubbingManager</strong></code>å°†æ”¯æŒçš„HTTPæ–¹æ³•å’Œèµ„æºç±»å‹ã€‚</p><pre class="jj jk jl jm fq ne mw nf ng aw nh dt"><span id="6cc5" class="li lj hu mw b fv ni nj l nk nl"><strong class="mw hv">enum </strong>HttpMethod: String {<br/>    <strong class="mw hv">case </strong><em class="nn">GET</em>, <em class="nn">POST</em>, <em class="nn">DELETE</em>, <em class="nn">PUT<br/>    <br/>    </em><strong class="mw hv">static func </strong>fromString(rawValue: String?) -&gt; HttpMethod {<br/>        <strong class="mw hv">guard let </strong>rawValue = rawValue <strong class="mw hv">else </strong>{ fatalError() }<br/>        <br/>        <strong class="mw hv">switch </strong>rawValue {<br/>        <strong class="mw hv">case </strong>HttpMethod.<em class="nn">GET</em>.rawValue:<br/>            <strong class="mw hv">return </strong>.<em class="nn">GET<br/>        </em><strong class="mw hv">case </strong>HttpMethod.<em class="nn">POST</em>.rawValue:<br/>            <strong class="mw hv">return </strong>.<em class="nn">POST<br/>        </em><strong class="mw hv">case </strong>HttpMethod.<em class="nn">DELETE</em>.rawValue:<br/>            <strong class="mw hv">return </strong>.<em class="nn">DELETE<br/>        </em><strong class="mw hv">case </strong>HttpMethod.<em class="nn">PUT</em>.rawValue:<br/>            <strong class="mw hv">return </strong>.<em class="nn">PUT<br/>        </em><strong class="mw hv">default</strong>:<br/>            fatalError()<br/>        }<br/>    }<br/>}</span><span id="f5be" class="li lj hu mw b fv nm nj l nk nl"><strong class="mw hv">enum </strong>ResourceType: String {<br/>    <strong class="mw hv">case </strong>J<em class="nn">SON<br/></em>}</span></pre><p id="baee" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">ä¸€ä¸ªç¤ºä¾‹APIå­˜æ ¹çœ‹èµ·æ¥åƒè¿™æ ·</p><pre class="jj jk jl jm fq ne mw nf ng aw nh dt"><span id="7873" class="li lj hu mw b fv ni nj l nk nl">// <a class="ae la" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/</a><br/><strong class="mw hv">class </strong>PostsStubApi: StubApi {<br/>    <br/>    <strong class="mw hv">class </strong>RetrieveOnePostItem: StubEndpoint {<br/>        <strong class="mw hv">let </strong>path = "/posts/1"<br/>        // This file name, it can exist anywhere but it needs to be accessible by the app target as well as the UI test target.<br/>        <strong class="mw hv">let </strong>name = "stub_discarded_jobs"<br/>        <strong class="mw hv">let </strong>type = ResourceType.<em class="nn">json</em>.rawValue<br/>        <strong class="mw hv">let </strong>method = HttpMethod.<em class="nn">GET<br/>        </em><strong class="mw hv">let </strong>params: [String : String]? = <strong class="mw hv">nil<br/>    </strong>}<br/>}</span></pre></div><div class="ab cl lb lc hc ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hn ho hp hq hr"><h2 id="5c22" class="li lj hu bd lk ll lm ln lo lp lq lr ls jz lt lu lv kd lw lx ly kh lz ma mb mc dt translated">å¦‚ä½•åœ¨UIæµ‹è¯•æ¨¡å¼ä¸‹å¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åº</h2><p id="c924" class="pw-post-body-paragraph jq jr hu js b jt md iv jv jw me iy jy jz mf kb kc kd mg kf kg kh mh kj kk kl hn dt translated">å› ä¸ºæ‚¨ä¸èƒ½åœ¨æµ‹è¯•ä¸­å­˜æ ¹APIè°ƒç”¨ï¼Œæ‰€ä»¥å½“ä»UIæµ‹è¯•å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨å¿…é¡»å°†ä¸€äº›æ•°æ®ä¼ é€’ç»™åº”ç”¨ç¨‹åºã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code class="eh mt mu mv mw b"><strong class="js hv">XCUIApplication</strong></code>ä¸Šä½¿ç”¨<code class="eh mt mu mv mw b"><strong class="js hv">launchEnvironment</strong></code>ã€‚</p><pre class="jj jk jl jm fq ne mw nf ng aw nh dt"><span id="141b" class="li lj hu mw b fv ni nj l nk nl"><strong class="mw hv">class </strong>BaseTestCase: QuickSpec { // Or XCTestCase<br/>    <br/>    <strong class="mw hv">private var </strong>stubManager: StubManager = StubManager()<br/>    <br/>    // Easily add a new stub before your test run.<br/>    <strong class="mw hv">func </strong>stub(endpoint: StubEndpoint) {<br/>        stubManager.add(stub: endpoint)<br/>    }</span><span id="6d85" class="li lj hu mw b fv nm nj l nk nl">    // Remove all tests after a test has ran.<br/>    <strong class="mw hv">func </strong>removeAllStubs() {<br/>        stubManager.removeAllStubs();<br/>    }</span><span id="023c" class="li lj hu mw b fv nm nj l nk nl">    <strong class="mw hv">// Here is where the magic happens.</strong><br/>    <strong class="mw hv">func </strong>launch(app: XCUIApplication) {<br/>        app.launchEnvironment["stubs"] = stubManager.toJSON()<br/>        app.launch()<br/>    }<br/>    <br/>}</span></pre><p id="8f23" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">å¹¶ä¸”<code class="eh mt mu mv mw b"><strong class="js hv">StubManager</strong></code>å¯ä»¥å­˜åœ¨äºåº”ç”¨ç¨‹åºæˆ–è€…UIæµ‹è¯•ç›®æ ‡ä¸­ï¼Œå®ƒåªéœ€è¦åœ¨ä¸¤ä¸ªç›®æ ‡ä¹‹é—´å…±äº«ã€‚</p><pre class="jj jk jl jm fq ne mw nf ng aw nh dt"><span id="c93a" class="li lj hu mw b fv ni nj l nk nl"><strong class="mw hv">import </strong>OHHTTPStubs<br/><br/><strong class="mw hv">final class </strong>StubManager {<br/>    <br/>    <strong class="mw hv">let </strong>jsonHeaders = ["content-type": "application/json"]<br/>    <br/>    <strong class="mw hv">private var </strong>stubs: [StubEndpoint] = []<br/>    <br/>    <strong class="mw hv">deinit </strong>{<br/>        killStubs()<br/>    }<br/>    <br/>    <strong class="mw hv">func </strong>add(stub: StubEndpoint) {<br/>        stubs.append(stub)<br/>    }<br/>    <br/>    <strong class="mw hv">func </strong>loadStubs() {<br/>        // Just stub any image request to avoid any web calls.<br/>        stub(condition: isExtension("png") || isExtension("jpg") || isExtension("gif")) { _ <strong class="mw hv">in<br/>            let </strong>stubPath = OHPathForFile("stub.jpg", type(of: <strong class="mw hv">self</strong>))<br/>            <strong class="mw hv">return </strong>fixture(filePath: stubPath!, headers: ["Content-Type" <strong class="mw hv">as </strong>NSObject:"image/jpeg" <strong class="mw hv">as </strong>AnyObject])<br/>        }</span><span id="7a5c" class="li lj hu mw b fv nm nj l nk nl">        <strong class="mw hv">// Now let us go through the stubs array and apply them.</strong><br/>        <strong class="mw hv">for </strong>stub <strong class="mw hv">in </strong>stubs {<br/>            // Base url for your endpoints.<br/>            <strong class="mw hv">var </strong>condition = isHost("<a class="ae la" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com</a>")<br/>            condition = condition &amp;&amp; isPath(stub.path)<br/>            <br/>            <strong class="mw hv">switch</strong>(stub.method) {<br/>            <strong class="mw hv">case </strong>.<em class="nn">GET</em>: condition = condition &amp;&amp; isMethodGET()<br/>            <strong class="mw hv">case </strong>.<em class="nn">POST</em>: condition = condition &amp;&amp; isMethodPOST()<br/>            <strong class="mw hv">case </strong>.<em class="nn">DELETE</em>: condition = condition &amp;&amp; isMethodDELETE()<br/>            <strong class="mw hv">case </strong>.<em class="nn">PUT</em>: condition = condition &amp;&amp; isMethodPUT()<br/>            }<br/>            <br/>            <strong class="mw hv">if let </strong>params = stub.params {<br/>                condition = condition &amp;&amp; containsQueryParams(params)<br/>            }<br/>            <br/>            stub(condition: condition) { _ <strong class="mw hv">in<br/>                let </strong>bundle = Bundle(for: type(of: <strong class="mw hv">self</strong>))<br/>                <strong class="mw hv">let </strong>path = bundle.path(forResource: stub.name, ofType: stub.type)<br/>                <strong class="mw hv">return </strong>OHHTTPStubsResponse(fileAtPath: path!, statusCode: 200, headers: <strong class="mw hv">self</strong>.jsonHeaders)<br/>            }<br/>        }<br/>    }<br/>    <br/>    <strong class="mw hv">func </strong>removeAllStubs() {<br/>        stubs = []<br/>    }<br/>    <br/>    <strong class="mw hv">func </strong>killStubs() {<br/>        OHHTTPStubs.removeAllStubs()<br/>    }</span><span id="1e5f" class="li lj hu mw b fv nm nj l nk nl"><strong class="mw hv">    // To serialize stubs and send them to the app.</strong><br/>    <strong class="mw hv">func </strong>toJSON() -&gt; String? {<br/>        <strong class="mw hv">var </strong>arrayOfStubs = [[String: String]]()<br/>        <br/>        <strong class="mw hv">for </strong>sutb <strong class="mw hv">in </strong>stubs {<br/>            arrayOfStubs.append(stub.toDictionary())<br/>        }<br/>        <br/>        <strong class="mw hv">let </strong>json = <strong class="mw hv">try</strong>! JSONSerialization.data(withJSONObject: arrayOfStubs, options: JSONSerialization.WritingOptions())<br/>        <br/>        <strong class="mw hv">return </strong>String(data: json, encoding: String.Encoding(rawValue: String.Encoding.utf8.rawValue))<br/>    }</span><span id="da98" class="li lj hu mw b fv nm nj l nk nl"><strong class="mw hv">    // To deserialize stubs in the app and apply them.</strong><br/>    <strong class="mw hv">func </strong>fromJSON(json: String) {<br/>        stubs.removeAll()<br/>        <br/>        <strong class="mw hv">let </strong>data = <strong class="mw hv">try</strong>! JSONSerialization.jsonObject(with: json.data(using: String.Encoding.utf8)!, options: JSONSerialization.ReadingOptions())<br/>        <br/>        <strong class="mw hv">if let </strong>stubData = data <strong class="mw hv">as</strong>? [[String: String]] {<br/>            <strong class="mw hv">for </strong>stub <strong class="mw hv">in </strong>stubData {<br/>                stubs.append(AnyStubEndpoint(dictionary: stub))<br/>            }<br/>        }<br/>    }<br/>    <br/>    <strong class="mw hv">struct </strong>AnyStubEndpoint: StubEndpoint {<br/>        <br/>        <strong class="mw hv">var </strong>path: String<br/>        <strong class="mw hv">var </strong>name: String<br/>        <strong class="mw hv">var </strong>type: String<br/>        <strong class="mw hv">var </strong>method: HttpMethod<br/>        <strong class="mw hv">var </strong>params: [String: String]?<br/>        <br/>        <strong class="mw hv">init</strong>(dictionary: [String: String]) {<br/>            uri = dictionary["path"] ?? ""<br/>            name = dictionary["name"] ?? ""<br/>            type = dictionary["type"] ?? ""<br/>            method = HttpMethod.fromString(rawValue: dictionary["method"])<br/>                <br/>            <strong class="mw hv">if let </strong>params = dictionary["params"] {<br/>                <strong class="mw hv">self</strong>.params = <strong class="mw hv">try</strong>! JSONSerialization.jsonObject(with: params.data(using: String.Encoding.utf8)!, options: JSONSerialization.ReadingOptions()) <strong class="mw hv">as</strong>? [String: String]<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="e1f9" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">å‰©ä¸‹çš„å°±æ˜¯æ£€æŸ¥<code class="eh mt mu mv mw b"><strong class="js hv">AppDelegate</strong></code>æ˜¯å¦è®¾ç½®äº†<code class="eh mt mu mv mw b"><strong class="js hv">launchEnvironment</strong></code>ã€‚</p><pre class="jj jk jl jm fq ne mw nf ng aw nh dt"><span id="ee06" class="li lj hu mw b fv ni nj l nk nl"><strong class="mw hv">extension </strong>AppDelegate {<br/>    <br/>    <strong class="mw hv">func </strong>isStubbing() -&gt; Bool {<br/>        <strong class="mw hv">return </strong>ProcessInfo.processInfo.environment["stubs"] != <strong class="mw hv">nil<br/>    </strong>}<br/>    <br/>    <strong class="mw hv">func </strong>configureStubsIfNeeded() -&gt; Bool {<br/>        <strong class="mw hv">if </strong>isStubbing() {<br/>            stubManager = StubManager()<br/>            <strong class="mw hv">if let </strong>json = ProcessInfo.processInfo.environment["stubs"] {<br/>                stubManager.fromJSON(json: json)<br/>                stubManager.loadStubs()<br/>            }<br/>            <br/>            <strong class="mw hv">return true<br/>        </strong>}<br/>        <strong class="mw hv">else </strong>{<br/>            <strong class="mw hv">guard </strong>stubManager != <strong class="mw hv">nil else </strong>{ <strong class="mw hv">return false </strong>}<br/>            stubManager.killStubs()<br/>            <br/>            <strong class="mw hv">return false<br/>        </strong>}<br/>    }<br/>    <br/>}</span></pre><h2 id="5bd9" class="li lj hu bd lk ll lm ln lo lp lq lr ls jz lt lu lv kd lw lx ly kh lz ma mb mc dt translated">ä½¿ç”¨Quick and Nimbleç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªUIæµ‹è¯•</h2><p id="0879" class="pw-post-body-paragraph jq jr hu js b jt md iv jv jw me iy jy jz mf kb kc kd mg kf kg kh mh kj kk kl hn dt translated">ç¼–å†™UIæµ‹è¯•ä¸éœ€è¦å¤ªå¤šçš„åº”ç”¨æ¶æ„çŸ¥è¯†ï¼Œæµ‹è¯•äººå‘˜æˆ–å¼€å‘äººå‘˜åªéœ€è¦æ‰¾åˆ°å“ªäº›ç«¯ç‚¹éœ€è¦å­˜æ ¹ï¼Œå°±å¯ä»¥è½»æ¾åœ°å¼€å§‹æ·»åŠ æ›´å¤šæµ‹è¯•ã€‚</p><pre class="jj jk jl jm fq ne mw nf ng aw nh dt"><span id="e83d" class="li lj hu mw b fv ni nj l nk nl"><strong class="mw hv">import </strong>Quick<br/><strong class="mw hv">import </strong>Nimble<br/><br/><strong class="mw hv">class </strong>DiscardJobsSpec: TMTestCase {<br/>    <br/>    <strong class="mw hv">override func </strong>spec() {<br/>        <strong class="mw hv">let </strong>app = XCUIApplication()<br/>        <br/>        describe("retrieve discarded jobs") {<br/><br/>            beforeEach {<br/>                stub(endpoint: PostsStubApi.RetrieveOnePostItem())<br/>            }<br/><br/>            afterEach {<br/>                removeAllStubs()<br/>            }<br/><br/>            it("should do something") {<br/>                // You will have one item on the screen at this point ğŸ‰<br/>            }<br/>        }<br/>    }<br/>}</span></pre></div><div class="ab cl lb lc hc ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hn ho hp hq hr"><p id="b27a" class="pw-post-body-paragraph jq jr hu js b jt ju iv jv jw jx iy jy jz ka kb kc kd ke kf kg kh ki kj kk kl hn dt translated">æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¯»è¿™ç¯‡æ–‡ç« ï¼Œå¦‚æœä½ å–œæ¬¢å°±åˆ†äº«å®ƒï¼Œå¦‚æœä½ å–œæ¬¢å°±åœ¨Twitterä¸Šå…³æ³¨æˆ‘<a class="ae la" href="https://goo.gl/pnkheb" rel="noopener ugc nofollow" target="_blank"/>ã€‚</p></div></div>    
</body>
</html>