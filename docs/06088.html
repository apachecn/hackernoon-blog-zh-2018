<html>
<head>
<title>Centralised logging for AWS Lambda, REVISED (2018)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda的集中记录，修订版(2018)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/centralised-logging-for-aws-lambda-revised-2018-e88f22aabb0d?source=collection_archive---------29-----------------------#2018-07-23">https://medium.com/hackernoon/centralised-logging-for-aws-lambda-revised-2018-e88f22aabb0d?source=collection_archive---------29-----------------------#2018-07-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="08eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我要感谢你们所有人关注和阅读我的内容。到目前为止，我在AWS Lamb da 的集中式日志记录上的帖子已经被浏览了超过20000次，所以这显然是一个你们很多人都遇到过的挑战。</p><p id="e33e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇文章中，我列出了一种使用Lamb da函数将所有Lamb da日志从云观察日志传送到日志聚合服务(如<a class="ae jp" href="https://logz.io/" rel="noopener ugc nofollow" target="_blank"> Logz.io </a>)的方法。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/f50cf4684c9675a59848642c29aa8c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zis4dbJRplUAKiqN.png"/></div></div></figure><p id="a1d5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<a class="ae jp" href="https://github.com/theburningmonk/lambda-logging-demo" rel="noopener ugc nofollow" target="_blank">演示项目</a>中，我还加入了以下功能:</p><ul class=""><li id="5b9a" class="kc kd hu it b iu iv iy iz jc ke jg kf jk kg jo kh ki kj kk dt translated">向日志传送功能自动订阅新的日志组</li><li id="7801" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">将新日志组的保留策略自动更新为X天(默认为<strong class="it hv"> <em class="kq">永不过期</em> </strong>，这会产生长期成本影响)</li></ul><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kr"><img src="../Images/e3aa50a7649449ec00f9612013d2b58e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uj6RYoFYGQXBpIME.png"/></div></div></figure><p id="025e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种方法在你刚开始的时候效果很好。然而，在大范围内，你会遇到一些严重的问题。</p><h1 id="9c75" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">注意并发性</h1><p id="a7d5" class="pw-post-body-paragraph ir is hu it b iu lq iw ix iy lr ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">使用Lamb函数处理云观察日志时，您需要注意它所创建的当前执行的数量。因为云观察日志是Lamb da的异步事件源。</p><p id="7c64" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当你有100个函数同时运行时，它们会将日志推送到云监控日志中。这又会触发日志传送功能的100个当前执行。这可能会使您所在地区当前运行的功能数量翻倍。记住，所有功能都有一个软的<strong class="it hv">区域</strong>限制在<a class="ae jp" href="https://docs.aws.amazon.com/lambda/latest/dg/concurrent-executions.html" rel="noopener ugc nofollow" target="_blank"> 1000个当前执行</a>中！</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lv"><img src="../Images/47ae1a893a81dee87c084647713878bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QYGRv12ckQe8XXx2.png"/></div></div></figure><p id="8f6a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着您的日志传送功能可能会导致整个应用程序出现<strong class="it hv"> cas cade故障</strong>。关键函数可能会被阻塞，因为太多的执行程序被用于将日志推出云观察日志——这不是一种好的方式；-)</p><p id="4601" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以为日志传送功能设置保留电流，以限制其当前执行的最大数量。然而，当调用日志传送功能时，您有丢失日志的风险。</p><p id="ad92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你也可以要求加薪，让你的薪水高到你不需要担心喉咙痛的程度。</p><h1 id="8c5e" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">大规模的更好的方法是使用Kinesis</h1><p id="c3ae" class="pw-post-body-paragraph ir is hu it b iu lq iw ix iy lr ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">然而，我认为一个更好的方法是首先将云监控日志传输到Kine sis流。从那里，Lamb函数可以处理日志，并将它们转发到日志聚合服务。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kr"><img src="../Images/d3115f1e4aad01e1737895d7fd2a1172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-2a8jkeT2q4eNl-U.png"/></div></div></figure><p id="a48d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过这种方法，您已经控制了日志传送功能的当前状态。随着日志事件数量的增加，您可以增加Kine sis流中的碎片数量。这也会增加日志传送功能的当前执行次数。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lw"><img src="../Images/1741f791531262a1bb81ce9dfacc51ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YMhXWHhU-W1hmtHG.png"/></div></div></figure><p id="1006" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">看看这个<a class="ae jp" href="https://github.com/theburningmonk/lambda-logging-kinesis-demo" rel="noopener ugc nofollow" target="_blank">回购</a>看看它是如何运作的。对于<a class="ae jp" href="https://theburningmonk.com/2017/08/centralised-logging-for-aws-lambda/" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>的演示项目，它有一个几乎相同的设置:</p><ul class=""><li id="9810" class="kc kd hu it b iu iv iy iz jc ke jg kf jk kg jo kh ki kj kk dt translated"><code class="eh lx ly lz ma b">set-retention</code>功能自动将新日志组的保留策略更新为7天</li><li id="ccf1" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated"><code class="eh lx ly lz ma b">subscribe</code>功能自动mat会将新的日志组添加到Kine sis流中</li><li id="3e35" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">一个<code class="eh lx ly lz ma b">ship-logs-to-logzio</code>功能，处理来自上述Kine sis流的日志事件，并将它们发送到<a class="ae jp" href="http://logz.io/" rel="noopener ugc nofollow" target="_blank"> Logz.io </a></li><li id="10bc" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">一个<code class="eh lx ly lz ma b">process_all</code>脚本，用于将所有现有日志组订阅到同一个Kine sis流</li></ul><p id="dd6c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你也应该看看<a class="ae jp" href="https://theburningmonk.com/2017/04/auto-scaling-kinesis-streams-with-aws-lambda/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>，看看你如何使用云手表和Lamb da自动缩放Kine sis流。</p></div><div class="ab cl mb mc hc md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hn ho hp hq hr"><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="ab fr cl mi"><img src="../Images/8b4e4721bb1973db389b5b533d727ad1.png" data-original-src="https://miro.medium.com/v2/format:webp/0*b_1R345KzKSaI8sg.png"/></div></figure><p id="f870" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">嗨，我叫<strong class="it hv">崔琰</strong>。我是一个<a class="ae jp" href="https://aws.amazon.com/developer/community/heroes/yan-cui/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> AWS无服务器英雄</strong> </a>和<a class="ae jp" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">量产无服务器</strong> </a>的作者。我已经在AWS中运行了近10年的大规模生产工作负载，我是一名架构师或首席工程师，涉足从银行、电子商务、体育流媒体到移动游戏等多个行业。我目前是一名专注于AWS和无服务器的独立顾问。</p><p id="c37e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以通过<a class="ae jp" href="mailto:theburningmonk.com" rel="noopener ugc nofollow" target="_blank">邮箱</a>、<a class="ae jp" href="https://twitter.com/theburningmonk" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae jp" href="https://www.linkedin.com/in/theburningmonk/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p></div><div class="ab cl mb mc hc md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hn ho hp hq hr"><p id="404d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看我的新课程，<a class="ae jp" href="https://theburningmonk.thinkific.com/courses/complete-guide-to-aws-step-functions" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">AWS步骤功能完整指南</strong> </a>。</p><p id="a329" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本课程中，我们将介绍有效使用AWS Step Functions服务所需了解的一切。包括基本概念、HTTP和事件触发器、活动、设计模式和最佳实践。</p><p id="cd40" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在此获取您的副本<a class="ae jp" href="https://theburningmonk.thinkific.com/courses/complete-guide-to-aws-step-functions" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mb mc hc md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hn ho hp hq hr"><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mj"><img src="../Images/2faf40b47320300fed81b3e09483ffb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZYcHhOOzUf5VB-Ri.png"/></div></div></figure><p id="ee8c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">来了解AWS Lambda: CI/CD的操作性<strong class="it hv">最佳实践</strong>，本地测试&amp;调试功能、日志记录、监控、分布式跟踪、金丝雀部署、配置管理、认证&amp;授权、VPC、安全性、错误处理等等。</p><p id="8bb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">代码<strong class="it hv"> ytcui </strong>还可以获得<strong class="it hv">票面价格6折</strong>。</p><p id="2e68" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击获取您的副本<a class="ae jp" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>