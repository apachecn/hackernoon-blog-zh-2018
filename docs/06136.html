<html>
<head>
<title>Let’s build a water molecule with ARKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们用ARKit造一个水分子</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/lets-build-a-water-molecule-with-arkit-be12261d86e5?source=collection_archive---------18-----------------------#2018-07-24">https://medium.com/hackernoon/lets-build-a-water-molecule-with-arkit-be12261d86e5?source=collection_archive---------18-----------------------#2018-07-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/eb0fdfe03075ac590056c7c24acc4d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ss2ZXOQDOJj0KX8ZsKHgiw.jpeg"/></div></div></figure><p id="8e18" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">水形成了一个简单的分子结构，我们将利用苹果的<a class="ae ka" href="https://hackernoon.com/tagged/arkit" rel="noopener ugc nofollow" target="_blank"> arKit </a>在AR中构建这个结构。我们将学习<a class="ae ka" href="https://hackernoon.com/tagged/arkit" rel="noopener ugc nofollow" target="_blank"> ARKit </a>的基础知识，比如处理和操作节点。</p><ul class=""><li id="04ca" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">在XCode中启动一个新的AR项目，使用<a class="ae ka" href="https://hackernoon.com/tagged/scenekit" rel="noopener ugc nofollow" target="_blank"> SceneKit </a>作为内容<a class="ae ka" href="https://hackernoon.com/tagged/technology" rel="noopener ugc nofollow" target="_blank">技术</a></li><li id="704a" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">构建并运行以确保一切正常——您应该能够看到默认的飞船</li><li id="a280" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">现在，删除下面几行不需要的飞船</li></ul><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="2d95" class="ky kz hu ku b fv la lb l lc ld">// Create a new scene<br/>   let scene = SCNScene(named: "art.scnassets/ship.scn")!<br/>// Set the scene to the view<br/>   sceneView.scene = scene</span></pre><p id="51b7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为参考，x、y和z轴如下。相机在原点。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff le"><img src="../Images/7a56796fb457b8fee4c830223ada6371.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*eYoRxdsv9bUQ5S1bMpxPhA.png"/></div></figure><p id="9571" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">氧比氢大。所以，我们先放一个氧原子。从现在开始我们将和<code class="eh lf lg lh ku b">ViewController.swift</code>一起工作。</p><ul class=""><li id="3b93" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">给氧气加一个锚。</li></ul><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="3dbd" class="ky kz hu ku b fv la lb l lc ld">func getMainAnchor() -&gt; ARAnchor {</span><span id="ff41" class="ky kz hu ku b fv li lb l lc ld">    // Creates an anchor at a distance 0.1m in front of you . </span><span id="560e" class="ky kz hu ku b fv li lb l lc ld">    var anchorPosition = matrix_identity_float4x4</span><span id="e062" class="ky kz hu ku b fv li lb l lc ld">    anchorPosition.columns.3.z = -0.1</span><span id="e165" class="ky kz hu ku b fv li lb l lc ld">    let mainAnchor = ARAnchor(transform: anchorPosition)</span><span id="09b9" class="ky kz hu ku b fv li lb l lc ld">    return mainAnchor</span><span id="93c8" class="ky kz hu ku b fv li lb l lc ld">}</span></pre><ul class=""><li id="8234" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">将以下代码添加到<code class="eh lf lg lh ku b">viewDidLoad</code>函数中。</li></ul><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="c2da" class="ky kz hu ku b fv la lb l lc ld">let sphere = SCNSphere(radius: 0.01)</span><span id="fc34" class="ky kz hu ku b fv li lb l lc ld">let oxygenNode = SCNNode(geometry: sphere)</span><span id="077c" class="ky kz hu ku b fv li lb l lc ld">oxygenNode.geometry?.firstMaterial?.diffuse.contents = UIColor.red</span><span id="5444" class="ky kz hu ku b fv li lb l lc ld">sceneView.session.add(anchor: self.getMainAnchor())</span><span id="1cf6" class="ky kz hu ku b fv li lb l lc ld">sceneView.scene.rootNode.addChildNode(oxygenNode)</span><span id="3b2c" class="ky kz hu ku b fv li lb l lc ld">oxygenNode.position = SCNVector3(0.0, 0.0, Float(-0.1))</span></pre><p id="0248" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面的代码为氧原子创建了一个球体几何体和一个SCNNode。然后，将AR锚添加到sceneView的会话，然后将Oxygen atom节点作为子节点添加到sceneview的根节点。这将在您前方0.1米处放置一个红色球体。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/198deda0fb0d51e8a09ca20274f55fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*AH0R16c6W8WP00i2JVI2HQ.jpeg"/></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">Fig 1. Oxygen Atom</figcaption></figure><p id="0eaf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们应该考虑如何通过分析结构来构建分子。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff lo"><img src="../Images/a76b549e3aff7142b8bdff7817456b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*bO1pAuQ6twygj9iq-L6aGA.png"/></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">Fig 2. Top view of the molecule</figcaption></figure><p id="a74f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从我们这里的结构来看，我们需要三个原子(球体)和两个以指定角度分开的管/圆柱体。此外，管的轴需要在X-Z平面内(管的轴在这里是指穿过管长度方向中心的假想线)。现在这可以通过各种平移和旋转以多种方式实现。我会选一个相对容易的。</p><ol class=""><li id="153a" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz lp kh ki kj dt translated">首先放置氧原子</li><li id="c762" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz lp kh ki kj dt translated">添加最初指向+Y方向的管/圆柱体(结合)</li></ol><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff lq"><img src="../Images/4de4053b4bae5c4b9ab86234c4f66aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*c2qVrIivkupO_OxEkwkFxQ.png"/></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">Fig 3. Tube(O-H bond) on top of Oxygen</figcaption></figure><p id="f91f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.现在，沿Z轴旋转管90 °,将管放置在X-Z轴上</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lr"><img src="../Images/ad75b7a4e7773229e06900cee61a2061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKbWSVT3eCW58RnpAhk4Ew.png"/></div></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">Fig 4. OH bond rotated by 90 degrees</figcaption></figure><p id="8a32" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.再次旋转指定角度，形成水分子。对其他O-H键也这样做</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ls"><img src="../Images/d4eebf50cce3de3375e6431ffd531009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-2r2IeNKLXSB1iimqGdyA.png"/></div></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">Fig 5. OH bond rotated by 37.775 degrees along Y axis</figcaption></figure><p id="cccb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.加入氢原子，你就得到了水分子。</p><p id="ebba" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在让我们将它写入代码…</p><p id="4986" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面的代码在已经存在的氧原子的头部添加了两个管子，如图3所示。</p><p id="bd56" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">默认情况下，管状体的轴心位于中心。我们改变它，把它放在试管的下端。</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="489b" class="ky kz hu ku b fv la lb l lc ld">let tube = SCNTube(innerRadius: 0.001, outerRadius: 0.0015, height: 0.05)</span><span id="e7cc" class="ky kz hu ku b fv li lb l lc ld">let OHbondOne = SCNNode(geometry: tube)<br/>OHbondOne.geometry?.firstMaterial?.diffuse.contents = UIColor.blue</span><span id="d4a7" class="ky kz hu ku b fv li lb l lc ld">let OHbondTwo = SCNNode(geometry: tube)<br/>OHbondTwo.geometry?.firstMaterial?.diffuse.contents = UIColor.blue</span><span id="2c33" class="ky kz hu ku b fv li lb l lc ld">OHbondOne.position = SCNVector3(0.0, 0.025, -0.1)<br/>OHbondOne.pivot = SCNMatrix4MakeTranslation(0, -0.025, 0)<br/>OHbondOne.position.y = OHbondOne.position.y - 0.025</span><span id="105a" class="ky kz hu ku b fv li lb l lc ld">OHbondTwo.position = SCNVector3(0.0, 0.025, -0.1)<br/>OHbondTwo.pivot = SCNMatrix4MakeTranslation(0, -0.025, 0)<br/>OHbondTwo.position.y = OHbondTwo.position.y - 0.025</span><span id="5652" class="ky kz hu ku b fv li lb l lc ld">sceneView.scene.rootNode.addChildNode(OHbondOne)<br/>sceneView.scene.rootNode.addChildNode(OHbondTwo)</span></pre><p id="ca8c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们需要顺时针旋转管子90度，使它们在X-Z轴上，如图4所示。</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="87b6" class="ky kz hu ku b fv la lb l lc ld">let rotateAlongZAxis = SCNAction.rotateBy(x:0 , y: 0, z: -CGFloat(Float.pi/2), duration: 1)</span><span id="3a14" class="ky kz hu ku b fv li lb l lc ld">OHbondOne.runAction(rotateAlongZAxis)<br/>OHbondTwo.runAction(rotateAlongZAxis)</span></pre><p id="ec59" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们需要沿Y轴旋转试管，以获得分子结构(图5)。但是我们需要确定它需要旋转到什么角度。对这些角度的简单分析给了我们以下结论。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/d0913bc0a2f5304fd06d02c6e34a776b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*bZmCEpZKGbn2XlkJBzHbgg.png"/></div></figure><p id="f27f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们需要将第一个管旋转37.755，将第二个管旋转142.205 (37.755 +104.45)。</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="348b" class="ky kz hu ku b fv la lb l lc ld">let rotateOHBondOneAlongYAxis = SCNAction.rotateBy(x:CGFloat(self.degreesToRadians(degrees: 37.755)), y: 0, z: 0, duration: 0.1)</span><span id="d6ac" class="ky kz hu ku b fv li lb l lc ld">let rotateOHBondTwoAlongYAxis = SCNAction.rotateBy(x:CGFloat(self.degreesToRadians(degrees: 142.205)), y: 0, z: 0, duration: 0.1)</span><span id="231a" class="ky kz hu ku b fv li lb l lc ld">OHbondOne.runAction(rotateOHBondOneAlongYAxis)</span><span id="a709" class="ky kz hu ku b fv li lb l lc ld">OHbondTwo.runAction(rotateOHBondTwoAlongYAxis)</span></pre><p id="0d01" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">函数将角度转换为弧度</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="2b46" class="ky kz hu ku b fv la lb l lc ld">func degreesToRadians(degrees: Float) -&gt; Float {<br/>    return (degrees * .pi) / 180.0<br/>}</span></pre><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/f898c64eda649a9c5025db43eb4423b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Vw5J5Nf4cVDK5T7Itm9maQ.jpeg"/></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">Fig 6. OH bonds after rotation along Y axis</figcaption></figure><p id="3f14" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们需要添加氢原子。我们知道在哪里添加——在债券的另一端。但问题是我们具体如何做呢？</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff lu"><img src="../Images/d589a10ae37c1e680f4b07098f483148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*neQzDE9OWu-l7NE0dyi1_w.png"/></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">Fig 7. Hydrogen atom displacement calculation</figcaption></figure><p id="c64e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以对H1来说，把氢原子和氧原子放在一起，然后</p><ul class=""><li id="e0dc" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">在-X方向移动“b”距离(将节点放置在氧气的左侧)</li><li id="f741" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">在-Z方向移动“a”的距离</li></ul><p id="0123" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于H2，把氢原子放在氧原子的位置，然后</p><ul class=""><li id="032a" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">在+X方向移动“b”距离(将节点放置在氧气的右侧)</li><li id="0dc3" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">在-Z方向移动“a”的距离</li></ul><p id="cb99" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是实现这一点的代码，</p><ul class=""><li id="8fdb" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">创建氢节点</li></ul><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="5305" class="ky kz hu ku b fv la lb l lc ld">let hSphere = SCNSphere(radius: 0.007)</span><span id="4682" class="ky kz hu ku b fv li lb l lc ld">let hOneNode = SCNNode(geometry: hSphere)<br/>hOneNode.geometry?.firstMaterial?.diffuse.contents = UIColor.gray</span><span id="2fdf" class="ky kz hu ku b fv li lb l lc ld">let hTwoNode = SCNNode(geometry: hSphere)<br/>hTwoNode.geometry?.firstMaterial?.diffuse.contents = UIColor.gray</span><span id="7336" class="ky kz hu ku b fv li lb l lc ld">hOneNode.position = SCNVector3(0.0, 0.0, Float(-0.1))<br/>hTwoNode.position = SCNVector3(0.0, 0.0, Float(-0.1))</span><span id="79ab" class="ky kz hu ku b fv li lb l lc ld">sceneView.scene.rootNode.addChildNode(hOneNode)<br/>sceneView.scene.rootNode.addChildNode(hTwoNode)</span><span id="e804" class="ky kz hu ku b fv li lb l lc ld">self.placeHOneAtom(hone: hOneNode)<br/>self.placeHTwoAtom(htwo: hTwoNode)</span></pre><ul class=""><li id="2770" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">执行图7中提到的x和z位移的两个函数</li></ul><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="ae1c" class="ky kz hu ku b fv la lb l lc ld">// 0.05m is the bond(tube) length here</span><span id="2508" class="ky kz hu ku b fv li lb l lc ld">func placeHOneAtom(hone: SCNNode) {</span><span id="5ab0" class="ky kz hu ku b fv li lb l lc ld">    hone.position.x = hone.position.x -cos(self.degreesToRadians(degrees: 37.755)) * 0.05</span><span id="55e5" class="ky kz hu ku b fv li lb l lc ld">    hone.position.z = hone.position.z + sin(self.degreesToRadians(degrees: 37.755)) * 0.05</span><span id="a7be" class="ky kz hu ku b fv li lb l lc ld">}</span><span id="2b79" class="ky kz hu ku b fv li lb l lc ld">func placeHTwoAtom(htwo: SCNNode) {</span><span id="7920" class="ky kz hu ku b fv li lb l lc ld">    htwo.position.x = htwo.position.x +    cos(self.degreesToRadians(degrees: 37.755)) * 0.05</span><span id="b7aa" class="ky kz hu ku b fv li lb l lc ld">    htwo.position.z = htwo.position.z + sin(self.degreesToRadians(degrees: 37.755)) * 0.05</span><span id="f785" class="ky kz hu ku b fv li lb l lc ld">}</span></pre><p id="96d7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，一旦所有的代码都被添加，我们就有了分子…</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/f2b5ac60e68411c3e5131557d2a6bff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/1*roEiAUK9K6b5Z7bI-gTkjQ.gif"/></div></figure><p id="8b17" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">已完成的项目在处<a class="ae ka" href="https://github.com/sandeepjoshi1910/WaterInAR" rel="noopener ugc nofollow" target="_blank">可用。</a></p><p id="668e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意:</p><ul class=""><li id="a270" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">不用改变管子的枢轴来旋转它们，我们可以像以前一样，只沿着Z和Y轴旋转它们，然后像氢原子一样沿着X和Z轴移动。那也会产生同样的效果。</li></ul><figure class="kp kq kr ks fq iv"><div class="bz el l di"><div class="lw lx l"/></div></figure></div></div>    
</body>
</html>