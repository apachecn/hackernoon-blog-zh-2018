<html>
<head>
<title>How to deploy a Node.js application to AWS Lambda using Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用无服务器将Node.js应用程序部署到AWS Lambda</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-deploy-a-node-js-application-to-aws-lambda-using-serverless-ae7e7ebe0996?source=collection_archive---------1-----------------------#2018-07-25">https://medium.com/hackernoon/how-to-deploy-a-node-js-application-to-aws-lambda-using-serverless-ae7e7ebe0996?source=collection_archive---------1-----------------------#2018-07-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/36890c19abaa9045e1a9070fdbec1af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ERi-zAqQ8X1D7Q2xDyVmyw.jpeg"/></div></div></figure><p id="81be" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为一名开发人员是很了不起的。编写代码，解决问题，为复杂的算法想出巧妙的解决方案，是我们活着的目的。但是，篱笆这边的草并不总是那么绿。迟早你需要弄脏你的手，部署你辛辛苦苦开发的应用程序。部署并不总是容易的。坦率地说，它们可能难以置信地困难和耗时。这就是我们将在本教程中解决的问题。</p><h2 id="1114" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">TL；速度三角形定位法(dead reckoning)</h2><p id="4978" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">你可以从头跟着或者跳到你最感兴趣的部分，严重伤害我的感情。😅</p><ul class=""><li id="4bdd" class="la lb hu je b jf jg jj jk jn lc jr ld jv le jz lf lg lh li dt translated"><a class="ae lj" href="#9b4b" rel="noopener ugc nofollow">目标</a></li><li id="9f65" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="#12b8" rel="noopener ugc nofollow">先决条件</a></li><li id="bd71" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="#67cb" rel="noopener ugc nofollow">什么是AWS Lambda？</a></li><li id="32f0" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated">但是，它是如何工作的呢？</li><li id="9fa4" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="#7687" rel="noopener ugc nofollow">我们将部署什么？</a></li><li id="65f9" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="#140b" rel="noopener ugc nofollow">如何部署？</a></li><li id="e729" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="#0768" rel="noopener ugc nofollow">开始编码吧！</a></li><li id="ce9b" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="#27d7" rel="noopener ugc nofollow">准备部署！</a></li><li id="d624" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="#b114" rel="noopener ugc nofollow">部署到生产！</a></li><li id="7a1e" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="#c4e7" rel="noopener ugc nofollow">如何洞察你的系统？</a></li></ul><h1 id="9b4b" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">目标</h1><p id="60de" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">今天你将学习如何在无服务器框架的帮助下将Node.js应用程序部署到T21。</p><p id="bab1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该演练还将涵盖部署应用程序生产版本的真实场景，包括<a class="ae lj" href="https://serverless.com/framework/docs/providers/spotinst/guide/variables/#environment-variables" rel="noopener ugc nofollow" target="_blank">环境变量</a>、<a class="ae lj" href="https://dashbird.io/features/aws-lambda-serverless-monitoring/" rel="noopener ugc nofollow" target="_blank">适当的监控</a>，当然还有<a class="ae lj" href="https://dashbird.io/features/lambda-error-tracking/" rel="noopener ugc nofollow" target="_blank">简单的调试</a>。哦，我多么喜欢看到漂亮的堆栈跟踪！</p><h1 id="12b8" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">先决条件</h1><p id="3719" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">本教程将需要你已经设置了一些简单的东西。不要担心，没什么特别的，只是一些基本的，我会把它们都链接到下面给你看，并确保你已经看到了，然后再继续。</p><ul class=""><li id="ec99" class="la lb hu je b jf jg jj jk jn lc jr ld jv le jz lf lg lh li dt translated"><a class="ae lj" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> AWS账户</a> — AWS拥有12个月的免费等级，以及大量的终身免费等级，因此不必担心倾家荡产。</li><li id="5334" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> Node.js和npm已安装</a>——这里有一个快速参考来确保你已经安装了它们。</li><li id="bf85" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="https://hackernoon.com/a-crash-course-on-serverless-with-node-js-632b37d58b44#422a" rel="noopener ugc nofollow" target="_blank">安装了无服务器框架</a> —查看此内容作为参考，并遵循步骤1–3。</li><li id="d294" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="https://dashbird.io/features" rel="noopener ugc nofollow" target="_blank"> Dashbird账户</a> —这将为我们提供所需的概览，让我们免费了解我们的应用<a class="ae lj" href="https://dashbird.io/pricing/" rel="noopener ugc nofollow" target="_blank">发生了什么</a>。</li></ul><p id="20b7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">准备好了吗？我们走吧！</p><h1 id="67cb" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">什么是AWS Lambda？</h1><p id="95c0" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">AWS Lambda是一种现收现付的无服务器计算服务。什么意思？好吧，你只需要把你的源代码部署到AWS上，剩下的就交给他们了。太神奇了！不需要摆弄服务器、ssh连接、Linux或Vim。但是，想知道更好的是什么吗？它会自动扩展，绝对不会停机。我会让它深入人心的…</p><p id="f48c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">AWS Lambda的技术定义是“功能即服务”。您部署一些代码，它被调用，处理一些输入，并返回一个值。简单！</p><p id="b408" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">等一下。我们需要提到一个至关重要的事实。所有lambda函数都是无状态的，这意味着它们不能存储持久数据。而且，如果我刚才说<strong class="je hv"> Function </strong> as a Service，我们怎么把一个完整的Node.js应用部署到AWS Lambda？</p><h1 id="0d63" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">但是，它是如何工作的呢？</h1><p id="bee0" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">仔细想想，其实也没那么复杂。单个lambda函数本质上只是一个微小的Node.js运行时环境。你可以在里面随心所欲地跑。这就是我们要做的，打包一个Node.js应用程序，并将其发送给AWS Lambda。鬼鬼祟祟。😉</p><h1 id="7687" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">我们将部署什么？</h1><p id="97c7" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">为了使这个例子尽可能简单，我们将要部署的代码只有7行。但是，它可以和您在生产中使用的任何Node.js应用程序一样大，而且它会非常好用。耐人寻味…</p><h1 id="140b" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">我们如何部署它？</h1><p id="6cde" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">无服务器框架就像一匹骑着白骑士的马！等等，我可能会倒过来。🤔</p><p id="1631" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">无论如何，这个令人敬畏的框架使我们既可以像以前一样在本地开发我们的应用程序，也可以用一个简单的命令来部署它。嗯…多告诉我一些。</p><h1 id="0768" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">让我们开始编码吧！</h1><p id="10da" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">最重要的是。打开你的终端，我们需要安装一些软件包。耶，安装东西，爱死了！😫</p><h2 id="378f" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">1.安装和配置无服务器框架</h2><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="e8e7" class="ka kb hu ml b fv mp mq l mr ms">$ npm install -g serverless</span></pre><p id="4e50" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> <em class="mt">注意</em> </strong> <em class="mt">:如果在Linux上运行该命令，则在该命令前面加上前缀</em> <code class="eh mu mv mw ml b"><em class="mt">sudo</em></code> <em class="mt">。</em></p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="3064" class="ka kb hu ml b fv mp mq l mr ms">$ sls config credentials --provider aws --key PUBLIC_KEY --secret SECRET_KEY</span></pre><p id="4aeb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保添加IAM用户的公钥和私钥，而不是我在上面指定的占位符。如果你跳过了上面的这一部分，<a class="ae lj" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_console" rel="noopener ugc nofollow" target="_blank">这里是AWS文档中的官方指南</a>。</p><h2 id="0f13" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">2.创建样板代码</h2><p id="1039" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">让我们创建一个新的文件夹，并给它一个相当值得注意的名字。跳到您的终端，运行下面的命令。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="aa22" class="ka kb hu ml b fv mp mq l mr ms">$ mkdir serverless-nodejs-app &amp;&amp; cd serverless-nodejs-app</span></pre><p id="4adb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太棒了，现在剩下的就是运行<code class="eh mu mv mw ml b">create</code>命令来为我们生成一些启动代码。这被称为无服务器服务。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="f643" class="ka kb hu ml b fv mp mq l mr ms">$ sls create -t aws-nodejs -n serverless-nodejs-app</span></pre><p id="f326" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在打开代码编辑器之前只需要一个步骤。</p><h2 id="dd9f" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">3.安装依赖项</h2><p id="b42b" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">就像你在上面的代码片段中看到的，我们需要先安装几个模块。幸运的是，我们只有两个，就像运行一个命令一样简单。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="baca" class="ka kb hu ml b fv mp mq l mr ms">$ npm init -y <br/>$ npm install --save express serverless-http</span></pre><p id="75c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就是这样！让我们在代码编辑器中打开它，进行一些真正的编码。</p><h2 id="d9a5" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">4.真实编码</h2><p id="5a4b" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">一旦打开代码编辑器，您会看到三个文件。忽略<code class="eh mu mv mw ml b">.gitignore</code>文件，让我先解释一下什么是<code class="eh mu mv mw ml b">handler.js</code>，然后我将继续讨论<code class="eh mu mv mw ml b">serverless.yml</code>。处理程序将保存你所有的应用程序逻辑，所有的代码。而<code class="eh mu mv mw ml b">serverless.yml</code>是您将在AWS上创建的资源的配置文件。</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mx"><img src="../Images/56b5eb1c156f1b7580a5f51e6d465f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/0*SEnD2TrmwR1CxJvu.png"/></div></div></figure><p id="0bf0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">继续将<code class="eh mu mv mw ml b">handler.js</code>重命名为<code class="eh mu mv mw ml b">app.js</code>，只是为了更简单地让我们弄清楚什么去哪里。</p><p id="8aec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">删除所有的起始代码，并将这段代码粘贴到<code class="eh mu mv mw ml b">app.js</code>文件中。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="5adf" class="ka kb hu ml b fv mp mq l mr ms">// app.js </span><span id="9de2" class="ka kb hu ml b fv my mq l mr ms">const express = require('express') <br/>const sls = require('serverless-http') <br/>const app = express() <br/>app.get('/', async (req, res, next) =&gt; { <br/>  res.status(200).send('Hello World!') <br/>}) <br/>module.exports.server = sls(app)</span></pre><p id="01e0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">七行代码😎。看起来很眼熟吧？就像你习惯的那样。就是这样。信不信由你，没别的了。让我们继续进行<code class="eh mu mv mw ml b">serverless.yml</code>。</p><p id="35ae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">再一次，删除所有的样板代码并粘贴进来。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="b1de" class="ka kb hu ml b fv mp mq l mr ms"># serverless.yml </span><span id="3557" class="ka kb hu ml b fv my mq l mr ms">service: serverless-nodejs-app </span><span id="0bf9" class="ka kb hu ml b fv my mq l mr ms">provider: <br/>  name: aws <br/>  runtime: nodejs8.10 <br/>  stage: dev <br/>  region: eu-central-1 <br/>  functions: <br/>    app: <br/>      handler: app.server # reference the file and exported method<br/>      events: # events trigger lambda functions <br/>        - http: # this is an API Gateway HTTP event trigger <br/>            path: / <br/>            method: ANY <br/>            cors: true <br/>        - http: # all routes get proxied to the Express router <br/>            path: /{proxy+} <br/>            method: ANY <br/>            cors: true</span></pre><p id="4c6d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">搞定了。剩下的就是部署它了。</p><h1 id="27d7" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">准备部署！</h1><p id="0db2" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">切换回终端窗口。通过运行一个简单的命令，您的应用程序将被部署。</p><p id="e13e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">无服务器框架现在将把所有东西打包成一个漂亮的包，从<code class="eh mu mv mw ml b">serverless.yml</code>创建一个CloudFormation文件，并把它发送到AWS S3。一旦创建了资源并部署了代码，您将在终端中看到一个端点返回给您。</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mz"><img src="../Images/33ad31b535782d2de07bbaf654737634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CsLGcNxwivn4-8wS.png"/></div></div></figure><p id="59ed" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在浏览器中打开提供的URL，您会看到<code class="eh mu mv mw ml b">Hello World!</code>被发送给您。</p><h1 id="b114" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">部署到生产环境！</h1><p id="3485" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">这很好，但还没有真正准备好投入生产环境。不要担心！您会惊讶地发现，让它为生产做好准备是多么简单。</p><h2 id="5979" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">1.添加secrets.json文件来保存环境变量</h2><p id="597b" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">现在，我们只需在<code class="eh mu mv mw ml b">secrets.json</code>中添加<code class="eh mu mv mw ml b">NODE_ENV</code>即可。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="4def" class="ka kb hu ml b fv mp mq l mr ms">{ <br/>  "NODE_ENV": "production" <br/>}</span></pre><h2 id="82af" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">2.在serverless.yml中添加对secrets.json的引用</h2><p id="7f35" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">添加秘密文件很简单，在<code class="eh mu mv mw ml b">serverless.yml</code>中引用该文件甚至更容易。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="028a" class="ka kb hu ml b fv mp mq l mr ms">service: serverless-nodejs-app </span><span id="4642" class="ka kb hu ml b fv my mq l mr ms">custom: # add these two lines <br/>  secrets: ${file(secrets.json)} # reference the secrets.json file</span><span id="8cdb" class="ka kb hu ml b fv my mq l mr ms">provider: <br/>  name: aws <br/>  runtime: nodejs8.10 <br/>  stage: production # make sure to change this to production <br/>  region: eu-central-1 <br/>  environment: # add environment property <br/>    NODE_ENV: ${self:custom.secrets.NODE_ENV} <br/>    # reference the NODE_ENV from the secrets.json file </span><span id="70e1" class="ka kb hu ml b fv my mq l mr ms">  functions: <br/>    app: <br/>      handler: app.server <br/>      events: <br/>        - http: <br/>            path: / <br/>            method: ANY <br/>            cors: true <br/>        - http: <br/>            path: /{proxy+} <br/>            method: ANY <br/>            cors: true</span></pre><p id="0046" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">厉害了，就是这样！从服务中删除<code class="eh mu mv mw ml b">node_modules</code>和<code class="eh mu mv mw ml b">.serverless</code>文件夹，并再次运行<code class="eh mu mv mw ml b">npm install</code>，但是这次使用<code class="eh mu mv mw ml b">--production</code>标志。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="09b5" class="ka kb hu ml b fv mp mq l mr ms">$ npm install --production</span></pre><p id="6f3b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太好了！剩下的工作就是重新部署服务，一切就绪。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="1bfc" class="ka kb hu ml b fv mp mq l mr ms">$ sls deploy</span></pre><p id="caa4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是我们的结局。</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div class="fe ff na"><img src="../Images/19dad2269e8e237f7468d6d6e143af06.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/0*yvtlfjtsj5pbaUIN.png"/></div></figure><p id="1511" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我想我们结束了？不完全是。仅仅因为你用<code class="eh mu mv mw ml b">--production</code>安装了npm模块，就让一个应用程序在生产中运行并不能真正解决问题。为了晚上能睡个好觉，我需要多一点。这就是适当的系统洞察力和监控工具发挥作用的地方。让我展示给你看。</p><h1 id="c4e7" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">如何洞察你的系统？</h1><p id="b18a" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">所有无服务器应用程序的首要问题是它们的分布式本质。简单明了地说，要对所有正在发生的事情有一个总体的了解是不可能的。更不用说出问题的时候调试有多难了。</p><p id="52a7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了平息我的恐惧，我使用了Dashbird。这是一个简单的监控工具，不需要我修改任何代码，绝对没有开销。所以，也不会影响性能。不错！</p><p id="7333" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">谢天谢地，他们有合理的文档，这使得入职过程变得轻而易举。继续按照他们的<a class="ae lj" href="https://dashbird.io/docs/get-started/quick-start/" rel="noopener ugc nofollow" target="_blank">快速入门指南</a>进行操作，<a class="ae lj" href="https://dashbird.io/pricing/" rel="noopener ugc nofollow" target="_blank">免费注册</a>。但是别忘了回到这里。😄</p><p id="50ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦你完成了，所有的请求将开始一个接一个的堆积，你应该会看到这样的东西。</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mz"><img src="../Images/a3d81719ffbcbc0a08e1e4b4247afd07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AOfN8DzwyUdbF0Ij.gif"/></div></div></figure><h1 id="884a" class="lp kb hu bd kc lq lr ls kg lt lu lv kk lw lx ly kn lz ma mb kq mc md me kt mf dt translated">包扎</h1><p id="da15" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">这很有趣！</p><p id="7500" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae lj" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> Lambda </a>牛逼！当与HTTP事件触发器如<a class="ae lj" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> API网关</a>、开发工具如<a class="ae lj" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>和可观察性工具如<a class="ae lj" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>相结合时，事情就变得如此简单。</p><p id="9884" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们上面编写的这个简单的API示例只是一个概念证明。但是你能明白这一点。它为您提供了一个起点，您可以在此基础上创建出色的生产应用程序！</p><p id="afb9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您错过了上面的任何步骤，<a class="ae lj" href="https://github.com/adnanrahic/express-sls-app" rel="noopener ugc nofollow" target="_blank">这里是包含所有代码的库</a>,或者加入我的时事通讯，保持更新！</p><figure class="mg mh mi mj fq iv"><div class="bz el l di"><div class="nb nc l"/></div></figure><p id="a457" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你也可以看看我的一些关于无服务器的文章:</p><ul class=""><li id="2b7e" class="la lb hu je b jf jg jj jk jn lc jr ld jv le jz lf lg lh li dt translated"><a class="ae lj" href="https://hackernoon.com/getting-started-with-aws-lambda-and-node-js-4ce3259c6dfd" rel="noopener ugc nofollow" target="_blank">AWS Lambda和Node.js入门</a></li><li id="64ad" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="https://medium.freecodecamp.org/a-crash-course-on-securing-serverless-apis-with-json-web-tokens-ff657ab2f5a5" rel="noopener ugc nofollow" target="_blank">用JSON web令牌保护无服务器API的速成班</a></li><li id="a696" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="https://hackernoon.com/migrating-your-node-js-rest-api-to-serverless-d2a170e0856c" rel="noopener ugc nofollow" target="_blank">将Node.js REST API迁移到无服务器</a></li><li id="f30f" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="https://hackernoon.com/building-a-serverless-rest-api-with-node-js-and-mongodb-2e0ed0638f47" rel="noopener ugc nofollow" target="_blank">用Node.js和MongoDB构建无服务器REST API</a></li><li id="c2d7" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="https://hackernoon.com/a-crash-course-on-serverless-with-node-js-632b37d58b44" rel="noopener ugc nofollow" target="_blank">node . js无服务器速成班</a></li></ul><p id="3d7b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">希望你们喜欢读这篇文章，就像我喜欢写这篇文章一样。 <br/> <em class="mt">你觉得这个教程会对某个人有帮助吗？不要犹豫分享。如果你喜欢，击碎下面的</em><strong class="je hv"><em class="mt"/></strong><em class="mt">这样其他人会在媒体上看到这个。</em></p></div><div class="ab cl nd ne hc nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="hn ho hp hq hr"><p id="e7e1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mt">原载于</em><a class="ae lj" href="https://dev.to/adnanrahic/how-to-deploy-a-nodejs-application-to-aws-lambda-using-serverless-2nc7" rel="noopener ugc nofollow" target="_blank"><em class="mt">dev . to</em></a><em class="mt">。</em></p></div></div>    
</body>
</html>