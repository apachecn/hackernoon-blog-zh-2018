<html>
<head>
<title>Building Serverless Contact Form For Static Websites</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为静态网站构建无服务器联系表单</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/building-serverless-contact-form-for-static-websites-b0e622d5a035?source=collection_archive---------3-----------------------#2018-07-25">https://medium.com/hackernoon/building-serverless-contact-form-for-static-websites-b0e622d5a035?source=collection_archive---------3-----------------------#2018-07-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/c41b84391a3daf0caf985aba6729d063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYvXrG9rcgLg42weUyOfyg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/AtvuPUenaeI?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Caleb George</a> on <a class="ae jg" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="3beb" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">介绍</h1><p id="1afb" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">几年前，AWS推出了静态托管服务S3，这是静态网站托管的典范转移。技术是非常清楚的，所有的静态资产(HTML、CSS和JS)将驻留在一个S3桶中来托管你令人印象深刻的网站。一个很酷的想法，我个人很喜欢，真的。如果没有那个超级重要的联系表单，在S3上托管会很酷，但是你的联系表单会是一个笑话，除非你有另一个服务器来处理来自那个表单的AJAX请求。一旦你准备好了服务，S3的解决方案就一点也不吸引人了。</p><p id="8154" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">在尖端技术时代，总有令人瞠目结舌的创新出现。一项令人惊叹的技术创新恰好是无服务器的。这并不是说不涉及服务器，而是您现在可以不太关心它们了。无服务器可以是一个适当的和可行的解决许多问题的方案，它是最完美的静态托管联系形式的解决方案。坚持读完这篇文章，你将能够以最廉价和最简单的方式处理你的网站表单。</p></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><h1 id="9134" class="jh ji hu bd jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke dt translated">无服务器框架</h1><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lu"><img src="../Images/dc9ec159eb3394e60c2b1ad9740a2dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDBqXrshDx-kEVUg1e6Rhw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Source: <a class="ae jg" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">https://serverless.com/</a></figcaption></figure><blockquote class="lz ma mb"><p id="e71c" class="kf kg mc kh b ki ld kk kl km le ko kp md lf ks kt me lg kw kx mf lh la lb lc hn dt translated">无服务器是您部署和操作无服务器架构的工具包。专注于您的应用，而不是您的基础设施。</p><p id="f9f0" class="kf kg mc kh b ki ld kk kl km le ko kp md lf ks kt me lg kw kx mf lh la lb lc hn dt translated">—<a class="ae jg" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">Serverless.com</a></p></blockquote><p id="344b" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">无服务器技术的瑞士军刀。Serverless Framework是用Node.js编写的免费开源web框架。Serverless是第一个专门为在AWS Lambda上构建应用程序而开发的框架，AWS Lambda是Amazon Web Services提供的无服务器计算平台。目前，使用无服务器框架开发的应用程序可以部署到其他FaaS服务提供商。以下是无服务器框架支持的无服务器云服务列表:</p><ul class=""><li id="5bd6" class="mg mh hu kh b ki ld km le kq mi ku mj ky mk lc ml mm mn mo dt translated"><a class="ae jg" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank">T3】AWSλT5】</a></li><li id="d7e0" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><a class="ae jg" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv">谷歌云功能</strong> </a></li><li id="5ef2" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><a class="ae jg" href="https://azure.microsoft.com/en-us/services/functions/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv"> Azure函数</strong> </a></li><li id="7c18" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><a class="ae jg" href="https://www.ibm.com/cloud-computing/bluemix/openwhisk" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv"> IBM OpenWhisk </strong> </a></li><li id="5082" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><a class="ae jg" href="https://webtask.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv"> Auth0 Webtask </strong> </a></li><li id="76fc" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><a class="ae jg" href="https://fnproject.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv">甲骨文Fn项目</strong> </a></li><li id="0996" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><a class="ae jg" href="https://spotinst.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv"> Spotinst </strong> </a></li><li id="e8de" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><a class="ae jg" href="https://kubeless.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh hv"/></a></li></ul></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><h1 id="bff3" class="jh ji hu bd jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke dt translated">无服务器框架入门</h1><p id="e502" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">显然，您对开始使用无服务器框架非常兴奋，让我们切入正题，从安装无服务器开始。</p><p id="d20e" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">设置无服务器很简单。您需要通过npm安装它，并将其链接到您的AWS帐户。</p><h2 id="0caa" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">1.全局安装无服务器</h2><p id="5da4" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">是时候动手做无服务器的东西了。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="ab7d" class="mu ji hu nj b fv nn no l np nq">$ npm install serverless -g</span></pre><p id="84f6" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">此命令在本地计算机上全局安装无服务器。现在，您可以从终端使用无服务器命令。</p><p id="ae75" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><strong class="kh hv">注意:</strong>运行Linux，您可能希望以sudo的身份运行上面的命令。</p><h2 id="6e94" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">2.在AWS控制台中创建IAM用户</h2><p id="26e2" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">转到你的<a class="ae jg" href="https://console.aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS控制台</a>，你会发现<a class="ae jg" href="https://console.aws.amazon.com/iam/home" rel="noopener ugc nofollow" target="_blank"> IAM服务</a>列在“安全、身份&amp;合规”组下面。在IAM控制面板中，单击“用户”选项卡，然后单击“添加用户”按钮。</p><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nr"><img src="../Images/8afa96d52f14d2603db8451c7624ec94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VtA7fGzE2a_h6yMTl69lBw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">AWS IAM Dashboard User Tab</figcaption></figure><p id="469f" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">创建一个新用户，并通过点击编程访问复选框允许用户<strong class="kh hv">编程访问</strong>。接下来，在permissions部分，您需要向用户添加一组权限。从“直接附加现有策略”下的可用选项列表中，检查<strong class="kh hv">管理员访问</strong>。</p><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nr"><img src="../Images/44adae00c7d25683396bc4461aa95bb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_6PWCnAeK25k7P7CaL1uA.png"/></div></div></figure><p id="e5ba" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">创建用户后，您将可以访问用户的<strong class="kh hv">访问密钥ID </strong>和<strong class="kh hv">秘密访问密钥</strong>。在下一步中，您将需要使用这些密钥。</p><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nr"><img src="../Images/8a295bac7d4f69d7be6a00bf06e1defe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7FqyvVFoRxZClqC16SevXw.png"/></div></div></figure><p id="4829" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><strong class="kh hv">提醒一下:</strong>这些是你不想丢失的凭证，即使是因为错误，记住你已经为这个用户提供了<strong class="kh hv"> AdministratorAccess </strong>。拥有管理员权限的用户几乎可以用你的AWS账户做任何事情。</p><h2 id="ccb9" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">3.将无服务器配置为使用IAM凭据</h2><p id="30cf" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">太好了！有了这些密钥，您可以设置无服务器框架来访问您的AWS帐户。切换到您的终端，使用以下命令配置无服务器:</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="7be5" class="mu ji hu nj b fv nn no l np nq">$ sls config credentials --provider aws --key xxxxxxxxxxxxxx --secret xxxxxxxxxxxxxx --profile &lt;username&gt;</span></pre><p id="4d58" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">现在您的无服务器安装知道什么帐户AWS连接。</p><p id="5b01" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><strong class="kh hv">注意:</strong> <code class="eh ns nt nu nj b">sls</code>是<code class="eh ns nt nu nj b">serverless</code>命令的别名。你可以两者并用达到同样的效果。但是<code class="eh ns nt nu nj b">sls</code>有点酷。</p><h2 id="a459" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">4.创建服务</h2><p id="0c11" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">将无服务器框架与您的AWS帐户连接起来，您可以在瞬间建立一个无服务器项目。启动终端并发出以下命令:</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="1ad4" class="mu ji hu nj b fv nn no l np nq">$ sls create --template aws-python --path &lt;your-folder-path&gt;</span></pre><p id="2be5" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><code class="eh ns nt nu nj b">--template</code>标志用于指定具有给定设置的预设模板。在上面的命令中，模板<code class="eh ns nt nu nj b">aws-python</code>将设置项目，配置为使用AWS作为提供者，Python作为运行时。该命令会自动生成预置值的<code class="eh ns nt nu nj b">serverless.yml</code>、<code class="eh ns nt nu nj b">handler.py</code>和<code class="eh ns nt nu nj b">.gitignore</code>文件。</p><p id="c6e7" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">配置在<code class="eh ns nt nu nj b">serverless.yml</code>文件中定义。这个文件是无服务器框架中最重要的文件。这几乎是不可思议的，因为它可以加速您在其中定义的基础架构。自动生成的<code class="eh ns nt nu nj b">serverless.yml</code>文件的内容如下所示:</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="14f4" class="mu ji hu nj b fv nn no l np nq">service: &lt;your-service-name&gt;</span><span id="44bf" class="mu ji hu nj b fv nv no l np nq">provider:<br/>  name: aws<br/>  runtime: python2.7</span><span id="28b8" class="mu ji hu nj b fv nv no l np nq">functions:<br/>  hello:<br/>    handler: handler.hello</span></pre><p id="c963" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><code class="eh ns nt nu nj b">provider</code>部分定义了与服务提供商相关的所有内容，还有更多属性可以进一步配置，您可以在这里查看它们<a class="ae jg" href="https://serverless.com/framework/docs/providers/aws/guide/serverless.yml/" rel="noopener ugc nofollow" target="_blank">。在自动生成的<code class="eh ns nt nu nj b">serverless.yml</code>文件中，您需要在<code class="eh ns nt nu nj b">provider</code>部分下添加两个重要的标签，如下所示:</a></p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="1b47" class="mu ji hu nj b fv nn no l np nq">region: &lt;your-aws-region&gt;<br/>profile: &lt;aws-username-with-programmatic-access&gt;</span></pre><p id="2b8c" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><code class="eh ns nt nu nj b">functions</code>属性用于声明无服务器函数，在该属性下可以声明多个函数。上面的例子声明了一个名为<code class="eh ns nt nu nj b">hello</code>的函数存在于<code class="eh ns nt nu nj b">handler.py</code>文件中。浏览到<code class="eh ns nt nu nj b">handler.py</code>文件，您会发现类似这样的内容:</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="3505" class="mu ji hu nj b fv nn no l np nq">import json</span><span id="bfd6" class="mu ji hu nj b fv nv no l np nq">def hello(event, context):<br/>    body = {<br/>        "message": "Go Serverless v1.0! Your function executed      successfully!",<br/>        "input": event<br/>    }<br/>    response = {<br/>        "statusCode": 200,<br/>        "body": json.dumps(body)<br/>    }<br/>    return response</span></pre></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><h1 id="a085" class="jh ji hu bd jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke dt translated">无服务器应用</h1><p id="6f94" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">我们的无服务器解决方案利用AWS基础设施，它由API网关、Lambda函数、DynamoDB和简单电子邮件服务(SES)组成。为了实现这一最终结果，我们将使用之前介绍的无服务器框架。</p><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nr"><img src="../Images/da28d3dda76032bea4487fdb9418fcaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Be-VuMqQEg6Ifh60bFtDcQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Architecture of the Serverless app</figcaption></figure><ul class=""><li id="7135" class="mg mh hu kh b ki ld km le kq mi ku mj ky mk lc ml mm mn mo dt translated"><strong class="kh hv">静态网站— </strong>亚马逊S3提供了一个强大而简单的网络服务器。您的应用程序的所有静态HTML、CSS和JS文件都可以从S3提供。我们静态网站上的联系表单是使用AJAX提交的。</li><li id="2969" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><strong class="kh hv"> API网关—</strong>API网关是应用程序的事件源，它充当我们的联系表单和无服务器lambda函数之间的桥梁。它将请求从联系人表单路由到lambda函数。API网关还执行访问控制、监控、API版本控制和流量管理等任务。</li><li id="25f9" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><strong class="kh hv"> AWS Lambda — </strong> AWS Lambda是动作发生的地方。Lambda函数运行在无状态的计算容器中，这些容器是事件触发的、受管理的和短暂的。在我们的示例中，我们使用lambda函数通过SES发送电子邮件，并将请求内容存储在DynamoDB NoSQL数据库中。</li><li id="aef2" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><strong class="kh hv">简单电子邮件服务(SES)——</strong>亚马逊基于云的电子邮件发送服务。可扩展的电子邮件服务，您可以使用SES发送营销和交易电子邮件。在我们的示例中，我们使用SES通过一个经过验证的电子邮件地址发送电子邮件。</li><li id="3824" class="mg mh hu kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo dt translated"><strong class="kh hv"> DynamoDB — </strong> DynamoDB提供了一个来自亚马逊的可扩展、一致、完全托管的非关系数据库。在我们的示例中，我们使用DynamoDB来存储和检索从静态联系人表单接收的消息。</li></ul><p id="c72c" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">您可以在这里找到演示应用程序的源代码。继续克隆它吧！</p><div class="nw nx fm fo ny nz"><a href="https://github.com/faizanbashir/python-ses-dynamodb-contactform" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab ej"><div class="ob ab oc cl cj od"><h2 class="bd hv fv z el oe eo ep of er et ht dt translated">faizanbashir/python-ses-dynamo db-contact form</h2><div class="og l"><h3 class="bd b fv z el oe eo ep of er et ek translated">python-ses-dynamodb-Contact Form-无服务器框架SES和dynamo db联系表单</h3></div><div class="oh l"><p class="bd b gc z el oe eo ep of er et ek translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ja nz"/></div></div></a></div></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><h1 id="e5c4" class="jh ji hu bd jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke dt translated">应用程序演练</h1><p id="1381" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">在AWS上实际部署之前，让我们先浏览一下演示应用程序。</p><h2 id="59ea" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">1.解密serverless.yml文件</h2><p id="5abb" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">serverless.yml文件定义了应用程序需要使用并与之交互的服务。无服务器功能可以执行的资源和动作列在<code class="eh ns nt nu nj b"><strong class="kh hv">iamRoleStatements</strong></code> <strong class="kh hv"> </strong>属性下。它列出了操作和资源。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="73ba" class="mu ji hu nj b fv nn no l np nq">iamRoleStatements:<br/>  - Effect: "Allow"<br/>    Action:<br/>      - ses:SendEmail<br/>      - ses:SendRawEmail<br/>    Resource: "*"<br/>  - Effect: "Allow"<br/>    Action:<br/>      - dynamodb:Scan<br/>      - dynamodb:PutItem<br/>    Resource: "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE}"</span></pre><p id="1216" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">在<code class="eh ns nt nu nj b">serverless.yml</code>中，我们允许无服务器功能使用上面定义的<code class="eh ns nt nu nj b">ses:SendEmail</code>和<code class="eh ns nt nu nj b">dynamoDB:PutItem</code>动作。</p><p id="a611" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">由于Lambda在云中运行无服务器功能，我们需要在某个地方定义这些功能。使用<code class="eh ns nt nu nj b"><strong class="kh hv">functions</strong></code>属性定义函数。在我们的示例应用程序中，我们定义了附加到它们的事件。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="3874" class="mu ji hu nj b fv nn no l np nq">functions:<br/>  sendMail:<br/>    handler: handler.sendMail<br/>    description: Send Email using AWS SES Service<br/>    events:<br/>      - http:<br/>          path: sendMail<br/>          method: post<br/>          integration: lambda<br/>          cors: true<br/>          response:<br/>            headers:<br/>              "Access-Control-Allow_Origin": "'*'"</span><span id="1578" class="mu ji hu nj b fv nv no l np nq">  list:<br/>    handler: handler.list<br/>    description: List all the contact form submissions<br/>    events:<br/>      - http:<br/>          path: list<br/>          method: get<br/>          integration: lambda<br/>          cors: true<br/>          response:<br/>            headers:<br/>              "Access-Control-Allow_Origin": "'*'"</span></pre><p id="7e91" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">无服务器框架的另一大特点是，它将在AWS API网关中创建一个API，并将其与相关的Lambda函数相链接。这是使用在<code class="eh ns nt nu nj b">events</code>属性中定义的<code class="eh ns nt nu nj b">http</code>属性来完成的。</p><h2 id="5c39" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">2.创建资源</h2><p id="2983" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">使用无服务器框架，您可以创建像DynamoDB表这样的资源，就像我们在这里所做的那样。这段代码负责用给定的配置创建一个DynamoDB表。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="262e" class="mu ji hu nj b fv nn no l np nq">resources:<br/>  Resources:<br/>    ContactFormDynamoDbTable:<br/>      Type: 'AWS::DynamoDB::Table'<br/>      DeletionPolicy: Retain<br/>      Properties:<br/>        AttributeDefinitions:<br/>          -<br/>            AttributeName: id<br/>            AttributeType: S<br/>        KeySchema:<br/>          -<br/>            AttributeName: id<br/>            KeyType: HASH<br/>        ProvisionedThroughput:<br/>          ReadCapacityUnits: 1<br/>          WriteCapacityUnits: 1<br/>        TableName: ${self:provider.environment.DYNAMODB_TABLE}</span></pre><h2 id="95db" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">3.窥视无服务器功能</h2><p id="a351" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">演示应用程序用<strong class="kh hv"> python </strong>编写，它使用<a class="ae jg" href="https://github.com/boto/boto3" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv"> boto3 </strong> </a> AWS SDK通过ses发送电子邮件，并在DynamoDB上执行读/写操作。</p><figure class="lv lw lx ly fq iv"><div class="bz el l di"><div class="oo op l"/></div></figure><p id="5ada" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">当从<code class="eh ns nt nu nj b">/sendMail</code>路径上的联系表单接收到<code class="eh ns nt nu nj b">POST</code>请求时，触发<code class="eh ns nt nu nj b">sendMail</code>功能。<code class="eh ns nt nu nj b">list</code>功能由对<code class="eh ns nt nu nj b">serverless.yml</code>文件中定义的<code class="eh ns nt nu nj b">/list</code>路径的<code class="eh ns nt nu nj b">GET</code>请求触发。</p></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><h1 id="8025" class="jh ji hu bd jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke dt translated">构建应用程序</h1><p id="3cb5" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">现在，您已经在您的机器上设置并配置了无服务器框架，是时候开始工作了。</p><h2 id="0b0e" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">1.克隆应用程序</h2><p id="c02e" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">让我们从从Github克隆应用程序开始。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="3a5e" class="mu ji hu nj b fv nn no l np nq">$ git clone <a class="ae jg" href="https://github.com/faizanbashir/python-ses-dynamodb-contactform" rel="noopener ugc nofollow" target="_blank">https://github.com/faizanbashir/python-ses-dynamodb-contactform</a><br/>$ cd python-ses-dynamodb-contactform</span></pre><h2 id="73c3" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">2.向SES核实电子邮件地址</h2><p id="8b6d" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">快速验证您打算从SES发送的电子邮件。你所需要做的就是添加一个电子邮件地址，AWS会给你发送一个验证邮件地址的链接。</p><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff oq"><img src="../Images/05d2d9dcb2459f3cf46f2570438addc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_Y1mmdgKjtvxjBZL8zdIw.png"/></div></div></figure><p id="8f42" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">验证电子邮件地址后，该电子邮件的“验证状态”将显示为“已验证”。</p><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nr"><img src="../Images/b88a0651d9089e41a44298f4ad1c3e0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqxxKMYybvn0PlSPWgWgew.png"/></div></div></figure><h2 id="8b81" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">3.配置应用程序</h2><p id="fe33" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">您需要用您的帐户具体细节来配置<code class="eh ns nt nu nj b">serverless.yml</code>以使其工作。如下图所示，替换<code class="eh ns nt nu nj b">serverless.yml</code>中的<code class="eh ns nt nu nj b">region</code>、<code class="eh ns nt nu nj b">profile</code>和<code class="eh ns nt nu nj b">SENDER_EMAIL</code>属性:</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="f4f6" class="mu ji hu nj b fv nn no l np nq">provider:<br/>  name: aws<br/>  runtime: python2.7<br/>  region: &lt;aws-region&gt;<br/>  profile: &lt;aws-user&gt;<br/>  ...<br/>environment:<br/>  SENDER_EMAIL: &lt;verified-email-address&gt;</span></pre><p id="18b2" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">厉害！配置完成后，您可以将注意力转向应用程序的部署。</p><h2 id="bcf9" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">4.部署到AWS</h2><p id="c73b" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">一切就绪现在你可以用一个命令来部署应用程序，这不是很酷吗？</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="fe66" class="mu ji hu nj b fv nn no l np nq">$ sls deploy -v</span></pre><p id="fffa" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">如果您严格遵循本教程，将需要一两分钟的时间来执行，最后它会为您提供一个用于调用我们的函数的端点列表。它看起来会像这样:</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="5377" class="mu ji hu nj b fv nn no l np nq">endpoints:<br/>POST - <a class="ae jg" href="https://b99gclthvi.execute-api.us-east-1.amazonaws.com/development/sendMail" rel="noopener ugc nofollow" target="_blank">https://xxx.execute-api.xx.amazonaws.com/development/sendMail</a><br/>GET - <a class="ae jg" href="https://b99gclthvi.execute-api.us-east-1.amazonaws.com/development/sendMail" rel="noopener ugc nofollow" target="_blank">https://xxxx.execute-api.xx.amazonaws.com/development/</a><a class="ae jg" href="https://b99gclthvi.execute-api.us-east-1.amazonaws.com/development/list" rel="noopener ugc nofollow" target="_blank">list</a></span></pre><h2 id="86be" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">5.测试端点</h2><p id="d28c" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">现在我们有了端点，让我们测试应用程序，看看它是否工作。<code class="eh ns nt nu nj b">/sendMail</code>端点期望JSON格式的输入。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="d0e3" class="mu ji hu nj b fv nn no l np nq">$ curl --header "Content-Type: application/json" \<br/>--request POST \<br/>--data '{"firstname": "John", "lastname": "Doe", "email": <a class="ae jg" href="mailto:%22john@doe.com" rel="noopener ugc nofollow" target="_blank">"john@doe.com</a>", "message": "Hi there"}'\<br/><a class="ae jg" href="https://b99gclthvi.execute-api.us-east-1.amazonaws.com/development/sendMail" rel="noopener ugc nofollow" target="_blank">https://xxx.execute-api.xx.amazonaws.com/development/sendMail</a></span></pre><p id="8356" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">如果发送了电子邮件，并且条目被写入DynamoDB，那么请求将会以这样的响应退出。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="ebde" class="mu ji hu nj b fv nn no l np nq">&gt; "Email Sent!"</span></pre><p id="4a66" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">现在，让我们用部署应用程序后得到的<code class="eh ns nt nu nj b">GET</code>端点来测试<code class="eh ns nt nu nj b">/list</code>端点。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="63f5" class="mu ji hu nj b fv nn no l np nq">$ curl <a class="ae jg" href="https://b99gclthvi.execute-api.us-east-1.amazonaws.com/development/sendMail" rel="noopener ugc nofollow" target="_blank">https://xxxx.execute-api.xx.amazonaws.com/development/</a><a class="ae jg" href="https://b99gclthvi.execute-api.us-east-1.amazonaws.com/development/list" rel="noopener ugc nofollow" target="_blank">list</a></span></pre><p id="82cd" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><code class="eh ns nt nu nj b">/list</code>端点响应将如下所示:</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="b5e4" class="mu ji hu nj b fv nn no l np nq">&gt; {"body": [{"firstname": "John", "lastname": "Doe", "email": "<a class="ae jg" href="mailto:john@doe.com" rel="noopener ugc nofollow" target="_blank">john@doe.com</a>", "updatedAt": 1529425349731, "message": "Hi there", "id": "f651c404-73dc-11e8-bf3e-be54be0b5d22", "createdAt": 1529425349731}], "statusCode": 200}</span></pre><h2 id="0582" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">6.联系方式</h2><p id="c136" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">随着无服务器功能正常工作，我们可以继续将它集成到我们的静态联系人表单中。静态表单代码在<code class="eh ns nt nu nj b">public</code>文件夹中。</p><p id="b821" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">在您最喜欢的IDE中打开<code class="eh ns nt nu nj b">index.html</code>文件，用<code class="eh ns nt nu nj b">/sendMail</code>端点更新<code class="eh ns nt nu nj b">URL</code>变量，您就可以开始了。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="c73c" class="mu ji hu nj b fv nn no l np nq"><em class="mc">//Insert your lambda function URL here</em></span><span id="a603" class="mu ji hu nj b fv nv no l np nq">var URL = "<a class="ae jg" href="https://b99gclthvi.execute-api.us-east-1.amazonaws.com/development/sendMail" rel="noopener ugc nofollow" target="_blank">https://xxx.execute-api.xx.amazonaws.com/development/sendMail</a>";</span></pre><p id="9b1f" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">使用浏览器中的<code class="eh ns nt nu nj b">file:///&lt;path&gt;/&lt;to&gt;/&lt;folder&gt;/index.html</code>导航到页面或上传到S3桶并启用静态托管。</p><pre class="lv lw lx ly fq ni nj nk nl aw nm dt"><span id="7ddb" class="mu ji hu nj b fv nn no l np nq">$ aws s3 sync public s3://your-bucket-name</span></pre><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nr"><img src="../Images/3e3ac54234c42c4e0a5fa6000fabd217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G6Q3XRI6tADC38nbcJohkQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Serverless Contact Form</figcaption></figure><p id="fe48" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">用一杯卡布奇诺、拿铁或<insert-your-favorite-drink>犒劳自己。多亏了无服务器，你刚刚实现了一个很酷的方法来保持你的网站在静态主机上处理你的表单。</insert-your-favorite-drink></p></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><h1 id="5366" class="jh ji hu bd jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke dt translated">事后思考</h1><p id="2f94" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">无服务器绝对是未来的发展方向，不仅仅是静态的联系方式。无服务器已经为你打开了一个机会的宇宙，联系方式只是开始。如何使用无服务器的网站分析，访客计数器或点击跟踪？</p><p id="5040" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">无尽的机会在等着你。在无服务器中开始你的下一个项目，这将是一个令人敬畏的旅程。</p></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><p id="65cd" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><em class="mc">最初发表于</em><a class="ae jg" href="https://www.serverlessops.io/blog/serverless-contact-form-for-static-websites" rel="noopener ugc nofollow" target="_blank"><em class="mc">www . server less ops . io</em></a><em class="mc">。</em></p></div></div>    
</body>
</html>