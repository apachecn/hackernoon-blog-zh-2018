<html>
<head>
<title>Text Classification Simplified with Facebook’s FastText</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用脸书的快速文本简化文本分类</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/text-classification-simplified-with-facebooks-fasttext-b9d3022ac9cb?source=collection_archive---------1-----------------------#2018-07-26">https://medium.com/hackernoon/text-classification-simplified-with-facebooks-fasttext-b9d3022ac9cb?source=collection_archive---------1-----------------------#2018-07-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="92c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用FastText API分析亚马逊产品评论情感的循序渐进教程</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/612e0eb0849f8e3bf9355671ba530eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_doQR9npxi9T2OBll8r-Q.jpeg"/></div></div></figure><p id="6773" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kb">无耻插件:我们是一个</em> <a class="ae kc" href="https://dataturks.com" rel="noopener ugc nofollow" target="_blank"> <em class="kb">机器学习数据标注平台</em> </a> <em class="kb">让你超级轻松的</em> <a class="ae kc" href="https://dataturks.com" rel="noopener ugc nofollow" target="_blank"> <em class="kb">构建ML数据集</em> </a> <em class="kb">。只需上传数据，邀请您的团队，快速构建数据集。</em></p><p id="9ab6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个博客提供了一个详细的一步一步的教程来使用FastText进行文本分类。为此，我们选择对Amazon.com上的客户评论进行情感分析，并详细说明如何收集特定产品的评论，以便对其进行情感分析，分析结果可以在购买前根据给定的反馈决定产品的质量。</p></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><h1 id="3d8e" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">什么是FastText？</h1><p id="970c" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">文本分类已经成为商业世界的基本组成部分；无论是用于垃圾邮件过滤，还是用于分析电子商务网站的推文或客户评论，这可能是最普遍的例子。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ln"><img src="../Images/d8d6bf492ad8befa552af182c9905058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rf1VgmGi0mIp6mTdPqWWxw.jpeg"/></div></div></figure><p id="3c46" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">FastText是由脸书人工智能研究所(FAIR)开发的开源库，专门致力于简化文本分类。FastText能够在多核CPU上在不到10分钟的时间内用数百万个示例文本数据进行训练，并使用训练好的模型在不到5分钟的时间内对超过300，000个类别中的未加工文本进行预测。</p></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><h1 id="c766" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">用于训练的预标记数据集:</h1><p id="ab8a" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">收集从Kaggle.com获得的包含几百万条评论的人工注释的亚马逊评论数据集，并在转换为FastText格式后用于训练模型。</p><p id="ddb4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">快速文本的数据格式如下:</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="8ea8" class="lt kl hu lp b fv lu lv l lw lx">__label__&lt;X&gt; __label__&lt;Y&gt; ... &lt;Text&gt;</span></pre><p id="299e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中X和Y代表类别标签。</p><p id="fb45" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们使用的数据集中，我们将评论标题放在评论前面，用“:”和空格分隔。</p><p id="1a82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面给出了训练数据文件的样本，用于训练和测试模型的数据集可以在<a class="ae kc" href="https://www.kaggle.com/bittlingmayer/amazonreviews/home" rel="noopener ugc nofollow" target="_blank">Kaggle.com</a>网站找到。</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="752e" class="lt kl hu lp b fv lu lv l lw lx">__label__2 Great CD: My lovely Pat has one of the GREAT voices of her generation. I have listened to this CD for YEARS and I still LOVE IT. When I'm in a good mood it makes me feel better. A bad mood just evaporates like sugar in the rain. This CD just oozes LIFE. Vocals are jusat STUUNNING and lyrics just kill. One of life's hidden gems. This is a desert isle CD in my book. Why she never made it big is just beyond me. Everytime I play this, no matter black, white, young, old, male, female EVERYBODY says one thing "Who was that singing ?"</span></pre><p id="3805" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里，我们只有两个等级1和2，其中__label__1表示评论者对产品给出了1星或2星，而__label__2表示4星或5星评级。</p><h1 id="c2cd" class="kk kl hu bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh dt translated">用于文本分类的训练快速文本:</h1><h2 id="ee57" class="lt kl hu bd km md me mf kq mg mh mi ku jc mj mk ky jg ml mm lc jk mn mo lg mp dt translated">预处理和清理数据:</h2><p id="ec79" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">在规范化文本大小写并移除不需要的字符后，执行以下命令以生成经过预处理和清理的训练数据文件。</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="476b" class="lt kl hu lp b fv lu lv l lw lx">cat &lt;path to training file&gt; | sed -e “s/\([.\!?,’/()]\)/ \1 /g” | tr “[:upper:]” “[:lower:]” &gt; &lt;path to pre-processed output file&gt;</span></pre><h2 id="bb9d" class="lt kl hu bd km md me mf kq mg mh mi ku jc mj mk ky jg ml mm lc jk mn mo lg mp dt translated">设置快速文本:</h2><p id="17ae" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">让我们从下载<a class="ae kc" href="https://github.com/facebookresearch/fastText/releases" rel="noopener ugc nofollow" target="_blank">最新版本</a>开始:</p><p id="22f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh mq mr ms lp b">$ wget https://github.com/facebookresearch/fastText/archive/v0.1.0.zip<br/>$ unzip v0.1.0.zip</code></p><p id="0c35" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">移动到fastText目录并构建它:</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="1f1f" class="lt kl hu lp b fv lu lv l lw lx">$ cd fastText-0.1.0<br/>$ make</span></pre><p id="35f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不带任何参数运行二进制文件将打印高级文档，显示fastText支持的不同用例:</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="082a" class="lt kl hu lp b fv lu lv l lw lx">&gt;&gt; ./fasttext<br/>usage: fasttext &lt;command&gt; &lt;args&gt;</span><span id="b626" class="lt kl hu lp b fv mt lv l lw lx">The commands supported by fasttext are:</span><span id="84be" class="lt kl hu lp b fv mt lv l lw lx">  supervised              train a supervised classifier<br/>  quantize                quantize a model to reduce the memory usage<br/>  test                    evaluate a supervised classifier<br/>  predict                 predict most likely labels<br/>  predict-prob            predict most likely labels with probabilities<br/>  skipgram                train a skipgram model<br/>  cbow                    train a cbow model<br/>  print-word-vectors      print word vectors given a trained model<br/>  print-sentence-vectors  print sentence vectors given a trained model<br/>  nn                      query <strong class="lp hv">for</strong> nearest neighbors<br/>  analogies               query <strong class="lp hv">for</strong> analogies</span></pre><p id="8e7f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我们主要使用<code class="eh mq mr ms lp b">supervised</code>、<code class="eh mq mr ms lp b">test</code>和<code class="eh mq mr ms lp b">predict</code>子命令，它们对应于学习(和使用)文本分类器。</p><h2 id="49ba" class="lt kl hu bd km md me mf kq mg mh mi ku jc mj mk ky jg ml mm lc jk mn mo lg mp dt translated">训练模型:</h2><p id="6838" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">以下命令用于为文本分类训练模型:</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="6da1" class="lt kl hu lp b fv lu lv l lw lx">./fasttext supervised -input &lt;path to pre-processed training file&gt; -output &lt;path to save model&gt; -label __label__ </span></pre><p id="050f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh mq mr ms lp b">-input</code>命令行选项指的是训练文件，而<code class="eh mq mr ms lp b">-output</code>选项指的是保存模型的位置。训练完成后，在给定位置创建一个包含已训练分类器的文件<code class="eh mq mr ms lp b">model.bin</code>。</p><h1 id="a270" class="kk kl hu bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh dt translated"><strong class="ak">用于改进模型的可选参数:</strong></h1><p id="dc15" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated"><strong class="it hv">增加训练的时期数:</strong></p><p id="a903" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">默认情况下，模型在每个示例上训练5个时期，为了更好地训练，我们可以指定-epoch参数。</p><p id="599c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">示例:</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="78bb" class="lt kl hu lp b fv lu lv l lw lx">./fasttext supervised -input &lt;path to pre-processed training file&gt; -output &lt;path to save model&gt; -label __label__ -epoch 50</span></pre><p id="cc32" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">指定学习率:</strong></p><p id="c1d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">改变学习速率意味着改变我们模型的学习速度是增加(或减少)算法的学习速率。这对应于处理每个示例后模型的变化程度。学习率为0意味着模型根本没有改变，因此没有学到任何东西。学习率的正确值在<code class="eh mq mr ms lp b">0.1 - 1.0</code>范围内。</p><p id="625c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">lr的默认值为0.1。下面是我们如何指定这个参数。</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="f529" class="lt kl hu lp b fv lu lv l lw lx">./fasttext supervised -input &lt;path to pre-processed training file&gt; -output &lt;path to save model&gt; -label __label__ -lr 0.5</span></pre><p id="ac3c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">使用n元语法作为特征:</strong></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/e087418899729886720925628ee42e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*tufb2Ea4ZBVydTuvrIUT5A.png"/></div></figure><p id="2cb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于依赖于词序的问题，尤其是情感分析，这是一个有用的步骤。它指定在n大小的窗口中使用连续标记的串联作为训练的特征。</p><p id="d700" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们为此指定-wordNgrams参数(理想值在2到5之间) :</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="2a5d" class="lt kl hu lp b fv lu lv l lw lx">./fasttext supervised -input &lt;path to pre-processed training file&gt; -output &lt;path to save model&gt; -label __label__ -wordNgrams 3</span></pre><h1 id="fd56" class="kk kl hu bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh dt translated">测试和评估模型:</h1><p id="a9db" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">以下命令用于在预注释的测试数据集上测试模型，并将原始标签与每个评论的预测标签进行比较，并以精度和召回值的形式生成评估分数。</p><p id="7a2f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">精度是由fastText预测的标签中正确标签的数量。召回是成功预测的标签数量。</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="877e" class="lt kl hu lp b fv lu lv l lw lx">./fasttext test &lt;path to model&gt; &lt;path to test file&gt; k</span></pre><p id="9efa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中参数k表示该模型要预测每个评论的前k个标签。</p><p id="2942" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在400000条评论的测试数据上评估我们的训练模型所获得的结果如下。正如所观察到的，获得了91%的精确召回率，并且在非常短的时间内训练了该模型。</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="247f" class="lt kl hu lp b fv lu lv l lw lx">N 400000<br/>P@1 0.913<br/>R@1 0.913<br/>Number of examples: 400000</span></pre><h1 id="98b4" class="kk kl hu bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh dt translated">分析Amazon.com网站上顾客对产品的实时评论:</h1><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mv"><img src="../Images/588daf9effb467bb84ee27bf6360128d.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*wIt5ulTaYN_qhXT-2NJh-Q.jpeg"/></div></figure><h2 id="59bc" class="lt kl hu bd km md me mf kq mg mh mi ku jc mj mk ky jg ml mm lc jk mn mo lg mp dt translated">收集亚马逊客户评论:</h2><p id="8edf" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">我们使用现有的python库从页面中抓取评论。</p><p id="c9c0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要设置模块，请在命令提示符/终端中键入:</p><p id="afee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh mq mr ms lp b">pip install amazon-review-scraper</code></p><p id="a01f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">给定网页的url，下面是一个收集特定产品评论的示例代码:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mw mx l"/></div></figure><p id="0fd5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注:在输入特定产品的客户复查页的URL时，如果该页不存在，请确保附加&amp;pageNumber=1，以便刮刀正常工作。</p><p id="8da2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的代码从给定的url中抓取评论，并以下列格式创建一个输出csv文件:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mw mx l"/></div></figure><p id="39a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从上面的csv文件中，我们提取了标题和正文，并像在训练文件中一样，将它们附加在一起，用':和空格分隔，并将它们存储在单独的txt文件中，用于情感预测。</p><h1 id="24b1" class="kk kl hu bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh dt translated">刮削数据的情感预测:</h1><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="3348" class="lt kl hu lp b fv lu lv l lw lx">./fasttext predict &lt;path to model&gt; &lt;path to test file&gt; k &gt; &lt;path to prediction file&gt;</span></pre><p id="e153" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中k表示模型将预测每个评论的前k个标签。</p><p id="2e9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上述评论预测的标签如下:</p><pre class="jq jr js jt fq lo lp lq lr aw ls dt"><span id="031d" class="lt kl hu lp b fv lu lv l lw lx">__label__2<br/>__label__1<br/>__label__2<br/>__label__2<br/>__label__2<br/>__label__2<br/>__label__2<br/>__label__2<br/>__label__1<br/>__label__2<br/>__label__2</span></pre><p id="4515" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">人工验证时非常准确。然后，预测文件可用于进一步的详细分析和可视化。</p><p id="7f63" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，在这篇博客中，我们学习了使用FastText API进行文本分类，抓取亚马逊客户对给定产品的评论，并用训练好的模型预测他们的情绪进行分析。</p><p id="7db5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您有任何疑问或建议，我很乐意倾听。请在abhishek.narayanan@dataturks.com给我写信。</p><p id="1c02" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kb">无耻插件:我们是一个数据注释平台，让你建立ML数据集超级简单。只需上传数据，邀请您的团队，快速构建数据集。</em> <a class="ae kc" href="https://www.dataturks.com" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> <em class="kb">快来看看吧！</em> </strong> </a></p></div></div>    
</body>
</html>