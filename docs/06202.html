<html>
<head>
<title>Automating EBS snapshots in AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS中自动化EBS快照</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/automating-ebs-snapshots-in-aws-b8401fe40353?source=collection_archive---------6-----------------------#2018-07-26">https://medium.com/hackernoon/automating-ebs-snapshots-in-aws-b8401fe40353?source=collection_archive---------6-----------------------#2018-07-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1ee7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">AWS控制台中的一项新功能让您可以在5分钟内自动备份所有重要的卷。这是你怎么做的。</p><p id="0d06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如S3存储区无意中向世界敞开大门一样，有大量生产EBS卷没有备份策略。许多较新的AWS用户惊讶地发现EBS没有自动备份，不幸的是，当他们意外丢失一个卷时，第一场灾难就发生了。</p><p id="2909" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不久前，创建EBS备份(即快照)的简单方法是在每个实例上使用一个带有cron作业的小Python脚本。生命周期管理需要更多的准备工作，并且确保每个实例都包含在内需要一些协调的努力。</p><p id="2530" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好消息是AWS让这变得简单多了。在您的EC2仪表板上，您会看到一个新选项“生命周期管理器”，它最近出现在左下角:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/d69bd7f60fbe378f10fa393fdee3fd99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W8yZ9a48CdXEINEgEBUwRQ.png"/></div></div></figure><h2 id="9345" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">为什么您需要快照的生命周期管理？</h2><p id="2915" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">快照是增量备份，仅保存备份状态之间的差异，这使得创建快照比执行完整备份更快。</p><p id="0fed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">问题是，AWS限制每个帐户最多10，000个快照，虽然这已经很慷慨了，但如果您在一个实例群中运行每日快照，就有可能达到上限。此外，根据您的备份需求，您可能不需要为每个实例保留多个快照，因此删除较旧的快照是有意义的。</p><h2 id="fb97" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">开始前做好准备。</h2><p id="7265" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">令人欣慰的是，AWS使这变得非常容易，因为您可以通过使用标记来创建针对您的整个卷清单的策略。例如，您可以创建一个名为“Environment”且值为“Production”的标记，并确保您的所有生产卷都包括在备份策略中。</p><p id="525f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者，你可以按项目、客户、部门或任何其他对你的业务有意义的分组进行标记。将标记添加到卷后，就可以开始下一步了。</p><h2 id="bff2" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">创建生命周期策略。</h2><p id="365e" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">在Lifecycle Manager屏幕中，您只需提供策略描述、目标卷标记的名称以及备份时间表。您还可以包括每个卷保留多少快照:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lc"><img src="../Images/858cf27552ac51119a15ca31e15392e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQMsg3sazVdXWc_kI32xlQ.png"/></div></div></figure><p id="1492" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">准备好后，点击“创建”按钮，您的策略就生效了。该策略不会立即运行，您必须等到规则中定义的第一个窗口。</p><p id="9743" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回到Lifecycle Manager主窗口，您可以看到策略摘要:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ld"><img src="../Images/dcb135aac74e469f6b9e1fc13eac8b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YOQHgCXERP8NzX-nbCE1Fw.png"/></div></div></figure><p id="d8f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除了存储之外，这项服务不收取任何费用，尽管备份期间实例负载和IO使用量会增加，但如果确实需要的话，每小时运行一次快照是没有问题的。</p><p id="c445" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">请记住:Lifecycle Manager是针对每个地区的服务，在一个地区设置的策略不会备份另一个地区的卷。</em></p><h2 id="680c" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">今天就做！</h2><p id="88ea" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">如果您的生产中有EBS卷，请检查备份计划中包括了多少个。在我见过的每个生产环境中，总有一小部分被排除在外(意外地)，当出现故障或意外的实例终止时，这可能是灾难性的。</p><p id="973c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您还可以通过使用AWS Config来强制实施标记规则，以帮助在将来监视任何缺少标记的生产卷。这是管理大量EBS卷或更复杂的AWS环境的一种更简单的方法，并确保您的所有生产卷总是得到备份。Config还使向审计人员证明备份确实在发生变得很容易。</p></div></div>    
</body>
</html>