<html>
<head>
<title>What Happens When a Shitty Coder Builds Your Backend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当一个低劣的编码器构建你的后端时会发生什么</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/what-happens-when-a-shitty-coder-builds-your-backend-4cb0a57ff6ef?source=collection_archive---------3-----------------------#2018-07-27">https://medium.com/hackernoon/what-happens-when-a-shitty-coder-builds-your-backend-4cb0a57ff6ef?source=collection_archive---------3-----------------------#2018-07-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/514fb7b26c3f0ee893fa77e32f4c90ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*sijd29uOyExqdagJA0Zvpw.jpeg"/></div></figure></div><div class="ab cl iy iz hc ja" role="separator"><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd"/></div><div class="hn ho hp hq hr"><p id="7074" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><strong class="jh hv">注:</strong> <em class="kd">出于安全考虑，这里涉及的实际web服务就不具名了，所以为了这篇文章我将虚构一个</em> <strong class="jh hv"> <em class="kd">虚构的</em> </strong> <em class="kd">网络游戏商店，名为</em>忒修斯游戏<em class="kd"> (TG)与</em> <strong class="jh hv"> <em class="kd">虚构的</em></strong><em class="kd">URL:</em><code class="eh ke kf kg kh b">https://theseus-games.co.uk</code><em class="kd">。</em></p></div><div class="ab cl iy iz hc ja" role="separator"><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd"/></div><div class="hn ho hp hq hr"><p id="322e" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">我最近试图从TG购买一款新游戏，不幸的是它只提供给<em class="kd">高级</em>会员(TG有两个会员级别，<em class="kd">基本</em>和<em class="kd">高级</em>)，而高级会员贵得要命。我咬了一会儿我的指甲，不知道我能做什么，因为我未来的幸福严重依赖于尽快玩几个小时的游戏。因为我自己是一名软件工程师，所以我决定尝试一下是否可以暂时使用一下TG的服务，看看它是如何工作的。</p><p id="87ca" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">我打开Chrome DevTools重新加载了TG的游戏购买页面，以便查看网站提出了哪些请求。我注意到的第一件事是TG使用AJAX加载它的一些Javascript资产，大约有一打。其中两个剧本引起了我的注意:<code class="eh ke kf kg kh b">user.js</code>和<code class="eh ke kf kg kh b">purchase.js</code>，我迅速打开它们，看看里面埋着什么宝藏。</p><pre class="ki kj kk kl fq km kh kn ko aw kp dt"><span id="0221" class="kq kr hu kh b fv ks kt l ku kv">// snippet from <em class="kd">https://theseus-games.co.uk/assets/js/user.js</em></span><span id="1618" class="kq kr hu kh b fv kw kt l ku kv">componentDidMount() {<br/>  <strong class="kh hv">this</strong>.retrieveContactInformation();<br/>  <strong class="kh hv">this</strong>.retrieveUserInfo();<br/>}<br/><br/>retrieveUserInfo() {<br/>  axios.get(<strong class="kh hv">this</strong>.appUrl + '/user').then(<br/>    <strong class="kh hv">function </strong>(response) {<br/><br/>      <strong class="kh hv">this</strong>.setState({<br/>        application: response.data.application,<br/>        active: response.data.active,<br/>        isLoaded: <strong class="kh hv">true<br/>      </strong>});<br/><br/>    }.bind(<strong class="kh hv">this</strong>)<br/>  );<br/>}</span></pre><p id="4865" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">当然，我已经用React和React Native构建了几个应用程序，我立即意识到web前端是用React构建的，与Laravel后端通信(我从会话cookies中获得这一点)。如果你懂一点Javascript(或者几乎任何一种网络语言，哈哈)，你可以通过这些代码片段来工作。</p><pre class="ki kj kk kl fq km kh kn ko aw kp dt"><span id="d698" class="kq kr hu kh b fv ks kt l ku kv">// s<!-- -->nippet from <em class="kd">https://theseus-games.co.uk/assets/js/purchase.js</em></span><span id="1d85" class="kq kr hu kh b fv kw kt l ku kv">purchaseGame = (evt) =&gt; {<br/>  evt.preventDefault();<br/>  <br/>  <strong class="kh hv">if </strong>(<strong class="kh hv">this</strong>.state.active == 2 || <strong class="kh hv">this</strong>.state.active == 33) {<br/>    <strong class="kh hv">this</strong>.setState({<br/>      isLoaded: <strong class="kh hv">false<br/>    </strong>});<br/><br/>    <strong class="kh hv">var </strong>newGame = {<br/>      gameId: <strong class="kh hv">this</strong>.state.gameId,<br/>      session: <strong class="kh hv">this</strong>.state.session<br/>    };<br/><br/>    axios({<br/>      method: 'post',<br/>      url: <strong class="kh hv">this</strong>.appUrl + "/purchaseGame",<br/>      data: newGame<br/>    }).then(<br/>      <strong class="kh hv">function </strong>(response) {<br/>        <strong class="kh hv">this</strong>.setState({<br/>          isLoaded: <strong class="kh hv">true<br/>        </strong>});<br/>      }.bind(<strong class="kh hv">this</strong>)<br/>    );<br/>  } <strong class="kh hv">else </strong>{<br/>    <strong class="kh hv">this</strong>.setState({<br/>      message: 'Sorry! This game is only available to our premium members.'<br/>    });<br/>  }<br/>}</span></pre><p id="c507" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">显然，用户会员信息是通过<code class="eh ke kf kg kh b"><strong class="jh hv">User</strong></code>实体中的<code class="eh ke kf kg kh b">active</code>字段来表示的，只有<code class="eh ke kf kg kh b">active</code>为<strong class="jh hv"> 2 </strong>或<strong class="jh hv"> 33 </strong>的用户才可以获得游戏。当然，数字必须代表会员级别，或者是<strong class="jh hv"> 2 </strong>或者是<strong class="jh hv"> 33 </strong>表示<em class="kd">高级</em>会员，因为我得到的信息是:<em class="kd">‘对不起！这个游戏只对我们的高级会员</em>开放，我的<code class="eh ke kf kg kh b">active</code>领域绝对不是<strong class="jh hv"> 2 </strong>或<strong class="jh hv"> 33 </strong>。</p><p id="38ab" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">在DevTools的request选项卡中，我看到了实际的<strong class="jh hv"> GET </strong> <code class="eh ke kf kg kh b"><em class="kd">/user</em></code> API请求，并发现了以下响应:</p><pre class="ki kj kk kl fq km kh kn ko aw kp dt"><span id="2af1" class="kq kr hu kh b fv ks kt l ku kv">// response for <strong class="kh hv">GET</strong> <em class="kd">https://theseus-games.co.uk/application/user</em></span><span id="1a49" class="kq kr hu kh b fv kw kt l ku kv">{<br/>    "application":"182718048",<br/>    "active":22,<br/>    "userId":60088<br/>}</span></pre><p id="7d76" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">显然，我的<code class="eh ke kf kg kh b">active</code>字段是<strong class="jh hv"> 22 </strong>，这就是web应用程序知道拒绝我访问的原因。</p><p id="7199" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">我立即启动了Postman，以便发出API请求来更新我的<code class="eh ke kf kg kh b">active</code>字段。从DevTools中，我将当前会话cookie和<code class="eh ke kf kg kh b">X-XSRF-TOKEN</code>头值复制到Postman中，并尝试向<code class="eh ke kf kg kh b">https://theseus-games.co.uk/application/user/60088</code>发出一个<strong class="jh hv"> PUT </strong>请求，其有效负载为:</p><pre class="ki kj kk kl fq km kh kn ko aw kp dt"><span id="7aeb" class="kq kr hu kh b fv ks kt l ku kv">// payload to <strong class="kh hv">PUT</strong> <em class="kd">https://theseus-games.co.uk/application/user</em></span><span id="acf3" class="kq kr hu kh b fv kw kt l ku kv">{<br/>    "application":"182718048",<br/>    "active":2,<br/>    "userId":60088<br/>}</span></pre><p id="0cdc" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">但是我立即收到一个405(不允许方法)错误，这意味着用户以不同的方式更新。依次试了<strong class="jh hv">贴</strong>贴<code class="eh ke kf kg kh b">/application/updateUser</code>、<strong class="jh hv">贴</strong>贴<code class="eh ke kf kg kh b">/application/updateUserInfo</code>，两个都得了404。在这一点上，我决定完全放弃这种方法，尝试别的方法。(如果我想继续，我会检查通过AJAX下载的其他<code class="eh ke kf kg kh b">*.js</code>文件，以获得更新用户的具体路径，或者只是转到我的帐户页面，尝试更新我的帐户，然后检索路径；但是剥大象的皮有很多种方法哈哈。)</p><p id="d195" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">我有这个很酷的Chrome扩展，叫做<a class="ae kx" href="https://chrome.google.com/webstore/detail/tamper-chrome-extension/hifhgpdkfodlpnlmlnmhchnkepplebkb" rel="noopener ugc nofollow" target="_blank"> Tamper Chrome </a>，用来(惊喜！)篡改浏览器中的请求，修改请求头、有效载荷等。我尝试的下一种方法是篡改实际的API请求，我可以很容易地尝试两件事:</p><p id="aef6" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><strong class="jh hv"> 1。</strong>下载<code class="eh ke kf kg kh b">https://theseus-games.co.uk/assets/js/purchase.js</code>的副本，修改<code class="eh ke kf kg kh b">if</code>条件检查<code class="eh ke kf kg kh b">active</code>字段，然后放入我的本地服务器(如<code class="eh ke kf kg kh b">/var/www/html/web/purchase.js</code>)，然后修改外发请求为<code class="eh ke kf kg kh b">https://theseus-games.co.uk/assets/js/purchase.js</code>并将请求路径改为<code class="eh ke kf kg kh b">http://localhost/web/purchase.js</code>，所以它改为服务于我的本地版本。对于我的局部修改，我可以简单地更改:</p><pre class="ki kj kk kl fq km kh kn ko aw kp dt"><span id="296e" class="kq kr hu kh b fv ks kt l ku kv">if (this.state.status == 2 || this.state.status == 33) {...}</span></pre><p id="b0f8" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">收件人:</p><pre class="ki kj kk kl fq km kh kn ko aw kp dt"><span id="8432" class="kq kr hu kh b fv ks kt l ku kv">if (true) {...}</span></pre><p id="3771" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><strong class="jh hv"> 2。</strong>以类似于<em class="kd"> (1) </em>的方式，我可以提供一个本地版本的<code class="eh ke kf kg kh b">https://theseus-games.co.uk/application/user</code>并简单地返回一个带有方便修改的<code class="eh ke kf kg kh b">active</code>字段的用户对象，然后修改AJAX请求路径到我的本地版本。我的意思是:</p><pre class="ki kj kk kl fq km kh kn ko aw kp dt"><span id="c84d" class="kq kr hu kh b fv ks kt l ku kv">// response for GET <em class="kd">http://localhost/api/user.json</em></span><span id="2aa1" class="kq kr hu kh b fv kw kt l ku kv">{<br/>    "application":"182718048",<br/>    "active":2,<br/>    "userId":60088<br/>}</span></pre></div><div class="ab cl iy iz hc ja" role="separator"><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd"/></div><div class="hn ho hp hq hr"><p id="0ab6" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">我选择了<em class="kd"> (2) </em>，并用漂亮的<code class="eh ke kf kg kh b"><a class="ae kx" href="https://github.com/typicode/json-server" rel="noopener ugc nofollow" target="_blank">json-server</a></code>节点包完成了这项工作。我创建了一个简单的<code class="eh ke kf kg kh b">test.json</code>文件，内容如下:</p><pre class="ki kj kk kl fq km kh kn ko aw kp dt"><span id="9c51" class="kq kr hu kh b fv ks kt l ku kv">{<br/>    "user": {<br/>        "application":"182718048",<br/>        "active":2,<br/>        "userId":60088<br/>    }<br/>}</span></pre><p id="400d" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">然后我启动了json-server:</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/ce3368ace19ec3f2b79d3eaf92533ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/0*dYBZsMFriyLE4fMr.png"/></div></figure><p id="ffb7" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">接下来，我激活了Tamper Chrome，以便从当前选项卡重新路由所有进一步的请求:</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff kz"><img src="../Images/176589cd6e7e563a42283f72b7b5f115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cbR-dMzHqgKsiqqN.png"/></div></div></figure><p id="49d1" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">我重新加载了页面。很快，<code class="eh ke kf kg kh b">https://theseus-games.co.uk/application/user</code>的AJAX请求出现了，我简单地将其修改到我的本地json服务器:</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div class="fe ff le"><img src="../Images/42dc42f773d82c70d3ebece229553995.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/0*JZ1D4CXdLtpIPezK.png"/></div></figure><p id="3400" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">当然，这个请求击中了我的json服务器，它愉快地响应了几个可爱的字节。</p><p id="bf4c" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">这就是我所需要做的，所以我决定再次点击<em class="kd">购买</em>按钮，当然，所有前端可以看到的是我是一个特权TG成员(哈哈！);然后出现了一个加载指示器，接下来是一个感谢我使用Theseus游戏的弹出窗口(<em class="kd">我的荣幸，朋友们</em>)，游戏很快就被下载到了我的电脑上。</p><p id="9519" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">我迅速抛弃了所有世俗的顾虑，将接下来的几个小时投入到游戏中，当我身心俱疲时，我躺在床上，严肃地思考着TG的不幸的人们本可以做些什么来进一步保护他们的商品。</p></div><div class="ab cl iy iz hc ja" role="separator"><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd"/></div><div class="hn ho hp hq hr"><p id="1b62" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">女士们先生们，这里的<strong class="jh hv">黄金法则</strong>是始终对web应用程序的所有敏感组件进行客户端和服务器端检查。在TG的情况下，在服务器端，在<code class="eh ke kf kg kh b">https://theseus-games.co.uk/application/purchaseGame</code>，他们没有，但应该只是再次验证我的<code class="eh ke kf kg kh b">active</code>字段，以确保我被授权购买所述游戏，这实际上是一个微不足道的检查。不幸的是，这是一些web开发人员(新手<em class="kd">甚至老手</em>)在构建web服务时仍然会犯的错误，并且经常无法加强他们的安全性，所以如果您构建web服务，请在将来多加注意。</p><p id="f582" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">感谢阅读，乡亲们。与朋友分享，并在下方留下您的反馈。非常爱。</p></div><div class="ab cl iy iz hc ja" role="separator"><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd"/></div><div class="hn ho hp hq hr"><p id="49b7" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><strong class="jh hv"> PS </strong> : <em class="kd">如上所述，没有忒修斯游戏(TG)和</em> <code class="eh ke kf kg kh b"><em class="kd">https://theseus-games.co.uk</em></code> <em class="kd">不存在。我已经通知了有问题的实际公司(抱歉，不是游戏商店)，他们已经解决了这个问题。</em></p></div><div class="ab cl iy iz hc ja" role="separator"><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd je"/><span class="jb bw bk jc jd"/></div><div class="hn ho hp hq hr"><p id="9829" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><em class="kd">原载于</em><a class="ae kx" href="https://elijahoyekunle.com/node/31" rel="noopener ugc nofollow" target="_blank"><em class="kd">https://elijahoyekunle.com</em></a><em class="kd">。</em></p><p id="60a5" class="pw-post-body-paragraph jf jg hu jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">您的web应用程序需要帮助吗？<a class="ae kx" href="https://elijahoyekunle.com/contact" rel="noopener ugc nofollow" target="_blank">联系我！</a>——<a class="ae kx" href="https://twitter.com/elijahoyekunle" rel="noopener ugc nofollow" target="_blank">推特</a>——<a class="ae kx" href="https://github.com/eloyekunle/" rel="noopener ugc nofollow" target="_blank">Github</a>——<a class="ae kx" href="https://www.linkedin.com/in/elijahoyekunle" rel="noopener ugc nofollow" target="_blank">LinkedIn</a></p></div></div>    
</body>
</html>