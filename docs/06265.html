<html>
<head>
<title>Build a Cloud Server State Machine with PubNub Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个具有PubNub功能的云服务器状态机</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-a-cloud-server-state-machine-with-pubnub-functions-205f5eee5a99?source=collection_archive---------32-----------------------#2018-07-27">https://medium.com/hackernoon/build-a-cloud-server-state-machine-with-pubnub-functions-205f5eee5a99?source=collection_archive---------32-----------------------#2018-07-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="fc3d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我们将向您展示如何使用PubNub函数创建一个简单的状态机；然而，在我们这样做之前，让我们解释一下什么是状态机以及它们的重要性。</p><h1 id="7e05" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">什么是状态机？</h1><p id="98d7" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">首先，状态机是一种数学抽象，它允许设备处于一组稳定条件中的一个，这取决于其先前的条件和其输入的当前值。交通信号灯是状态机的一个例子，根据是否有汽车存在，改变它的状态为绿色、黄色或红色。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff ks"><img src="../Images/23ef802c107a7822555a8284db66f5df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jrgKTjtnEKhhsXTf.png"/></div></div></figure><p id="c248" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">状态机是计算机编程的基本工具，也是嵌入式设备的高效基础设施，尤其是在物联网领域。由于大多数物联网设备都处于收集不同数量和类型的数据进行处理的情况下，<strong class="it hv">状态机允许将代码划分为更小的状态，因此不必同时运行所有代码</strong>。例如，为了延长电池寿命，当没有数据传入时，物联网设备可以通过进入“低功耗状态”来节能。</p><p id="b67a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，状态机允许代码具有很强的可读性，因为代码可以分解成非常小且易于管理的块，其他用户可以快速浏览。如果物联网设备运行不正常，开发人员可以从物理上识别哪个状态不正常，并快速修复与该状态相关的有问题的代码。</p><h1 id="593b" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">为什么要用PubNub函数来实现状态机？</h1><p id="7ef7" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">虽然状态机可以通过多种方式实现，但将PubNub嵌入到您的状态机设计中对于物联网嵌入式系统来说将证明是非常高效和有效的。</p><p id="da18" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用PubNub功能允许开发人员将所有繁重的计算和逻辑外包给云，这为物联网设备释放了许多资源。这允许设备的更好的电池寿命，并且开启了使用更便宜和/或更小的设备的可能性。</p><p id="1ab2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，PubNub Functions是云中的一个独立模块，可以在几秒钟内进行全局部署。这意味着，您可以让数百万台物联网设备立即接收代码和状态机的代码更新。</p><p id="136b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果应用正确，一个聪明的农民将会有数千个廉价的物联网灌溉设备分布在他的田地里，只需一个互联网连接，几千字节的存储空间和一个开关阀。该农民所要做的就是在PubNub函数中快速编写一个状态机，立即部署到他的所有设备上，并让他的所有设备最大限度地提高他的土地效率。他甚至可以在每个设备上安装湿度传感器，以监控植物何时需要浇水，并在天气/季节变化时对每个设备进行更新。</p><p id="e834" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里有一个小演示:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="le lf l"/></div></figure><h1 id="d85b" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">代码走查</h1><h1 id="da3b" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">第一步:计划</h1><p id="22e0" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">实现状态机的最关键的步骤之一是弄清楚它的设计，以及如何优化它，以获得它可以为您的场景提供的最大好处。你必须问自己:我需要多少个状态(变量值的数量)？我需要做什么来记住解释我的输入或产生我的输出？使用的“步骤”或“模式”是否有明确的顺序？我真的需要一个州吗？</p><p id="f353" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这次演示中，我想创建一个4按钮的物联网锁，需要正确的4位数字组合才能解锁。由于我将使用led来显示我所处的状态，我知道我总共需要5种状态(关闭，1种正确，2种正确，3种正确，解锁！).我还记录了代码优化的状态转换，您可以在下一步中看到。</p><h1 id="8124" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">第二步:抽出来</h1><p id="63f6" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">有了可靠的计划，就有了可靠的图表，这将使您的代码更容易编写和调试。想出一个状态图来解决问题:</p><ul class=""><li id="66c4" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">写出解决问题的算法或一系列步骤</li><li id="0633" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">算法中的每一步通常是图中的一个状态</li><li id="314b" class="lg lh hu it b iu lp iy lq jc lr jg ls jk lt jo ll lm ln lo dt translated">问问你自己什么过去的输入需要被记住，什么通常会导致一个状态表示</li></ul><p id="3132" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是我的场景中完成的流程图:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff lu"><img src="../Images/63f26bd638bae7dd7a3e37d98ab78cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dKLxSOJ5DxsDZv_t.png"/></div></div></figure><p id="d1f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，当按下“a”时，它会将状态恢复到正确的状态，这与其他输入不同，因为这可能是下一个输入序列的开始。</p><h1 id="eb92" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">第3部分:PubNub函数</h1><p id="d849" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">如果您花时间完成第1和第2部分，编写实际的状态机将是小菜一碟！如果你以前编码过状态机，这个过程是非常相似的，除了一些使云计算如此有价值的关键区别。</p><p id="0f5c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，你需要在这里注册一个免费账户。</p><p id="3ac0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，创建一个PubNub函数:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff lw"><img src="../Images/cb93d535f2661103e773989a2225ee4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*H0nsDQDXuJs0wTeC.png"/></div></div></figure><p id="aca0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/a071ada7727d47e713af32bbd1325210.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/0*ujMabNpGf3IMmGCq.png"/></div></figure><p id="aa4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">右上角的“创建新应用程序”</p><p id="177d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">命名您的应用程序，然后创建您的模块。如果需要，选择生成应用程序时给你的“演示”键集。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff ly"><img src="../Images/0f0b2ca2f79a23fe2483ef573fb7466c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hIFxCMxhurW74uqq.png"/></div></div></figure><p id="13a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，创建您的函数，命名您的通道，并确保选择“发布或发射后”选项</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/55da3f03185b78835f7c3b1634b645b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/0*-1nTEWg6Lmjsa9lV.png"/></div></figure><p id="feed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">既然您已经创建了容纳我们代码的不动产，我们可以开始从设备到云的外包或状态机。在PubNub函数中实现状态机的关键在于<a class="ae lv" href="https://www.pubnub.com/docs/blocks/kvstore-module" rel="noopener ugc nofollow" target="_blank"> KV store </a>特性。KV store允许您在函数中保存一个变量，该变量不会在每个函数被触发后重置其值。这对于状态变量和记住我们的输入来执行特定的输出是完美的。</p><p id="a444" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要使用KV store和一些PubNub功能，我们稍后需要发布到我们的物联网设备，包括这些库</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="067d" class="mf jq hu mb b fv mg mh l mi mj">const db = require("kvstore"); <br/>const pubnub = require('pubnub');</span></pre><p id="4962" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">KV store的工作方式是将变量存储在PubNub Functions服务器中，要访问该变量，必须向该服务器发出GET和SET请求。因此，要让我们的函数首先读取状态变量，看看状态是否已经改变，您必须做出这样的承诺，</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="8938" class="mf jq hu mb b fv mg mh l mi mj">//retrieve state variable from kv store return db.get("state").then((state) =&gt; {&lt;State machine code&gt;}</span></pre><p id="62e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">状态机的结构如下:外部if语句检查状态，内部if语句检查输入。所以外部结构应该这样实现:</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="5559" class="mf jq hu mb b fv mg mh l mi mj">// !state checks if state is null, in case nothing has ever been written to the state before<br/>if(state == 0 || !state){} </span><span id="bb4c" class="mf jq hu mb b fv mk mh l mi mj">else if (state == 1){} <br/>else if (state == 2){} <br/>else if (state == 3){}</span></pre><p id="d662" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要实现输入，请参考您之前创建的流程图。每个if语句都是图中的一个块，因此您必须检查箭头以了解每个输入如何影响状态。然后，根据每个状态实现内部if语句。</p><p id="3127" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于本演示，由于数据输入来自以“文本”结构表示的消息，后面是来自远程按钮的“a”、“b”、“c”或“d”，我们必须像这样打开消息:</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="a0d0" class="mf jq hu mb b fv mg mh l mi mj">if(request.message.text == "a"){}</span></pre><p id="ce21" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将在下一节更多地讨论发布按钮消息的结构。</p><p id="9559" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据您的输入，您可能希望更改您的状态，并在您设备的频道上发布一条消息，让它知道应该做什么。通常，您会希望将消息发布回第二个通道，这样消息就不会与从设备发布的消息冲突。</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="53b6" class="mf jq hu mb b fv mg mh l mi mj">pubnub.publish({ <br/>     "channel": "ch2", <br/>     "message": "a" <br/>     }).then((publishResponse) =&gt; { <br/>     console.log(`Publish Status:   <br/>     ${publishResponse[0]}:${publishResponse[1]} with TT<br/>     ${publishResponse[2]}`); });</span></pre><p id="cf28" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，如果状态变量已经更改，您将希望将它存储到KV存储中。您可能希望在Outer (state) if语句的末尾，紧接在Inner (data input) if语句之后执行此操作。</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="d160" class="mf jq hu mb b fv mg mh l mi mj">//store state in kv store <br/>db.set("state", state) </span><span id="2fbb" class="mf jq hu mb b fv mk mh l mi mj">//error handling <br/>.catch((err) =&gt; { <br/>console.log("An error occured.", err); <br/>});</span></pre><p id="b6b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些都是制作PubNub状态机所需的工具。如果你想看演示项目的全部代码，这里有GitHub库的链接:<a class="ae lv" href="https://github.com/Cakhavan/PubNubStateMachine.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Cakhavan/PubNubStateMachine.git</a></p><h1 id="c232" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">第4部分:客户端代码</h1><p id="54bd" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">现在，您将从客户端设备的角度看到使用PubNub状态机的好处。由于所有的逻辑都在云中处理，我们需要做的就是确保我们的设备可以发布和订阅消息，这让PubNub变得更加简单！</p><p id="afee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个演示中，我选择用JavaScript编写一个Arduino，这意味着我需要使用Johnny-Five平台来允许程序与设备通信。你可以通过运行终端<a class="ae lv" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank"> npm </a>命令下载Johnny-Five</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="2d31" class="mf jq hu mb b fv mg mh l mi mj">npm install johnny-five</span></pre><p id="a6b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据你的电路设置，Johnny-five提供了许多不同的实现方式，甚至电路图来帮助你弄清楚你想做什么:【http://johnny-five.io/examples/<a class="ae lv" href="http://johnny-five.io/examples/" rel="noopener ugc nofollow" target="_blank"/></p><p id="604b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我的演示中，我将4个上拉按钮连接到输入A2-A5，将3个led连接到输入11-13。</p><p id="54d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你想好了要构建什么样的电路，就在你的代码中包含你的库。</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="496a" class="mf jq hu mb b fv mg mh l mi mj">var five = require("johnny-five"), board, button; <br/>board = new five.Board(); <br/>var PubNub = require('pubnub');</span></pre><p id="57c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">打开Johnny-five板以连接Arduino</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="9183" class="mf jq hu mb b fv mg mh l mi mj">board.on("ready", function(){&lt;your code&gt;}</span></pre><p id="f458" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，按照Johnny-Five语法声明您的按钮和led</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="2cdd" class="mf jq hu mb b fv mg mh l mi mj">// Create a new 'LED' hardware instance. <br/>var led_1 = new five.Led(13); <br/>var led_2 = new five.Led(12); <br/>var led_3 = new five.Led(11); </span><span id="b316" class="mf jq hu mb b fv mk mh l mi mj">// Create a new `button` hardware instance.<br/>var button_1 = new five.Button({ pin: "A5", isPullup: true });<br/>var button_2 = new five.Button({ pin: "A4", isPullup: true }); <br/>var button_3 = new five.Button({ pin: "A3", isPullup: true }); <br/>var button_4 = new five.Button({ pin: "A2", isPullup: true });</span></pre><p id="c518" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用您的键集初始化您的PubNub实例以发布和订阅消息</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="c5c0" class="mf jq hu mb b fv mg mh l mi mj">pubnub = new PubNub({ <br/>publishKey : 'pub-c-2bda6cf3-c455-4b28-bbed-00611b461f98', subscribeKey : 'sub-c-5bdd008c-6d97-11e8-a49b-66b3abd5adf6', <br/>});</span></pre><p id="7242" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，创建一个要调用的函数，并能够根据您想要的任何格式和通道发布消息。</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="fac5" class="mf jq hu mb b fv mg mh l mi mj">function publish(x){ //x is the message passed to be published </span><span id="f16f" class="mf jq hu mb b fv mk mh l mi mj">var publishConfig = {channel : "ch1", message : <br/>{ "text": x //publish messages of the format message.text.x } } </span><span id="ae52" class="mf jq hu mb b fv mk mh l mi mj">pubnub.publish(publishConfig, function(status, response){   <br/>     console.log(status, response); }); };</span></pre><p id="0bc2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，配置按钮来发布状态机输入的数据</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="8dea" class="mf jq hu mb b fv mg mh l mi mj">// "down" the button is pressed <br/>button_1.on("down", function(){ publish("a"); }); button_2.on("down", function(){ publish("b"); }); button_3.on("down", function(){ publish("c"); }); button_4.on("down", function(){ publish("d"); });</span></pre><p id="ab06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，订阅接收状态机发布的消息的第二个通道，让设备知道状态已被更改。</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="23b4" class="mf jq hu mb b fv mg mh l mi mj">console.log("Subscribing"); <br/>pubnub.subscribe({ channels: ['ch2'] });</span></pre><p id="94f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，创建您的监听器来根据云告诉它的状态执行适当的命令。</p><pre class="kt ku kv kw fq ma mb mc md aw me dt"><span id="ace7" class="mf jq hu mb b fv mg mh l mi mj">pubnub.addListener({ <br/>message: function(message){ <br/>     console.log(message.message); <br/>if(message.message == "a"){ <br/>led_1.stop().off(); <br/>led_2.stop().off(); <br/>led_3.stop().off(); <br/>led_1.on(); }</span><span id="4698" class="mf jq hu mb b fv mk mh l mi mj">else if(message.message == "b"){ <br/>led_1.stop().off(); <br/>led_2.stop().off(); <br/>led_3.stop().off(); <br/>led_1.on(); <br/>led_2.on(); }</span><span id="df3f" class="mf jq hu mb b fv mk mh l mi mj">else if(message.message == "c"){ <br/>led_1.stop().off(); <br/>led_2.stop().off(); <br/>led_3.stop().off(); <br/>led_1.on(); <br/>led_2.on(); <br/>led_3.on(); }</span><span id="77ab" class="mf jq hu mb b fv mk mh l mi mj">else if(message.message == "Unlocked!"){<br/>led_1.stop().off(); <br/>led_2.stop().off(); <br/>led_3.stop().off(); <br/>led_1.blink(); <br/>led_2.blink(); <br/>led_3.blink(); }</span><span id="5f51" class="mf jq hu mb b fv mk mh l mi mj">else if(message.message == "off"){ <br/>led_1.stop().off(); <br/>led_2.stop().off(); <br/>led_3.stop().off(); } } });</span></pre><p id="2e2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">完整的代码在下面的GitHub repo中:<a class="ae lv" href="https://github.com/Cakhavan/PubNubStateMachine" rel="noopener ugc nofollow" target="_blank">https://github.com/Cakhavan/PubNubStateMachine</a></p><p id="5661" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！这些都是实现具有PubNub功能的高效云状态机所需的工具！</p></div><div class="ab cl ml mm hc mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hn ho hp hq hr"><p id="bedd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ms">最初发表于</em><a class="ae lv" href="https://www.pubnub.com/blog/cloud-server-state-machine-pubnub-functions/?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY18-Q2-Medium-July-9" rel="noopener ugc nofollow" target="_blank">T5【www.pubnub.com】</a><em class="ms">。</em></p></div></div>    
</body>
</html>