<html>
<head>
<title>Ruby on Rails to Lucky on Crystal: Blazing fast, fewer bugs, and even more fun.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ruby on Rails到Lucky on Crystal:速度极快，错误更少，甚至更有趣。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ruby-on-rails-to-lucky-on-crystal-blazing-fast-fewer-bugs-and-even-more-fun-104010913fec?source=collection_archive---------11-----------------------#2018-07-30">https://medium.com/hackernoon/ruby-on-rails-to-lucky-on-crystal-blazing-fast-fewer-bugs-and-even-more-fun-104010913fec?source=collection_archive---------11-----------------------#2018-07-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/e7bc3095e474eefd227280febf82919c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0XvWVr82mZGab_M2sXtH8g.png"/></div></div></figure><div class=""/><p id="554e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我喜欢Ruby，也喜欢Rails，但我发现自己在寻找更多的东西。一些快速，所以我不需要添加缓存。某种类型安全的东西，这样客户会发现更少的错误。一些有趣的东西，所以我真的<em class="ka">喜欢</em>构建应用程序。</p><p id="c9b1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">仙丹能帮我止痒吗？</strong>这是一个好的开始。写漂亮的代码很有趣，但是我仍然在产品中遇到错误，这些错误<em class="ka">可以用更好的类型系统</em>发现。</p><p id="3d10" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">有榆树</strong>。太美了。好玩。但是只在前端可用。</p><p id="8e71" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我短暂地玩了一下<strong class="je ig"> Go和Rust </strong>，但是我觉得类型系统和语法对我来说太不友好了，我不喜欢使用它们。</p><h1 id="1aca" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">最后，我试了试<a class="ae kz" href="https://crystal-lang.org" rel="noopener ugc nofollow" target="_blank">水晶</a></h1><p id="2ed2" class="pw-post-body-paragraph jc jd if je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">起初，我对克里斯托相当反感。它看起来和Ruby几乎一模一样，所以我为什么要尝试呢？</p><p id="e15e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最终我尝试了，并且爱上了她💙</p><p id="39a3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然水晶看起来和红宝石相似，但水晶是不同的东西。它足够熟悉，可以很快上手，但又足够新，会以有趣的方式挑战你。我喜欢水晶的一些地方:</p><ol class=""><li id="f423" class="lf lg if je b jf jg jj jk jn lh jr li jv lj jz lk ll lm ln dt translated"><strong class="je ig">漂亮的语法</strong>——毫不羞耻地像红宝石一样。有些人可能不喜欢，但我喜欢。</li><li id="f909" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated"><strong class="je ig">在编译时捕捉bug</strong>—光是写这个就让我焦虑:<code class="eh lt lu lv lw b">Undefined method on Nil</code>。我已经看过太多次了。Crystal有助于在编译时捕获这些错误，因此它们永远不会被发现。</li><li id="0708" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated"><strong class="je ig">用宏进行元编程</strong> — Crystal使用宏为你生成代码。再见样板文件。</li><li id="a205" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated">难以置信的快——在许多基准测试中，Crystal击败了Go、Elixir，有时甚至是原始C代码。很快。</li></ol><h1 id="00f4" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">介绍为Crystal编写的web框架<a class="ae kz" href="https://luckyframework.org" rel="noopener ugc nofollow" target="_blank"> Lucky </a></h1><p id="3499" class="pw-post-body-paragraph jc jd if je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">目标是:防止错误，忘记大多数性能问题，将更多的时间花在代码上，而不是调试和编写测试。</p><p id="310a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">总之，<strong class="je ig">让编写令人惊叹的web应用程序变得快速、有趣、简单。</strong></p><h1 id="9855" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">为什么要尝试呢？</h1><ol class=""><li id="47a8" class="lf lg if je b jf la jj lb jn lx jr ly jv lz jz lk ll lm ln dt translated">易于掌握——直观的API和有用的编译时错误有助于使事情变得更简单。<a class="ae kz" href="https://luckyframework.org/guides/installing/" rel="noopener ugc nofollow" target="_blank">向导</a>和我们有用的<a class="ae kz" href="https://gitter.im/luckyframework/Lobby" rel="noopener ugc nofollow" target="_blank">聊天室</a>可以在你遇到困难时提供帮助。</li><li id="8486" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated"><strong class="je ig">包括电池— </strong>不再需要拼凑一百万个库。Lucky包含了大部分app需要的东西。电子邮件、用于处理数据库的<a class="ae kz" href="https://hackernoon.com/tagged/orm" rel="noopener ugc nofollow" target="_blank">或</a> M、模板、为您设置的webpack、自动化浏览器测试、认证和轻松部署。</li><li id="c332" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated"><strong class="je ig">快如闪电</strong> —不再担心性能和您需要多少台服务器。大多数带有大量HTML和多个数据库请求的响应在价格适中的服务器上每秒处理数千个请求。</li><li id="115b" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated"><strong class="je ig">为你捕捉bug</strong>——少花点时间担心测试覆盖率和偷偷摸摸的类型错误。让Crystal编译器帮你解决这个问题。</li><li id="2b3f" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated"><strong class="je ig">灵活的</strong> —构建服务器呈现的HTML，使用SPA的内置webpack配置，或者通过用<code class="eh lt lu lv lw b">--api</code>初始化您的项目来构建JSON API</li><li id="6330" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz lk ll lm ln dt translated"><strong class="je ig">不再有N+1问题</strong> —如果您不小心忘记预加载关联，Lucky会在开发过程中提出，从而防止缓慢的N+1查询。</li></ol><h1 id="a44a" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">要点很无聊，看起来像什么？</h1><h2 id="2f76" class="ma kc if bd kd mb mc md kh me mf mg kl jn mh mi kp jr mj mk kt jv ml mm kx mn dt translated">处理HTTP请求</h2><figure class="mo mp mq mr fq hw"><div class="bz el l di"><div class="ms mt l"/></div></figure><ul class=""><li id="7199" class="lf lg if je b jf jg jj jk jn lh jr li jv lj jz mu ll lm ln dt translated">呼叫<code class="eh lt lu lv lw b">route</code>会自动建立到<code class="eh lt lu lv lw b">”/users”</code>的路线。</li><li id="2635" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">如果您愿意，您可以为非休息路线设置像<code class="eh lt lu lv lw b">get “sign_in”</code>这样的自定义路线。</li><li id="49e1" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">如果你忘记传递页面需要的东西，Lucky会在编译时通知你。</li></ul><h2 id="bc8b" class="ma kc if bd kd mb mc md kh me mf mg kl jn mh mi kp jr mj mk kt jv ml mm kx mn dt translated">建立模型</h2><figure class="mo mp mq mr fq hw"><div class="bz el l di"><div class="ms mt l"/></div></figure><ul class=""><li id="3a49" class="lf lg if je b jf jg jj jk jn lh jr li jv lj jz mu ll lm ln dt translated">设置您想要使用的列及其类型</li><li id="7ec4" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">当列可以是<code class="eh lt lu lv lw b">nil</code>时，可以在类型中添加<code class="eh lt lu lv lw b">?</code>。Crystal会帮助你记住不要在它上面调用无效的方法。</li><li id="a3c2" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">Lucky将为必填字段(<code class="eh lt lu lv lw b">name</code>和<code class="eh lt lu lv lw b">email</code>，因为它们没有被标记为nilable)设置在场验证。</li></ul><h2 id="cb88" class="ma kc if bd kd mb mc md kh me mf mg kl jn mh mi kp jr mj mk kt jv ml mm kx mn dt translated">查询数据库</h2><figure class="mo mp mq mr fq hw"><div class="bz el l di"><div class="ms mt l"/></div></figure><ul class=""><li id="74e6" class="lf lg if je b jf jg jj jk jn lh jr li jv lj jz mu ll lm ln dt translated"><code class="eh lt lu lv lw b">User::BaseQuery</code>是在你定义一个模型时自动生成的。从它继承来定制查询。</li><li id="dd59" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">用实例方法设置命名范围。</li><li id="4af8" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">Lucky为所有的列设置了方法，这样如果你输入了错误的列名，它会在编译时告诉你。</li><li id="5f69" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">在String列上使用<code class="eh lt lu lv lw b">lower</code>方法，确保Postgres对所有内容进行小写排序。Lucky有很多强大的抽象来创建复杂的查询，以及特定类型的方法(比如<code class="eh lt lu lv lw b">lower</code>)。</li></ul><h2 id="9553" class="ma kc if bd kd mb mc md kh me mf mg kl jn mh mi kp jr mj mk kt jv ml mm kx mn dt translated">防止可怕的N+1查询</h2><figure class="mo mp mq mr fq hw"><div class="bz el l di"><div class="ms mt l"/></div></figure><ul class=""><li id="183b" class="lf lg if je b jf jg jj jk jn lh jr li jv lj jz mu ll lm ln dt translated">如果您忘记预加载一个关联，Lucky将在开发和测试环境中引发一个运行时错误。<strong class="je ig">N+1个查询不会意外降低请求速度。</strong></li><li id="c45e" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">在生产中，查询不会引发。这样，如果您不小心做了一个更改，并且没有对它进行测试，它就不会为您的用户抛出错误。相反，您可以稍后修复性能问题。</li><li id="47b1" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">有时你只是想加载一个没有预加载舞蹈的关联，你可以接受轻微的性能冲击。添加<code class="eh lt lu lv lw b">!</code>来加载关联，而不会触发运行时错误。</li></ul><h2 id="554f" class="ma kc if bd kd mb mc md kh me mf mg kl jn mh mi kp jr mj mk kt jv ml mm kx mn dt translated">呈现HTML</h2><figure class="mo mp mq mr fq hw"><div class="bz el l di"><div class="ms mt l"/></div></figure><ul class=""><li id="e9a7" class="lf lg if je b jf jg jj jk jn lh jr li jv lj jz mu ll lm ln dt translated"><code class="eh lt lu lv lw b">needs users : UserQuery</code>告诉编译器它必须被传递给<code class="eh lt lu lv lw b">UserQuery</code>类型的<code class="eh lt lu lv lw b">users</code>。</li><li id="a226" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">如果你忘记传递某个页面需要的东西，它会在编译时通知你。<strong class="je ig">bug更少，调试更快。</strong></li><li id="1da1" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">用水晶方法写标签。标签会自动关闭，空白会被删除。</li><li id="c659" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">很容易提取命名的方法，因为页面是由常规的类和方法组成的。这使得你的HTML页面非常容易阅读。</li><li id="1780" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">轻松链接到其他页面。只需使用行动名称:<code class="eh lt lu lv lw b">Users::New</code>。用<code class="eh lt lu lv lw b">Users::Show.with(user.id)</code>传递参数。<strong class="je ig">不再试图记忆路径助手以及助手是否是复数</strong>。</li><li id="1ba7" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">如果您忘记将一个参数传递给一个路由，Lucky会在编译时通知您。</li><li id="45fb" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">因为我们将<code class="eh lt lu lv lw b">column age : Int32?</code>定义为nilable，所以如果你只是做了<code class="eh lt lu lv lw b">text user.age</code>，Lucky将无法编译页面，因为它不允许打印<code class="eh lt lu lv lw b">nil</code>。因此，我们添加了一个后备方案。<strong class="je ig">不再意外打印HTML中的空文本！</strong></li></ul><h1 id="d40a" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">从幸运开始</h1><p id="ad3c" class="pw-post-body-paragraph jc jd if je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">这里有一些你可以开始的方法</p><ul class=""><li id="1834" class="lf lg if je b jf jg jj jk jn lh jr li jv lj jz mu ll lm ln dt translated">在<a class="ae kz" href="https://github.com/luckyframework/lucky" rel="noopener ugc nofollow" target="_blank">幸运GitHub回购</a>上抛给我们一颗星星😉</li><li id="fec8" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">在推特上关注<a class="ae kz" href="https://twitter.com/luckyframework" rel="noopener ugc nofollow" target="_blank"> @luckyframework </a>。</li><li id="f90a" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">检查<a class="ae kz" href="https://luckyframework.org/guides/installing/" rel="noopener ugc nofollow" target="_blank">导轨</a>并开始使用。</li><li id="c89b" class="lf lg if je b jf lo jj lp jn lq jr lr jv ls jz mu ll lm ln dt translated">在我们的<a class="ae kz" href="https://gitter.im/luckyframework/Lobby" rel="noopener ugc nofollow" target="_blank"> Gitter频道</a>寻求帮助或获得想法。</li></ul><h2 id="db18" class="ma kc if bd kd mb mc md kh me mf mg kl jn mh mi kp jr mj mk kt jv ml mm kx mn dt translated">恐惧</h2><p id="f440" class="pw-post-body-paragraph jc jd if je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">总是有一个陷阱，克里斯托和幸运也是如此。</p><p id="eaf4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Lucky和Crystal都没有升级到1.0，这意味着对于一些新版本，你必须在升级时做出改变。与Ruby和其他更成熟的语言相比，库和教程也更少。</p><p id="27b5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于一些人来说，这是一个有趣的机会，可以从一开始就参与进来，帮助塑造社区，但并不适合所有人。</p><p id="7e9d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你感兴趣，<em class="ka">但还没有准备好飞跃</em>、<a class="ae kz" href="https://twitter.com/luckyframework" rel="noopener ugc nofollow" target="_blank">、<strong class="je ig">在twitter上关注@ lucky framework</strong>、<em class="ka">在</em>、</a><a class="ae kz" href="https://github.com/luckyframework/lucky" rel="noopener ugc nofollow" target="_blank">、<em class="ka"> GitHub </em>、</a>、<em class="ka">上给我们一颗星星。</em></p><figure class="mo mp mq mr fq hw"><div class="bz el l di"><div class="mv mt l"/></div></figure></div></div>    
</body>
</html>