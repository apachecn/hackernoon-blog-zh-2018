<html>
<head>
<title>Monitoring Laravelâ€™s background queues in realtime</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å®æ—¶ç›‘æ§Laravelçš„åå°é˜Ÿåˆ—</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/monitoring-laravels-background-queues-in-realtime-629cf3fac5c5?source=collection_archive---------31-----------------------#2018-07-30">https://medium.com/hackernoon/monitoring-laravels-background-queues-in-realtime-629cf3fac5c5?source=collection_archive---------31-----------------------#2018-07-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="1d99" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">ä½ éœ€è¦åœ¨ä½ çš„æœºå™¨ä¸Šå®‰è£…PHP 7æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ŒLaravel CLIï¼ŒComposerï¼ŒNodeå’Œnpmã€‚ä½ åº”è¯¥å¯¹PHPå’ŒLaravelæœ‰æ‰€äº†è§£ã€‚</p></blockquote><p id="4833" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å½“æ„å»ºå¤§å‹åº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿å…¶å…·æœ‰å¯ä¼¸ç¼©æ€§é€šå¸¸æ˜¯ä¸€ä¸ªå…³æ³¨ç‚¹ã€‚åƒé¡µé¢åŠ è½½éœ€è¦å¤šé•¿æ—¶é—´è¿™æ ·çš„ç»Ÿè®¡æ•°æ®é€šå¸¸éå¸¸é‡è¦ã€‚å› æ­¤ï¼Œåƒå¤„ç†å¤§å‹å›¾åƒã€å‘é€ç”µå­é‚®ä»¶å’ŒçŸ­ä¿¡è¿™æ ·çš„äº‹æƒ…å¯ä»¥æ¨åˆ°åå°é˜Ÿåˆ—ä¸­ï¼Œç¨åå†å¤„ç†ã€‚</p><p id="1c7f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä½†æ˜¯ï¼Œå› ä¸ºé˜Ÿåˆ—åœ¨åå°å·¥ä½œï¼Œæ‰€ä»¥å®ƒä»¬æœ‰æ—¶ä¼šå¤±è´¥ã€‚ç„¶åï¼Œå¯èƒ½æœ‰å¿…è¦èƒ½å¤Ÿç›‘æ§åå°é˜Ÿåˆ—ã€‚</p><p id="35c8" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘å®æ—¶ç›‘æ§Laravelåå°é˜Ÿåˆ—çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†å‡è®¾æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå‘é€ç”µå­é‚®ä»¶çš„åº”ç”¨ç¨‹åºã€‚ç”µå­é‚®ä»¶å°†åœ¨åå°æ’é˜Ÿï¼Œç¨åå‘é€ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªæŠ¥å‘Šé¡µé¢ï¼Œæ˜¾ç¤ºå·²å‘é€å’Œæœªå‘é€çš„ç”µå­é‚®ä»¶ã€‚</p><p id="6133" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™æ˜¯æˆ‘ä»¬å°†è¦æ„å»ºçš„å†…å®¹çš„å±å¹•è®°å½•:</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff jw"><img src="../Images/d9c5fccbf9d5141fe1e5921cf37dee46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O2-C5Jyv7RK3geod.gif"/></div></div></figure><h1 id="8109" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">æ•™ç¨‹è¦æ±‚</h1><p id="e8cf" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">ä¸ºäº†å®Œæˆæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹ä¸œè¥¿:</p><ul class=""><li id="5030" class="ll lm hu ix b iy iz jc jd jt ln ju lo jv lp js lq lr ls lt dt translated">PHP 7.0+å®‰è£…åœ¨ä½ çš„æœºå™¨ä¸Šã€‚</li><li id="464a" class="ll lm hu ix b iy lu jc lv jt lw ju lx jv ly js lq lr ls lt dt translated">å®‰è£…åœ¨æ‚¨æœºå™¨ä¸Šçš„Laravel CLI ã€‚</li><li id="9958" class="ll lm hu ix b iy lu jc lv jt lw ju lx jv ly js lq lr ls lt dt translated"><a class="ae lz" href="https://getcomposer.org/doc/00-intro.md#installation-linux-unix-osx" rel="noopener ugc nofollow" target="_blank"> Composer </a>å®‰è£…åœ¨æ‚¨çš„æœºå™¨ä¸Šã€‚</li><li id="95d7" class="ll lm hu ix b iy lu jc lv jt lw ju lx jv ly js lq lr ls lt dt translated">PHPå’ŒLaravelçš„çŸ¥è¯†ã€‚</li><li id="e99a" class="ll lm hu ix b iy lu jc lv jt lw ju lx jv ly js lq lr ls lt dt translated"><a class="ae lz" href="https://docs.npmjs.com/getting-started/installing-node" rel="noopener ugc nofollow" target="_blank"> Node.jså’ŒNPM </a>å®‰è£…åœ¨ä½ çš„æœºå™¨ä¸Šã€‚</li><li id="fcbb" class="ll lm hu ix b iy lu jc lv jt lw ju lx jv ly js lq lr ls lt dt translated">Vue.jså’ŒJavaScriptçš„åŸºç¡€çŸ¥è¯†ã€‚</li><li id="8328" class="ll lm hu ix b iy lu jc lv jt lw ju lx jv ly js lq lr ls lt dt translated">æ¨é€åº”ç”¨ç¨‹åºã€‚åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ª<a class="ae lz" href="https://pusher.com" rel="noopener ugc nofollow" target="_blank"/>ã€‚</li><li id="c060" class="ll lm hu ix b iy lu jc lv jt lw ju lx jv ly js lq lr ls lt dt translated">ä¸€ä¸ªé‚®ä»¶é™·é˜±å¸æˆ·æ¥æµ‹è¯•å‘é€çš„ç”µå­é‚®ä»¶ã€‚åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ª<a class="ae lz" href="https://mailtrap.io" rel="noopener ugc nofollow" target="_blank"/>ã€‚</li></ul><p id="9591" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸€æ—¦ä½ å‡†å¤‡å¥½äº†è¿™äº›éœ€æ±‚ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p><h1 id="32d5" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">è®¾ç½®æ‚¨çš„Laravelåº”ç”¨ç¨‹åº</h1><p id="b21c" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªLaravelåº”ç”¨ç¨‹åº:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="ec4a" class="mf kj hu mb b fv mg mh l mi mj">$ laravel new app_name</span></pre><h1 id="6235" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">è®¾ç½®æ•°æ®åº“è¿æ¥å’Œè¿ç§»</h1><p id="c518" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è®¾ç½®æ•°æ®åº“ã€‚æ‰“å¼€<code class="eh mk ml mm mb b">.env</code>æ–‡ä»¶å¹¶æ›¿æ¢ä»¥ä¸‹é…ç½®:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="f0ac" class="mf kj hu mb b fv mg mh l mi mj">DB_CONNECTION=mysql<br/>    DB_HOST=127.0.0.1<br/>    DB_PORT=3306<br/>    DB_DATABASE=homestead<br/>    DB_USERNAME=homestead<br/>    DB_PASSWORD=secret</span></pre><p id="4820" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä½¿ç”¨:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="d376" class="mf kj hu mb b fv mg mh l mi mj">DB_CONNECTION=sqlite</span></pre><p id="b7aa" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°†æŠŠSQLiteè®¾ç½®ä¸ºæˆ‘ä»¬çš„é»˜è®¤æ•°æ®åº“è¿æ¥(æ‚¨å¯ä»¥ä½¿ç”¨MySQLæˆ–ä»»ä½•å…¶ä»–æ‚¨æƒ³è¦çš„æ•°æ®åº“è¿æ¥)ã€‚</p><p id="43d0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ç»ˆç«¯<code class="eh mk ml mm mb b">cd</code>åˆ°ä½ çš„é¡¹ç›®çš„æ ¹ç›®å½•ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºSQLiteæ•°æ®åº“æ–‡ä»¶:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="ad02" class="mf kj hu mb b fv mg mh l mi mj">$ touch database/database.sqlite</span></pre><p id="a075" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸Šé¢çš„å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œä¾›SQLiteä½¿ç”¨ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºè¿ç§»:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="72b7" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan make:migration create_queued_emails_table</span></pre><p id="5b71" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€ä¸Šé¢çš„å‘½ä»¤åˆšåˆšåˆ›å»ºçš„è¿ç§»æ–‡ä»¶ï¼Œç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢<code class="eh mk ml mm mb b">up</code>æ–¹æ³•:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="cb2d" class="mf kj hu mb b fv mg mh l mi mj">public function up()<br/>    {<br/>        Schema::create('queued_emails', function (Blueprint $table) {<br/>            $table-&gt;increments('id');<br/>            $table-&gt;string('email');<br/>            $table-&gt;string('description');<br/>            $table-&gt;boolean('run')-&gt;default(false);<br/>            $table-&gt;timestamps();<br/>        });<br/>    }</span></pre><p id="2e99" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿ç§»æˆ‘ä»¬çš„æ•°æ®åº“:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="d641" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan migrate</span></pre><h1 id="bea4" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">ä¸ºç”µå­é‚®ä»¶æµ‹è¯•è®¾ç½®é‚®ä»¶é™·é˜±</h1><p id="0f81" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">æ‰“å¼€æ‚¨çš„<code class="eh mk ml mm mb b">.env</code>æ–‡ä»¶ï¼Œå¹¶è¾“å…¥æ‚¨ä»é‚®ä»¶é™·é˜±ä»ªè¡¨æ¿è·å¾—çš„å¯†é’¥ã€‚ä¸‹é¢åˆ—å‡ºäº†ç›¸å…³çš„é”®:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="f85a" class="mf kj hu mb b fv mg mh l mi mj">MAIL_DRIVER=smtp<br/>    MAIL_HOST=smtp.mailtrap.io<br/>    MAIL_PORT=2525<br/>    MAIL_USERNAME=null<br/>    MAIL_PASSWORD=null<br/>    MAIL_ENCRYPTION=null<br/>    MAIL_FROM="john@doe.com"<br/>    MAIL_NAME="John Doe"</span></pre><p id="df93" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨ï¼Œå½“ç”µå­é‚®ä»¶è¢«å‘é€æ—¶ï¼Œç”µå­é‚®ä»¶å°†åœ¨é‚®ä»¶é™·é˜±æ”¶ä»¶ç®±ä¸­å¯è§ã€‚</p><h1 id="ba1d" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">è®¾ç½®èº«ä»½éªŒè¯</h1><p id="218a" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">æˆ‘ä»¬éœ€è¦åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯è®¾ç½®èº«ä»½éªŒè¯ã€‚æ‰“å¼€æ‚¨çš„ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="2ca2" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan make:auth</span></pre><p id="4175" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°†ç”Ÿæˆä¸€ä¸ªè®¤è¯æ¡†æ¶ã€‚è¿™å°±æ˜¯å…³äºèº«ä»½éªŒè¯æ‚¨éœ€è¦åšçš„å…¨éƒ¨å·¥ä½œã€‚</p><h1 id="0a14" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">é…ç½®æ¨åŠ¨å™¨</h1><p id="c846" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">å°†<code class="eh mk ml mm mb b">.env</code>æ–‡ä»¶ä¸­çš„<code class="eh mk ml mm mb b">PUSHER_*</code>é”®æ›¿æ¢ä¸ºæ‚¨ä»æ¨é’¢æœºä»ªè¡¨æ¿ä¸Šè·å¾—çš„æ­£ç¡®é”®:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="6489" class="mf kj hu mb b fv mg mh l mi mj">PUSHER_APP_ID="PUSHER_APP_ID"<br/>    PUSHER_APP_KEY="PUSHER_APP_KEY"<br/>    PUSHER_APP_SECRET="PUSHER_APP_SECRET"</span></pre><p id="f048" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…Pusher PHP SDK:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="d3bc" class="mf kj hu mb b fv mg mh l mi mj">$ composer require pusher/pusher-php-server "~3.0"</span></pre><p id="dafd" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å®‰è£…å®Œæˆåï¼Œæ‰“å¼€<code class="eh mk ml mm mb b">config/broadcasting.php</code>æ–‡ä»¶å¹¶æ»šåŠ¨åˆ°<code class="eh mk ml mm mb b">pusher</code>éƒ¨åˆ†ã€‚ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢<code class="eh mk ml mm mb b">options</code>é”®:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="7314" class="mf kj hu mb b fv mg mh l mi mj">'options' =&gt; [<br/>        'encrypt' =&gt; true,<br/>        'cluster' =&gt; 'PUSHER_APP_CLUSTER'<br/>    ],</span></pre><h1 id="5262" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">é…ç½®å…¶ä»–æ‚é¡¹</h1><p id="45f7" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">æ‰“å¼€<code class="eh mk ml mm mb b">.env</code>æ–‡ä»¶ï¼Œå°†<code class="eh mk ml mm mb b">BROADCAST_DRIVER</code>æ”¹ä¸º<code class="eh mk ml mm mb b">pusher</code>ï¼Œå°†<code class="eh mk ml mm mb b">QUEUE_DRIVER</code>æ”¹ä¸º<code class="eh mk ml mm mb b">database</code>ã€‚ä¸ºäº†ç¡®ä¿æˆ‘ä»¬æœ‰ä½¿ç”¨<code class="eh mk ml mm mb b">database</code>ä½œä¸ºæˆ‘ä»¬çš„<code class="eh mk ml mm mb b">QUEUE_DRIVER</code>æ‰€å¿…éœ€çš„è¡¨ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ç”Ÿæˆæ•°æ®åº“è¿ç§»:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="e208" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan queue:table</span></pre><p id="07f3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç„¶åè¿è¡Œmigrateå‘½ä»¤æ¥è¿ç§»æ•°æ®åº“:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="02a2" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan migrate</span></pre><p id="2381" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°†åˆ›å»ºå°†æˆ‘ä»¬çš„æ•°æ®åº“ç”¨ä½œé˜Ÿåˆ—é©±åŠ¨ç¨‹åºæ‰€éœ€çš„æ•°æ®åº“è¡¨ã€‚</p><blockquote class="ir is it"><p id="9301" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡</em> <strong class="ix hv"> <em class="hu">åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ€å¥½ä½¿ç”¨Redisæˆ–Memcachedè¿™æ ·çš„å†…å­˜å­˜å‚¨ä½œä¸ºé˜Ÿåˆ—é©±åŠ¨ã€‚å†…å­˜å­˜å‚¨æ¯”ä½¿ç”¨å…³ç³»æ•°æ®åº“æ›´å¿«ï¼Œå› æ­¤æ€§èƒ½æ›´å¥½ã€‚</em> </strong></p></blockquote><h1 id="4a56" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">æ„å»ºæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„åç«¯</h1><p id="0e80" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºåº”ç”¨ç¨‹åºçš„åç«¯ã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="bdd8" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan make:model QueuedEmails</span></pre><p id="e3ed" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°†åœ¨<code class="eh mk ml mm mb b">app</code>ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ¨¡å‹ã€‚æ‰“å¼€æ–‡ä»¶å¹¶ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢å…¶å†…å®¹:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="cd59" class="mf kj hu mb b fv mg mh l mi mj">&lt;?php</span><span id="0b3e" class="mf kj hu mb b fv mn mh l mi mj">    namespace App;</span><span id="5419" class="mf kj hu mb b fv mn mh l mi mj">    use Illuminate\Database\Eloquent\Model;</span><span id="7c25" class="mf kj hu mb b fv mn mh l mi mj">    class QueuedEmails extends Model<br/>    {<br/>        protected $fillable = ['description', 'run', 'email'];<br/>        protected $casts = ['run' =&gt; "boolean"];<br/>    }</span></pre><p id="7221" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ç±»çš„<code class="eh mk ml mm mb b">fillable</code>å±æ€§ã€‚è¿™å°†é˜²æ­¢åœ¨æˆ‘ä»¬å°è¯•å‘æ•°æ®åº“åˆ›å»ºæ–°æ¡ç›®æ—¶å‡ºç°æ‰¹é‡åˆ†é…å¼‚å¸¸é”™è¯¯ã€‚æˆ‘ä»¬è¿˜æŒ‡å®šäº†ä¸€ä¸ª<code class="eh mk ml mm mb b">casts</code>å±æ€§ï¼Œå®ƒå°†æŒ‡ç¤ºconcertiveå°†å±æ€§ç±»å‹åŒ–ä¸ºæ•°æ®ç±»å‹ã€‚</p><p id="e1f0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ¥ä¸‹æ¥ï¼Œæ‰“å¼€<code class="eh mk ml mm mb b">HomeController</code>å¹¶ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢å†…å®¹:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="b7e8" class="mf kj hu mb b fv mg mh l mi mj">&lt;?php<br/>    namespace App\Http\Controllers;</span><span id="2553" class="mf kj hu mb b fv mn mh l mi mj">    use Mail;<br/>    use App\QueuedEmails;<br/>    use App\Mail\SimulateMail;<br/>    use Faker\Factory as Faker;</span><span id="16b8" class="mf kj hu mb b fv mn mh l mi mj">    class HomeController extends Controller<br/>    {<br/>        /**<br/>         * Create a new controller instance.<br/>         *<br/>         * @return void<br/>         */<br/>        public function __construct()<br/>        {<br/>            $this-&gt;middleware('auth');</span><span id="e313" class="mf kj hu mb b fv mn mh l mi mj">            $this-&gt;faker = Faker::create();<br/>        }</span><span id="f317" class="mf kj hu mb b fv mn mh l mi mj">        /**<br/>         * Show the application dashboard.<br/>         *<br/>         * @return \Illuminate\Http\Response<br/>         */<br/>        public function index()<br/>        {<br/>            return view('home', ['jobs' =&gt; $this-&gt;jobs()]);<br/>        }</span><span id="ea7c" class="mf kj hu mb b fv mn mh l mi mj">        /**<br/>         * Return all the jobs.<br/>         *<br/>         * @return array<br/>         */<br/>        public function jobs()<br/>        {<br/>            return QueuedEmails::orderBy('created_at', 'DESC')-&gt;get()-&gt;toArray();<br/>        }</span><span id="99a8" class="mf kj hu mb b fv mn mh l mi mj">        /**<br/>         * Simulate sending the email.<br/>         *<br/>         * @return mixed<br/>         */<br/>        public function simulate()<br/>        {<br/>            $email = $this-&gt;faker-&gt;email;</span><span id="8d93" class="mf kj hu mb b fv mn mh l mi mj">            Mail::to($email)-&gt;send(<br/>                new SimulateMail([<br/>                    "email" =&gt; $email,<br/>                    "description" =&gt; $this-&gt;faker-&gt;sentence()<br/>                ])<br/>            );</span><span id="7633" class="mf kj hu mb b fv mn mh l mi mj">            return redirect()-&gt;route('home');<br/>        }<br/>    }</span></pre><p id="855e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬æœ‰4ä¸ªæ–¹æ³•ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<a class="ae lz" href="https://github.com/fzaninotto/Faker" rel="noopener ugc nofollow" target="_blank"> Fakeråº“</a>ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆéšæœºçš„å‡å€¼ã€‚åœ¨<code class="eh mk ml mm mb b">simulate</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨fakeråº“æ¥ç”Ÿæˆä¸€ä¸ªå‡çš„ç”µå­é‚®ä»¶åœ°å€å’Œæè¿°ã€‚æˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ª<code class="eh mk ml mm mb b">SimulateMail</code>T21ã€‚</p><p id="7e62" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="2d21" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan make:mail SimulateMail</span></pre><p id="68c3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€<code class="eh mk ml mm mb b">SimulateMail</code>ç±»ï¼Œè¾“å…¥ä¸‹é¢çš„ä»£ç :</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="b4b3" class="mf kj hu mb b fv mg mh l mi mj">&lt;?php<br/>    namespace App\Mail;</span><span id="64bd" class="mf kj hu mb b fv mn mh l mi mj">    use App\QueuedEmails;<br/>    use Illuminate\Bus\Queueable;<br/>    use Illuminate\Mail\Mailable;<br/>    use Illuminate\Queue\SerializesModels;<br/>    use App\Events\{EmailQueued, EmailSent};<br/>    use Illuminate\Contracts\Queue\ShouldQueue;<br/>    use Illuminate\Contracts\Queue\Factory as Queue;<br/>    use Illuminate\Contracts\Mail\Mailer as MailerContract;</span><span id="4245" class="mf kj hu mb b fv mn mh l mi mj">    class SimulateMail extends Mailable implements ShouldQueue<br/>    {<br/>        use Queueable, SerializesModels;</span><span id="d363" class="mf kj hu mb b fv mn mh l mi mj">        protected $mail;</span><span id="bc77" class="mf kj hu mb b fv mn mh l mi mj">        /**<br/>         * Create a new message instance.<br/>         *<br/>         * @return void<br/>         */<br/>        public function __construct(array $mail)<br/>        {<br/>            $this-&gt;mail = QueuedEmails::create($mail);<br/>        }</span><span id="e821" class="mf kj hu mb b fv mn mh l mi mj">        /**<br/>         * Build the message.<br/>         *<br/>         * @return $this<br/>         */<br/>        public function build()<br/>        {<br/>            return $this-&gt;subject("Queuer: Welcome to queuer")-&gt;view('email.welcome');<br/>        }</span><span id="15c9" class="mf kj hu mb b fv mn mh l mi mj">        /**<br/>         * Send the mail<br/>         */<br/>        public function send(MailerContract $mailer)<br/>        {<br/>            $this-&gt;mail-&gt;update(['run' =&gt; true]);</span><span id="eee4" class="mf kj hu mb b fv mn mh l mi mj">            event(new EmailSent($this-&gt;mail));</span><span id="130a" class="mf kj hu mb b fv mn mh l mi mj">            parent::send($mailer);<br/>        }</span><span id="456b" class="mf kj hu mb b fv mn mh l mi mj">        /**<br/>         * Queue the email<br/>         */<br/>        public function queue(Queue $queue)<br/>        {<br/>            event(new EmailQueued($this-&gt;mail));</span><span id="cf15" class="mf kj hu mb b fv mn mh l mi mj">            return parent::queue($queue);<br/>        }<br/>    }</span></pre><blockquote class="ir is it"><p id="b9a7" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡</em> <strong class="ix hv"> <em class="hu">é€šè¿‡å®ç°</em> </strong> <code class="eh mk ml mm mb b"><strong class="ix hv"><em class="hu">ShouldQueue</em></strong></code> <strong class="ix hv"> <em class="hu">æ¥å£ï¼Œæˆ‘ä»¬å‘Šè¯‰Laravelï¼Œé‚®ä»¶åº”è¯¥æ’é˜Ÿï¼Œè€Œä¸æ˜¯ç«‹å³å‘é€ã€‚</em> </strong></p></blockquote><p id="7350" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ç±»ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°åœ¨<code class="eh mk ml mm mb b">queued_emails</code>è¡¨ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°æ¡ç›®ã€‚åœ¨<code class="eh mk ml mm mb b">build</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ„å»ºå°†è¦å‘é€çš„é‚®ä»¶æ¶ˆæ¯ã€‚</p><p id="e8ca" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨<code class="eh mk ml mm mb b">send</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†<code class="eh mk ml mm mb b">queued_emails</code>æ¡ç›®çš„<code class="eh mk ml mm mb b">run</code>åˆ—æ ‡è®°ä¸º<code class="eh mk ml mm mb b">true</code>ã€‚æˆ‘ä»¬è¿˜è§¦å‘äº†ä¸€ä¸ªåä¸º<code class="eh mk ml mm mb b">EmailSent</code>çš„äº‹ä»¶ã€‚åœ¨<code class="eh mk ml mm mb b">queue</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¿˜è§¦å‘äº†ä¸€ä¸ªåä¸º<code class="eh mk ml mm mb b">EmailQueued</code>çš„äº‹ä»¶ã€‚</p><p id="f7ad" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è®©æˆ‘ä»¬åˆ›å»ºåœ¨ä¸Šè¿°æ–¹æ³•ä¸­è§¦å‘çš„äº‹ä»¶ã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="172d" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan make:event EmailSent<br/>    $ php artisan make:event EmailQueued</span></pre><p id="2923" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨<code class="eh mk ml mm mb b">EmailSent</code>äº‹ä»¶ç±»ä¸­ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="79a9" class="mf kj hu mb b fv mg mh l mi mj">&lt;?php<br/>    namespace App\Events;</span><span id="ecc3" class="mf kj hu mb b fv mn mh l mi mj">    use App\QueuedEmails;<br/>    use Illuminate\Broadcasting\Channel;<br/>    use Illuminate\Queue\SerializesModels;<br/>    use Illuminate\Foundation\Events\Dispatchable;<br/>    use Illuminate\Broadcasting\InteractsWithSockets;<br/>    use Illuminate\Contracts\Broadcasting\ShouldBroadcast;</span><span id="21ae" class="mf kj hu mb b fv mn mh l mi mj">    class EmailSent implements ShouldBroadcast<br/>    {<br/>        use Dispatchable, InteractsWithSockets, SerializesModels;</span><span id="38d1" class="mf kj hu mb b fv mn mh l mi mj">        public $mail;</span><span id="cb77" class="mf kj hu mb b fv mn mh l mi mj">        public function __construct($mail)<br/>        {<br/>            $this-&gt;mail = $mail;<br/>        }</span><span id="f8a6" class="mf kj hu mb b fv mn mh l mi mj">        public function broadcastOn()<br/>        {<br/>            return new Channel('email-queue');<br/>        }</span><span id="9eab" class="mf kj hu mb b fv mn mh l mi mj">        public function broadcastAs()<br/>        {<br/>            return 'sent';<br/>        }<br/>    }</span></pre><p id="158c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨Laravelä¸­çš„<a class="ae lz" href="https://laravel.com/docs/5.5/broadcasting#defining-broadcast-events" rel="noopener ugc nofollow" target="_blank">å¹¿æ’­</a>å‘Pusherå‘é€ä¸€äº›æ•°æ®ã€‚</p><p id="2e11" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€<code class="eh mk ml mm mb b">EmailQueued</code>äº‹ä»¶ç±»å¹¶ç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="2856" class="mf kj hu mb b fv mg mh l mi mj">&lt;?php</span><span id="072c" class="mf kj hu mb b fv mn mh l mi mj">    namespace App\Events;</span><span id="b422" class="mf kj hu mb b fv mn mh l mi mj">    use App\QueuedEmails;<br/>    use Illuminate\Broadcasting\Channel;<br/>    use Illuminate\Queue\SerializesModels;<br/>    use Illuminate\Foundation\Events\Dispatchable;<br/>    use Illuminate\Broadcasting\InteractsWithSockets;<br/>    use Illuminate\Contracts\Broadcasting\ShouldBroadcast;</span><span id="2c95" class="mf kj hu mb b fv mn mh l mi mj">    class EmailQueued implements ShouldBroadcast<br/>    {<br/>        use Dispatchable, InteractsWithSockets, SerializesModels;</span><span id="0626" class="mf kj hu mb b fv mn mh l mi mj">        public $mail;</span><span id="05a7" class="mf kj hu mb b fv mn mh l mi mj">        public function __construct($mail)<br/>        {<br/>            $this-&gt;mail = $mail;<br/>        }</span><span id="b4ab" class="mf kj hu mb b fv mn mh l mi mj">        public function broadcastOn()<br/>        {<br/>            return new Channel('email-queue');<br/>        }</span><span id="bdab" class="mf kj hu mb b fv mn mh l mi mj">        public function broadcastAs()<br/>        {<br/>            return 'add';<br/>        }<br/>    }</span></pre><p id="f8c3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™ä¸ªç±»å’Œ<code class="eh mk ml mm mb b">EmailSent</code>äº‹ä»¶ç±»å‡ ä¹ä¸€æ ·ã€‚ç•¥å¾®ä¸åŒçš„æ˜¯<code class="eh mk ml mm mb b">broadcastAs</code>æ–¹æ³•ã€‚å®ƒè¿”å›ä¸€ä¸ªä¸åŒçš„åˆ«åæ¥å¹¿æ’­äº‹ä»¶ã€‚</p><p id="92c0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æœ€åï¼Œæ‰“å¼€è·¯ç”±æ–‡ä»¶<code class="eh mk ml mm mb b">routes/web.php</code>å¹¶ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="8dbe" class="mf kj hu mb b fv mg mh l mi mj">Auth::routes();<br/>    Route::name('jobs')-&gt;get('/jobs', 'HomeController@jobs');<br/>    Route::name('simulate')-&gt;get('/simulate', 'HomeController@simulate');<br/>    Route::name('home')-&gt;get('/home', 'HomeController@index');<br/>    Route::view('/', 'welcome');</span></pre><p id="5d56" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å¤ªå¥½äº†ï¼ç°åœ¨è®©æˆ‘ä»¬è½¬åˆ°åº”ç”¨ç¨‹åºçš„å‰ç«¯ã€‚</p><h1 id="aa3f" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">æ„å»ºæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å‰ç«¯</h1><p id="28de" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">æ—¢ç„¶æˆ‘ä»¬å·²ç»è®¾ç½®äº†å¤§éƒ¨åˆ†åç«¯ï¼Œæˆ‘ä»¬å°†åˆ›å»ºåº”ç”¨ç¨‹åºçš„å‰ç«¯ã€‚æ‰“å¼€<code class="eh mk ml mm mb b">resources/views/home.blade.php</code>æ–‡ä»¶ï¼Œå°†ä»£ç æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="49cd" class="mf kj hu mb b fv mg mh l mi mj">@extends('layouts.app')</span><span id="6a75" class="mf kj hu mb b fv mn mh l mi mj">    @section('content')<br/>    &lt;div class="container"&gt;<br/>        &lt;div class="row"&gt;<br/>            &lt;div class="col-md-12"&gt;<br/>                &lt;div class="panel panel-default"&gt;<br/>                    &lt;div class="panel-heading clearfix"&gt;<br/>                        &lt;span class="pull-left"&gt;Queue Reports&lt;/span&gt;<br/>                        &lt;a href="{{ route('simulate') }}" class="btn btn-sm btn-primary pull-right"&gt;Simulate&lt;/a&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;div class="panel-body"&gt;<br/>                        &lt;jobs :jobs='@json($jobs)'&gt;&lt;/jobs&gt;&lt;/jobs&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>    @endsection</span></pre><p id="5eb2" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä¸Šé¢ä»£ç ä¸­å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯<code class="eh mk ml mm mb b">jobs</code>æ ‡ç­¾ã€‚è¿™æ˜¯å¯¹æˆ‘ä»¬æ¥ä¸‹æ¥å°†åˆ›å»ºçš„Vueç»„ä»¶çš„å¼•ç”¨ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªâ€œæ¨¡æ‹Ÿâ€æŒ‰é’®ï¼Œå¯ä»¥å¼•å¯¼åˆ°ä¸€æ¡<code class="eh mk ml mm mb b">/simulate</code>è·¯çº¿ã€‚æ­¤è·¯ç”±æ¨¡æ‹Ÿå¯¹è¦å‘é€çš„ç”µå­é‚®ä»¶è¿›è¡Œæ’é˜Ÿã€‚</p><p id="ea01" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€æ‚¨çš„ç»ˆç«¯ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="112a" class="mf kj hu mb b fv mg mh l mi mj">$ npm install --save laravel-echo pusher-js</span></pre><p id="c505" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°†å®‰è£…<a class="ae lz" href="https://laravel.com/docs/5.5/broadcasting#installing-laravel-echo" rel="noopener ugc nofollow" target="_blank"> Laravel Echo </a>å’Œ<a class="ae lz" href="https://github.com/pusher/pusher-js" rel="noopener ugc nofollow" target="_blank"> Pusher JS SDK </a>ã€‚å®‰è£…å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…å…¶ä»–NPMä¾èµ–é¡¹:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="543d" class="mf kj hu mb b fv mg mh l mi mj">$ npm install</span></pre><h1 id="5fe6" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">æ„å»ºæˆ‘ä»¬çš„Vueç»„ä»¶</h1><p id="2369" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">è®©æˆ‘ä»¬æ„å»ºå‰é¢æåˆ°çš„<code class="eh mk ml mm mb b">jobs</code> Vueç»„ä»¶ã€‚æ‰“å¼€<code class="eh mk ml mm mb b">resources/assets/js/app.js</code>æ–‡ä»¶ï¼Œæ›¿æ¢ä¸‹é¢çš„ä»£ç :</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="c9db" class="mf kj hu mb b fv mg mh l mi mj">Vue.component('example', require('./components/ExampleComponent.vue'));</span></pre><p id="d2a3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ä½¿ç”¨:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="5c32" class="mf kj hu mb b fv mg mh l mi mj">Vue.component('jobs', require('./components/JobsComponent.vue'));</span></pre><p id="3948" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨åœ¨<code class="eh mk ml mm mb b">resources/assets/js/components/</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„<code class="eh mk ml mm mb b">JobsComponent.vue</code>æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶ä¸­ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç :</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="2a1b" class="mf kj hu mb b fv mg mh l mi mj">&lt;template&gt;<br/>        &lt;table class="table"&gt;<br/>            &lt;tbody&gt;<br/>                &lt;tr v-for="(job, index) in allJobs" :key="index" v-bind:class="{success: job.run, danger: !job.run}"&gt;<br/>                    &lt;td width="80%"&gt;{{ job.description }}&lt;/td&gt;<br/>                    &lt;td&gt;{{ job.created_at }}&lt;/td&gt;<br/>                &lt;/tr&gt;<br/>            &lt;/tbody&gt;<br/>        &lt;/table&gt;<br/>    &lt;/template&gt;</span><span id="ba06" class="mf kj hu mb b fv mn mh l mi mj">    &lt;script&gt;<br/>    export default {<br/>        props: ['jobs'],<br/>        data() {<br/>            return {allJobs: this.jobs}<br/>        },<br/>        created() {<br/>            let vm = this<br/>            vm.refreshAllJobs = (e) =&gt; axios.get('/jobs').then((e) =&gt; (vm.allJobs = e.data))<br/>            Echo.channel('email-queue')<br/>                .listen('.add', (e)  =&gt; vm.refreshAllJobs(e))<br/>                .listen('.sent', (e) =&gt; vm.refreshAllJobs(e))<br/>        }<br/>    }<br/>    &lt;/script&gt;</span></pre><p id="ad7f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨ä¸Šé¢çš„Vueç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code class="eh mk ml mm mb b">template</code>ã€‚åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬éå†<code class="eh mk ml mm mb b">jobs</code>æ•°ç»„ï¼Œåˆ—å‡ºæ¯ä¸ªä½œä¸šçš„æè¿°å’Œæ—¶é—´æˆ³ã€‚</p><p id="8472" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åœ¨Vueç»„ä»¶<code class="eh mk ml mm mb b">script</code>çš„<code class="eh mk ml mm mb b">created</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<code class="eh mk ml mm mb b">refreshAllJobs</code>å‡½æ•°ï¼Œå®ƒä½¿ç”¨<a class="ae lz" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>(ä¸€ä¸ªé»˜è®¤å†…ç½®Laravelçš„HTTPè¯·æ±‚åº“)å‘<code class="eh mk ml mm mb b">/jobs</code>è·¯ç”±å‘å‡ºè¯·æ±‚ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å“åº”åˆ†é…ç»™<code class="eh mk ml mm mb b">allJobs</code>å±æ€§ã€‚</p><p id="e9c0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨<a class="ae lz" href="https://laravel.com/docs/5.5/broadcasting#installing-laravel-echo" rel="noopener ugc nofollow" target="_blank"> Laravel Echo </a>ç›‘å¬Pusheré€šé“å¹¶ç­‰å¾…äº‹ä»¶è¢«è§¦å‘ã€‚æ¯å½“äº‹ä»¶<code class="eh mk ml mm mb b">.add</code>å’Œ<code class="eh mk ml mm mb b">.sent</code>è¢«è§¦å‘æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨<code class="eh mk ml mm mb b">refreshAllJobs</code>æ–¹æ³•ã€‚</p><blockquote class="ir is it"><p id="72af" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡</em> <strong class="ix hv"> <em class="hu">äº‹ä»¶åç§°å‰é¢æœ‰ä¸€ä¸ªç‚¹æ˜¯å› ä¸ºï¼Œåœ¨Laravelä¸­ï¼Œæ¯å½“ä½ ä½¿ç”¨</em> </strong> <code class="eh mk ml mm mb b"><strong class="ix hv"><em class="hu">broadcastAs</em></strong></code> <strong class="ix hv"> <em class="hu">æ–¹æ³•å®šä¹‰ä¸€ä¸ªåˆ«åæ—¶ä½ éƒ½éœ€è¦åŠ ä¸Šè¿™ä¸ªç‚¹ã€‚å¦‚æœæ²¡æœ‰ç‚¹ï¼Œä½ çš„äº‹ä»¶å°†ä¸ä¼šè¢«å¬ä¼—æ•æ‰åˆ°ã€‚å¦‚æœä¸æä¾›åˆ«åï¼ŒLaravelå°†ä½¿ç”¨namespace + classä½œä¸ºå¹¿æ’­äº‹ä»¶çš„åç§°ã€‚</em> </strong></p></blockquote><p id="0691" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æ‰“å¼€<code class="eh mk ml mm mb b">resources/assets/js/bootstrap.js</code>æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶åº•éƒ¨ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç :</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="16e4" class="mf kj hu mb b fv mg mh l mi mj">import Echo from 'laravel-echo'</span><span id="a838" class="mf kj hu mb b fv mn mh l mi mj">    window.Pusher = require('pusher-js');</span><span id="a9ad" class="mf kj hu mb b fv mn mh l mi mj">    window.Echo = new Echo({<br/>        broadcaster: 'pusher',<br/>        key: 'PUSHER_APP_KEY',<br/>        encrypt: true,<br/>        cluster: 'PUSHER_APP_CLUSTER'<br/>    });</span></pre><blockquote class="ir is it"><p id="87fd" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> âš ï¸ </em> <strong class="ix hv"> <em class="hu">ç¡®ä¿ç”¨æ‚¨çš„Pusheråº”ç”¨å¯†é’¥å’Œé›†ç¾¤æ›¿æ¢</em> </strong> <code class="eh mk ml mm mb b"><strong class="ix hv"><em class="hu">PUSHER_APP_KEY</em></strong></code> <strong class="ix hv"> <em class="hu">å’Œ</em> </strong> <code class="eh mk ml mm mb b"><strong class="ix hv"><em class="hu">PUSHER_APP_CLUSTER</em></strong></code> <strong class="ix hv"> <em class="hu">ã€‚</em> </strong></p></blockquote><p id="daa9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æœ€åï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ„å»ºæ‚¨çš„èµ„äº§:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="fb51" class="mf kj hu mb b fv mg mh l mi mj">$ npm run dev</span></pre><h1 id="798d" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">æµ‹è¯•æˆ‘ä»¬çš„åº”ç”¨</h1><p id="f224" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">æ„å»ºå®Œæˆåï¼Œå¦‚æœè¿˜æ²¡æœ‰å¯åŠ¨PHPæœåŠ¡å™¨ï¼Œè¯·é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®ƒ:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="87fb" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan serve</span></pre><p id="95c2" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™å°†åˆ›å»ºä¸€ä¸ªPHPæœåŠ¡å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é¢„è§ˆæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ç»ˆç«¯ä¸Šä¼šæä¾›URLï¼Œä½†é»˜è®¤ä¸º<a class="ae lz" href="http://127.0.0.1:8000" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000 </a>ã€‚</p><p id="a74b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">å½“æ‚¨çœ‹åˆ°Laravelä¸»é¡µæ—¶ï¼Œä½¿ç”¨é¡µé¢å³ä¸Šè§’çš„â€œæ³¨å†Œâ€é“¾æ¥åˆ›å»ºä¸€ä¸ªæ–°å¸æˆ·ã€‚ç°åœ¨ï¼Œå•å‡»â€œæ¨¡æ‹Ÿâ€æŒ‰é’®ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªæ–°çš„æ’é˜Ÿç”µå­é‚®ä»¶æ¡ç›®ã€‚</p><p id="b807" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code class="eh mk ml mm mb b">queue:listen</code> artisanå‘½ä»¤æ‰‹åŠ¨æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æµç¨‹ã€‚æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="jx jy jz ka fq ma mb mc md aw me dt"><span id="8383" class="mf kj hu mb b fv mg mh l mi mj">$ php artisan queue:listen</span></pre><p id="dbec" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™åº”è¯¥å¼€å§‹æ‰§è¡Œå®ƒçœ‹åˆ°çš„ä»»ä½•é˜Ÿåˆ—ã€‚åªè¦ç»ˆç«¯æ˜¯æ‰“å¼€çš„å¹¶ä¸”<code class="eh mk ml mm mb b">queue:listen</code>å‘½ä»¤æ­£åœ¨è¿è¡Œï¼Œå½“ä½ ç‚¹å‡»â€œæ¨¡æ‹Ÿâ€æŒ‰é’®æ—¶ï¼Œé˜Ÿåˆ—å°†ç«‹å³è¿è¡Œã€‚å¦‚æœæ‚¨å–æ¶ˆäº†<code class="eh mk ml mm mb b">queue:listen</code>å‘½ä»¤ï¼Œé˜Ÿåˆ—æ¡ç›®å°†ä¿ç•™åœ¨é‚£é‡Œï¼Œä¸ä¼šè¢«è§¦å‘ã€‚</p><blockquote class="ir is it"><p id="e6dd" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">ğŸ’¡</em> <strong class="ix hv"> <em class="hu">åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ‚¨æ— æ³•ä¿æŒ</em> </strong> <code class="eh mk ml mm mb b"><strong class="ix hv"><em class="hu">queue:listen</em></strong></code> <strong class="ix hv"> <em class="hu">è¿è¡Œï¼Œæ‚¨å¯èƒ½éœ€è¦ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åœ¨åå°è¿è¡Œï¼›ç±»ä¼¼</em> </strong> <a class="ae lz" href="http://supervisord.org/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hv"> <em class="hu">çš„ä¸œè¥¿ä¸»ç®¡</em> </strong> </a> <strong class="ix hv"> <em class="hu">ã€‚ä½ å¯ä»¥åœ¨</em> </strong>  <strong class="ix hv"> <em class="hu">è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºä½ å¦‚ä½•åšçš„</em> </strong> <a class="ae lz" href="https://laravel.com/docs/5.5/queues#running-the-queue-worker" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hv"> <em class="hu">ã€‚</em> </strong></a></p></blockquote><h1 id="fc1d" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">ç»“è®º</h1><p id="cb49" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf jt li ji jj ju lj jm jn jv lk jq jr js hn dt translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿä½¿ç”¨Pusherå’ŒVueåˆ›å»ºä¸€ä¸ªå®æ—¶çš„Laravelé˜Ÿåˆ—ç›‘è§†å™¨ã€‚æ‹¥æœ‰å¯ä»¥è·Ÿè¸ªå’Œé‡åŒ–çš„é˜Ÿåˆ—ä¼šå¾ˆæœ‰ç”¨ã€‚å¸Œæœ›ä½ ä»è¿™ç¯‡æ–‡ç« ä¸­æœ‰æ‰€æ”¶è·ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæé—®ã€‚</p><p id="8d31" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">æºä»£ç å¯ä»¥åœ¨<a class="ae lz" href="https://github.com/neoighodaro/monitoring-laravel-queues" rel="noopener ugc nofollow" target="_blank"> GitHub </a>ä¸Šè·å¾—ã€‚</p><p id="05a3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨<a class="ae lz" href="https://pusher.com/tutorials/monitoring-laravel-background-queues" rel="noopener ugc nofollow" target="_blank"> Pusherä¸Šã€‚</a></p></div></div>    
</body>
</html>