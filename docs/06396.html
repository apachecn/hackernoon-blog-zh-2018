<html>
<head>
<title>Object Detection in Google Colab with Custom Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用自定义数据集的Google Colab中的对象检测</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/object-detection-in-google-colab-with-custom-dataset-5a7bb2b0e97e?source=collection_archive---------6-----------------------#2018-08-01">https://medium.com/hackernoon/object-detection-in-google-colab-with-custom-dataset-5a7bb2b0e97e?source=collection_archive---------6-----------------------#2018-08-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="8f42" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本文提出了一个简单免费解决方案，基于自定义数据集，在Google Colab中训练一个用于对象检测的Tensorflow模型。为了演示它是如何工作的，我训练了一个模型来检测照片中我的狗。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/2346daacd5bce5ddc438b8f04cb6adbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/0*7F_cuDcwjF0zJfno"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">Object Detection with my dog</figcaption></figure><p id="9948" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本文中使用的所有代码和数据集都可以在<a class="ae kb" href="https://github.com/RomRoc/objdet_train_tensorflow_colab" rel="noopener ugc nofollow" target="_blank"> my Github repo </a>中获得。</p><p id="f118" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kc">该提案的特点是:</em></p><ul class=""><li id="82b5" class="kd ke hu it b iu iv iy iz jc kf jg kg jk kh jo ki kj kk kl dt translated"><em class="kc">唯一的要求是用LabelImg </em>创建的数据集</li><li id="06a6" class="kd ke hu it b iu km iy kn jc ko jg kp jk kq jo ki kj kk kl dt translated"><em class="kc">一个单独的Google Colab笔记本包含所有的步骤:它从数据集开始，执行模型的训练并显示推理</em></li><li id="43b3" class="kd ke hu it b iu km iy kn jc ko jg kp jk kq jo ki kj kk kl dt translated"><em class="kc">它运行在Google Colab的GPU启用和Google Drive存储中，因此</em> <strong class="it hv"> <em class="kc">它完全基于免费的云资源</em> </strong></li></ul><p id="224d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，Tensorflow的对象检测api最近进行了重要的更改，这使得其他可用的教程变得过时。</p><h1 id="1d19" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">制作数据集</h1><p id="122e" class="pw-post-body-paragraph ir is hu it b iu lp iw ix iy lq ja jb jc lr je jf jg ls ji jj jk lt jm jn jo hn dt translated">Google Colab笔记本中唯一没有包括的步骤是创建数据集的过程。</p><p id="9a72" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用适当数量的照片(我的例子中有50张狗的照片)，我创建了注释。我用的工具是<a class="ae kb" href="https://github.com/tzutalin/labelImg" rel="noopener ugc nofollow" target="_blank"> LabelImg </a>。为了简单起见，我标识了一个对象类，我的狗。可以扩展它以获得在多个对象类上执行对象检测的模型。</p><p id="6b7a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将图像文件重命名为格式<code class="eh lu lv lw lx b">objectclass_id.jpg</code>(即dog_001.jpg，dog_002.jpg)。然后在LabelImg中，我定义了对象所在的边界框，我用Pascal Voc格式保存了注释。</p><p id="0967" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我在我的Google Drive帐户中上传了注释文件，使用了一个具有以下结构的zip文件:</p><pre class="jq jr js jt fq ly lx lz ma aw mb dt"><span id="bb8d" class="mc ks hu lx b fv md me l mf mg">.zip file<br/>|-images directory<br/>  |-image files (filename format: objectclass_id.jpg)<br/>|-annotations directory<br/>  |-xmls directory<br/>    |-annotations files (filename format: objectclass_id.xml)</span></pre><p id="0382" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请查看我在Github中的数据集文件以查看示例。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/76b2eda2407ea7334acd577f1e4ab167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/0*1XmU3NWh9KdO9uUH"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">Dataset example</figcaption></figure><h1 id="2221" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">模特培训</h1><p id="e17f" class="pw-post-body-paragraph ir is hu it b iu lp iw ix iy lq ja jb jc lr je jf jg ls ji jj jk lt jm jn jo hn dt translated">所有后续步骤都包含在Google Colab笔记本中。我按顺序执行单元来训练模型并运行推理:</p><p id="5e75" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">安装所需的包:</strong>在Tensorflow中安装用于对象检测的包、存储库和环境变量，然后运行测试。</p><p id="9c54" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">下载并提取数据集:</strong>将创建的数据集下载到文件系统中。zip文件必须具有上面解释的结构，这一点很重要。</p><p id="e1a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">空png文件:</strong>这是避免create_pet_tf_record.py出错的单元格，在训练过程中没有任何影响。</p><p id="7bdd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">创建TFRecord: </strong>从数据集创建TFRecord。在这个简化版本中，算法将只为一个类训练模型。</p><p id="ce1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">下载预训练模型:</strong>从ModelZoo下载预训练模型，作为迁移学习的初始检查点。在示例中，我们下载了模型faster _ rcnn _ inception _ v2 _ coco，以使用ModelZoo change <code class="eh lu lv lw lx b">MODEL</code> var中的另一个模型。</p><pre class="jq jr js jt fq ly lx lz ma aw mb dt"><span id="f6b2" class="mc ks hu lx b fv md me l mf mg">MODEL = 'faster_rcnn_inception_v2_coco_2018_01_28'<br/>MODEL_FILE = MODEL + '.tar.gz'<br/>DOWNLOAD_BASE = 'http://download.tensorflow.org/models/object_detection/'<br/>DEST_DIR = 'pretrained_model'</span></pre><p id="0913" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">编辑模型配置文件:</strong>设置配置文件的字段，由<code class="eh lu lv lw lx b">PATH_TO_BE_CONFIGURED</code>标识。如果您选择不同的初始检查点模型，请相应地更新单元中的filename var和re.sub函数。</p><p id="537d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Train model: </strong>这是主要步骤，它使用目前创建的数据和配置执行模型的训练。可以更改训练和验证中的步骤数。</p><p id="dbdd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据培训过程得出的张量板图表如下:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/19f06f1909dc3acc6f9763362206338f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*qGb5XNny5G8PrGQ5sejFvw.png"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">Tensorboard charts</figcaption></figure><h1 id="d7b4" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">推理</h1><p id="1b1f" class="pw-post-body-paragraph ir is hu it b iu lp iw ix iy lq ja jb jc lr je jf jg ls ji jj jk lt jm jn jo hn dt translated"><strong class="it hv">导出训练好的模型:</strong>导出模型运行推理。该单元将最后训练的模型转换成运行推理的格式。</p><p id="ec10" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">上传图像进行推理:</strong>浏览器上传测试图像文件，进行下一步推理。</p><p id="c809" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">运行推理:</strong>最后对上传的图像进行推理，显示结果如下。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/077f014922835a1866b2c3cc95706b9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/0*QoWclIHoL5pfCThl"/></div></figure><h1 id="4e53" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">下一个目标</h1><p id="1e46" class="pw-post-body-paragraph ir is hu it b iu lp iw ix iy lq ja jb jc lr je jf jg ls ji jj jk lt jm jn jo hn dt translated">非常感谢你阅读我的文章。在本文中，我们使用Tensorflow框架，通过自定义数据集在Google Colab中轻松训练了一个对象检测模型。如果你喜欢，留下一些掌声，我很乐意写更多关于机器学习的东西。</p><p id="06ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在接下来的文章中，我们将把Google Colab笔记本扩展到:</p><ul class=""><li id="ebc0" class="kd ke hu it b iu iv iy iz jc kf jg kg jk kh jo ki kj kk kl dt translated">包括<strong class="it hv">多类</strong>物体检测</li><li id="d34a" class="kd ke hu it b iu km iy kn jc ko jg kp jk kq jo ki kj kk kl dt translated">在模型训练期间，在不同的浏览器选项卡中查看<strong class="it hv">张量板</strong></li><li id="2538" class="kd ke hu it b iu km iy kn jc ko jg kp jk kq jo ki kj kk kl dt translated">执行<strong class="it hv">实例分割</strong>进行像素分类</li></ul></div></div>    
</body>
</html>