<html>
<head>
<title>Forecasting Market Movements Using Tensorflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Tensorflow预测市场走势</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/forecasting-market-movements-using-tensorflow-fb73e614cd06?source=collection_archive---------2-----------------------#2018-08-07">https://medium.com/hackernoon/forecasting-market-movements-using-tensorflow-fb73e614cd06?source=collection_archive---------2-----------------------#2018-08-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7dac52458d78eda74f3d433592782493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mFmLG1mZYGan9JB5izrWcQ.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/rmWtVQN5RzU?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">jesse orrico</a> on <a class="ae jg" href="https://unsplash.com/search/photos/machine-learning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="71f4" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">多层感知器用于分类</h1><p id="0f5c" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">有没有可能创建一个神经网络<a class="ae jg" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">来从一组标准交易指标中预测每日市场走势？</a></p><p id="babe" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">在本帖中，我们将看到一个使用Tensorflow创建测试和开发框架的简单模型，以及一些初步结果和改进建议。</p><h1 id="365b" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">ML任务和输入功能</h1><p id="8a11" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">为了保持基本设计的简单，它设置了一个二元分类任务，预测第二天的收盘价是高于还是低于当前收盘价，对应于对下一个时间段做多或做空的预测。在现实中，这可以应用于一个机器人，它在交易日开始时计算并执行一组头寸，以捕捉当天的走势。</p><p id="24e3" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">该模型目前使用4个输入特征(再次为简单起见):15 + 50天RSI和14天随机K和d。</p><p id="7b2a" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">之所以选择这些指标，是因为这些指标在0到100之间被归一化，这意味着资产的基础价格与模型无关，从而允许更大程度的泛化。</p><p id="b0e3" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">虽然可以根据任何数量的其他交易指标或其他指标来训练模型，但我建议坚持使用那些通过设计标准化或可以修改为价格或波动标准化的指标。否则，一个单一的模型不太可能对一系列股票有效。</p><h1 id="1aae" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">数据集生成</h1><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff li"><img src="../Images/2f7aa041fb89a191d15706c59d8b4ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_BKQA_hE3ElAsfSy1CrAQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">(Code Snippet of a dataset generation example — full script at end of this post)</figcaption></figure><p id="5b82" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">数据集生成和神经网络脚本被分成两个不同的模块，以便于修改，并且能够仅在必要时重新生成完整的数据集，因为这需要很长时间。</p><p id="cdf4" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">目前，生成器脚本设置有一个标准普尔500股票列表，用于下载2015年以来的每日蜡烛线，并将其处理为所需的交易指标，这些指标将用作模型的输入特征。</p><p id="d468" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">然后，一切都被分割成一组训练数据(2015年1月-2017年6月)和评估数据(2017年6月-2018年6月)，并作为CSV写入脚本运行目录中的“train”和“eval”文件夹。</p><p id="867b" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">然后，ML脚本可以按需读取这些文件来训练和评估模型，而无需重新下载和处理任何更多的数据。</p><h1 id="5c9f" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">模特培训</h1><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ln"><img src="../Images/cbf87bf6a22be1a3e851711f14a2ad2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P9mV5LfL3qfHO3ln58mgOA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">(Code Snippet of model training — full script at end of this post)</figcaption></figure><p id="e1aa" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">在启动时，该脚本将“train”和“eval”文件夹中的所有CSV文件读入数据数组，以便在整个训练过程中使用。对于如此小的数据集，RAM要求将足够低，不会保证额外的复杂性。但是，对于一个大得多的数据集，这将必须更新为一次只读取完整数据的一个样本，每隔几千个训练步骤轮换一次内存中保存的数据。然而，这将以更大的磁盘IO为代价，减慢训练速度。</p><p id="243e" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">神经网络本身也非常小，因为测试表明，对于较大的网络，评估精度往往会迅速偏离。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lo"><img src="../Images/a1ca0e6bae457adc16a4497e3ef23adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4hCWcbMlbEdqsVQefZCiA.png"/></div></div></figure><p id="3d19" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">网络“长输出”和“短输出”被用作二元预测器，最高置信度值被用作下一天的模型预测。</p><p id="4091" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">架构中的“密集”层意味着每个神经元都连接到下一层中所有神经元的输出。这些神经元与“<a class="ae jg" href="https://blog.alpaca.markets/blog/2018/7/20/intro-into-machine-learning-for-finance-part1" rel="noopener ugc nofollow" target="_blank">金融机器学习简介(第一部分)</a>中描述的相同，使用tanh作为激活函数，这是小型神经网络的常见选择。</p><div class="lp lq fm fo lr ls"><a href="https://blog.alpaca.markets/blog/2018/7/20/intro-into-machine-learning-for-finance-part1" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab ej"><div class="lu ab lv cl cj lw"><h2 class="bd hv fv z el lx eo ep ly er et ht dt translated">金融机器学习导论(第一部分)</h2><div class="lz l"><h3 class="bd b fv z el lx eo ep ly er et ek translated">由于神经网络可以用来学习数据集中的复杂模式，它们可以用来自动处理一些复杂的数据。</h3></div><div class="ma l"><p class="bd b gc z el lx eo ep ly er et ek translated">博客.羊驼.市场</p></div></div><div class="mb l"><div class="mc l md me mf mb mg ja ls"/></div></div></a></div><p id="e6d8" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">一些类型的数据和网络可以在不同的激活函数下更好地工作，例如RELU或ELU用于更深的网络。RELU(整流器线性单元)试图解决更深层次架构中的消失梯度问题，而ELU则是这一问题的变体，以使训练更加有效。</p><h1 id="8a8f" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">张量板</h1><p id="5244" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">除了在终端中显示每1000个训练步骤的预测准确性统计数据之外，ML脚本还被设置为记录用于TensorBoard的摘要——使训练过程的图形化更加容易。</p><p id="eae4" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">虽然除了标量摘要之外，我没有包括任何内容，但是可以记录从节点权重直方图到样本图像或来自训练数据的音频的所有内容。</p><p id="796a" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">要将TensorBoard与保存的摘要一起使用，只需将— logdir标志设置为运行ML脚本的目录。然后，打开您选择的浏览器，在搜索栏中输入“localhost:6006”。一切正常，现在您有了一组自动更新的图表。</p><h1 id="45f5" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">培训结果</h1><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mh"><img src="../Images/e06a54b3c187b9c2e4ff68d542706fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPTGSMvXr_W-0sClhwAtJg.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Node layouts: Model 1 (40,30,20,10), Model 2 (80,60,40,20), Model 3 (160,120,80,40)</figcaption></figure><p id="ec71" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">由于示例设计及其输入特性的简单性，结果不像预期的那样好。</p><p id="5c08" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">我们可以看到明显的过度拟合，因为所有测试的损失/误差相对于评估数据集增加，尤其是在较大的网络上。这意味着网络只是学习特定训练样本的模式，而不是一个更一般化的模型。最重要的是，训练的准确率并不是很高——只比完全随机的猜测高几个百分点。</p><h1 id="476d" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">修改和改进的建议</h1><p id="7243" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">示例代码提供了一个很好的模型，可以用来帮助理解一切是如何工作的——但是它更像是一个起始框架，而不是一个预测的工作模型。因此，这里有一些你可能想提出的改进建议和你可以测试的想法</p><p id="208b" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><strong class="kh hv">输入功能</strong></p><p id="499b" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">在当前状态下，数据集仅由4个输入要素生成，并且模型仅查看一个时间点。这严重地限制了你期望它能够学习的东西——你能在孤立的一天里只看几个指标值来交易吗？</p><p id="6eaf" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">首先，修改数据集生成脚本来计算更多的交易指标，并将它们保存到CSV中。TA-lib的函数范围很广，在这里可以找到<a class="ae jg" href="https://mrjbq7.github.io/ta-lib/func.html" rel="noopener ugc nofollow" target="_blank"><strong class="kh hv"/></a>。</p><div class="lp lq fm fo lr ls"><a href="https://mrjbq7.github.io/ta-lib/func.html" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab ej"><div class="lu ab lv cl cj lw"><h2 class="bd hv fv z el lx eo ep ly er et ht dt translated">TA-Lib</h2><div class="lz l"><h3 class="bd b fv z el lx eo ep ly er et ek translated">TA-Lib:TA-Lib的Python包装器(http://ta-lib.org/)。</h3></div><div class="ma l"><p class="bd b gc z el lx eo ep ly er et ek translated">mrjbq7.github.io</p></div></div></div></a></div><p id="908d" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">我建议坚持使用标准化指标，类似于Stoch和RSI，因为这将资产的相对价格从等式中剔除，这样模型就可以在一系列股票中推广，而不是需要为每只股票建立不同的模型。</p><p id="d3b8" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">接下来，您可以修改ML脚本，读取最后10个数据周期作为每个时间步长的输入，而不仅仅是一个。这使得它可以开始学习振荡器随时间推移的更复杂的收敛和发散模式。</p><p id="1cd0" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><strong class="kh hv">网络架构</strong></p><p id="b77c" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">如前所述，由于缺乏数据和示例任务的特征复杂性，网络很小。这将不得不改变，以适应额外的数据被补充的指标。</p><p id="546c" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">最简单的方法是更改节点布局变量，以添加额外的层或每层更多的神经元。除了完全连接之外，您可能还希望试验不同类型的层。卷积层通常用于图像的模式识别任务，因此在金融图表数据上进行测试可能会很有趣。</p><p id="99b2" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated"><strong class="kh hv">数据集标签</strong></p><p id="fd93" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">如果价格差异&gt; =0，则数据集标记为“多头”，否则标记为“空头”。但是，您可能希望将阈值更改为等于数据长度上的中值价格变化，以提供一组更平衡的定型数据。</p><p id="ca1f" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">你甚至可能希望添加第三个类别“中性”,用于价格保持在有限范围内的日子。</p><p id="0e82" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">除此之外，该脚本还能够改变价格上涨或下跌的预测期。所以可以用长期预测来检验。</p><h1 id="69d5" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">结论</h1><p id="5f06" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">随着建议的改进措施的实施，当然有可能对模型进行改进，使其可以作为基于标准规则的策略的补充交易指标。</p><p id="fefd" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">然而，当涉及到这样一个简单的架构和培训任务时，应该降低期望值。<a class="ae jg" href="https://hackernoon.com/tagged/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>真的可以通过更精细的网络结构和预测任务让自己脱颖而出。</p><p id="1529" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">因此，在下一篇文章中，我们将关注监督学习、非监督学习和强化学习，以及如何使用它们来创建时间序列预测器和分析数据中的关系，以帮助优化策略。</p><h1 id="1b79" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">完整脚本</h1><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="984d" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">马修·特威德</p><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="ml mj l"/></div></figure></div><div class="ab cl mm mn hc mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hn ho hp hq hr"><figure class="lj lk ll lm fq iv fe ff paragraph-image"><a href="https://medium.com/automation-generation"><div class="fe ff mt"><img src="../Images/4d7d212ef68dd071daeaae0916d72f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgwdHnaQXAnW0LtrVSpdMA.png"/></div></a></figure><h2 id="0a5c" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">请关注<a class="ae jg" rel="noopener" href="/@alpacahq">羊驼</a>和<a class="ae jg" href="https://medium.com/automation-generation" rel="noopener">自动化世代</a>关于金融市场、算法交易、技术的新帖子。</h2><h2 id="175e" class="mu ji hu bd jj mv mw mx jn my mz na jr kq nb nc jv ku nd ne jz ky nf ng kd nh dt translated">你可以找到我们<a class="ae jg" href="https://twitter.com/AlpacaHQ" rel="noopener ugc nofollow" target="_blank">@羊驼HQ </a>，如果你用twitter的话。</h2><figure class="lj lk ll lm fq iv fe ff paragraph-image"><a href="https://medium.com/automation-generation"><div class="fe ff ni"><img src="../Images/cdfe4e1b3df7ff7b28e2474ff8dfef1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xnDRs1aVpqUjToFRmk5Zw.png"/></div></a></figure><p id="24af" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">如果你是一名黑客，并且可以创造一些在金融市场上工作的很酷的东西，<strong class="kh hv">请查看我们的项目“</strong> <a class="ae jg" href="https://alpaca.markets/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=strategy_list&amp;utm_content=part1" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv">无佣金股票交易API </strong> </a> <strong class="kh hv">”,在那里我们免费提供简单的REST交易API和实时市场数据。</strong></p></div><div class="ab cl mm mn hc mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hn ho hp hq hr"><p id="4073" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">经纪服务由FINRA/SIPC成员Alpaca Securities LLC(<a class="ae jg" href="https://alpaca.markets/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=strategy_list&amp;utm_content=part1" rel="noopener ugc nofollow" target="_blank">Alpaca . markets</a>)提供。羊驼证券有限责任公司是AlpacaDB，Inc .的全资子公司。</p><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="nj mj l"/></div></figure></div></div>    
</body>
</html>