<html>
<head>
<title>Uncovering information hidden in the smart contracts of Gods Unchained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开隐藏在《被解放的上帝》智能合同中的信息</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/uncovering-information-hidden-in-the-smart-contracts-of-gods-unchained-755cc057974a?source=collection_archive---------12-----------------------#2018-08-07">https://medium.com/hackernoon/uncovering-information-hidden-in-the-smart-contracts-of-gods-unchained-755cc057974a?source=collection_archive---------12-----------------------#2018-08-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="169b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">几天前，我发现了一个在线交易卡牌游戏，名为《被解放的神》，由<a class="ae jp" href="https://hackernoon.com/tagged/coinbase" rel="noopener ugc nofollow" target="_blank">比特币基地</a>支持。你可以<a class="ae jp" href="https://godsunchained.com/?refcode=0x070F37D2f866311f7b96b6C9e8B2755498c1eB45" rel="noopener ugc nofollow" target="_blank">在他们的网站</a>上买卡，并用你的卡与其他玩家对战。卡被实现为不可替换的令牌(ERC-721)，所以你可以像稀有比特一样在市场上购买、出售和交易。当我还是个孩子的时候，我就梦想着像这样的在线交易卡牌游戏，它具有实体卡的属性，例如能够购买、出售和交易你的卡，而无需发卡机构支持这些功能，并且其他企业能够在卡牌游戏的基础上自由地建立一些东西，例如举办锦标赛。</p><h2 id="0aca" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">找到极其罕见的神话卡片的几率有多大？</h2><p id="33d3" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">这些卡片有不同的稀有程度:普通、史诗、传奇和神话。神话卡片极其罕见。人们只能从卡片包中抽取两张神话卡片，还有一张名为“亥伯龙”的神话卡片可以通过该公司举办的拍卖获得，最终出价达到令人震惊的146.279 <a class="ae jp" href="https://hackernoon.com/tagged/eth" rel="noopener ugc nofollow" target="_blank"> ETH </a>。</p><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="fe ff kq"><img src="../Images/fabf4294b16da9434f1fa00132160ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M7m0Li37Nbx9PoeguoF78w.png"/></div></div><figcaption class="lc ld fg fe ff le lf bd b be z ek">The Titan of Light: Hyperion</figcaption></figure><p id="c139" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在写这篇文章的时候，两张神话卡都还没有抽中，所以仍然有机会通过购买卡包来赢得这些神话卡。然而，网站上除了有多少张神话卡片尚未被发现之外，没有太多的信息。我想知道找到一张神话卡片的几率有多大，以及这种几率是否因你购买的卡片包的类型而异。如果这是一个传统的在线交易纸牌游戏，我会在这里停下来，但因为它是作为以太坊上的智能合同实现的，你实际上可以读取合同的代码并找到信息。</p><blockquote class="lg lh li"><p id="1dc6" class="ir is lj it b iu iv iw ix iy iz ja jb lk jd je jf ll jh ji jj lm jl jm jn jo hn dt translated"><strong class="it hv">这篇文章的其余部分是我学习神的未被束缚的智能合同实现和发现他们的网站上没有的信息的旅程。</strong></p></blockquote><h2 id="b452" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">购买证明和随机性</h2><p id="eeb2" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">购买稀有卡包首先注意到的是我把ETH发到以下地址:0x 0777 f 76d 195795268388789343068 E4 fcd 286919。我浏览了Etherscan 上的地址，发现是一份名为RarePackFour的合同。我在契约上调用了一个名为“purchase”的函数，将我购买的包数作为参数。</p><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="fe ff ln"><img src="../Images/74231a75a6fae899e253f315fe07221a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Adm4c88euwtd_3KY9EwP3w.png"/></div></div><figcaption class="lc ld fg fe ff le lf bd b be z ek">A call to the purchase function on the RarePackFour contract via Etherscan.</figcaption></figure><p id="db0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以太扫描页面还提供了人类可读的合同代码。我发现“购买”功能的实现:</p><figure class="kr ks kt ku fq kv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="9b62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该函数创建了一个Purchase实例，它只记录购买的用户、包数、当前块数和设置为0的随机性。然后，它发出一个名为“PacksPurchased”的事件。有趣的是，该函数记录了一个购买证明，但实际上并不抽卡……所以我进一步研究了代码，发现了这个名为“回调”的函数:</p><figure class="kr ks kt ku fq kv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="e9cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个函数为给定的购买赋予随机性。在购买时唯一不可预测的随机性来源是包含购买交易的块的块散列。由于智能合约只能访问前面块的blockhash，所以这个回调函数需要在购买交易之后的后续块中调用。</p><p id="fe69" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我监视智能合约的传入交易时，我注意到这个回调是在我购买后不久由其他人调用的。据一位《被解放的众神》的开发者称，他们的后端服务器监听“PacksPurchased”事件，并在事件中用给定的购买ID调用回调函数。值得注意的是，任何人都可以调用回调函数，所以如果他们不调用，你也可以调用它，因此这里不存在信任问题。</p><p id="290c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦分配了随机性，就可以合理地假设你的牌是确定的，所以我回到智能合约，找到了一个名为“predictPacks”的函数，它使用生成的随机性来确定牌的稀有度。因为稀有包保证其中一张牌至少是稀有的，所以该函数使用两种类型的函数来导出稀有度:“_getCommonPlusRarity”和“_getRarePlusRarity”，其中后者用于实现该保证。</p><figure class="kr ks kt ku fq kv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="bd2b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我终于发现，每次抽卡都有1/100万的机会赢得一张神话卡，也就是说，每次购买大约有1/20万的机会。</p><p id="c28e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这两个功能提供了相同的机会赢得一张神话牌，然而，_getRarePlusRarity提供了一个稍微高一点的机会赢得史诗或传奇牌。在这些函数下面，我还发现了一些函数，这些函数似乎可以用来为其他类型的卡包实现类似的保证:</p><figure class="kr ks kt ku fq kv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="6905" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这表明，无论卡包类型如何，你都有相同的机会赢得一张神话卡，所以如果你只想要一张神话卡，购买最便宜的卡包是最划算的。</p><p id="2fe3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我所有的问题都回答了！</p><h2 id="5716" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">但是我的卡片在哪里？</h2><p id="588e" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">但是我意识到一些有趣的事情——这些卡既不是ERC-721代币，也没有转到我的账户上。我所有的是一个购买证明和分配的随机性，可以得到我的卡，但我还不能出售或交易它们。然后我找到了这个名为“claim”的函数，它与predictPacks非常相似，但是它有一个对migration.createCard()的额外调用。迁移协定作为参数传递给了这个稀有包协定的构造函数。我能够使用Etherscan找到迁移合同，并确认它是<a class="ae jp" href="https://etherscan.io/token/0x6ebeaf8e8e946f0716e6533a6f2cefc83f60e8ab" rel="noopener ugc nofollow" target="_blank">ERC-721令牌合同</a>。那么谁调用这个函数呢？我找不到这些信息，所以我去了Discord聊天室:</p><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="fe ff lq"><img src="../Images/60a90717620b2a4c6371ddd0480de01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWgY0PKlIVrcQaxt7jUsEg.png"/></div></div><figcaption class="lc ld fg fe ff le lf bd b be z ek">People in the chat room are very friendly and helpful.</figcaption></figure><p id="8452" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">原来，他们把<strong class="it hv">兑换你的卡</strong>的交易和<strong class="it hv">进行购买</strong>和<strong class="it hv">分配随机性</strong>的交易分开了。这有几个优点:</p><ul class=""><li id="473d" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated">当汽油便宜时，例如当大型ico不发生时，兑换卡。</li><li id="1406" class="lr ls hu it b iu ma iy mb jc mc jg md jk me jo lw lx ly lz dt translated">只兑换你想要的ERC-721代币形式的卡，例如，你可能不想浪费时间去兑换没有交易价值的普通卡，因为玩游戏不需要兑换卡。</li></ul><p id="0ed7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">任何人都可以调用claim函数，所以我用我的购买ID调用了该函数，并验证了我的帐户现在拥有五个ERC-721令牌。原来他们还提供了<a class="ae jp" href="https://godsunchained.com/activate?refcode=0x070F37D2f866311f7b96b6C9e8B2755498c1eB45" rel="noopener ugc nofollow" target="_blank">一个页面，可以让你在他们的网站上调用认领功能</a>。</p><p id="07c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这结束了我探索第一个区块链电子竞技智能合约的第一次经历。我能够做到这一点的事实让我更加确信，区块链通过给予用户更多的权力，改变了公司和用户之间的权力平衡。</p></div><div class="ab cl mf mg hc mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hn ho hp hq hr"><h2 id="ee62" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">奖金</h2><p id="c531" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">我在探索其他包类型的智能合约时，在LegendaryPackFour合约中发现了以下代码。</p><figure class="kr ks kt ku fq kv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="afd7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我发现传奇和闪亮的传奇包不仅保证了至少一张传奇卡，还保证了另一张至少稀有稀有的卡。这在网站上的包装说明中没有记载。</p><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="fe ff mm"><img src="../Images/a19b2b91183220173edfdbac43eb7271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYvY5mfAUhg-VdBRTU6KyQ.png"/></div></div><figcaption class="lc ld fg fe ff le lf bd b be z ek">The Lengendary pack description on the Gods Unchained website.</figcaption></figure><p id="ff6b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">合同中肯定有更多值得探索的地方，所以我鼓励你<a class="ae jp" href="https://godsunchained.com/buy-cards?refcode=0x070F37D2f866311f7b96b6C9e8B2755498c1eB45" rel="noopener ugc nofollow" target="_blank">看看它们</a>。我很想知道你的想法——把你的发现或反馈发到<a class="ae jp" href="https://twitter.com/kn" rel="noopener ugc nofollow" target="_blank"> @kn </a>。</p><p id="fef4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感谢<a class="ae jp" href="https://twitter.com/FatimaSabar" rel="noopener ugc nofollow" target="_blank"> Fatima Sabar </a>对本文的反馈。</p><figure class="kr ks kt ku fq kv"><div class="bz el l di"><div class="mn lp l"/></div></figure></div></div>    
</body>
</html>