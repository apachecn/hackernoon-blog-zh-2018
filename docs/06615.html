<html>
<head>
<title>Historical Log Analysis and SIEM Limitations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">历史日志分析和SIEM限制</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/historical-log-analysis-and-siem-limitations-7f3e30d30a9f?source=collection_archive---------27-----------------------#2018-08-07">https://medium.com/hackernoon/historical-log-analysis-and-siem-limitations-7f3e30d30a9f?source=collection_archive---------27-----------------------#2018-08-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/21fae3b4866afd96cbd44b2d5420e418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_KbNq8Vj4RemJifNQ56LA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">A glimpse of history. Photo by <a class="ae jg" href="https://unsplash.com/photos/knrpCSJ6XlQ?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Sergiu Vălenaș</a> on <a class="ae jg" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d6d9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我最近在SIEMs上浏览Anton Chuvakin的帖子，对一个特殊的要求“将它们分开”变得特别不安:<a class="ae jg" href="https://blogs.gartner.com/anton-chuvakin/2014/07/30/siem-real-time-and-historical-analytics-collide/" rel="noopener ugc nofollow" target="_blank">实时与历史分析</a>。他在2014年关于这个主题的帖子很好地概述了这两者之间的对立(向下滚动到表格！).</p><p id="277c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我的信息安全职业生涯和构建<a class="ae jg" href="https://www.spectx.com" rel="noopener ugc nofollow" target="_blank"> SpectX </a>的时候，我一直在思考这个问题，所以我决定详细阐述这个列表。真正困扰我的是:自2014年以来，尽管数据量一直在大幅增长，但在这些差异方面没有任何改善吗？对SIEMs来说，历史和近期分析的对抗性在技术上有困难吗？我认为是这样的，最好的解释方式就是详细阐述丘瓦金的比较列表中的项目，并添加一些我自己的项目。</p><h2 id="6335" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><strong class="ak"> SIEMs和近实时分析的可扩展性模型</strong></h2><p id="ec7f" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">自诞生以来，SIEM的主要任务一直保持不变:实时<strong class="jj hv">检测已知威胁(尽管在其他功能方面已经有了相当大的发展)。实时性还意味着相对受限的数据范围:您需要实时的输入事件和一定数量的最新数据，以便检测规则/模型能够工作。但是，系统必须能够处理大量的输入源数据。</strong></p><figure class="lg lh li lj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lf"><img src="../Images/83f495e6efe3f929a3441e47d695ae30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iFp_5zILjdFJgbwstdGdIA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Figure1: Analysis scope of near real-time analysis</figcaption></figure><p id="49d0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">从技术角度来看，良好性能的关键是<strong class="jj hv">索引</strong>。计算元数据可以加快搜索速度，并在几秒(或几分钟)内满足性能要求。然而，<em class="lk">范围内的所有</em>数据都必须被索引，以保证及时响应。</p><p id="ebfc" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">索引带来了限制和复杂性成本:</p><ul class=""><li id="d251" class="ll lm hu jj b jk jl jo jp js ln jw lo ka lp ke lq lr ls lt dt translated">在将数据提交给查询之前，必须对数据进行索引，这意味着架构必须在处理和存储方面进行扩展。</li><li id="85e0" class="ll lm hu jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated">指数计算必须处理输入事件的波动(峰值)。</li><li id="40a9" class="ll lm hu jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated">查询处理必须与索引的计算竞争。</li></ul><h2 id="093c" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">为什么SIEMs不是历史分析的最佳选择</h2><p id="eba8" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">历史日志分析(模式发现、威胁追踪、取证调查等)的范围是不同的。单个任务通常涉及<strong class="jj hv">来自几个选定来源</strong>的<strong class="jj hv">更长时间</strong>的数据，远远超出SIEM的可见性。同时，SIEM的数据源集也必须可用于历史分析。</p><figure class="lg lh li lj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lz"><img src="../Images/04cd3b23daaaaf4a16aff8063de47d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sOw2vxp5pLlUR-W4o7DGmQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Figure2: Analysis scope of a historical analysis. Different analysis tasks involve different source data scopes.</figcaption></figure><p id="dd2e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然而，查询性能预期低于接近实时的处理，在几分钟或几十分钟内获得结果是完全可以接受的。此外，单个分析任务中包含的数据量通常与短期分析的SIEM索引数据总量相差不大。需要注意的关键点是，用于历史分析的<strong class="jj hv">可用的</strong>数据总量<strong class="jj hv">要大得多</strong>。</p><p id="c05d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">通过索引来实现这种可伸缩性并不是最佳选择。除了复杂性成本，索引还会占用大量空间，通常与数据本身一样多，有时甚至更多。这对于更能容忍时间的历史分析来说是不合理的。</p><h2 id="cac9" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">可伸缩性的实际限制</h2><p id="44e1" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">当然，以上所有的讨论都只是理论上的。在实践中，根据数据量及其保留期，扩展SIEMs以包括大量数据源是可以实现的。然而，一如既往，还是有局限性的。寻求扩展免费开源解决方案的组织通常只关注实现方面(成本、技术、工作)，而没有估计到维护和边缘情况的影响。一旦他们遇到当前设置的限制，就很难找到具有特定技能的人来挖掘历史数据，因为技术复杂性呈指数增长。网上有很多关于这个话题的讨论，例如这里的<a class="ae jg" href="https://logz.io/blog/the-cost-of-doing-elk-stack-on-your-own/" rel="noopener ugc nofollow" target="_blank"/>、这里的<a class="ae jg" href="https://www.loggly.com/blog/to-elk-or-not-to-elk-that-is-the-question/" rel="noopener ugc nofollow" target="_blank"/>和这里的<a class="ae jg" href="https://www.quora.com/What-issues-can-a-Hadoop-potentially-face-when-scaling-up-the-cluster-from-10-nodes-to-say-2000-nodes" rel="noopener ugc nofollow" target="_blank"/>。很多组织也<a class="ae jg" href="https://blogs.gartner.com/anton-chuvakin/2017/04/11/why-your-security-data-lake-project-will-fail/" rel="noopener ugc nofollow" target="_blank">失败</a>。</p><p id="dcdb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">那些试图扩展弹性搜索系统的人面临着一个特殊的问题:数据膨胀的影响。如果日志事件还不是JSON格式，它们将在弹性ETL过程中被转换成JSON格式。不幸的是，与列表格式或csv格式相比，JSON的开销很大。例如，1 Gb的标准Apache web服务器访问日志在转换为JSON后，大约会占用2,5 Gb的空间。这是一个问题，因为由于扩展的复杂性，它直接转化为存储周期。</p><p id="5112" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">许多商业SIEMs压缩数据用于内部存储。这是一个很好的方法，因为同样1 Gb的Apache访问日志在用gzip压缩后会缩小到200…250 MB。此外，扩展的复杂性得到了更好的记录，并且提供了支持。只要你有足够的资金支付费用。定价是许多商业SIEMs的主要限制因素。</p><h2 id="1eb1" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">对一个像样的历史分析工具有什么期望？</h2><p id="3fad" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">历史分析包含许多实际任务，如取证分析、数据发现、威胁搜寻等。当从日志中识别恶意行为时，这些是建立基本事实的基本方法。<strong class="jj hv">的重点是发现</strong>威胁、模式、迹象等。完成的方式通常是<strong class="jj hv">探索性的</strong>，在不同的路径上分支，产生中间结果。在实践中，这意味着通过多个步骤，结合不同的源数据和其他中间结果。</p><p id="50f1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">所有这些都与SIEM的主要目标<strong class="jj hv">基于已知模式检测威胁大相径庭。</strong>因此，SIEM只提供数据发现所需的最低限度:简单的搜索、过滤、提取字段的基本描述性统计。</p><p id="dd67" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了有效地支持探索过程，分析工具应提供以下关键功能:</p><ul class=""><li id="de3c" class="ll lm hu jj b jk jl jo jp js ln jw lo ka lp ke lq lr ls lt dt translated"><strong class="jj hv">灵活的搜索/分析语言，用于检索和操作数据。</strong>由于分析主题(威胁、模式、恶意行为等)是复杂的过程，因此逐步探索应该以类似于SQL的灵活性和功能为后盾。大多数SIEMs使用图形用户界面、下拉列表和复选框提供的简单搜索是不够的。</li><li id="bf91" class="ll lm hu jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated"><strong class="jj hv">用于分析数据的丰富函数库</strong>:聚合、数学、基本描述统计、字符串操作、基本编码解码、基本加密等。NB！聚合、统计和数学函数必须是大数据可扩展的(即在整个被查询的数据集上提供数学上正确的结果)。</li><li id="a2f5" class="ll lm hu jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated"><strong class="jj hv">提供扩展函数库</strong>的手段(允许用户自定义函数)。没有一个内置的图书馆能满足生活抛给你的每一个案例的需要。一旦出现这种情况，就没有时间等待供应商更新库了。</li><li id="e4f9" class="ll lm hu jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated"><strong class="jj hv">提供使用外部第三方工具的API</strong>。再说一遍，现实生活远比任何一个供应商所能涵盖的要丰富得多。灵活处理数据中的意外情况通常标志着成功和失败。</li></ul></div><div class="ab cl ma mb hc mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hn ho hp hq hr"><p id="520f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">到目前为止，我们已经讨论了可伸缩性和分析过程本质的差异。显然，有许多细节将短期和长期分析区分开来。然而，最关键的争议来自如何处理数据。这就是我要在文章的<a class="ae jg" rel="noopener" href="/p/448c4be041d3/">下一部分</a>讨论的内容。</p></div></div>    
</body>
</html>