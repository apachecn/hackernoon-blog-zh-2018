<html>
<head>
<title>Can SNMP (Still) Be Used to Detect DDoS Attacks?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SNMP(仍然)可以用来检测DDoS攻击吗？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/can-snmp-still-be-used-to-detect-ddos-attacks-32b03aa9df8a?source=collection_archive---------25-----------------------#2018-08-09">https://medium.com/hackernoon/can-snmp-still-be-used-to-detect-ddos-attacks-32b03aa9df8a?source=collection_archive---------25-----------------------#2018-08-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="564d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">SNMP是一种互联网标准协议，用于收集IP网络上被管理设备的信息。SNMP成为许多网络中监控设备和连接的健康和资源利用的重要组件。很长一段时间，SNMP是监控带宽和接口利用率的工具。在这种情况下，它用于检测由组织的互联网连接上的容量DDoS攻击引起的线路饱和事件。SNMP足以作为基于阈值的容量攻击检测的传感器，并允许在<a class="ae jq" href="https://www.radware.com/underattack" rel="noopener ugc nofollow" target="_blank">受到攻击</a>时通过云清理中心自动重定向互联网流量。通过自动化检测流程，可以显著缩短缓解时间，并通过按需云DDoS服务缓解容量攻击。SNMP对设备配置的影响极小，几乎可以与任何网络设备和供应商一起工作。因此，它非常方便，并获得了自动分流部署的普及。</p><p id="8867" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，近年来，<a class="ae jq" href="https://security.radware.com/ddos-knowledge-center/ddospedia/ddos-attack/" rel="noopener ugc nofollow" target="_blank"> DDoS攻击</a>不断发展，攻击者变得更加自动化。典型的持续高容量洪水攻击已经演变成更有效的<a class="ae jq" href="https://blog.radware.com/security/2018/02/42-of-organizations-experienced-burst-attacks/" rel="noopener ugc nofollow" target="_blank">自动攻击活动</a>，由不断变化的攻击媒介的重复短时间、高容量爆发组成。这些<a class="ae jq" href="https://blog.radware.com/security/2018/02/burst-attack-protection/" rel="noopener ugc nofollow" target="_blank">突发攻击</a>，也称为打了就跑的DDoS，由几个非常短的突发组成，持续时间只有几秒钟，间隔随机。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff jr"><img src="../Images/14af38b31068194940a4ae1c5af23022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uw5DcJMjapFUWNqh6d_Ymg.png"/></div></div></figure><h1 id="293a" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">使用SNMP监控带宽利用率</h1><p id="ef6c" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">SNMP协议提供对管理信息库(MIB)中收集的(网络)设备系统计数器的访问。MIB包含一组描述可访问对象的分层组织的对象标识符(OID)。接口计数器在接口MIB (IF-MIB)中被描述为进出的八位字节(字节)数。这些计数器可以是32位(ifInOctets)或64位(ifHCInOctets)，当它们达到最大整数范围时会翻转。对于接口带宽监控，定期收集这些字节计数器，并在一段时间内取平均值。查询接口计数器的典型时间间隔以分钟为单位。</p><p id="671d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了计算T1时刻的入口带宽利用率，从T1时刻的计数器中减去T0时刻的字节数，得出接口在采样周期(T1-T0)内接收的字节数。将这个数字除以以秒为单位的采样周期，并将其归一化为可用带宽或以每秒位数(bps)表示的接口速度，就可以计算出T1的带宽利用率。下面的公式说明了这一点:</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff lg"><img src="../Images/1e193b4ccac7617b5469f8bcf7f6e93d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AKovT_4RcuJv8YRA-s166Q.png"/></div></div></figure><h1 id="cccc" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">规避基于SNMP的阈值检测</h1><p id="23cd" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">利用突发攻击，攻击者找到了规避基于SNMP的检测系统的方法。不是通过限制流量水平或流量，而是通过缩短攻击持续时间。</p><p id="4940" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设一台路由器连接的下行互联网容量为1Gbps。SNMP检测器配置有一分钟的定期采样间隔，当总入口带宽超过900Mbps (90%利用率)时，它将根据阈值检测容量攻击事件。现在考虑一个单个突发，作为更大的突发攻击的一部分，在完全饱和水平(100%利用率)下持续10秒钟。下图说明了这种情况。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff lh"><img src="../Images/21db181c035944b35fffd05329097be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KTNOrx6CC7TfLGOBHDsydw.png"/></div></div></figure><p id="d74e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">蓝色区域对应实际入口带宽利用率，而绿色区域代表SNMP测量的带宽利用率。对于每个轮询间隔，蓝色曲线下的面积和绿线下的面积相等。</p><p id="7aba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从图中可以清楚地看出，攻击突发不会被检测为饱和级别事件。此攻击(1Gbps持续10秒)对SNMP计算带宽的净影响为10秒/60秒* 1Gbps = 167Mbps。很明显，SNMP监控的级别没有接近之前定义的900Mbps阈值。</p><p id="b351" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">缩短SNMP的轮询间隔(更高的采样率)将对检测灵敏度产生积极影响。但是，在系统能够充分检测到10秒的小突发之前，我们需要将轮询周期减少多少呢？</p><p id="c2c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了便于说明，让我们缩短上一个示例的轮询周期，以匹配攻击本身的持续时间，即10秒。从下面的两幅图中，我们可以清楚地看到，如果大部分突发发生在轮询间隔内，我们将检测到饱和级别事件。但是，如果超过10%的攻击发生在轮询周期之外，则在该周期内不会被检测到。您可能会注意到，如果只有10%的攻击在采样周期之外，这意味着90%的攻击将在随后的采样周期内发生，因此我们将在下一次轮询中检测到90%的饱和。如果超过10%,在极端情况下为50%,与轮询周期重叠，如下图所示，将不会检测到攻击。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff li"><img src="../Images/2c9cf82b38d4a00bb7cdf5593009ad27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQ49aZl4qGGtC7b7iveMog.png"/></div></div></figure><p id="8e7c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么，SNMP不遗漏攻击的适当轮询周期是多长呢？</p><h1 id="6c1d" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">将奈奎斯特应用于SNMP采样</h1><p id="da93" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">奈奎斯特采样定理是数字信号处理领域的基础。奈奎斯特采样定理指出:</p><blockquote class="lj"><p id="3b13" class="lk ll hu bd lm ln lo lp lq lr ls jo ek translated"><em class="lt">“如果波形的采样速度是其最高频率分量的两倍，则可以对带宽受限的连续时间信号进行采样，并从其样本中完美地重建信号。”</em></p></blockquote><p id="9a2b" class="pw-post-body-paragraph ir is hu it b iu lu iw ix iy lv ja jb jc lw je jf jg lx ji jj jk ly jm jn jo hn dt translated">或者换句话说:如果你想把模拟信号转换成数字信号，采样周期需要是模拟信号中最高频率分量周期的一半。</p><p id="f351" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，将传入流量曲线(上图中的蓝色区域)视为连续信号，我们希望将其转换为采样表示，这种表示有助于我们检测突发攻击。我们对波的实际形式不感兴趣，仅仅能够确定地检测它的水平。因此，构成波形的高阶频率可以安全地忽略，我们想要检测的波形周期可以视为上升沿和下降沿之间的时间。在这种情况下，我们认为攻击的持续时间是我们想要重建的信号中最高频率成分的周期。鉴于此，SNMP的采样周期应该是最小攻击突发持续时间的一半。换句话说:</p><blockquote class="lj"><p id="f91e" class="lk ll hu bd lm ln lo lp lq lr ls jo ek translated"><em class="lt">使用SNMP可以检测到的最小突发攻击是其轮询周期的两倍。</em></p></blockquote><p id="8b52" class="pw-post-body-paragraph ir is hu it b iu lu iw ix iy lv ja jb jc lw je jf jg lx ji jj jk ly jm jn jo hn dt translated">在上面的例子中，为了100%确定地检测10秒钟的攻击爆发，我们需要提高SNMP的轮询速率，以便每5秒钟收集一个新样本。</p><h1 id="2432" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">走在坏人的前面</h1><p id="b8f0" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">每五秒钟从云中轮询一次可能不是构建攻击检测的方式。即使有，也仅限于检测最小突发不超过10秒的攻击。当突发时间为六秒或更短时，该怎么办？SNMP轮询方法根本无法扩展到突发攻击的检测，我们需要从拉动分析转向基于事件的实时方法。</p><p id="883b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">带有阈值检测的On-box RMON规则生成SNMP陷阱，提供了一种替代方案，而无需引入新的技术或协议。但是，检测和触发SNMP陷阱的可能性取决于您设备的功能。也就是说，大多数网络设备制造商提供的性能管理和流分析远远超过了SNMP的可能性。现在是时候考虑这些替代方案，实现攻击检测的机上或机下自动化，并通过对云服务的API调用触发流量重定向。</p><p id="4842" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">已经过实战测试且随时可用的“自行检测”的现成替代方案是<a class="ae jq" href="https://www.radware.com/solutions/cloud-automation/" rel="noopener ugc nofollow" target="_blank">混合DDoS </a>和基于Netflow的监控。<a class="ae jq" href="https://blog.radware.com/security/2018/04/choosing-the-right-ddos-solution-hybrid-protection/" rel="noopener ugc nofollow" target="_blank">混合DDoS防护</a>涵盖的范围远远不止容量和突发攻击检测，还提供了最高级别的集成和检测可信度，并向云发送实时消息。</p><p id="f01b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">随着攻击者越来越成熟，他们的攻击越来越自动化和复杂，我们需要继续发展我们的解决方案和架构，以保持领先地位。</p><p id="7e3d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">原载于2018年8月9日</em><a class="ae jq" href="https://blog.radware.com/security/2018/08/snmp-ddos-attack-detection/" rel="noopener ugc nofollow" target="_blank"><em class="jp">blog.radware.com</em></a><em class="jp">。</em></p></div></div>    
</body>
</html>