<html>
<head>
<title>Let’s Make Our Bundle Size Even Smaller</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们使我们的包更小</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/lets-make-our-bundle-size-even-smaller-7a5727bb110?source=collection_archive---------20-----------------------#2018-08-10">https://medium.com/hackernoon/lets-make-our-bundle-size-even-smaller-7a5727bb110?source=collection_archive---------20-----------------------#2018-08-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/9c6b553fc91e1d37f39f82104ddd2ec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SpAN7DL4gLUMumCj63WBGA.jpeg"/></div></div></figure></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><p id="a73d" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">如果你曾经在Angular、React、Vue或其他平台上开发过SPA(单页应用程序)，你可能会注意到你为应用程序付出的所有努力都白费了。js文件和一个。css文件。这些文件包含了应用程序的所有依赖项和功能。</p><p id="635e" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">有时候，这些文件可能会变得很大，增加应用程序的加载时间，这是我在工作中偶然发现的。</p><p id="0e8a" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">以Webpack为例，文件是经过“摇树”和丑化后制作的。</p><p id="28dd" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">树抖动是从代码中删除所有不用的函数和变量的过程，这使得我们的应用程序小了很多(基本上我们只使用了一小部分依赖项，而大部分代码甚至没有被调用)。</p><p id="ac58" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">丑化(听起来像是)是把你漂亮的javascript代码变成难看的、完全不可读的缩小代码的过程，为什么我们需要它？因为一个变量把它的名字从“isUserConfirmed”改成“x”会占用更少的内存，所以所有的制表符和空格都被删除了。</p></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><p id="baa0" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">在这个例子中，我使用了React，但是在所有框架中，减小包的大小基本上是一样的。所以我使用了<a class="ae kh" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>，这是一个简单的工具，无需自己配置webpack就可以开始使用react框架。这是我在我的项目上运行<code class="eh ki kj kk kl b">npm run build</code>后得到的结果</p><figure class="kn ko kp kq fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff km"><img src="../Images/c64ac71435fb43040ba158ea17417800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_HyF6dWP0nSZT3bI-5wbg.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">First minified JS file 2.7MB</figcaption></figure><p id="dd78" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">文件看起来很大，所以让我们分析一下，看看是什么占用了这么大的空间。source-map-explorer是一个npm包，它分析捆绑的JS文件并告诉你文件是由什么组成的(依赖项和大小)。</p><pre class="kn ko kp kq fq kv kl kw kx aw ky dt"><span id="7d31" class="kz la hu kl b fv lb lc l ld le">npm install -g source-map-explorer</span><span id="4734" class="kz la hu kl b fv lf lc l ld le">source-map-explorer bundle.min.js bundle.min.js.map</span></pre><p id="5874" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">这是结果:</p><figure class="kn ko kp kq fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lg"><img src="../Images/746451deedef905d947c282c160f0228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qw1sqVsPSBQ9X9Sp1Gfy-w.png"/></div></div></figure><p id="de49" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">正如我之前提到的，节点模块占用了文件的大部分大小，从分析中引起我注意的前两件事是，react-icons和emoji-mart相当大(可能是因为它们使用了大量的媒体资产)。</p><p id="c5ac" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">通过快速搜索代码，我找到了这一行:</p><pre class="kn ko kp kq fq kv kl kw kx aw ky dt"><span id="f323" class="kz la hu kl b fv lb lc l ld le">import { FaUpload } from 'react-icons’;</span></pre><p id="6146" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">React-icons是一个简单的UI模块，用于将通用图标导入到应用程序中。</p><p id="d723" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">在这种特定情况下，这种导入会将所有图标导入到我们的应用程序中，这没有意义，因为我只想使用一个图标，通过快速查找文档，我最终使用了这种导入。</p><pre class="kn ko kp kq fq kv kl kw kx aw ky dt"><span id="89c7" class="kz la hu kl b fv lb lc l ld le">import FaUpload from 'react-icons/lib/fa/upload'</span></pre><p id="681e" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">因为react-icons被分成子文件夹，所以它允许我们只导入所需的代码。还有其他使用相同方法的包的例子，比如“<a class="ae kh" href="https://github.com/lodash/lodash" rel="noopener ugc nofollow" target="_blank"> lodash </a>”，这是最流行的实用函数javascript库之一。</p><figure class="kn ko kp kq fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lh"><img src="../Images/09a06486f9b339bd5fd14e70d3a24954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYOwXrhV8mQJ5IqC50e69A.png"/></div></div></figure><p id="5224" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">这样就成功了，我们的包变小了，一点也不费力。</p><p id="ca6c" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">我们的第二个问题是对表情符号市场的依赖。我不会说太多细节，因为这个例子太具体了，但我设法减少了表情集市包，只是用更小的东西来代替它，以满足我的应用程序的需求。如果您有一个大的软件包，那么在存储库中一定有关于它的讨论，所以值得看一看，甚至为它贡献一个解决方案。</p><figure class="kn ko kp kq fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff li"><img src="../Images/45115c7f3344fde04595889faaa6296c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HptawvjXOPpbxiB35FCsAQ.png"/></div></div></figure><p id="530d" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">现在来说说gzip。gzip是一种用于压缩数据的文件格式。几乎所有浏览器都支持它，这使得在客户端使用<a class="ae kh" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding#Compressing_with_gzip" rel="noopener ugc nofollow" target="_blank">“内容编码”头</a>很容易实现。</p><p id="25ed" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">通过这种方式，客户端获得压缩的数据，并在运行时将其解压缩。我使用了<a class="ae kh" href="https://www.npmjs.com/package/gzip-all" rel="noopener ugc nofollow" target="_blank"> gzip-all </a>包来生成压缩版的javascript &amp; CSS文件。</p><figure class="kn ko kp kq fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lj"><img src="../Images/a9de0089051b50d9c5896f7c4318894b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*97_tU0krOFWJEfBRobuqww.png"/></div></div></figure><p id="4c18" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">我们设法让我们的文件大小非常小，我们现在可以改变文件类型回。js并将其发送到世界各地，减少应用程序加载的时间。</p></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><h1 id="bb1b" class="lk la hu bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg dt translated">结论</h1><p id="693b" class="pw-post-body-paragraph jj jk hu jl b jm mh jo jp jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg hn dt translated">这是一个很好的实践，要记住，最终会有一个用户等待从互联网上加载东西，特别是在低速连接的情况下。</p><p id="e5fd" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">一件重要的事情是跟踪你的依赖，考虑开发你自己的一些东西的实现，而不是依赖你可能不需要的大的包。最后将数据压缩到尽可能小。</p></div></div>    
</body>
</html>