<html>
<head>
<title>Spotlight Search in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS中的聚光灯搜索</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/spotlight-search-in-ios-bc8aefa19a92?source=collection_archive---------22-----------------------#2018-08-14">https://medium.com/hackernoon/spotlight-search-in-ios-bc8aefa19a92?source=collection_archive---------22-----------------------#2018-08-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/fd80b118688afeb9c09cecbb895175aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*HMmdr9Xyd23mNygvG5R7FA.png"/></div></figure><ul class=""><li id="379c" class="iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp dt translated"><strong class="ja hv"> <em class="jq">它为什么有帮助？</em>T3】</strong></li></ul><p id="bbcc" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">通过使用核心spotlight framework APIs索引我们的应用程序内容，我们允许用户通过Spotlight search和Safari搜索和访问我们的应用程序内容。</p><ul class=""><li id="64bc" class="iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp dt translated"><strong class="ja hv"> <em class="jq">概述(苹果):- </em> </strong></li></ul><p id="b7c9" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">通过使您的内容可搜索，您可以帮助用户访问您的应用程序中的活动和项目。核心的Spotlight框架提供API来标记和管理持久的用户数据，如照片、联系人和设备索引中的已购买项目，并允许您创建应用程序的链接。</p><p id="bd13" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">这使得您的应用程序的内容在用户的设备中可被发现、可见且易于访问。在本教程中，我们将完成这个功能，最后你会意识到让用户的生活变得简单是多么容易。</p><p id="c51d" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated"><strong class="ja hv"> <em class="jq">让我们开始吧……</em></strong></p><p id="840e" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">现在，假设我们有一个列表，在选择时，它会显示所选项的一些细节(如下图所示)。我们需要这些项目显示在我们的聚焦结果中。</p><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/aacfa826dec10824fb7b2b08ac631acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/1*mRbuzGu8ZsT5j_Kfi_jnNw.gif"/></div></figure><p id="436e" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">→ <em class="jq">关于App，我们正在创作！</em></p><p id="fd75" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">我们正在创建的演示应用程序包含一个UITableViewController，它嵌入在NavigationController中。它显示了一个汽车列表，上面有它们的品牌名称和形象。在选择列表项(汽车)时，它导航到DetailVC屏幕，在这里我们可以全屏查看该特定汽车项的相同细节。为了这个应用程序的目的，我创建了一个plist文件，将我们的汽车项目加载到datasource模型中，以提供给我们的TableViewController类。请查看项目文件(从本教程底部下载示例项目)。</p><p id="0f25" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">首先，我们让我们的数据在聚光灯下也能被搜索到。因此，当用户使用我们内容的关键字进行搜索时，图像和品牌名称将显示在屏幕上。我们将在后面的讨论中定义这些关键字。</p><p id="0e97" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated"><strong class="ja hv"> L </strong>之后，点击与我们的应用程序相关的搜索项，我们的应用程序将会启动，我们会显示与该特定项目相关的详细信息屏幕。</p><p id="2181" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">→在演示应用程序中，我创建了一个plist文件，其中包含汽车的品牌名称及其图像名称。我将所有图像添加到assets文件夹中，因此我们可以用它们填充我们的tableview。我创建了一个模型对象，汽车，以使其易于工作。该项目还包含一个名为<strong class="ja hv"><em class="jq">asset extractor</em></strong>的类，用于为资产项创建url字符串(查看该类)。</p><p id="e828" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">→完成项目设置，在MainViewController中显示数据，并在选择tableview单元格时显示DetailVC和相关数据后，我们开始spotlight搜索功能的实际部分。</p><p id="18e5" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated"><strong class="ja hv"> <em class="jq">将数据索引到聚光灯框架:</em> </strong></p><ul class=""><li id="729e" class="iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp dt translated">为此，我们要求CoreSpotlight API对我们的数据进行索引，这样就可以在用户执行的搜索中找到它。但无论是我们的应用程序，还是CS API都不能决定这将是什么样的数据。我们的责任是准备数据并以特定的形式提供给API。这意味着，我们希望通过Spotlight搜索的所有数据都必须表示为<strong class="ja hv"> <em class="jq"> CSSearchableItem </em> </strong>对象，然后组合成一个<em class="jq">数组</em>并交给<em class="jq"> CS API </em>进行索引。</li><li id="d050" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">单个<strong class="ja hv"><em class="jq">CSSearchableItem</em></strong>对象包含一组属性，这些属性使iOS对<em class="jq">可搜索项目</em>的细节一清二楚，例如搜索时应该显示哪些数据(例如，品牌名称及其图像)，以及使我们的应用程序中的数据出现在Spotlight搜索中的关键字。</li><li id="555d" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">单个可搜索项目的所有属性都由一个<strong class="ja hv"><em class="jq">CSSearchableItemAttributeSet</em></strong>对象表示，该对象提供了许多用于分配我们需要的<em class="jq">值</em>的属性。</li><li id="4481" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">为聚光灯建立数据索引是最后一个应该做的事情。</li></ul><p id="ed04" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">通常和正常的流程包括以下步骤(包括索引):</p><ol class=""><li id="1182" class="iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl kq jn jo jp dt translated"><strong class="ja hv">为每一个单独的数据设置属性</strong>，例如一个汽车对象(<strong class="ja hv"><em class="jq">CSSearchableItemAttributeSet</em></strong>对象)。</li><li id="b6eb" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl kq jn jo jp dt translated">使用上一步的属性(<strong class="ja hv"><em class="jq">CSSearchableItem</em></strong>对象)，为每条数据初始化一个<strong class="ja hv">可搜索的</strong>项。</li><li id="7e96" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl kq jn jo jp dt translated">将所有可搜索的项目收集到一个<strong class="ja hv">数组</strong>中。</li><li id="ba48" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl kq jn jo jp dt translated"><strong class="ja hv">使用上述数组</strong>索引聚光灯的数据。</li></ol><p id="efea" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">为了完成任务，我们按顺序遵循所有这些步骤。</p><p id="6414" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">为了开始，首先我们需要将两个框架导入到项目文件中。</p><blockquote class="kr ks kt"><p id="3854" class="jr js jq ja b jb jc jt ju jd je jv jw ku jx jy jz kv ka kb kc kw kd ke kf jl hn dt translated"><strong class="ja hv">导入</strong><strong class="ja hv"><em class="hu">core spot light</em></strong></p><p id="4d19" class="jr js jq ja b jb jc jt ju jd je jv jw ku jx jy jz kv ka kb kc kw kd ke kf jl hn dt translated"><strong class="ja hv">导入</strong>导入<strong class="ja hv">导入<em class="hu">导入</em>导入</strong></p></blockquote><p id="3700" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">在这里，我写了一个简短的描述来完成这个功能，还包括了示例项目中的代码片段。我把注释放在这里来解释代码，所以请看看下面的图片来做些什么。</p><p id="4122" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated"><em class="jq">去做！！！</em></p><p id="b19e" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">-&gt;在视图控制器中编写一个方法来设置可搜索内容功能</p><p id="882a" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">—&gt;在这种方法中，</p><ul class=""><li id="3ec8" class="iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp dt translated">定义一个数组来保存单个的<strong class="ja hv"><em class="jq">cssearcabreitem</em></strong>对象</li><li id="e9a1" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">遍历所有数据项，然后</li><li id="ad68" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">用<strong class="ja hv"> <em class="jq">内容类型</em> </strong>初始化<strong class="ja hv"><em class="jq">CSSearchableItemAttributeSet</em></strong></li><li id="210d" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">为循环中的每个<em class="jq">单个项目</em>设置该<strong class="ja hv"><em class="jq">CSSearchableItemAttributeSet</em></strong>对象的属性(如标题、缩略图URL、描述等)</li><li id="102f" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">将<strong class="ja hv">关键字</strong>设置为这个<strong class="ja hv">CSSearchableItemAttributeSet</strong>对象，以从<strong class="ja hv"> spotlight搜索</strong>中识别我们的内容</li><li id="bf71" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">使用<strong class="ja hv">唯一标识符</strong>、<strong class="ja hv">域标识符</strong>和上述<strong class="ja hv">CSSearchableItem attributeset</strong>对象初始化<strong class="ja hv"> CSSearchableItem </strong>对象。这个<strong class="ja hv"> <em class="jq">的唯一标识符</em> </strong>将用于从<strong class="ja hv"> <em class="jq">聚光灯搜索</em> </strong>中捕捉<strong class="ja hv"> <em class="jq">用户选择的项目</em> </strong>。所以<em class="jq">的后缀</em>是一些与你的数据相关的信息<em class="jq">项</em>的末尾，这个<em class="jq">是唯一的标识符</em>。域标识符将用于对可搜索项目进行分组</li><li id="d456" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">将上面定义的<strong class="ja hv"> CSSearchableItem </strong>对象附加到您在该方法前面定义的<strong class="ja hv">数组</strong>中</li><li id="a6f4" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">最后，通过使用<strong class="ja hv">核心Spotlight API，</strong>通过传递从上面获得的数组对象来索引项目。</li><li id="c68b" class="iy iz hu ja b jb kl jd km jf kn jh ko jj kp jl jm jn jo jp dt translated">在viewDidload中调用此方法。</li></ul><p id="3375" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">目前，我们的应用程序的内容可以从spotlight搜索中搜索到，在点击或选择我们应用程序的结果项目后，我们的应用程序将会启动，主视图控制器将会显示。为了让用户更加友好，我们需要显示所选项目的详细屏幕。</p><p id="b7ea" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">这很容易实现。我们需要做的就是实现一个名为，<strong class="ja hv"><em class="jq">restoreUserActivityState(_ activity:NSUserActivity)的方法。</em>T47】</strong></p><p id="0f6b" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">上述函数的参数是一个<strong class="ja hv"><em class="jq">nsurectivity</em></strong>对象。该对象有一个名为<strong class="ja hv"> <em class="jq"> userInfo </em> </strong>的字典属性，该字典包含Spotlight 上<strong class="ja hv">所选可搜索项目的<strong class="ja hv">标识符</strong>。我们将从标识符中提取出数据源数组中项目的索引，并呈现细节视图控制器。仅此而已。</strong></p><p id="d4fc" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">为了获得该活动，我们需要在AppDelegate对象中实现一个函数。即</p><blockquote class="kr ks kt"><p id="0ae6" class="jr js jq ja b jb jc jt ju jd je jv jw ku jx jy jz kv ka kb kc kw kd ke kf jl hn dt translated"><strong class="ja hv"><em class="hu">func application(_ application:ui application，continue user activity:NSUserActivity，restoration handler:@ escaping([Any]？)-&gt;Void)-&gt;Bool {</em></strong></p><p id="92cc" class="jr js jq ja b jb jc jt ju jd je jv jw ku jx jy jz kv ka kb kc kw kd ke kf jl hn dt translated"><strong class="ja hv"> <em class="hu"> } </em> </strong></p></blockquote><p id="5964" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">每当用户从spotlight搜索中选择与我们的应用程序相关的项目时，就会调用这个函数。所以这里我们调用上面的restore方法并传递<strong class="ja hv"><em class="jq">useractivity</em></strong>对象。</p><p id="c91a" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">仅此而已。我们成功地完成了任务。恭喜你！！！</p><p id="7921" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">你可以从<a class="ae kx" href="https://github.com/penumutchuprasad/LKSpotlightSearchTutorial/tree/master/LKSpotlightSearchTutorial" rel="noopener ugc nofollow" target="_blank">这里</a>下载示例项目</p><p id="0af2" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt">— — — — — — — — — *********************** — — — — — — — — —</p><p id="40cf" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">如果你喜欢我的教程请关注我的<strong class="ja hv"> <em class="jq">中</em>、</strong><a class="ae kx" href="https://twitter.com/Leelakrishn4" rel="noopener ugc nofollow" target="_blank"><strong class="ja hv"><em class="jq">Twitter</em></strong></a>&amp;<a class="ae kx" href="https://www.linkedin.com/in/leela-prasad-penumutchu-b44023157/" rel="noopener ugc nofollow" target="_blank"><strong class="ja hv"><em class="jq">linkedIn</em></strong></a><strong class="ja hv"><em class="jq"/></strong>账号</p><p id="cdf9" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">感谢阅读…</p><p id="d05f" class="pw-post-body-paragraph jr js hu ja b jb jc jt ju jd je jv jw jf jx jy jz jh ka kb kc jj kd ke kf jl hn dt translated">****************************!！！再见！！！****************************</p></div></div>    
</body>
</html>