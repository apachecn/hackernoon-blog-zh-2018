<html>
<head>
<title>How to send WhatsApp message using Python and Twilio API?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python和Twilio API发送WhatsApp消息？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-send-whatsapp-message-using-python-and-twilio-api-fc63f62154ca?source=collection_archive---------2-----------------------#2018-08-18">https://medium.com/hackernoon/how-to-send-whatsapp-message-using-python-and-twilio-api-fc63f62154ca?source=collection_archive---------2-----------------------#2018-08-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/a669821ab1849face73d588c75606077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5WU8hjHdLniIvIZNd1bxQ.png"/></div></div></figure><h1 id="51d2" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">WhatsApp的Twilio API</h1><p id="6732" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">WhatsApp的Twilio API现已推出早期测试版，允许开发人员在沙盒环境中构建原型。Twilio使您能够使用共享电话号码立即使用WhatsApp API，而无需等待WhatsApp批准专用号码。要在生产中启用WhatsApp API，您需要在有限可用性程序中请求访问权限。让我们继续使用WhatsApp API发送您的第一条消息。</p><p id="12fa" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">首先，你需要注册一个Twilio帐户或使用现有帐户登录，然后转到<a class="ae ld" href="https://www.twilio.com/console/sms/whatsapp/sandbox/" rel="noopener ugc nofollow" target="_blank"> Twilio whatsapp沙盒控制台</a>，按照屏幕上的说明并选择接收whatsapp消息以启用沙盒。</p><p id="df37" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">Twilio sandbox允许你通过向选择加入的用户发送和接收来自共享Twilio号码的消息来测试WhatsApp。</p><h1 id="a4fd" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">使用Python发送WhatsApp消息</h1><p id="f56b" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">从<a class="ae ld" href="https://www.twilio.com/console" rel="noopener ugc nofollow" target="_blank"> Twilio控制台</a>获取您的账户SID和认证令牌，以认证您的REST API调用。</p><h2 id="7273" class="le jd hu bd je lf lg lh ji li lj lk jm kl ll lm jq kp ln lo ju kt lp lq jy lr dt translated">设置您的python开发环境</h2><p id="fc00" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">虽然有<a class="ae ld" href="https://www.twilio.com/docs/libraries/python" rel="noopener ugc nofollow" target="_blank">官方python sdk </a>可用于twilio，但我在本教程中使用<a class="ae ld" href="http://docs.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">请求</a>库，因为我喜欢它。</p><h2 id="1457" class="le jd hu bd je lf lg lh ji li lj lk jm kl ll lm jq kp ln lo ju kt lp lq jy lr dt translated">使用WhatsApp消息模板发送消息/通知</h2><p id="2e18" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">要使用WhatsApp发送出站消息，您必须仅使用预先批准的模板，并且您可以在Twilio号码上启用WhatsApp时创建自定义模板。</p><p id="1433" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">目前，有3个预先批准的模板可用。</p><ol class=""><li id="1d48" class="ls lt hu kc b kd ky kh kz kl lu kp lv kt lw kx lx ly lz ma dt translated">约会提醒模板</li><li id="d586" class="ls lt hu kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma dt translated">订单通知模板</li><li id="ae20" class="ls lt hu kc b kd mb kh mc kl md kp me kt mf kx lx ly lz ma dt translated">验证码模板</li></ol><h2 id="dcbf" class="le jd hu bd je lf lg lh ji li lj lk jm kl ll lm jq kp ln lo ju kt lp lq jy lr dt translated">发送约会提醒</h2><p id="dfc4" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">约会提醒模板对于发送约会提醒很有用。这个模板如下图所示，</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="0778" class="le jd hu ml b fv mp mq l mr ms">Your appointment is coming up on {{August 20th}} at {{6:00PM}}</span></pre><h2 id="12ac" class="le jd hu bd je lf lg lh ji li lj lk jm kl ll lm jq kp ln lo ju kt lp lq jy lr dt translated">密码</h2><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="fa5b" class="le jd hu ml b fv mp mq l mr ms">import requests</span><span id="827c" class="le jd hu ml b fv mt mq l mr ms">TWILIO_SID = “ACXXXXXXXXXXXXXX”<br/>TWILIO_AUTHTOKEN = “62f1efa7e0e9471cfdbfXXXXXXXXX”<br/>TWILIO_MESSAGE_ENDPOINT = “<a class="ae ld" href="https://api.twilio.com/2010-04-01/Accounts/{TWILIO_SID}/Messages.json" rel="noopener ugc nofollow" target="_blank">https://api.twilio.com/2010-04-01/Accounts/{TWILIO_SID}/Messages.json</a>".format(TWILIO_SID=TWILIO_SID)</span><span id="551d" class="le jd hu ml b fv mt mq l mr ms">TWILIO_NUMBER = “whatsapp:+14155238886”</span><span id="5db6" class="le jd hu ml b fv mt mq l mr ms">def send_whatsapp_message(to, message):</span><span id="9dd4" class="le jd hu ml b fv mt mq l mr ms">    message_data = {<br/>        "To": to,<br/>        "From": TWILIO_NUMBER,<br/>        "Body": message,<br/>    }<br/>    response = requests.post(TWILIO_MESSAGE_ENDPOINT, data=message_data, auth=(TWILIO_SID, TWILIO_AUTHTOKEN))<br/>    <br/>    response_json = response.json()<br/>    <br/>    <br/>    return response_json</span><span id="6d57" class="le jd hu ml b fv mt mq l mr ms">to_number = “whatsapp:+919566XXXXXX” <br/>appointment_msg = “””Your appointment is coming up on August 20th at 6:00PM”””</span><span id="367d" class="le jd hu ml b fv mt mq l mr ms">msg = send_whatsapp_message(to_number, appointment_msg)</span><span id="f758" class="le jd hu ml b fv mt mq l mr ms">print(msg[‘sid’]) # SM5xxxafa561e34b1e84c9d22351ae08a0<br/>print(msg[‘status’]) # queued</span></pre><h2 id="c3ca" class="le jd hu bd je lf lg lh ji li lj lk jm kl ll lm jq kp ln lo ju kt lp lq jy lr dt translated">发送订单通知</h2><p id="6de3" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">订单通知模板对于发送订单详细信息非常有用。这个模板如下图所示，</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="da50" class="le jd hu ml b fv mp mq l mr ms">Your Yummy Cupcakes Company order of {{1 dozen frosted cupcakes}} <br/>has shipped and should be delivered on {{July 10, 2019}}. <br/>Details : <a class="ae ld" href="http://www.yummycupcakes.com/" rel="noopener ugc nofollow" target="_blank">http://www.yummycupcakes.com/</a></span></pre><h2 id="c42b" class="le jd hu bd je lf lg lh ji li lj lk jm kl ll lm jq kp ln lo ju kt lp lq jy lr dt translated">密码</h2><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="caa1" class="le jd hu ml b fv mp mq l mr ms">to_number = "whatsapp:+919566XXXXXX"  </span><span id="bf19" class="le jd hu ml b fv mt mq l mr ms">order_notif_msg = """Your Yummy Cupcakes Company order of 1 dozen frosted cupcakes has shipped and should be delivered on July 10, 2019. Details : <a class="ae ld" href="http://www.yummycupcakes.com/" rel="noopener ugc nofollow" target="_blank">http://www.yummycupcakes.com/</a>"""</span><span id="093f" class="le jd hu ml b fv mt mq l mr ms">msg = send_whatsapp_message(to_number, order_notif_msg)<br/>print(msg['sid'])</span></pre><h2 id="b12f" class="le jd hu bd je lf lg lh ji li lj lk jm kl ll lm jq kp ln lo ju kt lp lq jy lr dt translated">验证码</h2><p id="164a" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">验证码模板适用于发送一次性密码和手机号码验证码。这个模板如下图所示，</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="fe8c" class="le jd hu ml b fv mp mq l mr ms">Your Twilio code is {{1238432}}</span></pre><h2 id="4f91" class="le jd hu bd je lf lg lh ji li lj lk jm kl ll lm jq kp ln lo ju kt lp lq jy lr dt translated">密码</h2><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="7b2d" class="le jd hu ml b fv mp mq l mr ms">to_number = "whatsapp:+919566XXXXXX"  <br/>otp_msg = """Your Twilio code is 1238432"""</span><span id="6ec5" class="le jd hu ml b fv mt mq l mr ms">msg = send_whatsapp_message(to_number, otp_msg)<br/>print(msg['sid'])</span></pre><h1 id="7331" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">WhatsApp消息的Webhooks</h1><p id="4f6e" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">您可以设置webhooks来接收WhatsApp的入站消息，从而构建一个名为聊天机器人的对话代理体验。</p><p id="3690" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">您可以为两个事件配置webhooks。一个是当你的twilio whatsapp号码收到新消息时发送的，另一个是检查使用Twilio API发送的消息的交付状态更新。更多信息:<a class="ae ld" href="https://www.twilio.com/docs/sms/whatsapp/api" rel="noopener ugc nofollow" target="_blank">https://www.twilio.com/docs/sms/whatsapp/api</a></p><blockquote class="mu mv mw"><p id="ff23" class="ka kb mx kc b kd ky kf kg kh kz kj kk my la kn ko mz lb kr ks na lc kv kw kx hn dt translated"><em class="hu">原贴于</em><a class="ae ld" href="https://www.idiotinside.com/2018/08/17/send-message-whatsapp-api-python-twilio/" rel="noopener ugc nofollow" target="_blank"><em class="hu">【idiotinside.com】</em></a></p></blockquote></div></div>    
</body>
</html>