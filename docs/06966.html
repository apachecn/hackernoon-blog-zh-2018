<html>
<head>
<title>How To Use the New React Context API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用新的React上下文API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-do-i-use-react-context-3eeb879169a2?source=collection_archive---------0-----------------------#2018-08-19">https://medium.com/hackernoon/how-do-i-use-react-context-3eeb879169a2?source=collection_archive---------0-----------------------#2018-08-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/607d5da03ff3a2bca008a05b1d774854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h8d-4wYLN9wwiEsLAA_5yg.jpeg"/></div></div></figure><p id="892c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">谣言满天飞！<a class="ae ka" href="https://hackernoon.com/tagged/could" rel="noopener ugc nofollow" target="_blank"/>语境能代替redux吗？是不是让道具钻灭绝了？就算语境！==世界和平，<a class="ae ka" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank"> React </a>团队引入了一个奇妙的工具来简化前端开发人员日常处理的最困难的问题之一:状态管理。</p><p id="a1e7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在过去的六个月里，有很多关于新的<a class="ae ka" href="https://reactjs.org/docs/context.html#when-to-use-context" rel="noopener ugc nofollow" target="_blank">背景</a>的炒作。在这篇文章的最后，你会知道它是什么，是否以及何时应该使用它，以及如何在你的应用中实现它。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kb"><img src="../Images/4d1b135cbd00cc6cfcdf909dd6afd6b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-d1NfZ_yygD2uYZPahHePA.jpeg"/></div></div><figcaption class="kg kh fg fe ff ki kj bd b be z ek">Redux? Is that you?</figcaption></figure><h1 id="bd08" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">什么是语境？</h1><p id="f713" class="pw-post-body-paragraph jc jd hu je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">把React想象成一个工具箱。在React 15中，开发人员只能使用适当的钻探来管理他们的应用程序的状态。(如果你还不知道道具钻探，去读这篇<a class="ae ka" rel="noopener" href="/@MCapoz/passing-data-in-react-with-prop-drilling-904aeb3cb5e">帖子</a>。我等)。</p><p id="eccb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">开发人员开始使用其他工具箱，如<a class="ae ka" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> redux </a>和<a class="ae ka" href="https://github.com/mobxjs/mobx" rel="noopener ugc nofollow" target="_blank"> MobX </a>来帮助更复杂的状态管理。它们提供了管理状态的替代解决方案，但是它们引入了复杂性，增加了包的大小，并且除了React之外还需要学习另一个库。</p><p id="0bbc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">像所有的抽象一样，这些工具带来了权衡，对于大型应用程序来说这是值得的，但是对于中小型应用程序来说似乎是多余的。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ln"><img src="../Images/92707b4c8424be90417c39ce68d48f43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9UFRhNej2T9RXt0n9UeRgA.jpeg"/></div></div><figcaption class="kg kh fg fe ff ki kj bd b be z ek">‘Sup. It’s me, Context.</figcaption></figure><h1 id="acf7" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">什么时候应该使用上下文？</h1><p id="7b55" class="pw-post-body-paragraph jc jd hu je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">我建议，当你发现自己在组件树中向下传递三层或更多层时，去寻找上下文。您可能会注意到，您已经重命名了您的道具，这使得确定数据的来源变得很困难。如果你的组件知道不相关的数据，你可以考虑实现上下文。</p><blockquote class="lo"><p id="937d" class="lp lq hu bd lr ls lt lu lv lw lx jz ek translated">经验法则:如果你开始对确定数据来源所花费的时间感到恼火，那么引入上下文。</p></blockquote><p id="17b6" class="pw-post-body-paragraph jc jd hu je b jf ly jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv mc jx jy jz hn dt translated">不要犹豫，仍然使用其他工具，如道具钻井和redux。虽然上下文可以在某些场景中更容易地传递道具，但它不能让您获得redux提供的一些好处，并且它是比道具训练更复杂的抽象。</p><p id="c9e0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">(如果你对redux提供的更多好处感兴趣，可以看看丹·阿布拉莫夫的<a class="ae ka" rel="noopener" href="/@dan_abramov/you-might-not-need-redux-be46360cf367">你可能不需要Redux </a>)。</p><h1 id="fab5" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">我如何使用上下文？</h1><p id="f5ea" class="pw-post-body-paragraph jc jd hu je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">现在你知道什么是上下文，以及什么时候使用它！我相信您已经迫不及待地想知道如何在您的应用程序中实现它了。我创建了一个示例来展示随着应用程序的增长，如何用上下文来代替适当的钻探。</p><p id="2ce9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你喜欢交互性，我已经创建了一个<a class="ae ka" href="https://codesandbox.io/s/04l03y3q9v" rel="noopener ugc nofollow" target="_blank">代码沙箱</a>供你探索！我还将一步一步地向您介绍我的示例。</p><h2 id="6f4f" class="md kl hu bd km me mf mg kq mh mi mj ku jn mk ml ky jr mm mn lc jv mo mp lg mq dt translated">支柱钻井</h2><p id="2767" class="pw-post-body-paragraph jc jd hu je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">我构建了一个应用程序，将一个家族的姓氏存储在一个<code class="eh mr ms mt mu b">&lt;Grandmother /&gt;</code>组件中。然后，<code class="eh mr ms mt mu b">&lt;Child /&gt;</code>组件显示姓氏。</p><p id="2bb5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个应用程序的华丽结果如下所示:</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/1c54ad1305f39a9a11c6ec5c699add5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3JhbXbI90SNG3SsJfTgUuw.png"/></div></div><figcaption class="kg kh fg fe ff ki kj bd b be z ek">#stunning</figcaption></figure><p id="8788" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们使用道具钻取将<code class="eh mr ms mt mu b">lastName</code>道具从<code class="eh mr ms mt mu b">&lt;Grandmother /&gt;</code>组件通过<code class="eh mr ms mt mu b">&lt;Mother /&gt;</code>组件传递到<code class="eh mr ms mt mu b">&lt;Child /&gt;</code>组件，后者显示姓氏。</p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="mw mx l"/></div></figure><h2 id="a88a" class="md kl hu bd km me mf mg kq mh mi mj ku jn mk ml ky jr mm mn lc jv mo mp lg mq dt translated">语境</h2><p id="49ba" class="pw-post-body-paragraph jc jd hu je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">我们可以重构这个例子来使用上下文。使用上下文意味着我们不需要通过<code class="eh mr ms mt mu b">&lt;Mother /&gt;</code>组件传递<code class="eh mr ms mt mu b">lastName</code>。我们避开不需要知道<code class="eh mr ms mt mu b">lastName</code>属性的组件，只与需要知道的组件共享该状态。</p><p id="fc6e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，我们需要创建我们的环境。</p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="mw mx l"/></div></figure><p id="562c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们使用<code class="eh mr ms mt mu b">createContext()</code>并传递一个空对象作为默认值:</p><pre class="kc kd ke kf fq my mu mz na aw nb dt"><span id="770f" class="md kl hu mu b fv nc nd l ne nf">const FamilyContext = React.createContext({});</span></pre><p id="e5af" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我们创建一个<code class="eh mr ms mt mu b">Provider</code>和一个<code class="eh mr ms mt mu b">Consumer</code>组件，并导出它们，以便应用程序中的其他组件可以使用它们。</p><pre class="kc kd ke kf fq my mu mz na aw nb dt"><span id="1a1a" class="md kl hu mu b fv nc nd l ne nf">export const FamilyProvider = FamilyContext.Provider;<br/>export const FamilyConsumer = FamilyContext.Consumer;</span></pre><p id="0a54" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是我们将如何使用提供者和消费者的完整示例:</p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="mw mx l"/></div></figure><p id="3a64" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们已经用<code class="eh mr ms mt mu b">&lt;FamilyProvider /&gt;</code>包装了<code class="eh mr ms mt mu b">&lt;Mother /&gt;</code>组件，因为它包含了需要访问<code class="eh mr ms mt mu b">lastName</code>属性的<code class="eh mr ms mt mu b">&lt;Child /&gt;</code>组件。</p><pre class="kc kd ke kf fq my mu mz na aw nb dt"><span id="a26f" class="md kl hu mu b fv nc nd l ne nf">&lt;FamilyProvider value={this.state.lastName}&gt;<br/>  &lt;Mother /&gt;<br/>&lt;/FamilyProvider&gt;</span></pre><p id="a18d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意，提供者有一个值属性。传递你想分享的任何状态。在我们的例子中，我们想要共享<code class="eh mr ms mt mu b">lastName</code>，所以我们传入<code class="eh mr ms mt mu b">this.state.lastName</code>。</p><p id="c312" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了实际访问<code class="eh mr ms mt mu b">lastName</code>，我们还在<code class="eh mr ms mt mu b">&lt;FamilyConsumer /&gt;</code>组件的第27行包装了<code class="eh mr ms mt mu b">&lt;p&gt;</code>标签，这样它就可以访问<code class="eh mr ms mt mu b">context</code>。</p><p id="a58f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们更深入地了解一下<code class="eh mr ms mt mu b">&lt;FamilyConsumer /&gt;</code>！</p><p id="0c3a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">起初，如果你不熟悉render prop模式，它可能看起来有点混乱，但是稍微解释一下，我想你可能会发现这是一个相当简单的实现。你不需要知道如何构建一个渲染道具来使用上下文，但是这是一个非常强大的抽象！</p><h2 id="3b18" class="md kl hu bd km me mf mg kq mh mi mj ku jn mk ml ky jr mm mn lc jv mo mp lg mq dt translated">什么是渲染道具？</h2><p id="2d00" class="pw-post-body-paragraph jc jd hu je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">渲染道具是在React中编写组件的一种方式，以便它们可以重用，并且可以接受<em class="ng"> n </em>个任何类型的子元素。渲染道具以几种不同的伪装出现。Context实现了一个函数作为子模式，它只是一个名为<code class="eh mr ms mt mu b">children</code>的渲染道具。如果你想了解更多关于渲染道具的知识，你可以阅读Kent C. Dodds的<a class="ae ka" href="https://blog.kentcdodds.com/when-to-not-use-render-props-5397bbeff746" rel="noopener ugc nofollow" target="_blank">When Not Use Render Props</a>或者直接进入<a class="ae ka" href="https://reactjs.org/docs/render-props.html" rel="noopener ugc nofollow" target="_blank"> React关于这个主题的文档</a>。</p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="mw mx l"/></div></figure><p id="bb33" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">&lt;FamilyConsumer /&gt;</code>使用渲染道具将<code class="eh mr ms mt mu b">context</code>对象暴露给其子对象(在本例中是一个<code class="eh mr ms mt mu b">&lt;p /&gt;</code>标签，但它可以是任何东西)。</p></div><div class="ab cl nh ni hc nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hn ho hp hq hr"><p id="ea63" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最终，上下文是添加到React工具箱中的一个很好的工具。当您发现正确钻探变得太复杂，但是您的应用程序不够大，无法保证像MobX或redux这样的第三方解决方案时，可以使用它。</p><p id="f452" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">🌟<strong class="je hv"> <em class="ng">如果你喜欢这个帖子，</em> </strong> <strong class="je hv"> <em class="ng">一定要在中上</em> </strong> <a class="ae ka" rel="noopener" href="/@MCapoz"> <strong class="je hv"> <em class="ng">关注我</em> </strong> </a> <strong class="je hv"> <em class="ng">，</em> </strong> <a class="ae ka" href="https://twitter.com/MCapoz" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> <em class="ng">在twitter上关注我</em> </strong> </a> <strong class="je hv"> <em class="ng">，在</em> </strong> <a class="ae ka" href="https://www.patreon.com/maecapozzi" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> <em class="ng">上支持我</em>T47】🌟</strong></a></p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="no mx l"/></div></figure></div></div>    
</body>
</html>