<html>
<head>
<title>Create a Serverless GraphQL server using Express, Apollo Server and AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express、Apollo Server和AWS Lambda创建一个无服务器的GraphQL服务器</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/create-a-serverless-graphql-server-using-express-apollo-server-and-aws-lambda-c3850a2092b5?source=collection_archive---------2-----------------------#2018-08-19">https://medium.com/hackernoon/create-a-serverless-graphql-server-using-express-apollo-server-and-aws-lambda-c3850a2092b5?source=collection_archive---------2-----------------------#2018-08-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="dccd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…因为谁不想要无服务器的GraphQL服务器呢，对吧！？</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/ad5a01ec9cd172dfff95267b8ec6664b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Af-fTT3Ujk6GZpjMgHwA-Q.jpeg"/></div></div></figure><p id="c398" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你曾经玩过GraphQL、无服务器和爱T2 JavaScript，那么你来对地方了。有什么比混几个近段时间最刺激的技术，不多，诶。</p><p id="dcc6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">继续我们的<a class="ae kb" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>之旅，并进一步建立在之前的帖子上，在那里我们已经探索了<a class="ae kb" rel="noopener" href="/@YatinBadal/rendering-and-serving-a-create-react-app-from-an-express-server-running-within-a-lambda-function-832576a5167e"> <em class="kc">从运行在Lambda函数</em></a><em class="kc">——</em>内的Express服务器渲染和服务Create-React-App，现在让我们将注意力转向GraphQL并将其与无服务器结合。这样，就不需要一个持续运行的GraphQL实例，这是一个操作梦想。</p><p id="d09d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将为我们的服务器使用<a class="ae kb" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>函数和<a class="ae kb" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>。我们的Lambdas将运行节点。JS 8.1运行时。我们还将利用<a class="ae kb" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>的捆绑优势和<a class="ae kb" href="https://babeljs.io/" rel="noopener ugc nofollow" target="_blank"> Babel </a>来传输我们的堆栈。</p><p id="5961" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了启动和运行我们的无服务器GraphQL服务器，我们需要:</p><ul class=""><li id="9ede" class="kd ke hu it b iu iv iy iz jc kf jg kg jk kh jo ki kj kk kl dt translated">设置无服务器</li><li id="6434" class="kd ke hu it b iu km iy kn jc ko jg kp jk kq jo ki kj kk kl dt translated">创建和表达应用程序</li><li id="0ad7" class="kd ke hu it b iu km iy kn jc ko jg kp jk kq jo ki kj kk kl dt translated">引入并配置Apollo服务器</li></ul><p id="624e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好了，我们开始吧！</p></div><div class="ab cl kr ks hc kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hn ho hp hq hr"><h1 id="f604" class="ky kz hu bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv dt translated">无服务器+网络包</h1><p id="6b06" class="pw-post-body-paragraph ir is hu it b iu lw iw ix iy lx ja jb jc ly je jf jg lz ji jj jk ma jm jn jo hn dt translated">首先，安装无服务器框架和它需要的所有必要的依赖项:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="21ed" class="mg kz hu mc b fv mh mi l mj mk">$ npm i -S serverless serverless-webpack serverless-http serverless-offline </span></pre><p id="67de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还需要安装Webpack、节点外部包和babel-loader。接下来为Webpack创建一个配置文件:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="83ff" class="mg kz hu mc b fv mh mi l mj mk">$ npm i -D webpack webpack-node-externals babel-loader<br/>$ touch webpack.config.js</span></pre><p id="747c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并将以下基本配置放入其中:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="49b6" class="mg kz hu mc b fv mh mi l mj mk">// webpack.config.js</span><span id="b22f" class="mg kz hu mc b fv ml mi l mj mk">const path = require("path");<br/>const slsw = require("serverless-webpack");<br/>const nodeExternals = require("webpack-node-externals");</span><span id="c559" class="mg kz hu mc b fv ml mi l mj mk">module.exports = {<br/>  entry: slsw.lib.entries,<br/>  target: "node",<br/>  mode: slsw.lib.webpack.isLocal ? "development" : "production",<br/>  optimization: {<br/>    minimize: false<br/>  },<br/>  performance: {<br/>    hints: false<br/>  },<br/>  devtool: "nosources-source-map",<br/>  externals: [nodeExternals()],<br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.js$/,<br/>        exclude: /node_modules/,<br/>        use: [<br/>          {<br/>            loader: "babel-loader"<br/>          }<br/>        ]<br/>      }<br/>    ]<br/>  },<br/>  output: {<br/>    libraryTarget: "commonjs2",<br/>    path: path.join(__dirname, ".webpack"),<br/>    filename: "[name].js",<br/>    sourceMapFilename: "[file].map"<br/>  }<br/>};</span></pre><p id="5977" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在这里找到更多关于无服务器网络包插件<a class="ae kb" href="https://github.com/serverless-heaven/serverless-webpack" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="41e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们需要创建并配置我们的<strong class="it hv"> serverless.yml </strong>文件:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="8443" class="mg kz hu mc b fv mh mi l mj mk">$ touch serverless.yml</span></pre><p id="f864" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将以下YML放入其中:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="59fd" class="mg kz hu mc b fv mh mi l mj mk">// serverless.yml</span><span id="78cf" class="mg kz hu mc b fv ml mi l mj mk">service: serverless-graphql</span><span id="2be8" class="mg kz hu mc b fv ml mi l mj mk">plugins:<br/>  - serverless-webpack<br/>  - serverless-offline</span><span id="37ea" class="mg kz hu mc b fv ml mi l mj mk">custom:<br/>  webpack:<br/>    webpackConfig: ./webpack.config.js<br/>    includeModules: true</span><span id="e024" class="mg kz hu mc b fv ml mi l mj mk">provider:<br/>  name: aws<br/>  runtime: nodejs8.10<br/>  stage: dev<br/>  region: eu-west-1</span></pre><p id="0490" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来我们将添加和配置我们的功能。</p><h1 id="4af4" class="ky kz hu bd la lb mm ld le lf mn lh li lj mo ll lm ln mp lp lq lr mq lt lu lv dt translated">Express +阿波罗服务器</h1><p id="6e5d" class="pw-post-body-paragraph ir is hu it b iu lw iw ix iy lx ja jb jc ly je jf jg lz ji jj jk ma jm jn jo hn dt translated">好吧，让我们继续我们的服务器。我们需要安装Express、Apollo服务器和其他一些依赖项:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="64a1" class="mg kz hu mc b fv mh mi l mj mk">$ npm i -S express apollo-server-express graphql</span></pre><p id="ddbd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还将使用<a class="ae kb" href="https://github.com/prisma/graphql-playground" rel="noopener ugc nofollow" target="_blank"> Prisma GraphQL playground </a>来测试我们奇特的服务器。让我们安装必要的软件包:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="0670" class="mg kz hu mc b fv mh mi l mj mk">$ npm i -D graphql-playground-middleware-express</span></pre><p id="6f64" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建一个<strong class="it hv"> index.js </strong>文件，该文件将包含我们的服务器代码以及我们的入口点:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="e774" class="mg kz hu mc b fv mh mi l mj mk">$ touch index.js</span></pre><p id="5f73" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将以下代码放入其中:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="94e7" class="mg kz hu mc b fv mh mi l mj mk">// index.js</span><span id="a315" class="mg kz hu mc b fv ml mi l mj mk">import express from "express";<br/>import serverless from "serverless-http";<br/>import graphiql from "graphql-playground-middleware-express";<br/>import { ApolloServer, gql } from "apollo-server-express";</span><span id="91fc" class="mg kz hu mc b fv ml mi l mj mk">const typeDefs = gql`<br/>  type Query {<br/>    hello: String<br/>  }<br/>`;</span><span id="cb95" class="mg kz hu mc b fv ml mi l mj mk">const resolvers = {<br/>  Query: {<br/>    hello: () =&gt; "world"<br/>  }<br/>};</span><span id="4e17" class="mg kz hu mc b fv ml mi l mj mk">const app = express();</span><span id="5306" class="mg kz hu mc b fv ml mi l mj mk">const server = new ApolloServer({<br/>  typeDefs,<br/>  resolvers,<br/>  path: "/graphql"<br/>});</span><span id="c44d" class="mg kz hu mc b fv ml mi l mj mk">server.applyMiddleware({ app });</span><span id="e2c3" class="mg kz hu mc b fv ml mi l mj mk">app.get("/playground", graphiql({ endpoint: "/graphql" }));</span><span id="03c0" class="mg kz hu mc b fv ml mi l mj mk">const handler = serverless(app);</span><span id="d496" class="mg kz hu mc b fv ml mi l mj mk">export { handler };</span></pre><p id="b45b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">没错，我们的<strong class="it hv"> index.js </strong>已经被设置为容纳两个lambda函数，一个用于GraphQL Apollo服务器，另一个用于游乐场。更新<strong class="it hv"> serverless.yml </strong>文件，添加我们需要的两个函数:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="cb35" class="mg kz hu mc b fv mh mi l mj mk">// serverless.yml</span><span id="f3da" class="mg kz hu mc b fv ml mi l mj mk">functions:<br/>  graphql:<br/>    handler: index.handler<br/>    events:<br/>      - http:<br/>          path: graphql<br/>          method: post<br/>          cors: true<br/>  playground:<br/>    handler: index.handler<br/>    events:<br/>      - http:<br/>          path: playground<br/>          method: get</span></pre><p id="9d7a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…至此，我们差不多完成了设置。让我们测试一下我们的GraphQL Apollo服务器吧！回想一下，之前我们添加了<strong class="it hv">无服务器离线</strong>作为依赖项，让我们继续离线启动我们的服务器:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="b679" class="mg kz hu mc b fv mh mi l mj mk">$ npx sls offline start</span></pre><p id="9372" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将启动我们服务器的一个本地实例。您应该会看到以下输出:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mr"><img src="../Images/86adf749ed60e440c9021bc28706721a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vuWzzJh35kFabANHVJmkMg.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">Running our GraphQL server for the first time!</figcaption></figure><p id="3212" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您会注意到我们的两个端点将被创建，<strong class="it hv"> <em class="kc"> /graphql </em> </strong>是我们的graphql服务器端点，而我们的playground位于<strong class="it hv"> <em class="kc"> /playground </em> </strong>。为了测试我们的服务器，让我们导航到我们的游乐场，<a class="ae kb" href="http://localhost:3000/playground" rel="noopener ugc nofollow" target="_blank"><em class="kc">http://localhost:3000/playground</em></a></p><p id="035d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">执行一个简单的查询，看看无服务器GraphQL服务器的魔力…😎</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/a6de5b8e66371f261d3685ba59dfbe96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tHITt3hOP00uDHga3xg_ig.png"/></div></div><figcaption class="ms mt fg fe ff mu mv bd b be z ek">Our Serverless GraphQL server in all it’s glory 😎</figcaption></figure></div><div class="ab cl kr ks hc kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hn ho hp hq hr"><h1 id="4148" class="ky kz hu bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv dt translated">—终于</h1><p id="426b" class="pw-post-body-paragraph ir is hu it b iu lw iw ix iy lx ja jb jc ly je jf jg lz ji jj jk ma jm jn jo hn dt translated">通过几个简单的步骤，我们已经在AWS Lambda上创建了一个简单的Express和GraphQL服务器。要部署我们的服务器，我们现在需要做的就是运行:</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="641a" class="mg kz hu mc b fv mh mi l mj mk">$ npx sls deploy -v</span></pre><p id="824d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将你的服务器连接到你的<a class="ae kb" rel="noopener" href="/@YatinBadal/rendering-and-serving-a-create-react-app-from-an-express-server-running-within-a-lambda-function-832576a5167e"> React前端，也就是从Lambda </a>渲染的服务器端，你就有了一个非常灵活的无服务器解决方案。这就结束了我们结合无服务器和GraphQL的小小尝试——这是目前最热门的两项技术。</p><p id="3201" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在<a class="ae kb" href="https://github.com/FBI23/serverless-express-graphql" rel="noopener ugc nofollow" target="_blank">https://github.com/FBI23/serverless-express-graphql</a>找到这篇文章的代码</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mx my l"/></div></figure></div></div>    
</body>
</html>