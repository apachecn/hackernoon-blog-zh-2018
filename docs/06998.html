<html>
<head>
<title>Persistent JavaScript storage with CSV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSV的持久JavaScript存储</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/persistent-javascript-storage-with-csv-accdf52512b0?source=collection_archive---------12-----------------------#2018-08-20">https://medium.com/hackernoon/persistent-javascript-storage-with-csv-accdf52512b0?source=collection_archive---------12-----------------------#2018-08-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="78a5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然大多数程序员认为JSON是持久存储JavaScript数据的首选文件格式，但使用其他格式存储数据仍然有价值。CSV是已经存在很长时间的格式之一，在大多数情况下使用起来非常简单。然而，虽然JavaScript提供了原生方法来序列化和反序列化JSON对象(<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" rel="noopener ugc nofollow" target="_blank">JSON.stringify()</a></code>和<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse" rel="noopener ugc nofollow" target="_blank">JSON.parse()</a></code>)，但是CSV文件没有这种内置功能，因此在本文中，我将尝试在ES6中实现上述功能。</p><h2 id="3f0a" class="ju jv hu bd jw jx jy jz ka kb kc kd ke jc kf kg kh jg ki kj kk jk kl km kn ko dt translated">将数组转换为CSV格式</h2><p id="d87c" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">为了将CSV与JavaScript结合使用，我们需要编写的第一段也是最简单的一段代码是将2D数组转换为CSV文件的序列化程序:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff ku"><img src="../Images/58caa5add342c4724c03f25a9caadd11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9KNC7Ucvb9EZI-ugD8QOQ.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Image by <a class="ae jt" href="https://unsplash.com/@danifunes?utm_source=carbon&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Daniel Funes Fuentes</a> on Unsplash</figcaption></figure><p id="aecf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的代码非常简单。它使用<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="noopener ugc nofollow" target="_blank">Array.map()</a></code>和<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join" rel="noopener ugc nofollow" target="_blank">Array.join()</a></code>将每个子数组组合成一个字符串，根据提供的<code class="eh jp jq jr js b">delimiter</code>分离值，然后再次使用<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="noopener ugc nofollow" target="_blank">Array.map()</a></code>和<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join" rel="noopener ugc nofollow" target="_blank">Array.join()</a></code>创建一个多行字符串，我们的CSV输出，包含所有数组的数据。</p><h2 id="5fdf" class="ju jv hu bd jw jx jy jz ka kb kc kd ke jc kf kg kh jg ki kj kk jk kl km kn ko dt translated">将CSV转换为数组</h2><p id="0f48" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">序列化一个数组很容易，但是假设您有一个CSV文件，并希望将其转换回数组。在这种情况下，您需要一个反序列化器来反转上述过程:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff lk"><img src="../Images/b3afc95a7d264f13a98b4aea428524d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5mvZdTfK6aX-q23Lr3_LtA.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Image by <a class="ae jt" href="https://unsplash.com/@ronaldsmeets?utm_source=carbon&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ronald Smeets</a> on Unsplash</figcaption></figure><p id="4925" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里的程序基本上与前面的相同，但方向相反。使用<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split" rel="noopener ugc nofollow" target="_blank">String.split()</a></code>将文件分成行，然后根据提供的<code class="eh jp jq jr js b">delimiter</code>使用<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split" rel="noopener ugc nofollow" target="_blank">String.split()</a></code>第二次将文件转换成单独的值。最后一点是允许用户决定是否要省略第一行，因为有时CSV文件使用第一行来存储列名。</p><h2 id="84db" class="ju jv hu bd jw jx jy jz ka kb kc kd ke jc kf kg kh jg ki kj kk jk kl km kn ko dt translated">将CSV转换为对象数组</h2><p id="307c" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">根据上面代码片段的最后一句话，我们可以很容易地找到一种方法，将CSV文件转换为对象数组，使用第一行作为属性名:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff ll"><img src="../Images/8f0dff0dd997931b58ce4b1a9c4dfd31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mrGD3YbTuEZXHO1aqPjKKw.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Image by <a class="ae jt" href="https://unsplash.com/@tentides?utm_source=carbon&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jeremy Bishop</a> on Unsplash</figcaption></figure><p id="3604" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在事情变得越来越复杂了。显然，我们要做的第一件事是从第一行获取属性名称列表，类似于我们之前所做的，使用<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice" rel="noopener ugc nofollow" target="_blank">Array.slice()</a></code>。然后是对象创建部分，这是使用<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split" rel="noopener ugc nofollow" target="_blank">String.split()</a></code>和<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="noopener ugc nofollow" target="_blank">Array.map()</a></code>完成的，就像我们之前做的一样。唯一的主要区别是，我们使用<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" rel="noopener ugc nofollow" target="_blank">Array.reduce()</a></code>为CSV文件中的每一行值创建一个具有适当键值对的对象。瞧啊。我们有一个数组，里面装满了我们现在可以使用的JavaScript对象。</p><h2 id="5c2b" class="ju jv hu bd jw jx jy jz ka kb kc kd ke jc kf kg kh jg ki kj kk jk kl km kn ko dt translated">将对象数组转换为CSV格式</h2><p id="edd0" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">最棘手的部分来了——序列化对象数组。为什么这是棘手和复杂的？因为有时对象的属性数量不同，或者属性的顺序不同。这在试图序列化为CSV这样的统一结构时会产生一些问题。</p><p id="5aaf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有很多方法可以弥补这一点，比如对结构做出某些假设，确保对象具有相同数量的属性等等。，但我能编写的最通用的函数要求开发人员指定哪些属性需要序列化:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="fe ff lm"><img src="../Images/49efd163c5a1c6efdacea0d4a694c7a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-xrqJ0qsF4fOgh3gHWfZ6w.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Image by <a class="ae jt" href="https://unsplash.com/@nardoleo?utm_source=carbon&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Leonardo Wong</a> on Unsplash</figcaption></figure><p id="983c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">看起来可能不多，但这里发生了很多事情。首先，我们需要为CSV字符串创建一个行数组，并将第一行设置为我们希望从对象数组中序列化的属性列表。然后，我们使用<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="noopener ugc nofollow" target="_blank">Array.map()</a></code>和<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" rel="noopener ugc nofollow" target="_blank">Array.reduce()</a></code>来创建每一行，属性按正确的顺序排列，不存在的属性为空值。最后，我们使用扩展操作符(<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" rel="noopener ugc nofollow" target="_blank">…</a></code>)和<code class="eh jp jq jr js b"><a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join" rel="noopener ugc nofollow" target="_blank">Array.join()</a></code>输出一个多行CSV字符串。</p><h2 id="b6a6" class="ju jv hu bd jw jx jy jz ka kb kc kd ke jc kf kg kh jg ki kj kk jk kl km kn ko dt translated">考虑和改进</h2><p id="3207" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">虽然这是一个关于如何将CSV与JavaScript结合使用的快速指南，但是对于这种数据类型还可以做更多的事情。请注意，上面的所有代码片段都没有完全优化，可能无法处理边缘情况，因此可以从那里开始。另一个问题是序列化和反序列化之间有一点不一致，所以这也可以解决。最后，嵌套的对象或数组不能用这些代码片段序列化，CSV本身不支持它们，所以可以创建用于嵌套的定制数据结构来处理这个问题。</p></div><div class="ab cl ln lo hc lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hn ho hp hq hr"><p id="5fa6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lu">我希望你喜欢这个小指南。如果你看到了，请给我一个或五十个掌声！本文中的所有源代码都可以在GitHub </em>  <em class="lu">上的</em> <a class="ae jt" href="https://github.com/Chalarangelo/30-seconds-of-code" rel="noopener ugc nofollow" target="_blank"> <em class="lu"> 30秒代码库中找到，还有更多满足您日常需求的JavaScript代码片段。</em></a></p></div></div>    
</body>
</html>