<html>
<head>
<title>Introducing Promise-Funnel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">引入承诺漏斗</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/introducing-promise-funnel-93e7d46ceb31?source=collection_archive---------15-----------------------#2018-08-23">https://medium.com/hackernoon/introducing-promise-funnel-93e7d46ceb31?source=collection_archive---------15-----------------------#2018-08-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="303f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">今天，我将简要介绍一个新的库，它可以帮助您管理应用流程。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/120d642ce0fe79fdf8ae5470fe44630c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZhpkuhrEQagrdZdZJ5WVQ.png"/></div></div></figure><p id="9e1e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个用例的灵感来自我最近遇到的两个特殊问题。</p><p id="b395" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第一个问题中，我有一个React应用程序，它可以立即并定期对两者进行身份验证。在每次身份验证期间，检索数据的请求需要等待。在此期间，我不想收到或显示未经验证的响应错误。</p><p id="580e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第二个问题中，我有一个数据库微服务，它立即调用发送查询的函数，但是它需要在实际发送任何查询之前完成到数据库的连接。</p><p id="3aac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个问题似乎有些普遍。这就是<code class="eh kb kc kd ke b">promise-funnel</code>的用武之地！你可以在NPM 上查看<a class="ae kf" href="https://www.npmjs.com/package/promise-funnel" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="19e7" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jc ky kz la jg lb lc ld jk le lf lg lh dt translated">概念</h2><p id="2f5b" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">promise-漏斗是一个非常小的(4kb)和非常简单的库。它导出三个函数。</p><p id="7fb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Wrap: </strong>任何想要被漏斗化的函数都必须被包装。</p><p id="3c9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">塞住:</strong>要暂停执行功能，您可以塞住漏斗。所有函数执行都将被收集，以便以后运行。</p><p id="9930" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">开启:</strong>要再次开始执行，并执行漏斗堵塞时应该运行的每个函数，您可以开启漏斗。</p><p id="2f26" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当结合这些简单的概念时，我们能够为我们的应用程序创建一个强大的控制流！</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="4d56" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jc ky kz la jg lb lc ld jk le lf lg lh dt translated">如何使用它</h2><p id="2841" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">下面是如何将它用于需要在发送任何查询之前进行连接的数据库应用程序。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="ln lo l"/></div></figure><p id="263b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以看到查询立即被阻塞，只有当数据库连接成功时才被解除阻塞。这意味着服务可以立即接受请求，但是在数据库连接发生之前它不会执行任何查询！</p><p id="5b7e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们看一下我前面提到的认证例子。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="ln lo l"/></div></figure><p id="b633" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每隔五分钟，用户再次登录。当登录发生时，每个用户请求都会失败。因此，我们没有让这种情况发生，而是阻塞了获取请求，直到登录完成。现在用户不会被身份验证阻止..虽然他们可能会延迟！</p><p id="c78a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您想知道，<code class="eh kb kc kd ke b">createFunnel</code>每次都会创建一个新的漏斗实例。这意味着您可以安全地将不同的操作分开。</p><h2 id="f277" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jc ky kz la jg lb lc ld jk le lf lg lh dt translated"><strong class="ak">用自己的承诺</strong></h2><p id="eadb" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">并不是每个环境天生都有承诺。如果你想通过<code class="eh kb kc kd ke b">promise-funnel</code>使用像蓝鸟这样的库，你可以！</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="ln lo l"/></div></figure><h2 id="6877" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jc ky kz la jg lb lc ld jk le lf lg lh dt translated">承诺的部分</h2><p id="429f" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">到目前为止，我们还没有真正看到这个库如何使用Promise。当函数被包装且漏斗被堵塞时，函数不会立即执行。而是返回一个<code class="eh kb kc kd ke b">Promise</code>。只有当漏斗打开时，它才会溶解或剔除。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="ln lo l"/></div></figure><p id="2ae4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的代码片段应该显示，打开漏斗将解析包装函数返回的承诺。</p><p id="78be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着任何在包装函数上使用<code class="eh kb kc kd ke b">await</code>或在包装函数上使用<code class="eh kb kc kd ke b">.then().catch()</code>的函数都不会继续，直到漏斗打开。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><p id="f7a5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你有它！<code class="eh kb kc kd ke b">promise-funnel</code>是一个很小的图书馆，但我希望你们都能发现它的用处。</p><p id="e07c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要安装它，您可以使用以下命令:</p><p id="96c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh kb kc kd ke b">npm install promise-funnel --save</code></p><p id="fe8c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你也可以在这里查看源代码:【https://github.com/JustinDFuller/promise-funne】T4l</p><h2 id="5e9c" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jc ky kz la jg lb lc ld jk le lf lg lh dt translated">反馈</h2><p id="c68e" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">这是一个全新的库，显然还可以改进。有什么建议吗？例如，它可能会受益于选择性地只开放一定量的并发性，以避免大的突发。也可能有其他方法来完成承诺漏斗应该做的事情。欢迎在评论中分享建议和替代工具！</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><p id="9a62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">嗨，我是贾斯汀·富勒。很高兴你看了我的帖子！我需要让你知道，我在这里写的一切都是我自己的观点，并不代表我的雇主。所有代码样本都是我自己的，与美国银行的代码完全无关。</p><p id="5c8a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我也很乐意收到您的来信，请随时通过<a class="ae kf" href="https://www.linkedin.com/in/justin-fuller-8726b2b1/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae kf" href="https://github.com/justindfuller" rel="noopener ugc nofollow" target="_blank"> Github </a>或<a class="ae kf" rel="noopener" href="/@justindanielfuller"> Medium </a>与我联系。再次感谢阅读！</p></div></div>    
</body>
</html>