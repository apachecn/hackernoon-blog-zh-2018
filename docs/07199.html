<html>
<head>
<title>Create a simple calculator app in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中创建一个简单的计算器应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/create-a-simple-calculator-app-in-react-1ec6a7bbe09d?source=collection_archive---------2-----------------------#2018-08-26">https://medium.com/hackernoon/create-a-simple-calculator-app-in-react-1ec6a7bbe09d?source=collection_archive---------2-----------------------#2018-08-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/29826b9de2b6091c768bc0e6949ba63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FEwJPh9-jZLEyy5lPyNybA.png"/></div></div></figure><p id="5a74" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">今天我们将创建一个新的react应用程序，一个计算器。虽然操作非常简单，但要将东西固定在适当的位置并保持适当的状态还是有点困难。</p><h1 id="ed5a" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">特色React JS课程</h1><h2 id="bdbc" class="ky kb hu bd kc kz la lb kg lc ld le kk jn lf lg ko jr lh li ks jv lj lk kw ll dt translated"><a class="ae lm" href="http://thebestdevlist.link/react-the-complete-16-guide-incl-redux" rel="noopener ugc nofollow" target="_blank"> React 16 —完整指南(包括React路由器4 &amp; Redux) </a></h2><p id="f88e" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">4.7/5星<strong class="je hv"> || </strong> 33.5小时视频<strong class="je hv">| |</strong>61597名学生</p><p id="5215" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">学习反应或深入研究。学习理论，解决作业，在演示项目中实践，并构建一个在整个课程中不断改进的大型应用程序:汉堡生成器！<a class="ae lm" href="http://thebestdevlist.link/react-the-complete-16-guide-incl-redux" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">了解更多。</strong> </a></p><div class="ls lt fm fo lu lv"><a href="http://thebestdevlist.link/react-the-complete-16-guide-incl-redux" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab ej"><div class="lx ab ly cl cj lz"><h2 class="bd hv fv z el ma eo ep mb er et ht dt translated">React 16 —完整指南(包括React Router 4和Redux)</h2><div class="mc l"><h3 class="bd b fv z el ma eo ep mb er et ek translated">投身其中，从头开始学习React！了解Reactjs、Redux、React Routing、动画、Next.js基础知识以及更多内容！</h3></div><div class="md l"><p class="bd b gc z el ma eo ep mb er et ek translated">thebestdevlist.link</p></div></div><div class="me l"><div class="mf l mg mh mi me mj ja lv"/></div></div></a></div><h2 id="1489" class="ky kb hu bd kc kz la lb kg lc ld le kk jn lf lg ko jr lh li ks jv lj lk kw ll dt translated">【React专业化的全栈Web开发</h2><p id="3dc5" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">构建完整的Web和混合移动解决方案。在Coursera <a class="ae lm" href="http://thebestdevlist.link/coursera-full-stack-react" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">注册的四门综合课程中掌握前端web、混合移动应用程序和服务器端开发，开始为期7天的完全免费试用。</strong> </a></p><div class="ls lt fm fo lu lv"><a href="http://thebestdevlist.link/coursera-full-stack-react" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab ej"><div class="lx ab ly cl cj lz"><h2 class="bd hv fv z el ma eo ep mb er et ht dt translated">使用React | Coursera进行全栈Web开发</h2><div class="mc l"><h3 class="bd b fv z el ma eo ep mb er et ek translated">香港科技大学React的全栈Web开发。学习前端和…</h3></div><div class="md l"><p class="bd b gc z el ma eo ep mb er et ek translated">thebestdevlist.link</p></div></div><div class="me l"><div class="mk l mg mh mi me mj ja lv"/></div></div></a></div><p id="1286" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是我们将要创建的应用程序的演示。</p><figure class="ml mm mn mo fq iv"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="8604" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">create-react-app</code>是我们开始确保您照常拥有<code class="eh mr ms mt mu b">node</code>、<code class="eh mr ms mt mu b">npm</code>、<code class="eh mr ms mt mu b">create-react-app</code>的地方。</p><p id="3daf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果没有，请从<a class="ae lm" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">这里</a>安装NodeJS(NPM自带)。</p><p id="b9f1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将带有<code class="eh mr ms mt mu b">npm install create-react-app --global</code>的<code class="eh mr ms mt mu b">create-react-app</code>安装在端子上。</p><p id="4bf4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是所有的安装部分。</p><p id="e455" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用<code class="eh mr ms mt mu b">create-react-app react-calculator</code>创建一个新的react app。确保你的应用程序名称中没有空格，初学者经常犯这个错误。</p><p id="7ed3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">cd react-calculator<br/>npm start</code></p><p id="88da" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这将启动一个react欢迎页面，如下所示。</p><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div class="fe ff mv"><img src="../Images/f619b078204d1cd7c22e03e2ae73f9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/0*QwkXB-kakz6ohvs3"/></div></figure><p id="9436" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我将把计算器应用程序分解成单独的小块。首先，它有一些JSX，看起来像HTML，但实际上是JavaScript。这个JSX使计算器应用程序呈现在屏幕上。它有一堆带有类名的div和按钮。CSS的魔力融入了类名，使其看起来更好。</p><h1 id="ef2b" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">用于在React中创建计算器的库</h1><ol class=""><li id="678b" class="mw mx hu je b jf ln jj lo jn my jr mz jv na jz nb nc nd ne dt translated">反应，反应-dom</li><li id="23c3" class="mw mx hu je b jf nf jj ng jn nh jr ni jv nj jz nb nc nd ne dt translated">数学</li><li id="ac37" class="mw mx hu je b jf nf jj ng jn nh jr ni jv nj jz nb nc nd ne dt translated">不变性助手</li></ol><p id="a018" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">如何开始？</strong></p><p id="550f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我从<code class="eh mr ms mt mu b">create-react-app</code>开始，继续添加组件。现在，该应用程序包含以下组件:</p><ul class=""><li id="5cbc" class="mw mx hu je b jf jg jj jk jn nk jr nl jv nm jz nn nc nd ne dt translated"><strong class="je hv"> App </strong> —主占位符组件</li><li id="7871" class="mw mx hu je b jf nf jj ng jn nh jr ni jv nj jz nn nc nd ne dt translated"><strong class="je hv">按钮</strong> —单个按钮的占位符</li><li id="ee80" class="mw mx hu je b jf nf jj ng jn nh jr ni jv nj jz nn nc nd ne dt translated"><strong class="je hv">按钮</strong> —单个按钮</li><li id="f460" class="mw mx hu je b jf nf jj ng jn nh jr ni jv nj jz nn nc nd ne dt translated"><strong class="je hv">显示</strong>——顶部的显示条</li></ul><h1 id="0868" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">处理计算器组件</h1><p id="d22d" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">我们的计算器进行加减乘除运算。我们将所有用户输入存储在一个变量中，并在输入等号(<code class="eh mr ms mt mu b">=</code>)时进行计算。</p><p id="c4f3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为每次按下按钮都必须修改输入变量，所以我们将使用状态来处理这个问题。</p><blockquote class="no np nq"><p id="4b4a" class="jc jd nr je b jf jg jh ji jj jk jl jm ns jo jp jq nt js jt ju nu jw jx jy jz hn dt translated">React是什么状态？</p><p id="d1dc" class="jc jd nr je b jf jg jh ji jj jk jl jm ns jo jp jq nt js jt ju nu jw jx jy jz hn dt translated">react中的<code class="eh mr ms mt mu b">state</code>是指组件中的数据状态。如果使用相同的状态来呈现页面中的多个部分，当它在应用程序中的任何位置发生变化时，所有值都将更新。我们用它来存储按钮按压和显示栏中的显示值。</p></blockquote><p id="00d9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们必须初始化状态，我们通过构造函数来完成。</p><pre class="ml mm mn mo fq nv mu nw nx aw ny dt"><span id="5848" class="ky kb hu mu b fv nz oa l ob oc">class App extends Component {<br/>  constructor() {<br/>    super()<br/>    this.state = { operations: [] }<br/>  }<br/>  .....<br/>}</span></pre><p id="ab3c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">操作变量是按钮输入的数组，可能看起来像<code class="eh mr ms mt mu b">[2, *,4, -, 1]</code>。</p><p id="0589" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们有数字按钮0-9和运算符+、-、*、/。我们也有清除，等于和十进制按钮。每个按钮都有一个点击处理程序。</p><pre class="ml mm mn mo fq nv mu nw nx aw ny dt"><span id="4e83" class="ky kb hu mu b fv nz oa l ob oc">render() {<br/>    return (<br/>      &lt;div className="App"&gt;<br/>        &lt;Display data={this.state.operations} /&gt;<br/>        &lt;Buttons&gt;<br/>          &lt;Button onClick={this.handleClick} label="C" value="clear" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="7" value="7" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="4" value="4" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="1" value="1" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="0" value="0" /&gt;<br/><br/>          &lt;Button onClick={this.handleClick} label="/" value="/" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="8" value="8" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="5" value="5" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="2" value="2" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="." value="." /&gt;<br/><br/>          &lt;Button onClick={this.handleClick} label="x" value="*" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="9" value="9" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="6" value="6" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="3" value="3" /&gt;<br/>          &lt;Button label="" value="null" /&gt;<br/><br/>          &lt;Button onClick={this.handleClick} label="-" value="-" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="+" size="2" value="+" /&gt;<br/>          &lt;Button onClick={this.handleClick} label="=" size="2" value="equal" /&gt;<br/>        &lt;/Buttons&gt;<br/>      &lt;/div&gt;<br/>    )</span></pre><p id="414d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它返回一个按钮，将所有的按钮放在一起。</p><pre class="ml mm mn mo fq nv mu nw nx aw ny dt"><span id="a64b" class="ky kb hu mu b fv nz oa l ob oc">class Buttons extends Component {<br/>  render() {<br/>    return &lt;div className="Buttons"&gt; {this.props.children} &lt;/div&gt;<br/>  }<br/>}</span></pre><p id="71bc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">props.children</code>保存在&lt;按钮&gt;&lt;/按钮&gt;之间传递的所有信息，这些按钮都是按钮。我计划了一个关于<code class="eh mr ms mt mu b">props.children</code>细节的帖子。所以它只是按原样呈现传递的按钮。</p><blockquote class="no np nq"><p id="0936" class="jc jd nr je b jf jg jh ji jj jk jl jm ns jo jp jq nt js jt ju nu jw jx jy jz hn dt translated"><strong class="je hv">更新:</strong>我在这里创建了一个关于<code class="eh mr ms mt mu b">props.children</code>T25的帖子。</p></blockquote><p id="efcc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个按钮是一个独立的按钮。</p><pre class="ml mm mn mo fq nv mu nw nx aw ny dt"><span id="87cb" class="ky kb hu mu b fv nz oa l ob oc">class Button extends Component {<br/>  render() {<br/>    return (<br/>      &lt;div<br/>        onClick={this.props.onClick}<br/>        className="Button"<br/>        data-size={this.props.size}<br/>        data-value={this.props.value}<br/>      &gt;<br/>        {this.props.label}<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="25c1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它从<code class="eh mr ms mt mu b">App</code>接收一个<code class="eh mr ms mt mu b">label</code>、<code class="eh mr ms mt mu b">value</code>和<code class="eh mr ms mt mu b">onClick</code>函数。<code class="eh mr ms mt mu b">Button</code>组件利用这些数据来呈现按钮。</p><p id="ccc0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们还没有谈到的一个组件是应用程序，那就是显示器。</p><p id="52f0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">显示器从应用程序获取状态<code class="eh mr ms mt mu b">operations</code>(数组)作为道具。</p><pre class="ml mm mn mo fq nv mu nw nx aw ny dt"><span id="9027" class="ky kb hu mu b fv nz oa l ob oc">class Display extends Component {<br/>  render() {<br/>    const string = this.props.data.join('')<br/>    return &lt;div className="Display"&gt; {string} &lt;/div&gt;<br/>  }<br/>}</span></pre><p id="8332" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接收到的数据是来自状态的<code class="eh mr ms mt mu b">operations</code>，它被转换成字符串以显示在计算器顶部的<code class="eh mr ms mt mu b">Display</code>组件中。您在显示区域看到的操作是一个字符串。</p><p id="d9a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些都是你在屏幕上看到的组件。</p><h1 id="409c" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">React计算器中的操作</h1><p id="df3e" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">这些操作由<code class="eh mr ms mt mu b">handleClick</code>函数处理，点击该按钮即可调用该函数。</p><pre class="ml mm mn mo fq nv mu nw nx aw ny dt"><span id="8f2d" class="ky kb hu mu b fv nz oa l ob oc">handleClick = e =&gt; {<br/>    const value = e.target.getAttribute('data-value')<br/>    switch (value) {<br/>      case 'clear':<br/>        this.setState({<br/>          operations: [],<br/>        })<br/>        break<br/>      case 'equal':<br/>        this.calculateOperations()<br/>        break<br/>      default:<br/>        const newOperations = update(this.state.operations, {<br/>          $push: [value],<br/>        })<br/>        this.setState({<br/>          operations: newOperations,<br/>        })<br/>        break<br/>    }</span></pre><p id="9cfd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">单击按钮后，事件按钮被传递。如果在<code class="eh mr ms mt mu b">Button</code>组件中查找，该值被存储为<code class="eh mr ms mt mu b">data-value</code>。</p><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff od"><img src="../Images/a36a0e84429c24bdcfbfc1f18c3dc845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z-97sZ86CTX3D1Iw"/></div></div></figure><p id="b8a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用<code class="eh mr ms mt mu b">e.target.getAttribute('data-value')</code>，我们获得分配给属性<code class="eh mr ms mt mu b">data-value</code>的值，该值与从<code class="eh mr ms mt mu b">App</code>组件传递的<code class="eh mr ms mt mu b">value</code>相同。</p><p id="f471" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用<code class="eh mr ms mt mu b">switch</code>和<code class="eh mr ms mt mu b">case</code>，我们清除所选值是否被清除，即清除按钮是否被按下。在状态下，操作数组被设置为空白。</p><p id="e2f6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">calculateOperations</code>功能在点击<code class="eh mr ms mt mu b">equal</code>时执行，我们将在下面讨论。对于所有其他选项，我们使用更新功能。</p><h1 id="2fc2" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">更新react应用程序中的状态</h1><p id="6a1c" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">按钮的不清楚，或者等于它去操作数组。其中包含计算显示器上最终输出的所有内容。</p><p id="2357" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<code class="eh mr ms mt mu b">App</code>的顶部，我们从<code class="eh mr ms mt mu b">immutability-helper</code>导入了<code class="eh mr ms mt mu b">update</code>，我们使用相同的功能。</p><p id="8eea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">为什么更新而不是直接将新值推送到数组？</strong></p><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff oe"><img src="../Images/dbd4667cf9bd27ef87ef8ef2d8e8f4fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fD-m8bE8tCHuFB9C"/></div></div></figure><p id="1a60" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">this.state.comment = 'Hello'</code>不会重新渲染组件。</p><p id="790d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">this.setState({comment: 'Hello'})</code>将重新渲染组件。</p><p id="5178" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当状态改变时，组件被重新渲染是很重要的，这是react的基本概念。你不可能照顾到所有使用状态的地方并一个一个地修改它。我们使用状态而不是那样做。</p><p id="66f5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">唯一可以赋值<code class="eh mr ms mt mu b">this.state</code>的地方是构造函数！</p><p id="1a4a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在<a class="ae lm" href="https://reactjs.org/docs/state-and-lifecycle.html#do-not-modify-state-directly" rel="noopener ugc nofollow" target="_blank">的官方文档中读到更多相关信息。</a></p><p id="f228" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们所做的不是修改操作数组，而是创建它的一个副本(<code class="eh mr ms mt mu b">newOperations</code>)以及一个新的值。然后我们将<code class="eh mr ms mt mu b">operations</code>状态设置为<code class="eh mr ms mt mu b">newOperations</code>。这解决了问题，功能由库<code class="eh mr ms mt mu b">immutability-helper</code>提供。</p><p id="74c7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦我们更新了状态，react就知道DOM需要更新。</p><h1 id="d995" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">计算操作</h1><p id="a468" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">计算器必须算出运算的答案！</p><pre class="ml mm mn mo fq nv mu nw nx aw ny dt"><span id="b598" class="ky kb hu mu b fv nz oa l ob oc">calculateOperations = () =&gt; {<br/>    let result = this.state.operations.join('')<br/>    if (result) {<br/>      result = math.eval(result)<br/>      result = math.format(result, { precision: 14 })<br/>      result = String(result)<br/>      this.setState({<br/>        operations: [result],<br/>      })<br/>    }<br/>  }</span></pre><p id="9b29" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它从数组中形成字符串。</p><p id="d872" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果数组中存在任何内容，则用math.eval计算字符串。我们不使用全局eval函数来计算该字符串，它将计算任何JavaScript表达式，而不仅仅是数学表达式。这是一个相当大的安全问题。我们没有修补潜在的安全问题，而是使用了一个名为<a class="ae lm" href="http://mathjs.org/" rel="noopener ugc nofollow" target="_blank"> mathjs </a>的包。</p><p id="d912" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">mathjs</code>有自己的eval函数，只解析数学表达式。</p><p id="fc51" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">math.eval()</code>取字符串，给数字。</p><p id="d9b4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">为什么要格式化？</strong></p><p id="c2c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">JavaScript中的算法有一个基本问题。与其他语言不同，数字只有一种类型。它有很高的精度，它不在乎你实际使用了多少。</p><p id="598f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果我不控制精度，这就是我得到的…</p><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div class="fe ff of"><img src="../Images/5aa2633604ebb4c71d4b58021c3f3bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/0*LaKGoCQDEEGx_mPf"/></div></figure><p id="3648" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">即使是14位精度，我们也能得到正确的结果。它将显示多达14个十进制字符的正确结果。对我们来说这就足够了。</p><p id="8c76" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">随着精密设置，我得到这个…</p><figure class="ml mm mn mo fq iv fe ff paragraph-image"><div class="fe ff og"><img src="../Images/de381181ad4b238c3f27c5bd58de9150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/0*ehuPTCW9JO2uUZUx"/></div></figure><p id="aa35" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我们将状态设置为结果，以便显示得到更新。</p><p id="a8db" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">简单回顾一下，顶部的<code class="eh mr ms mt mu b">Display</code>组件使用<code class="eh mr ms mt mu b">state.operations</code>来显示输入和结果。这是上面讨论的最后一个组件。</p><p id="de7e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就是这样，现在您在react中有了一个工作的计算器！</p><p id="cdf3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">尽管有一些陷阱，表达式必须是有效的。类似<code class="eh mr ms mt mu b">2*/5</code>的东西会让应用崩溃。表情<code class="eh mr ms mt mu b">2.4.5 + 1</code>也会让app崩溃。这是应用程序的逻辑方面(纯JavaScript逻辑)，与react无关。</p><p id="0ba7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这可以通过在用<code class="eh mr ms mt mu b">newOperations</code>更新<code class="eh mr ms mt mu b">operations</code>之前在<code class="eh mr ms mt mu b">handleClick</code>中使用条件语句来解决，以检查无效操作符(<code class="eh mr ms mt mu b">2*/</code>)或小数(<code class="eh mr ms mt mu b">.</code>)。今天我们保持简单，但是如果你有兴趣修复它，不要忘记<a class="ae lm" href="https://github.com/therj/react-calculator" rel="noopener ugc nofollow" target="_blank">发送PR到这个库</a>。</p><p id="7e07" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="nr">原载于</em> <a class="ae lm" href="https://reactninja.io/2018/06/26/create-simple-calculator-app-react/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">反应过来的忍者</strong> </a> <em class="nr">。</em></p><h1 id="ac52" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">结束语:</h1><p id="ba1b" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">我在<a class="ae lm" href="http://reactninja.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> React Ninja </strong> </a>上发表React、React Native以及其他一切与web开发相关的文章。一定要在<a class="ae lm" href="https://twitter.com/reactninjaio" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">推特</strong> </a>上关注我。</p><p id="b7dd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">加入我们的<a class="ae lm" href="https://reactninja.io/subscribe-our-newsletter/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">简讯</strong> </a>获取最新最棒的内容，让你成为更好的开发者。</p><h2 id="d189" class="ky kb hu bd kc kz la lb kg lc ld le kk jn lf lg ko jr lh li ks jv lj lk kw ll dt translated">如果这篇文章有帮助，请点击拍手👏按钮下面几下，以示支持！⬇⬇</h2></div></div>    
</body>
</html>