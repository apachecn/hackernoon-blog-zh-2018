<html>
<head>
<title>Alibaba Unveils PolarFS Distributed File System for Cloud Computing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿里巴巴为云计算发布PolarFS分布式文件系统</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/alibaba-unveils-new-distributed-file-system-6bade3ad0413?source=collection_archive---------16-----------------------#2018-08-28">https://medium.com/hackernoon/alibaba-unveils-new-distributed-file-system-6bade3ad0413?source=collection_archive---------16-----------------------#2018-08-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/625c9a085fc362eff0c461f39905b9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eofSgo4Sdecf4Cje1lA6Gg.jpeg"/></div></div></figure><p id="ca5c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ka">本文是</em><a class="ae kb" rel="noopener" href="/@alitech_2017/academic-alibaba-b56f4176a838"><strong class="je hv"><em class="ka">Academic Alibaba</em></strong></a><em class="ka">系列的一部分，摘自VLDB 2018接受的题为“PolarFS:一种用于共享存储云数据库的超低延迟和故障弹性分布式文件系统”的论文。全文可以在这里阅读</em><a class="ae kb" href="http://www.vldb.org/pvldb/vol11/p1849-cao.pdf" rel="noopener ugc nofollow" target="_blank"><em class="ka"/></a><em class="ka">。</em></p><p id="f923" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最近，云计算服务越来越多地寻求将存储与计算功能分离。然而，尽管这样做有很多好处，但它也带来了一些与分布式文件系统和新兴硬件方法(如RDMA、NVMe和SPDK)的使用相关的关键挑战。为了应对这种情况，阿里巴巴技术团队开发了一种新的定制分布式文件系统，名为PolarFS，以充分挖掘这些新兴技术的潜力。</p><h1 id="d18e" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">脱钩的好处是什么？</h1><p id="b9b9" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">分离式云架构更加灵活，允许利用共享存储功能，这有几个好处:</p><p id="5934" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.计算和存储可以独立定制，并使用不同类型的服务器硬件。</p><p id="704c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.存储节点群集上的磁盘可以形成一个存储池，从而降低碎片、磁盘使用不平衡和空间浪费的风险。</p><p id="5575" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.存储集群的容量和吞吐量可以透明地横向扩展。</p><p id="6999" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.计算节点没有本地持久状态，因为所有数据都存储在存储集群上。因此，通过使用底层分布式存储系统的数据复制和其他高可用性功能，提高了数据可靠性。</p><p id="a674" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">云数据库服务也受益于解耦。解耦允许数据库构建在基于虚拟化技术(如Xen、KVM或Docker)的更安全、更易扩展的环境上。此外，数据库的关键功能，如多个只读实例和检查点，可以在提供快速I/O、数据共享和快照的后端存储集群的支持下得到增强。</p><h1 id="9208" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">有哪些挑战？</h1><p id="8ba3" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">随着数据存储技术继续快速发展，当前领先的云平台正在努力充分利用新兴的硬件方法，如RDMA、NVMe和SPDK。某些广泛使用的开源分布式文件系统，如HDFS和CEPH，比本地磁盘有更高的延迟。当与当前的PCIe固态硬盘一起使用时，这种性能差距会急剧增大。此外，直接在这些存储系统上运行的关系数据库(如MySQL)的性能明显比那些在具有相同CPU和内存配置的本地PCIe SSD上运行的数据库差。</p><p id="95cc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为一种解决方案，谷歌云、AWS和阿里云等供应商使用一种称为实例商店的系统。实例存储使用本地SSD和高I/O VM实例来满足客户对高性能数据库的要求。不幸的是，这个系统有几个缺点:</p><p id="aae7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.容量有限，不适合大型数据库服务。</p><p id="55f9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.数据库必须自己管理数据复制，以确保数据的可靠性。</p><p id="2805" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.通用文件系统(如ext4或XFS)会降低I/O吞吐量，因为当与低I/O延迟硬件(如RDMA、PCIe SSD)一起使用时，内核空间和用户空间之间的传递成本会降低。</p><p id="1134" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.不支持共享一切数据库架构，这是高级云数据库服务的一个关键特性。</p><h1 id="90ed" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">使用PolarFS增强性能</h1><p id="2d8f" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">为了应对instance store的问题，阿里巴巴技术团队设计并实现了PolarFS分布式文件系统，该系统通过多种方式满足了客户对低延迟和高吞吐量的要求:</p><p id="4501" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.使用RDMA和NVMe SSD等新兴硬件，在用户空间中使用轻量级网络堆栈和I/O堆栈，以避免陷入内核和处理内核锁。</p><p id="3585" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.提供了一个类似于POSIX的文件系统API，允许将整个I/O路径保存在用户空间中。</p><p id="c08e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.数据平面I/O模式消除了锁定，避免了关键路径上的上下文切换，并消除了所有不必要的内存拷贝，因此可以利用DMA在主内存和RDMA NIC/NVMe磁盘之间传输数据。</p><p id="6bc1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些功能相结合，大大降低了PolarFS的端到端延迟，使其功能类似于SSD上的本地文件系统。</p><p id="0a39" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">尽管PolarFS实现了性能提升，但在使用Raft开发的分布式系统下使用低延迟硬件时，其I/O可伸缩性受到了阻碍。为了应对这一挑战，阿里巴巴科技团队提出了增强共识协议<em class="ka"> ParallelRaft </em>。该协议基于Raft，允许无序的日志确认、提交和应用，同时使PolarFS符合传统的I/O架构，显著提高了并行I/O并发性</p><h1 id="0a10" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">在PolarFS上实现POLARDB</h1><p id="6dca" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">作为该解决方案的补充，技术团队实现了一个名为POLARDB的关系数据库系统，该系统由AliSQL修改而来，AliSQL是阿里云计算平台上新推出的数据库服务。POLARDB使用共享存储架构，并支持多只读实例功能。它的数据库节点分为主节点和只读(RO)节点。主节点处理读写查询，而RO节点提供读服务。这两种类型共享PolarFS中同一数据库目录下的重做日志文件和数据文件。</p><figure class="lg lh li lj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lf"><img src="../Images/45d611524ae0c7e07458dd0c0ce3c39c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UAXDucnxqrbirMOOxNcF_w.png"/></div></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">POLARDB architecture</figcaption></figure><p id="12a6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此外，PolarFS支持POLARDB的以下特性:</p><p id="6358" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.将文件元数据从主节点同步修改到RO节点。</p><p id="dc64" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.确保对文件元数据的并发修改被序列化，以便文件系统在数据库节点之间保持一致。</p><p id="6f66" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.在网络分区的情况下，通过确保只有真正的主节点得到成功服务来防止数据损坏。</p><h1 id="cb64" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">结论</h1><p id="d26f" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">Polar FS和POLARDB为寻求分离存储和计算架构的云服务供应商提供了显著优势。如本文所述，PolarFS可以提供:</p><p id="ec55" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">超低延迟</p><p id="c5f6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最大化I/O吞吐量</p><p id="ea26" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">降低失败和其他错误的可能性</p><figure class="lg lh li lj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lo"><img src="../Images/cc12fc8133851f7b4b3c04a43ef76092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivQj8Mmvm14XHR4XQ5FNAw.png"/></div></div></figure><p id="8f03" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ka">关于PolarFS及其支持系统的更多信息，可以在这里</em>  <em class="ka">阅读</em> <a class="ae kb" href="http://www.vldb.org/pvldb/vol11/p1849-cao.pdf" rel="noopener ugc nofollow" target="_blank"> <em class="ka">全文。</em></a></p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="30bb" class="kc kd hu bd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz dt translated">阿里巴巴科技</h1><p id="01dc" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">关于阿里巴巴最新技术的第一手深度资料→脸书:<a class="ae kb" href="http://www.facebook.com/AlibabaTechnology" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">【阿里巴巴科技】</strong> </a>。Twitter:<a class="ae kb" href="https://twitter.com/AliTech2017" rel="noopener ugc nofollow" target="_blank"><strong class="je hv">【AlibabaTech】</strong></a>。</p></div></div>    
</body>
</html>