<html>
<head>
<title>Don’t install Postgres. Docker pull Postgres</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要安装Postgres。码头工人拉邮件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/dont-install-postgres-docker-pull-postgres-bee20e200198?source=collection_archive---------1-----------------------#2018-09-04">https://medium.com/hackernoon/dont-install-postgres-docker-pull-postgres-bee20e200198?source=collection_archive---------1-----------------------#2018-09-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/918c34b81d4f05986b95352ef80bef79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0pcYOPXE3UflU48N"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">“black sperm whale” by <a class="ae jg" href="https://unsplash.com/@shohatakeyama?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sho Hatakeyama</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="19c4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">自从Docker出现以来，我很少发现自己在本地机器上直接安装开发软件。无论是数据库服务器(如Postgres)、缓存系统(如Redis、Memcache)还是消息传递系统(如Kafka)，我几乎总是试图找到或构建一个合适的docker映像，以便在开发过程中使用。</p><p id="3fd8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">安装软件很难。而且和你作为开发人员的专业知识没有任何关系。每次开始安装新软件时，我们都会看到版本冲突、深奥的构建失败消息和遗漏的依赖错误。我们花了无数的时间将Stack Overflow的代码片段复制粘贴到我们的终端上，并运行它们，希望其中一个能够神奇地解决安装问题，让软件运行起来。结果大多是绝望、沮丧和丧失生产力。</p><p id="26a1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Docker通过将安装和运行软件的任务减少到两个命令(<em class="kf"> docker run </em>和<em class="kf"> docker pull </em>)提供了一种摆脱这种混乱的方法。在本帖中，我们将通过一步一步地了解用docker安装Postgres是多么的容易和简单来看看这个过程。</p><p id="ce3a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意，这不是docker上的教程。如果你对docker的内部工作方式和你可以用它做的一切感到好奇，我鼓励你去网上冲浪，因为有很多关于这个主题的高质量材料。</p><p id="ea6d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这篇文章假设你有一个有效的docker帐户和一个docker守护进程正在运行。如果你对docker完全陌生，我会推荐从这里的<a class="ae jg" href="https://www.docker.com/get-started" rel="noopener ugc nofollow" target="_blank">开始</a>。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="8189" class="kn ko hu bd kp kq kr ks kt ku kv kw kx js ky kz la jw lb lc ld ka le lf lg lh dt translated">获取Postgres Docker图像</h2><p id="5ca5" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">要下载Postgres最新稳定版本的图像，只需运行</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="483c" class="kn ko hu ls b fv lw lx l ly lz">docker pull postgres</span></pre><p id="ce5c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将从官方Postgres docker hub <a class="ae jg" href="https://hub.docker.com/_/postgres/" rel="noopener ugc nofollow" target="_blank">资源库</a>中下载最新的稳定版Postgres映像。要下载最新稳定版本之外的版本，我们可以为上面的<em class="kf"> docker pull </em>命令提供一个合适的图像标签名称</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="d607" class="kn ko hu ls b fv lw lx l ly lz">docker pull postgres:[tag_you_want]</span></pre><h2 id="b508" class="kn ko hu bd kp kq kr ks kt ku kv kw kx js ky kz la jw lb lc ld ka le lf lg lh dt translated">创建一个目录作为Postgres数据文件的本地主机挂载点</h2><p id="183b" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">如果我们希望在容器的生命周期之外持久化容器内运行的Postgres实例生成的数据，我们需要将本地挂载点作为数据卷映射到容器内的适当路径。通常，我会在我的<em class="kf"> home </em>目录中创建一个<em class="kf"> volumes </em>文件夹(我们可以给这个文件夹起任何我们喜欢的名字),然后为我需要为其创建数据卷挂载点的每个应用程序创建子文件夹。</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="28c9" class="kn ko hu ls b fv lw lx l ly lz">mkdir -p $HOME/docker/volumes/postgres</span></pre><h2 id="dc17" class="kn ko hu bd kp kq kr ks kt ku kv kw kx js ky kz la jw lb lc ld ka le lf lg lh dt translated">运行Postgres容器</h2><p id="ca90" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">启动Postgres容器就像运行<em class="kf"> docker run </em>命令一样简单</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="e7a2" class="kn ko hu ls b fv lw lx l ly lz">docker run --rm   --name pg-docker -e POSTGRES_PASSWORD=docker -d -p 5432:5432 -v $HOME/docker/volumes/postgres:/var/lib/postgresql/data  postgres</span></pre><p id="550b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们为<em class="kf"> docker run </em>命令提供了几个选项:</p><ul class=""><li id="e062" class="ma mb hu jj b jk jl jo jp js mc jw md ka me ke mf mg mh mi dt translated"><em class="kf"> — rm </em>:退出时自动移除容器及其关联的文件系统。一般来说，如果我们运行大量短期容器，将<em class="kf"> rm </em>标志传递给<em class="kf"> docker run </em>命令进行自动清理并避免磁盘空间问题是一个很好的实践。我们总是可以使用<em class="kf"> v </em>选项(如下所述)在容器的生命周期之外持久保存数据</li><li id="a2d7" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated"><em class="kf"> —名称:</em>集装箱的识别名称。我们可以选择任何我们想要的名字。请注意，两个现有的(即使已停止)容器不能同名。为了重用某个名称，您需要将<em class="kf"> rm </em>标志传递给<em class="kf"> docker run </em>命令，或者使用<em class="kf"> docker rm【容器名称】命令显式删除容器。</em></li><li id="ec17" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated"><em class="kf"> -e: </em>将名为<em class="kf"> POSTGRES_PASSWORD </em>值为<em class="kf"> docker </em>的环境变量暴露给容器。此环境变量设置PostgreSQL的超级用户密码。我们可以将<em class="kf"> POSTGRES_PASSWORD </em>设置为我们喜欢的任何值。我就选它做<em class="kf"> docker </em>做演示。您还可以设置其他环境变量。其中包括<em class="kf"> POSTGRES_USER </em>和<em class="kf"> POSTGRES_DB。POSTGRES_USER </em>设置超级用户名。如果未提供，超级用户名默认为<em class="kf"> postgres。</em> <em class="kf"> POSTGRES_DB </em>设置要设置的默认数据库的名称。如果没有提供，则默认为<em class="kf"> POSTGRES_USER的值。</em></li><li id="4089" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated"><em class="kf"> -d: </em>以分离模式或换句话说，在后台启动容器。</li><li id="5816" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated"><em class="kf"> -p </em>:将本地主机上的端口5432绑定到容器内的端口5432。该选项使运行在容器外的应用程序能够连接到运行在容器内的Postgres服务器。</li><li id="1bc4" class="ma mb hu jj b jk mj jo mk js ml jw mm ka mn ke mf mg mh mi dt translated"><em class="kf"> -v </em>:将主机上的$HOME/docker/volumes/postgres挂载到容器内创建的容器端卷路径/var/lib/postgresql/data。这确保了postgres数据即使在容器被移除后仍然存在。</li></ul><h2 id="1403" class="kn ko hu bd kp kq kr ks kt ku kv kw kx js ky kz la jw lb lc ld ka le lf lg lh dt translated">连接到Postgres</h2><p id="3b36" class="pw-post-body-paragraph jh ji hu jj b jk li jm jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">一旦容器启动并运行，从应用程序连接到它与连接到docker容器外运行的Postgres实例没有什么不同。例如，要使用<em class="kf"> psql </em>进行连接，我们可以执行</p><pre class="ln lo lp lq fq lr ls lt lu aw lv dt"><span id="f892" class="kn ko hu ls b fv lw lx l ly lz">psql -h localhost -U postgres -d postgres</span></pre><p id="aac5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">希望这篇文章展示了在docker中使用Postgres是多么容易和简单。对于大多数其他应用程序，这个过程也很简单。所以下一次你需要安装一个软件的时候，在你使用<em class="kf"> brew install、yum install、apt-get install </em>或者任何你的系统包管理器的命令之前，想想<em class="kf"> docker pull </em></p><figure class="ln lo lp lq fq iv"><div class="bz el l di"><div class="mo mp l"/></div></figure></div></div>    
</body>
</html>