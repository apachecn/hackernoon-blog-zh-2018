<html>
<head>
<title>S3 trickery, using it as a scheduler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">S3的诡计，用它作为调度程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/s3-trickery-using-it-as-a-scheduler-c618103b1cf2?source=collection_archive---------11-----------------------#2018-09-04">https://medium.com/hackernoon/s3-trickery-using-it-as-a-scheduler-c618103b1cf2?source=collection_archive---------11-----------------------#2018-09-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/5abbcddcb6dcced0d29d2cf71ff00f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oDNpfCAX7k5-_gsW"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">“March calendar” by <a class="ae jg" href="https://unsplash.com/@charlesdeluvio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Charles Deluvio 🇵🇭🇨🇦</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2126" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">使用<a class="ae jg" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>的一个有趣之处在于，你可以尝试新的想法，然后弹指一挥间就能提供这些想法。我不止一次提到s3是一个强大的工具，它不仅仅是一个弹性持久层。</p><div class="kf kg fm fo kh ki"><a href="https://hackernoon.com/s3-the-best-of-2-worlds-92576f23c000" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">S3两个世界中最好的</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">S3不仅仅可以用来存储数据。查看扩展其功能的新方法。</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">hackernoon.com</p></div></div><div class="kr l"><div class="ks l kt ku kv kr kw ja ki"/></div></div></a></div><p id="5f34" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这篇文章中，我将演示如何使用s3作为调度机制来执行各种任务。</p><h1 id="3f4f" class="kx ky hu bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">概观</h1><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lv"><img src="../Images/aeb3407c3c282688b9f23bd92d59f919.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*8_iclxSZ_B6M--uGXkNp0Q.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Simple S3 flow</figcaption></figure><p id="8b83" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">S3和一个λ函数一起创建了一个简单的事件基础流。例如，将Lambda附加到s3 PUT事件并创建一个新文件，然后调用Lambda函数。要创建一个调度事件，您所要做的就是编写您想要在指定时间执行的文件；然而，AWS使您能够使用cron或rate expression 仅创建重复发生的<a class="ae jg" href="https://docs.aws.amazon.com/lambda/latest/dg/tutorial-scheduled-events-schedule-expressions.html" rel="noopener ugc nofollow" target="_blank">事件。当您想要安排一次性事件时会发生什么情况？你被卡住了。</a></p><p id="94e8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">s3-scheduler库使您能够做到这一点。具体来说，它使用s3作为调度机制，使您能够调度一次性事件。</p><h2 id="bac2" class="ma ky hu bd kz mb mc md ld me mf mg lh js mh mi ll jw mj mk lp ka ml mm lt mn dt translated">它是如何工作的</h2><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/dbcfb48a7fcc3e7870253763feb48c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*9ZApM13Gq9OyobtKmdlZkg.png"/></div></figure><p id="3b1e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">每个事件都是一个单独的文件。在后台，库使用循环机制每1分钟唤醒一次，使用s3的<a class="ae jg" href="https://boto3.readthedocs.io/en/latest/guide/collections.html" rel="noopener ugc nofollow" target="_blank">过滤功能</a>扫描相关文件，如果预定时间已过，则将文件移动到相关的bucket + key。</p><p id="3f46" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了正常运行，图书馆必须知道三个问题的答案:</p><ol class=""><li id="04b5" class="mp mq hu jj b jk jl jo jp js mr jw ms ka mt ke mu mv mw mx dt translated">要保存什么内容，</li><li id="3056" class="mp mq hu jj b jk my jo mz js na jw nb ka nc ke mu mv mw mx dt translated">保存位置(桶+键)→将触发适当的Lambda函数，并且</li><li id="c03c" class="mp mq hu jj b jk my jo mz js na jw nb ka nc ke mu mv mw mx dt translated">何时将其移至合适的铲斗。</li></ol><h2 id="0384" class="ma ky hu bd kz mb mc md ld me mf mg lh js mh mi ll jw mj mk lp ka ml mm lt mn dt translated">编码细节</h2><p id="d278" class="pw-post-body-paragraph jh ji hu jj b jk nd jm jn jo ne jq jr js nf ju jv jw ng jy jz ka nh kc kd ke hn dt translated">要保存的内容保持不变，第2点和第3点(见上文)被编码在密钥的名称中，并使用<code class="eh ni nj nk nl b">|</code>作为各部分之间的分隔符。例如，要将8月5日的相关内容复制到一个名为<code class="eh ni nj nk nl b">s3-bucket</code>的桶和一个名为<code class="eh ni nj nk nl b">s3_important_files</code>的文件夹中，调度程序将生成以下文件:<code class="eh ni nj nk nl b">2018–08–05|s3-bucket|s3_files-important</code>。通过将元数据保留在实际内容之外，我们获得了以下好处:</p><ul class=""><li id="4054" class="mp mq hu jj b jk jl jo jp js mr jw ms ka mt ke nm mv mw mx dt translated">它加快了复制过程，而无需阅读全部内容来决定何时何地进行复制。</li><li id="560c" class="mp mq hu jj b jk my jo mz js na jw nb ka nc ke nm mv mw mx dt translated">它允许内容是二进制的，而不仅仅是基于文本的。</li><li id="24e0" class="mp mq hu jj b jk my jo mz js na jw nb ka nc ke nm mv mw mx dt translated">通过使用s3过滤功能，降低了获取正确文件的成本。</li><li id="7d48" class="mp mq hu jj b jk my jo mz js na jw nb ka nc ke nm mv mw mx dt translated">有更容易的调试；只需查看文件名即可了解何时何地复制。</li></ul><h1 id="1d3b" class="kx ky hu bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">基本用法</h1><h2 id="0496" class="ma ky hu bd kz mb mc md ld me mf mg lh js mh mi ll jw mj mk lp ka ml mm lt mn dt translated">装置</h2><p id="74c0" class="pw-post-body-paragraph jh ji hu jj b jk nd jm jn jo ne jq jr js nf ju jv jw ng jy jz ka nh kc kd ke hn dt translated"><code class="eh ni nj nk nl b">pip install s3-scheduler</code></p><h2 id="2bc8" class="ma ky hu bd kz mb mc md ld me mf mg lh js mh mi ll jw mj mk lp ka ml mm lt mn dt translated">设置循环流程</h2><p id="35de" class="pw-post-body-paragraph jh ji hu jj b jk nd jm jn jo ne jq jr js nf ju jv jw ng jy jz ka nh kc kd ke hn dt translated">该库使用AWS内置功能每1分钟运行一次。配置取决于您的框架。例如，对于Zappa，请使用以下内容:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="nn no l"/></div></figure><h2 id="ac3e" class="ma ky hu bd kz mb mc md ld me mf mg lh js mh mi ll jw mj mk lp ka ml mm lt mn dt translated">行程安排</h2><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="5890" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在初始化期间，调度程序需要存储桶和保存实际调度细节的文件夹。请记住，每个事件都是一个单独的文件；因此，有必要将它们保存在某个地方。何时调度是一个简单的<code class="eh ni nj nk nl b">datetime</code>对象。</p><h2 id="8d43" class="ma ky hu bd kz mb mc md ld me mf mg lh js mh mi ll jw mj mk lp ka ml mm lt mn dt translated">填料</h2><p id="a486" class="pw-post-body-paragraph jh ji hu jj b jk nd jm jn jo ne jq jr js nf ju jv jw ng jy jz ka nh kc kd ke hn dt translated">如果要在计划事件发生之前取消它，请执行以下操作:</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="nn no l"/></div></figure><h1 id="2033" class="kx ky hu bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">鳍状物</h1><p id="8e4f" class="pw-post-body-paragraph jh ji hu jj b jk nd jm jn jo ne jq jr js nf ju jv jw ng jy jz ka nh kc kd ke hn dt translated">在AWS <a class="ae jg" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>世界中的调度有点棘手。目前，<a class="ae jg" href="https://hackernoon.com/tagged/aws" rel="noopener ugc nofollow" target="_blank"> AWS </a>只提供类似cron的功能，但是这篇文章展示了一种可以用来创建更健壮的调度功能的技术。</p><h1 id="c83f" class="kx ky hu bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">阅读“来自战壕”系列</h1><ul class=""><li id="1350" class="mp mq hu jj b jk nd jo ne js np jw nq ka nr ke nm mv mw mx dt translated"><a class="ae jg" href="https://hackernoon.com/serverless-testing-from-the-trenches-790e77301c74" rel="noopener ugc nofollow" target="_blank">从战壕进行无服务器测试</a></li><li id="6184" class="mp mq hu jj b jk my jo mz js na jw nb ka nc ke nm mv mw mx dt translated"><a class="ae jg" href="https://hackernoon.com/serverless-multi-cloud-from-the-trenches-50a615ba234c" rel="noopener ugc nofollow" target="_blank">来自战壕的无服务器多云</a></li><li id="5dd7" class="mp mq hu jj b jk my jo mz js na jw nb ka nc ke nm mv mw mx dt translated">无服务器环境中的开发流程——请跟随我获取最新消息</li></ul><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="ns no l"/></div></figure></div></div>    
</body>
</html>