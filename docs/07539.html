<html>
<head>
<title>A crash course on Serverless with AWS — Triggering Lambda with SNS Messaging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS无服务器速成班——用SNS消息触发Lambda</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-crash-course-on-serverless-with-aws-triggering-lambda-with-sns-messaging-bc17d9f81ca2?source=collection_archive---------21-----------------------#2018-09-04">https://medium.com/hackernoon/a-crash-course-on-serverless-with-aws-triggering-lambda-with-sns-messaging-bc17d9f81ca2?source=collection_archive---------21-----------------------#2018-09-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/60e8c8aa29cc4ca2b89109bd0b2f5926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*koaEU3j-zfOD3OtOhYy1hA.jpeg"/></div></div></figure><div class=""/><p id="e416" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你像我一样，对事件驱动编程着迷，你会想继续阅读。今天我们来看看如何从<a class="ae ka" href="https://aws.amazon.com/sns/" rel="noopener ugc nofollow" target="_blank"> AWS SNS </a>消息中触发<a class="ae ka" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>功能。我已经讨论了一些关于无服务器架构和AWS的有趣话题，但是还没有这样的。往下挖，准备好。我们走吧。</p><h1 id="8610" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">TL；速度三角形定位法(dead reckoning)</h1><ul class=""><li id="c792" class="kz la if je b jf lb jj lc jn ld jr le jv lf jz lg lh li lj dt translated">我们在建造什么？</li><li id="7320" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">什么是AWS SNS？</li><li id="5d71" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">用<a class="ae ka" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>构建API</li><li id="4db9" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">将API部署到<a class="ae ka" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a></li><li id="26fa" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">用<a class="ae ka" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>测试API</li></ul><p id="1867" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> <em class="lp">注意</em> </strong> <em class="lp">:如果你想马上查看最终结果，本教程的所有</em> <a class="ae ka" href="https://github.com/adnanrahic/lambda-sns-dlq-error-handling" rel="noopener ugc nofollow" target="_blank"> <em class="lp">代码都已经在GitHub </em> </a> <em class="lp">上了。</em></p><h1 id="c9b7" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">我们在建造什么？</h1><p id="59f5" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">我们将只关注创建我们的应用程序所需的基础设施组件的步骤。代码本身将只是模拟随机复杂计算的行为。我选择了一个递归函数来计算传递给它的数字的阶乘。这里有一个很好的图表，因为图表当然很棒！</p><figure class="lu lv lw lx fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lt"><img src="../Images/42a9f728201d41c59268901d8e092cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aQ7KauOeovC-skyd.png"/></div></div></figure><p id="9eaa" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ly lz ma mb b">init</code>函数是唯一公开的函数，它被挂接到<a class="ae ka" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> API网关</a>。它接受一个单独的<code class="eh ly lz ma mb b">number</code>参数进行验证，成功后，它发布一个SNS主题并发送<code class="eh ly lz ma mb b">number</code>值。</p><p id="4149" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">SNS话题会触发第二个功能叫做<code class="eh ly lz ma mb b">calculate</code>。该函数将执行计算并将结果记录到控制台。这模拟了繁重的计算后台任务，如数据处理、图像处理或机器学习计算。</p><p id="9b8e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果<code class="eh ly lz ma mb b">calculate</code>功能失败，死信队列SNS话题会收到消息并触发<code class="eh ly lz ma mb b">error</code>功能。</p><p id="b066" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">每个被异步调用<strong class="je ig">的函数</strong>在失败后会重试执行两次。将死信队列用作错误日志池是一个明智的用例。</p><p id="919c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在你可能想知道，为什么SNS会如此复杂，而不是用<a class="ae ka" href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Lambda.html#invoke-property" rel="noopener ugc nofollow" target="_blank"> lambda的调用API </a>从第一个Lambda函数中调用第二个函数？</p><p id="4517" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，对于异步工作流来说，这是一个巨大的反模式，这就是我们的情况。否则，如果您立即需要第二个lambda函数的响应，也没问题。另一个问题是很快达到Lambda的并发限制。这可能导致调用丢失和数据丢失。通过SNS之类的发布/订阅服务或者像<a class="ae ka" href="https://aws.amazon.com/sqs/" rel="noopener ugc nofollow" target="_blank"> SQS </a>之类的队列发送数据将确保数据的完整性。</p><p id="f81e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在有意义了？太好了，让我们再多谈谈社交网络。</p><h1 id="3c1a" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是AWS SNS？</h1><p id="4afb" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">在我们开始编码之前，我们需要了解一些基础知识。我们知道AWS Lambda是什么，但是SNS呢？AWS文档非常简单。</p><blockquote class="mc"><p id="6565" class="md me if bd mf mg mh mi mj mk ml jz ek translated"><em class="mm">亚马逊简单通知服务(SNS)是一种灵活、完全托管的</em> <a class="ae ka" href="https://aws.amazon.com/pub-sub-messaging/" rel="noopener ugc nofollow" target="_blank"> <em class="mm">发布/订阅消息</em> </a> <em class="mm">和移动通知服务，用于协调向订阅端点和客户端的消息传递。</em></p><p id="6b7e" class="md me if bd mf mg mh mi mj mk ml jz ek translated">- AWS文档</p></blockquote><p id="766a" class="pw-post-body-paragraph jc jd if je b jf mn jh ji jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz hn dt translated">在英语中，这意味着它是一种基于发布者/订阅者在服务之间发送通知的方式。一个服务发布关于一个<strong class="je ig">主题</strong>的一些数据，并沿其路径发送。然后，社交网络会将它传递给该特定<strong class="je ig">主题</strong>的所有订阅者。重点放在<strong class="je ig">主题</strong>这里，你会看到为什么有点深入。</p><h1 id="b1dc" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">用无服务器框架构建API</h1><p id="0faf" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">一如既往，首先要做的是设置项目并安装依赖项。</p><h2 id="ce7e" class="ms kc if bd kd mt mu mv kh mw mx my kl jn mz na kp jr nb nc kt jv nd ne kx nf dt translated">1.安装无服务器框架</h2><p id="c2a9" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">我开发和部署无服务器应用的首选工具是<a class="ae ka" href="https://serverless.com/framework/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>。让我们继续安装它。</p><pre class="lu lv lw lx fq ng mb nh ni aw nj dt"><span id="3378" class="ms kc if mb b fv nk nl l nm nn">$ npm i -g serverless</span></pre><p id="2af0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意: <em class="lp">如果你使用的是Linux，你可能需要以sudo的身份运行这个命令。</em></p><p id="0ee7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦全局安装到您的机器上，您就可以在终端的任何地方使用这些命令。但是为了让它与您的AWS帐户通信，您需要配置一个IAM用户。跳过<a class="ae ka" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html" rel="noopener ugc nofollow" target="_blank">这里的解释</a>，然后返回并使用提供的键运行下面的命令。</p><pre class="lu lv lw lx fq ng mb nh ni aw nj dt"><span id="903c" class="ms kc if mb b fv nk nl l nm nn">$ serverless config credentials \ <br/>    --provider aws \ <br/>    --key xxxxxxxxxxxxxx \ <br/>    --secret xxxxxxxxxxxxxx</span></pre><p id="c8ce" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，当您运行任何终端命令时，您的无服务器安装知道要连接到哪个帐户。让我们来看看它是如何工作的。</p><h2 id="d82d" class="ms kc if bd kd mt mu mv kh mw mx my kl jn mz na kp jr nb nc kt jv nd ne kx nf dt translated">2.创建服务</h2><p id="719c" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">创建一个新目录来存放您的无服务器应用程序服务。在那里启动一个终端。现在您已经准备好创建一个新的服务了。</p><p id="3e40" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">什么是服务？就像一个项目。在这里，您可以定义AWS Lambda函数、触发它们的事件以及它们所需的任何AWS基础设施资源，包括我们今天将添加的SNS，所有这些都在一个名为<strong class="je ig"> serverless.yml </strong>的文件中。</p><p id="bc1c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">回到您的终端，键入:</p><pre class="lu lv lw lx fq ng mb nh ni aw nj dt"><span id="cadb" class="ms kc if mb b fv nk nl l nm nn">$ serverless create \<br/>    --template aws-nodejs \<br/>    --path lambda-sns-dlq-error-handling</span></pre><p id="e423" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">create命令将创建一个新的<strong class="je ig">服务</strong>。真是惊喜！我们还为函数选择了一个运行时。这被称为<strong class="je ig">模板</strong>。传入<code class="eh ly lz ma mb b">aws-nodejs</code>会将运行时设置为Node.js .这正是我们想要的。<strong class="je ig">路径</strong>将为服务创建一个文件夹。</p><h2 id="cfdd" class="ms kc if bd kd mt mu mv kh mw mx my kl jn mz na kp jr nb nc kt jv nd ne kx nf dt translated">3.使用代码编辑器浏览服务目录</h2><p id="397c" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">用你最喜欢的代码编辑器打开<strong class="je ig">lambda-SNS-dlq-error-handling</strong>文件夹。这里应该有三个文件，但是现在，我们只关注<strong class="je ig"> serverless.yml </strong>。它包含此服务的所有配置设置。您可以在这里指定常规配置设置和每个功能的设置。您的<strong class="je ig"> serverless.yml </strong>将充满样板代码和注释。请随意删除它，并粘贴这个。</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="no np l"/></div></figure><p id="6301" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们来分析一下这里的情况。查看<code class="eh ly lz ma mb b">functions</code>部分。这里有三个功能。从上到下依次是<code class="eh ly lz ma mb b">init</code>、<code class="eh ly lz ma mb b">calculate</code>和<code class="eh ly lz ma mb b">error</code>。<code class="eh ly lz ma mb b">init</code>函数将由一个简单的HTTP请求触发，我们通过API Gateway调用该请求。我们熟悉的领域。</p><p id="404b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是，<code class="eh ly lz ma mb b">calculate</code>和<code class="eh ly lz ma mb b">error</code>功能是由SNS话题触发的。这意味着我们将在<code class="eh ly lz ma mb b">init</code>函数中拥有逻辑，它将<strong class="je ig">向名为<code class="eh ly lz ma mb b">calculate-topic</code>的主题发布</strong>消息，而<code class="eh ly lz ma mb b">calculate</code>函数则为同一主题订阅<strong class="je ig">。</strong></p><p id="1b90" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">继续,<code class="eh ly lz ma mb b">error</code>函数订阅了<code class="eh ly lz ma mb b">dlq-topic</code>,而<code class="eh ly lz ma mb b">calculate</code>函数将在失败时向该主题发布消息，正如您在<code class="eh ly lz ma mb b">onError</code>属性中看到的。现在事情有意义了，对吧？</p><p id="f80e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请记住，一旦您将SNS主题作为事件添加到您的功能中，资源将在您部署服务时自动创建。</p><p id="d3b7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">还有什么，看一下<code class="eh ly lz ma mb b">iamRoleStatements</code>，它们指定我们的函数有权限触发，并被SNS主题调用。而<code class="eh ly lz ma mb b">serverless-pseudo-parameters</code>插件让我们用CloudFormation语法引用我们的<code class="eh ly lz ma mb b">AccountId</code>和<code class="eh ly lz ma mb b">Region</code>，这使得在所有资源中保持我们的SNS ARNs一致变得容易得多。</p><h2 id="73ba" class="ms kc if bd kd mt mu mv kh mw mx my kl jn mz na kp jr nb nc kt jv nd ne kx nf dt translated">4.安装依赖项</h2><p id="8579" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">幸运的是，这部分会很短。只需安装一个软件包。首先，初始化npm，然后你可以安装<code class="eh ly lz ma mb b">serverless-pseudo-parameters</code>。</p><pre class="lu lv lw lx fq ng mb nh ni aw nj dt"><span id="07b8" class="ms kc if mb b fv nk nl l nm nn">$ npm init -y &amp;&amp; npm i serverless-pseudo-parameters</span></pre><p id="6ce9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">那就行了。</p><h2 id="6f40" class="ms kc if bd kd mt mu mv kh mw mx my kl jn mz na kp jr nb nc kt jv nd ne kx nf dt translated">5.编写业务逻辑</h2><p id="7495" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">考虑到所有的事情，配置过程相当简单。我们现在要写的代码同样简单明了。没什么特别的，很抱歉让你失望了。</p><p id="b00a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了简单起见，让我们将这三个函数放在不同的文件中。首先创建一个<strong class="je ig"> init.js </strong>文件并粘贴这个片段。</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="no np l"/></div></figure><p id="1d37" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们有几个助手函数和底部导出的lambda函数。这是怎么回事？lambda验证输入并将一些数据发布到<code class="eh ly lz ma mb b">calculate-topic</code> SNS主题。这就是这个函数所做的一切。<code class="eh ly lz ma mb b">calculate-topic</code> SNS话题会触发<code class="eh ly lz ma mb b">calculate</code> lambda功能。现在我们来补充一下。</p><p id="778e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建一个文件，命名为<strong class="je ig"> calculate.js </strong>。将此片段粘贴到。</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="no np l"/></div></figure><p id="f877" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如你所见，这只是一个用递归函数实现的简单阶乘计算。它将从<code class="eh ly lz ma mb b">init</code>函数中计算我们发布到SNS主题的数字的阶乘。</p><p id="8e99" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里需要注意的一点是，如果<code class="eh ly lz ma mb b">calculate</code>函数总共失败三次，它将向死信队列SNS主题发布消息，我们在<strong class="je ig"> serverless.yml </strong>文件中用<code class="eh ly lz ma mb b">onError</code>属性指定了该主题。死信队列将触发<code class="eh ly lz ma mb b">error</code>功能。让我们现在创建它，以便它可以将错误记录到CloudWatch。创建一个<strong class="je ig"> error.js </strong>文件，并将这些行粘贴进去。</p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="no np l"/></div></figure><p id="ecd9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">目前，这就够了。然而，理想情况下，您应该已经用关于正在发生的一切的详细信息构建了日志记录。这是另一篇文章的主题。</p><h1 id="62f4" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">将API部署到AWS Lambda</h1><p id="99f6" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">简单的部分来了。部署API就像运行一个命令一样简单。</p><pre class="lu lv lw lx fq ng mb nh ni aw nj dt"><span id="9e6a" class="ms kc if mb b fv nk nl l nm nn">$ serverless deploy</span></pre><figure class="lu lv lw lx fq hw fe ff paragraph-image"><div class="fe ff nq"><img src="../Images/cace2dfe36f77c241accaebe4db069e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/0*b6gy7inbaQ6PwmH9.png"/></div></figure><p id="5d50" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以看到端点被记录到控制台。这是您发送请求的地方。</p><h1 id="d1c2" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">用Dashbird测试API</h1><p id="5fd2" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">测试API最简单的方法是使用CURL。让我们创建一个简单的CURL命令，并向端点发送一个JSON有效负载。</p><pre class="lu lv lw lx fq ng mb nh ni aw nj dt"><span id="193b" class="ms kc if mb b fv nk nl l nm nn">$ curl -H "Content-Type: application/json" \<br/>    -d '{"number":1000}' \<br/>    https://&lt;id&gt;.execute-api.eu-central-1.amazonaws.com/dev/init</span></pre><p id="bacf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果一切正常，计算结果将被记录到CloudWatch中。如果不是，那么你就不走运了。在这种情况下，我默认使用<a class="ae ka" href="https://dashbird.io/register/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>来调试正在发生的事情。它是免费的，不需要信用卡来设置。</p><p id="061a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在用几个不同的值到达端点几次后，结果如下。<code class="eh ly lz ma mb b">init</code>功能按预期工作。</p><figure class="lu lv lw lx fq hw fe ff paragraph-image"><div class="fe ff nr"><img src="../Images/854b3a50436fe5f3ddea5825a8ef543f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*wYg1oxrEnguiFj4l.gif"/></div></figure><p id="e438" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是，真正让我们感兴趣的是<code class="eh ly lz ma mb b">calculate</code>函数。这是它成功时的样子。</p><figure class="lu lv lw lx fq hw fe ff paragraph-image"><div class="fe ff nr"><img src="../Images/2fa61eef56a682708cac47e398c0e924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*6LaBbc9YZ6o51SlC.gif"/></div></figure><p id="d92e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当失败时，它会指定一个崩溃，并显示错误日志。</p><figure class="lu lv lw lx fq hw fe ff paragraph-image"><div class="fe ff nr"><img src="../Images/2594c1c13ece02a9997de76a0d36b3c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*GvwTylBvdztvBtzL.gif"/></div></figure><p id="7afb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">经过两次重试后，它会向死信队列发送一条消息，并触发<code class="eh ly lz ma mb b">error</code>功能。</p><figure class="lu lv lw lx fq hw fe ff paragraph-image"><div class="fe ff nr"><img src="../Images/269c12480411cb296105a2658622b708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*r8Wb51YnYBdzjMBX.gif"/></div></figure><p id="16e7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太棒了。我们已经测试了所有不同的场景。希望这能澄清一些事情。</p><h1 id="e38c" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">包扎</h1><p id="cc85" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz hn dt translated">这是所有的乡亲。我们已经介绍了如何为Lambda创建SNS触发器，同时还实现了一个死信队列来捕获失败调用中的错误。使用无服务器进行各种间歇性计算是一种有效的用例，将来只会越来越受欢迎。</p><p id="1641" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">没有你需要担心的服务器，你只为它运行的时间付费。只需部署代码，并保证它会工作。如果有什么东西坏了，你有Dashbird在背后看着你，如果有什么不对劲，它会通过Slack或电子邮件提醒你。你只需要热爱Slack集成！</p><figure class="lu lv lw lx fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ns"><img src="../Images/d6cef46a39b09d2fe4a48214dc81299d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vlPZYANYGssQJylT.png"/></div></div></figure><p id="a282" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">同样，如果你想看看代码，这里是GitHub repo 。在您需要SNS消息触发lambda功能的情况下，它可以作为您自己用例的开端。如果你喜欢它，并希望更多人在GitHub上看到它，请给它一颗星。</p><p id="c114" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你想阅读我以前的一些无服务器思考，请前往<a class="ae ka" rel="noopener" href="/@adnanrahic">我的简介</a>或<a class="ae ka" href="https://upscri.be/b6f3d5/" rel="noopener ugc nofollow" target="_blank">加入我的时事通讯！</a></p><figure class="lu lv lw lx fq hw"><div class="bz el l di"><div class="nt np l"/></div></figure><p id="e6f6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">或者，马上看看我的几篇文章:</p><ul class=""><li id="14fc" class="kz la if je b jf jg jj jk jn nu jr nv jv nw jz lg lh li lj dt translated"><a class="ae ka" href="https://hackernoon.com/a-crash-course-on-serverless-side-rendering-with-vue-js-nuxt-js-and-aws-lambda-fbfaad80aa25" rel="noopener ugc nofollow" target="_blank">关于使用Vue.js、Nuxt.js和AWS Lambda进行无服务器端渲染的速成课程</a></li><li id="1c5c" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://hackernoon.com/building-a-serverless-contact-form-with-aws-lambda-and-aws-ses-fbf01d523678" rel="noopener ugc nofollow" target="_blank">使用AWS Lambda和AWS SES构建无服务器联系表单</a></li><li id="05cd" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">【Express和MongoDB的无服务器API速成班</li><li id="bb6f" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://hackernoon.com/solving-invisible-scaling-issues-with-serverless-and-mongodb-1a065b5a6465" rel="noopener ugc nofollow" target="_blank">使用无服务器和MongoDB解决不可见的伸缩问题</a></li><li id="a60d" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://hackernoon.com/how-to-deploy-a-node-js-application-to-aws-lambda-using-serverless-ae7e7ebe0996" rel="noopener ugc nofollow" target="_blank">如何使用无服务器将Node.js应用程序部署到AWS Lambda</a></li><li id="68fa" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://hackernoon.com/getting-started-with-aws-lambda-and-node-js-4ce3259c6dfd" rel="noopener ugc nofollow" target="_blank">AWS Lambda和Node.js入门</a></li><li id="01e2" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://medium.freecodecamp.org/a-crash-course-on-securing-serverless-apis-with-json-web-tokens-ff657ab2f5a5" rel="noopener ugc nofollow" target="_blank">用JSON web令牌保护无服务器API的速成班</a></li><li id="c885" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://hackernoon.com/migrating-your-node-js-rest-api-to-serverless-d2a170e0856c" rel="noopener ugc nofollow" target="_blank">将Node.js REST API迁移到无服务器</a></li><li id="faa6" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://hackernoon.com/building-a-serverless-rest-api-with-node-js-and-mongodb-2e0ed0638f47" rel="noopener ugc nofollow" target="_blank">用Node.js和MongoDB构建无服务器REST API</a></li><li id="01b6" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated"><a class="ae ka" href="https://hackernoon.com/a-crash-course-on-serverless-with-node-js-632b37d58b44" rel="noopener ugc nofollow" target="_blank">node . js无服务器速成班</a></li></ul><p id="dca9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">希望你们喜欢读这篇文章，就像我喜欢写这篇文章一样。如果你喜欢的话，拍一下那个小小的拍手，这样更多的人会在Medium上看到这个教程。直到下次，保持好奇，玩得开心。</p></div><div class="ab cl nx ny hc nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="hn ho hp hq hr"><p id="f59f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lp">原载于</em><a class="ae ka" href="https://dev.to/adnanrahic/a-crash-course-on-serverless-with-aws---triggering-lambda-with-sns-messaging-30nf" rel="noopener ugc nofollow" target="_blank"><em class="lp">dev . to</em></a><em class="lp">。</em></p></div></div>    
</body>
</html>