<html>
<head>
<title>Strengthening the weakest link in smart contract security — “onlyOwner”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加强智能合同安全中最薄弱的环节——“唯一所有者”</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/strengthening-the-weakest-link-in-smart-contract-security-onlyowner-c390d0e452b4?source=collection_archive---------14-----------------------#2018-09-05">https://medium.com/hackernoon/strengthening-the-weakest-link-in-smart-contract-security-onlyowner-c390d0e452b4?source=collection_archive---------14-----------------------#2018-09-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4267" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在过去的几年里，# buidlers已经集体部署了价值数百万美元的智能合约。作为一个我自己，我一直意识到整个<a class="ae jp" href="https://hackernoon.com/tagged/blockchain" rel="noopener ugc nofollow" target="_blank">区块链</a>生态系统是如何过度依赖开发商的意图。包括投资者在内的最终用户通常不完全理解智能合约代码，责任显然在于开发者。</p><h1 id="d038" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">权力越大，责任越大</h1><p id="607b" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">通常，智能合约的关键功能被定义为使用“onlyOwner”修饰符来执行。这给聪明的合同所有者留下了巨大的权力来做出改变。这就引出了一个问题，谁应该拥有这样的权力？</p><p id="81d6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">广义地说，权力可以赋予这两者中的任何一个1)以太坊地址或2)智能合约。</p><h2 id="4633" class="kt jr hu bd js ku kv kw jw kx ky kz ka jc la lb ke jg lc ld ki jk le lf km lg dt translated">基于以太坊地址的所有权</h2><p id="efb9" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">在我看来，基于以太坊的所有权从根本上来说是有缺陷的，因为这会导致明显的集中化，由于私钥丢失、利益不一致等原因导致意外代码执行的高风险。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/ffa4ea569c8f3a90bb2f2ff6820e9218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nEksaAQOamhoIHK5uFnmBg.png"/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Bancor Hack 2018 (<a class="ae jp" href="https://www.bankinfosecurity.com/bancor-cryptocurrency-exchange-loses-235-million-a-11188" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><p id="7f2a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当<a class="ae jp" href="https://www.bankinfosecurity.com/bancor-cryptocurrency-exchange-loses-235-million-a-11188" rel="noopener ugc nofollow" target="_blank"> Bancor宣布价值2350万美元的加密资产被黑客钱包</a>窃取时，我们看到了这一后果。他们允许钱包升级他们的智能合同，这使得它成为黑客的目标。它最终被黑了，攻击者设法用这个钱包窃取了Bancor的资产。如果他们通过允许智能合同而不是钱包地址来实现kill switch，这本来是可以避免的。</p><pre class="li lj lk ll fq lx ly lz ma aw mb dt"><span id="237f" class="kt jr hu ly b fv mc md l me mf">contract EthAdressGoverned {</span><span id="7dd6" class="kt jr hu ly b fv mg md l me mf">address public owner;</span><span id="89ef" class="kt jr hu ly b fv mg md l me mf">/**<br/>  * <a class="ae jp" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Constructor sets the original `owner` of the contract to the sender account.<br/>  */<br/>  constructor() public {<br/>    owner = msg.sender;<br/>  }</span><span id="3ca1" class="kt jr hu ly b fv mg md l me mf">/**<br/>  * <a class="ae jp" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Throws if called by any account other than the owner.<br/>  */<br/>  modifier onlyOwner() {<br/>    require(msg.sender == owner);<br/>    _;<br/>  }</span><span id="dcfd" class="kt jr hu ly b fv mg md l me mf">}</span><span id="21fb" class="kt jr hu ly b fv mg md l me mf">}</span></pre><h2 id="ee7b" class="kt jr hu bd js ku kv kw jw kx ky kz ka jc la lb ke jg lc ld ki jk le lf km lg dt translated">基于智能合同的所有权</h2><p id="f9cc" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">基于所有权的智能合约提供了一种不可信的替代方案，然而，它再次归结为由智能合约实现的许可系统。</p><p id="0e0a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意:如果智能合约使用带有ETH地址的“onlyOwner”修饰符作为所有者，我们又回到了起点，给予智能合约许可的目的也就失败了。</strong></p><h1 id="ccb1" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">那么，我们如何解决这个问题呢？</h1><p id="5471" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">在这两种情况下，失败点最终是对单个以太坊地址的授权。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mh"><img src="../Images/e18915217c8d7ed232c8b00438e23ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aJ625I8CkUZFKj6qP5DDgA.png"/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Showcasing the common point of failure in both scenarios</figcaption></figure><p id="4009" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了解决这个问题，我们可以使用1)多重签名智能契约或者2)基于投票驱动的智能契约所有权模型。</p><h2 id="3bf2" class="kt jr hu bd js ku kv kw jw kx ky kz ka jc la lb ke jg lc ld ki jk le lf km lg dt translated">基于所有权的多重签名智能合同</h2><p id="8f4a" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">在过去，项目(例如0x)使用多签名钱包，因为它们易于实现(某种程度上)。多签名钱包需要最低数量的签名来授权交易，然后才能执行交易。这可以防止在帐户被黑的情况下未经授权的执行。</p><p id="8d93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但多重签名钱包的缺点是灵活性较差，而且权力总是掌握在少数人手中。此外，在帐户被黑的情况下，无法执行需要所有签名的关键功能。</p><h2 id="be6e" class="kt jr hu bd js ku kv kw jw kx ky kz ka jc la lb ke jg lc ld ki jk le lf km lg dt translated">基于所有权的投票驱动智能合约</h2><p id="aeac" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">多签名钱包的问题可以通过使用投票驱动的智能合同来定义dApp的所有权和最终治理来解决。我知道围绕链上投票及其可伸缩性相关挑战的大量热烈讨论。虽然我将写另一篇文章来解释我们如何解决这些挑战，但我提出了一种机制，将dApp社区分为多种角色(如顾问委员会、开发人员等)，并将这些角色与可配置的投票阈值和多数百分比相结合。通过这种方式，我们可以为dApps实现灵活且可扩展的决策模型。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mi"><img src="../Images/9da02c8eae3a5048569dbfaa42a71806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r8EcEF0fQCdcAltYis8ckw.png"/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Replacing Ethereum address based ownership with a self-governed smart contract</figcaption></figure><p id="5f7f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，在紧急情况下(如DAO hack)实施kill-switch的决策可以配置为只需要咨询委员会以高多数和低阈值进行投票。然而，撤销紧急状态的决定(在必要的修正之后)可能需要顾问委员会+成员以高多数和高门槛投票。</p><p id="27cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://nexusmutual.io" rel="noopener ugc nofollow" target="_blank"> Nexus Mutual </a>树立了使用基于所有权和治理的投票驱动智能合同的榜样。他们使用<a class="ae jp" href="http://github.com/somish/govblocks-protocol" rel="noopener ugc nofollow" target="_blank"> govblocks-protocol </a>来管理他们的DAO，DAO处理他们智能合约的所有关键功能。<a class="ae jp" rel="noopener" href="/nexus-mutual/dao-governance-a-pragmatic-approach-27d529ad0819">更多关于Nexus Mutual的治理</a> <em class="mj"> </em>模式。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mk"><img src="../Images/cc27e522500d87a66b5fde076d5710ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbKWZPIn69FWzKOw-QfavQ.png"/></div></div></figure><h1 id="9e84" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">单凭这一点，并不能解决问题</h1><p id="37ef" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">尽管有上述解决方案，但仍然存在很高的人为错误/疏忽风险，这可能会无意中导致安全漏洞和相关的财务损失。奇偶校验付出了代价<a class="ae jp" href="https://paritytech.io/security-alert-2/" rel="noopener ugc nofollow" target="_blank">当它的multisig钱包被黑客攻击</a>时，因为他们的图书馆合同没有初始化。任何人都可以成为它的主人并自毁它。因此，所有平价multisig钱包都变得毫无用处，导致514，000 ETH的损失。</p><h2 id="056f" class="kt jr hu bd js ku kv kw jw kx ky kz ka jc la lb ke jg lc ld ki jk le lf km lg dt translated">从过去吸取教训</h2><p id="8edb" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">世界各地的传统公司都是根据各自政府的法律成立的，这些法律要求通过公共登记处以标准格式提交公司注册文件。这对于保持流程的透明度、一致性和标准化至关重要。</p><p id="7a56" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">想象一下，如果今天我们没有一个世界上所有公司的公共注册，这将导致一个不可控制的威胁，即公司听从其所有者的命令，而不对其他利益相关者负责。</p><h2 id="eaba" class="kt jr hu bd js ku kv kw jw kx ky kz ka jc la lb ke jg lc ld ki jk le lf km lg dt translated">对标准化的呼吁</h2><p id="ab31" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">我们将合并dApp的流程标准化(同时保持分散化)如何，这样可以确保最关键步骤的合规性，尤其是所有权？我们一直在政府部门试验这样的想法，这促使我们开发了一个名为T2政府检查员的合同。这个契约就像是某种公共注册中心，只是维护一个dApp v/s的所有者的映射。如前所述，所有者可以是以太坊地址、多重签名钱包或投票驱动的智能契约。</p><p id="38df" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦在<a class="ae jp" href="https://github.com/somish/govblocks-protocol/blob/master/contracts/GovernCheckerContract.sol" rel="noopener ugc nofollow" target="_blank"> GovernChecker </a>契约上注册，dApp就可以在其智能契约中使用"<strong class="it hv"> onlyAuthorizedToGovern </strong>"修饰符，从而带来更高水平的一致性。这个过程很简单，在这里详细介绍<a class="ae jp" href="https://docs.govblocks.io/wiki/start-using-governchecker" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2d02" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们仍然处于实施“代码即法律”思想的早期阶段，我觉得标准化以及更新法律的机制，从实用的角度来说，与首先弄清楚法律一样重要。欢迎在我们的<a class="ae jp" href="https://t.me/govblocks" rel="noopener ugc nofollow" target="_blank">Telegram</a>&amp;<a class="ae jp" href="https://www.reddit.com/r/GovBlocks" rel="noopener ugc nofollow" target="_blank">Reddit</a>社区分享您的想法。</p><p id="8cd2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="mj">感谢</em> <a class="ml mm gr" href="https://medium.com/u/106bb90392d6?source=post_page-----c390d0e452b4--------------------------------" rel="noopener" target="_blank"> <em class="mj">伊什戈埃尔</em> </a> <em class="mj">，</em> <a class="ml mm gr" href="https://medium.com/u/d68d102c6d4d?source=post_page-----c390d0e452b4--------------------------------" rel="noopener" target="_blank"> <em class="mj">卡尔提克拉赫拉</em> </a> <em class="mj">，</em> <a class="ml mm gr" href="https://medium.com/u/aa341296c4be?source=post_page-----c390d0e452b4--------------------------------" rel="noopener" target="_blank"> <em class="mj">穆迪特古普塔</em> </a> <em class="mj">为本文出谋划策。</em></p><figure class="li lj lk ll fq lm"><div class="bz el l di"><div class="mn mo l"/></div></figure></div></div>    
</body>
</html>