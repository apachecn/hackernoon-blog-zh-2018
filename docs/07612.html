<html>
<head>
<title>Deploying the Winds App to Amazon S3 and CloudFront</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Winds应用部署到亚马逊S3和CloudFront</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploying-the-winds-app-to-amazon-s3-and-cloudfront-9652e13fc905?source=collection_archive---------19-----------------------#2018-09-06">https://medium.com/hackernoon/deploying-the-winds-app-to-amazon-s3-and-cloudfront-9652e13fc905?source=collection_archive---------19-----------------------#2018-09-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/b5e5cd0d05a0b2fe6b54ed833949f3e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W0i6zBlmITTD9Tiq-Ovcew.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">https://getstream.io/winds</figcaption></figure><div class=""/><p id="1e65" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><a class="ae ke" href="https://getstream.io/winds" rel="noopener ugc nofollow" target="_blank"> Winds </a>是一款受欢迎的RSS和播客应用，由<a class="ae ke" href="https://getstream.io/try-the-api" rel="noopener ugc nofollow" target="_blank"> Stream </a>提供支持——这项服务可以让你在几个小时内而不是几个月内建立新闻和活动提要。Winds是<a class="ae ke" href="https://github.com/getstream/winds" rel="noopener ugc nofollow" target="_blank"> 100%开源的</a>，前端很容易安装在本地环境或云中——这是我们将在本教程中讨论的任务。为了确保您完成本教程，<em class="kf">请</em>确保完成所有的先决条件。</p><h1 id="775b" class="kg kh ij bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">先决条件📚</h1><p id="b773" class="pw-post-body-paragraph jg jh ij ji b jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz li kb kc kd hn dt translated">与任何教程一样，它也有一些要求。对于这篇文章，您需要确保您已经启动并运行了以下内容，并在继续之前做好了准备。如果你决定跳过这些需求，你很可能会在某个地方停滞不前——我们不希望这种情况发生。</p><ol class=""><li id="433e" class="lj lk ij ji b jj jk jn jo jr ll jv lm jz ln kd lo lp lq lr dt translated">一个AWS账户，通过IAM访问<a class="ae ke" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> S3 </a>和<a class="ae ke" href="https://aws.amazon.com/CloudFront/" rel="noopener ugc nofollow" target="_blank"> CloudFront </a></li><li id="1006" class="lj lk ij ji b jj ls jn lt jr lu jv lv jz lw kd lo lp lq lr dt translated"><a class="ae ke" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>安装在您的机器上并进行配置</li><li id="a080" class="lj lk ij ji b jj ls jn lt jr lu jv lv jz lw kd lo lp lq lr dt translated">将Winds从GitHub的本地目录中克隆出来</li></ol><h1 id="5e37" class="kg kh ij bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">创建桶🗑</h1><p id="52ee" class="pw-post-body-paragraph jg jh ij ji b jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz li kb kc kd hn dt translated">首先，前往AWS上的<a class="ae ke" href="https://console.aws.amazon.com/s3/home" rel="noopener ugc nofollow" target="_blank"> S3控制台</a>创建一个桶。我将把我的桶命名为“winds-2–0-hosted”，不过，你可以随意命名你的桶。单击“下一步”并继续完成这些步骤。我们将更改一些设置，请务必遵守。😀</p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/ccb2030bd3542e3016f85d93b7c18efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rrTQ6In37PDx0a3J"/></div></div></figure><p id="dd4f" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">接下来，在“属性”中，打开“静态网站托管”选项卡并选择“启用网站”。为索引和错误文件填写<strong class="ji ik">index.html</strong>。通过将<strong class="ji ik">index.html</strong>指定为错误文档，我们可以允许react-router处理根之外的路由。</p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/52784c7e9ba7778ae44ecb07b7cbe9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ay50kIthouwwMmMi"/></div></div></figure><p id="561f" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">打开“权限”选项卡并选择“编辑策略”。这里，我们将修改bucket的权限，以确保用户可以查看和加载Winds的内容。可以在下面找到存储桶策略:</p><h1 id="478a" class="kg kh ij bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">设置CloudFront💨</h1><p id="9611" class="pw-post-body-paragraph jg jh ij ji b jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz li kb kc kd hn dt translated">CloudFront是AWS提供的内容交付网络(CDN)服务。cdn通过将您的内容推到世界各地的边缘位置来优化速度，使其在全球范围内高度可用。因为Winds是一个要求相当高的应用程序，并且有很多资源要添加，所以我们将通过CloudFront将其提升到一个新的水平。</p><p id="d14f" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">让我们继续设置CloudFront。设置完成后，我们将把它指向我们在上一步中创建的S3存储桶。</p><p id="2a1c" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">要开始，前往<a class="ae ke" href="https://console.aws.amazon.com/cloudfront/home" rel="noopener ugc nofollow" target="_blank"> CloudFront控制台</a>并点击“创建发行版”。您将看到以下屏幕。在“网络”部分选择“开始”。</p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/c853c315bd7d0ae1ae47b5f752a0306e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ocfPbe85RrhKOf0Y"/></div></div></figure><p id="8154" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在名为“源域名”的下拉列表中，选择之前创建的S3存储桶。在我们的例子中，它将被命名为“winds-2–0-hosted . S3 . Amazon AWS . com”。</p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/48cb3fc4606d45607514e021d77ec671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l3s2xygqFYZrKcrS"/></div></div></figure><p id="fdde" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">其余设置将预先填入正确的值，因此滚动到底部并单击“创建分配”。您的发行版将需要几分钟的时间来生成，所以请耐心等待。</p><p id="312f" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">生成之后，单击CloudFront发行版，然后单击“distribution”选项卡。一旦加载完毕，点击“编辑”按钮，将“默认根对象”设置为index.html的<strong class="ji ik">并点击底部的“是，编辑”按钮。</strong></p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/8dc30b39af814d0fa32ad77ee1bf051f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g9JYL4n19uNHeiXa"/></div></div></figure><p id="8bd9" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在，单击您新创建的发行版的ID以到达它的设置页面，然后单击“错误页面”选项卡。选择“创建自定义错误响应”。为自定义错误响应选择“是”，为“响应页面路径”设置“/index.html”，为“HTTP响应代码”设置“200: OK”。CloudFront发行版中的这个定制错误页面类似于S3 bucket上的错误文档。完成后，单击创建。</p><p id="cabd" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">您还需要创建第二个错误页面，这一次将“HTTP错误代码”设置为“404”，将“响应页面路径”路径设置为“/index.html”(再次)，将“HTTP响应代码”设置为“200: OK”。</p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/77146f2e1dd4fa79934990ada87eba9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y7NGC9FqEXZmuSnp"/></div></div></figure><p id="1377" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">完成后，回到设置界面，点击“行为”标签。单击“创建行为”并选择“重定向HTTP到HTTPS”以强制所有流量到HTTPS，以及“允许的HTTP方法”以“获取、标题、选项、上传、发布、修补和删除”。然后点击底部的“是，编辑”。</p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/80d08d2a236925baba5a1fcc4ad6fd40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wVFmecxK9kioGEya"/></div></div></figure><p id="33d8" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">暂时就这样吧！您可以在“分布列表”页面的“域名”列下找到URL。让您的发行版等待几分钟，让所有的设置都传播出去。</p><h1 id="e898" class="kg kh ij bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">更改API URL👨‍🚀</h1><p id="1cf9" class="pw-post-body-paragraph jg jh ij ji b jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz li kb kc kd hn dt translated">我想快速地指出，更改您的API URL很重要，因为您可能已经决定在其他地方使用您的API。为此，进入Winds目录，在<strong class="ji ik"> /app </strong>下会有一个. env文件。更改<strong class="ji ik"> REACT_APP_API_ENDPOINT </strong>环境变量。请务必在上传之前完成此操作，否则您的应用程序将无法加载。</p><h1 id="4ee1" class="kg kh ij bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">准备部署脚本🚀</h1><p id="a4fe" class="pw-post-body-paragraph jg jh ij ji b jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz li kb kc kd hn dt translated">当在我们的终端部署Winds时，我们在前端和后端都使用一些脚本。幸运的是，前端只需要一个文件。该文件必须位于您的Winds目录中，并且具有适当的权限。</p><p id="b5de" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">要创建脚本，进入Winds目录并创建一个名为<strong class="ji ik"> deploy.sh </strong>的文件。打开<strong class="ji ik"> deploy.sh </strong>，将以下内容粘贴到文件中:</p><p id="1852" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">接下来，让我们设置文件的权限:</p><blockquote class="mc md me"><p id="f24a" class="jg jh kf ji b jj jk jl jm jn jo jp jq mf js jt ju mg jw jx jy mh ka kb kc kd hn dt translated"><em class="ij">注意:为了让部署脚本正常工作，您必须更改以下内容！</em></p></blockquote><p id="0b50" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik"> 1。在第16行，将主页改为CloudFront提供的域名，如下图截图所示:</strong></p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/f700db67fe675efd9427b36b88c3a987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xqNY4pF6jd8aBetY"/></div></div></figure><p id="770a" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik"> 2。在第20行，将S3 URL更改为您创建的S3 bucket URL(例如winds-2–0-hosted):</strong></p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/27a346e4a8e714d6253d59c036e45a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5nhpQaSOz0iD9zyc"/></div></div></figure><p id="0462" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik"> 3。在第23行，在两个指定的位置更改S3的URL以匹配您的S3桶URL(例如winds-2–0-hosted):</strong></p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/82f80ad1b1963e53cd573551646330b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oRVHlDyfRyYf7COD"/></div></div></figure><p id="6cc5" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik"> 4。最后，在第25行更新您的发行版ID(由CloudFront提供，如下图所示):</strong></p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/4a6b8ecd316a9e8b21bbb622b8dff144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kVybZQb9Bh0-_VGz"/></div></div></figure><p id="572b" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">一旦正确设置了<strong class="ji ik"> deploy.sh </strong>文件，它将为您处理以下内容:</p><ul class=""><li id="bd95" class="lj lk ij ji b jj jk jn jo jr ll jv lm jz ln kd mi lp lq lr dt translated"><strong class="ji ik">确认您想要实际部署</strong></li><li id="d8a6" class="lj lk ij ji b jj ls jn lt jr lu jv lv jz lw kd mi lp lq lr dt translated"><strong class="ji ik">进入/app目录</strong></li><li id="5262" class="lj lk ij ji b jj ls jn lt jr lu jv lv jz lw kd mi lp lq lr dt translated">用编译的文件和资源创建一个构建目录</li><li id="a725" class="lj lk ij ji b jj ls jn lt jr lu jv lv jz lw kd mi lp lq lr dt translated">将构建文件和资产同步到您的S3存储桶</li><li id="ed0c" class="lj lk ij ji b jj ls jn lt jr lu jv lv jz lw kd mi lp lq lr dt translated">将非构建但必要的文件同步到S3</li></ul><p id="3028" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">部署到S3和云锋🤟</p><p id="53f6" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在一切都已创建并正确设置好了，让我们开始尝试吧！确保您在Winds目录中，并键入<strong class="ji ik">。/deploy.sh </strong>启动脚本。当它提示您时，请按“y ”,然后按enter。一系列事件将自动发生，当脚本完成时，您将看到下面的输出。</p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/77f3db4a5b1eea9f3b3202b62209b216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F3CNwckC_LAA8xHK"/></div></div></figure><p id="d663" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">你做到了！您的应用程序现在应该在CloudFront提供的URL上运行。</p><figure class="ly lz ma mb fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/dcf4d81469b83abc989974efc7b3b50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HX_XhSUh3I4fwvpm"/></div></div></figure><h1 id="5dbe" class="kg kh ij bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">最后的想法🤔</h1><p id="4a41" class="pw-post-body-paragraph jg jh ij ji b jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz li kb kc kd hn dt translated">如果你想改变网址，我建议你看看AWS Route53的DNS服务。您可以将您的自定义URL映射到您的CloudFront发行版，让Winds拥有一个自定义域！</p><p id="c69e" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果你还没有机会查看关于如何部署Winds API的帖子，你可以在这里阅读。一如既往，如果你有任何想法或评论，请在下面的评论中留下！</p><p id="7f27" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">编码快乐！🎉</p></div><div class="ab cl mj mk hc ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hn ho hp hq hr"><p id="80b1" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><em class="kf">原载于2018年9月6日</em><a class="ae ke" href="https://getstream.io/blog/deploying-the-winds-app-to-amazon-s3-and-cloudfront/" rel="noopener ugc nofollow" target="_blank"><em class="kf">getstream . io</em></a><em class="kf">。</em></p></div></div>    
</body>
</html>