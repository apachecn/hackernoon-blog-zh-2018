<html>
<head>
<title>How to run PyTorch with GPU and CUDA 9.2 support on Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google Colab上运行支持GPU和CUDA 9.2的PyTorch</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-run-pytorch-with-gpu-and-cuda-9-2-support-on-google-colab-64d58ba3083a?source=collection_archive---------8-----------------------#2018-09-07">https://medium.com/hackernoon/how-to-run-pytorch-with-gpu-and-cuda-9-2-support-on-google-colab-64d58ba3083a?source=collection_archive---------8-----------------------#2018-09-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/3a174b36e8ed0b0723ac4d2114526139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VxZTDRs7cpEqyqZP.png"/></div></div></figure><p id="5e9c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">自从我写了第一篇关于在谷歌的GPU支持的Jupyter笔记本界面- Colab上运行深度学习实验的教程以来，已经有一段时间了。从那以后，我的几个博客都是通过GPU加速在Colab上运行Keras、TensorFlow或Caffe。</p><p id="4fd9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Colab上缺少的一个框架是PyTorch。最近，我正在检查一个需要在Linux上运行的视频到视频合成模型，此外，在我可以带着这个闪亮的模型兜风之前，还有数千兆字节的数据和预先训练的模型要下载。我在想，为什么不利用Colab惊人的下载速度和免费的GPU来尝试一下呢？</p><h2 id="7740" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">享受本教程的<a class="ae kv" href="https://colab.research.google.com/drive/1ldg8DbTpe0M8PaioPBmwIwqs-DkH-ha9" rel="noopener ugc nofollow" target="_blank"> Colab笔记本链接</a>。</h2><p id="dae0" class="pw-post-body-paragraph jc jd hu je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">让我们从在Colab上安装CUDA开始。</p><h1 id="2659" class="lb kb hu bd kc lc ld le kg lf lg lh kk li lj lk kn ll lm ln kq lo lp lq kt lr dt translated">安装CUDA 9.2</h1><p id="62a1" class="pw-post-body-paragraph jc jd hu je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">为什么不是其他CUDA版本？这里有三个原因。</p><ol class=""><li id="ee2d" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">截至2018年9月7日，CUDA 9.2是Pytorch在其网站【pytorch.org<a class="ae kv" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"/>上看到的官方支持的最高版本。</li><li id="315a" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">有些人可能认为安装CUDA 9.2可能会与TensorFlow冲突，因为TF目前只支持CUDA 9.0。放松，把Colab笔记本当成一个沙箱，即使你弄坏了它，也可以通过几次按钮点击轻松重置，让我测试后安装CUDA 9.2后的TensorFlow工作正常。</li><li id="5da3" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">如果你安装了CUDA 9.0版本，在为Pytorch编译本地CUDA扩展时，你可能会遇到<a class="ae kv" href="https://devtalk.nvidia.com/default/topic/1028112/cuda-setup-and-installation/nvcc-bug-related-to-gcc-6-lt-tuple-gt-header-/post/5260762/#5260762" rel="noopener ugc nofollow" target="_blank">问题</a>。一些复杂的Pytorch项目包含<a class="ae kv" href="https://pytorch.org/tutorials/advanced/cpp_extension.html#integrating-a-c-cuda-operation-with-pytorch" rel="noopener ugc nofollow" target="_blank">定制c++ CUDA扩展</a>用于定制层/操作，比它们的Python实现运行得更快。不利的一面是，您需要从单个平台的源代码中编译它们。在运行于Ubuntu Linux机器上的Colab案例中，使用g++编译器来编译本地CUDA扩展。但是CUDA 9.0版在使用g++编译器编译原生CUDA扩展时有一个错误，这就是为什么我们选择CUDA 9.2版来修复这个错误。</li></ol><p id="a6b0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">回到安装，<a class="ae kv" href="https://developer.nvidia.com/cuda-downloads" rel="noopener ugc nofollow" target="_blank">Nvidia开发者网站</a>会询问你想要运行CUDA的Ubuntu版本。要找到答案，请在Colab笔记本中运行下面的单元格。</p><p id="677b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它会返回您想要的信息。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="c5e4" class="ka kb hu ml b fv mp mq l mr ms">VERSION="17.10 (Artful Aardvark)"</span></pre><p id="9375" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">之后，您将能够浏览目标平台选择，使安装程序键入<strong class="je hv">“deb(local)”</strong>，然后<strong class="je hv">右键</strong>点击<strong class="je hv">“下载(1.2 GB)”</strong>按钮复制链接地址。</p><p id="e3ae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">回到Colab笔记本，粘贴一个<strong class="je hv"> wget </strong>命令后的链接下载文件。在Colab上下载一个1.2GB的文件只需要大约10秒钟，这意味着没有咖啡休息时间-_-。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="ddd2" class="ka kb hu ml b fv mp mq l mr ms">!wget <a class="ae kv" href="https://developer.nvidia.com/compute/cuda/9.2/Prod2/local_installers/cuda-repo-ubuntu1710-9-2-local_9.2.148-1_amd64" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/compute/cuda/9.2/Prod2/local_installers/cuda-repo-ubuntu1710-9-2-local_9.2.148-1_amd64</a></span></pre><p id="29ee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">运行以下单元来完成CUDA安装。</p><figure class="mg mh mi mj fq iv"><div class="bz el l di"><div class="mt mu l"/></div><figcaption class="mv mw fg fe ff mx my bd b be z ek">Install CUDA 9.2</figcaption></figure><p id="02b7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您在输出的末尾看到这些行，这意味着安装成功了。</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="072c" class="ka kb hu ml b fv mp mq l mr ms">Setting up cuda (9.2.148-1) ...<br/>Processing triggers for libc-bin (2.26-0ubuntu2.1) ...</span></pre><p id="f90f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">继续Pytorch。</p><h1 id="5389" class="lb kb hu bd kc lc ld le kg lf lg lh kk li lj lk kn ll lm ln kq lo lp lq kt lr dt translated">安装PyTorch</h1><p id="0d42" class="pw-post-body-paragraph jc jd hu je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">非常简单，转到<a class="ae kv" href="https://www.dlology.com/blog/how-to-run-pytorch-with-gpu-and-cuda-92-support-on-google-colab/pytorch.org" rel="noopener ugc nofollow" target="_blank">pytorch.org</a>，这里有一个选择器，你可以选择如何安装Pytorch，在我们的例子中，</p><ul class=""><li id="1326" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz mz ly lz ma dt translated">操作系统:<strong class="je hv"> Linux </strong></li><li id="b829" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz mz ly lz ma dt translated">包管理器:<strong class="je hv"> pip </strong></li><li id="687d" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz mz ly lz ma dt translated">Python: <strong class="je hv"> 3.6 </strong>，可以通过在shell中运行<code class="eh na nb nc ml b">python --version</code>来验证。</li><li id="f30e" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz mz ly lz ma dt translated">CUDA: <strong class="je hv"> 9.2 </strong></li></ul><p id="5365" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它将让您运行下面这一行，之后，安装就完成了！</p><pre class="mg mh mi mj fq mk ml mm mn aw mo dt"><span id="9fec" class="ka kb hu ml b fv mp mq l mr ms">pip3 install torch torchvision</span></pre><h1 id="6cd6" class="lb kb hu bd kc lc ld le kg lf lg lh kk li lj lk kn ll lm ln kq lo lp lq kt lr dt translated">运行vid2vid演示</h1><p id="c696" class="pw-post-body-paragraph jc jd hu je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">出于好奇，Pytorch在Colab上启用GPU时表现如何，让我们尝试一下最近发布的<a class="ae kv" href="https://github.com/NVIDIA/vid2vid" rel="noopener ugc nofollow" target="_blank">视频到视频合成演示</a>，这是Pytorch对我们的高分辨率照片级视频到视频翻译方法的实现。那个视频演示把姿势变成了一个跳舞的身体，看起来很诱人。</p><figure class="mg mh mi mj fq iv fe ff paragraph-image"><div class="fe ff nd"><img src="../Images/e4fb0a3e095a86c83ae21b66e2ee4612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*VTK7uQf8KFBMPds7.gif"/></div></figure><p id="2db3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此外，演示还依赖于定制的CUDA扩展，提供了测试已安装的CUDA工具包的机会。</p><p id="414e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面的单元完成了从获取代码到使用预先训练好的模型运行演示的所有工作。</p><figure class="mg mh mi mj fq iv"><div class="bz el l di"><div class="mt mu l"/></div><figcaption class="mv mw fg fe ff mx my bd b be z ek">Run vid2vid demo</figcaption></figure><p id="a4f8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">生成的帧进入目录<strong class="je hv">results/label 2 city _ 1024 _ G1/test _ latest/images</strong>，你可以通过调用下面的单元格显示一个。</p><figure class="mg mh mi mj fq iv"><div class="bz el l di"><div class="mt mu l"/></div><figcaption class="mv mw fg fe ff mx my bd b be z ek">Show one result image</figcaption></figure><p id="312b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">本教程到此结束。</p><h1 id="cd02" class="lb kb hu bd kc lc ld le kg lf lg lh kk li lj lk kn ll lm ln kq lo lp lq kt lr dt translated">结论和进一步的思考</h1><p id="3c52" class="pw-post-body-paragraph jc jd hu je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">这篇短文向你展示了如何让GPU和CUDA后端<strong class="je hv"> Pytorch </strong>在Colab上快速自由地运行。不幸的是，<strong class="je hv"> vid2vid </strong>的作者还没有得到<a class="ae kv" href="https://github.com/NVIDIA/vid2vid/issues/24#issuecomment-417463746" rel="noopener ugc nofollow" target="_blank">可测试的边缘脸，pose-dance demo也还没有贴出来</a>，我在焦急的等待。到目前为止，它只是作为一个演示来验证我们在Colab上安装Pytorch。请随时在社交媒体上与我联系，我会让你了解我未来的项目和其他实用的深度学习应用。</p><p id="064b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">以下是我之前的一些Colab教程。</p><ol class=""><li id="9c97" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated"><a class="ae kv" href="https://www.dlology.com/blog/how-to-run-object-detection-and-segmentation-on-video-fast-for-free/" rel="noopener ugc nofollow" target="_blank">“如何免费快速运行视频中的对象检测和分割</a>”——我在Colab上的第一个教程，<a class="ae kv" href="https://drive.google.com/file/d/11yXcMidH2rmnvy5GxFAr0M_0mABr1M_-/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"> colab笔记本直接链接</a>。</li><li id="1c00" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><a class="ae kv" href="https://www.dlology.com/blog/quick-guide-to-run-tensorboard-in-google-colab/" rel="noopener ugc nofollow" target="_blank">“在Google Colab </a>中运行TensorBoard的快速指南”，——<a class="ae kv" href="https://drive.google.com/file/d/1afN2SALDooZIHbBGmWZMT6cZ8ccVElWk/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">Colab笔记本直联</a>。</li><li id="87c6" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">在Colab上运行caffe-cuda—<a class="ae kv" href="https://drive.google.com/file/d/1jqBo2hpFY_xNeFHDf5l1h6q_VTcRTRlQ/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">Colab笔记本直接链接</a>。</li></ol><p id="a945" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae kv" href="https://twitter.com/intent/tweet?url=https%3A//www.dlology.com/blog/how-to-run-pytorch-with-gpu-and-cuda-92-support-on-google-colab/&amp;text=How%20to%20run%20PyTorch%20with%20GPU%20and%20CUDA%209.2%20support%20on%20Google%20Colab" rel="noopener ugc nofollow" target="_blank">在Twitter上分享</a> <a class="ae kv" href="https://www.facebook.com/sharer/sharer.php?u=https://www.dlology.com/blog/how-to-run-pytorch-with-gpu-and-cuda-92-support-on-google-colab/" rel="noopener ugc nofollow" target="_blank">在脸书分享</a></p></div><div class="ab cl ne nf hc ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="hn ho hp hq hr"><p id="b42e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="nl">原载于</em><a class="ae kv" href="https://www.dlology.com/blog/how-to-run-pytorch-with-gpu-and-cuda-92-support-on-google-colab/" rel="noopener ugc nofollow" target="_blank"><em class="nl">www.dlology.com</em></a><em class="nl">。</em></p></div></div>    
</body>
</html>