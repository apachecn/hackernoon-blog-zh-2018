<html>
<head>
<title>Siemens Simatic Iot2040 as Mqtt Broker [NETPIE]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">西门子Simatic Iot2040作为Mqtt代理[NETPIE]</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/siemens-simatic-iot2040-as-mqtt-broker-netpie-1d906840b087?source=collection_archive---------10-----------------------#2018-09-07">https://medium.com/hackernoon/siemens-simatic-iot2040-as-mqtt-broker-netpie-1d906840b087?source=collection_archive---------10-----------------------#2018-09-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="cc45" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">本文解释了如何在Siemens Simatic IoT2040上安装Mqtt broker。本文使用了Mosca Mqtt代理。</p></blockquote><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff jt"><img src="../Images/854e353b7ec3fb38dbfd3ebdd0bb0593.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pnMpwvUfqUs9hxnzAt3Wkw.png"/></div></div></figure><p id="da03" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">系统型号:</strong></p><p id="fd2e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">Modbus电能表用作客户端，向安装在Siemens Simatic IoT2040上的Mosca代理发布电压、电流和频率值。Simatic上的代理然后将数据发布到NETPIE APP ID，该ID订阅了与publisher相同的主题。</p><p id="1942" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">入门:</strong></p><p id="a5c0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">Simatic IoT2040基于Yocto Linux工作，镜像需要安装在SD卡上，并应插入Simatic。安装Yocto Linux和连接Modbus电能表到Simatic的详细说明可以在<a class="ae ki" rel="noopener" href="/@karthikm618/connecting-modbus-rtu-smart-energy-meter-and-siemens-simatic-iot2040-to-netpie-7d38aafb7c04">这里</a>找到。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/8df8cf679acd8d0769449dc35eec4181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*aroIC3w9nsKnjMmpr6ZmLQ.jpeg"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Siemens Simatic IoT2040</figcaption></figure><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/52a11d4708c4b38beb13e00b7ef99e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:356/format:webp/1*3bMLZQewLYbGLsWVYut_Iw.jpeg"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Modbus Energy Meter</figcaption></figure><p id="98c2" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">在西门子Simatic IoT2040上安装Mosca:</strong></p><p id="4439" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">使用npm在Simatic上安装Mosca，如下所述</p><p id="b073" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">安装mosca bunyan -g</p><p id="56d9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">要测试Mosca，请运行以下命令</p><p id="e123" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">莫斯卡-v |班扬</p><p id="d0eb" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">如果您得到类似下图的输出，“恭喜”，您已经成功地在Simatic IoT2040上安装了Mosca。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff kp"><img src="../Images/86e597e49ad50cd22d1eafa1200cfd6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*IpduhT4Pq7rshmxucahUqg.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Running Mosca broker on Simatic IoT2040</figcaption></figure><p id="c6cb" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">在Node-Red上安装节点:</strong></p><p id="250f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">安装网络节点</p><p id="75ff" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">npm安装-g节点-red-contrib-netpie</p><p id="a093" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">安装Mosca Mqtt代理节点</p><p id="dfd3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">npm安装-g节点-red-contrib-mqtt-broker</p><p id="0431" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">安装modbus节点</p><p id="0690" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">npm安装-g节点-red-contrib-modbus</p><p id="c759" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">为了将数据从代理(安装在Simatic上)传输到netpie，首先Simatic应该由NETPIE认证，为此使用了微齿轮节点(NETPIE)。一旦设备通过身份验证，Simatic和NETPIE之间的连接就建立起来，并且使用Mosca mqtt broker传输数据。Modbus节点用于从Modbus电能表读取数据。</p><p id="99ba" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">节点-红色流程:</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff kq"><img src="../Images/626626942bf774ad5b8a2a192b544ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*7mF8iDqjhHarDeCIE_dmFw.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Node-Red Flow</figcaption></figure><p id="462b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv"> Mosca代理节点:</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff kr"><img src="../Images/f805c528d49ec353a508a4ccd9014b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*G8xCFXRqIKznZnbG5kU8kg.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Mosca Mqtt node</figcaption></figure><p id="a074" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv"> Mqtt输出节点(发布者):</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff ks"><img src="../Images/3f2eecf93e63deb0234a3d90516a6d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*6unlo2uNVWWQnl-1zIwo2A.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Pub node</figcaption></figure><p id="5b9e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">节点中的Mqtt(订户):</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/9d6b55563b3dde9e081732ed675dbadd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*dWOd31e1E5uVm0ULB33gDQ.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Sub node</figcaption></figure><p id="bb78" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">微齿轮节点:</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/50c9a5d756fb289ea1bd3cb7d7769f9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*ulDfJT9YmHw_Lc437hokIw.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">MicroGear node</figcaption></figure><p id="8fc7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv"> Modbus节点:</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff kv"><img src="../Images/667b9f9c182eca256ff592a53f551668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*pdESGyUQuL-mAiuQFVbmNg.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Modbus node</figcaption></figure><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff kw"><img src="../Images/dbc5c72368df1bbfce6ffcf954642f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*UMO5iQm_qmRXnwX0twHGjg.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Modbus client settings</figcaption></figure><p id="63e4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">功能节点:</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div class="fe ff kx"><img src="../Images/301b22672c0497fc453ef7fcdbacd771.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*DjjkSHTqrc6cOT34VgEY4w.png"/></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Function node</figcaption></figure><p id="0fde" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">从Modbus能量计读取的数据将被括在括号内(例如:电压值:[23200])。为了删除数据中的括号和多余字符，我们使用函数node。</p><p id="8cb9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">网络馅饼:</strong></p><p id="983c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated">在与发布者节点订阅相同主题的NETPIE上创建应用程序Id。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff ky"><img src="../Images/536e24b2130318c25aecf8b81086707d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6HhtgccboK2LQwIlZsVAPw.png"/></div></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Creating APP ID on NETPIE</figcaption></figure><p id="3172" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">创建数据源:</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff kz"><img src="../Images/ad853bd2c20777333ad5b98047231990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oZvj8ulQQfe-fTO0XQ5-xQ.png"/></div></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Datasource</figcaption></figure><p id="07f2" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">创建小部件:</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff la"><img src="../Images/be27dfbaada7030024a15cd63e583a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8AiIeBuZCLAI95OXJxxwUQ.png"/></div></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Widget to display data</figcaption></figure><p id="9528" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf kf jh ji jj kg jl jm jn kh jp jq jr js hn dt translated"><strong class="ix hv">结果:</strong></p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff lb"><img src="../Images/fc93e2c01b2f8bdd483d7d5da8a983ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTMCzKjaUZoVDaFAzH5hTA.png"/></div></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">Energy Meter data published on NETPIE through Mosca broker</figcaption></figure></div></div>    
</body>
</html>