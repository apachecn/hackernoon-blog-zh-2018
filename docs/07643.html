<html>
<head>
<title>Creating a football pool as an excuse to learn Node JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建足球池作为学习Node JS的借口</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/creating-a-football-pool-as-an-excuse-to-learn-node-js-4aa978b7ca61?source=collection_archive---------15-----------------------#2018-09-07">https://medium.com/hackernoon/creating-a-football-pool-as-an-excuse-to-learn-node-js-4aa978b7ca61?source=collection_archive---------15-----------------------#2018-09-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="87f7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经过4年的等待，我们迎来了另一届充满惊喜的世界杯，我再次决定开一个足球赌局，或者在拉丁美洲被称为quiniela，来欺骗我所有的朋友…我想了解更多。我的第一次经历是在2014年使用PHP和Yii创建它，但这一次我想学习一些新的和新鲜的东西。</p><p id="c579" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想分享我使用Node的经验和我达成的解决方案。</p><p id="7d74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">注意:这篇文章是关于我用Node创建我的第一个应用程序的经历，绝不是初学者的实际指南。如果你是新来Node的，你会发现有几个指南会对你更有帮助，包括</em> <a class="ae jq" href="https://nodejs.org/en/docs/guides/getting-started-guide/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">官方指南</em> </a> <em class="jp">。当然，我总是渴望尽我所能提供帮助。</em></p><h2 id="4229" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated"><strong class="ak">为什么节点？</strong></h2><p id="e28e" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">在过去的几年里，我一直在使用Python进行web开发，每次我搜索新闻时，他们都在谈论Node，所以我决定加入酷孩子俱乐部并尝试一下。</p><figure class="ks kt ku kv fq kw fe ff paragraph-image"><div class="fe ff kr"><img src="../Images/1ed545e25155078581419bbd17cf01d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*e-0vaBIc-_0zgtWesvpOnw.png"/></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">Me</figcaption></figure><h2 id="129d" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated"><strong class="ak">规则</strong></h2><p id="426c" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">在开始之前，我需要制定今年的规则。我不认为这些是标准规则，但根据我的经验，这些规则非常有趣(特别是在最后一场比赛中，一两分就能让你获胜):</p><ul class=""><li id="3171" class="ld le hu it b iu iv iy iz jc lf jg lg jk lh jo li lj lk ll dt translated">所有用户必须在比赛开始前输入预测。</li><li id="1146" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">如果一个分数的预测与最终结果完全吻合，他得3分。</li><li id="14da" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">如果不是完全匹配，但有相同的赢家，那么他赢得1分。示例:如果用户A选择3–0，实际得分为2–1，则用户获得1分。</li><li id="f607" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">如果比赛是平局，用户也预测平局，他将获得1分。例如:如果用户B走3-3，得分是1-1，那么用户得到1分。</li><li id="bea5" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">获胜者是得分最多的用户。</li></ul><h1 id="2c41" class="lr js hu bd jt ls lt lu jx lv lw lx kb ly lz ma ke mb mc md kh me mf mg kk mh dt translated">结构</h1><p id="69e4" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">(你可以在这里得到完整的代码<a class="ae jq" href="https://github.com/agmezr/quiniela" rel="noopener ugc nofollow" target="_blank"/>)</p><p id="12f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我需要做的第一件事是找到一个易于理解同时又可扩展的结构。最后我决定使用一个有点类似于我更熟悉的<a class="ae jq" href="http://exploreflask.com/en/latest/organizing.html" rel="noopener ugc nofollow" target="_blank">烧瓶蓝图</a>的结构(小步骤！).</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="2f0d" class="jr js hu mj b fv mn mo l mp mq">api/<br/>|-- config.js<br/>|-- controllers<br/>|   |-- database.js<br/>|   `-- positions.js<br/>|-- matches<br/>|   |-- index.js<br/>|   `-- matches.js<br/>|-- teams<br/>|   |-- index.js<br/>|   `-- teams.js<br/>`-- users<br/>    |-- index.js<br/>    `-- users.js</span></pre><p id="2a99" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种结构将API和视图的每个主要特性的功能组织在一个目录中。因为这是一个小项目，所以我只使用了一个索引文件来展示路由器和一个文件来存储端点。</p><p id="96a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">配置文件包含用于更改应用程序行为的变量，并存储其他配置，例如Oauth的id</p><p id="ce20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">api目录中每个组件的简要描述:</p><h2 id="4338" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">组</h2><p id="5ad8" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">显示所有团队的信息，或者只显示一个团队的id。</p><h2 id="ef20" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">用户</h2><p id="0fc2" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">计算每个用户的总积分，并在比赛前更新每个用户的预测。</p><h2 id="4418" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">比赛</h2><p id="c7a7" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">包含查看匹配结果、更新结果、获取下一个匹配或n个最后匹配的控制器。</p><h2 id="66de" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">控制器</h2><p id="2536" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">任何其他组件使用的函数。主要用于处理与数据库的连接和查询。说到这个…</p><h1 id="b59d" class="lr js hu bd jt ls lt lu jx lv lw lx kb ly lz ma ke mb mc md kh me mf mg kk mh dt translated">数据库ˌ资料库</h1><p id="3eb1" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">我的第二个问题是找到一种方法来存储团队、预测、日期和结果的信息。尽管我找到的大多数指南都推荐不同的方法(比如非关系数据库)，但我选择使用Postgres，主要是因为这是我通常做的，而且我不想增加更多的难度，因为我在几天后就要开始第一场比赛了(拖延，万岁！).</p><p id="c222" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">数据库很简单，只包含四个表:</p><ul class=""><li id="1152" class="ld le hu it b iu iv iy iz jc lf jg lg jk lh jo li lj lk ll dt translated">Matches:存储每场比赛的日期和最终结果。</li><li id="549f" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">团队:每个团队的名称。</li><li id="3e37" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">预测:每个用户预测的分数。</li><li id="a3b0" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">用户:用于识别每个用户的名称和用于登录的电子邮件。</li></ul><h1 id="5da6" class="lr js hu bd jt ls lt lu jx lv lw lx kb ly lz ma ke mb mc md kh me mf mg kk mh dt translated">API</h1><h2 id="8245" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">按指定路线发送</h2><p id="4d29" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">为了创建API，我使用了<a class="ae jq" href="http://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>和它强大的<a class="ae jq" href="http://expressjs.com/en/guide/routing.html" rel="noopener ugc nofollow" target="_blank">路由器</a>组件。有了它，我可以像创建结构一样分离路由，并使用路由器在每个模块中创建端点:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="45bb" class="jr js hu mj b fv mn mo l mp mq">// An example of matches.js inside api/matches<br/>// obtain router<br/>const express = require('express'),<br/>      router = express.Router()<br/>...</span><span id="5ef1" class="jr js hu mj b fv mr mo l mp mq">// example of an endpoint. <br/>router.get("/all", (req, res) =&gt; {<br/>  console.log("obtain all matches");<br/>  // do stuff<br/>})</span></pre><p id="fbcf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在server.js文件中，我从其他模块导入所有路由:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="872b" class="jr js hu mj b fv mn mo l mp mq">// require express and import the routes in the api directory<br/>const express = require('express');<br/>      matches = require('./api/matches'),<br/>      teams = require('./api/teams'),<br/>      users = require('./api/users'),<br/>...</span><span id="9f8d" class="jr js hu mj b fv mr mo l mp mq">// register the routes in the app<br/>app.use('/teams',teams)<br/>.use('/matches', matches)<br/>.use('/users', users)<br/>... // other routes</span></pre><h2 id="97fd" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">Postgres</h2><p id="448d" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">为了管理数据库会话和查询，我使用了<a class="ae jq" href="https://node-postgres.com/" rel="noopener ugc nofollow" target="_blank">节点-postgres </a>。使用这个库，您可以从环境中获得数据库url(更安全，在Heroku等一些地方使用):</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="dae0" class="jr js hu mj b fv mn mo l mp mq">const { DATABASE_URL } = process.env;<br/>var pool = new Pool({<br/>    connectionString: DATABASE_URL<br/>});</span></pre><p id="7e69" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者创建对象并将其传递给池:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="b883" class="jr js hu mj b fv mn mo l mp mq">var pool = new Pool({<br/>      user: 'username',<br/>      host: 'localhost',<br/>      database: 'database_name',<br/>      password: 'my_password',<br/>      port: 5432<br/>    });</span></pre><p id="8009" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">建立连接后，您可以执行如下查询:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="1272" class="jr js hu mj b fv mn mo l mp mq">// connect pool and query all teams in table<br/>pool.connect()<br/>  .then(client =&gt; {<br/>      return client.query("SELECT * FROM teams")<br/>        .then(data =&gt;{<br/>          // do stuff with the data<br/>          ...<br/>        })</span></pre><p id="779e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这两个组件，我就可以开始编写每个模块所需的端点代码，并将数据存储在数据库中</p><p id="0c0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">顺便说一下，如果你认为这个查询的代码很难看，那你就对了！我正在下降到地狱… <a class="ae jq" href="http://callbackhell.com/" rel="noopener ugc nofollow" target="_blank">回调地狱</a></p><figure class="ks kt ku kv fq kw fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/5f037c8823079a3d379673ab3d673700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*cf4xUeKhK1e5565GU1sHXQ.jpeg"/></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">But that’s a story for another day</figcaption></figure><p id="613c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想测试应用程序，请遵循以下步骤。</p><h2 id="a87b" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">要求</h2><ul class=""><li id="8e68" class="ld le hu it b iu km iy kn jc mt jg mu jk mv jo li lj lk ll dt translated">节点js(显然)</li><li id="e58d" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">npm</li><li id="3106" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">postgres</li><li id="2af2" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">浏览器或curl来查看响应</li></ul><h2 id="8787" class="jr js hu bd jt ju jv jw jx jy jz ka kb jc kc kd ke jg kf kg kh jk ki kj kk kl dt translated">安装</h2><p id="51d1" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">首先从github克隆项目:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="6e10" class="jr js hu mj b fv mn mo l mp mq">git clone <a class="ae jq" href="https://github.com/agmezr/quiniela.git" rel="noopener ugc nofollow" target="_blank">https://github.com/agmezr/quiniela.git</a></span></pre><p id="ec0d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">项目的结构:</p><ul class=""><li id="c653" class="ld le hu it b iu iv iy iz jc lf jg lg jk lh jo li lj lk ll dt translated">api/:控制器、视图和响应</li><li id="cc29" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">assets/:包含数据库的脚本</li><li id="bb4d" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">server.js:配置和启动服务器的文件</li><li id="e4ac" class="ld le hu it b iu lm iy ln jc lo jg lp jk lq jo li lj lk ll dt translated">包json:用于安装所需的依赖项</li></ul><p id="3a07" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用npm安装项目的依赖项:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="4f17" class="jr js hu mj b fv mn mo l mp mq">npm install</span></pre><p id="8aea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">运行assets/database.sql中的脚本来创建数据库:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="6a00" class="jr js hu mj b fv mn mo l mp mq">psql &lt;db name | postgres&gt; -f assets/database.sql</span></pre><p id="513e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装完依赖项和数据库后，使用以下命令运行服务器:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="256e" class="jr js hu mj b fv mn mo l mp mq">node server.js</span></pre><p id="152a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果一切正常，您应该会看到如下消息:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="634d" class="jr js hu mj b fv mn mo l mp mq">Staring app on 8080</span></pre><p id="c75b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在打开您的浏览器(或使用curl)并访问localhost:8080/index，您会看到一个令人惊叹的响应:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="a63e" class="jr js hu mj b fv mn mo l mp mq">{"status":"ok"} </span></pre><p id="640f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您看到该响应，则一切都在运行。您可以与其他端点一起玩，例如查看第一个团队的信息，请输入:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="40fa" class="jr js hu mj b fv mn mo l mp mq"><a class="ae jq" href="http://localhost:8080/teams/1" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/teams/1</a></span></pre><p id="de62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将看到以下响应:</p><pre class="ks kt ku kv fq mi mj mk ml aw mm dt"><span id="02e4" class="jr js hu mj b fv mn mo l mp mq">[{"id":1,"name":"Russia","grp":"A"}]</span></pre><h1 id="379c" class="lr js hu bd jt ls lt lu jx lv lw lx kb ly lz ma ke mb mc md kh me mf mg kk mh dt translated">后续步骤</h1><p id="5e30" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">在接下来的文章中，我想分享我使用Oauth的经验，让用户使用Google帐户登录，并创建视图来友好地显示数据，最后将其部署到Heroku上。</p><h1 id="6ee8" class="lr js hu bd jt ls lt lu jx lv lw lx kb ly lz ma ke mb mc md kh me mf mg kk mh dt translated">结论</h1><p id="3864" class="pw-post-body-paragraph ir is hu it b iu km iw ix iy kn ja jb jc ko je jf jg kp ji jj jk kq jm jn jo hn dt translated">当我的一只拳头接近Node时，我想说和它一起工作非常愉快。有很多帮助初学者的指南，包括官方文档和更多的库，可以帮助你完成一些常见的任务，如安全性、数据库连接等。当然，有些事情一开始很难理解，比如<a class="ae jq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">承诺</a>和新的<a class="ae jq" href="https://www.w3schools.com/js/js_es6.asp" rel="noopener ugc nofollow" target="_blank"> ES6语法</a>，但是没有什么是几个小时的编码不能解决的。</p><p id="b3b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想尝试Node JS，我的建议是像我一样创造一些简单有趣的东西，并小心<strong class="it hv">回调地狱</strong>！</p></div></div>    
</body>
</html>