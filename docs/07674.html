<html>
<head>
<title>Weekend Project: classic snake in plain Js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">周末项目:普通Js中的经典蛇</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/weekend-project-classic-snake-in-plain-js-33911f1d6417?source=collection_archive---------10-----------------------#2018-09-09">https://medium.com/hackernoon/weekend-project-classic-snake-in-plain-js-33911f1d6417?source=collection_archive---------10-----------------------#2018-09-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="3e2f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经典的贪吃蛇游戏是一个不错的周末项目，本教程展示了游戏使用html5画布创建。你可以试试<a class="ae jp" href="https://codepen.io/eamo2020/full/OZWgpm/" rel="noopener ugc nofollow" target="_blank">成品游戏a codepen </a>，或者在github 上查看<a class="ae jp" href="https://github.com/eamonnmcevoy/snake" rel="noopener ugc nofollow" target="_blank">代码</a></p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="d372" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">1.渲染游戏网格</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/54395cab3a6c40fe8f23cf7b88ec47606cb69d1d" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">基本网格渲染eamonnmcevoy/snake@54395ca</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq lr lc"/></div></div></a></div><p id="e17b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一步很简单，创建一个index.html来容纳我们的画布</p><pre class="jq jr js jt fq ls lt lu lv aw lw dt"><span id="9fee" class="ke kf hu lt b fv lx ly l lz ma">index.html</span><span id="4a12" class="ke kf hu lt b fv mb ly l lz ma">&lt;html&gt;    <br/>  &lt;head&gt;    <br/>  &lt;/head&gt;    <br/>  &lt;body&gt;        <br/>    &lt;canvas id="game"&gt;&lt;/canvas&gt;<br/>    &lt;script src="./index.js"&gt;&lt;/script&gt;    <br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="89b0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在一个网格类负责渲染我们的游戏。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff md"><img src="../Images/14946344e4de15c7fdb652fc0bf5ab81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDa6vNhI1zlfkkuqs_MgwA.png"/></div></div></figure><p id="e9f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简单代码到目前为止，这用2D上下文设置了我们的canvas对象，并呈现了一个50*50的正方形网格，这将形成游戏的游戏区域。</p></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="0971" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">2.用2D阵列更新网格</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/525100e8718a772fd2e4b5508a3729bed29c8f8f" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">创建格网数据集eamonnmcevoy/snake@525100e</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="mj l ln lo lp ll lq lr lc"/></div></div></a></div><p id="4533" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在添加snake对象之前，Grid类需要扩展一点。我们将在2D数组中保存网格状态，这段代码将像以前一样工作，但允许我们为每个单元格指定一个“状态”,并相应地给它着色。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="ae70" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">3.创建蛇类</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/ed6fa328e801ba2b3612c968adb93957ccc05aec" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">创建蛇对象eamonnmcevoy/snake@ed6fa32</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="mk l ln lo lp ll lq lr lc"/></div></div></a></div><p id="a53b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是时候创造我们的滑行英雄了，蛇！这个类保存了一个数组<code class="eh ml mm mn lt b">parts</code>，用来表示蛇的状态。<code class="eh ml mm mn lt b">update</code>方法将负责更新蛇的位置，并返回网格上需要更新的单元格数组，因为我们现在只有一个单元格，代码很简单。getter <code class="eh ml mm mn lt b">head</code>返回蛇头部细胞的副本。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff mo"><img src="../Images/7f9f5fd390c15ac31112db84c7a96109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ceU5t-C4buMCa1FiRP977g.png"/></div></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="5658" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">4.创建游戏类</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/03b0de9384f5d27310bee81d6e60a938efd42849" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">创建游戏对象eamonnmcevoy/snake@03b0de9</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="mp l ln lo lp ll lq lr lc"/></div></div></a></div><p id="338c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了让我们的蛇动起来，我们需要创建一个游戏循环，负责更新游戏状态和协调我们的对象。所有的动作都发生在<code class="eh ml mm mn lt b">run</code>方法中，在游戏循环的每次迭代中，我们渲染网格，更新游戏状态，最后在运行下一次迭代之前添加一个短暂的延迟(50毫秒)。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div><figcaption class="mq mr fg fe ff ms mt bd b be z ek">`while(true)` . ¯\_( ⊙_ʖ⊙ )_/¯</figcaption></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="9f54" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">5.移动的蛇</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/2b8a11e311da92d0ad2b4d0d67bdec7bcd154c7f" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">移动snake eamonnmcevoy/snake @ 2b 8 a11e</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="mu l ln lo lp ll lq lr lc"/></div></div></a></div><p id="e498" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们准备做一些有趣的事情，让蛇动起来。在这个阶段，我们只需在每次更新时向右移动1个单元格。蛇<code class="eh ml mm mn lt b">update</code>的方法现在有点复杂了。为了移动我们的蛇，我们将计算新的头部位置，移除“尾部”单元，并将其放在这个新位置。</p><p id="997c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh ml mm mn lt b">isAlive</code>测试与棋盘边缘和蛇上其他细胞的碰撞。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mv"><img src="../Images/45800bbc694b220c85f1bb20237da868.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/1*_Ex4C5ELunI1lZda2Jt6qw.gif"/></div><figcaption class="mq mr fg fe ff ms mt bd b be z ek">Its alive!</figcaption></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="1f2d" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">6.控制蛇</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/b03c6296f88c50e274c0f9a886cd37761093dc14" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">定向蛇eamonnmcevoy/snake@b03c629</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="mw l ln lo lp ll lq lr lc"/></div></div></a></div><p id="2971" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们的蛇正在移动，我们可以开始接收键盘输入来控制移动的方向。游戏类现在包含了一个处理键盘输入的handler方法，箭头键被绑定来将蛇向上、向下、向左或向右转动。这条蛇还用一个<code class="eh ml mm mn lt b">updatePosition</code>方法进行了扩展，以确定新的位置。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="2b20" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">7.优化网格渲染</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/065c516d16df1984ac2c34699dc051b2d7ff5da2" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">渲染优化eamonnmcevoy/snake@065c516</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="mx l ln lo lp ll lq lr lc"/></div></div></a></div><p id="8c3a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">游戏网格的渲染存在相当糟糕的低效率。在每次迭代中，我们重新绘制每个单元格，而实际上我们只需要更新自上一帧以来发生变化的单元格。这是一个简单的改变，网格将保存一个<code class="eh ml mm mn lt b">updatedCells</code>的数组，在调用<code class="eh ml mm mn lt b">setPoint</code>时，我们将把每个点推到这个数组中。现在，我们只需要从这个数组中重新绘制单元格，将render方法的工作从每帧2500个单元格减少到大约2–3个，对于4行代码来说，这是一个不错的改进。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="1123" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">8.生产食物</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/e7c7001028ecf80b0fd63d182ef6ce6ca1604a2d" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">生成食物eamonnmcevoy/snake@e7c7001</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="my l ln lo lp ll lq lr lc"/></div></div></a></div><p id="8a2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有这些工作让我饿了，是时候为我们的鳞片朋友做些午餐了。每1秒钟，如果网格上没有食物，我们将在随机位置添加一个紫色的食物单元格。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/7665bd7ccb650c5f2c8bf46420c2d87d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*oRATnlYyfKAojt9G8o3uTA.png"/></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="81d1" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">9.饮食和成长</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/e513f987813d58aaabe13fbea940d3580399232e" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">捡拾食物eamonnmcevoy/snake@e513f98</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="na l ln lo lp ll lq lr lc"/></div></div></a></div><p id="be67" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">游戏的最后也是最重要的元素，当蛇头与食物细胞碰撞时，蛇会生长。在主游戏循环中，我们需要执行一个简单的检查，检查是否与食物细胞发生碰撞，如果检测到，移除细胞并让蛇长一条。为了让蛇变大，我们在尾巴上添加了一个新的细胞，来代替原来的尾巴位置。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><h2 id="e735" class="ke kf hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">10.跟踪得分</h2><div class="kz la fm fo lb lc"><a href="https://github.com/eamonnmcevoy/snake/commit/f1cf27bd12dfc11a8c914884f136d9d6c597ffb5" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab ej"><div class="le ab lf cl cj lg"><h2 class="bd hv fv z el lh eo ep li er et ht dt translated">曲目评分eamonnmcevoy/snake@f1cf27b</h2><div class="lj l"><h3 class="bd b fv z el lh eo ep li er et ek translated">在GitHub上创建一个帐户，为eamonnmcevoy/snake开发做贡献。</h3></div><div class="lk l"><p class="bd b gc z el lh eo ep li er et ek translated">github.com</p></div></div><div class="ll l"><div class="nb l ln lo lp ll lq lr lc"/></div></div></a></div><p id="67d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后一次更新以结束游戏，当收集到一块食物时，奖励1分。只需在游戏类中添加一个<code class="eh ml mm mn lt b">score</code>属性，收集食物时递增，在画布下方显示分数。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><p id="3f89" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">希望你喜欢这个快速周末项目，如果你想要更多这样的内容，请给一些<strong class="it hv">掌声</strong>或评论。编码快乐！</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff nc"><img src="../Images/d1997212da1d2a62b6e485f277a51bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J35y9Y6-aodIpHiUlOcsBQ.png"/></div></div></figure></div></div>    
</body>
</html>