<html>
<head>
<title>Your Pizza is Good: How to Teach AI to Evaluate Food Quality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的披萨不错:如何教AI评价食物质量</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/your-pizza-is-good-how-to-teach-ai-to-evaluate-food-quality-d835a8c12e86?source=collection_archive---------7-----------------------#2018-09-13">https://medium.com/hackernoon/your-pizza-is-good-how-to-teach-ai-to-evaluate-food-quality-d835a8c12e86?source=collection_archive---------7-----------------------#2018-09-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/9e371e49a542b7bb53b1c1a9bd45e4f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8YqHrwjv8MBezG54xUTRvA.png"/></div></div></figure><p id="58fb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们关于人工智能开发的系列出版物中的下一篇文章将研究俄罗斯最大的披萨连锁店“Dodo Pizza”的最新Dbrain用例。我们的首席数据科学家Arthur Kuzin解释了开发的人工智能如何通过电报信使对披萨面团进行1-10分的评分来进行披萨质量控制。深入了解如何教人工智能评估您的披萨！。</p><p id="68ae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我将关注以下几点:I)仅从几个带标签的样本中获取整个数据集的标记；以及ii)将bbox拉伸到对象的分割遮罩(将bbox的正方形遮罩应用于任何形状)。</p><h1 id="e51e" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">主旨</strong></h1><p id="25c7" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">所以事情是这样的。多多比萨有许多活跃的顾客，他们同意分享他们对比萨质量的看法。为了简化反馈循环及其处理，Dbrain开发了一个人工智能驱动的应用程序来检查披萨质量。这个应用程序在Telegram中被实现为一个聊天机器人，用户上传一张照片，然后得到从一到十的结果。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff le"><img src="../Images/253e4cfee1b9f41db93fc5c660ec8f7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yXxQoOktHmArOLadKRFtxg.png"/></div></div></figure><h1 id="4d64" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">问题陈述</strong></h1><p id="489e" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">当我们收到请求时，我开始开发一种算法，可以直观地确定面团的质量。问题是确定比萨饼烘烤过程何时被中断。外壳上的白色气泡似乎与变质的产品有关。</p><h1 id="44f8" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">数据挖掘</strong></h1><p id="15d8" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">该数据集包括烤披萨的照片，也包括不相关的图片。如果食谱不正确，面包皮上会出现白色气泡。此外，还有一个由专家进行的面团质量二元标记。所以算法的发展只是时间问题。</p><p id="320a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些照片是用不同的手机，在不同的光线条件下，从不同的角度拍摄的。有17k个比萨饼样本，而图片的总数是60k。</p><p id="0240" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为任务非常简单，所以这是检验不同数据处理方法的好地方。所以，我们需要解决这个问题:</p><p id="2a37" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.选择看到披萨饼皮的照片；</p><p id="12cd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.将所选照片中的地壳区域与背景区分开来；</p><p id="9e94" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.在选定的区域训练神经网络。</p><h1 id="24cb" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">数据过滤</strong></h1><p id="445c" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我自己标注了一小部分照片，而不是向其他人解释我真正需要的是什么，因为…你知道，如果你想把一件事做好，那就自己做:)下面是我所做的:</p><p id="d8cc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.标记50张带外壳的照片和50张不带外壳的照片:</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lj"><img src="../Images/c1c6c016ad99d243274d242833c4b6b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZOfnbj1rGzeZ2k2WmAqKw.jpeg"/></div></div></figure><p id="22db" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.使用在imagenet11k上使用places365预训练的ResNet-152提取全局平均池后的特征(<a class="ae lk" href="https://github.com/deepinsight/mxnet/tree/master/example/image-classification" rel="noopener ugc nofollow" target="_blank">单击</a>)</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ca"><img src="../Images/67c2576f5747cef074fbc3b4bab0e8f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POvc0v2JZkKCVhzQI7RhLA.png"/></div></div></figure><p id="3246" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.取两类特征的平均值作为锚</p><p id="65ed" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.计算从这个锚点到剩余60k图片的所有特征的距离</p><p id="c92d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.确定前300个与正面类接近相关，距离最远的前500个是负面类</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/7ec5afbb3035cc54b18fe3b46eb54560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dn-a6y2jL7qbVAjxP-w_qA.png"/></div></div></figure><p id="d815" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">6.根据这些样本对LightGBM进行特征训练</p><p id="2c49" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">7.使用此模型派生整个数据集上的标记</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lm"><img src="../Images/c5c59eea24f134c331ec2b0a7ea64534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e-YGEfOXXk97fUIKTd4LcA.png"/></div></div></figure><p id="db89" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这与我在kaggle比赛中用作基线的方法大致相同。</p><h1 id="f48b" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">前传</strong></h1><p id="77ec" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">大约一年前，我和叶夫根尼·尼日比茨基一起参加了“海狮”<a class="ae lk" href="https://www.kaggle.com/c/noaa-fisheries-steller-sea-lion-population-count" rel="noopener ugc nofollow" target="_blank">卡格尔比赛</a>。这项任务是在无人机拍摄的图像上计算海狗的数量。标记只是作为尸体的坐标给出的，但在某些时候，<a class="ae lk" href="https://www.kaggle.com/iglovikov" rel="noopener ugc nofollow" target="_blank"> Vladimir Iglovikov </a>用bboxes标记它们，并慷慨地与社区分享。</p><p id="7ab3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我决定通过<a class="ae lk" rel="noopener" href="/@keremturgutlu/semantic-segmentation-u-net-part-1-d8d6f6005066">分割</a>来解决这个任务，在第一阶段只有海豹的bboxes作为目标。在几次训练迭代之后，很容易找到一些所有东西都不好的硬样本。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ln"><img src="../Images/e532955606a0f2349ba7fbc1082f6fe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*affGD9SXMfCAgiUT_i6wsA.png"/></div></div></figure><p id="f3e6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于此示例，您可以选择没有封条的大区域，手动将遮罩设置为零，并添加到训练集中。因此，Evgeny和我反复训练了一个模型，它已经学会了甚至为大个体分割海狗的鳍。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lo"><img src="../Images/ed2607abd499000d0975300b508088d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*drweUcRVTdqVUkjdMhUj-A.png"/></div></div></figure><h1 id="73ea" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">外壳检测和提取</strong></h1><p id="d276" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">又回到披萨上了。为了识别所选择和过滤的照片上的外壳，最佳选择是将任务交给标记者。一般来说，一些贴标机对相同的样本有不同的工作方式，但那时我们已经对这种情况应用了共识算法，并将其用于bboxes。这就是为什么我只是做了几个例子，并把它给了贴标机。最后，我得到了500个样本，特别是突出显示了外壳的区域。</p><p id="2fc6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了识别所选过滤照片上的外壳，我制作了几个例子供贴标机使用。</p><p id="cf34" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我将Kaggle海狮比赛中的代码更正式地应用到当前的过程中。在训练的第一次迭代之后，仍然清楚模型的错误之处。预测的置信度定义如下:</p><p id="8c4e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1-(灰色区域的面积)/(遮罩的面积)</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lp"><img src="../Images/bf5d6a4ec7e143a3d4a4872c5c928909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3PISyWOajtIj68rfy3H8lg.png"/></div></div></figure><p id="9164" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，为了进行下一次迭代，使盒子接近面具，一个小集合用TTA预测了面具。这在某种程度上可以被认为是WAAAAGH式的知识<a class="ae lk" rel="noopener" href="/neural-machines/knowledge-distillation-dc241d7c2322">提炼</a>，但称之为<a class="ae lk" href="https://towardsdatascience.com/simple-explanation-of-semi-supervised-learning-and-pseudo-labeling-c2218e8c769b" rel="noopener" target="_blank">伪标注</a>会更正确。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lj"><img src="../Images/b0b060eb5a311fde929ea2ac317c0188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJgDCox54dAtscuFDQIWkA.png"/></div></div></figure><p id="bf7c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我必须手动确定置信度的某个阈值，我们将使用该阈值来形成新的训练集。也可以选择标记出最复杂的样本，这样集合就失败了。我认为这将是有用的，并在消化午餐时自己标记了大约20张图片。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lq"><img src="../Images/ac4e8778e82351f6038ce08fad35840c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aEZgTWLZGLMbCaesBjlUgA.png"/></div></div></figure><h1 id="7ae3" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">最终模特培训</strong></h1><p id="9a30" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">最后——最后的模型训练。为了准备样本，我用蒙版提取了地壳区域。我还通过扩张来稍微膨胀蒙版，并把它应用到图片上来去除背景，因为它不应该包含任何关于面团质量的信息。然后我从Imagenet微调了几个模型。总之，我收集了大约14k个合适的样本。因此，我没有训练整个神经网络，而只是训练最后一组conv层，以防止过度拟合。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lr"><img src="../Images/74c7494a262fd24d0b107d29018ae9d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CugbiuN2wCmArTWTNQoyRw.png"/></div></div></figure><p id="5740" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最好的单一模型是Inception-Resnet-v2，其单一模型的ROC-AUC为0.700。如果你不选择任何东西并在没有遮罩的原始照片上训练网络，那么ROC-AUC将是0.58。</p><h1 id="faed" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">验证</strong></h1><p id="fb8a" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在我开发解决方案的时候，DODO pizza带着下一批数据回来了，有可能在一个诚实的拒绝者身上测试整个管道。我们在上面测试了整个管道，得到ROC-AUC 0.83。</p><p id="ed46" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是，我们还是不能不犯错误。并考虑到它们出现的原因，再次对模型进行训练，取得了积极的效果。现在让我们看看错误:</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ls"><img src="../Images/1895c0f66eedfe12706b62477a03bf9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MUreH9ObH50gVX4U"/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Top False Positive</figcaption></figure><p id="2cd3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里可以看出，它们与面包皮标记错误有关，因为有明显的生面团变质迹象。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lx"><img src="../Images/3a04d53fedecd1e616db28637f1be29e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCM3XWhvSQAuSPXXzQwIeg.png"/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Top False Negative</figcaption></figure><p id="c226" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里的错误是由于第一个模型未能选择正确的观点，导致难以定义优质面团的关键特征。</p><h1 id="4936" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">结论</strong></h1><p id="d8c2" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我的同事有时取笑我用Unet通过分段解决了几乎所有的任务。但是我仍然希望他们会喜欢它，因为这是一个相当强大和方便的方法。它允许可视化模型错误并满怀信心地预测它们，这有时真的可以挽救局面。此外，整个管道看起来非常简单，现在有一堆可用于任何框架的存储库。</p><p id="2333" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就这样。现在是时候吃块披萨放松一下了。干杯！</p></div></div>    
</body>
</html>