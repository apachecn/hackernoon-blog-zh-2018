<html>
<head>
<title>Practical Inversion of Control in TypeScript with a Functional Twist</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有函数扭曲的打字稿中的实际控制反转</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/practical-inversion-of-control-in-typescript-42a7364511af?source=collection_archive---------0-----------------------#2018-09-15">https://medium.com/hackernoon/practical-inversion-of-control-in-typescript-42a7364511af?source=collection_archive---------0-----------------------#2018-09-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7d76" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大家好，欢迎来到一个在分布式团队中工作时在TypeScript中实现控制反转(IOC)的真实例子。</p><h2 id="e18a" class="jp jq hu bd jr js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj dt translated">剧透警报！都是外挂！</h2><figure class="kl km kn ko fq kp fe ff paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="fe ff kk"><img src="../Images/f44e0c9a6fa01575a160b28e4e4b81da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ryYoghrXkMT0SRVKgWDiQQ.jpeg"/></div></div><figcaption class="kw kx fg fe ff ky kz bd b be z ek">Photo by rawpixel on Unsplash</figcaption></figure><h1 id="6bbe" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">灵感</h1><p id="8494" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">昨天，我们在工作中表演了艾米丽·巴切的《网球重构式》。</p><blockquote class="lx ly lz"><p id="dbfe" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">你的任务是编写一个包含逻辑的“TennisGame”类，它将正确的分数以字符串的形式输出，并显示在记分牌上。当一个玩家得分时，它触发一个方法在你的类上被调用，让你知道谁得分了。稍后，您将从记分板收到一个调用“score()”，询问它应该显示什么。这个方法应该返回一个带有当前分数的字符串。[1]</p></blockquote><p id="0366" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">六个开发人员试图解开代码，太棒了！</p><p id="7b9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<a class="ae lw" href="https://github.com/emilybache/Tennis-Refactoring-Kata" rel="noopener ugc nofollow" target="_blank">形</a>中有了游戏的本质细节，我只是要强调它的游戏性。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="d57d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">玩家一</strong>开始强势，到了对他有利的“三十比十五”，但是p <strong class="it hv">层二</strong>召唤他的内劲，赢了！</p><p id="bb5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们重构了<a class="ae lw" href="https://github.com/emilybache/Tennis-Refactoring-Kata/blob/master/typescript/src/TennisGame1.ts" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> TennisGame </strong> </a>类，该类向调用者公开了<strong class="it hv"> wonPoint </strong>和<strong class="it hv"> getScore </strong>方法，使其<a class="ae lw" href="https://github.com/emilybache/Tennis-Refactoring-Kata/blob/master/typescript/tests/TennisTest.test.ts" rel="noopener ugc nofollow" target="_blank">测试</a>保持绿色。在重构过程中，我感觉到像玩家和分数这样的概念正试图浮现出来。</p><p id="a30e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那天晚上晚些时候，我和一个朋友一起喝啤酒，也许喝得更多，讨论罗伯特·c·马丁的坚实原理。</p><p id="0ad2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">两件事打动了我:</p><ol class=""><li id="b014" class="mg mh hu it b iu iv iy iz jc mi jg mj jk mk jo ml mm mn mo dt translated">我没有生活，在酒馆里谈论IOC</li><li id="26e8" class="mg mh hu it b iu mp iy mq jc mr jg ms jk mt jo ml mm mn mo dt translated">我刚刚为我的下一篇文章找到了主题！</li></ol><h1 id="0de6" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">什么是控制反转？</h1><blockquote class="lx ly lz"><p id="904c" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">依赖倒置原则(DIP)告诉我们，最灵活的系统是那些源代码依赖仅指抽象，而不是具体化的系统[2]</p></blockquote><p id="e932" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">基于上面引用的Robert C. Martin的解释，让我们通过一个令人兴奋的旅程来强调这个设计原则。</p><h1 id="bebc" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">任务</h1><p id="3ac4" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">让我们实现在形中描述的同样的网球游戏，但是有一个分布式的团队在工作。</p><h1 id="daea" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">认识弗兰克<strong class="ak">游戏领主</strong></h1><p id="8c17" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">Frank在纽约市一栋办公楼的25层工作，负责整个游戏及其在公司系统中的集成。他知道在分布式项目中分离关注点的重要性。</p><h1 id="b037" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">合同</h1><p id="6423" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">弗兰克喝了一杯咖啡，思考了一下网球比赛，写下了它的界面。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="d2be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">游戏的状态将由两个玩家对象组成。每个玩家都将有一个<strong class="it hv">名</strong>和总<strong class="it hv">点数</strong>。有了这些信息，Frank编写了<strong class="it hv">播放器</strong>界面。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><blockquote class="lx ly lz"><p id="16b8" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">在我的文章中找到更多关于状态的概念以及它如何应用于现代单页面应用程序的信息。</p></blockquote><p id="aa40" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，Gamelord先生阅读了需求，并意识到他需要一种管理玩家的方法，即<strong class="it hv"> ManagePlayers </strong>接口。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="f0e6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">看着窗外，啜饮着咖啡，谜题的最后一部分揭开了，分数<strong class="it hv"/>！</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="13e6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">弗兰克放下他的咖啡，冲向打印机。他带着五个<strong class="it hv">契约</strong>回来，每个契约代表他刚刚建模的一个接口。</p><p id="a11b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">弗兰克的工作是履行网球比赛的合同。由于他的日程繁忙，他将不得不委派其他人。</p><h1 id="e324" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">团队的其他成员</h1><ul class=""><li id="97d2" class="mg mh hu it b iu lr iy ls jc mu jg mv jk mw jo mx mm mn mo dt translated">在左上角，来自伦敦的数据库爱好者Bill Playwell！</li><li id="ef4c" class="mg mh hu it b iu mp iy mq jc mr jg ms jk mt jo mx mm mn mo dt translated">在右角，来自雷克雅未克的哈斯克尔爱好者安迪·斯考森！</li></ul><h1 id="9f47" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">谈话</h1><ul class=""><li id="ea1c" class="mg mh hu it b iu lr iy ls jc mu jg mv jk mw jo mx mm mn mo dt translated">比尔·普莱维尔，你是否接受《代码婚姻》中的<strong class="it hv">玩家</strong>和<strong class="it hv">管理玩家</strong>契约，并发誓要很好地履行？</li><li id="d84b" class="mg mh hu it b iu mp iy mq jc mr jg ms jk mt jo mx mm mn mo dt translated">安迪·斯考森，你愿意接受《代码婚姻》中的<strong class="it hv">计算分数</strong>契约并发誓好好履行吗？</li></ul><p id="4597" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Frank以一种允许每个人独立工作的方式创建了这个项目的结构。他将在<strong class="it hv">游戏</strong>文件夹中工作，比尔在<strong class="it hv">玩家</strong>文件夹中工作，安迪在<strong class="it hv">分数</strong>文件夹中工作。</p><figure class="kl km kn ko fq kp fe ff paragraph-image"><div class="fe ff my"><img src="../Images/dc141a8841b2936944a838f87126f7f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*RtnnLJagzeFC38SwTrNF0w.png"/></div></figure><blockquote class="lx ly lz"><p id="065b" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">注意到<strong class="it hv">游戏文件夹</strong>包含所有接口，而<strong class="it hv">玩家</strong>和<strong class="it hv">分数</strong>文件夹只包含实现了吗？</p></blockquote><h1 id="f4fc" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">弗兰克的实现</h1><p id="965d" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">Gamelord先生创建<a class="ae lw" href="https://www.youtube.com/watch?v=iZLP4qOwY8I" rel="noopener ugc nofollow" target="_blank">curried</a><strong class="it hv">createGameFactory</strong><a class="ae lw" href="https://www.youtube.com/watch?v=ImwrezYhw4w" rel="noopener ugc nofollow" target="_blank">工厂函数</a>。它期望一个<strong class="it hv"> ManagePlayers </strong>对象和一个<strong class="it hv"> calculateScore </strong>函数作为参数，并返回另一个函数。后者将玩家的名字作为参数，返回游戏。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="1edf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> createGameFactory </strong>没有导入任何具体的实现。它的源代码依赖于<strong class="it hv">计算分数</strong>和<strong class="it hv">管理玩家</strong>接口。</p><figure class="kl km kn ko fq kp fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/e091136b9aeb24a7274d298318824171.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*0bJLqoNifjWaHz8M5OGwBQ.png"/></div></figure><p id="cbc7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不依赖于实际的实现，允许Frank甚至在Bill和Any开始他们的工作之前完成他的工作。</p><h1 id="6d99" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">法案的实施</h1><p id="3d9a" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">这是一个寒冷的英国早晨，普莱维尔先生开始工作。他用纯函数实现了<strong class="it hv"> ManagePlayers </strong>接口所需的五个方法，并将它们作为一个整体导出。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="e7d4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Bill的模块有两个抽象的源代码依赖关系，即<strong class="it hv">播放器</strong>和<strong class="it hv">管理播放器</strong>接口，导出laters实现。</p><figure class="kl km kn ko fq kp fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/8da44e0541edfac07e32b26dc1630dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*aRuW7sGj6A-Wr2-Wes79Aw.png"/></div></figure><h1 id="8a03" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">安迪的作品</h1><p id="7a34" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">当Scoreson先生想到一个纯函数组成的描述性算法时，那是一个美丽的冰岛早晨。这让他实现了时间分离。<strong class="it hv"> calculateScore </strong> <a class="ae lw" href="https://www.youtube.com/watch?v=CQqwU2Ixu-U" rel="noopener ugc nofollow" target="_blank">闭包</a>中的函数被调用的顺序无关紧要。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="f439" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Andy的模块有一个单独的<strong class="it hv">抽象</strong>依赖关系，即<strong class="it hv">计算分数</strong>接口，它导出它的实现。</p><figure class="kl km kn ko fq kp fe ff paragraph-image"><div class="fe ff na"><img src="../Images/cbdbc7c21ce7c02bcff76c3cbedf3bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*29vxSjV9bw_9CUyrRjKCIQ.png"/></div></figure><h1 id="6a98" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">差不多完成了</h1><p id="9640" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">所有的具体实现<strong class="it hv"> createGameFactory </strong>、<strong class="it hv"> PlayerManager </strong>、<strong class="it hv"> calculateScore </strong>都只依靠抽象接口，强大的契约。</p><p id="0b18" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">弗兰克自豪地思考着他的团队，并将所有东西放在<strong class="it hv"> createGame </strong> <a class="ae lw" href="https://www.youtube.com/watch?v=BMUiFMZr7vk" rel="noopener ugc nofollow" target="_blank">高阶函数</a>中。</p><figure class="kl km kn ko fq kp"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="d1d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">源代码依赖图如下所示:</p><figure class="kl km kn ko fq kp fe ff paragraph-image"><div class="fe ff my"><img src="../Images/c4983dffc51c338273b6e63838d6a95f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*UZqObWeaUeB8l_FFQkMylQ.png"/></div></figure><blockquote class="lx ly lz"><p id="8bb0" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">注意到<strong class="it hv"> createGameFactory </strong>的蓝色源代码依赖箭头是如何指向<strong class="it hv"> calculateScore </strong>和<strong class="it hv"> PlayerManager </strong>实现的红色依赖的相反方向的吗？</p></blockquote><h1 id="eb35" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">那是控制反转！</h1><p id="e8e9" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">IOC允许开发人员一起工作，而不会互相影响。</p><p id="f4b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它使工程师能够暂时解耦。弗兰克在比尔和安迪之前完成了工作。Andy可以在Bill之后很长时间开始，而不会有问题和源代码控制冲突。</p><p id="c9a2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它使类似于<strong class="it hv"> PlayerManager </strong>和<strong class="it hv"> calculateScore </strong>的模块成为应用的插件。</p><p id="d485" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果安迪认为他可以改进评分算法，他可以改变它而不影响应用程序的其余部分。</p><h1 id="5d23" class="la jq hu bd jr lb lc ld jv le lf lg jz lh li lj kc lk ll lm kf ln lo lp ki lq dt translated">结束了</h1><p id="4edb" class="pw-post-body-paragraph ir is hu it b iu lr iw ix iy ls ja jb jc lt je jf jg lu ji jj jk lv jm jn jo hn dt translated">如果你想和我分享你的想法，请吧！一起学习是我写作的原因！</p><p id="a0fe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">想要更多吗？观看<a class="nb nc gr" href="https://medium.com/u/5b25bc58c2e?source=post_page-----42a7364511af--------------------------------" rel="noopener" target="_blank"> Mattias Petter Johansson </a>在<a class="ae lw" href="https://www.youtube.com/watch?v=-kpEP4JeEdc" rel="noopener ugc nofollow" target="_blank">反转控制</a>的视频。</p><p id="b8d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于学术报告，你可以购买罗伯特·c·马丁的<a class="ae lw" href="https://cleancoders.com/episode/clean-code-episode-13/show" rel="noopener ugc nofollow" target="_blank">视频</a>(我不是附属公司)。</p><p id="8906" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在这里找到<strong class="it hv">的回购</strong>并给出代码<a class="ae lw" href="https://github.com/intojs/inversion-of-control" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="6c81" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">[1]<a class="ae lw" href="https://github.com/emilybache/Tennis-Refactoring-Kata/blob/master/javascript/TennisTest.js" rel="noopener ugc nofollow" target="_blank">https://github . com/Emily bache/Tennis-Refactoring-Kata/blob/master/JavaScript/Tennis test . js</a></p><p id="99dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">[2] Robert C. Martin，2017，《干净的架构:软件结构和设计的工匠指南》</p></div></div>    
</body>
</html>