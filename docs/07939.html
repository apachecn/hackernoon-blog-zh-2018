<html>
<head>
<title>How to get started with the React Context API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何开始使用React上下文API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-get-started-with-the-react-context-api-ccc41728fa59?source=collection_archive---------0-----------------------#2018-09-19">https://medium.com/hackernoon/how-to-get-started-with-the-react-context-api-ccc41728fa59?source=collection_archive---------0-----------------------#2018-09-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="d0ff" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">使用React上下文API来更改应用程序中的主题！</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/870e27e832f8aaeb436bfab85707b375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eT36GHtPkkqGlrmZkMIT5Q.jpeg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Photo by <a class="ae jz" href="https://unsplash.com/photos/9m1V6A8Fm-A?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">John Michael Thomson</a> on <a class="ae jz" href="https://unsplash.com/search/photos/context?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="951b" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">不过先来点<strong class="ak">语境</strong>！🤣</h2><p id="8f89" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">好吧，把糟糕的双关语放在一边，让我们来看看React Context API是做什么的。有一个来自<a class="ae jz" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank"> React docs </a>的很棒的俏皮话…</p><blockquote class="lr"><p id="83da" class="ls lt hu bd lu lv lw lx ly lz ma lq ek translated"><em class="mb">上下文提供了一种通过组件树传递数据的方法，而不必在每一层手工传递属性。</em></p></blockquote><p id="3698" class="pw-post-body-paragraph ky kz hu la b lb mc iv ld le md iy lg kl me li lj kp mf ll lm kt mg lo lp lq hn dt translated">或者换句话说，你可以使用React上下文API来避免<a class="ae jz" href="https://blog.kentcdodds.com/prop-drilling-bb62e02cb691" rel="noopener ugc nofollow" target="_blank">道具钻</a>。如果你需要关于这个概念的更多细节，请查看提供的链接。</p><p id="f595" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">我之前在我的Gatsby博客中介绍过React Context API的实现，我在做的时候做了记录。你可以看到<a class="ae jz" href="https://blog.scottspence.me/react-context-api-with-gatsby" rel="noopener ugc nofollow" target="_blank">这里是如何进行的</a>。</p><p id="3974" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><em class="mm">可以从</em><a class="ae jz" href="https://twitter.com/leighchalliday" rel="noopener ugc nofollow" target="_blank"><em class="mm">@ leighchalliday</em></a><em class="mm">中找到一个解释API的很好的资源，其中有一个关于这个主题的很好的用例</em>  <em class="mm">。</em></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/0ed90ce7bf6198544ad71f63215162e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0jwgqOHUqXVtSZhN.gif"/></div></div></figure><h2 id="a468" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">我们正在做的事情…</h2><p id="660b" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">在这篇文章中，我们将扩展我们为<a class="ae jz" rel="noopener" href="/styled-components/styled-components-getting-started-c9818acbcbbd">styled-components getting started</a>创建的例子。因为它有大部分代码，我们需要从React上下文API开始。</p><p id="547c" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">我们将扩展该示例来管理示例应用程序的主题状态。</p><p id="c19e" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">所以总而言之:</p><ul class=""><li id="80bf" class="mo mp hu la b lb mh le mi kl mq kp mr kt ms lq mt mu mv mw dt translated">搭建基础CreateReact应用程序</li><li id="6c0b" class="mo mp hu la b lb mx le my kl mz kp na kt nb lq mt mu mv mw dt translated">使用样式组件💅用于造型</li><li id="cf33" class="mo mp hu la b lb mx le my kl mz kp na kt nb lq mt mu mv mw dt translated">使用React上下文API添加主题进行切换</li><li id="6779" class="mo mp hu la b lb mx le my kl mz kp na kt nb lq mt mu mv mw dt translated">使用React上下文API！</li></ul><h2 id="6c81" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">我们需要的是…</h2><p id="bed9" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">我们需要的只是一个互联网连接和一个现代化的网络浏览器！因为我们将在棒极了的<a class="ae jz" href="https://codesandbox.io" rel="noopener ugc nofollow" target="_blank">代码沙箱</a>中在线完成所有这些！</p><p id="0ba9" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">无论你有没有GitHub账户，CodeSandbox都会让你直接开始<a class="ae jz" href="https://codesandbox.io/s/new" rel="noopener ugc nofollow" target="_blank">编码</a>。</p><h2 id="8a8c" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">版本:</h2><p id="cf31" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated"><strong class="la hv">本指南正与以下依赖版本一起使用。</strong></p><ul class=""><li id="c0cc" class="mo mp hu la b lb mh le mi kl mq kp mr kt ms lq mt mu mv mw dt translated">反应:16.4.2</li><li id="79f3" class="mo mp hu la b lb mx le my kl mz kp na kt nb lq mt mu mv mw dt translated">反应范围:16.4.2</li><li id="f214" class="mo mp hu la b lb mx le my kl mz kp na kt nb lq mt mu mv mw dt translated">反应脚本:1.1.4</li><li id="7fc2" class="mo mp hu la b lb mx le my kl mz kp na kt nb lq mt mu mv mw dt translated">样式组件:3.4.5</li></ul><h1 id="e528" class="nc kb hu bd kc nd ne nf kg ng nh ni kk ja nj jb ko jd nk je ks jg nl jh kw nm dt translated">我们开始吧</h1><p id="46c1" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">所以让我们再一次回顾一下基本的创建-反应-应用程序的主题。这一次，我们将使用React上下文API来管理状态，而不是将状态添加到组件中。有人会说这对于主题切换来说有点大材小用了。React文档中给出了一个<a class="ae jz" href="https://reactjs.org/docs/context.html#when-to-use-context" rel="noopener ugc nofollow" target="_blank">何时使用上下文API </a>的例子，所以我将让您决定这一点的有效性。</p><p id="627e" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">对于这个例子，我希望它能让您更清楚地了解如何在应用程序中使用上下文API。</p><h2 id="2d09" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated"><strong class="ak">依赖关系</strong></h2><p id="4fb6" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated"><a class="ae jz" href="https://codesandbox.io/s/new" rel="noopener ugc nofollow" target="_blank">打开一个React CodeSandbox </a>并添加<code class="eh nn no np nq b">styled-components</code>作为依赖项:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/4a1f250abaa5a8e36be23f73d6214cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X1OtCskKqWcZ7Dom.gif"/></div></div></figure><h2 id="4568" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated"><strong class="ak">文件结构</strong></h2><p id="e269" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated"><a class="ae jz" href="https://en.wiktionary.org/wiki/bikeshedding" rel="noopener ugc nofollow" target="_blank"> bikeshedding </a>的另一个领域是文件结构。在这个场景中，我们为<code class="eh nn no np nq b">components</code>、<code class="eh nn no np nq b">contexts</code>和<code class="eh nn no np nq b">theme</code>添加文件夹。请随意组织你认为合适的文件，这就是我们在❤️这个例子中要做的</p><p id="80e7" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">将目录添加到<code class="eh nn no np nq b">src</code>文件夹中，这样我们就可以添加一些组件了。文件结构应该如下所示:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="84f1" class="ka kb hu nq b fv nv nw l nx ny">context-demo/<br/>├─ public/<br/>├─ src/<br/>│  └─ components/<br/>│  └─ contexts/<br/>│  └─ theme/<br/>└─ package.json</span></pre><h2 id="24cb" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">搭建一个基本的Create React应用程序</h2><p id="b5c7" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">好了，我们要做的是将一个<code class="eh nn no np nq b">App.js</code>组件添加到<code class="eh nn no np nq b">components</code>文件夹中，然后在<code class="eh nn no np nq b">src/index.js</code>文件中使用它。</p><p id="0898" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><code class="eh nn no np nq b">App.js</code>组件可以是一个<a class="ae jz" href="https://reactjs.org/docs/state-and-lifecycle.html#the-data-flows-down" rel="noopener ugc nofollow" target="_blank">无状态功能组件</a>，因为我们将使用上下文API处理状态。</p><p id="cbae" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">在这里你可以看到我创建目录和添加<code class="eh nn no np nq b">App.js</code>组件时的粗略输入。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/1654c48faaacb41ea002ae3c158c8bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VLHh_4ddjKPunUU-.gif"/></div></div></figure><p id="dfbc" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">然后我们可以删除<code class="eh nn no np nq b">style.css</code>文件和<code class="eh nn no np nq b">src/index.js.</code>中的引用，我们将使用样式化组件进行样式化💅然后使用我们的<code class="eh nn no np nq b">App.js</code>组件:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/7b29be83b26e2ebdf6124e8d04aa9608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O7ItFm5GexGWaF29.gif"/></div></div></figure><p id="61bd" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">好的，我将<code class="eh nn no np nq b">App.js</code>组件从<code class="eh nn no np nq b">src/index.js</code>文件中抽象出来的原因是，当我们使用上下文API时，我们可以将其添加到应用程序的最高级别，即<code class="eh nn no np nq b">src/index.js</code>。</p><h2 id="f472" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">其余的呢？</h2><p id="df06" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">所以这不是真正的Create React应用程序，因为我们使用的是CodeSandbox。我已经检查了在<a class="ae jz" rel="noopener" href="/styled-components/styled-components-getting-started-c9818acbcbbd">样式化组件入门</a>帖子中使用的基本样式。是时候参考它来模仿我们需要的风格了。</p><p id="ca63" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">这意味着，我们将重用组件，而不是深入研究构成基本Create React应用程序外观的每个组件的样式。现在将涉及到一些复制粘贴。</p><p id="a1f4" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">Create React App样板代码有一个文件，我们在<a class="ae jz" rel="noopener" href="/styled-components/styled-components-getting-started-c9818acbcbbd">styled-components getting started</a>帖子中对其进行了样式化处理，这个文件就是<code class="eh nn no np nq b">App.js</code>文件。<code class="eh nn no np nq b">App.js</code>的基本风格是:</p><p id="92ab" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><code class="eh nn no np nq b"><strong class="la hv">App.css</strong></code></p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="ddf7" class="ka kb hu nq b fv nv nw l nx ny">.App {<br/>  text-align: center;<br/>}</span><span id="eefd" class="ka kb hu nq b fv nz nw l nx ny">.App-logo {<br/>  animation: App-logo-spin infinite 20s linear;<br/>  height: 80px;<br/>}</span><span id="e7ae" class="ka kb hu nq b fv nz nw l nx ny">.App-header {<br/>  background-color: #222;<br/>  height: 150px;<br/>  padding: 20px;<br/>  color: white;<br/>}</span><span id="2924" class="ka kb hu nq b fv nz nw l nx ny">.App-title {<br/>  font-size: 1.5em;<br/>}</span><span id="b2c5" class="ka kb hu nq b fv nz nw l nx ny">.App-intro {<br/>  font-size: large;<br/>}</span><span id="521a" class="ka kb hu nq b fv nz nw l nx ny">@keyframes App-logo-spin {<br/>  from {<br/>    transform: rotate(0deg);<br/>  }<br/>  to {<br/>    transform: rotate(360deg);<br/>  }<br/>}</span></pre><h2 id="68ce" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">使用样式化组件进行样式化</h2><p id="74df" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">现在我们将从带有样式化组件的<code class="eh nn no np nq b">App.css</code>文件中重新创建样式。让我们在这里列出它们，并逐一查看:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="35a5" class="ka kb hu nq b fv nv nw l nx ny">AppWrapper<br/>AppHeader<br/>AppTitle<br/>rotate360<br/>AppLogo<br/>#<em class="mm"> We’re adding our own styles for<br/></em>AppIntro<br/>Underline<br/>StyledHyperLink<br/>Button</span></pre><p id="d7c5" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><code class="eh nn no np nq b">AppWrapper</code>是顶级包装器，在一个更大的组件中，可以用于CSS网格或Flexbox的布局。在我们的例子中，我们将文本居中对齐。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/e79f6ddac5e0d844dd13b8ff801c4df6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2B9Y6gUnA_YAD1WU.gif"/></div></div></figure><p id="c45c" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">够直接了吧。现在，剩下的大部分组件将使用样式化组件<code class="eh nn no np nq b"><a class="ae jz" href="https://www.styled-components.com/docs/advanced#theming" rel="noopener ugc nofollow" target="_blank">ThemeProvider</a></code>，这就是我们要从上下文API传递主题的内容。</p><h2 id="eade" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">使用React上下文API添加主题进行切换</h2><p id="a3ac" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">好了，我们需要定义一些主题来传递给<code class="eh nn no np nq b">ThemeProvider</code>。我们将定义我们想要更改的几个主题方面，它们是:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="9ca3" class="ka kb hu nq b fv nv nw l nx ny">primary //<em class="mm"> colour<br/></em>secondary //<em class="mm"> colour<br/></em>danger //<em class="mm"> colour<br/></em>fontHeader //<em class="mm"> font<br/></em>fontBody //<em class="mm"> font</em></span></pre><p id="ea13" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">在<code class="eh nn no np nq b">theme</code>目录中创建一个包含主题对象的文件，并将其命名为<code class="eh nn no np nq b">globalStyle.js</code>。添加以下内容:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="b017" class="ka kb hu nq b fv nv nw l nx ny"><em class="mm">import</em> { injectGlobal } <em class="mm">from</em> 'styled-components'</span><span id="cb19" class="ka kb hu nq b fv nz nw l nx ny">export<em class="mm"> </em>const<em class="mm"> themes </em>=<em class="mm"> </em>{<br/>  <em class="mm">theme1</em>:<em class="mm"> </em>{<br/>    <em class="mm">primary</em>:<em class="mm"> </em>'#ff0198',<br/>    <em class="mm">secondary</em>:<em class="mm"> </em>'#01c1d6',<br/>    <em class="mm">danger</em>:<em class="mm"> </em>'#e50000',<br/>    <em class="mm">fontHeader</em>:<em class="mm"> </em>'Old Standard TT, sans, sans-serif',<br/>    <em class="mm">fontBody</em>:<em class="mm"> </em>'Nunito, sans-serif'<br/>  },<br/>  <em class="mm">theme2</em>:<em class="mm"> </em>{<br/>    <em class="mm">primary</em>:<em class="mm"> </em>'#6e27c5',<br/>    <em class="mm">secondary</em>:<em class="mm"> </em>'#ffb617',<br/>    <em class="mm">danger</em>:<em class="mm"> </em>'#ff1919',<br/>    <em class="mm">fontHeader</em>:<em class="mm"> </em>'Enriqueta, sans-serif',<br/>    <em class="mm">fontBody</em>:<em class="mm"> </em>'Exo 2, sans, sans-serif'<br/>  },<br/>  <em class="mm">theme3</em>:<em class="mm"> </em>{<br/>    <em class="mm">primary</em>:<em class="mm"> </em>'#f16623',<br/>    <em class="mm">secondary</em>:<em class="mm"> </em>'#2e2e86',<br/>    <em class="mm">danger</em>:<em class="mm"> </em>'#cc0000',<br/>    <em class="mm">fontHeader</em>:<em class="mm"> </em>'Kaushan Script, sans, sans-serif',<br/>    <em class="mm">fontBody</em>:<em class="mm"> </em>'Headland One, sans-serif'<br/>  }<br/>}</span><span id="d724" class="ka kb hu nq b fv nz nw l nx ny">injectGlobal`<br/>  @import url('https://fonts.googleapis.com/css?family=Old+Standard+TT:400,700|Nunito:400,700'|Enriqueta:400,700|Exo+2:400,700|Kaushan+Script:400,700|Headland+One:400,700|');</span><span id="ea31" class="ka kb hu nq b fv nz nw l nx ny">  body {<br/>    padding: 0;<br/>    margin: 0;<br/>  }<br/>`</span></pre><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/71dd34b356581631ee95f2da6e4f9638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wIRe9R-ei5e41l_z.gif"/></div></div></figure><p id="f3c8" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">好了，除了设置供以后使用的样式之外，这里什么也没有发生。</p><p id="0ce5" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">你会注意到这里使用了<code class="eh nn no np nq b">injectGlobal</code>。这是我们为整个应用程序设置字体的地方。<code class="eh nn no np nq b">ingectGlobal</code> <a class="ae jz" href="https://stackoverflow.com/a/42899789/1138354" rel="noopener ugc nofollow" target="_blank">应该在一个app中使用一次</a>这样设置全局样式。</p><p id="48d8" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">向前！现在让我们把重点放在将基本的应用程序风格放入<code class="eh nn no np nq b">App.js</code>组件中。我们现在可以开始使用<code class="eh nn no np nq b">App.js</code>中的<code class="eh nn no np nq b">ThemeProvider</code>。为此，现在，为了获得一些视觉反馈，我们将应用来自<code class="eh nn no np nq b">globalStyle.js</code>中<code class="eh nn no np nq b">themes</code>对象的一个主题。这是如此，因为我们正在添加组件，我们可以看到应用的主题。</p><p id="4436" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">我们现在可以用<code class="eh nn no np nq b">AppHeader</code>来做这件事，它是一个样式化的div:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="c960" class="ka kb hu nq b fv nv nw l nx ny">const<em class="mm"> AppHeader </em>=<em class="mm"> </em>styled<em class="mm">.div</em>`<br/>  <em class="mm">height: 12rem;<br/>  padding: 1rem;<br/>  color: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.dark</em>}<em class="mm">;<br/>  background-color: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.primary</em>}<em class="mm">;<br/></em>`</span></pre><p id="5959" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">你会注意到这里我们开始使用样式组件，<code class="eh nn no np nq b">theme</code>道具。如果我们现在粘贴这段代码，在<code class="eh nn no np nq b">ThemeProvider</code>被传递给<code class="eh nn no np nq b">theme</code>对象之前不会有任何变化。我们将使用<code class="eh nn no np nq b">ThemeProvider</code>组件包装<code class="eh nn no np nq b">App.js</code>，这样由<code class="eh nn no np nq b">ThemeProvider</code>封装的任何组件都能够接收<code class="eh nn no np nq b">theme</code>道具。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/3550812e5c88e733871fdb38ae81289b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kn7Z9WQVYpyo2Saf.gif"/></div></div></figure><p id="a0c3" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><code class="eh nn no np nq b">AppTitle</code>即将成为h1所以:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="6236" class="ka kb hu nq b fv nv nw l nx ny">const<em class="mm"> AppTitle </em>=<em class="mm"> </em>styled<em class="mm">.h1</em>`<br/>  <em class="mm">font-family: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.fontHeader</em>}<em class="mm">;<br/></em>`</span></pre><p id="ec71" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">对于旋转的React徽标，我们可以使用之前在<a class="ae jz" href="https://codesandbox.io/s/x26q7l9vyq" rel="noopener ugc nofollow" target="_blank">样式化组件入门示例</a>中使用的资源。我们可以将它添加到<code class="eh nn no np nq b">App.js</code>组件顶部的导入中，并将其作为<code class="eh nn no np nq b">img</code>标签添加到<code class="eh nn no np nq b">AppLogo</code>样式的组件中:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="d029" class="ka kb hu nq b fv nv nw l nx ny">const<em class="mm"> logo </em>= 'https://user-images.githubusercontent.com/234708/37256552-32635a02-2554-11e8-8fe3-8ab5bd969d8e.png'</span></pre><p id="28d3" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">为了React徽标上的动画，需要在<code class="eh nn no np nq b">ThemeProvider</code>旁边导入<code class="eh nn no np nq b">keyframes</code>辅助对象。</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="5c5e" class="ka kb hu nq b fv nv nw l nx ny">const<em class="mm"> rotate360 </em>=<em class="mm"> </em>keyframes`<br/>  <em class="mm">from {<br/>    transform: rotate(0deg);<br/>  }<br/>  to {<br/>    transform: rotate(360deg);<br/>  }<br/></em>`</span><span id="8880" class="ka kb hu nq b fv nz nw l nx ny">const<em class="mm"> AppLogo </em>=<em class="mm"> </em>styled<em class="mm">.img</em>`<br/>  <em class="mm">animation: </em>${rotate360}<em class="mm"> infinite 5s linear;<br/>  height: 80px;<br/>  &amp;:hover {<br/>    animation: </em>${rotate360}<em class="mm"> infinite 1s linear;<br/>  }<br/></em>`</span></pre><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/f940eb8e791d2f1024fa70a8a31b2b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-CwAbScLvZAuKVNL.gif"/></div></div></figure><h2 id="9665" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">共享组件</h2><p id="a69c" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">共享组件包含在<a class="ae jz" href="https://blog.scottspence.me/styled-components-getting-started" rel="noopener ugc nofollow" target="_blank">风格化组件入门</a>指南中。如果您需要更多信息，在本例中，我们将引入最后几个组件作为<code class="eh nn no np nq b">StyledHyperlink</code>和<code class="eh nn no np nq b">Button</code>的共享组件。在<code class="eh nn no np nq b">src/Shared.js</code>增加以下内容:</p><p id="77be" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><code class="eh nn no np nq b"><strong class="la hv">src/Shared.js</strong></code></p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="3222" class="ka kb hu nq b fv nv nw l nx ny"><em class="mm">import</em> styled, { css } <em class="mm">from</em> ‘styled-components’<br/>  export<em class="mm"> </em>const<em class="mm"> Button </em>=<em class="mm"> </em>styled<em class="mm">.button</em>`<br/>  <em class="mm">padding: 0.5rem 1rem;<br/>  margin: 0.5rem 1rem;<br/>  color: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.primary</em>}<em class="mm">;<br/>  font-size: 1rem;<br/>  box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);<br/>  cursor: pointer;<br/>  border: 2px solid </em>${<em class="mm">props </em>=&gt;<em class="mm"> </em>props<em class="mm">.border</em>}<em class="mm">;<br/>  background-color: Transparent;<br/>  text-transform: uppercase;<br/>  border-radius: 4px;<br/>  transition: all 0.1s;<br/>  &amp;:hover {<br/>    transform: translateY(1px);<br/>    box-shadow: 0 2px 3px rgba(0, 0, 0, 0.15);<br/>  }<br/>  </em>${<em class="mm">props </em>=&gt;<br/>    props<em class="mm">.primary </em>&amp;&amp;<br/>    css`<br/>      <em class="mm">background: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.primary</em>}<em class="mm">;<br/>      border: 2px solid </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.primary</em>}<em class="mm">;<br/>      color: white;<br/>    </em>`}<em class="mm">;<br/>  </em>${<em class="mm">props </em>=&gt;<br/>    props<em class="mm">.danger </em>&amp;&amp;<br/>    css`<br/>      <em class="mm">background: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.danger</em>}<em class="mm">;<br/>      border: 2px solid </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.danger</em>}<em class="mm">;<br/>      color: white;<br/>    </em>`}<em class="mm">;<br/>  &amp;:hover {<br/>    transform: translateY(2px);<br/>    box-shadow: 0 2px 3px rgba(0, 0, 0, 0.15);<br/>  }<br/></em>`</span><span id="1e7b" class="ka kb hu nq b fv nz nw l nx ny">export<em class="mm"> </em>const<em class="mm"> StyledHyperLink </em>=<em class="mm"> </em>styled<em class="mm">.a</em>`<br/>  <em class="mm">cursor: pointer;<br/>  &amp;:visited,<br/>  &amp;:active {<br/>    color: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.primary</em>}<em class="mm">;<br/>  }<br/>  &amp;:hover {<br/>    color: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.secondary</em>}<em class="mm">;<br/>  }<br/>  color: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.primary</em>}<em class="mm">;<br/></em>`</span></pre><p id="4552" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">然后像导入其他组件一样导入组件:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/ffdedecbec047a48d6b20e0bc92c87de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c0egeBraAuryjbfo.gif"/></div></div></figure><p id="fba7" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">现在最后三个组件，<code class="eh nn no np nq b">AppIntro</code>、<code class="eh nn no np nq b">Underline</code>和<code class="eh nn no np nq b">StyledHyperLink</code>:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="feab" class="ka kb hu nq b fv nv nw l nx ny">const<em class="mm"> AppIntro </em>=<em class="mm"> </em>styled<em class="mm">.p</em>`<br/>  <em class="mm">color: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.dark</em>}<em class="mm">;<br/>  font-size: large;<br/>  code {<br/>    font-size: 1.3rem;<br/>  }<br/>  font-family: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.fontBody</em>}<em class="mm">;<br/></em>`</span><span id="faaf" class="ka kb hu nq b fv nz nw l nx ny">const<em class="mm"> Underline </em>=<em class="mm"> </em>styled<em class="mm">.span</em>`<br/>  <em class="mm">border-bottom: 4px solid </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.secondary</em>}<em class="mm">;<br/></em>`</span><span id="d1d9" class="ka kb hu nq b fv nz nw l nx ny">const<em class="mm"> StyledHyperLink </em>=<em class="mm"> SHL.extend</em>`<br/>  <em class="mm">text-decoration: none;<br/>  font-family: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.fontBody</em>}<em class="mm">;<br/>  color: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.fontDark</em>}<em class="mm">;<br/></em>`</span></pre><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/1f3da0e013e4decbdd256e043d52ba6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0qpsKBGvrQ8IEzJK.gif"/></div></div></figure><p id="f3d9" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">将它们添加到<code class="eh nn no np nq b">AppLogo</code>样式的组件下。然后我们可以将剩下的组件添加到<code class="eh nn no np nq b">App</code>函数<code class="eh nn no np nq b">return</code>中，那么，准备好进行另一次复制粘贴了吗？这里:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="1ef2" class="ka kb hu nq b fv nv nw l nx ny">&lt;AppIntro&gt;<br/>  Bootstrapped with{' '}<br/>  &lt;Underline&gt;<br/>    &lt;code&gt;<br/>      &lt;StyledHyperLink<br/>        <em class="mm">href</em>={`https://github.com/facebook/create-react-app`}<br/>        <em class="mm">target</em>="_blank"<br/>        <em class="mm">rel</em>="noopener"<br/>      &gt;<br/>        create-react-app<br/>      &lt;/StyledHyperLink&gt;<br/>    &lt;/code&gt;<br/>  &lt;/Underline&gt;.<br/>&lt;/AppIntro&gt;<br/>&lt;AppIntro&gt;<br/>  Components styled with{' '}<br/>  &lt;Underline&gt;<br/>    &lt;code&gt;<br/>      &lt;StyledHyperLink<br/>        <em class="mm">href</em>={`https://www.styled-components.com`}<br/>        <em class="mm">target</em>="_blank"<br/>        <em class="mm">rel</em>="noopener"<br/>      &gt;<br/>        styled-components<br/>      &lt;/StyledHyperLink&gt;<br/>    &lt;/code&gt;<br/>  &lt;/Underline&gt;{' '}<br/>  &lt;span <em class="mm">role</em>="img" <em class="mm">aria-label</em>="nail polish"&gt;<br/>    💅  <br/>  &lt;/span&gt;<br/>&lt;/AppIntro&gt;<br/>&lt;AppIntro&gt;<br/>  Fonts picked with{' '}<br/>  &lt;Underline&gt;<br/>    &lt;code&gt;<br/>      &lt;StyledHyperLink<br/>        <em class="mm">href</em>={`https://fontjoy.com/`}<br/>        <em class="mm">target</em>="_blank"<br/>        <em class="mm">rel</em>="noopener"<br/>      &gt;<br/>        fontjoy.com<br/>      &lt;/StyledHyperLink&gt;<br/>    &lt;/code&gt;<br/>  &lt;/Underline&gt;<br/>&lt;/AppIntro&gt;<br/>&lt;Button&gt;Normal Button&lt;/Button&gt;<br/>&lt;Button <em class="mm">primary</em>&gt;Primary Button&lt;/Button&gt;<br/>&lt;Button <em class="mm">danger</em>&gt;Danger Button&lt;/Button&gt;</span></pre><p id="2a9a" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">抱歉代码墙！将它粘贴到结束的<code class="eh nn no np nq b">&lt;/AppHeader&gt;</code>标签下，这样我们就有了主题的基础了！</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/fed19dbf9ba78c902bc481d7fbde11ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zaN9aZBSrzmjhd84.gif"/></div></div></figure><p id="8622" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">好吗？看起来怎么样？</p><p id="573e" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">现在我们有了一个使用样式化组件的基本React应用程序！</p><h1 id="ac9e" class="nc kb hu bd kc nd ne nf kg ng nh ni kk ja nj jb ko jd nk je ks jg nl jh kw nm dt translated">使用React上下文API</h1><p id="862a" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">现在是重头戏！在这里，我们将讨论:</p><ul class=""><li id="450c" class="mo mp hu la b lb mh le mi kl mq kp mr kt ms lq mt mu mv mw dt translated">制作主题背景。</li><li id="0c14" class="mo mp hu la b lb mx le my kl mz kp na kt nb lq mt mu mv mw dt translated">对组件使用上下文API。</li><li id="4614" class="mo mp hu la b lb mx le my kl mz kp na kt nb lq mt mu mv mw dt translated">在多个组件中使用上下文API。</li></ul><p id="554b" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">因此，通过组件传递不必要的状态是我们可以使用上下文API来避免的。如果我们看一下<a class="ae jz" href="https://codesandbox.io/s/x26q7l9vyq" rel="noopener ugc nofollow" target="_blank">样式组件入门示例</a>，我们可以看到在<code class="eh nn no np nq b">App.js</code>组件中管理的状态。</p><p id="3d92" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><code class="eh nn no np nq b">handleThemeChange</code>函数必须传递给<code class="eh nn no np nq b">ThemeSelect</code>组件，就像任何道具都需要传递一样。这是一个简化的例子。很容易想象，如果这个组件存在于一个页脚组件或一个菜单项上，那么会有几个其他组件需要通过它们传递状态，而这些组件实际上并不需要该状态或属性。有道理吗？</p><h2 id="ccd0" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated"><strong class="ak">示例</strong></h2><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="343e" class="ka kb hu nq b fv nv nw l nx ny">&lt;App&gt;                {/*<em class="mm"> state begins here </em>*/}<br/>  &lt;Header&gt;           {/*<em class="mm"> through here </em>*/}<br/>    &lt;Navigation&gt;     {/*<em class="mm"> and here </em>*/}<br/>      &lt;ThemeSelect&gt;  {/*<em class="mm"> to be used here </em>*/}<br/>    &lt;/Navigation&gt;<br/>  &lt;/Header&gt;<br/>  &lt;Footer/&gt;<br/>&lt;/App&gt;</span></pre><h2 id="7585" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">添加网站主题上下文</h2><p id="900e" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">在我们的<code class="eh nn no np nq b">src/contexts/</code>目录中，我们将让我们的<code class="eh nn no np nq b">SiteThemeContext.js</code>导入做出反应，并定义和导出我们的上下文:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="6089" class="ka kb hu nq b fv nv nw l nx ny"><em class="mm">import</em> React <em class="mm">from</em> 'react'</span><span id="f5fb" class="ka kb hu nq b fv nz nw l nx ny">export<em class="mm"> </em>const<em class="mm"> SiteThemeContext </em>=<em class="mm"> </em>React<em class="mm">.</em>createContext()</span></pre><h2 id="d509" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">那么什么是语境呢？</h2><p id="aef8" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">上下文由两部分组成，提供者和消费者。您有一个提供者，它将在组件树中尽可能高的位置，以便多个消费者可以从提供者那里获得状态和属性。</p><p id="1d43" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">希望您还记得我们从<code class="eh nn no np nq b">src/index.js</code>文件中抽象出<code class="eh nn no np nq b">function App</code>组件的时候。这样我们就可以在应用程序的最高级别添加上下文提供者，在<code class="eh nn no np nq b">src/index.js</code>文件中。这意味着应用程序中的任何消费者，无论组件树有多深，都可以从顶层获得状态和道具。</p><p id="ac6f" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">现在创建一个提供者，这个提供者是一个常规的React组件，所以:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="78a3" class="ka kb hu nq b fv nv nw l nx ny"><em class="mm">import</em> React <em class="mm">from</em> 'react'</span><span id="7737" class="ka kb hu nq b fv nz nw l nx ny">export<em class="mm"> </em>const<em class="mm"> SiteThemeContext </em>=<em class="mm"> </em>React<em class="mm">.</em>createContext()</span><span id="cc09" class="ka kb hu nq b fv nz nw l nx ny">export class SiteThemeProvider <em class="mm">extends</em> React<em class="mm">.</em>Component {</span><span id="a21f" class="ka kb hu nq b fv nz nw l nx ny">  render() {<br/>    <em class="mm">return</em> (<br/>      &lt;SiteThemeContext.Provider <em class="mm">value</em>={}&gt;<br/>        {this<em class="mm">.props.</em>children}<br/>      &lt;/SiteThemeContext.Provider&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="10e8" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">由<code class="eh nn no np nq b">&lt;SiteThemeProvider&gt;</code>返回的是<code class="eh nn no np nq b">&lt;SiteThemeContext.Provider&gt;</code>和该组件的子组件。你必须提供给提供商的一个道具是<code class="eh nn no np nq b">value</code>道具。这是消费者可以访问的变量。消费者是<code class="eh nn no np nq b">&lt;SiteThemeContext.Consumer&gt;</code>(稍后将详细介绍)。</p><p id="92c1" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">所以我们现在能做的是让传入<code class="eh nn no np nq b">value</code>的东西成为一个对象<code class="eh nn no np nq b">value={{}}</code>，这样它就能存储在<code class="eh nn no np nq b">SiteThemeContt</code>中定义的状态和函数的多个属性。</p><p id="aa4a" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">上下文的状态需要是<code class="eh nn no np nq b">theme</code>。我们需要从<code class="eh nn no np nq b">src/theme/globalStyle</code>导入主题，并将其添加到状态中。我们将默认主题(和状态)为<code class="eh nn no np nq b">theme1</code>，并通过扩展到状态[<code class="eh nn no np nq b">…</code>❤️].]将它的副本添加到<code class="eh nn no np nq b">value</code>道具中它应该是这样的:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="3ba7" class="ka kb hu nq b fv nv nw l nx ny"><em class="mm">import</em> React <em class="mm">from</em> 'react'<br/><em class="mm">import</em> PropTypes <em class="mm">from</em> 'prop-types'</span><span id="46b0" class="ka kb hu nq b fv nz nw l nx ny"><em class="mm">import</em> { themes } <em class="mm">from</em> '../theme/globalStyle'</span><span id="66de" class="ka kb hu nq b fv nz nw l nx ny">export<em class="mm"> </em>const<em class="mm"> SiteThemeContext </em>=<em class="mm"> </em>React<em class="mm">.</em>createContext()</span><span id="5210" class="ka kb hu nq b fv nz nw l nx ny"><br/>export class SiteThemeProvider <em class="mm">extends</em> React<em class="mm">.</em>Component {<br/>  state = {<br/>    theme: themes['theme1']<br/>  }<br/>  <br/>  render() {<br/>    <em class="mm">return</em> (<br/>      &lt;SiteThemeContext.Provider<br/>        <em class="mm">value</em>={{<br/>          ...this<em class="mm">.</em>state<br/>        }}&gt;<br/>        {this<em class="mm">.props.</em>children}<br/>      &lt;/SiteThemeContext.Provider&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="247e" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">好了，已经有一段时间没有加gif了，是时候再加一张了！</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/49373e23d9941764bc14fda09696a523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fWILsWukV2rUFqlPjixsew.gif"/></div></div></figure><p id="28cf" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">并引入<code class="eh nn no np nq b">themes</code>并添加状态:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/842296fdf0265a59f7a5af65d72dc631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UEZASmYKDtWz4F8I.gif"/></div></div></figure><p id="439a" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">现在，我们可以向提供者添加一个函数，根据通过<code class="eh nn no np nq b">handleThemeChange</code>事件值选择的内容来更改主题状态:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="ce71" class="ka kb hu nq b fv nv nw l nx ny">handleThemeChange = e =&gt; {<br/>  const<em class="mm"> key </em>=<em class="mm"> </em>e<em class="mm">.target.value<br/>  </em>const<em class="mm"> theme </em>=<em class="mm"> </em>themes[key]<br/>  this<em class="mm">.</em>setState({ theme })<br/>}</span></pre><p id="7a95" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">任何想要使用它的提供者都可以使用它。我们需要将它添加到<code class="eh nn no np nq b">value</code>道具中，就像这样:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="d202" class="ka kb hu nq b fv nv nw l nx ny"><em class="mm">import</em> React <em class="mm">from</em> 'react'<br/><em class="mm">import</em> PropTypes <em class="mm">from</em> 'prop-types'</span><span id="470c" class="ka kb hu nq b fv nz nw l nx ny"><em class="mm">import</em> { themes } <em class="mm">from</em> '../theme/globalStyle'</span><span id="c791" class="ka kb hu nq b fv nz nw l nx ny">export<em class="mm"> </em>const<em class="mm"> SiteThemeContext </em>=<em class="mm"> </em>React<em class="mm">.</em>createContext()</span><span id="ab46" class="ka kb hu nq b fv nz nw l nx ny">export class SiteThemeProvider <em class="mm">extends</em> React<em class="mm">.</em>Component {<br/>  state = {<br/>    theme: themes['theme1']<br/>  }</span><span id="7420" class="ka kb hu nq b fv nz nw l nx ny">  handleThemeChange = e =&gt; {<br/>    const<em class="mm"> key </em>=<em class="mm"> </em>e<em class="mm">.target.value<br/>    </em>const<em class="mm"> theme </em>=<em class="mm"> </em>themes[key]<br/>    this<em class="mm">.</em>setState({ theme })<br/>  }</span><span id="50b6" class="ka kb hu nq b fv nz nw l nx ny">  render() {<br/>    <em class="mm">return</em> (<br/>      &lt;SiteThemeContext.Provider<br/>        <em class="mm">value</em>={{<br/>          ...this<em class="mm">.</em>state,<br/>          handleThemeChange: this<em class="mm">.</em>handleThemeChange<br/>        }}&gt;<br/>        {this<em class="mm">.props.</em>children}<br/>      &lt;/SiteThemeContext.Provider&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="1b93" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">好了，这就是站点主题上下文组件，非常简单，对吗？</p><p id="8d5f" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">我应该提到的是，<code class="eh nn no np nq b">handleThemeChange</code>函数中的<code class="eh nn no np nq b">e</code>将是我们将要制作的主题选择框中的事件。</p><p id="2ed9" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">让我们完成添加函数并将其添加到状态中:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff oa"><img src="../Images/fe463eaeeb41948cd7dbbe8d2f5eb0cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CjzWXVo1VgwQnfgEtlzFPg.gif"/></div></div></figure><p id="5a49" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">现在我们可以将主题提供者添加到<code class="eh nn no np nq b">src/index.js</code>中，这样依赖关系树中更低的任何东西都可以通过消费者访问它。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/7f17022d42ef2ea5863d557aa4c82fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O5zRu4-RtMRoA6mJ.gif"/></div></div></figure><h2 id="75ce" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">添加主题选择</h2><p id="a070" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">现在我们想要通过<code class="eh nn no np nq b">SiteThemeContext</code>调用<code class="eh nn no np nq b">SiteThemeProvider</code>的一部分<code class="eh nn no np nq b">handleThemeChange</code>函数。我相信现在这一切都很有意义(🤣)所以让我们直接进入这里，定义我们将用来使用一个<code class="eh nn no np nq b">ThemeSelect</code>组件消费<code class="eh nn no np nq b">SiteThemeContext.Provider</code>的组件！</p><p id="f846" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">在<code class="eh nn no np nq b">src/components</code>目录中添加一个新的<code class="eh nn no np nq b">ThemeSelect.js</code>组件。这是我们将与消费者一起消费站点主题上下文的地方。</p><p id="f466" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">消费者的孩子不是一个组件，而是一个函数。所以我们需要做的是在函数的返回中选择主题。</p><p id="4aae" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">让我们首先设置组成选择的样式化组件:一个选择框、一些选项和一个包装器。</p><p id="3d2a" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">首先，我们将在没有消费者的情况下进行，然后我们将把它添加进来。</p><p id="4902" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><code class="eh nn no np nq b"><strong class="la hv">ThemeSelect.js</strong></code></p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="4b41" class="ka kb hu nq b fv nv nw l nx ny"><em class="mm">import</em> React <em class="mm">from</em> 'react'<br/><em class="mm">import</em> styled <em class="mm">from</em> 'styled-components'</span><span id="5a95" class="ka kb hu nq b fv nz nw l nx ny"><em class="mm">import</em> { themes } <em class="mm">from</em> '../theme/globalStyle'</span><span id="fae2" class="ka kb hu nq b fv nz nw l nx ny">const<em class="mm"> SelectWrapper </em>=<em class="mm"> </em>styled<em class="mm">.div</em>`<br/>  <em class="mm">margin: 0rem 0.5rem 0rem 0.25rem;<br/>  padding: 0rem 0.5rem 0rem 0.25rem;<br/></em>`</span><span id="0abe" class="ka kb hu nq b fv nz nw l nx ny">const<em class="mm"> Select </em>=<em class="mm"> </em>styled<em class="mm">.select</em>`<br/>  <em class="mm">margin: 1.5rem 0.5rem;<br/>  padding: 0.25rem 0.5rem;<br/>  font-family: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.fontBody</em>}<em class="mm">;<br/>  border: 2px solid </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.secondary</em>}<em class="mm">;<br/>  box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.1);<br/>  background: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.foreground</em>}<em class="mm">;<br/>  border-radius: 4px;<br/></em>`</span><span id="aee9" class="ka kb hu nq b fv nz nw l nx ny">export<em class="mm"> </em>const<em class="mm"> SelectOpt </em>=<em class="mm"> </em>styled<em class="mm">.option</em>`<br/>  <em class="mm">font-family: </em>${({<em class="mm"> theme </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>theme<em class="mm">.fontBody</em>}<em class="mm">;<br/></em>`</span><span id="781e" class="ka kb hu nq b fv nz nw l nx ny">const<em class="mm"> </em>ThemeSelect<em class="mm"> </em>=<em class="mm"> props </em>=&gt;<em class="mm"> </em>{<br/>  <em class="mm">return </em>(<br/>    &lt;SelectWrapper&gt;<br/>      &lt;Select&gt;<br/>        {<em class="mm">Object.keys</em>(themes)<em class="mm">.</em>map((<em class="mm">theme</em>,<em class="mm"> index</em>)<em class="mm"> </em>=&gt;<em class="mm"> </em>{<br/>          <em class="mm">return </em>(<br/>            &lt;SelectOpt <em class="mm">key</em>={index} <em class="mm">value</em>={theme}&gt;<br/>              Theme {index + 1}<br/>            &lt;/SelectOpt&gt;<br/>          )<br/>        })}<br/>      &lt;/Select&gt;<br/>    &lt;/SelectWrapper&gt;<br/>  )<br/>}</span><span id="7d46" class="ka kb hu nq b fv nz nw l nx ny">export default ThemeSelect</span></pre><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/e8a1935b9d90fcd416dce15c08bad17f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZIEBDoUYqPVEd95q.gif"/></div></div></figure><p id="2a63" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">因此，我们可以在<code class="eh nn no np nq b">themes</code>对象中列出可用的主题。但仅此而已，处理主题变化的功能存在于<code class="eh nn no np nq b">SiteThemeProvider</code>上。</p><p id="ee83" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">回到<code class="eh nn no np nq b">SiteThemeContext.Consumer</code>。正如我前面提到的，消费者的孩子是一个函数。<code class="eh nn no np nq b">()=&gt;()</code>第一部分是来自提供者的<code class="eh nn no np nq b">value</code>(<code class="eh nn no np nq b">&lt;SiteThemeContext.Provider&gt;</code>)，所以让我们快速看一下我们之前在提供者中定义的内容:</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="4dec" class="ka kb hu nq b fv nv nw l nx ny">value={{<br/>  …this<em class="mm">.</em>state,<br/>  handleThemeChange: this<em class="mm">.</em>handleThemeChange<br/>}}</span></pre><p id="b24c" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">从<code class="eh nn no np nq b">&lt;SiteThemeContext.Provider&gt;</code>可得到的是状态和功能。因此，我们可以提取这些项目中的任何一项，并将其传递给提供者。或者换句话说，消费者可以访问这些值。</p><p id="6fde" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">这里我们可以使用析构来拉我们需要改变主题的<code class="eh nn no np nq b">handleThemeChange</code>函数。</p><pre class="jk jl jm jn fq nr nq ns nt aw nu dt"><span id="e019" class="ka kb hu nq b fv nv nw l nx ny"><em class="mm">import</em> React <em class="mm">from</em> 'react'</span><span id="37bb" class="ka kb hu nq b fv nz nw l nx ny"><em class="mm">import</em> { SiteThemeContext } <em class="mm">from</em> '../contexts/SiteThemeContext'</span><span id="f8a8" class="ka kb hu nq b fv nz nw l nx ny">const<em class="mm"> </em>ThemeSelect<em class="mm"> </em>=<em class="mm"> props </em>=&gt;<em class="mm"> </em>{<br/>  <em class="mm">return </em>(<br/>    &lt;SiteThemeContext.Consumer&gt;<br/>      {({<em class="mm"> handleThemeChange </em>})<em class="mm"> </em>=&gt;<em class="mm"> </em>()}<br/>    &lt;/SiteThemeContext.Consumer&gt;<br/>  )<br/>}</span><span id="24f8" class="ka kb hu nq b fv nz nw l nx ny">export default ThemeSelect</span></pre><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/36b5ad34c8eff0b2e7d761b3232daec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N2RZPedvr6F6yAeQ.gif"/></div></div></figure><p id="254b" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">目前这不会改变主题，因为我们已经将它硬编码到样式化组件<code class="eh nn no np nq b">ThemeProvider</code>中。我们想要做的是在<code class="eh nn no np nq b">SiteThemeContext</code>中为当前选择的主题使用一个消费者。</p><p id="0d0a" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">在此之前，我们还需要添加我们想要用来将事件(<code class="eh nn no np nq b">e</code>)传递给<code class="eh nn no np nq b">SiteThemeContext</code>上的<code class="eh nn no np nq b">handleThemeChange</code>函数的<code class="eh nn no np nq b">onChange</code>事件。</p><p id="1f36" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">然后在<code class="eh nn no np nq b">App</code>组件中，我们可以导入我们的<code class="eh nn no np nq b">&lt;SiteThemeContext.Consumer&gt;</code>来消费<code class="eh nn no np nq b">SiteThemeContext</code>状态上的<code class="eh nn no np nq b">theme</code>，并将其传递给样式化组件<code class="eh nn no np nq b">ThemeProvider</code>。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/613a7bf0a1ce918033ee311061b719c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1BoI5lsi3a99E-bR.gif"/></div></div></figure><h2 id="79d9" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">想了解更多？</h2><p id="cc6c" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">正如本文开头提到的，一个很好的资源是<a class="ae jz" href="https://twitter.com/leighchalliday" rel="noopener ugc nofollow" target="_blank"> @leighchalliday </a>和<a class="ae jz" href="https://www.youtube.com/channel/UCWPY8W-FAZ2HdDiJp2RC_sQ" rel="noopener ugc nofollow" target="_blank">他的YouTube频道</a>。您可以找到他的React上下文API的<a class="ae jz" href="https://www.youtube.com/watch?v=yzQ_XulhQFw" rel="noopener ugc nofollow" target="_blank">伟大用例</a>。</p><p id="0928" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">还有spectrum上的<a class="ae jz" href="https://spectrum.chat/react" rel="noopener ugc nofollow" target="_blank"> React社区</a>和spectrum上的<a class="ae jz" href="https://spectrum.chat/styled-components" rel="noopener ugc nofollow" target="_blank">风格组件</a>。</p><p id="5d44" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated"><a class="ae jz" href="https://codesandbox.io/s/5vl16n5oxp" rel="noopener ugc nofollow" target="_blank">演练的示例代码</a>可在<a class="ae jz" href="https://codesandbox.io" rel="noopener ugc nofollow" target="_blank"> CodeSandbox </a>上获得。</p><h2 id="b716" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">感谢阅读🙏</h2><p id="5349" class="pw-post-body-paragraph ky kz hu la b lb lc iv ld le lf iy lg kl lh li lj kp lk ll lm kt ln lo lp lq hn dt translated">如果我错过了什么，或者有更好的方法，请告诉我。</p><p id="66ba" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">这是最初发布在我的<a class="ae jz" href="https://blog.scottspence.me" rel="noopener ugc nofollow" target="_blank">博客上的</a>你可以在这里查看<a class="ae jz" href="https://blog.scottspence.me/react-context-api-getting-started" rel="noopener ugc nofollow" target="_blank"/>如果你喜欢，请看看我的其他内容。</p><p id="ec11" class="pw-post-body-paragraph ky kz hu la b lb mh iv ld le mi iy lg kl mj li lj kp mk ll lm kt ml lo lp lq hn dt translated">在Twitter上关注我，或者在GitHub上问我任何问题。</p></div></div>    
</body>
</html>