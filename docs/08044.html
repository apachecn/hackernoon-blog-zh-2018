<html>
<head>
<title>Configuring your server to provide HTTPS using Let's Encrypt and Nginx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Let's Encrypt和Nginx配置服务器以提供HTTPS</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/configuring-your-server-to-provide-https-using-lets-encrypt-and-nginx-e46a5ae93e41?source=collection_archive---------1-----------------------#2018-09-24">https://medium.com/hackernoon/configuring-your-server-to-provide-https-using-lets-encrypt-and-nginx-e46a5ae93e41?source=collection_archive---------1-----------------------#2018-09-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="696c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本教程将教你如何安装Nginx，并让它管理<strong class="it hv">免费的</strong>让我们加密TLS/SSL证书。如果你现在开始并且想要一个安全的服务器安装，我建议你阅读<a class="ae jp" href="https://medium.freecodecamp.org/how-to-create-your-first-safe-server-ready-for-production-f1cc60eec69a" rel="noopener ugc nofollow" target="_blank">这篇文章</a>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/92ef4b3068645dfe89a8627870de680f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EShBAToAyxauu6CMsQO6IQ.jpeg"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Photo by <a class="ae jp" href="https://unsplash.com/photos/OXIv6mxmFPA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae jp" href="https://unsplash.com/search/photos/safe?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bd65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好的，让我们从一些定义开始，然后我们从神奇的步骤开始:</p><ul class=""><li id="af00" class="kg kh hu it b iu iv iy iz jc ki jg kj jk kk jo kl km kn ko dt translated">Let's encrypt:是一个证书颁发机构(CA ),它提供免费的数字证书以允许网站上的HTTPS。</li><li id="bcab" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated"><a class="ae jp" href="https://hackernoon.com/tagged/nginx" rel="noopener ugc nofollow" target="_blank"> Nginx </a>:是一个web服务器，也可以用作负载均衡器、反向代理、邮件代理和<a class="ae jp" href="https://hackernoon.com/tagged/http" rel="noopener ugc nofollow" target="_blank"> HTTP </a>缓存。</li><li id="080c" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">HTTPS:(安全超文本传输协议)是HTTP协议在使用SSL/TLS协议的附加安全层上的实现。</li><li id="e256" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">SSL/TLS协议:传输层安全性(TLS)及其前身安全套接字层(SSL)(现在已被否决)是在计算机网络上提供通信安全性的应用程序协议。</li><li id="588b" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">Certbot:是一个在服务器上运行的客户端(工具),用于获取和部署SSL证书。</li></ul><p id="731b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为什么我应该有一个HTTPS网站？您应该使用HTTPS的主要原因是，您可以保证与服务器的连接是安全的。</p><p id="b1fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好了，你只有一个没有任何动态内容的HTML页面。所以，其他原因是:1)谷歌开始使用HTTPS作为排名因素，所以如果你想让你的网站在谷歌的搜索中有一个好的位置，你应该考虑使用这个。2) Chrome开始对非HTTPS的页面显示“不安全”警告，所以如果你不想吓到你的用户，这是一个拥有它的理由。</p><p id="0d89" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设您已经安装并运行了一个Ubuntu web服务器，并且有一个域名指向它(在本教程中域名是temporary-website.tk)，我们将在其中安装Nginx。</p><h1 id="f009" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">安装Nginx和Certbot</h1><p id="e8d5" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">连接到您的服务器。键入以下命令安装Nginx:</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="ed13" class="mc kv hu ly b fv md me l mf mg">$ sudo apt-get install nginx</span></pre><p id="85ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装后，您可以访问您的域，并检查一些已经可用(没有HTTPS):</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mh"><img src="../Images/d1d0efcc7638ffe9e69249c18dfab80e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*luFxoxn8TSaWzhruNMFj-g.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Insecure website</figcaption></figure><p id="371e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用Certbot存储库来获取软件包的最新版本。我们来补充一下:</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="0fa5" class="mc kv hu ly b fv md me l mf mg">$ sudo add-apt-repository ppa:certbot/certbot</span></pre><p id="28d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">更新包列表以包含最新项目:</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="4518" class="mc kv hu ly b fv md me l mf mg">$ sudo apt-get update</span></pre><p id="7491" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装Certbot的Nginx包:</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="8994" class="mc kv hu ly b fv md me l mf mg">$ sudo apt-get install python-certbot-nginx</span></pre><h1 id="b3fe" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">生成证书并配置Nginx</h1><p id="0f4d" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">最后，让Certbot获得一个证书，并自动为我们配置它:</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="31a7" class="mc kv hu ly b fv md me l mf mg">$ sudo certbot --nginx -d <strong class="ly hv">temporary-website.tk</strong></span></pre><p id="ec59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于这一步，您需要添加您的电子邮件(如果证书即将过期，您将收到来自Let's Encrypt的通知)。您将有两个选择:是否将请求从HTTP重定向到HTTPS。我选择了重定向。</p><p id="4024" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您以前设置了防火墙，请阅读下面的“允许防火墙”一节，如果没有，就是这样，您将拥有使用HTTPS的网站。🎉</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mi"><img src="../Images/18d860fd1dd5e6aaaa1a2899940187dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9nsRlScBtk99F-8bPlIS-w.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Safer website</figcaption></figure><p id="6de4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该网站现在在HTTPS名下运作。现在让我们再做一些改进。</p><h1 id="bb40" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">允许防火墙</h1><p id="38a1" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">如果您遵循了本文中的步骤，现在您需要允许HTTPS连接:</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="5b57" class="mc kv hu ly b fv md me l mf mg">$ sudo ufw allow https</span></pre><h1 id="76e7" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">更新Diffie-Hellman参数</h1><p id="bca0" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">如果你遵循前面的步骤，你可以<strong class="it hv">忽略这个</strong>部分。但是，如果您只是一个好奇的读者，并且已经在您的服务器上实现了这些步骤，一个技巧是检查Diffie-Hellman参数的大小。一些旧的安装有1024位参数，一些研究和NIST的建议是将Diffie-Hellman参数的大小增加到2048位。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mj"><img src="../Images/7a2c886f3740f5496809a85f5edb5dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsfggRXRj1GEhu9R9l3cFQ.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">This is how 1024-bit parameters seem like</figcaption></figure><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mk"><img src="../Images/4360b68e91a5365074c439562e79ddd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmwTB_jSvEtm91dBCPWoPg.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">This is how 2048-bit parameters seem like</figcaption></figure><p id="f950" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要创建更长的2048位参数，请运行下面的代码。我建议您在文件夹<code class="eh ml mm mn ly b">etc/letsencrypt/</code>上运行这个命令，因为它是存储默认密钥(<code class="eh ml mm mn ly b">ssl-dhparams.pem</code>)的地方</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="78f6" class="mc kv hu ly b fv md me l mf mg">$ openssl dhparam -out ssl-dhparams-2048.pem 2048</span></pre><p id="d4d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">生成这些参数后，我们需要更改Nginx的配置。转到文件夹<code class="eh ml mm mn ly b">/etc/nginx/sites-enabled/</code>，编辑文件<code class="eh ml mm mn ly b">default</code>，如下所示:</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="77c4" class="mc kv hu ly b fv md me l mf mg">server {<br/>    ...<br/>    ssl_dhparam /etc/letsencrypt/ssl-dhparams-2048.pem;<br/>    ...<br/>}</span></pre><p id="6b39" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在重启Nginx:</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="f2eb" class="mc kv hu ly b fv md me l mf mg">$ sudo service nginx restart</span></pre><h1 id="c1bf" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">更新SSL证书</h1><p id="5fc9" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">让我们加密每90天到期的证书。所以需要经常更新证书。安装的Certbot包附带一个cron作业，该作业会在证书过期之前自动更新证书。</p><p id="3e48" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">运行此命令测试更新过程(参数<code class="eh ml mm mn ly b">--dry-run</code>测试时不将任何证书保存到磁盘):</p><pre class="jr js jt ju fq lx ly lz ma aw mb dt"><span id="d7a8" class="mc kv hu ly b fv md me l mf mg">sudo certbot renew --dry-run</span></pre><p id="132d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果成功了，你就可以放松并享受生活了😂。Certbot将负责为您定期更新证书。</p></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><p id="caaa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@flaviohfreitas"> <em class="mv">关注我</em> </a> <em class="mv">如果你想看更多我的文章</em>😘如果你喜欢这篇文章，一定要喜欢它，给我很多掌声——它对作者来说意味着整个世界。</p></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><p id="bcb3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Flávio H. de Freitas 是一名企业家、工程师、技术爱好者、梦想家和旅行家。先后在<strong class="it hv">巴西</strong>、<strong class="it hv">硅谷和欧洲</strong>担任<strong class="it hv"> CTO </strong>。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mw mx l"/></div></figure></div></div>    
</body>
</html>