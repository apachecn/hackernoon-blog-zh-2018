<html>
<head>
<title>ML.NET Sentiment Analysis with MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用MongoDB进行ML.NET情感分析</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ml-net-sentiment-analysis-with-mongodb-62e10e61fda1?source=collection_archive---------12-----------------------#2018-09-24">https://medium.com/hackernoon/ml-net-sentiment-analysis-with-mongodb-62e10e61fda1?source=collection_archive---------12-----------------------#2018-09-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a97e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">今年早些时候(2018年5月)，微软宣布了<a class="ae jp" href="https://www.microsoft.com/net/learn/apps/machine-learning-and-ai/ml-dotnet" rel="noopener ugc nofollow" target="_blank">ML.NET</a>，这是一个开源的跨平台机器学习框架，专为。NET开发人员。能够将定制机器学习与集成是一个令人兴奋的消息。NET/C#应用程序。尽管在撰写本文时，ML.NET仍处于预览版0.5.0中，但您可以对其进行测试，以探索该框架的潜在能力。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/caaf0bb6421770438dd5cca77c49dcad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L5joGKsu-ssTF0vm"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">ml.net open source and cross-platform machine learning framework</figcaption></figure><p id="239e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">微软和第三方已经为ML.NET提供了许多教程。然而，示例数据源大多是TSV格式的<em class="kg"/><em class="kg">文件</em>(制表符分隔值)。这篇文章是为JSON格式的大量可用数据集、web事件的非结构化数据集或者已经存储在MongoDB中的数据集而写的。</p><p id="333a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这篇文章将关注如何使用存储在<a class="ae jp" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>中的数据开发ML.NET分类情感分析。这篇文章基于微软的<a class="ae jp" href="https://docs.microsoft.com/en-gb/dotnet/machine-learning/tutorials/sentiment-analysis" rel="noopener ugc nofollow" target="_blank">教程:在情感分析二进制分类中使用ML.NET</a>，有显著的不同:</p><ul class=""><li id="84f6" class="kh ki hu it b iu iv iy iz jc kj jg kk jk kl jo km kn ko kp dt translated">训练数据集是JSON格式的。</li><li id="6f90" class="kh ki hu it b iu kq iy kr jc ks jg kt jk ku jo km kn ko kp dt translated">它从MongoDB中读取数据作为数据源，而不是文件。</li><li id="df29" class="kh ki hu it b iu kq iy kr jc ks jg kt jk ku jo km kn ko kp dt translated">它使用。NET Core (Ubuntu/Linux)。</li></ul><p id="1576" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">完整的代码示例和数据可以在<a class="ae jp" href="https://github.com/sindbach/mlnet_mongodb" rel="noopener ugc nofollow" target="_blank">github.com/sindbach/mlnet_mongodb</a>上找到。我建议查看微软的教程以获取更多信息。</p><h1 id="a547" class="kv kw hu bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls dt translated"><strong class="ak">数据</strong></h1><p id="f04b" class="pw-post-body-paragraph ir is hu it b iu lt iw ix iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo hn dt translated">一个好的机器学习之旅总是从一个好的数据集开始。使用的数据集来自<a class="ae jp" href="https://www.yelp.com/dataset/challenge" rel="noopener ugc nofollow" target="_blank"> Yelp数据集挑战</a>。这些数据由Yelp提供，作为他们数据集挑战的一部分，将于2018年12月31日结束。数据大小约为2.9GB，最重要的是，是JSON格式的。</p><p id="29b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感兴趣的数据集的一部分在<em class="kg">yelp _ academic _ dataset _ review . JSON</em>文件中。情感分析模型将根据Yelp评论进行训练，以预测评论的情感是积极还是消极。</p><p id="ef5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是文件中的JSON结构示例:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="ea43" class="md kw hu lz b fv me mf l mg mh"><em class="kg">{<br/>     "business_id": "iCQpiavjjPzJ5_3gPD5Ebg",<br/>     "cool": 0,<br/>     "date": "2011-02-25",<br/>     "funny": 0,<br/>     "review_id": "x7mDIiDB3jEiPGPHOmDzyw",<br/>     "</em><strong class="lz hv"><em class="kg">stars</em></strong><em class="kg">": 2,<br/>     "</em><strong class="lz hv"><em class="kg">text</em></strong><em class="kg">": "The pizza was okay. Not the best I've had. I prefer Biaggio's on Flamingo / Fort Apache. The chef there can make a MUCH better NY style pizza. The pizzeria @ Cosmo was over priced for the quality and lack of personality in the food. Biaggio's is a much better pick if youre going for italian - family owned, home made recipes, people that actually CARE if you like their food. You dont get that at a pizzeria in a casino. I dont care what you say...",<br/>     "useful": 0,<br/>     "user_id": "msQe1u7Z_XuqjGoqhB0J5g"<br/>}</em></span></pre><p id="def0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从结构上看有两个重要的字段:<em class="kg">文字</em>和<em class="kg">星星</em>。<em class="kg">文本</em>字段包含用户的评论，而<em class="kg">星号</em>字段包含评论是否正面的指示。</p><h1 id="6604" class="kv kw hu bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls dt translated"><strong class="ak">数据库</strong></h1><p id="671b" class="pw-post-body-paragraph ir is hu it b iu lt iw ix iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo hn dt translated">将审查数据加载到数据库中的时间。在这篇文章中，数据将被加载到<a class="ae jp" href="https://www.mongodb.com/cloud/atlas" rel="noopener ugc nofollow" target="_blank"> MongoDB Atlas </a>中，这是一个面向MongoDB的云托管数据库即服务。如果你也想测试数据加载，你可以按照MongoDB的教程<a class="ae jp" href="https://docs.mongodb.com/manual/tutorial/atlas-free-tier-setup/" rel="noopener ugc nofollow" target="_blank">创建一个Atlas自由层</a>。</p><p id="80eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">可以使用mongoimport 将数据<a class="ae jp" href="https://docs.atlas.mongodb.com/import/mongoimport/" rel="noopener ugc nofollow" target="_blank">加载到MongoDB Atlas中。例如，以下命令将名为<em class="kg">yelp _ academic _ dataset _ review . JSON</em>的文件导入到<strong class="it hv"> yelp </strong>数据库中的<strong class="it hv"> review </strong>集合中:</a></p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="1f5d" class="md kw hu lz b fv me mf l mg mh"><em class="kg">mongoimport --uri "mongodb+srv://user:pwd@dataset-demo.mongodb.net/yelp" --collection review ./yelp_academic_dataset_review.json</em></span></pre><p id="cb39" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦导入完成，使用<a class="ae jp" href="https://docs.mongodb.com/manual/mongo/" rel="noopener ugc nofollow" target="_blank"> mongo shell </a>或<a class="ae jp" href="https://www.mongodb.com/products/compass" rel="noopener ugc nofollow" target="_blank"> MongoDB Compass </a>来检查数据。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mi"><img src="../Images/e33cbd6e9ba34b3faed9fe41451ff159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r5KY8o8Pnlu0a5lS"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">MongoDB Compass Document View</figcaption></figure><p id="47c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在开始编写代码之前，还有一项准备工作需要完成。因为我们试图创建一个二进制分类，我们需要一个二进制值来确定一个评论是正/ 1还是负/ 0。幸运的是，每个文档都有一个星级，从1到5，1表示负面评价，5表示正面评价。</p><p id="6cb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://docs.mongodb.com/manual/core/aggregation-pipeline/" rel="noopener ugc nofollow" target="_blank"> MongoDB聚合管道</a>可用于向数据集中添加一个名为<strong class="it hv">情感</strong>的新字段，该字段的值基于星级。情感值将按照以下逻辑确定:任何星级值大于3的评论都是正面的，任何等于或小于3的评论都是负面的。</p><p id="2075" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，使用<a class="ae jp" href="https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/" rel="noopener ugc nofollow" target="_blank"> $addFields </a>阶段添加新字段，使用<a class="ae jp" href="https://docs.mongodb.com/manual/reference/operator/aggregation/out/" rel="noopener ugc nofollow" target="_blank"> $out </a>阶段将输出存储到单独的集合中:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="46a3" class="md kw hu lz b fv me mf l mg mh"><em class="kg">db.review.aggregate([<br/>           {“$addFields”:<br/>              {“sentiment”:<br/>                  {“$cond”:<br/>                      {“if”:{“$gt”:["$stars", 3]}, <br/>                       “then”: 1, <br/>                       “else”: 0<br/>           }}}},<br/>           {"$out":"review_train"}]<br/>);</em></span></pre><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mj"><img src="../Images/fb6a367514984ed5c6ad8fbe45c021b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vYTwviYVlL8hQutp"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">MongoDB Compass Aggregation Pipeline Builder</figcaption></figure><p id="66f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注</strong>:你还可以在<a class="ae jp" href="https://github.com/sindbach/mlnet_mongodb/tree/master/data" rel="noopener ugc nofollow" target="_blank">github.com/sindbach/mlnet_mongodb:数据</a>上找到一小部分JSON数据。训练数据由5000条正面评论和5000条负面评论组成。</p><h1 id="e8ce" class="kv kw hu bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls dt translated"><strong class="ak">代码</strong></h1><p id="c0ff" class="pw-post-body-paragraph ir is hu it b iu lt iw ix iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo hn dt translated">这个帖子将使用<a class="ae jp" href="https://en.wikipedia.org/wiki/.NET_Core" rel="noopener ugc nofollow" target="_blank">。NET Core </a>，一个<a class="ae jp" href="https://en.wikipedia.org/wiki/Free_and_open-source" rel="noopener ugc nofollow" target="_blank">免费开源</a> <a class="ae jp" href="https://en.wikipedia.org/wiki/Managed_code" rel="noopener ugc nofollow" target="_blank">托管</a> <a class="ae jp" href="https://en.wikipedia.org/wiki/Software_framework" rel="noopener ugc nofollow" target="_blank">框架</a>用于<a class="ae jp" href="https://en.wikipedia.org/wiki/Microsoft_Windows" rel="noopener ugc nofollow" target="_blank">Windows</a><a class="ae jp" href="https://en.wikipedia.org/wiki/MacOS" rel="noopener ugc nofollow" target="_blank">MAC OS</a>和<a class="ae jp" href="https://en.wikipedia.org/wiki/Linux" rel="noopener ugc nofollow" target="_blank"> Linux </a>。项目仅有的两个依赖项是:</p><ul class=""><li id="a9f7" class="kh ki hu it b iu iv iy iz jc kj jg kk jk kl jo km kn ko kp dt translated"><a class="ae jp" href="http://mongodb.github.io/mongo-csharp-driver/" rel="noopener ugc nofollow" target="_blank"> MongoDB。NET/C#驱动程序</a>版本2.7.0</li><li id="acf3" class="kh ki hu it b iu kq iy kr jc ks jg kt jk ku jo km kn ko kp dt translated">ML.NET版本0.5.0</li></ul><p id="b5fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对<em class="kg">sentitementdata</em>类进行如下修改，以序列化和/或反序列化来自MongoDB的评审文档结构:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="77a0" class="md kw hu lz b fv me mf l mg mh">[BsonIgnoreExtraElements]<br/>public class SentimentData<br/>{<br/>    [BsonId]<br/>    [BsonRepresentation(BsonType.ObjectId)]<br/>     public string Id {get; set;}<br/>     [BsonElement("sentiment")]<br/>     public float Label { get; set; }<br/>     public string text { get; set; }<br/>}</span></pre><p id="0084" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kg">BsonIgnoreExtraElements</em>忽略文档中除了<em class="kg"> id </em>、<em class="kg">情感</em>(映射到标签)和<em class="kg">文本</em>之外的所有字段。这些是我们将用于培训的字段。接下来，我们实例化一个<em class="kg"> MongoClient </em>对象，使用连接字符串URI连接到MongoDB:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="7d53" class="md kw hu lz b fv me mf l mg mh">static string mongoURI = "mongodb+srv://usr:pwd@dataset-demo.mongodb.net";<br/>static readonly MongoClient client = new MongoClient(mongoURI);</span></pre><p id="f194" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<em class="kg"> MongoClient </em>对象，我们可以访问<strong class="it hv"> yelp </strong>数据库和<strong class="it hv"> review_train </strong>集合中的数据:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="b1f8" class="md kw hu lz b fv me mf l mg mh">var db = client.GetDatabase("yelp");<br/>var collection = db.GetCollection&lt;SentimentData&gt;("review_train");</span></pre><p id="5229" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">ML.NET<a class="ae jp" href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.ml.learningpipeline?view=ml-dotnet" rel="noopener ugc nofollow" target="_blank"><em class="kg">学习管道</em> </a>需要一个可枚举的对象，我们可以通过调用集合上的<em class="kg"> Find() </em>轻松获得该对象:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="1d60" class="md kw hu lz b fv me mf l mg mh">var documents = collection.Find&lt;SentimentData&gt;(new BsonDocument()).ToEnumerable();<br/>pipeline.Add(CollectionDataSource.Create(documents));</span></pre><p id="d7d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了测试情感分析模型，我们将获取显示在<a class="ae jp" href="https://www.yelp.com.au/c/sydney/restaurants" rel="noopener ugc nofollow" target="_blank"> Yelp上的澳大利亚悉尼餐馆的四条当前评论</a>:</p><ul class=""><li id="00cf" class="kh ki hu it b iu iv iy iz jc kj jg kk jk kl jo km kn ko kp dt translated">服务很差，咖啡质量也很差。等了这么久甚至已经试图催他们了”</li><li id="1b2e" class="kh ki hu it b iu kq iy kr jc ks jg kt jk ku jo km kn ko kp dt translated"><em class="kg">“这个地方太神奇了！！我吃了经典的奶酪汉堡和薯条。毫无疑问，这是我吃过的最好的汉堡。</em></li><li id="39ef" class="kh ki hu it b iu kq iy kr jc ks jg kt jk ku jo km kn ko kp dt translated">“如果我能给零颗星，我会的。价格高得吓人。在煮熟的澳洲鲳鱼上晒干，不加任何调料或味道。</li><li id="15b5" class="kh ki hu it b iu kq iy kr jc ks jg kt jk ku jo km kn ko kp dt translated"><em class="kg">“菜单很小，但食物相当不错。它又快又简单，是这个地区较好的选择之一。我们吃了海鲜叻沙和海鲜炒面。</em></li></ul><p id="d7e6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">预测结果是:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="91c7" class="md kw hu lz b fv me mf l mg mh">Sentiment Predictions</span><span id="240a" class="md kw hu lz b fv mk mf l mg mh">---------------------</span><span id="4a8a" class="md kw hu lz b fv mk mf l mg mh">Sentiment: Very bad service and low quality of coffee too. Waiting for so long even tried to rush them already. | Prediction: <strong class="lz hv">Negative</strong></span><span id="6094" class="md kw hu lz b fv mk mf l mg mh">Sentiment: This place is amazing!! I had the classic cheese burger with fries.  Hands down the best burger I have ever had | Prediction: <strong class="lz hv">Positive</strong></span><span id="4b2f" class="md kw hu lz b fv mk mf l mg mh">Sentiment: If I could give zero stars I would. Terribly overpriced. Dried over cooked barramundi with no seasoning or flavor at all | Prediction: <strong class="lz hv">Negative</strong></span><span id="6360" class="md kw hu lz b fv mk mf l mg mh">Sentiment: Small menu but the food is quite good. It's fast and easy, one of the better options around the area. We had the seafood laksa and seafood Pad Kee Mao | Prediction: <strong class="lz hv">Positive</strong></span></pre><p id="2000" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注</strong>:你可以在<a class="ae jp" href="https://github.com/sindbach/mlnet_mongodb/tree/master/sentiment" rel="noopener ugc nofollow" target="_blank">github.com/sindbach/mlnet_mongodb:感悟</a>上找到完整的代码示例。</p><p id="3296" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将MongoDB作为ML.NET数据源加载和读取数据是非常简单的。利用ML.NET将机器学习与存储在MongoDB中的数据集集成的潜力令人兴奋，我期待着ML.NET的未来版本。</p></div></div>    
</body>
</html>