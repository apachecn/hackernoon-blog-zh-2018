<html>
<head>
<title>Why the world needs a universal web scraping library for JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么世界需要一个通用的JavaScript抓取库</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/why-the-world-needs-a-universal-web-scraping-library-for-javascript-21c6b3390e02?source=collection_archive---------3-----------------------#2018-09-25">https://medium.com/hackernoon/why-the-world-needs-a-universal-web-scraping-library-for-javascript-21c6b3390e02?source=collection_archive---------3-----------------------#2018-09-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0303" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">TL；DR:我们发布了</em><a class="ae jq" href="https://github.com/apifytech/apify-js" rel="noopener ugc nofollow" target="_blank"><em class="jp">Apify SDK</em></a><em class="jp">——一个用于抓取和网页抓取的开源Node.js库。有一个用于Python的库，但是直到现在，还没有这样一个用于web语言JavaScript的库。</em></p><p id="8e15" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Python中有<a class="ae jq" href="https://scrapy.org/" rel="noopener ugc nofollow" target="_blank"> Scrapy </a>，这是一个事实上的标准工具包，用于构建网页抓取器和爬虫。但是在<a class="ae jq" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>中，没有类似的全面和通用的库。但这是不对的。越来越多的网站使用JavaScript来获取和呈现用户内容。要从这些网站提取数据，您通常需要使用实际的web浏览器来解析HTML并运行页面脚本，然后注入将在浏览器上下文中运行的数据提取代码，也就是说，您需要JavaScript。那么，使用另一种编程语言来管理爬虫的“服务器端”有什么意义呢？</p><p id="0f64" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据<a class="ae jq" href="https://insights.stackoverflow.com/survey/2018#most-popular-technologies" rel="noopener ugc nofollow" target="_blank"> 2018 StackOverflow调查</a>，让我们忽略一个事实:JavaScript是世界上使用最广泛的编程语言。我们不会在这篇博文中提到这个事实。</p><p id="e2fa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用JavaScript进行网络抓取还有另一个很好的理由。2017年4月，谷歌推出了<a class="ae jq" href="https://developers.google.com/web/updates/2017/04/headless-chrome" rel="noopener ugc nofollow" target="_blank">无头Chrome </a>，不久后他们发布了<a class="ae jq" href="https://github.com/GoogleChrome/puppeteer" rel="noopener ugc nofollow" target="_blank">木偶师</a>——一个用于无头Chrome的Node.js API。这无疑是网络抓取世界的一场革命，因为以前装备全功能网络浏览器的唯一选择是使用已经严重过时的<a class="ae jq" href="http://phantomjs.org/" rel="noopener ugc nofollow" target="_blank"> PhantomJS </a>，使用基于QtWebKit并且只有Python SDK的<a class="ae jq" href="https://github.com/scrapinghub/splash" rel="noopener ugc nofollow" target="_blank"> Splash </a>，或者使用<a class="ae jq" href="https://www.seleniumhq.org/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>，其API受限于需要支持所有浏览器，包括Internet Explorer、Firefox、Safari等。虽然headless Chrome使得在服务器上运行web浏览器而不需要使用X虚拟帧缓冲区(Xvfb)成为可能，但Puppeteer为web浏览器提供了有史以来最简单、最强大的高级API。</p><h1 id="1ff8" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">木偶师是不够的</h1><p id="2ea7" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">尽管在Puppeteer中为一些网页编写数据提取代码很简单，但事情可能会变得更加复杂。例如，当您尝试使用URL的持久队列对整个网站执行深度爬网或从CSV文件中爬网100k个URL的列表时。这就是为什么需要一个图书馆的原因。</p><p id="c6fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Apify SDK 是一个开源库，它简化了网络爬虫、抓取器、数据提取器和网络自动化作业的开发。它提供了<a class="ae jq" href="https://hackernoon.com/tagged/tools" rel="noopener ugc nofollow" target="_blank">工具</a>来管理和自动扩展无头Chrome/puppeter实例池，维护要抓取的URL队列，将抓取结果存储到本地文件系统或云中，轮换代理等等。该库在NPM上以<code class="eh ku kv kw kx b"><a class="ae jq" href="https://www.npmjs.com/package/apify" rel="noopener ugc nofollow" target="_blank">apify</a></code>包的形式提供。它既可以在你自己的应用中独立使用，也可以在运行于<a class="ae jq" href="https://www.apify.com/" rel="noopener ugc nofollow" target="_blank"> Apify Cloud </a>上的<a class="ae jq" href="https://www.apify.com/docs/actor" rel="noopener ugc nofollow" target="_blank"> actors </a>中使用。</p><p id="cc6b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是不像其他的网络抓取库，比如无头Chrome Crawler，Apify SDK不仅仅局限于Puppeteer。例如，您可以轻松创建使用<a class="ae jq" href="https://www.npmjs.com/package/cheerio" rel="noopener ugc nofollow" target="_blank"> cheerio </a> HTML解析库甚至<a class="ae jq" href="https://www.seleniumhq.org/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>的网络爬虫。许多类型的爬行器的基本构造块是相同的。简而言之，Apify SDK包含了我们在过去四年里从数千个网站中获得的经验。我们试图以这样一种方式设计SDK组件，以便在简单性、性能和可定制性之间取得适当的平衡。</p><h1 id="ab71" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">给我看看代码</h1><p id="8e70" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">好了，说够了，让我们看看代码。要运行它，你需要在电脑上安装<a class="ae jq" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a> 8或更高版本。首先，通过运行以下命令将<a class="ae jq" href="https://github.com/apifytech/apify-js" rel="noopener ugc nofollow" target="_blank"> Apify SDK </a>安装到您的项目中:</p><pre class="ky kz la lb fq lc kx ld le aw lf dt"><span id="cb1a" class="lg js hu kx b fv lh li l lj lk">npm install apify --save</span></pre><p id="76a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，您可以运行以下示例脚本:</p><figure class="ky kz la lb fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff ll"><img src="../Images/24b44904fdc44bcd23fd60a316f003c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMKiX3GMabKPnOAd1IVB5Q.png"/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Hello crawler example. Source code on <a class="ae jq" href="https://gist.github.com/jancurn/3cc2f1c4c61ab2c99315d44147cfc071" rel="noopener ugc nofollow" target="_blank">GitHub</a></figcaption></figure><p id="8ab1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该脚本使用木偶师对<a class="ae jq" href="https://www.iana.org" rel="noopener ugc nofollow" target="_blank">https://www.iana.org</a>进行递归深度爬行。根据系统中可用的CPU和内存，可以自动控制木偶进程和选项卡的数量。顺便说一下，这个功能是作为<code class="eh ku kv kw kx b"><a class="ae jq" href="https://www.apify.com/docs/sdk/apify-runtime-js/latest#AutoscaledPool" rel="noopener ugc nofollow" target="_blank">AutoscaledPool</a></code>类单独公开的，因此您可以使用它来管理任何其他资源密集型异步任务池。</p><p id="cc6e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是它在“终端”中的样子:</p><figure class="ky kz la lb fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lx"><img src="../Images/94339242003bb2ced7e2025595785760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*13Pa8Oazy8PyH1W1xU1PrQ.gif"/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Recursive crawl of <a class="ae jq" href="https://www.iana.org" rel="noopener ugc nofollow" target="_blank">https://www.iana.org</a> using Apify SDK — Terminal view</figcaption></figure><p id="7b2c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当你在headful模式下运行crawl时，你会看到Apify SDK如何自动启动和管理Chrome浏览器和标签:</p><figure class="ky kz la lb fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lx"><img src="../Images/4a013847ccfe136bb7f4b0a3cb29bb45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*uu2QdZ0xbXiKaHgXIQnyUw.gif"/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Recursive crawl of <a class="ae jq" href="https://www.iana.org" rel="noopener ugc nofollow" target="_blank">https://www.iana.org</a> using Apify SDK — Chrome browser view</figcaption></figure><p id="0245" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Apify SDK提供了许多实用程序类，有助于常见的web抓取和自动化任务，例如管理要抓取的URL、数据存储和各种爬虫框架。为了更好地理解，请看一下<a class="ae jq" href="https://github.com/apifytech/apify-js#overview" rel="noopener ugc nofollow" target="_blank">组件概述</a>。</p><h1 id="0b2d" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">这有什么意义？</h1><p id="ecf4" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">我们相信每个人都有权利以他们想要的方式访问公开的网络，而不仅仅是作者想要的方式。正是以这种方式，互联网成长为今天的样子——通过让人们创造性地使用现有的东西，并在其上建立新的层，而不管它的设计目的是什么。这就是为什么网络抓取很重要的原因，因为它允许你在现有的工具或服务之上创建以前无法想象的工具或服务，并在互联网之上添加一个新的层。为什么网站只允许自动访问Google和Bing这样的巨头，而不允许访问你的代码？</p><p id="69aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们真的很期待看到你能用Apify SDK构建什么。当然，我们很想听听你对此的看法，或者回答你可能有的任何问题。在<a class="ae jq" href="https://twitter.com/apify" rel="noopener ugc nofollow" target="_blank">推特</a>上让我们知道。</p><p id="4137" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">JavaScript爬行愉快！</p><figure class="ky kz la lb fq lm"><div class="bz el l di"><div class="ly lz l"/></div></figure></div></div>    
</body>
</html>