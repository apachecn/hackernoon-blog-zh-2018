<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-unwrap-wine-labels-programmatically-31c8c62b30ce?source=collection_archive---------7-----------------------#2018-09-27">https://medium.com/hackernoon/how-to-unwrap-wine-labels-programmatically-31c8c62b30ce?source=collection_archive---------7-----------------------#2018-09-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><p id="5f2f" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">如何以编程方式打开葡萄酒标签</p><p id="2c05" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">这篇文章描述了如何用六点法解开标签(我们在<a class="ae ir" href="https://perfectlabel.io/" rel="noopener ugc nofollow" target="_blank"> Perfect Label </a>团队内部是这样命名的，为了方便起见，我保留了这个名字)。该方法是渲染任务的反向操作，即使用六个关键点来计算瓶子的几何形状，以恢复平面。</p><p id="5436" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">文章中的所有图像转换都是在OpenCV中执行的。</p><figure class="it iu iv iw fq ix fe ff paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="fe ff is"><img src="../Images/386c2f394cba30a3b650f484b04d7ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HhqUlX5FGpH-XHHU"/></div></div></figure><p id="7f9c" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">首先，我们来挖掘一下失真的本质。</p><figure class="it iu iv iw fq ix fe ff paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="fe ff je"><img src="../Images/e9713794b61484da3ed9a50b19b2b721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TrDiiFSKPSv6S0qS"/></div></div></figure><p id="eac9" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">一个贴在圆柱体上的长方形标签，有着特定的桶状形状(上图中的<strong class="hv jf"> b </strong>)。在这种情况下，曲线ABC是一个非常近似的椭圆，就像我们在某个角度下看到的圆(圆柱横截面)。标签的所有水平线的集合与图片上的一组椭圆相关。</p><p id="8cea" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">最有趣的是，只需指定6个标记即可完全打开标签(ABCDEF):</p><figure class="it iu iv iw fq ix fe ff paragraph-image"><div class="fe ff jg"><img src="../Images/594cf7ad18d58de249421d63cab969b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*-jUHVXlqK8OnndoY"/></div></figure><p id="9fa7" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">使用它们可以建立一个网格，覆盖圆柱体表面。</p><figure class="it iu iv iw fq ix fe ff paragraph-image"><div class="fe ff jg"><img src="../Images/d3502fbe805401041c54e35b2de3ca42.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*URsT_OogYVTLF5Og"/></div></figure><p id="c958" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">使用上面的网格，我们可以单独转换每个细胞，从而恢复标签的原始表面。</p><figure class="it iu iv iw fq ix fe ff paragraph-image"><div class="fe ff jh"><img src="../Images/4f69df17913d30454509fd789522d2e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/0*scUTYMhjkTRnJguY"/></div></figure><p id="60a1" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">该代码可在https://github.com/Nepherhotep/unwrap_labels<a class="ae ir" href="https://github.com/Nepherhotep/unwrap_labels" rel="noopener ugc nofollow" target="_blank">的GitHub</a>上获得</p><p id="7910" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">这种方法的主要优点是——展开功能的输入参数是可视觉检测的(角、上、底线),这使我们能够完全自动化该过程。</p><p id="da14" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">本文的下一部分将致力于标记检测，但是代码并不公开。</p><p id="c8b4" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">第一步——我们将图像转换成灰度。</p><p id="5018" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">然后我们需要检测标签边缘。我们可以用索贝尔变换来表示https://en.wikipedia.org/wiki/Sobel_operator。</p><figure class="it iu iv iw fq ix fe ff paragraph-image"><div class="fe ff jg"><img src="../Images/28ed23cd1d3a79a20da66f8573145f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*xI30TUlwmMNMdecl"/></div></figure><p id="bb79" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">我们需要做的下一件事是检测图像上最长的线，通常是瓶子的边缘。在这种特殊情况下，这是对的，但如果我们拍一张一个瓶子在其他瓶子中间的照片，这就不一定是对的。</p><p id="2723" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">为了检测这些线条，让我们使用霍夫变换<a class="ae ir" href="https://en.wikipedia.org/wiki/Hough_transform" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Hough_transform</a></p><p id="1e01" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">这个想法是——我们使用所有穿过图片的线，并计算像素的平均值(假设使用从上到下的所有线)。我们将所有的值放入一个新的坐标系统，然后构建一个类似于热图的东西。我们需要在热图上找到两个最大值，它们是瓶子的边缘。</p><p id="6e8d" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">下图描述了左瓶线如何转换为热点图上的一个点:</p><figure class="it iu iv iw fq ix fe ff paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="fe ff is"><img src="../Images/f0c483c6be8cfe2a04add2db364f542d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ziSpwu5JNBHYnyTD"/></div></div></figure><p id="bbad" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">处理椭圆有点困难，但是可以对任何数学描述的曲线使用霍夫变换。由于椭圆就是这样一种情况，我们就这样做吧。</p><p id="b3a9" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">首先，我们需要将任务转化为二维表示。我们知道瓶子是对称的，让我们将中心轴作为新的“Y”，将左轴作为新的“X”(见下图)。我们将使用沿X轴和Y轴之间绘制的一组椭圆收集的像素平均值作为新坐标系中的值。这是可能的，因为只有一种方法连接X和y上的两个给定点。第一眼看上去可能不明显，但如果参考椭圆的参数形式，就很容易发现:</p><blockquote class="ji jj jk"><p id="a7af" class="hs ht jl hv b hw hx hy hz ia ib ic id jm if ig ih jn ij ik il jo in io ip iq hn dt translated">x = a * cos(t)</p><p id="ac6b" class="hs ht jl hv b hw hx hy hz ia ib ic id jm if ig ih jn ij ik il jo in io ip iq hn dt translated">y = b * sin(t)</p></blockquote><figure class="it iu iv iw fq ix fe ff paragraph-image"><div class="fe ff jg"><img src="../Images/bce9aa349dbdc4c6acedf4298b3a5d9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*5jXHJJYqa8yBKeQH"/></div></figure><p id="9196" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">类似地，我们将找到两个最大值，它们将定义顶部A-B和底部F-E曲线。现在，我们有了所有需要的标记(左、右线和上下椭圆)，我们可以应用本文第一部分中描述的算法并撤销圆柱体扭曲。</p><p id="d97c" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">有哪些可以改进的地方？首先，该算法没有计算椭圆的透视变形，因此标签的左右两侧被拉伸了一些。要解决这个问题，需要知道相机的角度，或者至少找到手机最典型的角度(可以凭经验做到)。</p><p id="ec30" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">其次，霍夫变换在复杂的情况下会不稳定——比如一个瓶子在其他瓶子中间。</p><p id="ba10" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">第三，如果标签的形状不是矩形(假设是椭圆形)，标记将被错误地检测到，并且进一步的变换将使标签更加扭曲。</p><p id="e744" class="pw-post-body-paragraph hs ht hu hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq hn dt translated">在实践中，使用神经<a class="ae ir" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">网络</a>进行标记检测要有趣得多，因为它也可以在复杂的情况下进行训练，甚至在算法无法检测到标签时发出警报(并保持标签未被转换)，但这将是另一篇文章的主题。</p><figure class="it iu iv iw fq ix"><div class="bz el l di"><div class="jp jq l"/></div></figure></div></div>    
</body>
</html>