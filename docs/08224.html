<html>
<head>
<title>How to develop Android UI Component for React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为React Native开发Android UI组件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-develop-android-ui-component-for-react-native-43b121272eb8?source=collection_archive---------3-----------------------#2018-09-30">https://medium.com/hackernoon/how-to-develop-android-ui-component-for-react-native-43b121272eb8?source=collection_archive---------3-----------------------#2018-09-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class="fi fk ir is it ab cb"><figure class="iu iv iw ix iy iz ja paragraph-image"><div role="button" tabindex="0" class="jb jc di jd bf je"><img src="../Images/c5ed7bc740bd456c0f5b8e50b2dcce00.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*7EYzrsZYTQVJ2MuEuvV5EQ.png"/></div></figure><figure class="iu iv jh ix iy iz ja paragraph-image"><div role="button" tabindex="0" class="jb jc di jd bf je"><img src="../Images/29be0406380ff6451116adee9395fcd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1520/format:webp/1*6_VG7Vhks9d_yLUMYpnZfw.png"/></div><figcaption class="ji jj fg fe ff jk jl bd b be z ek jm di jn jo">Android UI Component for React Native (Source: <a class="ae jp" href="http://47billion.com" rel="noopener ugc nofollow" target="_blank">47Billion</a>)</figcaption></figure></div><p id="f6d1" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated">在我们用React Native开发的一个项目中，我们遇到了一个问题。我们想使用带有文本覆盖的视频播放器。尽管React Native中有很多视频播放器的实现，但没有一个提供这样的功能。所以我们决定开发自己的组件，并在React本机代码中使用它。</p><p id="68f0" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated">本文描述了如何将任何Android视图组件转换为React原生组件。当您需要使用任何Android视图或React Native应用程序中的自定义视图组件时，这是必需的。</p><h2 id="940b" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kb kz la lb kf lc ld le kj lf lg lh li dt translated">创建视图</h2><p id="6365" class="pw-post-body-paragraph jq jr hu js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn hn dt translated">创建一个React本地项目。在这个项目中，我们为本地代码准备了Android和IOS文件夹。在Android Studio中打开Android代码，并使用原生java代码创建一个视图。</p><h2 id="4b9e" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kb kz la lb kf lc ld le kj lf lg lh li dt translated">实现SimpleViewManager</h2><p id="7a2b" class="pw-post-body-paragraph jq jr hu js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn hn dt translated">编写一个从ViewManager继承的类。在这个类中，指定在React本地代码中使用Android代码的哪个视图。</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="a570" class="ko kp hu lt b fv lx ly l lz ma">public class VideoViewManager extends SimpleViewManager&lt;VideoView&gt;</span></pre><p id="7d04" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated">超类<strong class="js hv">simple viewmanager&lt;VideoView&gt;</strong>指定我们要通过这个类暴露Android的video view来进行原生反应。一个<strong class="js hv">视图管理器</strong>是一个React本地接口，负责实例化和更新应用程序中的视图。<strong class="js hv"> SimpleViewManager </strong>是一个使用我们的视图的泛型类。我们可以使用Android中已经存在的任何视图，如ImageView、VideoView、TextView、LinearLayout，或者我们可以实现和使用自定义视图。这里我们使用的是视频视图。</p><p id="4a4a" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated">在管理器中，使用以下步骤对组件进行初始设置:</p><ol class=""><li id="aaba" class="mb mc hu js b jt ju jx jy kb md kf me kj mf kn mg mh mi mj dt translated">编写一个继承自<strong class="js hv"> ViewManager </strong>或其子类(<strong class="js hv"> SimpleViewManager </strong>)的类</li><li id="c6d0" class="mb mc hu js b jt mk jx ml kb mm kf mn kj mo kn mg mh mi mj dt translated">实现方法<strong class="js hv"> getName </strong>，它返回一个我们用来从React Native获取管理器的字符串常量</li><li id="80b5" class="mb mc hu js b jt mk jx ml kb mm kf mn kj mo kn mg mh mi mj dt translated">实现<strong class="js hv">createview instance(ThemedReactContext react context)</strong>方法，在该方法中，我们创建组件的一个实例并返回对象。</li></ol><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="1196" class="ko kp hu lt b fv lx ly l lz ma">public class <strong class="lt hv">VideoViewManager</strong> extends <strong class="lt hv">SimpleViewManager&lt;VideoView&gt;</strong> {</span><span id="9997" class="ko kp hu lt b fv mp ly l lz ma">public static final String <strong class="lt hv">REACT_CLASS</strong> = “VideoView”;</span><span id="6091" class="ko kp hu lt b fv mp ly l lz ma">@Override<br/>public String getName() {<br/>  return <strong class="lt hv">REACT_CLASS</strong>;<br/>}</span><span id="e5d1" class="ko kp hu lt b fv mp ly l lz ma">@Override<br/>protected VideoView <strong class="lt hv">createViewInstance</strong>(ThemedReactContext reactContext) {<br/>  VideoView videoView = new VideoView(reactContext);<br/>  return videoView;<br/>}</span></pre><p id="6590" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated">4.如果我们想使用<strong class="js hv"> props </strong>将一些数据从React本地代码发送到我们的组件，那么我们必须编写一个附加方法来接受组件中的数据。参见下面代码中的<strong class="js hv"> setVideoPath </strong>方法。</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="62b5" class="ko kp hu lt b fv lx ly l lz ma">public class <strong class="lt hv">VideoViewManager</strong> extends <strong class="lt hv">SimpleViewManager&lt;VideoView&gt;</strong> {</span><span id="eb39" class="ko kp hu lt b fv mp ly l lz ma">public static final String <strong class="lt hv">REACT_CLASS</strong> = “VideoView”;</span><span id="a26f" class="ko kp hu lt b fv mp ly l lz ma">@Override<br/>public String getName() {<br/>  return <strong class="lt hv">REACT_CLASS</strong>;<br/>}</span><span id="960a" class="ko kp hu lt b fv mp ly l lz ma">@Override<br/>protected VideoView <strong class="lt hv">createViewInstance</strong>(ThemedReactContext reactContext) {<br/>  VideoView videoView = new VideoView(reactContext);<br/>  return videoView;<br/>}</span><span id="9b7e" class="ko kp hu lt b fv mp ly l lz ma">@ReactProp(name=”url”)<br/>public void <strong class="lt hv">setVideoPath</strong>(VideoView videoView, String urlPath) {<br/>  Uri uri = Uri.parse(urlPath);<br/>  videoView.setVideoURI(uri);<br/>  videoView.start();<br/> }<br/>}</span></pre><h2 id="1c5d" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kb kz la lb kf lc ld le kj lf lg lh li dt translated">创建包模块</h2><p id="de7a" class="pw-post-body-paragraph jq jr hu js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn hn dt translated">为了从React Native、<strong class="js hv"> </strong>调用<strong class="js hv"> VideoViewManager </strong>，我们必须使用一个包模块注册它。编写一个实现<strong class="js hv"> ReactPackage </strong>接口的类。</p><p id="9b00" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated">在<strong class="js hv"> createViewManagers() </strong>方法中，实例化我们想要暴露以反应本机的ViewManager。</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="657a" class="ko kp hu lt b fv lx ly l lz ma">public class <strong class="lt hv">VideoViewPackage</strong> implements <strong class="lt hv">ReactPackage</strong> {</span><span id="addd" class="ko kp hu lt b fv mp ly l lz ma">@Override<br/>  public List&lt;NativeModule&gt;    <strong class="lt hv">createNativeModules</strong>(ReactApplicationContext reactContext) {<br/>    return Collections.emptyList();<br/>  }</span><span id="11eb" class="ko kp hu lt b fv mp ly l lz ma">@Override<br/>  public List&lt;ViewManager&gt; <strong class="lt hv">createViewManagers</strong>(ReactApplicationContext reactContext) {<br/>    return Collections.&lt;ViewManager&gt;singletonList(<br/>      new VideoViewManager()<br/>    );<br/>  }<br/>}</span></pre><h2 id="ed71" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kb kz la lb kf lc ld le kj lf lg lh li dt translated">将包模块添加到应用程序类</h2><p id="270f" class="pw-post-body-paragraph jq jr hu js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn hn dt translated">在React原生项目的应用类中，在<strong class="js hv"> getPackages() </strong>方法<strong class="js hv">中添加包模块。</strong></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="0581" class="ko kp hu lt b fv lx ly l lz ma">@Override<br/>protected List&lt;ReactPackage&gt; <strong class="lt hv">getPackages</strong>() {</span><span id="638c" class="ko kp hu lt b fv mp ly l lz ma">return Arrays.&lt;ReactPackage&gt;asList(<br/>     new MainReactPackage(),<br/>     new VideoViewPackage()<br/>  );</span><span id="1713" class="ko kp hu lt b fv mp ly l lz ma">}</span></pre><h2 id="d736" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kb kz la lb kf lc ld le kj lf lg lh li dt translated">实现本机端反应</h2><p id="0c31" class="pw-post-body-paragraph jq jr hu js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn hn dt translated">我们必须创建一个JS文件并实现<strong class="js hv"> requireNativeComponent </strong>函数。这个函数接收两个参数。第一个参数是我们在view manager类中定义的视图管理器的名称，并通过<strong class="js hv"> getName() </strong>方法返回。第二个参数是一个有<strong class="js hv">道具</strong>的对象。</p><p id="0521" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated">在src文件夹中创建VideoView.js。我们需要从这个文件中导入组件，以便以后使用。</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="65f9" class="ko kp hu lt b fv lx ly l lz ma">import PropTypes from ‘prop-types’;</span><span id="cdac" class="ko kp hu lt b fv mp ly l lz ma">import { requireNativeComponent, ViewPropTypes } from ‘react-native’;</span><span id="b7bd" class="ko kp hu lt b fv mp ly l lz ma">var viewProps = {<br/>  name: ‘VideoView’,<br/>  propTypes: {<br/>    url: PropTypes.string,<br/>    …ViewPropTypes,<br/>  }<br/>}<br/>module.exports = <strong class="lt hv">requireNativeComponent</strong>(‘VideoView’, viewProps);</span></pre><h2 id="e660" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kb kz la lb kf lc ld le kj lf lg lh li dt translated"><strong class="ak">使用组件</strong></h2><p id="1101" class="pw-post-body-paragraph jq jr hu js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn hn dt translated">现在，我们可以在React本机应用程序中使用我们的本机组件。</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="e6e3" class="ko kp hu lt b fv lx ly l lz ma">import React, { Component } from 'react';<br/>import { StyleSheet, View } from 'react-native';<br/>import VideoView from './src/VideoView';</span><span id="0f91" class="ko kp hu lt b fv mp ly l lz ma">export default class <strong class="lt hv">App</strong> extends <strong class="lt hv">Component</strong> {</span><span id="1fd3" class="ko kp hu lt b fv mp ly l lz ma">constructor() {<br/>    super();<br/>  }<br/>  render() {<br/>    return (<br/>      &lt;View <br/>      style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}&gt;</span><span id="7dfe" class="ko kp hu lt b fv mp ly l lz ma">&lt;<strong class="lt hv">VideoView</strong> style={{ flex: 1, width: '100%', height: '100%' }}       <br/>      url="https://www.radiantmediaplayer.com/media/bbb-360p.mp4" /&gt;</span><span id="210d" class="ko kp hu lt b fv mp ly l lz ma">&lt;/View&gt;<br/>    );<br/>  }<br/>}</span></pre><p id="122d" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated"><em class="mq">感谢阅读。如果你喜欢这篇文章，请随意点击那个按钮👏帮助其他人找到它。</em></p><p id="275f" class="pw-post-body-paragraph jq jr hu js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn hn dt translated"><em class="mq">感谢Atul Sharma @</em><a class="ae jp" href="http://47billion.com" rel="noopener ugc nofollow" target="_blank"><em class="mq">470亿</em> </a> <em class="mq">详细代码。本文是与移动技术相关的系列文章的一部分。如果您正在寻找一个移动应用程序开发团队来构建您的解决方案，请通过</em><a class="ae jp" href="mailto:info@47billion.com" rel="noopener ugc nofollow" target="_blank"><em class="mq">info@47billion.com</em></a><em class="mq">联系我们。</em></p></div></div>    
</body>
</html>