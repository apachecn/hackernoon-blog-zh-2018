<html>
<head>
<title>Announcing Camelot, a Python Library to Extract Tabular Data from PDFs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">宣布推出Camelot，这是一个从pdf中提取表格数据的Python库</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/announcing-camelot-a-python-library-to-extract-tabular-data-from-pdfs-605f8e63c2d5?source=collection_archive---------2-----------------------#2018-10-03">https://medium.com/hackernoon/announcing-camelot-a-python-library-to-extract-tabular-data-from-pdfs-605f8e63c2d5?source=collection_archive---------2-----------------------#2018-10-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/488027bf15fef46192d68d2bddbae9f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_s33_p0TJ5zTeSLVRAh2A.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/05ci_hxKWr4?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Carles Rabada</a> on <a class="ae jg" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="48a5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">PDF(<a class="ae jg" href="https://en.wikipedia.org/wiki/PDF" rel="noopener ugc nofollow" target="_blank">Portable Document Format</a>)诞生于<a class="ae jg" href="http://www.planetpdf.com/planetpdf/pdfs/warnock_camelot.pdf" rel="noopener ugc nofollow" target="_blank">Camelot项目</a>，旨在创建“一种在各种机器配置、操作系统和通信网络之间交流文档的通用方式”。基本上，目标是使文档可以在任何显示器上查看，并可以在任何现代打印机上打印。PDF建立在<a class="ae jg" href="https://en.wikipedia.org/wiki/PostScript" rel="noopener ugc nofollow" target="_blank"> PostScript </a>(一种页面描述语言)之上，它已经解决了这个“随处查看和打印”的问题。PDF封装了创建“随处查看和打印”文档所需的组件。这些包括字符、字体、图形和图像。</p><p id="93d0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">PDF文件定义了将字符(和其他组件)放置在相对于页面左下角的精确的<em class="kf"> x，y </em>坐标上的指令。通过将一些字符放得比其他字符更近来模拟单词。类似地，通过将单词放置在相对较远的位置来模拟空格。那么表格是如何模拟的呢？你猜对了——通过将单词放在电子表格中。</p><p id="64b1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">PDF格式没有表格结构的内部表示，这使得很难提取表格进行分析。可悲的是，许多开放的数据存储在pdf中，而pdf最初并不是为表格数据设计的！</p><h1 id="cb26" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">卡米洛特:人类PDF表格提取</h1><p id="8a49" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">今天，我们很高兴地宣布Camelot的发布，这是一个Python库和命令行工具，任何人都可以轻松地提取PDF文件中的数据表！你可以在<a class="ae jg" href="https://camelot-py.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">查看文档，阅读文档</a>并关注<a class="ae jg" href="https://github.com/camelot-dev/camelot" rel="noopener ugc nofollow" target="_blank"> GitHub </a>的开发。</p><h1 id="a05c" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">如何安装卡梅洛特</h1><p id="cbd9" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">安装简单！在<a class="ae jg" href="https://camelot-py.readthedocs.io/en/latest/user/install.html#install" rel="noopener ugc nofollow" target="_blank">安装完依赖项</a>后，您可以使用pip(安装Python包的推荐工具)安装Camelot:</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="c270" class="ls kh hu lo b fv lt lu l lv lw">$ pip install camelot-py</span></pre><h1 id="39ab" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">如何使用卡梅洛特</h1><p id="f613" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">使用Camelot从PDF中提取表格非常简单。这是你怎么做的。(<a class="ae jg" href="https://camelot-py.readthedocs.io/en/latest/_static/pdf/foo.pdf" rel="noopener ugc nofollow" target="_blank">下面是下例中使用的PDF </a>。)</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="2eaf" class="ls kh hu lo b fv lt lu l lv lw">&gt;&gt;&gt; import camelot<br/>&gt;&gt;&gt; tables = camelot.read_pdf('foo.pdf')<br/>&gt;&gt;&gt; tables<br/>&lt;TableList n=1&gt;<br/>&gt;&gt;&gt; tables.export('foo.csv', f='csv', compress=True) # json, excel, html<br/>&gt;&gt;&gt; tables[0]<br/>&lt;Table shape=(7, 7)&gt;<br/>&gt;&gt;&gt; tables[0].parsing_report<br/>{<br/>    'accuracy': 99.02,<br/>    'whitespace': 12.24,<br/>    'order': 1,<br/>    'page': 1<br/>}<br/>&gt;&gt;&gt; tables[0].to_csv('foo.csv') # to_json, to_excel, to_html<br/>&gt;&gt;&gt; tables[0].df # get a pandas DataFrame!</span></pre><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="3f55" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你也可以查看一下<a class="ae jg" href="https://camelot-py.readthedocs.io/en/latest/user/cli.html" rel="noopener ugc nofollow" target="_blank">命令行界面</a>。</p><h1 id="7e20" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">为什么要用卡梅洛特？</h1><ul class=""><li id="734d" class="lz ma hu jj b jk le jo lf js mb jw mc ka md ke me mf mg mh dt translated">Camelot通过调整设置，让您完全控制表提取。</li><li id="5680" class="lz ma hu jj b jk mi jo mj js mk jw ml ka mm ke me mf mg mh dt translated">可以根据准确性和空白等指标丢弃坏表，而不必手动查看每个表。</li><li id="b681" class="lz ma hu jj b jk mi jo mj js mk jw ml ka mm ke me mf mg mh dt translated">每个表都是一个<a class="ae jg" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">熊猫数据框架</a>，无缝集成到<a class="ae jg" href="https://gist.github.com/vinayak-mehta/e5949f7c2410a0e12f25d3682dc9e873" rel="noopener ugc nofollow" target="_blank"> ETL和数据分析工作流</a>。</li><li id="9f66" class="lz ma hu jj b jk mi jo mj js mk jw ml ka mm ke me mf mg mh dt translated">您可以将表格导出为多种格式，包括CSV、JSON、Excel和HTML。</li></ul><h1 id="1750" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">好吧，但是为什么要另一个PDF表格提取库呢？</h1><h1 id="1cdf" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">TL；DR:全面控制，实现更好的表格提取</h1><p id="de6a" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">许多人使用开放(<a class="ae jg" href="http://tabula.technology/" rel="noopener ugc nofollow" target="_blank"> Tabula </a>、<a class="ae jg" href="https://github.com/ashima/pdf-table-extract" rel="noopener ugc nofollow" target="_blank"> pdf-table-extract </a>)和闭源(<a class="ae jg" href="https://smallpdf.com/" rel="noopener ugc nofollow" target="_blank"> smallpdf </a>、<a class="ae jg" href="https://pdftables.com/" rel="noopener ugc nofollow" target="_blank"> pdftables </a>)工具从pdf中提取表格。但是他们要么给出一个好的输出，要么悲惨地失败。没有中间地带。这是没有帮助的，因为现实世界中的一切，包括PDF表格提取，都是模糊的。这导致为每种类型的PDF表格创建专门的表格提取脚本。</p><p id="d0fa" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们创建了Camelot来为用户提供对表提取的完全控制。如果你不能用默认设置得到你想要的输出，你可以调整它们并完成工作！</p><p id="80af" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以查看Camelot的输出与其他开源PDF表格提取库的比较<a class="ae jg" href="https://github.com/camelot-dev/camelot/wiki/Comparison-with-other-PDF-Table-Extraction-libraries-and-tools" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="a3b9" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">阅读时间越长</h1><p id="ae30" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">我们经常需要提取pdf中的数据。</p><p id="d8dc" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们尝试的第一个工具是<a class="ae jg" href="http://tabula.technology/" rel="noopener ugc nofollow" target="_blank"> Tabula </a>，它有很好的用户和命令行界面，但是它要么工作得很完美，要么失败得很惨。当它失败时，很难调整设置，如图像阈值参数，这些参数会影响表格检测，并可能导致更好的输出。</p><p id="804e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们还尝试了像<a class="ae jg" href="https://smallpdf.com/" rel="noopener ugc nofollow" target="_blank"> smallpdf </a>和<a class="ae jg" href="https://pdftables.com/" rel="noopener ugc nofollow" target="_blank"> pdftables </a>这样的闭源工具，它们比Tabula工作得稍微好一点。但话说回来，他们也不允许调整和成本的钱。(我们在2015年写了一篇关于如何从PDF中提取表格的博文，标题是<a class="ae jg" href="https://blog.socialcops.com/technology/engineering/pdf-evil-extracting-tabular-data-pdfs/" rel="noopener ugc nofollow" target="_blank">“PDF是邪恶的”</a>。)</p><p id="63eb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当这些成熟的PDF表格提取工具不起作用时，我们尝试了<a class="ae jg" href="https://en.wikipedia.org/wiki/Pdftotext" rel="noopener ugc nofollow" target="_blank">PDF text</a>(一个开源命令行实用程序)。pdftotext使用空格从PDF中提取文本，同时保留布局。获得文本后，我们必须用复杂的正则表达式(<a class="ae jg" href="https://en.wikipedia.org/wiki/Regular_expression" rel="noopener ugc nofollow" target="_blank">正则表达式</a>)编写Python脚本，将文本转换成表格。这是不可伸缩的，因为我们必须为每个新的表格布局更改regexs。</p><p id="948d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们显然需要一个可调整的PDF表格提取工具，所以我们在2015年12月开始开发一个。我们从把工具还给社区的想法开始，社区给了我们这么多开源工具。</p><p id="90a7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们知道Tabula将PDF表格分为两类。它有两种方法来提取这些不同的类:Lattice(提取单元格之间有明确定义的线条的表格)和Stream(提取单元格之间有空格的表格)。我们以Tabula的方法命名了卡梅洛特的萃取风味，格子和溪流。</p><p id="b9e8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于Lattice，<a class="ae jg" href="https://www.propublica.org/nerds/heart-of-nerd-darkness-why-dollars-for-docs-was-so-difficult" rel="noopener ugc nofollow" target="_blank"> Tabula使用霍夫变换</a>，一种图像处理技术来检测线条。因为我们想使用Python，<a class="ae jg" href="https://en.wikipedia.org/wiki/OpenCV" rel="noopener ugc nofollow" target="_blank"> OpenCV </a>是进行图像处理的明显选择。然而，OpenCV的<a class="ae jg" href="https://docs.opencv.org/2.4/doc/tutorials/imgproc/imgtrans/hough_lines/hough_lines.html" rel="noopener ugc nofollow" target="_blank">霍夫线变换</a>只返回线方程。经过更多的探索，我们决定采用<a class="ae jg" href="https://docs.opencv.org/3.4/d9/d61/tutorial_py_morphological_ops.html" rel="noopener ugc nofollow" target="_blank">形态变换</a>，它给出了精确的线段。从这里开始，表示PDF中的表格变得简单明了。</p><p id="53c2" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">要获得更多关于Lattice和Stream如何在Camelot中工作的信息，请查看文档的<a class="ae jg" href="https://camelot-py.readthedocs.io/en/latest/user/how-it-works.html" rel="noopener ugc nofollow" target="_blank">“它如何工作”</a>部分。</p><h1 id="1ac4" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">我们如何利用卡梅洛特</h1><p id="a2cb" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">我们已经通过在各种项目中使用Camelot进行了实战测试，包括一次性的和自动化的表提取。</p><p id="2a53" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">今年早些时候，我们开发了<a class="ae jg" href="https://socialcops.com/solutions/sdg-tracking/" rel="noopener ugc nofollow" target="_blank">联合国可持续发展目标解决方案</a>，以帮助组织跟踪和衡量他们对【2030议程】的贡献。对于印度，我们为17个可持续发展目标中的每一个确定了开放数据源(主要是PDF报告)。例如，目标3(“人民的健康和福祉”)的来源之一是由IIPS发布的全国家庭健康调查(NFHS)报告。为了从这些PDF源中获取数据，我们在Camelot的基础上创建了一个内部web界面，我们的数据分析师可以上传PDF报告，并以他们喜欢的格式提取表格。</p><p id="0490" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="kf">注:</em> <a class="ae jg" href="https://blog.socialcops.com/inside-sc/press/un-sdg-action-awards-finalist/" rel="noopener ugc nofollow" target="_blank"> <em class="kf">我们在2018年2月成为了联合国SDG行动奖的入围者</em> </a> <em class="kf">。</em></p><p id="8744" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们还建立了一个<a class="ae jg" href="https://blog.socialcops.com/technology/data-science/apache-airflow-disease-outbreaks-india/" rel="noopener ugc nofollow" target="_blank"> ETL工作流，使用Apache Airflow来跟踪印度的疾病爆发</a>。该工作流程从<a class="ae jg" href="http://www.idsp.nic.in/index4.php?lang=1&amp;level=0&amp;linkid=406&amp;lid=3689" rel="noopener ugc nofollow" target="_blank">综合疾病监测规划(IDSP) </a>网站中搜寻疾病爆发数据的每周pdf，然后使用Camelot从pdf中提取表格，向我们的团队发送警报，并将数据加载到数据仓库中。</p><h1 id="df7a" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">到无限和更远的地方！</h1><p id="0215" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">卡梅洛特有些局限性。(我们正在开发解决方案！)这里有几个例子:</p><ul class=""><li id="dac2" class="lz ma hu jj b jk jl jo jp js mn jw mo ka mp ke me mf mg mh dt translated">使用Stream时，不会自动检测表格。Stream将整个页面视为单个表，当页面上有多个表时，这将产生不好的输出。</li><li id="1560" class="lz ma hu jj b jk mi jo mj js mk jw ml ka mm ke me mf mg mh dt translated">Camelot只能处理基于文本的pdf，不能处理扫描的文档。(正如Tabula <a class="ae jg" href="https://github.com/tabulapdf/tabula#why-tabula" rel="noopener ugc nofollow" target="_blank">对</a>的解释，“如果您可以在PDF查看器中点击并拖动来选择表格中的文本，那么您的PDF就是基于文本的”。)</li></ul><p id="0e4c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以查看<a class="ae jg" href="https://github.com/camelot-dev/camelot" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>以获得更多信息。</p><p id="5d34" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你也可以帮忙——每一份贡献都很重要！查看<a class="ae jg" href="https://camelot-py.readthedocs.io/en/latest/dev/contributing.html" rel="noopener ugc nofollow" target="_blank">贡献者指南</a>，了解关于贡献代码、文档或测试、报告问题和提出改进的指南。你也可以前往<a class="ae jg" href="https://github.com/camelot-dev/camelot/issues" rel="noopener ugc nofollow" target="_blank">问题追踪</a>，寻找标有“求助”和“好的第一期”的问题。</p><p id="edac" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们敦促组织以类似于<a class="ae jg" href="https://en.wikipedia.org/wiki/Comma-separated_values" rel="noopener ugc nofollow" target="_blank"> CSV </a>的“数据友好”格式发布开放数据。但是当表格被困在PDF文件中时，还有卡梅洛特:)</p></div></div>    
</body>
</html>