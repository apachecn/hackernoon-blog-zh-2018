<html>
<head>
<title>The importance and impact of APIs in Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">API在无服务器中的重要性和影响</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-importance-and-impact-of-apis-in-serverless-1de1904239d6?source=collection_archive---------8-----------------------#2018-10-03">https://medium.com/hackernoon/the-importance-and-impact-of-apis-in-serverless-1de1904239d6?source=collection_archive---------8-----------------------#2018-10-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/27b6820d1d9374f3b29461d09ab4c65b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Cgm7NngWO5M0j_i3"/></div></div></figure><p id="acb7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当谈到无服务器时，两个优势会立即浮现出来:</p><ol class=""><li id="7541" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">跳出框框——这可能是我们作为开发者所能想到的最好的事情。</li><li id="d4cc" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">不要管理基础架构问题—配置、更新、补丁不再是问题。</li></ol><p id="199d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些优势主要被称为“FaaS”(Function-as-a-Service)，现在很多云提供商都在提供，比如<a class="ae ko" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>、<a class="ae ko" href="https://azure.microsoft.com/en-us/services/functions/" rel="noopener ugc nofollow" target="_blank"> Azure Functions </a>、<a class="ae ko" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Functions </a>等等。</p><p id="0d7c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">无服务器不仅仅是FaaS——我们负责扩展、加密、备份、性能、日志等的托管数据库服务<strong class="je hv">是</strong>无服务器的。这同样适用于托管队列、存储、web APIs和其他服务。</p><p id="8b92" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最终，每个应用程序都由第三方API组成。它们很棒，因为它们允许我们专注于产品开发，而不是实施别人已经实施过的内部解决方案，而且可能比我们能做的更好。最棒的是，我们既不关心扩展，也不关心基础设施。</p><p id="f2ab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这样的第三方API可以为我们提供用户管理(<a class="ae ko" href="http://auth0.com/" rel="noopener ugc nofollow" target="_blank"> Auth0 </a>)、支付(<a class="ae ko" href="https://stripe.com/" rel="noopener ugc nofollow" target="_blank"> Stripe </a>)、通信(<a class="ae ko" href="https://www.twilio.com/" rel="noopener ugc nofollow" target="_blank"> Twilio </a>)等等。</p><p id="9d33" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在无服务器中，关于API有一个主要的警告。当我们按使用付费时，或者具体地说，我们为代码运行的时间量付费，<strong class="je hv">与API的快速交互是至关重要的！</strong>我们需要衡量性能，以了解对我们成本和客户体验的影响。</p><h1 id="23ad" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">使用Auth0和AWS Lambda进行身份验证</h1><p id="57b3" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">让我们从一个简单的例子开始——在Python中设置一个Lambda函数，它返回给定ID的用户详细信息。对于用户管理和认证，我们将使用Auth0。</p><p id="eb27" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们表示Lambda函数的主<em class="ls"> handler.py </em>如下所示:</p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/583d234e60cded6ce77bc9524168f8ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*YErFa-Z3jD6Gc_si.png"/></div></figure><p id="e831" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用<a class="ae ko" href="http://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>完成部署。你可以在<a class="ae ko" href="https://github.com/epsagon/lambda-auth0-example" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中看到完整的代码。</p><h1 id="6f6f" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">衡量API的性能</h1><p id="79e2" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">为了了解从Auth0 获得响应需要多长时间，我们可以添加时间印记。这很难维护和分析。正如我们所说的，我们更喜欢能够解决这一问题的托管服务。我们将使用一个用于无服务器的的<a class="ae ko" href="https://epsagon.com/" rel="noopener ugc nofollow" target="_blank">性能监控解决方案——epsa gon。一旦我们在代码中设置了这个库，我们将获得这个函数的轨迹的完整可视化:</a></p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ly"><img src="../Images/746cee8541bd0919505ddce0fea38ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2lPLUz6m9uMB4-ba"/></div></div></figure><p id="1397" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们可以观察到Auth0从Auth0获得响应需要大约600ms。多次运行该操作平均会产生大约500毫秒的结果。我们等待响应的额外空闲时间，影响了我们的<strong class="je hv">成本</strong>和<strong class="je hv">用户体验</strong>。</p><h1 id="ec8a" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">使用Lambda和Auth0优化性能</h1><p id="3b26" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">此时，为了优化性能，我们可以做的事情很少:</p><ol class=""><li id="46d7" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated"><strong class="je hv">减少服务的延迟</strong> —通过在Auth0中选择更近的服务区域(例如，美国而不是欧盟)，我们可以缩短响应时间。测量新的服务区域配置平均需要大约150毫秒(350毫秒/ 70%的改进！).</li></ol><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lz"><img src="../Images/ab516fb6ed8c2ff18704ee2d20011183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1A4a9YItrTxJ3-ee"/></div></div></figure><ol class=""><li id="b9f2" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated"><strong class="je hv">缓存数据</strong> —用户配置文件很少改变，因此没有理由每次都从Auth0请求相同的配置文件。相反，我们可以存储一个dict，其中user_id映射到他的配置文件和上次更新的时间戳。如果这个时间戳是最新的，我们可以使用缓存数据。否则，我们可以发送新的请求。它极大地改善了持续时间(使用缓存时为0毫秒！).</li></ol><h1 id="1901" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">选择API时的考虑事项</h1><p id="12ab" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">对于应用程序架构中的每个组件，都有几个API可供选择。此列表总结了一些要评估的关键指标:</p><ol class=""><li id="8676" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated"><strong class="je hv">价格</strong> —毫无疑问，这很重要。</li><li id="88e9" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated"><strong class="je hv">集成</strong> —开始使用服务有多容易？它有我正在使用的编程语言的库吗？</li><li id="075e" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated"><strong class="je hv">性能</strong> —这个API的反应速度有多快？</li><li id="2e87" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated"><strong class="je hv">文档</strong> —它有时被低估了，但是对我们开发人员来说，它是至关重要的。</li><li id="04de" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">限制——有什么API限制吗？这可能是一个交易破坏者。</li><li id="01cb" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated"><strong class="je hv">额外功能</strong> —安全和法规、社区和支持等。</li></ol><h1 id="4e0d" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">结论</h1><p id="2c96" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">无服务器不仅仅是功能，这是我们的整个应用程序，包含托管资源和第三方API。</p><p id="7267" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在将这些与功能集成时，用外部资源和API对它们的性能进行基准测试，并了解它们对我们的成本和客户体验的影响是非常重要的。</p></div><div class="ab cl ma mb hc mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hn ho hp hq hr"><p id="da0b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ls">最初发表于</em><a class="ae ko" href="http://blog.epsagon.com/the-importance-and-impact-of-apis-in-serverless" rel="noopener ugc nofollow" target="_blank"><em class="ls">【blog.epsagon.com】</em></a><em class="ls">。</em></p></div></div>    
</body>
</html>