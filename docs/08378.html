<html>
<head>
<title>How jQuery is killing Uber Engineering?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">jQuery是如何扼杀优步工程的？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-jquery-is-killing-uber-engineering-892dbec26fde?source=collection_archive---------6-----------------------#2018-10-07">https://medium.com/hackernoon/how-jquery-is-killing-uber-engineering-892dbec26fde?source=collection_archive---------6-----------------------#2018-10-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/aeee795129a2d10b4d306705d54cf474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NX7SLiTkU2kF6w7n6A_WKA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/qd-zd2MoeE8?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Victor Xok</a> on <a class="ae jg" href="https://unsplash.com/search/photos/uber?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1b01" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就像另一天，当我在优步工程学院看一些有趣的博客时，一些有趣的事情引起了我的注意。</p><p id="77ef" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你知道我们的眼睛有多强，能轻易找到不稳定的东西吗？通常，我们的设备每秒渲染60帧，这意味着它在16.66毫秒内渲染1帧(时间间隔可能因低配置设备而异)。如果事情没有在指定的时间框架内呈现，我们在我们的访问网站得到不稳定的东西。</p><p id="6762" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这就是我今天参观<a class="ae jg" href="https://eng.uber.com/" rel="noopener ugc nofollow" target="_blank">优步工程</a>时发生的事情。</p><h2 id="3625" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">浏览器渲染优化。</h2><p id="3860" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">通过对浏览器渲染优化的简短介绍，我想进一步加深对本文的理解。</p><figure class="lg lh li lj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lf"><img src="../Images/caf812173c8d8ede8cde578a08d6008e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IncCeZbLNP5mJzjuP47WNA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Browser’s Rendering Pipeline</figcaption></figure><p id="3579" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是一个典型的框架。可以把它看作是浏览器的渲染管道。通常，我们使用JavaScript来处理会导致视觉变化的工作。</p><ol class=""><li id="4027" class="lk ll hu jj b jk jl jo jp js lm jw ln ka lo ke lp lq lr ls dt translated"><strong class="jj hv"> <em class="lt"> JavaScript </em> </strong> —你可以用JavaScript或CSS做出视觉上的改变</li><li id="094e" class="lk ll hu jj b jk lu jo lv js lw jw lx ka ly ke lp lq lr ls dt translated"><strong class="jj hv"> <em class="lt">样式</em> </strong> —浏览器必须重新计算受影响元素的样式。</li><li id="9cdc" class="lk ll hu jj b jk lu jo lv js lw jw lx ka ly ke lp lq lr ls dt translated"><strong class="jj hv"> <em class="lt">布局</em> </strong> —现在，如果你改变了布局属性，如宽度、偏移量、高度等，浏览器将不得不检查所有其他元素并重新排列页面。</li><li id="27b7" class="lk ll hu jj b jk lu jo lv js lw jw lx ka ly ke lp lq lr ls dt translated"><strong class="jj hv"> <em class="lt">油漆</em> </strong> —任何受影响的区域都需要重新油漆。</li><li id="bbaa" class="lk ll hu jj b jk lu jo lv js lw jw lx ka ly ke lp lq lr ls dt translated"><strong class="jj hv"> <em class="lt">合成</em></strong>——最终绘制的元素需要重新合成在一起。</li></ol><p id="42a5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">希望您对框架生命周期有所了解。如果你想进一步了解，看看浏览器渲染优化课程。</p><div class="lz ma fm fo mb mc"><a href="https://in.udacity.com/course/browser-rendering-optimization--ud860" rel="noopener  ugc nofollow" target="_blank"><div class="md ab ej"><div class="me ab mf cl cj mg"><h2 class="bd hv fv z el mh eo ep mi er et ht dt translated">浏览器渲染优化| Udacity</h2><div class="mj l"><h3 class="bd b fv z el mh eo ep mi er et ek translated">本课程将揭开浏览器渲染管道的神秘面纱，让您轻松构建高性能的网络…</h3></div><div class="mk l"><p class="bd b gc z el mh eo ep mi er et ek translated">in.udacity.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq ja mc"/></div></div></a></div><h2 id="27d9" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">jQuery如何影响优步？</h2><p id="d045" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">直奔主题，让我开始列出加载<a class="ae jg" href="https://eng.uber.com/" rel="noopener ugc nofollow" target="_blank">eng.uber.com</a>时发生的不平稳的事情。</p><p id="6e44" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">先看看视频里的混蛋。</p><figure class="lg lh li lj fq iv"><div class="bz el l di"><div class="mr ms l"/></div></figure><p id="c320" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">视频中发生了什么？你能认出一些混蛋吗？</p><h1 id="53b2" class="mt kg hu bd kh mu mv mw kl mx my mz kp na nb nc ks nd ne nf kv ng nh ni ky nj dt translated">装载物品时。</h1><figure class="lg lh li lj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nk"><img src="../Images/73e5ef06ae0b777fe07eb5eec5f054bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLeYWwdqU0wWrqltC6Hhuw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Forced reflow — Performance bottleneck.</figcaption></figure><p id="57e7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在加载一篇文章时，你可能会在谷歌浏览器的“性能”标签中看到一条警告，</p><blockquote class="nl nm nn"><p id="2770" class="jh ji lt jj b jk jl jm jn jo jp jq jr no jt ju jv np jx jy jz nq kb kc kd ke hn dt translated"><a class="ae jg" href="https://developers.google.com/web/tools/chrome-devtools/../../fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing#avoid-forced-synchronous-layouts" rel="noopener ugc nofollow" target="_blank">强制回流</a>是一个可能的性能瓶颈——在重新计算样式时。</p></blockquote><h2 id="c3de" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">这是什么？</h2><p id="80b1" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">按照管道，我们需要在样式和布局之前计算几何元素(使用JavaScript)。经过逆向工程(当时找不到贴切的词)<a class="ae jg" href="https://code.jquery.com/jquery-1.12.4.js" rel="noopener ugc nofollow" target="_blank"> jQuery v1.12.4 </a>，我才知道<strong class="jj hv"> div.offsetWidth </strong>(一张图片中的b.offsetWidth)在案例中加载需要几秒钟。记住，我们需要在16.66毫秒内加载一帧</p><figure class="lg lh li lj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nr"><img src="../Images/a3a74c45f1eb1e81a32df4ae8ea3bccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqcWWsmuxtXs9GF6yrUdVg.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Function to set body.style.zoom</figcaption></figure><p id="5bc5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这里，jQuery执行前面提到的函数来设置body.style.zoom属性。根据<a class="ae jg" href="https://developer.mozilla.org/en-US/docs/Web/CSS/zoom" rel="noopener ugc nofollow" target="_blank"> CSS指南</a>，缩放属性为<strong class="jj hv">非标准</strong>且不在标准轨道上。不应在生产现场使用。</p><h2 id="ce06" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">解决方案。</h2><p id="00ab" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">为了克服这个问题，他们可以在CSS级别使用属性<code class="eh ns nt nu nv b"><a class="ae jg" href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/scale" rel="noopener ugc nofollow" target="_blank">transform: scale()</a></code>,或者升级jQuery，我希望在下一个版本中可以解决这个问题。</p><h1 id="c1ae" class="mt kg hu bd kh mu mv mw kl mx my mz kp na nb nc ks nd ne nf kv ng nh ni ky nj dt translated">为什么使用<a class="ae jg" href="http://dimsemenov.com/plugins/magnific-popup/" rel="noopener ugc nofollow" target="_blank">放大弹出菜单</a>？</h1><h2 id="55fb" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">这是什么？</h2><blockquote class="nl nm nn"><p id="537f" class="jh ji lt jj b jk jl jm jn jo jp jq jr no jt ju jv np jx jy jz nq kb kc kd ke hn dt translated">Magnific Popup是一个响应式lightbox &amp; dialog脚本，专注于性能，为使用任何设备的用户提供最佳体验<br/>(用于jQuery或Zepto.js)。</p></blockquote><p id="42cb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我找不到确切的原因，比如为什么使用这个弹出插件(也许有一些情况，我不知道)，但我可以向你保证，你正在损害你的网站的性能。</p><figure class="lg lh li lj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nw"><img src="../Images/4e2e30449143663e4b893b25e0c81c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_YqauTSmVWriqrk19i5Dw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae jg" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank">requestAnimationFrame</a> can be used instead of setInterval</figcaption></figure><p id="1bef" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这里，setInterval一直调用一个名为<strong class="jj hv"> detectChanges，</strong>的方法，该方法计算元素相对于浏览器的几何(clientWidth)并使用setInterval在某一点迭代该函数，可能会导致低质量的动画。</p><h2 id="f9e3" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">解决方案。</h2><p id="a8e4" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">这里，Magnific Popup仍然使用setInterval，而我们有了最新的Web API，名为<a class="ae jg" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank"><em class="lt">requestAnimationFrame</em></a>。</p><p id="4bb5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae jg" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank"><em class="lt">requestAnimationFrame</em></a>API产生高质量的动画，完全消除了使用setTimeout或setInterval时可能发生的闪烁和剪切。</p><p id="2f99" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">检查<a class="ae jg" href="https://stackoverflow.com/questions/38709923/why-is-requestanimationframe-better-than-setinterval-or-settimeout" rel="noopener ugc nofollow" target="_blank"> <em class="lt">为什么requestAnimationFrame比setInterval或setTimeout </em> </a>更清晰。</p><p id="dd2c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">全球92.78%的用户使用requestAnimationFrame(来源:<a class="ae jg" href="https://caniuse.com/#feat=requestanimationframe" rel="noopener ugc nofollow" target="_blank">can use</a>)。当谈到浏览器兼容性时，我可能是错误的，在旧的浏览器中可能会出现漂亮的弹出窗口。</p><p id="45a7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我只是想让优步让他们知道这是事实，大多数浏览器都支持requestAnimationFrame，作为一名前端工程师，我也这么建议。</p></div><div class="ab cl nx ny hc nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="hn ho hp hq hr"><p id="d301" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">同样，在滚动、导航等过程中，我可以发现网站的许多性能瓶颈。同样在UberEats中，这个问题可以通过移除jQuery或<strong class="jj hv">来解决，方法是雇佣像我这样的前端开发者，他可以让网站以60fps的速度运行，而我现在失业了。</strong></p><blockquote class="oe"><p id="59f2" class="of og hu bd oh oi oj ok ol om on ke ek translated">甚至在<a class="ae jg" href="https://www.ubereats.com/en-IN/stores/" rel="noopener ugc nofollow" target="_blank"> UberEats </a>中，我在跟踪我已经订购的订单时发现了一些性能问题。帧没有在60fps内渲染，这导致骑手移动时地图垃圾。</p></blockquote><p id="93c0" class="pw-post-body-paragraph jh ji hu jj b jk oo jm jn jo op jq jr js oq ju jv jw or jy jz ka os kc kd ke hn dt translated">作为一名优步爱好者和前端开发人员，优步从jQuery到React-Redux的技术转变是一个很好的举措。</p><p id="4932" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我不知道<a class="ae jg" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" rel="noopener ugc nofollow" target="_blank"> Web Workers </a>在他们的堆栈中被利用到了什么程度，这可以极大地提高他们的性能。</p><p id="dfc7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我个人很喜欢优步，也看到了它在日常生活中的进步。作为前端技术的终身爱好者，我确信我可以帮助您应对前端即将到来的挑战。</p><p id="578a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我只是想让这些东西接触到优步，这样他们也应该关心他们的技术爱好者。</p></div><div class="ab cl nx ny hc nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="hn ho hp hq hr"><h2 id="9670" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">测试机器的配置。</h2><p id="514e" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">谷歌Chrome版本:<strong class="jj hv"> 69.0.3497.100(正式版)(64位)</strong></p><p id="50be" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">iMac (Retina 5K，27英寸，2017) macOS High Sierra。版本10.13.4。</p><p id="f92e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">(仅供参考，优步工程网站是在谷歌浏览器的匿名模式下加载的，所以我不想指责任何扩展。)</p><p id="611d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv">免责声明</strong>:我尽我所知写了这篇文章，有错的地方请大家指正。我也很想知道这些事情。</p><p id="57db" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">谢谢你。</p></div></div>    
</body>
</html>