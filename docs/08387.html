<html>
<head>
<title>Splunking Power Mains</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">劈啪作响的电源</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/splunking-power-mains-6620505aa4af?source=collection_archive---------15-----------------------#2018-10-07">https://medium.com/hackernoon/splunking-power-mains-6620505aa4af?source=collection_archive---------15-----------------------#2018-10-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/c4ce7aba38117850a540acfc809bb96e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AhUe5N8kiku9QRIvl6hYGQ.jpeg"/></div></div></figure><p id="c5ce" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">拿Splunk，一个无线智能电表，一个api接口，会怎么样？挥霍你整个家的电源干线，不要碰任何一根电线！这使得整个房子都可以实时查看所有消耗的功率。唯一的要求是网络上的raspberry pi、某处的splunk实例和插入pi的usb适配器。</p><p id="ca43" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">等等，什么是智能电表？最近，主要的电力公司都在四处走动，用新的智能电表取代每个家庭的旧电表。这基本上只是一个zigbee功能的电表，允许电源车在街上行驶并快速收集所有读数，而无需抄表员步行挨家挨户。<a class="ae ka" href="https://www.comed.com/SmartEnergy/SmartMeterSmartGrid/Pages/ForYourHome.aspx" rel="noopener ugc nofollow" target="_blank">https://www . comed . com/smart energy/SmartMeterSmartGrid/Pages/for your home . aspx</a>T3】此页面或类似提供商的页面在识别安装的电表类型时非常有用。然后识别与智能电表兼容的usb加密狗，大多数网站都有这些设备的列表。然后订购并通过电力公司注册。一个简单的过程，但它需要文书工作和一些筹备时间。这里将使用的设备是雨林EMU-2能源监测装置。【https://www.amazon.com/gp/product/B00BGDPRAI】T4/</p><p id="8d0d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有足够的准备时间投入进去。大部分工作将通过python脚本完成，该脚本从usb适配器读取数据，USB适配器被认为是pi上的一个串行端口。然后，我们将python脚本作为一项服务安装在pi上，这将允许它在引导时运行，并且容易重启和监控。</p><p id="cda9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">python脚本:</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="7618" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里有两个需求pyRaven和Splunk_hec_handler，它们可以在这里找到:<br/><a class="ae ka" href="https://github.com/vavarachen/splunk_hec_handler" rel="noopener ugc nofollow" target="_blank">https://github.com/vavarachen/splunk_hec_handler</a><br/><a class="ae ka" href="https://github.com/nonspecialist/pyraven" rel="noopener ugc nofollow" target="_blank">https://github.com/nonspecialist/pyraven</a><br/>Splunk HEC处理程序也可以在pypi中找到，但是在编写pypi上的版本时被破坏了，无法在pip中安装，转而去寻找源代码，然后执行<code class="eh kh ki kj kk b">python setup.py install</code></p><p id="c906" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太好了，我们有了要求和剧本。这个脚本非常简单，它连接到串行端口，当数据流过时，它会监听串行端口并进行解析。这就是usb设备的可怕之处，它有查询api的选项，但有4秒钟的延迟，在此期间，相同的数据会自动吐出，然后再从查询中吐出。坐在那里听消防水管的声音真的很容易。不管怎样，pyraven库完成了所有的工作，我们正在插入它以获取json对象并将其传递给splunkhec函数。splunkhec函数接收数据，附加所需的包装器并发布事件。事件的发布然后由splunkhec库处理，因为当我们可以使用库来做这件事时，为什么要重新发明轮子和处理rest帖子。这为我们提供了一个加载到splunk中的json对象。</p><p id="c1d8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我们检查数据后，我们可以看到一个简单的splunk搜索，会给我们下图。</p><blockquote class="kl km kn"><p id="b25b" class="jc jd ko je b jf jg jh ji jj jk jl jm kp jo jp jq kq js jt ju kr jw jx jy jz hn dt translated">host = gate | time chart avg(event . raw _ demand)as Load span = 1m</p></blockquote><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ks"><img src="../Images/cf8bb43141dc07d3f208d453a0f16504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3h32Yqw51Ci8l5jYtMVxIg.png"/></div></div></figure><p id="ecc9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">服务:为了让pi自动运行这个脚本，使用并安装了一个服务模板。该服务假设上面的emu.py将存储在<code class="eh kh ki kj kk b">/home/pi/</code>文件夹中。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="55c1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">好的，下一步是确保python脚本是可执行的，然后安装服务模板并让它运行。这些都可以通过下面的代码片段来完成。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="62cf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是它的全部，服务运行python脚本并输出一大堆好的数据来玩。一旦获得数据，就有无限的可能性从splunk中监控和报告高使用率或异常使用率。</p><p id="a072" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">* * *附加信息:(解析需要JQ)为了将数据导入splunk，需要一个HTTP收集器令牌。使用curl生成一个令牌:</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="135c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">链接:</p><div class="kt ku fm fo kv kw"><a href="http://dev.splunk.com/view/event-collector/SP-CAAAE7D" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab ej"><div class="ky ab kz cl cj la"><h2 class="bd hv fv z el lb eo ep lc er et ht dt translated">使用CLI管理HTTP事件收集器| Splunk</h2><div class="ld l"><h3 class="bd b fv z el lb eo ep lc er et ek translated">Splunk对来自任何应用程序、服务器或网络设备的数据进行实时索引和搜索，包括日志、配置…</h3></div><div class="le l"><p class="bd b gc z el lb eo ep lc er et ek translated">dev.splunk.com</p></div></div></div></a></div><div class="kt ku fm fo kv kw"><a href="https://github.com/rainforestautomation/Emu-Serial-API" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab ej"><div class="ky ab kz cl cj la"><h2 class="bd hv fv z el lb eo ep lc er et ht dt translated">雨林自动化/Emu-串行-API</h2><div class="ld l"><h3 class="bd b fv z el lb eo ep lc er et ek translated">这个存储库允许您通过它的串行接口访问雨林自动化Emu2</h3></div><div class="le l"><p class="bd b gc z el lb eo ep lc er et ek translated">github.com</p></div></div><div class="lf l"><div class="lg l lh li lj lf lk ja kw"/></div></div></a></div><div class="kt ku fm fo kv kw"><a href="https://github.com/vavarachen/splunk_hec_handler" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab ej"><div class="ky ab kz cl cj la"><h2 class="bd hv fv z el lb eo ep lc er et ht dt translated">vavarachen/splunk_hec_handler</h2><div class="ld l"><h3 class="bd b fv z el lb eo ep lc er et ek translated">Splunk HTTP事件收集器(HEC)的Python日志处理程序。- vavarachen/splunk_hec_handler</h3></div><div class="le l"><p class="bd b gc z el lb eo ep lc er et ek translated">github.com</p></div></div><div class="lf l"><div class="ll l lh li lj lf lk ja kw"/></div></div></a></div><div class="kt ku fm fo kv kw"><a href="https://github.com/nonspecialist/pyraven" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab ej"><div class="ky ab kz cl cj la"><h2 class="bd hv fv z el lb eo ep lc er et ht dt translated">非专家/皮拉文</h2><div class="ld l"><h3 class="bd b fv z el lb eo ep lc er et ek translated">与雨林自动化RAVEn USB设备的接口-非专业人员/pyraven</h3></div><div class="le l"><p class="bd b gc z el lb eo ep lc er et ek translated">github.com</p></div></div><div class="lf l"><div class="lm l lh li lj lf lk ja kw"/></div></div></a></div></div></div>    
</body>
</html>