<html>
<head>
<title>DevOps101 — Infrastructure as Code With Vagrant (LAMP Stack)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">devo PS 101——基础设施as代码，带流浪者(灯堆栈)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/devops101-itinfrastructure-54337d6a148b?source=collection_archive---------5-----------------------#2018-10-08">https://medium.com/hackernoon/devops101-itinfrastructure-54337d6a148b?source=collection_archive---------5-----------------------#2018-10-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="968e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你好！这篇文章旨在提供一个高层次的，简单的和实用的解释，说明如何使用作为代码工具的基础设施。我们将建立一个简单的IT场景。</p><p id="ee71" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">我目前是一名教师助理</em>👨‍💻<em class="jp"> @ </em> <a class="ae jq" href="https://tecnico.ulisboa.pt/en/" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> Técnico葡京</em> </a> <em class="jp">，我正与</em><a class="ae jq" href="https://fenix.tecnico.ulisboa.pt/homepage/ist40132" rel="noopener ugc nofollow" target="_blank"><em class="jp">Rui Cruz</em></a>博士教授密切合作👨‍🏫<em class="jp">参加</em> <a class="ae jq" href="https://fenix.tecnico.ulisboa.pt/disciplinas/AGISIT/2018-2019/1-semestre" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> It基础设施管理与行政</em> </a> <em class="jp"> </em> 🖥 <em class="jp">，一门</em>硕士水平的课程“信息系统与计算机工程硕士学位”和“电信与信息工程硕士学位”<em class="jp">@</em><a class="ae jq" href="https://tecnico.ulisboa.pt/en/" rel="noopener ugc nofollow" target="_blank"><em class="jp">técnico Lisboa</em></a><em class="jp">。</em></p></div><div class="ab cl jr js hc jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hn ho hp hq hr"><p id="9ceb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我的上一篇DevOps101文章中，我们引入了vagger并安装了设置环境所需的工具。现在，我们可以更深入一点，深入到代码为  <strong class="it hv"> (IaC)的<a class="ae jq" href="https://en.wikipedia.org/wiki/Infrastructure_as_Code" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">基础设施。</strong>这有什么关系？这与DevOps有什么关系？花些时间学习这些概念和工具有什么实实在在的好处？</a></strong></p><p id="4341" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据<a class="ae jq" href="https://www.ipexpoeurope.com/content/download/10069/143970/file/2017-state-of-devops-report.pdf" rel="noopener ugc nofollow" target="_blank">2017年DevOps国家报告</a>，在DevOps团队工作的人的百分比每年都在增加。为什么？公司把赌注押在自动化上，因为这对组织来说是一个巨大的福利。正如DevOps报告中所述，随着更多工作实现自动化，高绩效员工可以解放他们的技术人员，让他们从事创新工作，为他们的组织增加真正的价值。换句话说，你节省了时间、金钱和潜在的麻烦。如果您对自动化感兴趣，请考虑敏捷开发运维:</p><figure class="jz ka kb kc fq kd fe ff paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="fe ff jy"><img src="../Images/098d0cb47c9f35124d9a92ea2092e93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpNTb_INXfTdMqXP3TjySA.png"/></div></div><figcaption class="kk kl fg fe ff km kn bd b be z ek"><a class="ae jq" href="https://surittec.com.br/devops.html" rel="noopener ugc nofollow" target="_blank">https://surittec.com.br/devops.html</a></figcaption></figure><p id="6239" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它将敏捷世界的精华与测试、交付和集成的良好实践相结合。这为应用精益方法提供了一种非常有效的方式，我在我的文章<a class="ae jq" href="https://blog.startuppulse.net/top-8-lessons-ive-learned-in-european-innovation-academy-2017-50eeb82d74b4" rel="noopener ugc nofollow" target="_blank">中谈到了欧洲创新学院</a>。</p><p id="3de7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有很多工具可以用来实现您的敏捷开发运维策略。以下是一些例子:</p><figure class="jz ka kb kc fq kd fe ff paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="fe ff ko"><img src="../Images/fb57f502cf7977ff12b32d80992dc264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_IpJo9kJvXLr5mx55g4bQ.jpeg"/></div></div><figcaption class="kk kl fg fe ff km kn bd b be z ek">By XebialLabs</figcaption></figure><p id="2424" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然vagger不是将基础设施实践实现为代码的最强大的工具，但它是被选中的一个，因为它是一个简单的工具。</p><h1 id="c9ba" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">理论够了，动手吧！</h1><p id="2523" class="pw-post-body-paragraph ir is hu it b iu ln iw ix iy lo ja jb jc lp je jf jg lq ji jj jk lr jm jn jo hn dt translated">女士们先生们，让我们开始工作吧。</p><p id="252f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者目标是启动一个简单的基础设施，由2台运行<a class="ae jq" href="https://www.digitalocean.com/community/tags/lamp-stack?type=tutorials" rel="noopener ugc nofollow" target="_blank">灯栈</a>的web服务器和一台客户机组成。正如您在上一篇文章中所记得的，我们应该定义一个<a class="ae jq" href="https://www.vagrantup.com/docs/vagrantfile/" rel="noopener ugc nofollow" target="_blank">浮动文件</a>，它是一个声明性文件，包含启动哪些机器以及如何配置这些机器的指令。</p><p id="f8a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你不想输入代码，你可以分叉<a class="ae jq" href="https://github.com/RafaelAPB/DevOps101-Simple-Infrastructure" rel="noopener ugc nofollow" target="_blank">我的Github库</a>并从那里开始执行步骤。</p><h1 id="dfea" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">安装</h1><p id="096a" class="pw-post-body-paragraph ir is hu it b iu ln iw ix iy lo ja jb jc lp je jf jg lq ji jj jk lr jm jn jo hn dt translated">出于演示的目的，我们将使用一台<a class="ae jq" href="https://app.vagrantup.com/ubuntu/boxes/trusty64" rel="noopener ugc nofollow" target="_blank"> ubuntu/trusty64机器</a>。下载机器并将其添加到机器列表中，包括:</p><p id="cebf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建一个名为“simple infrastructure”的文件夹，然后添加我们将要使用的框:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="3108" class="lx kq hu lt b fv ly lz l ma mb">vagrant box add ubuntu/trusty64</span></pre><p id="47b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建一个名为“流浪者文件”(没有扩展名)的文件。代码的解释在评论中:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="485c" class="lx kq hu lt b fv ly lz l ma mb">Vagrant.configure("2") do |config|</span><span id="a566" class="lx kq hu lt b fv mc lz l ma mb">  # Always use Vagrant's default insecure key<br/>    config.ssh.insert_key = false<br/>  # To avoid/allow install and uninstall of VBoxGuessAdditions.<br/>    config.vbguest.auto_update = false<br/> end</span></pre><p id="d208" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">客户端机器可以这样定义:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="d5ac" class="lx kq hu lt b fv ly lz l ma mb">config.vm.define "client" do |client_config|</span><span id="716e" class="lx kq hu lt b fv mc lz l ma mb">      #We are attributing an "OS" to our machine<br/>      client_config.vm.box = "ubuntu/trusty64"<br/>      <br/>      #The hostname will be client <br/>      client_config.vm.hostname = "client"<br/>      <br/>      #Attributing an IP to our machine    <br/>      client_config.vm.network "private_network", ip: "192.168.56.21"</span><span id="a916" class="lx kq hu lt b fv mc lz l ma mb">      #Using VirtualBox to launch the machines<br/>      client_config.vm.provider "virtualbox" do |vb|<br/>        vb.name = "client"<br/>        #About opts: <a class="ae jq" href="https://www.virtualbox.org/manual/ch08.html" rel="noopener ugc nofollow" target="_blank">https://www.virtualbox.org/manual/ch08.html</a>       <br/>        opts = ["modifyvm", :id, "--natdnshostresolver1", "on"]<br/>        vb.customize opts<br/>        vb.memory = 256<br/>      <br/>       #You can also define the number of cpus: vb.cpus = x<br/>       end # of vb<br/>    end # of client_config</span></pre><p id="29df" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我们可以添加web服务器:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="667d" class="lx kq hu lt b fv ly lz l ma mb">config.vm.define "web-server-1" do |web_config|<br/>      #Operating System<br/>      web_config.vm.box = "ubuntu/trusty64"<br/>      web_config.vm.hostname = "web-server-1"<br/>      #How the Host sees the Box<br/>      web_config.vm.network "private_network", ip: "192.168.56.31"<br/>      #Port 80 is the default port for Apache, port that listens to clients<br/>      #Port 8080 is typically used for a personally hosted web server<br/>      web_config.vm.network "forwarded_port", guest: 80, host: "8081" <br/>   <br/>       #Synchronizing our html folder with apache's www/html folder</span><span id="57d8" class="lx kq hu lt b fv mc lz l ma mb">       web_config.vm.synced_folder ".", "/var/www/html", :nfs      =&gt; {:mount_options =&gt; ["dmode=777","fmode=666"]}<br/>      web_config.vm.provider "virtualbox" do |vb|<br/>        vb.name = "web-server-1"<br/>        opts = ["modifyvm", :id, "--natdnshostresolver1", "on"]<br/>        vb.customize opts<br/>        vb.memory = 256<br/>        #vb.cpus = 4<br/>      end # of vb<br/>      web_config.vm.provision "shell", path: "bootstrap_web.sh"<br/>    end # of web_config</span></pre><p id="a472" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们想要启动两个web服务器，我们不应该重复代码，因为只有几个参数需要更改:虚拟机(vm)的名称、主机名、ip、主机端口和虚拟机箱名称。我们将遵循<a class="ae jq" href="https://www.vagrantup.com/docs/vagrantfile/tips.html" rel="noopener ugc nofollow" target="_blank">流浪者</a>推荐的一些好的实践，比如使用一个循环来定义类似的机器:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="7c5e" class="lx kq hu lt b fv ly lz l ma mb">(1..2).each do |i|<br/>    config.vm.define "web-server-#{i}" do |web_config|<br/>      #Operating System<br/>      web_config.vm.box = "ubuntu/trusty64"<br/>      web_config.vm.hostname = "web-server-#{i}"<br/>      #How the Host sees the Box<br/>      web_config.vm.network "private_network", ip: "192.168.56.3#{i}"<br/>      #Port 80 is the default port for Apache, port that listens to clients<br/>      #Port 8080 is typically used for a personally hosted web server<br/>      web_config.vm.network "forwarded_port", guest: 80, host: "808#{i}"</span><span id="70bc" class="lx kq hu lt b fv mc lz l ma mb">#Synchronizing our html folder with apache's www/html folder</span><span id="a026" class="lx kq hu lt b fv mc lz l ma mb">web_config.vm.synced_folder ".", "/var/www/html", :nfs      =&gt; {:mount_options =&gt; ["dmode=777","fmode=666"]}</span><span id="37bd" class="lx kq hu lt b fv mc lz l ma mb">      web_config.vm.provider "virtualbox" do |vb|<br/>        vb.name = "web-server-#{i}"<br/>        opts = ["modifyvm", :id, "--natdnshostresolver1", "on"]<br/>        vb.customize opts<br/>        vb.memory = 256<br/>        #vb.cpus = 4<br/>      end # of vb<br/>      web_config.vm.provision "shell", path: "bootstrap_web.sh"<br/>    end # of web_config<br/>  end # of loop</span></pre><p id="7ac4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了配置我们的机器，将这个bash脚本下载到您的文件夹:<a class="ae jq" href="https://paste.ee/p/G7uiA" rel="noopener ugc nofollow" target="_blank">https://paste.ee/p/G7uiA</a>f</p><p id="1806" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个脚本将安装LAMP机器所需的所有依赖项。我们告诉过流浪者将/var/www与包含流浪者文件的文件夹同步。创建一个名为<strong class="it hv"> index </strong>的html文件。让它空着。</p><p id="4962" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要查看正在启动的服务器和供应的输出，请运行:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="697a" class="lx kq hu lt b fv ly lz l ma mb">$ vagrant up --provision</span></pre><p id="e36e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在您可以通过“<strong class="it hv">流浪ssh名称”</strong>登录任何机器。例如，通过键入以下内容输入web-server-1</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="a306" class="lx kq hu lt b fv ly lz l ma mb">$ vagrant shh web-server-1</span></pre><p id="a225" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，通过ping其他机器和您的主机来检查机器是否正在运行:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="586d" class="lx kq hu lt b fv ly lz l ma mb">vagrant@web-server-1:$ ping 192.168.56.32</span><span id="5632" class="lx kq hu lt b fv mc lz l ma mb">...<br/>vagrant@web-server-1:$ ping <strong class="lt hv">YOUR_HOST_MACHINE_IP</strong></span><span id="4db1" class="lx kq hu lt b fv mc lz l ma mb">...</span></pre><p id="4736" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以通过键入以下内容来获取有关网络的更多信息:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="e680" class="lx kq hu lt b fv ly lz l ma mb">vagrant@web-server-1:$ ip addr show</span></pre><p id="f3e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在您知道您的机器正在运行和通信。当我们转发我们的web服务器端口时，我们可以通过我们的web浏览器在地址:localhost: 8081和localhost: 8082中访问机器。</p><p id="5acd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每一个都对应一个不同的网络服务器，它的页面与index.html<strong class="it hv">的文件</strong>相关联。如果您更改文件，当您刷新页面时，您会注意到浏览器中的变化。</p><p id="56fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要完成我们的实验，请运行:</p><pre class="jz ka kb kc fq ls lt lu lv aw lw dt"><span id="b670" class="lx kq hu lt b fv ly lz l ma mb">$ vagrant halt</span></pre><h1 id="1179" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">包扎</h1><p id="4037" class="pw-post-body-paragraph ir is hu it b iu ln iw ix iy lo ja jb jc lp je jf jg lq ji jj jk lr jm jn jo hn dt translated">在本文中，我们简要介绍了IaC并介绍了敏捷开发运维。我们设置并启动了一个由两个LAMP web服务器和一台客户机组成的简单基础设施。</p><p id="67ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">祝贺你！</em>💯您已到达终点！ <a class="ae jq" href="https://emojipedia.org/unicorn-face/" rel="noopener ugc nofollow" target="_blank">🦄</a></p></div><div class="ab cl jr js hc jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hn ho hp hq hr"><h1 id="a648" class="kp kq hu bd kr ks md ku kv kw me ky kz la mf lc ld le mg lg lh li mh lk ll lm dt translated">后续步骤:</h1><h2 id="67a9" class="lx kq hu bd kr mi mj mk kv ml mm mn kz jc mo mp ld jg mq mr lh jk ms mt ll mu dt translated">干杯，继续摇摆💪如果你喜欢这篇文章，请订阅我的邮件列表。<br/>此处👇。这对我意义重大。</h2><figure class="jz ka kb kc fq kd fe ff paragraph-image"><a href="http://eepurl.com/go_uUD"><div class="fe ff mv"><img src="../Images/b802eda461e56087a1ffff179f0e2459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*MAwoJUN3vK5V6BTJdIKOBA.png"/></div></a></figure></div></div>    
</body>
</html>