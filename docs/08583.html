<html>
<head>
<title>Administrating AWS resources productively using the AWS CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS CLI高效管理AWS资源</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/administrating-aws-resources-productively-using-the-aws-cli-efbbbae68692?source=collection_archive---------19-----------------------#2018-10-15">https://medium.com/hackernoon/administrating-aws-resources-productively-using-the-aws-cli-efbbbae68692?source=collection_archive---------19-----------------------#2018-10-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="50d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文改编自我新的</em> <a class="ae jq" href="https://pluralsight.pxf.io/c/1191769/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fautomating-aws-operations-aws-cli" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> Pluralsight课程:使用AWS CLI自动化AWS操作。</em> </a></p><p id="e6b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我敢打赌，你已经在AWS上运行了一些东西，而且是使用浏览器控制台实现的。但是我敢打赌，你已经怀疑点击配置页面的一层又一层并不总是最好的方法。事实上，AWS CLI是一种更好的方式，它可以完成完全相同的工作，但要少很多工作。</p><p id="6d3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我快速演示一下。假设您想从EC2启动一个Amazon Linux实例。要启动并运行它，您需要…</p><ul class=""><li id="8bdf" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated">加载EC2仪表板页面</li><li id="7705" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">单击启动实例</li><li id="9111" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">从AMI页面中选择一个AMI</li><li id="84ff" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">从“实例类型”页面中选择实例类型</li><li id="b065" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">在“配置实例详细信息”页面上设置网络、IAM、生命周期行为和用户数据设置</li><li id="bc53" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">在“添加存储”页面上选择一个或多个存储卷</li><li id="4f35" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">在“添加标签”页面上添加标签</li><li id="436d" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">在“等待—配置安全组”页面上选择或配置安全组</li><li id="38fc" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">最后在名为(还有什么？)审核并启动</li></ul><p id="3625" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要忘记点击弹出窗口，在那里您将确认您的密钥对，然后返回到EC2实例仪表板以获取您的实例数据(如IP地址)。</p><p id="ab76" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你觉得好玩吗？如果你用慢速网络连接工作，听起来还会有趣吗？如果您需要一周执行六次这个过程的变体，那该怎么办呢？</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kf"><img src="../Images/7b5a414db7f644aaeea39ad3470c0837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ni2PeZgp3gOxxCmUU9Yq_g.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">The keyboard: all you really need to manage your AWS stuff</figcaption></figure><p id="f5a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">想看看如何从Bash shell(可以在Linux、macOS甚至Windows 10中运行)使用AWS CLI启动配置吗？注意我是如何使用反斜杠告诉Bash命令还没有完成的。按回车键让整个混乱状态开始运行。</p><pre class="kg kh ki kj fq kv kw kx ky aw kz dt"><span id="8552" class="la lb hu kw b fv lc ld l le lf">aws ec2 run-instances --image-id ami-04681a1dbd79675a5 \<br/> --count 1 \<br/> --instance-type r5d.large \<br/> --key-name MyKeyPair \<br/> --security-group-ids sg-007e43f80a1758f29 \<br/> --subnet-id subnet-970ec9f0 \<br/> --user-data file://my_script.sh \<br/> --tag-specifications \<br/> ‘ResourceType=instance,Tags=[{Key=backend,Value=inventory1}]’</span></pre><p id="2c08" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你只是把这个精确的命令粘贴到你的终端并运行它，它就不会为你工作。安全组和子网id是特定于我的帐户的，您可能还没有名为MyKeyPair的密钥对或名为my_script.sh的脚本文件，但这确实向您展示了，一旦您完成了一些基本的预先研究以获得所有正确的值并确认它有效，您就能够将该命令保存到一个脚本文件中，您可以在需要时修改并运行该文件。这可以将五分钟的过程缩短到几秒钟。</p><p id="fac2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">获取操作系统最新CLI安装说明的最佳途径是<a class="ae jq" href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html" rel="noopener ugc nofollow" target="_blank">AWS文档页面</a>。您最好的选择通常是使用PIP的Python包管理器方法。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff lg"><img src="../Images/1ebd7a1d6f54339089b37402e97e6512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLJTJPliRWHIL0Mg1IsHKg.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">The AWS CLI Installation Page</figcaption></figure><p id="335a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">配置您的CLI以安全地访问和管理您的AWS帐户资源相当简单。尽管您首先需要从控制台的帐户下拉菜单中的My Security Credentials链接为您的AWS用户生成(并复制/记录)一个访问密钥。完成后，只需在命令提示符下键入“aws configure ”,然后输入从我的安全凭证中获得的访问密钥ID和秘密访问密钥。您可以选择默认区域和输出格式值。</p><pre class="kg kh ki kj fq kv kw kx ky aw kz dt"><span id="b23b" class="la lb hu kw b fv lc ld l le lf">worker@workstation:~$ aws configure<br/>AWS Access Key ID [****************KB2Q]: <br/>AWS Secret Access Key [****************W/Cu]: <br/>Default region name [us-east-1]: <br/>Default output format [text]: <br/>worker@workstation:~$</span></pre><h2 id="929d" class="la lb hu bd lh li lj lk ll lm ln lo lp jc lq lr ls jg lt lu lv jk lw lx ly lz dt translated">AWS CLI语法模式</h2><p id="2b29" class="pw-post-body-paragraph ir is hu it b iu ma iw ix iy mb ja jb jc mc je jf jg md ji jj jk me jm jn jo hn dt translated">你现在可以开始了。让我们从将命令语法分解成其组成部分开始，并使用实际例子来说明它是如何工作的。在aws命令前缀之后，CLI命令由<strong class="it hv">选项</strong>(顾名思义，是可选的)<strong class="it hv">命令</strong>、<strong class="it hv">子命令</strong>和<strong class="it hv">参数</strong>组成。</p><pre class="kg kh ki kj fq kv kw kx ky aw kz dt"><span id="428d" class="la lb hu kw b fv lc ld l le lf">aws [options] &lt;command&gt; &lt;subcommand&gt; [parameters]</span></pre><p id="129d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个例子将返回Amazon官方维护的运行CentOS Linux操作系统的所有EC2 AMI映像。</p><pre class="kg kh ki kj fq kv kw kx ky aw kz dt"><span id="7b75" class="la lb hu kw b fv lc ld l le lf">aws --output table ec2 describe-images \<br/> --filters “Name=description,Values=*CentOS*” \<br/> “Name=owner-alias,Values=amazon”</span></pre><p id="6914" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它使用<strong class="it hv">输出</strong>选项，给它一个“<em class="jp">表</em>的值来显示表格中的文本输出。这里的顶层<strong class="it hv">命令</strong>是ec2。大多数(如果不是全部的话)顶级命令将调用特定的AWS服务。s3、iam和dynamodb是其他示例。</p><p id="450d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">子命令</strong>是<em class="jp"> describe-images </em>，它将返回与当前可用于EC2实例的所有Amazon机器映像相关的数据。这将返回大量的数据，因为有数百个ami，每个都由大量的元数据表示。所以你需要缩小搜索范围。为此，我为— filters参数提供了两个值:图像描述应该包含单词<em class="jp"> CentOS </em> —大写c、o和s，因为这将区分大小写，并且owner-alias值必须等于<em class="jp"> amazon </em>。</p><p id="1574" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将经常运行基于<em class="jp"> describe- </em>的子命令来获取重要的资源id，然后您可以将这些id插入到实际的操作命令中。CentOS映像ID通常用作ec2 <em class="jp"> run-instances </em>命令的一部分，以实际启动实例。</p><p id="f0b6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除了describe和run，其他常见的子命令将以动词开头，如create、delete、enable、disable、modify、request、stop和terminate。</p><p id="59a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">选项</strong>包括<em class="jp">区域</em>、<em class="jp">输出</em>和<em class="jp">配置文件</em>——您已经看到过了——加上<em class="jp">模拟运行</em>，它们什么也不做，而是显示如果实际运行，您的命令将生成的输出<em class="jp">。当您不确定语法是否正确时，这非常有用。让我们试着运行上面的ec2 run-instances命令，但是这次添加了<em class="jp">模拟运行</em>。</em></p><h2 id="c29b" class="la lb hu bd lh li lj lk ll lm ln lo lp jc lq lr ls jg lt lu lv jk lw lx ly lz dt translated">S3的例子</h2><p id="0002" class="pw-post-body-paragraph ir is hu it b iu ma iw ix iy mb ja jb jc mc je jf jg md ji jj jk me jm jn jo hn dt translated">是时候来点S3魔法了。我有一个业务，需要一个简单的网站，没有任何数据库访问或javascript的铃铛和哨子。只是一些常规的，运行的工厂，HTML5善良。因此，我将创建、仔细配置并填充我的bucket，使其作为一个静态网站工作，或者换句话说，使传入流量自动定向到我创建的index.html文件。</p><p id="9288" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然它在这个演示中不会起任何作用，但我最终会想要在Amazon的Route 53中设置一个指向该站点的. com域名，因此我需要创建一个完全使用该名称的S3存储桶。com等等。我使用<em class="jp"> mb </em>和一个全局唯一的桶名来创建一个桶。</p><pre class="kg kh ki kj fq kv kw kx ky aw kz dt"><span id="6a0a" class="la lb hu kw b fv lc ld l le lf">$ aws s3 mb s3://mysite548.com</span></pre><p id="a983" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个桶必须是公共可读的，所以我将使用<em class="jp"> s3api put-bucket-acl </em>，以及<em class="jp"> bucket </em>和<em class="jp"> acl </em>参数。后者将取值<em class="jp"> public-read </em>。</p><pre class="kg kh ki kj fq kv kw kx ky aw kz dt"><span id="a34b" class="la lb hu kw b fv lc ld l le lf">$ aws s3api put-bucket-acl --bucket mysite548.com --acl public-read</span></pre><p id="50bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我将使用s3 sync将当前本地目录的所有内容移到我的bucket中。我已经创建了三个文件:<em class="jp">index.html</em>是默认网页，而<em class="jp">error.html</em>将是当一个不存在的资源被请求时加载的页面。还有一个小图像来帮助美化演示。acl public-read参数将赋予文件本身与bucket相同的权限。</p><pre class="kg kh ki kj fq kv kw kx ky aw kz dt"><span id="a2c4" class="la lb hu kw b fv lc ld l le lf">$ aws s3 sync . s3://mysite548.com --acl public-read</span></pre><p id="2e33" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我将使用“s3网站”为S3定义这些html文件的用途。<em class="jp">索引-文档</em>和<em class="jp">错误-文档</em>参数只是指向相关文件。不需要用那些特定的文件名，对了，那只是我。我将使用s3api get-bucket-website来确认该操作。</p><pre class="kg kh ki kj fq kv kw kx ky aw kz dt"><span id="cde8" class="la lb hu kw b fv lc ld l le lf">$ aws s3 website s3://mysite548.com/ --index-document index.html --error-document error.html<br/>$ aws s3api get-bucket-website --bucket mysite548.com</span></pre><h2 id="8708" class="la lb hu bd lh li lj lk ll lm ln lo lp jc lq lr ls jg lt lu lv jk lw lx ly lz dt translated">下一步是什么？</h2><p id="e81f" class="pw-post-body-paragraph ir is hu it b iu ma iw ix iy mb ja jb jc mc je jf jg md ji jj jk me jm jn jo hn dt translated">AWS CLI的命令语法相当直观。然而，你经常需要帮助才能做到完全正确。正如我在<a class="ae jq" href="https://pluralsight.pxf.io/c/1191769/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fautomating-aws-operations-aws-cli" rel="noopener ugc nofollow" target="_blank">plural sight课程</a>中展示的，你可以从命令行的<em class="jp">帮助</em>系统，或者从<a class="ae jq" href="https://docs.aws.amazon.com/cli/latest/reference/index.html#cli-aws" rel="noopener ugc nofollow" target="_blank"> AWS在线文档</a>中获得出色的指导。我的<a class="ae jq" href="https://www.manning.com/books/learn-amazon-web-services-in-a-month-of-lunches?a_aid=bootstrap-it&amp;amp;a_bid=1c1b5e27" rel="noopener ugc nofollow" target="_blank">在一个月的午餐中学习亚马逊网络服务的书</a>也包含有用的指导和例子。</p><p id="5157" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文摘自我的新</em> <a class="ae jq" href="https://pluralsight.pxf.io/c/1191769/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fautomating-aws-operations-aws-cli" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> Pluralsight课程《使用AWS CLI自动化AWS操作》。</em>T13】</a></p></div></div>    
</body>
</html>