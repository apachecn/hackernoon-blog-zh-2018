<html>
<head>
<title>Kubernetes: deploy Laravel the easy way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes:以最简单的方式部署Laravel</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/kubernetes-deploy-laravel-the-easy-way-a3508d8130c0?source=collection_archive---------1-----------------------#2018-10-18">https://medium.com/hackernoon/kubernetes-deploy-laravel-the-easy-way-a3508d8130c0?source=collection_archive---------1-----------------------#2018-10-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/ef568d9c213d1d9d50a49803e3c2f905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mv44WbuUtFLIAr7e.jpg"/></div></div></figure><p id="2734" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Laravel 是一个优秀的用于开发PHP应用程序的<a class="ae ka" href="https://hackernoon.com/tagged/framework" rel="noopener ugc nofollow" target="_blank">框架</a>。无论你需要一个新想法的原型，开发一个MVP(最小可行产品)还是发布一个成熟的企业系统，Laravel都可以帮助你完成所有的开发任务和工作流程。</p><p id="517f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如何处理应用程序的部署是一个不同的故事。在设置类似于远程服务器的本地环境方面，vagger做得非常好。然而，在生产中，您很可能需要不止一个web主机和一个数据库。您可能会为几个需求提供单独的服务。您还需要有适当的机制来确保应用程序始终在线，并且服务器可以有效地平衡负载。</p><p id="078c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本文中，我将解释如何处理作为本地Kubernetes设置运行Laravel应用程序的简单需求。</p><h1 id="1500" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Kubernetes，为什么和什么？</h1><p id="5c4f" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Kubernetes是一个开源系统，最初由Google设计，用于在集群环境中促进容器化应用程序的管理。有些人将其称为编排平台，Kubernetes并不是这种类型的唯一可用平台。虽然，它确实有很高很快的采用率。更不用说，一旦你习惯了，它是很容易实现的。</p><p id="7565" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你仍然想知道为什么有人可以从使用Kubernetes中受益，答案很简单。Kubernetes使得跨多个项目设置和管理任意多的集群变得更加容易。</p><h1 id="0b51" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">将Laravel应用程序部署到Minikube</h1><p id="ba94" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">正如我前面提到的，我将向您展示如何将一个简单的无状态Laravel应用程序部署到Kubernetes。我的目标是详细说明实现这一目标所涉及的步骤，同时解释为什么需要具体的行动。此外，我将向您展示如何快速扩展应用程序，并使用入口控制器使其在指定的主机上可用。</p><p id="3e59" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在几个云主机提供商上运行Kubernetes，比如Google Cloud Engine和Amazon Web Services。在本教程中，您将在Minikube上运行该应用程序，Minikube是一个使本地运行Kubernetes变得容易的工具。</p><p id="0a74" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">与vagger类似，Minikube仅仅是一个包含Kubernetes平台和Docker的虚拟机。您既需要将应用程序部署为Docker容器，也需要使用Kubernetes将它扩展到三个实例。</p><p id="aa7b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">申请</strong></p><p id="08c6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我准备了一个简单的Laravel应用程序，你可以从<a class="ae ka" href="https://github.com/learnk8s/laravel-kubernetes-demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中克隆它。这只不过是一个新的Laravel装置。因此，您可以使用演示应用程序或创建一个新的Laravel应用程序来遵循这个示例。要使用演示应用程序，请将其克隆到您的项目目录中。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="4e36" class="ln kc hu lj b fv lo lp l lq lr">cd /to/your/working/directory git clone git@github.com:learnk8s/laravel-kubernetes-demo.git .</span></pre><p id="104a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">先决条件</strong></p><p id="0bd7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要进行本演示，您需要在本地系统上安装以下软件:</p><p id="58a2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1) <a class="ae ka" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank"> Docker </a></p><p id="8fb3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2) <a class="ae ka" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">库贝克特尔</a></p><p id="cc1f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3) <a class="ae ka" href="https://github.com/kubernetes/minikube/releases" rel="noopener ugc nofollow" target="_blank"> Minikube </a></p><blockquote class="ls lt lu"><p id="be21" class="jc jd lv je b jf jg jh ji jj jk jl jm lw jo jp jq lx js jt ju ly jw jx jy jz hn dt translated"><em class="hu">在Windows上安装和运行这些应用程序是否有问题？查看文章</em><a class="ae ka" href="https://learnk8s.io/blog/installing-docker-and-kubernetes-on-windows" rel="noopener ugc nofollow" target="_blank"><em class="hu">Windows 10</em></a><em class="hu">上的Docker和Kubernetes入门，获得逐步指南。</em></p></blockquote><p id="d66b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Docker图像</strong></p><p id="4fb6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Kubernetes部署容器化的应用程序，因此作为第一步，您需要构建演示应用程序的Docker映像。由于本教程将在Minikube上本地运行，您可以从示例代码中包含的<code class="eh lz ma mb lj b">Dockerfile</code>构建一个本地Docker映像。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="61d9" class="ln kc hu lj b fv lo lp l lq lr">FROM composer:1.6.5 as build <br/>WORKDIR /app <br/>COPY . /app <br/>RUN composer install</span><span id="cb6c" class="ln kc hu lj b fv mc lp l lq lr">FROM php:7.1.8-apache <br/>EXPOSE 80 <br/>COPY --from=build /app /app <br/>COPY vhost.conf /etc/apache2/sites-available/000-default.conf <br/>RUN chown -R www-data:www-data /app \ <br/>  &amp;&amp; a2enmod rewrite</span></pre><p id="3ae8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此<code class="eh lz ma mb lj b">Dockerfile</code>由两部分组成:</p><ul class=""><li id="6c33" class="md me hu je b jf jg jj jk jn mf jr mg jv mh jz mi mj mk ml dt translated">第一部分扩展了一个PHP <code class="eh lz ma mb lj b">composer</code>映像，这样您就可以安装应用程序的依赖项。</li><li id="3db0" class="md me hu je b jf mm jj mn jn mo jr mp jv mq jz mi mj mk ml dt translated">第二部分用Apache web服务器创建一个最终的Docker映像来为应用程序提供服务。</li></ul><p id="da0d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在测试Docker映像之前，您需要构建它:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1f19" class="ln kc hu lj b fv lo lp l lq lr">cd /to/your/project/directory <br/>docker build -t yourname/laravel-kubernetes-demo .</span></pre><p id="7e71" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后使用以下命令运行应用程序:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="f01d" class="ln kc hu lj b fv lo lp l lq lr">docker run -ti \ <br/>  -p 8080:80 \ <br/>  -e APP_KEY=base64:cUPmwHx4LXa4Z25HhzFiWCf7TlQmSqnt98pnuiHmzgY= \     <br/>  laravel-kubernetes-demo</span></pre><p id="dac5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并且应用应该在<code class="eh lz ma mb lj b"><a class="ae ka" href="http://localhost:8080." rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code> <a class="ae ka" href="http://localhost:8080." rel="noopener ugc nofollow" target="_blank">可用。</a></p><p id="13c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过这种设置，容器是通用的，并且<code class="eh lz ma mb lj b">APP_KEY</code>不是硬编码或共享的。</p><p id="49ca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">在Minikube内构建图像</strong></p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="8816" class="ln kc hu lj b fv lo lp l lq lr">cd /to/your/project/directory <br/>eval $(minikube docker-env) <br/>docker build -t yourname/laravel-kubernetes-demo .</span></pre><blockquote class="ls lt lu"><p id="fdcf" class="jc jd lv je b jf jg jh ji jj jk jl jm lw jo jp jq lx js jt ju ly jw jx jy jz hn dt translated">不要忘记执行评估。在虚拟机中构建映像是必要的。您应该在当前终端中只运行一次该命令。</p></blockquote><p id="94e9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">部署镜像</strong></p><p id="2c5b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">既然应用程序的映像已经构建好并在Minikube中可用，您就可以继续部署它了。</p><p id="2643" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我总是首先确保<code class="eh lz ma mb lj b">kubectl</code>在正确的上下文中。在这种情况下，上下文是Minikube。您可以快速切换上下文，如下所示:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="a5c5" class="ln kc hu lj b fv lo lp l lq lr">kubectl config use-context minikube</span></pre><p id="2daf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，您可以部署容器映像:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="724e" class="ln kc hu lj b fv lo lp l lq lr">kubectl run laravel-kubernetes-demo \ <br/>  --image=yourname/laravel-kubernetes-demo \ <br/>  --port=80 \ <br/>  --image-pull-policy=IfNotPresent \ <br/>  --env=APP_KEY=base64:cUPmwHx4LXa4Z25HhzFiWCf7TlQmSqnt98pnuiHmzgY=</span></pre><p id="2381" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面的命令告诉<code class="eh lz ma mb lj b">kubectl</code>从Docker映像运行我们的演示应用程序。该命令的第一个参数只是要求<code class="eh lz ma mb lj b">kubectl</code>不要从注册中心(比如Docker Hub)获取图像，如果它存在于本地的话，在本例中它确实存在。请注意，您仍然需要登录Docker，以便<code class="eh lz ma mb lj b">kubectl</code>可以检查图像是否是最新的。</p><p id="c0be" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以通过运行以下命令来检查是否为应用程序创建了Pod:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="4bc9" class="ln kc hu lj b fv lo lp l lq lr">kubectl get pods</span></pre><p id="a68e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这将返回类似于以下内容的输出:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d2fb" class="ln kc hu lj b fv lo lp l lq lr">NAME                                     READY STATUS RESTARTS AGE <br/>laravel-kubernetes-demo-7dbb9d6b48-q54wp 1/1   Running 0       18m</span></pre><p id="470c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您还可以使用Minikube GUI仪表板来监控集群。GUI也有助于可视化大多数讨论的概念。要查看仪表板，只需运行以下命令:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="6a3f" class="ln kc hu lj b fv lo lp l lq lr">minikube dashboard</span></pre><p id="24f4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">或者获取仪表板的URL地址:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d86b" class="ln kc hu lj b fv lo lp l lq lr">minikube dashboard --url=true</span></pre><p id="50bb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">曝光一项服务</strong></p><p id="75bc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">到目前为止，您已经创建了一个运行应用程序容器的部署。在集群中运行的Pod有一个动态IP。如果您使用IP将流量直接路由到它，您可能仍然需要在每次重新启动Pod时更新路由表。事实上，在每次部署或容器重启时，都会为Pod分配一个新的IP。为了避免手动管理IP地址，您需要使用一个服务。该服务充当一组pod的负载平衡器。因此，即使一个Pod的IP地址发生变化，服务也总是指向它。由于服务总是有相同的IP，你不需要手动更新任何东西。</p><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/e6d7f28ddd9cf6b94054442aa88b0cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3OkPU3U2vLjt9MmvvbmO8g.gif"/></div></div></figure><p id="1ae2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以通过以下方式创建服务:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1483" class="ln kc hu lj b fv lo lp l lq lr">kubectl expose deployment laravel-kubernetes-demo --type=NodePort --port=80</span></pre><p id="7c2a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果一切顺利，您将看到类似于以下内容的确认:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1e3c" class="ln kc hu lj b fv lo lp l lq lr">service "laravel-kubernetes-demo" exposed</span></pre><p id="e5e8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">运行以下命令:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d794" class="ln kc hu lj b fv lo lp l lq lr">kubectl get services</span></pre><p id="24e7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将向您显示正在运行的服务列表。您还可以在仪表板中的“服务”导航菜单下查看正在运行的服务。验证这种部署和服务公开的更令人兴奋的方法显然是在浏览器中查看正在运行的应用程序😊</p><p id="bf5a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要获取应用程序(服务)的URL，可以使用以下命令:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d36f" class="ln kc hu lj b fv lo lp l lq lr">minikube service --url=true laravel-kubernetes-demo</span></pre><p id="6dd8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它将输出类似于以下内容的IP地址和端口号:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d539" class="ln kc hu lj b fv lo lp l lq lr"><a class="ae ka" href="http://192.168.99.101:31399" rel="noopener ugc nofollow" target="_blank">http://192.168.99.101:31399</a></span></pre><p id="5bde" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">或者，直接在浏览器中启动应用程序:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="49e8" class="ln kc hu lj b fv lo lp l lq lr">minikube service laravel-kubernetes-demo</span></pre><p id="b106" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> <em class="lv">不要错过下一个故事，实验或者提示。如果你喜欢这篇文章，请继续关注。将新内容直接发送到您的收件箱，并提高您在Kubernetes中的专业水平。</em> <a class="ae ka" href="https://learnk8s.io/newsletter" rel="noopener ugc nofollow" target="_blank"> <em class="lv">现在就订阅</em> </a></strong></p><p id="7b43" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">缩放</strong></p><p id="3f81" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就是这样。您已经成功地在Kubernetes中部署了应用程序。很刺激。但是做这些有什么意义呢？嗯，您只有一个部署，其中有一个Pod正在运行，被提供给一个具有公开的web服务的节点。让我们将这个部署扩展到应用程序的另外两个实例。</p><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/578139ec17d969166b57a5b41cdc2299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FC3b3_1JxTeX6_j_UOUhTw.gif"/></div></div></figure><p id="75ee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了让您了解自己此时所处的位置，请运行以下命令来获取所需的和可用的pod列表:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="235f" class="ln kc hu lj b fv lo lp l lq lr">kubectl get deployment</span><span id="a1b3" class="ln kc hu lj b fv mc lp l lq lr">NAME                    DESIRED CURRENT UP-TO-DATE AVAILABLE AGE <br/>laravel-kubernetes-demo 1       1       1          1         57m</span></pre><p id="1e39" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">每个的输出将是“1”。您希望有三个可用的单元，因此让我们扩展一下:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="47bc" class="ln kc hu lj b fv lo lp l lq lr">kubectl scale --replicas=3 deployment/laravel-kubernetes-demo <br/>deployment "laravel-kubernetes-demo" scaled</span></pre><p id="10cb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完成了。您已经将第一个单元复制到了另外两个单元，这样就有三个单元运行这个服务。运行<code class="eh lz ma mb lj b">get deployment</code>命令将验证这一点。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="f424" class="ln kc hu lj b fv lo lp l lq lr">kubectl get deployment</span><span id="caaa" class="ln kc hu lj b fv mc lp l lq lr">NAME                    DESIRED CURRENT UP-TO-DATE AVAILABLE AGE <br/>laravel-kubernetes-demo 3       3       3          3         59m</span></pre><p id="b962" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您也可以在面板中的“窗格”下或在“服务详细信息”屏幕中看到这一点。</p><p id="68bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您使用三个pod运行应用程序的三个实例。</p><p id="f234" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">想象一下您的应用程序变得更加流行。成千上万的访问者正在使用你的网站或软件。过去，您可能一直忙于编写更多的脚本来创建应用程序的更多实例。在Kubernetes中，您可以快速扩展到多个实例:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="8b03" class="ln kc hu lj b fv lo lp l lq lr">kubectl scale --replicas=10 deployment/laravel-kubernetes-demo <br/>deployment "laravel-kubernetes-demo" scaled</span></pre><p id="b117" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以看到使用Kubernetes来扩展你的网站是多么方便。</p><p id="5b64" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">入口</strong></p><p id="6ba9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您已经取得了巨大的成就，部署了应用程序并扩展了部署。当指向群集的(Minikube) IP地址和节点的端口号时，您已经在浏览器中看到了正在运行的应用程序。现在，您将看到如何通过分配的URL访问应用程序，就像部署到云时一样。</p><p id="d2bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要在Kubernetes中使用URL，您需要一个入口。入口是一组允许入站连接到达Kubernetes集群的规则。入口是必要的，因为在Kubernetes中，像Pods这样的资源只有IP地址，这些IP地址可以由集群路由，也可以在集群内路由。这意味着它们对于外部世界是不可访问或不可到达的。</p><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/76122a395825f27489e1a46bed54b196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cSxXowV8Ib_hixpQRNbAXA.gif"/></div></div></figure><p id="3d1f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我已经在这个演示应用程序的源代码中包含了一个<code class="eh lz ma mb lj b">ingress.yaml</code>文件，其内容如下:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="3d3e" class="ln kc hu lj b fv lo lp l lq lr">apiVersion: extensions/v1beta1 <br/>kind: Ingress <br/>metadata: <br/>  name: laravel-kubernetes-demo-ingress <br/>  annotations: ingress.kubernetes.io/rewrite-target: / <br/>spec: <br/>  backend: <br/>    serviceName: default-http-server <br/>    servicePort: 80 <br/>  rules: <br/>  - host: laravel-kubernetes.demo <br/>  - http: <br/>      paths: <br/>      - path: / <br/>        backend: <br/>          serviceName: laravel-kubernetes-demo <br/>          servicePort: 80</span></pre><p id="b11f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在Kubernetes资源文件的基本内容中，这个文件定义了路由入站流量时要遵循的一组规则。<code class="eh lz ma mb lj b">laravel-kubernetes.demo</code> URL将指向应用程序正在运行的服务，如之前在端口8181上标记的<code class="eh lz ma mb lj b">laravel-kubernetes-demo</code>。</p><p id="627d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">没有入口控制器，入口资源就没有用，因此您需要创建一个新的控制器或使用现有的控制器。本教程使用Nginx入口控制器来路由流量。Minikube (v0.14及以上版本)附带Nginx安装程序，您需要手动启用它:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1732" class="ln kc hu lj b fv lo lp l lq lr">minikube addons enable ingress</span></pre><blockquote class="ls lt lu"><p id="8a53" class="jc jd lv je b jf jg jh ji jj jk jl jm lw jo jp jq lx js jt ju ly jw jx jy jz hn dt translated"><em class="hu">请注意，Minikube下载并安装Nginx作为入口可能需要几分钟时间。</em></p></blockquote><p id="5456" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦您启用了Ingress插件，您可以通过以下方式创建Ingress:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="8b4a" class="ln kc hu lj b fv lo lp l lq lr">kubectl create -f path-to-your-ingress-file.yaml</span></pre><p id="ead6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以通过运行以下命令来验证并获取入口信息:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="f9f9" class="ln kc hu lj b fv lo lp l lq lr">kubectl describe ing laravel-kubernetes-demo-ingress</span></pre><p id="9f9b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其输出类似于:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="bd5f" class="ln kc hu lj b fv lo lp l lq lr">Name: laravel-kubernetes-demo-ingress <br/>Namespace: default <br/>Address: 192.168.99.101 <br/>Default backend: default-http-server:80 (&lt;none&gt;) <br/>Rules: <br/>  Host Path Backends <br/>  ---- ---- -------- <br/>  * <br/>       / laravel-kubernetes-demo:8181 (172.17.0.6:8181) <br/>Annotations: <br/>  rewrite-target: / <br/>Events: <br/>Type   Reason Age  From                     Message <br/>----   ------ ---- ----                     ------- <br/>Normal CREATE 39s  nginx-ingress-controller Ingress default/laravel-kubernetes-demo-ingress</span><span id="c724" class="ln kc hu lj b fv mc lp l lq lr">Normal UPDATE 20s  nginx-ingress-controller Ingress default/laravel-kubernetes-demo-ingress</span></pre><p id="a70d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您可以通过如上所示的minikube IP地址访问应用程序。要通过URL<a class="ae ka" href="https://laravel-kubernetes.demo," rel="noopener ugc nofollow" target="_blank">https://laravel-kubernetes . demo，</a>访问应用程序，您需要在hosts文件中添加一个条目。</p><h1 id="05a3" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这仅仅是开始</h1><p id="19b4" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">希望这篇文章能帮助你熟悉Kubernetes。从我自己的经验来看，一旦一个人执行了几次或更多次类似的部署，事情就会变得习以为常，变得更有意义。但是我们的Kubernetes之旅才刚刚开始。在以后的文章中，我们将介绍更多使用存储卷来持久化状态的真实应用程序，我们还将了解如何部署到云提供商，如Google的云平台。在此之前，请查看这些<a class="ae ka" href="https://learnk8s.io/training" rel="noopener ugc nofollow" target="_blank">课程</a>以提高速度，甚至有可能成为认证Kubernetes管理员(CKA)。</p><h1 id="e370" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">成为Kubernetes中部署和扩展应用程序的专家</h1><p id="24ec" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">本文是learnk8s研讨会“在Kubernetes中部署和扩展应用程序”的一部分。</p><p id="37c2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本课程的剩余部分，您将学习如何:</p><ul class=""><li id="d6f3" class="md me hu je b jf jg jj jk jn mf jr mg jv mh jz mi mj mk ml dt translated">轻松处理最繁忙的流量网站</li><li id="9bf8" class="md me hu je b jf mm jj mn jn mo jr mp jv mq jz mi mj mk ml dt translated">将您的作业扩展到数千台服务器，并将等待时间从几天缩短到几分钟</li><li id="3ee4" class="md me hu je b jf mm jj mn jn mo jr mp jv mq jz mi mj mk ml dt translated">了解您的应用在多云设置下高度可用，让您高枕无忧</li><li id="c636" class="md me hu je b jf mm jj mn jn mo jr mp jv mq jz mi mj mk ml dt translated">通过仅使用您需要的资源，在您的云账单上节省大量现金</li><li id="a6cd" class="md me hu je b jf mm jj mn jn mo jr mp jv mq jz mi mj mk ml dt translated">增强您的交付渠道，全天候部署应用程序</li></ul><p id="3e81" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">附:不要错过下一个实验，洞察力，或<em class="lv">折扣</em> : <a class="ae ka" href="https://learnk8s.io/newsletter" rel="noopener ugc nofollow" target="_blank">订阅邮件列表！</a></p></div><div class="ab cl ms mt hc mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hn ho hp hq hr"><p id="d6c5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lv">文章原载于</em><a class="ae ka" href="https://learnk8s.io/blog/kubernetes-deploy-laravel-the-easy-way" rel="noopener ugc nofollow" target="_blank"><em class="lv">learn k8s</em></a><em class="lv">。io </em></p><figure class="le lf lg lh fq iv"><div class="bz el l di"><div class="mz na l"/></div></figure></div></div>    
</body>
</html>