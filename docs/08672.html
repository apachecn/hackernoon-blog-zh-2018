<html>
<head>
<title>User tracking: tales from the trenches</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用户追踪:来自战壕的故事</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/user-tracking-tales-from-the-trenches-ab2c8d7fe80c?source=collection_archive---------21-----------------------#2018-10-18">https://medium.com/hackernoon/user-tracking-tales-from-the-trenches-ab2c8d7fe80c?source=collection_archive---------21-----------------------#2018-10-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><pre class="ir is it iu fq iv iw ix iy aw iz dt"><span id="b48c" class="ja jb hu iw b fv jc jd l je jf">A skilful traveller leaves no track.<br/>A skilful speaker makes no slip.<br/>A skilful reckoner needs no counting rod.<br/><br/>Laozi, The Tao Te Ching, chapter 27</span></pre></div><div class="ab cl jg jh hc ji" role="separator"><span class="jj bw bk jk jl jm"/><span class="jj bw bk jk jl jm"/><span class="jj bw bk jk jl"/></div><div class="hn ho hp hq hr"><figure class="ir is it iu fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jn"><img src="../Images/ecdfe7cbecf02b2f78323676903e982f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gOu7n6Y1l0u9hcQXA5Y6w.jpeg"/></div></div></figure><p id="795b" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">人类从狩猎采集社会发展到购买社会的过程已经完成。</p><p id="efba" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">古代商人开拓了销售商品的新天地，因此出现了丝绸之路、荷兰东印度公司等现象。最后一家公司是第一家真正在官方证券交易所上市的公司，它甚至促成了一个全新领域的形成过程:股票市场。随着互联网的出现，类似的故事也发生了。这导致了新方法的出现，并随着时间的推移而演变。最初，用户跟踪促进了销售/收入的增长，因为商家能够发现目标受众。最近，用户追踪已经开始占据更广阔的领域:犯罪预测、预防恐怖行为，当然还有广告的新时代。</p><p id="6cbe" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">进化过程是无法停止的。大约在3.85亿年前的泥盆纪中期，由于进化过程，早期的呼吸空气的鱼类可以在陆地上停留很长时间，这是在第一批人类出现后很久很久以后。与前面的陈述类似，对用户的跟踪经历了一个演变过程:从众所周知的cookie到那些无法删除的cookie，从天真的收集IP地址到人工智能驱动的技术。</p></div><div class="ab cl jg jh hc ji" role="separator"><span class="jj bw bk jk jl jm"/><span class="jj bw bk jk jl jm"/><span class="jj bw bk jk jl"/></div><div class="hn ho hp hq hr"><h2 id="b41a" class="ja jb hu bd kt ku kv kw kx ky kz la lb kg lc ld le kk lf lg lh ko li lj lk ll dt translated">跟踪方法</h2><p id="6ec0" class="pw-post-body-paragraph jv jw hu jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hn dt translated">跟踪用户有两个根本原因:营销和间谍活动。营销人员需要将产品与适当的受众相关联，这一案例说明了一切。间谍活动可能是不同目的的主要目标:TOR网络或常见站点的匿名化、一些恶意行为、欺诈/诈骗，甚至是情报。第二个原因让我思考如何应对他们。</p><figure class="ir is it iu fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff lr"><img src="../Images/d195fa1f997f111559ec49a825d5ac31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bqjzr7synK6KFw5bQgS_Yg.jpeg"/></div></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">Museum of spies in NYC: at one time the future generation will make an exhibit for user tracking tools</figcaption></figure><p id="8aae" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">这篇文章的主要目的是让你熟悉跟踪的主要方法，让你在网上冲浪更安全一点。</p></div><div class="ab cl jg jh hc ji" role="separator"><span class="jj bw bk jk jl jm"/><span class="jj bw bk jk jl jm"/><span class="jj bw bk jk jl"/></div><div class="hn ho hp hq hr"><p id="b22b" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">让我们言归正传。</p><p id="37a5" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated"><strong class="jx hv">饼干</strong></p><p id="4abd" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">cookies是最古老、最智能的跟踪方法，旨在识别特定站点上的用户。操作的原理很简单:如果没有关于某个用户的信息，站点就判定某个用户第一次上站点，生成一个唯一的标识符，并把它(带有一些关于用户的附加信息)写入cookie。在接下来的访问中，网站可以通过利用记录在cookies中的标识符来识别用户。理论上，清除cookies后，用户就变成了网站的匿名用户。</p><p id="90a0" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">在Java和PHP世界中，JSESSIONID和PHPSESSID相应地是通用cookies的一个著名例子，在旧式的MVC应用程序中，没有它们，认证过程通常是不可行的。除了HTTP Cookie，还有Flash Cookies和Silverlight Cookies。</p><p id="73c6" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated"><strong class="jx hv">画布指纹</strong></p><p id="f96f" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">画布指纹是一种跟踪用户的技术，它允许网站通过利用HTML5画布元素来识别和跟踪访问者。canvas fingerprinting的关键思想是绘制一条隐藏的文本线，并将该数据转换为唯一的标识符，用于跟踪，而无需在客户端持久化。GPU/图形驱动的变化导致指纹的多样性。从浏览器中获取尽可能多的元数据有助于提高质量。</p><p id="5784" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">下一个信息通常用作基于画布指纹的标识符的来源:</p><ul class=""><li id="4cd2" class="lw lx hu jx b jy jz kc kd kg ly kk lz ko ma ks mb mc md me dt translated">屏幕分辨率</li><li id="3348" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">颜色深度</li><li id="1ad6" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">平台</li><li id="57b6" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">时区</li><li id="ffe7" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">用户代理人</li><li id="eaad" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">语言</li><li id="61ca" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">IE特定插件列表</li><li id="3b7d" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">已安装字体列表</li><li id="a32c" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">DNT标签</li><li id="ff00" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">存在会话和本地存储，索引数据库</li><li id="9605" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">AdBlock存在</li><li id="b267" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">绘制隐藏的3D画布的价值</li></ul><p id="07a3" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">在收集必要的信息之后，散列函数被应用于概括的元数据。非加密散列函数，如<a class="ae mk" href="https://en.wikipedia.org/wiki/MurmurHash" rel="noopener ugc nofollow" target="_blank"> MurmurHash3 </a>适合于此目的。出于测试目的，我创建了画布指纹的基本实现，查看<a class="ae mk" href="https://github.com/arukavytsia/canvas-fingerprinting" rel="noopener ugc nofollow" target="_blank">源代码</a>。关于生产中的用法，看一下<a class="ae mk" href="https://github.com/Valve/fingerprintjs2" rel="noopener ugc nofollow" target="_blank">指纹库。</a></p><figure class="ir is it iu fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ml"><img src="../Images/d3e278b509df661ac045fbcf7239f721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_p5Bbv84khqKf8eX9lXPkw.png"/></div></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">Reddit attempted to fetch canvas fingerprint, but was locked by Firefox</figcaption></figure><p id="c094" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">事实上，这种跟踪在Tor网络中被广泛用于去匿名化。Tor的开发者为这个漏洞做了一个补丁。Firefox通知试图获取画布指纹，并阻止这一行动，Chrome有同样的特殊插件。除了画布指纹，WebGL指纹和WebRTC指纹也可以以类似的方式使用。</p><p id="14e7" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated"><strong class="jx hv"> Evercookie </strong></p><p id="188a" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">Evercookie是一种超级优化的HTTP Cookie。Evercookie是由Samy Kamkar创建的，它在网络浏览器中生成<a class="ae mk" href="https://en.wikipedia.org/wiki/Zombie_cookie" rel="noopener ugc nofollow" target="_blank">僵尸cookie</a>，故意难以删除。</p><p id="50eb" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">根据<a class="ae mk" href="https://github.com/samyk/evercookie" rel="noopener ugc nofollow" target="_blank">库中的自述文件</a>:</p><pre class="ir is it iu fq iv iw ix iy aw iz dt"><span id="57ea" class="ja jb hu iw b fv jc jd l je jf">Evercookie is a Javascript API that produces extremely persistent cookies in a browser. Its goal is to identify a client even after they've removed standard cookies, Flash cookies (Local Shared Objects or LSOs), and others.<br/><br/>This is accomplished by storing the cookie data on as many browser storage mechanisms as possible. If cookie data is removed from any of the storage mechanisms, evercookie aggressively re-creates it in each mechanism as long as one is still intact.<br/><br/>If the Flash LSO, Silverlight or Java mechanism is available, Evercookie can even propagate cookies between different browsers on the same client machine!</span></pre><figure class="ir is it iu fq jo fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/085d91c1dbdf6bdbf1ebe917419382cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*zNlKAlJ8DUgQrK0nbeT4og.jpeg"/></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">Evercookie in comparison to usual</figcaption></figure><p id="b72f" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">Evercookie将自己的副本复制到不同的位置，以防止删除自己，为此，它使用下一个位置:</p><ul class=""><li id="3edd" class="lw lx hu jx b jy jz kc kd kg ly kk lz ko ma ks mb mc md me dt translated">HTTP/Flash cookie</li><li id="9711" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">HTML5本地/全局/会话存储</li><li id="e6a6" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">Web SQL数据库</li><li id="1540" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">银光存储</li><li id="1efa" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">Web缓存</li><li id="c603" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">Web历史记录</li><li id="e280" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">HTTP ETags</li><li id="80cf" class="lw lx hu jx b jy mf kc mg kg mh kk mi ko mj ks mb mc md me dt translated">使用HTML5 canvas标签自动生成、强制缓存的PNG的RGB值— (OMG，PNG中的cookie！)</li></ul><p id="389d" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">移除Evercookie非常困难。然而，它有一个缺点——和cookies一样，数据保存在硬盘上(或者手机的NAND存储器中)。而这也就意味着隐姓埋名模式对Evercookie是无懈可击的。</p><p id="e3a8" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">这种类型的跟踪可用于去匿名化。根据爱德华·斯诺登泄露的文件，Evercookie是一种追踪Tor用户的方法。</p><p id="72e8" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated"><strong class="jx hv"> IP追踪</strong></p><p id="b779" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">使用一个客户的IP地址允许找出一个供应商的位置和名称。然而，由于有线和无线网络中周期性的IP改变，这种方法是非常不可靠的，并且在实践中仅用于近似的位置确定，静态IP地址跟踪更有意义。在VPN/代理服务无处不在的时代，IP跟踪对于在未阻止Canvas Fingerprint/Evercookie的情况下将IP地址关联到客户端是有用的。</p><p id="2e7e" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated"><strong class="jx hv">十字装置追踪</strong></p><figure class="ir is it iu fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/e8d6c8103abad4f6f2bea6bf19726246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wv61-FTBFOYByakYbkJctg.jpeg"/></div></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">Schema of cross device tracking</figcaption></figure><p id="9d95" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">像Twitter、脸书、Reddit这样的公司能够将用户与他们的设备关联起来，因为他们的移动应用程序需要认证。其他公司也想拥有这类数据，但他们的网站访问者往往没有经过身份验证。除了关于智能手机的信息，关于智能电视、手表、游戏机的数据也非常有价值，可以带来更广泛的客户体验。在这种情况下，跨设备跟踪可以派上用场。</p><p id="8b92" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">跨设备跟踪有两种基本类型。第一种方法基于收集大量元数据:位置、设备id、行为分析、网络历史。建立设备图是这种技术的最终目标。第二种类型是基于使用听不见的超声波音频信标，由一个设备发射，并由另一个设备的麦克风检测和识别。</p><figure class="ir is it iu fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff fg"><img src="../Images/49eb47cc1881b171b03b7a1c3f8109a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mf-mqoo4JsRA7QKIlYwErQ.png"/></div></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">Sneak peek on uXDT</figcaption></figure><p id="c8a1" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">专家称这项技术为uXDT(超声波跨设备追踪)。在Tor网络中应用uXDT进行去匿名化是可行的。</p><figure class="ir is it iu fq jo"><div class="bz el l di"><div class="mo mp l"/></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">Demo of deanonymization in the TOR network with uXDT</figcaption></figure><p id="f5fb" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated"><strong class="jx hv">行为分析</strong></p><p id="1065" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">基于用户个人行为的跟踪利用了下一个指标:冲浪特征，如滚动速度、鼠标移动速度、经常使用的搜索过滤器、首选产品、点击频率等。降低浏览器速度的重量级脚本是这种方法的一个明显缺点。</p><p id="70b5" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">值得一提的是，行为分析通常作为不同人工智能驱动方法的辅助技术来应用。这不是没有原因的，IT巨头雇佣人工智能领域最优秀的人才，目标是提高KPI。不同的ML方法适用于从追踪到有价值的信息(如CTR、转换率)浓缩收集的数据。从简单的<a class="ae mk" href="https://en.wikipedia.org/wiki/Linear_regression" rel="noopener ugc nofollow" target="_blank">线性回归</a>到更高级的方法如<a class="ae mk" href="https://en.wikipedia.org/wiki/Hidden_Markov_model" rel="noopener ugc nofollow" target="_blank">隐马尔可夫模型</a>，范围很广。</p><p id="fb9d" class="pw-post-body-paragraph jv jw hu jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hn dt translated">瞧，就是这样！</p></div></div>    
</body>
</html>