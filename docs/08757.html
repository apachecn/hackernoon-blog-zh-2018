<html>
<head>
<title>My Raspberry Pi on 2 Wheels</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的双轮树莓派</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/my-raspberry-pi-on-2-wheels-c7c173918115?source=collection_archive---------14-----------------------#2018-10-22">https://medium.com/hackernoon/my-raspberry-pi-on-2-wheels-c7c173918115?source=collection_archive---------14-----------------------#2018-10-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="08de" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">用一个漂亮的相机遥控器</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/2be24052a34a5ddfece291280e13360d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QIYN44tiRSfLCuABGzH2TQ.jpeg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek"><a class="ae jz" rel="noopener" href="/side-project-lovers-unite/mein-raspberry-pi-auf-2-rädern-61338ae93791">[Click here for the German text version.]</a></figcaption></figure><p id="7ad2" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我的新项目完成了。通常我建立网站…这一次，我想创造一些真实的东西！:-)</p><p id="93fd" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">所以我开着我的树莓派穿过我的公寓…用两个连续的伺服电机、轮子、无线电源和智能手机摄像头控制。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><h1 id="c9ff" class="ld le hu bd lf lg lh li lj lk ll lm ln ja lo jb lp jd lq je lr jg ls jh lt lu dt translated">我需要什么？</h1><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff lv"><img src="../Images/9e852e22fe942fefc8ad587f1cd5d412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EBnDfJ9-QOXXYxATSeDhzQ.jpeg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Insights without cover.</figcaption></figure><ul class=""><li id="6a9e" class="lw lx hu kc b kd ke kg kh kj ly kn lz kr ma kv mb mc md me dt translated"><a class="ae jz" href="https://www.adafruit.com/product/3055" rel="noopener ugc nofollow" target="_blank">1个树莓派</a></li><li id="219e" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><a class="ae jz" href="https://www.adafruit.com/product/2442" rel="noopener ugc nofollow" target="_blank"> 2x连续旋转微伺服</a></li><li id="80a4" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><a class="ae jz" href="https://www.adafruit.com/product/2744" rel="noopener ugc nofollow" target="_blank"> 2x匹配车轮</a></li><li id="8037" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated">6x跳线m/f —这些是我从父亲那里得到的。；-)</li><li id="532c" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated">抽屉里的1个USB电源板— <a class="ae jz" href="https://www.amazon.de/JETech-Externe-2-Ausgang-Samsung-Weitere-Silber/dp/B00T416MXU" rel="noopener ugc nofollow" target="_blank">我有这个</a>。</li><li id="1dff" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated">1个漂亮的盒子，盖子大小刚好合适——感谢我的妻子。；-)</li><li id="3b47" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated">五颜六色的标记贴纸，以便在相机画面中找到机器人</li><li id="2713" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated">一个被打碎的乒乓球也是第三条腿</li><li id="aaeb" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><a class="ae jz" href="https://www.adafruit.com/product/3841" rel="noopener ugc nofollow" target="_blank">装饰</a>，剪刀，胶带，…</li></ul></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><h1 id="06a6" class="ld le hu bd lf lg lh li lj lk ll lm ln ja lo jb lp jd lq je lr jg ls jh lt lu dt translated">它是如何工作的？</h1><p id="b358" class="pw-post-body-paragraph ka kb hu kc b kd mk iv kf kg ml iy ki kj mm kl km kn mn kp kq kr mo kt ku kv hn dt translated">这是我做的…</p><h2 id="cc10" class="mp le hu bd lf mq mr ms lj mt mu mv ln kj mw mx lp kn my mz lr kr na nb lt nc dt translated">1.控制伺服电机。</h2><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">First success: Pi with USB power bank spins wheels.</figcaption></figure><p id="9da3" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">伺服电机有三个输入:5伏电源(红色)，接地(棕色)，信号(黄色)。使用跳线将这些引脚连接到Raspberry Pi的GPIO引脚。<a class="ae jz" href="https://pinout.xyz" rel="noopener ugc nofollow" target="_blank">点击此处查看引脚排列</a>。右上角有两个5V引脚。地在不同的引脚上分散几次。对于信号引脚，我选择了GPIO 17和GPIO 27。他们挨着躺着。</p><p id="884f" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">信号通过<a class="ae jz" href="https://en.wikipedia.org/wiki/Pulse-width_modulation" rel="noopener ugc nofollow" target="_blank">脉宽调制</a> (PWM)进行传输。这意味着信号在0和1之间快速交替。1的持续时间(“宽度”)成为速度的设定值。</p><ul class=""><li id="f37b" class="lw lx hu kc b kd ke kg kh kj ly kn lz kr ma kv mb mc md me dt translated">1500秒 —站着别动</li><li id="9c99" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf"> 1500秒+ 800秒= 2300秒</em> —逆时针全速</li><li id="0503" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf"> 1500秒— 800秒= 700秒</em> —顺时针全速</li></ul><p id="f298" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">现在，我可以通过SSH连接到Raspberry Pi，并使用命令行测试伺服电机。pigs程序是一个用于此目的的简洁的命令行工具(<a class="ae jz" href="http://abyz.me.uk/rpi/pigpio/pigs.html" rel="noopener ugc nofollow" target="_blank"> pigs手册页</a>)。</p><ul class=""><li id="f4fe" class="lw lx hu kc b kd ke kg kh kj ly kn lz kr ma kv mb mc md me dt translated"><em class="nf"> sudo pigpiod </em> —启动Pi GPIO守护程序。</li><li id="dc01" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf"> pigs m 17 w </em> —将引脚17设置为<strong class="kc hv"> W </strong> rite模式。</li><li id="6e30" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated">猪伺服17 2300  —全速前进！</li><li id="8f1a" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf">清管器伺服17 700 </em> —全速后退！</li><li id="3f33" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf">清管器伺服17 0 </em> —停止！</li><li id="6fbc" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf">pigs m 17 W m 27 W servo 17 2300 servo 27 700 mils 1000 servo 17 0 servo 27 0</em>—对于有用的命令序列:首先将GPIO端口17和27设置为<strong class="kc hv"> W </strong> rite模式。然后在两个电机上设置不同方向的全速。然后等待1000毫秒。然后停止两个电机。</li></ul><h2 id="0aee" class="mp le hu bd lf mq mr ms lj mt mu mv ln kj mw mx lp kn my mz lr kr na nb lt nc dt translated">2.将HTTP命令传递给伺服系统。</h2><p id="5c15" class="pw-post-body-paragraph ka kb hu kc b kd mk iv kf kg ml iy ki kj mm kl km kn mn kp kq kr mo kt ku kv hn dt translated"><a class="ae jz" href="https://github.com/poczone/raspberry-pi-on-wheels/tree/master/src/net/poczone/pi" rel="noopener ugc nofollow" target="_blank">【点击此处获取源代码。] </a></p><p id="d76f" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">接下来，我通过HTTP发布了这些命令。作为一名Java Web开发人员，这对我来说是家常便饭。</p><p id="53e4" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我在Raspberry Pi上运行Tomcat 8 Java Web服务器。它有我定制的Java Web档案(WAR)。HttpServlet处理HTTP请求。它从URL参数中读取速度设定值，并通过ProcessBuilder将其传递给pigs程序。</p><p id="cd69" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">第二个版本稍微复杂一点，可以理解命令序列:</p><ul class=""><li id="80e5" class="lw lx hu kc b kd ke kg kh kj ly kn lz kr ma kv mb mc md me dt translated"><em class="nf">左&lt;-800…0…800&gt;</em>-控制左轮。</li><li id="17a6" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf">右&lt;-800…0…800&gt;</em>-控制右轮。</li><li id="b988" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf">等待&lt;毫秒&gt; </em> —等待/移动指定的时间。</li><li id="0a8e" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf">停止</em>——左0右0<em class="nf">的简称。</em></li><li id="ad74" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv mb mc md me dt translated"><em class="nf">清除</em> —清除所有之前的命令。</li></ul><p id="4b55" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">请求示例:</p><p id="355c" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">http://…/wheels？x =清除+向左+800+向右+800+等待+1000+停止</p><h2 id="0936" class="mp le hu bd lf mq mr ms lj mt mu mv ln kj mw mx lp kn my mz lr kr na nb lt nc dt translated">3.构建一个简单的遥控器。</h2><p id="e14b" class="pw-post-body-paragraph ka kb hu kc b kd mk iv kf kg ml iy ki kj mm kl km kn mn kp kq kr mo kt ku kv hn dt translated"><a class="ae jz" href="https://github.com/poczone/raspberry-pi-on-wheels/blob/master/WebContent/remote/index.htm" rel="noopener ugc nofollow" target="_blank">【点击此处获取源代码。】</a></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="ng ne l"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Direct control of the robot with smartphone browser remote control. The remote control is a little bit rotated. Top left = Ahead. Top right = Right turn. Bottom left = Left turn. Bottom right = Backwards.</figcaption></figure><p id="10e4" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">简单的遥控器根据我点击/触摸的位置直接设置左右轮的速度。当释放点击时，机器人停止。通过这种方式，可以导航Pi…耶！</p><h2 id="c8f5" class="mp le hu bd lf mq mr ms lj mt mu mv ln kj mw mx lp kn my mz lr kr na nb lt nc dt translated">4.捕捉相机，找到彩色标记，从四个已知点计算机器人坐标系。</h2><p id="bb23" class="pw-post-body-paragraph ka kb hu kc b kd mk iv kf kg ml iy ki kj mm kl km kn mn kp kq kr mo kt ku kv hn dt translated"><a class="ae jz" href="https://github.com/poczone/raspberry-pi-on-wheels/blob/master/WebContent/index.htm" rel="noopener ugc nofollow" target="_blank">【点击此处获取源代码。] </a></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nh"><img src="../Images/a2440526bfa09be0feac47499068908b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pIwHWW7YCfgOvFXaJqe0Hw.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Detected robot cover coordinate system inside the web browser</figcaption></figure><p id="8589" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">但是我想要一个很酷的控制器！</p><p id="e561" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">该控制器应在智能手机/平板电脑网络浏览器中打开。它捕捉摄像机视频。用户将摄像机对准机器人。在图像中可以找到机器人盖上的信号橙色标记贴纸。通过这种方式，可以检测机器人的位置。有了贴纸的位置，即使图像在透视中失真，也可以计算出机器人的坐标系。当我点击图像上的某个地方时，我知道:这是前面210毫米，左边32毫米。</p><p id="db7e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">更详细地说，该过程可归结为以下步骤:</p><ol class=""><li id="a142" class="lw lx hu kc b kd ke kg kh kj ly kn lz kr ma kv ni mc md me dt translated">用navigator.getUserMedia捕获相机，并将其放入一个<video>标签中。</video></li><li id="8172" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">将快照图像渲染到<canvas>并收集当前像素数据。</canvas></li><li id="376b" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">检测信号橙色像素…在HSV颜色空间中具有高容差值时效果最佳(以便处理光线和阴影)。</li><li id="d670" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">通过整体填充算法找到最小尺寸的连通信号色岛。用平均计算找到中点。</li><li id="adde" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">根据岛屿的大小对其后代进行排序。</li><li id="a012" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">标记的设计使得最大的标记位于左前方。四个最大的岛屿可以按顺时针方向排列。瞧啊。左前，右前，右后，左后。</li><li id="ac29" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">现在我们在图像中有四个已知点，并且我们知道它们在机器人坐标系中的坐标。通过这个巧妙的方法，我们可以将它转化为一个线性方程组并求解。我们得到矩阵来将点从图像转换到机器人坐标，反之亦然。</li><li id="b498" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">然后，我在机器人周围画了一个框，并在前面画了一个尖峰，作为我检测到正确坐标系的标志——见上图。</li><li id="f74a" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">当用户点击图像时，我知道目标的前/后和左/右毫米…</li><li id="d9ce" class="lw lx hu kc b kd mf kg mg kj mh kn mi kr mj kv ni mc md me dt translated">这是通过HTTP传递给机器人控制…</li></ol><h2 id="33fb" class="mp le hu bd lf mq mr ms lj mt mu mv ln kj mw mx lp kn my mz lr kr na nb lt nc dt translated">5.指令:转向32度，向前行驶240毫米。</h2><p id="ec28" class="pw-post-body-paragraph ka kb hu kc b kd mk iv kf kg ml iy ki kj mm kl km kn mn kp kq kr mo kt ku kv hn dt translated">剩下的部分就是执行这样的命令:顺时针旋转32度，向前行驶240毫米。</p><p id="de6e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">向前行驶很简单:只需在两个车轮上设置相同的速度(由于设置的原因，一个车轮必须倒置)。我试着从数据表中读取车轮速度。然而，该表只有最大值，计算出的值证明是不准确的。所以我把圆周率放在一本书上，通过实验找到了我想要的速度下，轮子旋转1圈和10圈的毫秒数。我知道车轮周长。所以我可以很容易地计算出给定距离的提前行驶时间。前方:检查。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Tweaking wheel revolution duration</figcaption></figure><p id="28da" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">绕中心转动的工作原理是这样的:向前驱动一个轮子。以同样的速度向后驱动另一个车轮。同样，这种计算方法并不是很有效——主要是由于摩擦。所以我测量了360度转弯所需的时间。根据所需的角度，我旋转相应比例的时间。摩擦力每次都有点不同，所以旋转可能会有点偏离。但误差很小，对我来说是可以接受的。旋转:检查。</p></div><div class="ab cl kw kx hc ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hn ho hp hq hr"><h1 id="9dd2" class="ld le hu bd lf lg lh li lj lk ll lm ln ja lo jb lp jd lq je lr jg ls jh lt lu dt translated">瞧啊。</h1><p id="7468" class="pw-post-body-paragraph ka kb hu kc b kd mk iv kf kg ml iy ki kj mm kl km kn mn kp kq kr mo kt ku kv hn dt translated">这就是我的带摄像头控制的轮子上的树莓派。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nd ne l"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Demo for the camera control: The Pi is detected inside the image. Clicks on the ground image are transformed to target robot coordinates and wheel commands.</figcaption></figure><p id="38f6" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">这是一个非常好的项目！我很高兴将我在机器人研究中获得的关于差动驱动机器人的知识应用到我自己的Raspberry Pi上。这真的很有趣！</p><p id="7e86" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">控制伺服电机比预期的要容易。</p><p id="ecae" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">由于Pi的wifi接入和运行网络服务器的可能性，我在已知的地形非常快。由于HTML5相机/视频/画布，现在可以在智能手机/平板电脑上提供基于图像检测的远程控制，这种工作方式非常流畅。</p><p id="4320" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">此外，我在<a class="ae jz" href="https://www.adafruit.com/" rel="noopener ugc nofollow" target="_blank"> Adafruit网上商店和学习系统</a>中迷失了方向，玩得很开心！在那里，你可以获得任何种类的硬件项目的灵感。这个包裹在三天内从纽约运到了德国——太棒了！</p><p id="0af1" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">让我们看看我接下来会做什么… :-)</p></div></div>    
</body>
</html>