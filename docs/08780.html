<html>
<head>
<title>Build an Uptime Monitor in Minutes with Slack, Standard Library and Node.js — Right From Your Browser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Slack、标准库和Node.js在几分钟内构建一个正常运行时间监视器——就在您的浏览器中</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-an-uptime-monitor-in-minutes-with-slack-standard-library-and-node-js-e7973d659849?source=collection_archive---------6-----------------------#2018-10-23">https://medium.com/hackernoon/build-an-uptime-monitor-in-minutes-with-slack-standard-library-and-node-js-e7973d659849?source=collection_archive---------6-----------------------#2018-10-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="462c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">确保你的网站或API正常运行是一项全天候的工作。为了帮助这一不懈的努力，我们可以在我们经常使用的<a class="ae jp" href="https://hackernoon.com/tagged/tools" rel="noopener ugc nofollow" target="_blank">工具</a>中显示正常运行时间报告和状态警报，如<a class="ae jp" href="https://slack.com" rel="noopener ugc nofollow" target="_blank"> Slack </a>。有了像<a class="ae jp" href="https://stdlib.com" rel="noopener ugc nofollow" target="_blank">标准库</a>这样的平台，这样的集成几乎不费吹灰之力。本指南将向您展示如何在<a class="ae jp" href="https://stdlib.com" rel="noopener ugc nofollow" target="_blank">标准库</a>上设置一个API，该API将ping一个URL，如果URL没有返回2xx状态代码，则向<a class="ae jp" href="https://hackernoon.com/tagged/slack" rel="noopener ugc nofollow" target="_blank"> Slack </a>发送一条消息。它将利用<a class="ae jp" href="https://stdlib.com/blog/code-xyz-09-26-2018-scheduled-tasks" rel="noopener ugc nofollow" target="_blank">标准库的调度任务，</a>允许您基于几乎任何调度来执行API。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/adb7d7ec71eef1aaaea40b55be1e7bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lOn-4Go0gHKo35hOnQWH5Q.png"/></div></div></figure><p id="7967" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你不熟悉<a class="ae jp" href="https://www.stdlib.com" rel="noopener ugc nofollow" target="_blank">标准库</a>，我们是一个无服务器平台，让每个人都能在几秒钟内构建、发布和集成可扩展的API。在我们的在线文本编辑器<a class="ae jp" href="https://code.xyz" rel="noopener ugc nofollow" target="_blank"> Code.xyz </a>的帮助下，你可以直接在浏览器上完成。</p><h2 id="29b7" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">步骤1:创建一个Slack应用程序</h2><p id="cf93" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">前往<a class="ae jp" href="https://api.slack.com/apps" rel="noopener ugc nofollow" target="_blank"> Slack app仪表盘</a>，点击屏幕右上角的<strong class="it hv">创建新应用</strong>。过一会儿，你会被重定向到一个标有“<strong class="it hv">基本信息</strong>的页面。在屏幕左侧，您会看到“<strong class="it hv">功能</strong>类别下的“<strong class="it hv"> OAuth and Permissions </strong>”。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lc"><img src="../Images/a7dedd2e888fc807fd89509b80a88e14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5FRegS86M1ezsR_h_87fQ.png"/></div></div></figure><p id="a06e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在那里，向下滚动到“<strong class="it hv">范围</strong>”。我们需要机器人能够代表自己向Slack发送消息。这意味着我们需要给它"<strong class="it hv"> chat:write:bot </strong>"权限，所以在"<strong class="it hv">选择权限范围</strong>"下拉列表中搜索。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ld"><img src="../Images/6ed273af013151c443c36b7a2093811c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kn0qnVkGD10mu_MkvqlZpQ.png"/></div></div></figure><p id="ae3d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">设置好所需的权限后，向上滚动到“<strong class="it hv"> OAuth和权限</strong>”页面的顶部，然后单击绿色的“<strong class="it hv">将应用程序安装到工作区</strong>”按钮。一旦您授权了它，页面将会刷新，安装按钮所在的位置将会是一个OAuth令牌。点击复制；你马上就会需要它。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff le"><img src="../Images/2f0e522e5cd9deecf9eb376e03111834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_LpmqPrFX0_uhnDo9XJXyw.png"/></div></div></figure><h2 id="6446" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">步骤2:获取Ping API模板</h2><p id="29ce" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">将松弛部分全部整理好，打开<a class="ae jp" href="https://code.xyz.com/?src=@steve/ping" rel="noopener ugc nofollow" target="_blank"> Code.xyz </a>。如果您点击该链接，ping API模板将自动打开。否则，您可以单击“<strong class="it hv">社区API源</strong>”选项卡并搜索“<strong class="it hv"> steve/ping </strong>”。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lf"><img src="../Images/0313a43cbccae58a3f5035f80a66ba8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BvxWTlibYogGaCBpojABqg.png"/></div></div></figure><p id="c630" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦装载完毕，您将到达<code class="eh lg lh li lj b">__main__.js</code>终点。它只有一个参数，<code class="eh lg lh li lj b">url</code>。该函数向<code class="eh lg lh li lj b">url</code>发出HTTP请求，并检查状态代码是否在2xx范围内。如果不是，它使用<a class="ae jp" href="https://github.com/slackapi/node-slack-sdk" rel="noopener ugc nofollow" target="_blank"> Slack SDK </a>向环境变量<code class="eh lg lh li lj b">SLACK_CHANNEL_ID</code>指定的通道发送消息。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="6a86" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">繁重的工作在<code class="eh lg lh li lj b">/src/request.js</code>文件中完成。您可以随意阅读该文件，但本质上，它向一个URL发出GET请求，并记录关于该请求的一些信息。它将返回状态代码和计时信息，如到达第一个字节的时间和总请求持续时间。</p><p id="fe82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在ping之后，我们检查状态代码是小于200还是大于299。如果是，用函数<code class="eh lg lh li lj b">formatPing</code>格式化的请求细节的消息slack。<code class="eh lg lh li lj b">formatPing</code>获取由<code class="eh lg lh li lj b">request</code>函数返回的对象，对其进行字符串化，并将其包装在三个反斜线中。Slack会把任何被三个反斜杠包围的东西显示为一个代码块，这样可以让JSON看起来干净一点。有关格式化的更多信息，请参见<a class="ae jp" href="https://api.slack.com/docs/message-formatting" rel="noopener ugc nofollow" target="_blank">时差文档</a>。</p><h2 id="3f7a" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">步骤2b:设置环境变量</h2><p id="e046" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">如果你打开<code class="eh lg lh li lj b">env.json</code>，你会看到两个环境变量<code class="eh lg lh li lj b">SLACK_OAUTH_TOKEN</code>和<code class="eh lg lh li lj b">SLACK_CHANNEL_ID</code>。前者是我们刚刚从Slack应用仪表板上获得的，后者是你希望机器人发布到的频道的名称，比如<code class="eh lg lh li lj b">#general</code>或<code class="eh lg lh li lj b">#alerts</code>。确保您填写了“<strong class="it hv"> dev </strong>”集合，如下所示。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lm"><img src="../Images/b72d18f6d92f2a674d5e2beef5d7d209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8L528VpRLUYXUtoSZwyzgg.png"/></div></div></figure><p id="45de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在似乎是测试这个API的合适时机。返回<code class="eh lg lh li lj b">__main__.js</code>并按下<strong class="it hv"> cmd/ctrl+b </strong>打开屏幕左下方的参数窗格。键入一个网址，然后按回车键。如果该URL上的任何网站/API都正常，您应该什么也看不到！</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ln"><img src="../Images/eed8b5119e2bf0a2ffa309fbfd1a0057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VSrlmXiuSGaN49pgHU_prg.png"/></div></div></figure><p id="89d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是因为如果ping API可以到达带有2xx状态码的URL，那么它就是一个noop。要尝试一个失败的案例，使用<code class="eh lg lh li lj b"><a class="ae jp" href="http://bad.stdlib.com/" rel="noopener ugc nofollow" target="_blank">https://bad.stdlib.com/</a></code>作为URL。在Code.xyz results面板中，您将看到Slack的API的响应，表示发送了一条消息。如果您导航到您输入的频道<code class="eh lg lh li lj b">env.json</code></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lo"><img src="../Images/ed7048b1d9ffc774a5a1b971124027f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VCWB7dGPavXs5hVRYaCkVQ.png"/></div></div></figure><p id="de4e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将看到一条消息，提示<code class="eh lg lh li lj b">https://bad.stdlib.com/</code>不可达，以及一些关于请求的信息。</p><h2 id="2c6f" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">步骤3:设置计划任务</h2><p id="a4be" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">ping API启动后，我们现在可以安排API每隔几分钟运行一次。为此，您需要安装<a class="ae jp" href="https://github.com/stdlib/lib" rel="noopener ugc nofollow" target="_blank">标准库CLI，</a>这可以通过NPM完成。</p><pre class="jr js jt ju fq lp lj lq lr aw ls dt"><span id="41bb" class="kc kd hu lj b fv lt lu l lv lw">$ npm install lib.cli -g</span></pre><p id="c24b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装后，您可以通过运行以下命令登录:</p><pre class="jr js jt ju fq lp lj lq lr aw ls dt"><span id="fc8b" class="kc kd hu lj b fv lt lu l lv lw">$ lib login</span></pre><p id="87c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，要创建计划任务运行:</p><pre class="jr js jt ju fq lp lj lq lr aw ls dt"><span id="c42a" class="kc kd hu lj b fv lt lu l lv lw">$ lib tasks:create [username]/ping</span></pre><p id="61a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将被要求输入URL，然后您必须选择一个库令牌来认证服务(默认的就可以了)。接下来，您可以选择通过“简单”语法或使用cron输入时间表。对于我们的目的，简单的语法就可以了。让服务从0分钟开始每小时运行12次。最后，随便你给它起什么名字。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lf"><img src="../Images/60c797ef5c3793494eaa646b7726a819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0MJtGiUL2pywKU1kGk8Nw.png"/></div></div></figure><h2 id="17a0" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">深入挖掘</h2><p id="e3da" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">有许多方法可以扩展这个简单的ping API。例如，您可能希望在3xx范围(重定向)中包含可接受的状态代码。你所要做的就是修改一行代码！改变</p><pre class="jr js jt ju fq lp lj lq lr aw ls dt"><span id="6125" class="kc kd hu lj b fv lt lu l lv lw">if (ping.statusCode &lt; 200 || ping.statusCode &gt; 299) {<br/>   ...<br/>}</span></pre><p id="7668" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">到</p><pre class="jr js jt ju fq lp lj lq lr aw ls dt"><span id="4eaa" class="kc kd hu lj b fv lt lu l lv lw">if (ping.statusCode &lt; 200 || ping.statusCode &gt; 399) {<br/>   ...<br/>}</span></pre><p id="914f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">会成功的！现在，也许你因为没有经常检查Slack而感到内疚，并且更喜欢旧的短信。有了<a class="ae jp" href="https://stdlib.com" rel="noopener ugc nofollow" target="_blank">标准库</a>，短信集成只需一行代码！事实上；ping API中的另一个端点已经设置了SMS通知。打开<code class="eh lg lh li lj b">extra.js</code>，你会看到—</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="d08f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它和<code class="eh lg lh li lj b">__main__.js</code>一样，但是有额外的条件来检查是否提供了电话号码。如果是这样，它会发送一条信息，提示收件人上Slack看看发生了什么。</p><p id="89e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些小变化的目的是表明，在一天结束时，计划的任务，以及标准库上的任何API，都只是JavaScript，完全是根据您的具体用例定制的。</p><h2 id="300d" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">仅此而已！</h2><p id="07f7" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">我希望这篇教程有助于向您展示开始使用<a class="ae jp" href="https://stdlib.com" rel="noopener ugc nofollow" target="_blank">标准库</a>是多么容易。关于如何更好地使用<a class="ae jp" href="https://stdlib.com" rel="noopener ugc nofollow" target="_blank">标准库</a>的更多灵感，你可以在这里查看由团队<a class="ae jp" href="https://medium.com/stdlibhq" rel="noopener">编写的更多指南。如果你有好的想法想要分享，请直接通过电子邮件联系我:<strong class="it hv">steve@stdlib.com</strong>，或者在Twitter上关注</a><a class="ae jp" href="https://twitter.com/stdlibhq" rel="noopener ugc nofollow" target="_blank">标准库</a>团队和<a class="ae jp" href="https://twitter.com/notoriaga" rel="noopener ugc nofollow" target="_blank">我</a>。</p></div><div class="ab cl lx ly hc lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hn ho hp hq hr"><p id="2b32" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="me"> Steve Meyer是Oberlin学院的应届毕业生，也是标准图书馆的软件工程师。当他不编程的时候，你可以发现他在烤面包，或者玩蜘蛛侠。</em></p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mf ll l"/></div></figure></div></div>    
</body>
</html>