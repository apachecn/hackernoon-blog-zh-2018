<html>
<head>
<title>kubectl tip of the day: wait like a boss</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">日积月累:像老板一样等待</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/kubectl-tip-of-the-day-wait-like-a-boss-40a818c423ac?source=collection_archive---------1-----------------------#2018-10-27">https://medium.com/hackernoon/kubectl-tip-of-the-day-wait-like-a-boss-40a818c423ac?source=collection_archive---------1-----------------------#2018-10-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/d9950c55fcbaf047f8808b548db7c0b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_K6--J1SqnaHpOjUl8rrg.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">The <a class="ae ih" href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#wait" rel="noopener ugc nofollow" target="_blank">kubectl wait</a> command.</figcaption></figure><div class=""/><p id="bce9" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你如何等待<code class="eh kf kg kh ki b">kubectl</code>的事情发生？我曾经在一个shell <a class="ae ih" href="https://hackernoon.com/tagged/script" rel="noopener ugc nofollow" target="_blank">脚本</a>中使用一个<code class="eh kf kg kh ki b">while true</code> <a class="ae ih" href="https://hackernoon.com/tagged/loop" rel="noopener ugc nofollow" target="_blank">循环</a>并用一个复杂的<code class="eh kf kg kh ki b">kubectl get</code>命令进行检查，直到我看到某个条件，比如<code class="eh kf kg kh ki b">condition=Ready</code>被满足。不再有了！:)</p></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><p id="1a47" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这里，您将看到<a class="ae ih" href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#wait" rel="noopener ugc nofollow" target="_blank"> kubectl wait </a>命令并了解它的运行情况。</p><p id="22a7" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先，让我们创建一个名为<code class="eh kf kg kh ki b">worker</code>的作业，它本身做一些完全无用的事情(打印单词<code class="eh kf kg kh ki b">blah</code>到<code class="eh kf kg kh ki b">stdout</code>，暂停3秒钟十次):</p><pre class="kq kr ks kt fq ku ki kv kw aw kx dt"><span id="2f2e" class="ky kz ik ki b fv la lb l lc ld">$ kubectl version --short<br/>Client Version: v1.12.0<br/>Server Version: v1.11.0</span><span id="6253" class="ky kz ik ki b fv le lb l lc ld">$ kubectl create ns waitplayground</span><span id="4253" class="ky kz ik ki b fv le lb l lc ld">$ kubectl -n waitplayground \<br/>             create job worker \ <br/>             --image centos:7 -- \<br/>             sh -c \<br/>             'for i in {1..10} ; do echo blah ; sleep 3; done'</span></pre><p id="351c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以通过以下方式关注资源:</p><pre class="kq kr ks kt fq ku ki kv kw aw kx dt"><span id="5c2f" class="ky kz ik ki b fv la lb l lc ld">$ kubectl -n waitplayground get job,po</span></pre><p id="a766" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是如果你想在<code class="eh kf kg kh ki b">worker</code>完成后开始另一份工作呢？给你:</p><pre class="kq kr ks kt fq ku ki kv kw aw kx dt"><span id="ff4a" class="ky kz ik ki b fv la lb l lc ld">$ kubectl -n waitplayground \<br/>             wait --for=condition=complete --timeout=32s \     <br/>             job/worker<br/>job.batch/worker condition met</span></pre><p id="b0a6" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">请注意，上面我设置的超时(32秒)比我期望的<code class="eh kf kg kh ki b">worker</code>作业所花费的时间(大约。10 * 3秒)。一旦<code class="eh kf kg kh ki b">kubectl wait</code>命令返回，您只需要检查它的输出，然后您可以基于此做出决定，例如，启动一个相关作业或重试原来的作业。</p></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><p id="8678" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就这样了，周末快乐，继续kubecuddling)</p><figure class="kq kr ks kt fq hw"><div class="bz el l di"><div class="lf lg l"/></div></figure></div></div>    
</body>
</html>