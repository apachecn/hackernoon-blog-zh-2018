<html>
<head>
<title>🎉 Announcing lint-staged with support for partially staged files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">🎉宣布lint-staged支持部分暂存文件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/announcing-lint-staged-with-support-for-partially-staged-files-abc24a40d3ff?source=collection_archive---------4-----------------------#2018-10-29">https://medium.com/hackernoon/announcing-lint-staged-with-support-for-partially-staged-files-abc24a40d3ff?source=collection_archive---------4-----------------------#2018-10-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4263" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">三年前，我向世界介绍了lint-staged。截至今天，在81发布之后，它已经出现在<a class="ae jp" href="https://github.com/okonet/lint-staged/network/dependents" rel="noopener ugc nofollow" target="_blank">超过55000个GitHub库</a>的依赖图中，并且在NPM 已经超过了<a class="ae jp" href="https://www.npmjs.com/package/lint-staged" rel="noopener ugc nofollow" target="_blank">500000的周下载量！</a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/551d185103dbd2909fc8a0cc29e2f7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIKyMj9CAlsfide1kUfmUg.png"/></div></div></figure><p id="1a65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我在2015年发布lint-staged时，我从未想到它会成为如此受欢迎的工具。</p><h2 id="911d" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">一个我花了两年时间解决的问题</h2><p id="038b" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">在lint-staged被引入到<a class="ae jp" href="https://github.com/react-boilerplate/react-boilerplate" rel="noopener ugc nofollow" target="_blank">react-boilerplate</a>——由<a class="lc ld gr" href="https://medium.com/u/908fb8fea30c?source=post_page-----abc24a40d3ff--------------------------------" rel="noopener" target="_blank">麦克斯·斯托伊伯</a>开发的一个流行的开源项目之后不久，我得到了一份标题为<a class="ae jp" href="https://github.com/okonet/lint-staged/issues/62" rel="noopener ugc nofollow" target="_blank">“为部分分段文件添加更好的支持”</a>的问题报告</p><p id="2ce7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这一期<a class="ae jp" href="https://github.com/okonet/lint-staged/issues/62" rel="noopener ugc nofollow" target="_blank">是62号</a>(没错，不用查我也能记住它的号)。这个问题有<em class="le">许多</em>的评论和<em class="le">许多</em>不同的意见，从“嗯，就像做……一样简单”到“那不可能实现”。它太长了，以至于不适合一个单独的PNG文件，因为它将超过30.000像素——最大允许图像高度(原文如此！).</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lf"><img src="../Images/0e994d15b3b7d4a4a634d515782045f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0KKqstrmnF91WHs8o9CqBA.jpeg"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Screenshot of the issue #62 from GitHub. <a class="ae jp" href="https://github.com/okonet/lint-staged/issues/62" rel="noopener ugc nofollow" target="_blank">https://github.com/okonet/lint-staged/issues/62</a></figcaption></figure><p id="d8d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我试着解决这个问题几次都没有成功。上一次最接近的尝试是大约一年前，在前往2018年的火车上，我举行了一次关于lint-staged的演示。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="60fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不幸的是，尽管我花了几乎几天时间破解它，我还是无法解决它。这项工作仍然有一些积极的成果:</p><ol class=""><li id="1519" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">我在会议期间遇到了一些人，他们鼓励并帮助我继续尝试(感谢<a class="lc ld gr" href="https://medium.com/u/a82419fa03ca?source=post_page-----abc24a40d3ff--------------------------------" rel="noopener" target="_blank">Juho vepslinen</a>、<a class="lc ld gr" href="https://medium.com/u/de4496bfa1e2?source=post_page-----abc24a40d3ff--------------------------------" rel="noopener" target="_blank"> Michel Weststrate </a>和Nejc Zdovc)。</li><li id="ccad" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">我写了很多测试，所以做TDD和尝试不同的实现思想变得更容易了(我做了很多)。</li></ol><h2 id="4765" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">🎉引入lint阶段v8</h2><p id="ce57" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">今天，在两年多和<a class="ae jp" href="https://github.com/okonet/lint-staged/pull/75/commits" rel="noopener ugc nofollow" target="_blank"> 138次提交</a>之后，我非常兴奋地终于发布了lint-staged的第8版，它支持部分暂存文件！</p><p id="c42b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它使用以下算法:</p><ol class=""><li id="e19b" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">在运行linters之前，检查是否有部分声明的文件(即提交索引和工作副本都有变化)</li><li id="0fb0" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">隐藏并从工作副本中删除所有不在提交索引中的文件</li><li id="f448" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">对这些文件执行命令(linters和formatters)</li><li id="e835" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">将格式化程序更改添加到索引中(配置中的单独任务)</li><li id="1887" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">如果所有linters都以零代码退出(即成功)，则恢复隐藏的工作副本状态。如果运行linters时出现错误，恢复隐藏的工作副本。</li><li id="d6ef" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">比较新提交索引和工作副本<em class="le">对工作副本应用尽可能多的格式更改</em>。如果有冲突块，丢弃格式化程序的更改。隐藏的用户修改应该总是优先于格式化程序。</li></ol><p id="2814" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是它实际运行的样子:</p><div class="ma mb fm fo mc md"><a href="https://asciinema.org/a/199934" rel="noopener  ugc nofollow" target="_blank"><div class="me ab ej"><div class="mf ab mg cl cj mh"><h2 class="bd hv fv z el mi eo ep mj er et ht dt translated">🚫💩lint-staged，支持部分暂存文件</h2><div class="mk l"><h3 class="bd b fv z el mi eo ep mj er et ek translated">这是部分暂存文件支持在中如何工作的演示🚫💩棉绒阶段。有关更多信息，请参见…</h3></div><div class="ml l"><p class="bd b gc z el mi eo ep mj er et ek translated">asciinema.org</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr ka md"/></div></div></a></div><p id="4b68" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最重要的是，y <em class="le">你不需要改变你的配置来获得对部分暂存文件的支持！</em>该版本唯一的“突破性变化”是节点8.6的要求。</p><pre class="jr js jt ju fq ms mt mu mv aw mw dt"><span id="6724" class="kc kd hu mt b fv mx my l mz na">npm install --save-dev lint-staged@latest</span></pre><p id="2beb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经在我所有的项目中使用了一个多月，并且认为它很稳定。如果你碰巧遇到它的问题，请在GitHub上报告并帮助我解决。</p><h1 id="a14b" class="nb kd hu bd ke nc nd ne ki nf ng nh km ni nj nk kp nl nm nn ks no np nq kv nr dt translated">外卖食品</h1><h2 id="905a" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">不要放弃你的想法！</h2><p id="b017" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">人们一直在说，我试图解决的问题是不可能解决的。我的某个部分一直否认它…我学到的一件事是，如果你相信它，它是值得尝试的。</p><h2 id="8f65" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">开源是❤️</h2><p id="14b6" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">最终的解决方案是基于最初问题的<a class="ae jp" href="https://github.com/okonet/lint-staged/issues/62" rel="noopener ugc nofollow" target="_blank">评论中分享的意见和想法，如果没有来自全球人民的巨大支持和鼓励，这是不可能的。我还要感谢帮助我维护这个项目的贡献者:</a><a class="ae jp" href="https://github.com/sudo-suhas" rel="noopener ugc nofollow" target="_blank">苏哈斯·卡兰思</a>和<a class="ae jp" href="https://github.com/luftywiranda13" rel="noopener ugc nofollow" target="_blank">卢夫蒂·维兰达</a>。</p><h2 id="e719" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">开源是💩</h2><p id="0bf2" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">事实上，我花了两年多的时间才找到解决方案，这很可笑，但这又证明了这种工作的合理性。我花了无数的时间寻找最终的解决方案。我又花了几天时间来完成和清理代码，合并来自上游的更改，并撰写这篇博文。就在过去的两个月里，我花了50多个小时在上面。考虑到我是两个孩子的父亲，投入这么多时间对我来说变得越来越难以自圆其说。</p><p id="2080" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">如果你认为lint-staged有用，请考虑</strong> <a class="ae jp" href="https://opencollective.com/lint-staged" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">在开放集体</strong> </a> <strong class="it hv">资助该项目。</strong></p></div></div>    
</body>
</html>