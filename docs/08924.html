<html>
<head>
<title>QMK deep dive with sweet16. Custom mechanical keyboards and macropads</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用sweet16进行QMK深度潜水。定制机械键盘和宏键盘</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/qmk-deep-dive-with-sweet16-custom-mechanical-keyboards-and-macropads-fab688569351?source=collection_archive---------5-----------------------#2018-10-29">https://medium.com/hackernoon/qmk-deep-dive-with-sweet16-custom-mechanical-keyboards-and-macropads-fab688569351?source=collection_archive---------5-----------------------#2018-10-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0531" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">机械键盘，宏垫等等。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/d4270c0b54a4cbcd7eab93c7de724a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ugV5FNAoM0JFFVibnQ6Ovw.jpeg"/></div></div></figure><p id="41f8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">16把钥匙！？一个键盘16个键能做什么？使用令人惊叹的开源固件和1upkeyboards工具包，只用16个键就可以完成很多工作。QMK是一个强大的固件，允许常规键、函数和扩展宏的无限组合。这些功能相对容易构建，固件本身也非常容易构建和刷新。</p><p id="af15" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，什么是糖果？这是一个作为套件出售的macropad，由1upkeyboards制造。这个macropad需要组装，包括焊接二极管、arduino和开关。所有的组装需要20分钟到一个小时，这取决于技能和速度。</p><div class="kb kc fm fo kd ke"><a href="https://www.1upkeyboards.com/shop/keyboard-kits/sweet16-macro-pad-white/" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab ej"><div class="kg ab kh cl cj ki"><h2 class="bd hv fv z el kj eo ep kk er et ht dt translated">Sweet 16宏Pad - 1Up键盘</h2><div class="kl l"><h3 class="bd b fv z el kj eo ep kk er et ek translated">制作您自己的Sweet 16 pcb专用宏垫，最多可带16个开关。这是一块不含预焊的PCB</h3></div><div class="km l"><p class="bd b gc z el kj eo ep kk er et ek translated">www.1upkeyboards.com</p></div></div><div class="kn l"><div class="ko l kp kq kr kn ks jz ke"/></div></div></a></div><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kt"><img src="../Images/0de29d5de6cc0d57e1a985b4ad47412d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C82icK92uijv_M7w_9ybaw.jpeg"/></div></div></figure><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="f217" class="kz la hu kv b fv lb lc l ld le">an assembly video can be found here: <a class="ae lf" href="https://youtu.be/Bw-BvKnZqBg" rel="noopener ugc nofollow" target="_blank">https://youtu.be/Bw-BvKnZqBg</a><br/>(embedding youtube doesn't work in medium) Truncated assembly photos are included here &lt;--</span></pre><p id="850c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该视频是一步一步组装垫子的最佳来源。今天这篇文章的目标不是介绍硬件装配，而是更多地介绍软件。</p><p id="e46d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">macropad现在已经组装好了，有一个提供的基本固件，它将提供一个简单的数字小键盘的功能。十六进制文件在这里:<a class="ae lf" href="https://1upkeyboards.com/sweet16.hex" rel="noopener ugc nofollow" target="_blank">https://1upkeyboards.com/sweet16.hex</a>QMK有一个很棒的flash程序叫做QMK toolbox，它适用于mac和pc，可以在这里下载。【https://qmk.fm/toolbox/】只需下载运行应用的工具箱，然后插入sweet16 macropad即可。首先打开qmk工具箱应用程序，加载上面下载的十六进制文件。然后插入pad，背面有一个复位开关，按下它，工具箱会注册一个新设备，然后只需单击flash，等待几秒钟，然后等待“完成”。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lg"><img src="../Images/df3de36acde8ea20dfaf87677e5e2335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*zHtvN2Unkng6YSqnmTeMww.png"/></div><figcaption class="lh li fg fe ff lj lk bd b be z ek">after hitting reset</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/312f215ed20f5c32c2b79d5128a6aca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*hMyJKIeMZvs4X5cTKD635g.png"/></div><figcaption class="lh li fg fe ff lj lk bd b be z ek">the flash is complete</figcaption></figure><p id="75a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简单十六进制固件的要点是确保所有开关正常工作，并且装配成功。要确保所有的焊点都完好无损可能有点棘手。因此，简单的键盘调试是确认装配的最简单方法。</p><p id="7422" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">硬件装配正确，一切正常。现在到了有趣的部分。构建定制固件。qmk文档很好地解释了固件的一切，源代码是开源的。下面是固件和文档的链接。强烈建议通读所有这些。</p><div class="kb kc fm fo kd ke"><a href="https://github.com/qmk/qmk_firmware" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab ej"><div class="kg ab kh cl cj ki"><h2 class="bd hv fv z el kj eo ep kk er et ht dt translated">qmk/qmk _固件</h2><div class="kl l"><h3 class="bd b fv z el kj eo ep kk er et ek translated">Atmel AVR和ARM USB系列的键盘控制器固件- qmk/qmk_firmware</h3></div><div class="km l"><p class="bd b gc z el kj eo ep kk er et ek translated">github.com</p></div></div><div class="kn l"><div class="lm l kp kq kr kn ks jz ke"/></div></div></a></div><div class="kb kc fm fo kd ke"><a href="https://docs.qmk.fm/#/" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab ej"><div class="kg ab kh cl cj ki"><h2 class="bd hv fv z el kj eo ep kk er et ht dt translated">QMK固件</h2><div class="kl l"><h3 class="bd b fv z el kj eo ep kk er et ek translated">描述</h3></div><div class="km l"><p class="bd b gc z el kj eo ep kk er et ek translated">docs.qmk.fm</p></div></div></div></a></div><p id="234d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">太好了，欢迎回来。使用qmk固件时修改的三个主要文件都可以在特定键盘的文件夹中找到。在这种情况下，它的<code class="eh ln lo lp kv b">keyboards/1upkeyboards/sweet16</code>重要文件是<code class="eh ln lo lp kv b">config.h keymap.c rules.mk</code>, config . h是设置全局变量的地方。rules.mk是启用或禁用功能的地方，例如打开RGB underglow或“踢踏舞”。最后，keymap.c是神奇的地方，这是一个定义了按键功能和自定义功能的文件。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="febc" class="kz la hu kv b fv lb lc l ld le">The firmware that is referenced can be found as a part of the master branch for QMK (medium doesn't want to embed) yey! author, open source contribution ftw <a class="ae lf" href="https://raw.githubusercontent.com/qmk/qmk_firmware/master/keyboards/1upkeyboards/sweet16/keymaps/ridingintraffic/keymap.c" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/qmk/qmk_firmware/master/keyboards/1upkeyboards/sweet16/keymaps/ridingintraffic/keymap.c</a></span></pre><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lq lr l"/></div></figure><p id="6502" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一个代码片段是基本按键布局的示例。在真正的固件中，所有自定义键的变量初始化都在顶部完成，但这里是分配键网格和使用tflip和disface的“奇数”名称的地方，wat？这是有趣的部分，这些奇怪的keynames实际上是调用通过键盘发送hexcode组合的功能，用于单次按键，这将打印一个内嵌的ascii艺术反应表情符号。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="fc35" class="kz la hu kv b fv lb lc l ld le">tflip: (╯°□°)╯ ︵ ┻━┻<br/>tflip2: ┻━┻︵ \(°□°)/ ︵ ┻━┻<br/>fu: t(-_-t)<br/>cloud: (っ◕‿◕)っ<br/>shrug: ¯\_(ツ)_/¯<br/>disface: ಠ_ಠ<br/>heartface: ♥‿♥<br/>happyface: ʘ‿ʘ</span></pre><p id="3d9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当按下这些自定义键码时，会触发一个传递hexcodes的功能。下面简单介绍一下</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lq lr l"/></div></figure><p id="a050" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很简单，现在macropad的功能很简单，并且已经充满了反应表情符号。有些人会发现有用的其他人可能会认为这是一种浪费。这就是分层概念的由来。文档当然可以准确解释分层是如何工作的【https://docs.qmk.fm/#/feature_advanced_keycodes? T4】id = switching-and-toggling-layers想象从大写字母切换到小写字母的层，或者数字行中的符号。有在层之间切换的能力，很像capslock，但是它可能更容易有一个称为“瞬间”或“mo”层的shift键样式层，其中层仅在键被按住时是活动的。无论哪种方式，现在都可以将一套全新的功能添加到按键上，而只需牺牲一个按键就可以在各层之间切换。</p><p id="bc4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">进入最后一章，“踢踏舞”。这就是事情变得有点奇怪的地方。对于普通键盘和普通体验，单次按键输入单个键，而更快的双击输入其中的两个键。有了qmk和tap dance，这一切都改变了，因为当启用和编码时，tapdance功能将说“按一次”输出<code class="eh ln lo lp kv b">a</code>，当“在500毫秒内按两次”输出<code class="eh ln lo lp kv b">super happy fun guy</code>。示例如下</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lq lr l"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/d4049dc4597916578b42d439e590bfd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*wCs7QMD4lhVS6zRrgyjqkw.jpeg"/></div></figure><p id="f6c8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里键码<code class="eh ln lo lp kv b">TD_EXAMPLE1</code>被绑定到tapdance函数<code class="eh ln lo lp kv b">tdexample1</code>，然后该函数发送在<code class="eh ln lo lp kv b">config.h</code>中定义的字符串，该字符串输出<code class="eh ln lo lp kv b">tapdance_1</code>。这听起来有点复杂，但是分解一下就简单了，按一下键得到一个emjoi，按两下键得到整个字符串。加上一个层的转变，然后有一个全新的功能背后的关键。<code class="eh ln lo lp kv b">it is done</code>现在，sweet16 macropad比一个只有16个按钮的数字小键盘有用多了。macropad的内存足够做至少4+层这样的事情。在这一点上，很难记住所有的函数。</p><p id="b81c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但这还不是全部。QMK配备了一个docker文件。这意味着构建固件就像安装docker，然后从docker运行构建过程一样简单。一个示例命令是:<code class="eh ln lo lp kv b">docker run -e keymap=ridingintraffic -e keyboard=1upkeyboards/sweet16 — rm -v $('pwd'):/qmk:rw edasque/qmk_firmware</code>通过docker的强大功能，它将带有所有键盘键映射的工作目录卷挂载到映像中，然后所有的构建依赖项都被预构建到映像中，然后Ccode被转换成QMK根文件夹中的一个十六进制文件。没有muss没有大惊小怪，只是一个干净的建设环境和键盘编译十六进制文件。任何以前尝试过编译固件的人都知道，这是一个巨大的时间节约和不可思议的再现性。</p><p id="8eeb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！一个macropad和一个支持超过120个键盘的完整开源固件。QMK和它背后的开源社区都很棒。当遇到困难时，如果和人聊天有帮助，或者让我知道，我可以尽我所能帮助你，那么也有不和谐的聊天。</p></div></div>    
</body>
</html>