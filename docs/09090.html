<html>
<head>
<title>Exploring the AWS Lambda Deployment Limits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索AWS Lambda部署限制</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/exploring-aws-lambda-deployment-limits-38b7b9b61825?source=collection_archive---------1-----------------------#2018-11-04">https://medium.com/hackernoon/exploring-aws-lambda-deployment-limits-38b7b9b61825?source=collection_archive---------1-----------------------#2018-11-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7d2b654c9ee190a5d4f8addd0af8f71e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XfjVCWcTOy_cyt-oK-xOKA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/CGWK6k2RduY?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Ludovic Charlet</a> on <a class="ae jg" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8e17" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我们上一篇文章的<a class="ae jg" href="https://dashbird.io/blog/machine-learning-in-aws-lambda/" rel="noopener ugc nofollow" target="_blank">中，我们探索了如何使用</a><a class="ae jg" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>部署机器学习模型。使用AWS Lambda部署ML模型适合于早期项目，因为使用Lambda函数有一定的限制。然而，如果您需要在您的机器学习项目中充分利用AWS Lambda，这不是一个担心的理由。当使用Lambda函数时，开发人员总是担心部署包的大小。</p><p id="0a42" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们首先来看看AWS Lambda部署限制，并解决AWS官方文档中50 MB的包大小，这有点令人迷惑，因为您可以对未压缩的文件进行更大的部署。</p><h1 id="376b" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">AWS Lambda有以下限制。</h1><p id="4f8b" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">运行时环境限制:</p><ul class=""><li id="fe85" class="li lj hu jj b jk jl jo jp js lk jw ll ka lm ke ln lo lp lq dt translated">磁盘空间限制为512 MB。</li><li id="362b" class="li lj hu jj b jk lr jo ls js lt jw lu ka lv ke ln lo lp lq dt translated">*默认部署包大小为50 MB。</li><li id="5d23" class="li lj hu jj b jk lr jo ls js lt jw lu ka lv ke ln lo lp lq dt translated">*内存范围从128到1536 MB。</li><li id="9a4f" class="li lj hu jj b jk lr jo ls js lt jw lu ka lv ke ln lo lp lq dt translated">*一个函数的最大执行超时是15分钟*。</li></ul><p id="17a4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">lambda的请求限制:</p><ul class=""><li id="26ce" class="li lj hu jj b jk jl jo jp js lk jw ll ka lm ke ln lo lp lq dt translated">请求和响应正文有效负载大小最大为6 MB。</li><li id="14cf" class="li lj hu jj b jk lr jo ls js lt jw lu ka lv ke ln lo lp lq dt translated">*事件请求正文最大可达128 KB。</li></ul><p id="10aa" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">定义50 MB限制的原因是，您不能将您的部署包直接上传到lambda，因为它的大小大于定义的限制。从技术上来说，如果您让lambda函数从S3获取部署包，限制可能会高得多。与直接上传到lambda或任何其他AWS服务相比，AWS S3允许以高得多的部署包限制来部署功能代码。事实上，大多数AWS服务默认限制都可以通过<a class="ae jg" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html" rel="noopener ugc nofollow" target="_blank"> AWS服务限制</a>支持请求来提高。</p><p id="7db3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然而，对于许多开发者来说，什么是实际的限制还是一个疑问。为了找到这个问题的答案，我们将通过上传不同大小的部署包来进行测试。</p><h1 id="3cfa" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">部署包</h1><p id="a5c0" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">我们将使用机器学习模型作为我们的部署包，创建指定大小的随机数据来测试不同大小的限制。我们将测试文档中描述的以下限制:</p><p id="082f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv"> 50 MB </strong>:最大部署包大小<strong class="jj hv"> 250 MB </strong>:可以压缩到部署包(未压缩)中的代码/依赖项的大小。zip/。罐子大小)</p><p id="87ac" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于这个测试，我们将使用我们在<a class="ae jg" href="https://dashbird.io/blog/machine-learning-in-aws-lambda/" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>中创建的机器学习模型。是基于TensorFlow Inception-v3模型的图像识别深度学习模型。虽然我们的数据没有这么压缩。总文件大小约为150 MB，远远超过了指定的50 MB限制。</p><h1 id="0efa" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">测试</h1><p id="af59" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">我们直接上传到lambda函数来测试一下吧。以下是要遵循的主要步骤:<strong class="jj hv">首先，我们要把包裹的拉链拉上。</strong>这个zip包将包含我们所有的文件，例如:</p><ul class=""><li id="90a2" class="li lj hu jj b jk jl jo jp js lk jw ll ka lm ke ln lo lp lq dt translated">分类_图像. py</li><li id="c3e6" class="li lj hu jj b jk lr jo ls js lt jw lu ka lv ke ln lo lp lq dt translated">classify_image_graph_def.pb</li><li id="8018" class="li lj hu jj b jk lr jo ls js lt jw lu ka lv ke ln lo lp lq dt translated">机器学习包. zip</li></ul><p id="8515" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这个模型是专门为这个项目创建的。但是，机器学习模型可以从以下来源下载。</p><p id="1eee" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">https://github.com/fchollet/deep-learning-models<strong class="jj hv"/>:<a class="ae jg" href="https://github.com/fchollet/deep-learning-models" rel="noopener ugc nofollow" target="_blank"/></p><p id="3124" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv"> TensorFlow </strong> : <a class="ae jg" href="https://github.com/tensorflow/models/tree/master/official" rel="noopener ugc nofollow" target="_blank">官方发布</a>，<a class="ae jg" href="https://www.tensorflow.org/performance/performance_models" rel="noopener ugc nofollow" target="_blank">性能车型</a>，<a class="ae jg" href="https://github.com/taehoonlee/tensornets" rel="noopener ugc nofollow" target="_blank"> tensornets </a></p><p id="800c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">2让我们称我们的包为MachineLearning.zip</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="ae09" class="mf kg hu mb b fv mg mh l mi mj">zip MachineLearning.zip MachineLearning</span></pre><p id="d693" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv"> 3现在检查我们是否可以压缩文件。</strong></p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="dbfe" class="mf kg hu mb b fv mg mh l mi mj">$ ls -lhtr | grep zip -rw-r--r-- 1 john staff 123M Nov 4 13:05 MachineLearning.zip</span></pre><p id="c671" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">即使在压缩和压缩之后，整个包的大小大约是132 MB。</p><p id="03a8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv"> 4为了创建lambda函数，我们需要创建IAM角色。</strong>由于我们的主要目标是测试限制，我们将跳过角色创建过程。使用您的凭据登录IAM管理控制台，创建一个测试角色并附加AWSLambdaRole策略。</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/e7d8dfab6924234204dabdcacfffb443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*jngrH4VYcAbe8FPC.png"/></div></figure><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ml"><img src="../Images/d1e884172955e1a6488fd0fdce01005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ks6cpduhAavskK6K.png"/></div></div></figure><p id="a8ac" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv"> 5接下来，我们将通过</strong><a class="ae jg" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html" rel="noopener ugc nofollow" target="_blank"><strong class="jj hv">AWS CLI</strong></a><strong class="jj hv">创建一个lambda函数，并将我们的部署包直接上传到该函数。</strong></p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="ec7b" class="mf kg hu mb b fv mg mh l mi mj">aws lambda create-function --function-name mlearn-test --runtime nodejs6.10 --role arn:aws:iam::XXXXXXXXXXXX:role/Test-role --handler tensorml --region ap-south-1 --zip-file fileb://./MachineLearning.zip</span></pre><p id="85c0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">用您的AWS帐户id替换XXXXXXXXXXXX。由于我们的包大小大于50 MB的指定限制，它抛出一个错误。</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="a6a8" class="mf kg hu mb b fv mg mh l mi mj">An error occurred (RequestEntityTooLargeException) when calling the UpdateFunctionCode operation: Request must be smaller than 69905067 bytes for the UpdateFunctionCode operation</span></pre><p id="790a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">由于我们的部署包相当大，我们将在亚马逊S3的AWS Lambda推理执行期间再次加载它。为此，我们需要从AWS CLI创建AWS S3存储桶:</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="c86d" class="mf kg hu mb b fv mg mh l mi mj">aws s3 mb s3://mlearn-test --region ap-south-1</span></pre><p id="2fc2" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将为我们创造S3桶。现在我们将把我们的包上传到这个桶中，并用S3对象键更新我们的lambda函数。</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="6d7e" class="mf kg hu mb b fv mg mh l mi mj">aws s3 cp ./ s3://mlearn-test/ --recursive --exclude "*" --include "MachineLearning.zip"</span></pre><p id="feed" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一旦我们的包被上传到桶中，我们将用包的对象键更新lambda函数。</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="3a41" class="mf kg hu mb b fv mg mh l mi mj">aws lambda update-function-code --function-name mlearn-test --region ap-south-1 --s3-bucket mlearn-test --s3-key MachineLearning.zip</span></pre><p id="00b6" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这一次，即使在更新我们的lambda函数之后，它也没有显示任何错误，并且我们能够成功地上传我们的包。这意味着如果通过S3上传而不是直接上传，包的大小可能会大于50 MB。由于压缩后我们的包大小约为132 MB，我们仍然不清楚上传包的最大限制是什么。</p><p id="c5cc" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了得到最大的限制，我们将创建一个大约300 MB的随机数据，并通过S3上传，更新我们的lambda函数。</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="cfe9" class="mf kg hu mb b fv mg mh l mi mj">fsutil file createnew sample300.txt 350000000</span></pre><p id="ff23" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将创建一个大约300 MB的样本文件。我们将压缩文件，并通过S3再次上传。</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="85dc" class="mf kg hu mb b fv mg mh l mi mj">aws s3 cp ./ s3://mlearn-test/ --recursive --exclude "*" --include "sample300.zip"</span></pre><p id="1dcd" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh mm mn mo mb b">aws lambda update-function-code --function-name mlearn-test --region ap-south-1 --s3-bucket mlearn-test --s3-key sample300.zip</code></p><p id="872d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">更新我们的lambda函数后，我们得到以下错误:</p><p id="ed07" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh mm mn mo mb b">An error occurred (InvalidParameterValueException) when calling the UpdateFunctionCode operation: Unzipped size must be smaller than 262144000 bytes</code></p><p id="f531" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">错误描述解压缩后的包的大小应该小于262144000字节，大约是<strong class="jj hv"> 262 MB </strong>。我们可以注意到，这个大小比指定的可以压缩到一个部署包(未压缩)中的代码/依赖项大小的限制<strong class="jj hv"> 250 MB </strong>稍大一点。zip/。罐子大小)。因此，我们发现通过S3上传时，未压缩部署包的最大大小限制是250 MB。然而，当直接上传到lambda函数时，我们不能上传超过50 MB的包。</p><p id="48e1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这里需要注意的重要一点是，在未压缩状态下，您的代码及其依赖项应该在250 MB的大小限制之内。即使我们考虑更大的封装尺寸，它也可能严重影响lambda函数的冷启动时间。因此，对于更大的包，lambda函数将需要更长的时间来执行。</p><p id="b79b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">* 2018年10月，最大执行时间从5分钟增加到15分钟。</p></div><div class="ab cl mp mq hc mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hn ho hp hq hr"><p id="c0fe" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="mw">原载于2018年11月4日</em><a class="ae jg" href="https://dashbird.io/blog/exploring-lambda-limitations/" rel="noopener ugc nofollow" target="_blank"><em class="mw">dash bird . io</em></a><em class="mw">。</em></p></div></div>    
</body>
</html>