<html>
<head>
<title>Python/Flask Data Visualization &amp; Interactive Maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python/Flask数据可视化和交互式地图</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/python-flask-data-visualization-interactive-maps-30bc4e872a14?source=collection_archive---------2-----------------------#2018-11-07">https://medium.com/hackernoon/python-flask-data-visualization-interactive-maps-30bc4e872a14?source=collection_archive---------2-----------------------#2018-11-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/cab40aec6c8332ed0a0909ec6aa83f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EuIEYA7l6aVqZFMlVkAmHA.png"/></div></div></figure><div class=""/><p id="53bd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你有没有想过创建一个交互式的数据可视化地图？在我最近的兼职项目中，我为一种病毒如何在美国传播创造了一个非常酷的可视化效果。如果你想看看完成的网站，你可以点击这里:</p><p id="dc61" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="http://ethanszombies.herokuapp.com" rel="noopener ugc nofollow" target="_blank">http://ethanszombies.herokuapp.com</a></p><p id="8ad4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我将通过我的思维过程来创建这个，以及如何创建你自己的一步一步的指示。我知道可能有更好/更有效的方法来做到这一点，所以如果你正在阅读这篇文章，并有更好的想法，请随时分享。下面是这个过程如何为我工作的分解。我真的把这个项目分成两部分。第一部分是收集数据。第二部分是用户部分，因此用户可以使用我们在第一部分中处理的数据。以下是该工作流程的流程图:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff kb"><img src="../Images/9d5cdd219f71e5699ce3252f42a3028b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EtLxPpu5-hxl4XasUqSttQ.png"/></div></div></figure></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h1 id="ed05" class="kn ko if bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">1 —我们想要创造什么？— — — — — — — — — — — — — — — — — -</h1><p id="585e" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">为此，虽然我确实想制作一个模拟病毒爆发的地图，但我要关注的病毒是僵尸病毒。基于数小时非常重要的研究，我发现了僵尸病毒通常如何传播的几个关键点:</p><blockquote class="lq"><p id="3966" class="lr ls if bd lt lu lv lw lx ly lz jz ek translated">1.僵尸病毒在人口密集的地区，如市中心传播得更快。</p><p id="0d33" class="lr ls if bd lt lu lv lw lx ly lz jz ek translated">2.丧尸笨拙不协调，不利地形难走。因此，海拔高的地区会使僵尸病毒传播得更慢。</p><p id="8c52" class="lr ls if bd lt lu lv lw lx ly lz jz ek translated">3.虽然僵尸病毒的标准传播仅限于僵尸四处走动并咬人，但偶尔如果受感染的人试图开车或其他车辆逃离，病毒会传播得更快，从而使道路和州际公路有利于快速传播病毒。</p></blockquote><p id="9c75" class="pw-post-body-paragraph jc jd if je b jf ma jh ji jj mb jl jm jn mc jp jq jr md jt ju jv me jx jy jz hn dt translated">当然有大量的数据需要考虑，如天气、气候或军队在病毒发展中的作用，然而，在事情变得太疯狂之前，我们将从跟踪这三个数据点开始，1。人口密度，2。海拔，3。州际公路。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h1 id="ac27" class="kn ko if bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">2.—我们需要考虑哪些因素？— — — — — — — — — — — — — — — — — -</h1><p id="9fd0" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">假设我们有一张美国地图，地图上的每个区域都是白色的。我们可以通过改变像素的颜色来表示一个被感染的人，或者将div改变成不同的颜色。</p><h2 id="9a42" class="mf ko if bd kp mg mh mi kt mj mk ml kx jn mm mn lb jr mo mp lf jv mq mr lj ms dt translated"><em class="mt"> a .时间间隔</em></h2><p id="45a5" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated"><em class="mu">首先，我们需要确定一个时间间隔。这个时间间隔可以是1秒，甚至更短。每个时间间隔将代表实际时间的实际测量值，如感染后的一小时或一天。</em></p><h2 id="dddc" class="mf ko if bd kp mg mh mi kt mj mk ml kx jn mm mn lb jr mo mp lf jv mq mr lj ms dt translated"><em class="mt"> b .每个区间的决策</em></h2><p id="c5ed" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">然后我们可以模拟这个div的动作。在每个时间间隔，我们将需要决定被感染的块移动到哪里，它移动到那里的速度有多快，以及它是否感染任何人。</p><p id="f20e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们可以利用每个地区的数据来做出这些决定。</p><h2 id="64a4" class="mf ko if bd kp mg mh mi kt mj mk ml kx jn mm mn lb jr mo mp lf jv mq mr lj ms dt translated"><em class="mt">感染</em></h2><ol class=""><li id="5382" class="mv mw if je b jf ll jj lm jn mx jr my jv mz jz na nb nc nd dt translated"><em class="mu">人口密度将决定一个感染者在每个时间间隔内是否会感染其他人以及会感染多少人。如果一个受感染的街区在人口高度密集的地区，它会感染很多人。如果没有，可能不会传染任何人。</em></li></ol><h2 id="1e93" class="mf ko if bd kp mg mh mi kt mj mk ml kx jn mm mn lb jr mo mp lf jv mq mr lj ms dt translated"><em class="mt">速度</em></h2><ol class=""><li id="d065" class="mv mw if je b jf ll jj lm jn mx jr my jv mz jz na nb nc nd dt translated">海拔是影响速度的一个因素。在每一个间隔，一个被感染的区块会移动一段距离，但是如果它是一个更高的海拔，那段距离会更短。</li></ol><h2 id="137b" class="mf ko if bd kp mg mh mi kt mj mk ml kx jn mm mn lb jr mo mp lf jv mq mr lj ms dt translated"><em class="mt">方向</em></h2><ol class=""><li id="4652" class="mv mw if je b jf ll jj lm jn mx jr my jv mz jz na nb nc nd dt translated"><em class="mu">州际公路将主要影响方向。我们可以将每个受感染区块的标准移动设置为随机模式，但如果僵尸在高速公路上或附近绊倒，那么它的方向将在高速公路上保留一段时间。</em></li></ol><h1 id="4356" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">3.—我们如何将我们想要的数据放到地图上？— — — — — — — — — — — — — — — — — -</h1><p id="a785" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">第一步是用我们需要的数据对地图进行编码。对我来说，一种方法似乎是创建一个特定维度的地图。出于我的目的，我认为1150像素X 768px像素应该很好。</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nj"><img src="../Images/b96d54985b86c6b5289fa2fc82857edf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xLcmnWg8uO9PU0FTlw2JCA.png"/></div></div></figure><p id="7e91" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们需要确定一个僵尸会在地图上占据多少空间。经过一些测试，我发现大约5px X 5px的面积就足够了。再多就显得笨拙了。更不用说，有如此多的数据需要处理，以至于不断地消耗资源。</p><p id="48da" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在决定了一个合适的地图尺寸后，我的下一步是在地图上创建一个覆盖图。这个覆盖将包含我需要的按钮大小(每个5px * 5px)。</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nk"><img src="../Images/cd152305e1d73418a3ccdfde6a052744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sa_nkrx3AaumjvyWvoFbQA.png"/></div></div></figure><p id="d8c6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于人口密度，首先，我将创建最大人口密度10，最小值0。这些数字是任意的，只是为了表示密度的变化，但不一定对应于实际的人口数量。</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nl"><img src="../Images/d9f7642394c92d161d6d346971837ba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*INr2K93KiSu5z7WpYmQkDQ.png"/></div></div></figure><p id="8c96" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然上面的例子没有按比例绘制，但至少你可以在这里看到这个想法。通过创建一个覆盖在地图上的网格，我们可以将数据编码到网格的每个块中，这将根据疫情到达的块来改变疫情的反应方式。</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nk"><img src="../Images/938577de35a24c0ffe4d4994eaee3c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GVt8UHRvA9LrNgOjdnY-Ow.png"/></div></div></figure><p id="c51f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我的想法是，你可以点击每个按钮，每点击一次，数字(密度)就会增加1。如果我们有40，000个按钮，单击每个按钮似乎不太合理，因此，我可能会选择将该事件绑定到鼠标悬停上，以便更快地输入数据。改变mouseover事件的颜色也是一个好主意，这样更容易跟踪哪些div包含哪些值。既然我们已经考虑了伪代码，现在是实际开始设置我们的文件并编写一些实际代码的好时机，因为我们对我们想要创建什么以及我们必须如何创建它有了更清晰的想法。在很多项目中，我在编写代码之前花了很多时间来绘制东西，这往往会使代码最终更有条理。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h1 id="9b3d" class="kn ko if bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">文件设置— — — — — —</h1><p id="cdf8" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">我们最终得到的文件结构可能如下所示:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div class="fe ff nm"><img src="../Images/4b8ecac7e7cef886891308c9f8fdeb9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*WqY_s8DElB0VV3AQVHD5bA.png"/></div></figure><p id="4cc8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，我们可以使用命令行创建大部分内容。一些文件，如density.txt和densitydata.json将在项目的第一部分创建。</p><p id="cb3b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在命令行上，执行以下操作:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="1782" class="mf ko if no b fv ns nt l nu nv">mkdir &lt;project folder name&gt;<br/>cd &lt;project folder name&gt;</span></pre><p id="eb61" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们将在命令行上创建所有的初始文件:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="44b1" class="mf ko if no b fv ns nt l nu nv">touch app.py .gitignore README.md requirements.txt runtime.txt</span><span id="0a6d" class="mf ko if no b fv nw nt l nu nv">mkdir templates<br/>mkdir static</span><span id="9b22" class="mf ko if no b fv nw nt l nu nv">cd templates<br/>touch base.html</span><span id="4d1c" class="mf ko if no b fv nw nt l nu nv">cd ..<br/>cd static<br/>touch main.css</span></pre><p id="39f4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，如果我们想创建一个git存储库并部署在heroku上，这是一个很好的地方。</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="cd0d" class="mf ko if no b fv ns nt l nu nv">git init</span></pre><p id="624e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，如果我们设置了一个heroku帐户，我们可以通过运行以下命令创建一个新的heroku项目:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="3cba" class="mf ko if no b fv ns nt l nu nv">heroku create &lt;project name&gt;</span></pre><p id="9009" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我们开始安装依赖项和库之前，我们肯定希望用Python建立一个虚拟环境。为此，我们可以运行以下命令:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="2ee0" class="mf ko if no b fv ns nt l nu nv">pyvenv-3.6 env (substitute your python version here)</span></pre><p id="ae1f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们将按如下方式激活该环境:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="8273" class="mf ko if no b fv ns nt l nu nv">source env/bin/activate</span></pre><p id="665e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在命令行中，您现在会在项目文件夹前看到(env ),让您知道您正在运行一个虚拟环境。如果您从现在开始遇到python找不到您已经安装的模块的错误，请检查您是否还在使用您的虚拟环境。如果没有，那么再次运行最后一个命令。</p><p id="a45b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，由于flask是我们需要的主要依赖项，我们可以安装它。</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="8711" class="mf ko if no b fv ns nt l nu nv">pip install flask</span></pre><p id="da9a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果我们决定在heroku上运行它，我们需要告诉它我们运行的是哪个版本的python，我们可以将它添加到我们的runtime.txt文件中:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="9cbb" class="mf ko if no b fv ns nt l nu nv">echo "python-3.6.4" &gt;&gt; runtime.tx (or whatever your version is)</span></pre><p id="2521" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果我们使用heroku，我们还需要安装gunicorn:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="c4e9" class="mf ko if no b fv ns nt l nu nv">pip install gunicorn</span></pre><p id="3e10" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后将以下文本添加到我们的Procfile中:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="724a" class="mf ko if no b fv ns nt l nu nv">echo "web: gunicorn app:app" &gt;&gt; Procfile</span></pre><p id="f442" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我们将运行pip freeze来更新我们的requirements.txt文件:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="f9e5" class="mf ko if no b fv ns nt l nu nv">pip freeze &gt; requirements.txt</span></pre><p id="4d48" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">酷，现在这一切都解决了，我们上面的文件树中的大多数文件应该在那里，我们准备好了。</p><p id="8d1e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">回到我们之前的流程图，这里是我们将首先处理的区域:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div class="fe ff nx"><img src="../Images/e9a6472c6a619c0295b6dbd7e034f98f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*zI0yUJObA8UMToFtswJ3gQ.png"/></div></figure><h1 id="f862" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">CSS — — — — — —</h1><p id="e997" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">基于我们之前讨论的工作流程，我们首先需要的是一个地图图像，我们可以在上面覆盖按钮网格。为此，我们只需保存一个适合我们的地图，并将其用作div或element的背景图像。我们还会将其设置为适当的尺寸。这将放在我们之前创建的main.css文件中:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="59b6" class="mf ko if no b fv ns nt l nu nv">#body {<br/>  background-image: url('/static/states.png');<br/>  background-size: contain;<br/>  background-repeat: no-repeat;<br/>  background-size: 1150px 768px;<br/>  margin: 0px;<br/>  padding: 0px;<br/>  display: flex;<br/>  flex-flow: row wrap;<br/>  justify-content: flex-start;<br/>  align-items: flex-start;<br/>  width:1150px;<br/>  height:768px;<br/>  border:black solid 2px;<br/>}</span></pre><p id="53a4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们还将在这里创建两个按钮类。当一个用户点击，或者一个活跃的僵尸块感染了另一个块，我们将把这个块从一个css类改变为另一个。以下是我创建的类。。“btn”类是默认按钮类，而“BTN”类是默认按钮类。“active”是激活的类:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="1d50" class="mf ko if no b fv ns nt l nu nv">.btn {<br/>  width: 4.5px;<br/>  height:4.8px;<br/>  background-color: transparent;<br/>  margin: 0px;<br/>  padding: 0px;<br/>  font-size: 1px;<br/>}<br/>.active {<br/>  width: 4.5px;<br/>  height:4.8px;<br/>  /* Permalink - use to edit and share this gradient: <a class="ae ka" href="http://colorzilla.com/gradient-editor/#136325+0,305937+100&amp;1+15,0+88" rel="noopener ugc nofollow" target="_blank">http://colorzilla.com/gradient-editor/#136325+0,305937+100&amp;1+15,0+88</a> */<br/>background: -moz-radial-gradient(center, ellipse cover, rgba(19,99,37,1) 0%, rgba(23,97,40,1) 15%, rgba(44,90,53,0) 88%, rgba(48,89,55,0) 100%); /* FF3.6-15 */<br/>background: -webkit-radial-gradient(center, ellipse cover, rgba(19,99,37,1) 0%,rgba(23,97,40,1) 15%,rgba(44,90,53,0) 88%,rgba(48,89,55,0) 100%); /* Chrome10-25,Safari5.1-6 */<br/>background: radial-gradient(ellipse at center, rgba(19,99,37,1) 0%,rgba(23,97,40,1) 15%,rgba(44,90,53,0) 88%,rgba(48,89,55,0) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */<br/>filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#136325', endColorstr='#00305937',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */<br/>  margin: 0px;<br/>  padding: 0px;<br/>  font-size: 1px;<br/>  border-radius: 25%;<br/>  <br/>}<br/>.btn:hover {<br/>  cursor: pointer;<br/>}</span></pre><h1 id="4f73" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">HTML — — — — — —</h1><p id="2156" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">然后，我们可以继续前进，创建在我们的CSS中显示的实际HTML。这将放入我们之前创建的base.html文件中:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="f68c" class="mf ko if no b fv ns nt l nu nv">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8"&gt;<br/>    &lt;title&gt;&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" /&gt;<br/>&lt;body&gt;<br/>  &lt;div id="body"&gt;<br/>  &lt;/div&gt;</span><span id="4a4a" class="mf ko if no b fv nw nt l nu nv">&lt;button id="submitform" type="submit"&gt;SUBMIT&lt;/button&gt;<br/>  &lt;/body&gt;<br/>  &lt;div id="formGoesHere"&gt;&lt;/div&gt;<br/>&lt;/html&gt;</span></pre><h1 id="5ed3" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">JavaScript — — — — — — —</h1><p id="87db" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">接下来，我们将添加一些JavaScript。我们将使用一个循环来创建所需长度的按钮。如果你用和我一样的尺寸，那么40，000个按钮看起来差不多了。通常，您可能有一个单独的JavaScript文件。虽然这可能是最佳实践，但我发现如果我编写的代码少于300行，那么在Script标签中包含JavaScript通常会更容易。如果看起来我们会有更多，我们可以在以后改变它。</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="6f16" class="mf ko if no b fv ns nt l nu nv">&lt;script src="<a class="ae ka" href="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" rel="noopener ugc nofollow" target="_blank">https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js</a>"&gt;&lt;/script&gt;<br/>  &lt;script type='text/javascript'&gt;<br/>        $(document).ready(function(){<br/>$(document).ready(function(){<br/>  for (var i = 0; i &lt; 40000; i++) {<br/>            var inputBtn = `<br/>            &lt;div type="button" class="btn"&gt;0&lt;/div&gt;<br/>            `;<br/>            $('#body').append(inputBtn);<br/>          }<br/>});<br/>  &lt;/script&gt;</span></pre><p id="6e36" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我将为我们刚刚创建的所有标签创建mouseover事件:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="60cf" class="mf ko if no b fv ns nt l nu nv">var color1 = '#fff600';<br/>          var color2 = '#ffc32b';<br/>          var color3 = '#e8a600';<br/>          var color4 = '#e88300';<br/>          var color5 = '#ce7502';<br/>          var color6 = '#ce3b01';<br/>          var color7 = '#ad3201';<br/>          var color8 = '#7a2402';<br/>          var color9 = '#561a02';<br/>          var color10 = '#1e0800';<br/>        <br/>        $('body').on('mouseover', '.btn', function () {<br/>          var currentVal = $(this).html();<br/>          console.log(currentVal);<br/>          var newVal = parseInt(currentVal) + 1;<br/>          if (newVal &gt; 10){<br/>            newVal = 10 }</span><span id="1767" class="mf ko if no b fv nw nt l nu nv">          $(this).html(newVal);<br/>          if ($(this).html() == 1){<br/>            $(this).css('background-color', color1);<br/>          }<br/>          else if ($(this).html() == 2){<br/>            $(this).css('background-color', color2);<br/>          }<br/>          else if ($(this).html() == 3){<br/>            $(this).css('background-color', color3);<br/>          }<br/>          else if ($(this).html() == 4){<br/>            $(this).css('background-color', color4);<br/>          }<br/>          else if ($(this).html() == 5){<br/>            $(this).css('background-color', color5);<br/>          }<br/>          else if ($(this).html() == 6){<br/>            $(this).css('background-color', color6);<br/>          }<br/>          else if ($(this).html() == 7){<br/>            $(this).css('background-color', color7);<br/>          }<br/>          else if ($(this).html() == 8){<br/>            $(this).css('background-color', color8);<br/>          }<br/>          else if ($(this).html() == 9){<br/>            $(this).css('background-color', color9);<br/>          }<br/>          else if ($(this).html() == 10){<br/>            $(this).css('background-color', color10);<br/>          }<br/>        });</span></pre><p id="82e5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在前面的例子中，每个块或数组元素的值都在0到10之间。如果我们想要返回并编辑这个表单和数据，以便我们可以存储关于每个块上的人口和海拔的数据，我们可能想要以不同的方式增加值，或者存储true/false值。我们总是可以在这里改变输入，但是让它写到后端的一个新文件中，这取决于我们想要存储什么数据。我们稍后会详细讨论这个想法，但只是一些需要考虑的事情。</p><p id="abc2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我将创建一个表单，允许我将flask前端的数据发送到后端的python。然后我可以操作数据并创建散列。</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="9a59" class="mf ko if no b fv ns nt l nu nv">var inputArr = ''<br/>        $('#submitform').click(function(){<br/>          $(".btn").each(function(){<br/>            var input = $(this).html();<br/>            inputArr += ("," + input);<br/>          });<br/>          var form2 = `<br/>          &lt;form action="form1" id="myForm" method="post"&gt;<br/>            &lt;input value="${inputArr}" name="t1"/&gt;<br/>          &lt;/form&gt;<br/>          `;<br/>          console.log(inputArr);<br/>          $('#formGoesHere').append(form2);<br/>          $('#myForm').submit();<br/>        });<br/>});</span></pre><p id="f8c8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">即使我们已经创建了表单和前端的所有东西，它实际上还没有连接到任何东西。为了将这些数据连接到python，我们需要修改app.py文件，并使用Flask请求从我们的base.html文件接收数据。此时，我们现在在我们的流程图中:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div class="fe ff nx"><img src="../Images/a610704bf2cfe37cfe5966c3a8a0e5e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*VOtpLIQBy9riPsZFVp9KMw.png"/></div></figure><h1 id="d285" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">Python — — — — — — — —</h1><p id="c85c" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">在app.py中，让我们继续并导入我们将需要的东西以使其工作:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="18f8" class="mf ko if no b fv ns nt l nu nv">from flask import Flask, request, render_template</span></pre><p id="ac26" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们将定义应用程序:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="56c6" class="mf ko if no b fv ns nt l nu nv">app = Flask(__name__)</span></pre><p id="4466" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我们将定义与我们的base.html文件关联的路由，这将是主路由，(“/”):</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="9b80" class="mf ko if no b fv ns nt l nu nv"><a class="ae ka" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/', methods=['GET', 'POST'])<br/>def searchTopic():<br/>    return render_template('base.html')</span></pre><p id="3410" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这条路径将呈现页面，但是我们还需要为表单创建一条路径。如果您回到我们编写的html，该表单的动作是“form1”，这将是我们用于表单数据的路径。</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="551a" class="mf ko if no b fv ns nt l nu nv"><a class="ae ka" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/form1', methods=['GET', 'POST'])<br/>def getFormData():<br/>    data = request.form['t1']<br/>    f = open('file.txt', 'w')<br/>    f.write(data)<br/>    f.close()<br/>    return render_template('base.html')</span></pre><p id="e759" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里，我们在app.py中的route，“/form1”与html中的表单动作相关联。该表单中的输入名称“t1”与app.py中的request.form['t1']相关联</p><p id="5834" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我们将在app.py文件的底部添加以下行:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="6991" class="mf ko if no b fv ns nt l nu nv">if __name__ == '__main__':<br/>    app.run()</span></pre><p id="baf3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，如果我们提交表单，数据将被保存为变量' data '。然后，我们将打开一个名为file.txt的文件，并将我们的“数据”变量写入该文件。现在，我们可以迭代文件中的数据，并将其转换为JSON，以及我们稍后可能收集的其他数据。</p><h1 id="b402" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">返回HTML/JavaScript — — — — — — — —</h1><p id="8110" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">如果你像这样设置你的，你可以在mousever上看到，我们正在改变每个div中html的值，以及颜色。这种颜色很容易看出哪些改变了，哪些没有改变。当我提交表单时，我能够将div的值作为数组发送给python。输入过程可能如下所示:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ny"><img src="../Images/df70bc88aba2dc9857443f0627a67792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_tbN5L5TaqJXLgFQdDV0w.png"/></div></div></figure><p id="9064" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里的控制台日志记录了每个div的值，当我们创建它时，您可以看到区域地图。一旦我们获得了所有想要的地图数据，我们就可以在JavaScript文件中注释掉这些代码，因为我们不需要它来实际运行模拟。但是如果我们想要制作任何新类型数据的新地图，它是很方便的。在我的例子中，我提交了一个只包含人口数据的地图…另一个包含海拔数据的地图，等等…然后用python将每个列表组合成一个散列。</p><p id="c304" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们通过前端输入的数据被解释为一个数组或逗号分隔的值。地图数据基本上是40000个元素的数组，范围从0到10，如下所示:</p><p id="5ce0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">[0,0,0,0,0,0,1,1,2,3,4,0,0,0,0,0,0,0,5,6,6,7,7,7,4,1,0……..]</p><h1 id="fc2a" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">4 —将原始数据组装到JSON中</h1><p id="85c2" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">在python中，每个列表都有相同数量的索引，也就是说，在列表1中，索引552处的数组对应于网格中的第552个div。所以我将遍历一个列表，但同时检查另一个列表，而不必遍历两个列表。在下面的例子中，我有一个包含人口数据的列表，还有一个包含当前区块是否是水的数据的列表。</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="082d" class="mf ko if no b fv ns nt l nu nv">import json<br/>with open('population.txt') as f:<br/>    file1 = [line.rstrip() for line in f]<br/>with open('file.txt') as f:<br/>    file2 = [line.rstrip() for line in f]<br/>array = []</span><span id="d38f" class="mf ko if no b fv nw nt l nu nv">for idx, i in enumerate(file1):<br/>    arr = i.split(",")<br/>    waterArr = file2[idx].split(",")<br/>    x = 0<br/>    for index, a in enumerate(arr):<br/>        myObj = {<br/>            "population": 0,<br/>            "water": 0,<br/>        }<br/>        if int(a) &gt; 9:<br/>            myObj['population'] = 8<br/>        elif int(a) is 9:<br/>            myObj['population'] = 7<br/>        elif int(a) is 8:<br/>            myObj['population'] = 6<br/>        elif int(a) is 7:<br/>            myObj['population'] = 5<br/>        elif int(a) is 6:<br/>            myObj['population'] = 4<br/>        elif int(a) is 5:<br/>            myObj['population'] = 3<br/>        elif int(a) is 4:<br/>            myObj['population'] = 2<br/>        elif int(a) is 3:<br/>            myObj['population'] = 1<br/>        elif int(a) &lt; 3:<br/>            myObj['population'] = 0<br/>        if waterArr[index] == '1':<br/>            myObj['water'] = 1<br/>        array.append(myObj)</span><span id="aadb" class="mf ko if no b fv nw nt l nu nv">with open('density2.json', 'w') as outfile:<br/>    json.dump(array, outfile)</span></pre><p id="c2f1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后我将数据转换成json，并保存为json文件。修改后的json数据列表如下所示:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="e725" class="mf ko if no b fv ns nt l nu nv">...{"water": 1, "population": 0}, {"water": 0, "population": 0}, {"water": 1, "population": 0}, {"water": 0, "population": 0}, {"water": 0, "population": 0}, {"water": 0, "population": 0}, {"water": 0, "population": 0}, {"water": 0, "population": 0}, {"water": 0, "population": 1}, {"water": 0, "population": 1}, {"water": 0, "population": 0}, {"water": 0, "population": 0}, {"water": 0, "population": 1}, {"water": 0, "population": 1}, {"water": 0, "population": 5}, {"water": 0, "population": 0}, {"water": 0, "population": 0}, {"water": 0, "population": 0},...</span></pre><p id="85de" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">数组中的每个元素都包含该区块的人口数据，以及该区块是否是水的数据(因为我们不希望僵尸在海洋中游荡，不是吗？)</p><h1 id="1499" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">第一部分结束</h1><p id="6fce" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">至此，我们至少收集了一些数据。我们可以随时回去，使用我们已经创建的文件，输入新的数据，关于海拔，或人口年龄，或任何我们认为可能相关的数据。我们只需要给新文件一个新的名字，这样我们就不会覆盖以前的文件。然后我们可以将它添加到python中的循环中，并将附加数据添加到JSON数据中。</p><p id="9736" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在继续之前要考虑的一件事是，由于这是一个相当小的项目，我不打算为不同的函数创建额外的文件。我将简单地注释掉我不需要的部分。由于我们将从项目的第一部分进入第二部分，我们可以注释掉所有与收集、组织或收集数据相关的代码。这包括我们将文本文件转换成散列的前几行，以及我们创建和提交表单数据的JavaScript。然而，如果拥有单独的文件对你来说更容易跟踪，那么你可以这样做。请记住，您拥有的文件结构将与我的不同。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h1 id="51db" class="kn ko if bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">第二部分— — — — — —</h1><p id="6a7c" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">现在我们有了这个数据，我们想把它作为json发送到前端。我们可以通过烧瓶来实现。</p><p id="7cda" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在app.py中，在主路径上，我们将只包含一个从python获取数据的函数。正如我前面提到的，我觉得更容易的方法是注释掉这个文件中之前的代码，它将我们的文本文件组装到JSON中，并将这些行包含在注释掉的部分下面。但是，如果您喜欢使用新文件，也没问题:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="7364" class="mf ko if no b fv ns nt l nu nv">------- IN TEST.PY -------------------</span><span id="09a9" class="mf ko if no b fv nw nt l nu nv">with open('density2.json') as f:<br/>    popDensity = json.load(f)</span><span id="0da7" class="mf ko if no b fv nw nt l nu nv">def getData():<br/>    return popDensity</span></pre><p id="e0e6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当我们的主路由('/')被调用时，我们将从test.py模块调用getData函数，并将其作为输出返回，以便在我们的JavaScript文件中使用。我们还将修改我们之前创建的app.py路由，以接受这些数据并将其发送到前端。我们还将在顶部包含一个import语句，以导入包含我们想要使用的函数的模块test.py:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="daa9" class="mf ko if no b fv ns nt l nu nv">from test import getData</span></pre><p id="ef80" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将把该函数添加到主路由中以获取数据:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="2eb4" class="mf ko if no b fv ns nt l nu nv"><a class="ae ka" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/', methods=['GET', 'POST'])<br/>def searchTopic():<br/>    output = getData()<br/>    return render_template('base.html', result=output)</span></pre><h1 id="8965" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">5 —使用前端的JSON数据来影响模拟。— — — — — — — — — — — — — — — — — -</h1><p id="2743" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">在我们的JavaScript文件中，我们可以使用flask来检索数据:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="6d2d" class="mf ko if no b fv ns nt l nu nv">$(document).ready(function(){<br/>          var data = {{ result|tojson }};</span></pre><p id="4b31" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的变量数据现在包含了我们在'/' route函数中传递的结果。</p><p id="4f91" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我的想法是用元素属性形式的JSON数据对每个div进行编码。我先从“水”“人口”“方向”的属性说起。水和人口是从python传入的属性，方向将完全由JavaScript控制。我们将从创建这些属性开始，以便在我们的元素中使用它们:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="298b" class="mf ko if no b fv ns nt l nu nv">var population = document.createAttribute("population");<br/>          var direction = document.createAttribute("direction");<br/>          var isWater = document.createAttribute("isWater");</span></pre><p id="b0d7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的元素可能看起来像这样:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="a76b" class="mf ko if no b fv ns nt l nu nv">&lt;div id="2554" population="5" direction="northeast" isWater="notWater" type="button" class="btn"&gt;&lt;/div&gt;</span></pre><p id="3ddf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们不想对每个div进行硬编码，所以我们将在一个循环中进行。</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="6e87" class="mf ko if no b fv ns nt l nu nv">var directionArray = ['n', 'ne', 'e', 'se', 's', 'sw', 'w', 'nw'];<br/>          for (var i = 0; i &lt; data.length; i++) {<br/>                population.value = data[i].population;  <br/>                direction1 = directionArray[Math.floor(Math.random() * directionArray.length)];<br/>                var inputBtn = `<br/>                &lt;div id="${i}" population="${data[i].population}" direction="${direction1}" isWater="${data[i].water}" type="button" class="btn"&gt;&lt;/div&gt;<br/>                `;<br/>                $('#body').append(inputBtn);<br/>          }</span></pre><p id="a4ce" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">同样，希望我们已经注释掉了用于创建数据图的JavaScript，但是这段代码看起来与我们之前所做的非常相似。最初，当我们在这个项目的第一部分，我们使用JavaScript来创建我们的HTML divs，每个div是空白的。现在，在我们的for循环中，我们还在将元素附加到#body之前为每个元素分配属性。</p><p id="3e08" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为僵尸无论如何经常行为不规律，所以我要随机设置他们的初始行进方向。以下是我们稍后如何确定僵尸的方向:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div class="fe ff nz"><img src="../Images/43d8364ddfd9a79b28339a9ef9ea2fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*5pX1Eq1-Khr4kOnan2NTIA.png"/></div></figure><h1 id="1b0a" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">实施区间— — — — — —</h1><p id="331b" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">如果一个特定的块被感染，如上所示，并且该块是div # 456，那么从它的当前位置有8个可能的方向:n、ne、e、se、s、sw、w、nw。如果我们把这些div看作一个数组，那么东的方向就是当前位置+ 1。西方将是目前的位置-1。“北”和“南”取决于每行中元素的数量。在我的例子中，北方是-255，南方是+ 255，以此类推。如果在任何给定的时间间隔，当前被感染的块不在人口密集的区域，那么它将移动到新的块。现在，如果我们在这一点上什么都不做，僵尸的方向已经为每个街区设置好了。在每个间隔，我们可以检查给定块的方向，然后将它移动到新的相应空间。然而，让我们想象我们这样做了，并且当前块具有方向‘ne’。下面是每个间隔的样子:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff oa"><img src="../Images/5c3571dbc195cd3bd5efd9e976b7da2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nyyVTW_2tfv0NSHkuy_dnA.png"/></div></div></figure><p id="84bc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">显然，我们可能想随机化一点。回到我们之前谈到的区间，我们需要在每个区间做出以下决定:它移动的方向，移动的速度，以及它是否会感染任何人。我们的逻辑可能是这样的:</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ob"><img src="../Images/16e0587054a5ed65d86a08b6f627e271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2oIWci9Fhwj5ivG6Qnz5g.png"/></div></div></figure><p id="ab91" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们有了一些伪代码，这是一些实际的代码。我们将从onClick事件开始，它将是第一个触发所有其他事件的事件:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="779e" class="mf ko if no b fv ns nt l nu nv">$('body').on('click', '.btn', function () {<br/>            let color9 = colorArr[Math.floor(Math.random() * colorArr.length)];<br/>            $(this).attr('isActive', 1);<br/>            $(this).removeClass('btn');<br/>            $(this).addClass('active');<br/>            $('.btn').click(false);<br/>      <br/>          });</span></pre><p id="7416" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击时，我们删除btn类，禁用任何其他按钮点击，并添加active类。现在，当我们得到我们的setInterval函数时，它将获得这个块。接下来，我将创建一个由1和0两个元素组成的数组:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="26bf" class="mf ko if no b fv ns nt l nu nv">var changeArr = [0,1];</span></pre><p id="2877" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我们的set interval函数中，每次它找到一个方块，我们就像掷硬币一样，从这两个数字中随机选择一个。如果我们得到1，我们将改变当前块的方向属性。如果我们得到0，我们将保持相同的方向。</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="d6c4" class="mf ko if no b fv ns nt l nu nv">setInterval(function(){ <br/>            var buttons = $( ".active" ).toArray();</span></pre><p id="420a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在setInterval函数中，我们要做的第一件事是获取所有活动按钮的数组。一开始，只会有一个。</p><p id="2885" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们将得到所有相邻的按钮，并把它们放在一个数组中。这些按钮将是我们的方向按钮，北，南，东，西等…</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="0e38" class="mf ko if no b fv ns nt l nu nv">var currentID = $(buttons[i]).attr('id');<br/>                var id1 = parseInt(currentID)+1;<br/>                var id2 = parseInt(currentID)+254;<br/>                var id3 = parseInt(currentID)+255;<br/>                var id4 = parseInt(currentID)+256;<br/>                var id5 = currentID-1;<br/>                var id6 = currentID-254;<br/>                var id7 = currentID-255;<br/>                var id8 = currentID-256;<br/>                var adjacentbuttons = [$('#'+id1+''),$('#'+id5+''),$('#'+id7+''),$('#'+id8+''),$('#'+id6+''),$('#'+id3+''),$('#'+id4+''),$('#'+id2+'')];</span></pre><p id="7c28" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，如果人口密度超过10:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="cfd1" class="mf ko if no b fv ns nt l nu nv">if($(buttons[i]).attr('population') &gt;= 10){<br/>                  $(adjacentbuttons[2]).attr('isActive', 1);<br/>                  $(adjacentbuttons[2]).removeClass('btn');<br/>                  $(adjacentbuttons[2]).addClass('active');<br/>                  $(adjacentbuttons[4]).attr('isActive', 1);<br/>                  $(adjacentbuttons[4]).removeClass('btn');<br/>                  $(adjacentbuttons[4]).addClass('active');<br/>                  $(adjacentbuttons[0]).attr('isActive', 1);<br/>                  $(adjacentbuttons[0]).removeClass('btn');<br/>                  $(adjacentbuttons[0]).addClass('active');<br/>                  $(adjacentbuttons[6]).attr('isActive', 1);<br/>                  $(adjacentbuttons[6]).removeClass('btn');<br/>                  $(adjacentbuttons[6]).addClass('active');<br/>                  $(adjacentbuttons[5]).attr('isActive', 1);<br/>                  $(adjacentbuttons[5]).removeClass('btn');<br/>                  $(adjacentbuttons[5]).addClass('active');<br/>                  $(adjacentbuttons[1]).attr('isActive', 1);<br/>                  $(adjacentbuttons[1]).removeClass('btn');<br/>                  $(adjacentbuttons[1]).addClass('active');<br/>                  $(adjacentbuttons[3]).attr('isActive', 1);<br/>                  $(adjacentbuttons[3]).removeClass('btn');<br/>                  $(adjacentbuttons[3]).addClass('active');<br/>      <br/>                }</span></pre><p id="362e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们基本上是从阵列中选择几个，然后将它们全部激活。本质上，如果它跌跌撞撞地进入一个人口密集的地区，它会感染许多其他邻近的街区。我们也可以为其他密度添加逻辑。例如:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="a0f3" class="mf ko if no b fv ns nt l nu nv">else if($(buttons[i]).attr('population') == 3){<br/>                  $(adjacentbuttons[7]).attr('isActive', 1);<br/>                  $(adjacentbuttons[7]).removeClass('btn');<br/>                  $(adjacentbuttons[7]).addClass('active');<br/>                }</span></pre><p id="72af" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果密度只有3，我们只感染另外一个相邻的区块。</p><h1 id="f86c" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">方向— — — — — —</h1><p id="7074" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">以下是我对每个方向使用的逻辑:</p><pre class="kc kd ke kf fq nn no np nq aw nr dt"><span id="b80e" class="mf ko if no b fv ns nt l nu nv">if($(buttons[i]).attr('direction') == 'n'){<br/>                  let change = changeArr[Math.floor(Math.random() * changeArr.length)];<br/>                  if (change == 0){<br/>                    $(buttons[i]).attr('isActive', 0);<br/>                    $(adjacentbuttons[2]).attr('isActive', 1);<br/>                    $(adjacentbuttons[2]).attr('direction', 'n');<br/>                    $(adjacentbuttons[2]).removeClass('btn');<br/>                    $(adjacentbuttons[2]).addClass('active');<br/>                    $(buttons[i]).removeClass('active');<br/>                    $(buttons[i]).addClass('btn');<br/>                  }<br/>                  else if (change == 1 &amp;&amp; $(buttons[i]).attr('isWater') != 1){<br/>                  let newDirection = directionArray[Math.floor(Math.random() * directionArray.length)];<br/>                    $(buttons[i]).attr('isActive', 0);<br/>                    $(adjacentbuttons[2]).attr('isActive', 1);<br/>                    $(adjacentbuttons[2]).attr('direction', newDirection);<br/>                    $(adjacentbuttons[2]).removeClass('btn');<br/>                    $(adjacentbuttons[2]).addClass('active');<br/>                    $(buttons[i]).removeClass('active');<br/>                    $(buttons[i]).addClass('btn');<br/>                  }<br/>                  else if ($(buttons[i]).attr('isWater') == 1){<br/>                    $(buttons[i]).removeClass('active');<br/>                    $(buttons[i]).addClass('btn');<br/>                  }<br/>      <br/>                }</span></pre><p id="7d8a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">基本上在这里，我在每个区间寻找三样东西。</p><p id="4cb2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我从选择数组中随机选择一个。</p><p id="9567" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2 —那么方向改变了吗？如果没有，我就把它送走。</p><p id="a79f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3 —如果方向改变了，我从方向数组中随机选择一个新方向，并将其作为新方向。</p><p id="f702" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4 —除非是水…然后我将按钮设置回“btn ”,而不是“active”</p><h1 id="1065" class="kn ko if bd kp kq ne ks kt ku nf kw kx ky ng la lb lc nh le lf lg ni li lj lk dt translated">总之:</h1><p id="0d80" class="pw-post-body-paragraph jc jd if je b jf ll jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv lp jx jy jz hn dt translated">老实说，这是相当简单的，也是非常基本的。然而，你可以用它做更多的事情。即使在这个例子中，我们也可以包括关于海拔的数据，我们还没有这样做。我们可以包括所有其他种类的数据。如果你正在寻找一种有趣的方式来创建一个快速，互动的地图，我希望这有所帮助。我最担心的是setInterval是一种非常耗费资源的处理方式，我相信有一个更好的解决方案。如果您有任何想法或其他反馈，请随时分享。谢谢！</p></div></div>    
</body>
</html>