<html>
<head>
<title>Complete Guide: Receive Push Notifications in React-Native iOS app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">完整指南:在React-Native iOS应用程序中接收推送通知</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/complete-guide-receive-push-notifications-in-react-native-ios-app-38b1ec5b1b15?source=collection_archive---------2-----------------------#2018-11-12">https://medium.com/hackernoon/complete-guide-receive-push-notifications-in-react-native-ios-app-38b1ec5b1b15?source=collection_archive---------2-----------------------#2018-11-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/1d79a925ac8e990c5f0c5dccac717717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WjaauEtQJxj-cEmlUm47qQ.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Image from <a class="ae jg" href="https://onesignal.com/blog/ios-12-and-onesignal/" rel="noopener ugc nofollow" target="_blank">OneSignal</a></figcaption></figure><blockquote class="jh ji jj"><p id="32bd" class="jk jl jm jn b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki hn dt translated">App发布商可以随时发送推送通知；用户不必在应用程序中或使用他们的设备来接收它们。他们可以做很多事情；例如，它们可以显示最新的体育比分，让用户采取行动，如下载优惠券，或让用户了解某个事件，如闪购。(由城市协会提供)</p></blockquote><p id="30fd" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">在你的应用中添加推送通知不仅是改善用户体验的好方法。如果使用得当，它还有助于:</p><ul class=""><li id="d7aa" class="km kn hu jn b jo jp js jt kj ko kk kp kl kq ki kr ks kt ku dt translated">刺激用户参与</li><li id="baf2" class="km kn hu jn b jo kv js kw kj kx kk ky kl kz ki kr ks kt ku dt translated">留住用户</li><li id="db69" class="km kn hu jn b jo kv js kw kj kx kk ky kl kz ki kr ks kt ku dt translated">提高转化率</li></ul><p id="3d22" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">最近，我们的团队为React-Native iOS应用程序实现了推送通知。</p><blockquote class="la"><p id="3d39" class="lb lc hu bd ld le lf lg lh li lj ki ek translated">我们花了几天时间让它完全适用于大多数常见场景。这篇文章的目标是为你节省时间。</p></blockquote><figure class="ll lm ln lo lp iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lk"><img src="../Images/787821befd3edfd03cf19bc76861c52e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RC5Ahc9Lj2LHrTWTQ8XxVQ.png"/></div></div></figure><blockquote class="jh ji jj"><p id="5706" class="jk jl jm jn b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki hn dt translated"><em class="hu">苹果推送通知服务</em> (APNs)是远程通知功能的核心。它是应用开发者向iOS设备传播信息的服务。</p></blockquote><p id="702e" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">在上面的方案中，应用程序后端开发人员被指定为<strong class="jn hv">提供者</strong>。我们使用APN向目标设备传播通知。要实现它，我们需要征得用户的同意。当用户允许权限请求时，手机应用程序会在APN上订阅通知。结果，APN向客户端发送一个<em class="jm">唯一设备令牌</em>。</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lq"><img src="../Images/b5fe6a2fff0259b0acfe11a6242a0fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JiZpxxe6lMeIbCzyCLWIGw.png"/></div></div></figure><p id="fa28" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">现在，这个令牌必须被传输到后端并被存储。当后端决定发送推送通知时，它应该将这个令牌传递给APN。</p></div><div class="ab cl lv lw hc lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hn ho hp hq hr"><p id="7ca1" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">在本文中，我们在React-Native iOS应用程序(RN 0.57)中实现了推送通知的发送和处理</p><h1 id="1fb7" class="mc md hu bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz dt translated">第一部分:移动应用</h1><p id="dc06" class="pw-post-body-paragraph jk jl hu jn b jo na jq jr js nb ju jv kj nc jy jz kk nd kc kd kl ne kg kh ki hn dt translated">我们当前的项目是用本机代码构建的，使用的是<code class="eh nf ng nh ni b">react-native init</code>命令。虽然这些说明可能适用于<strong class="jn hv">推出的</strong> Expo项目。我们使用来自<a class="ae jg" href="https://facebook.github.io/react-native/docs/pushnotificationios" rel="noopener ugc nofollow" target="_blank">官方RN API </a>的<strong class="jn hv"> PushNotificationIOS </strong>包。</p><h2 id="3e12" class="nj md hu bd me nk nl nm mi nn no np mm kj nq nr mq kk ns nt mu kl nu nv my nw dt translated">步骤1:手动链接PushNoficationIOS库</h2><p id="fe0a" class="pw-post-body-paragraph jk jl hu jn b jo na jq jr js nb ju jv kj nc jy jz kk nd kc kd kl ne kg kh ki hn dt translated">关于正式文件，您需要:</p><ol class=""><li id="d3c0" class="km kn hu jn b jo jp js jt kj ko kk kp kl kq ki nx ks kt ku dt translated">找到<code class="eh nf ng nh ni b">node_modules/react-native/Libraries/PushNotificationIOS/RCTPushNotification.xcodeproj</code></li></ol><p id="6063" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">2.将这个文件拖到Xcode上的项目中(通常在Xcode上的<code class="eh nf ng nh ni b">Libraries</code>组下)</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ny"><img src="../Images/a42ca4bfd7ac47bfaee0aa7cb1a2e476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dhz5XNvhhB0PBFy-nlIEVw.png"/></div></div></figure><p id="5498" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">3.点击您的主项目文件(代表<code class="eh nf ng nh ni b">.xcodeproj</code>的文件)，选择<code class="eh nf ng nh ni b">Build Phases</code>并将静态库从您正在导入的库内的<code class="eh nf ng nh ni b">Products</code>文件夹拖到<code class="eh nf ng nh ni b">Link Binary With Libraries</code></p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ny"><img src="../Images/9dc9cf1eb3608a5110f972698ab4649f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jKATFQJDicaopgOL8y-kZQ.png"/></div></div></figure><h2 id="0066" class="nj md hu bd me nk nl nm mi nn no np mm kj nq nr mq kk ns nt mu kl nu nv my nw dt translated">步骤2:扩充AppDelegate内容</h2><p id="e4d7" class="pw-post-body-paragraph jk jl hu jn b jo na jq jr js nb ju jv kj nc jy jz kk nd kc kd kl ne kg kh ki hn dt translated">在你的上方<code class="eh nf ng nh ni b">AppDelegate.m</code> : <br/> <code class="eh nf ng nh ni b">#import &lt;React/RCTPushNotificationManager.h&gt;</code></p><p id="a40a" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">然后在<code class="eh nf ng nh ni b">AppDelegate.m</code>实现中添加以下内容:</p><figure class="lr ls lt lu fq iv"><div class="bz el l di"><div class="nz oa l"/></div></figure><h2 id="8844" class="nj md hu bd me nk nl nm mi nn no np mm kj nq nr mq kk ns nt mu kl nu nv my nw dt translated">步骤3:调整Xcode项目设置</h2><p id="d537" class="pw-post-body-paragraph jk jl hu jn b jo na jq jr js nb ju jv kj nc jy jz kk nd kc kd kl ne kg kh ki hn dt translated">在设置Xcode中打开项目，选择功能设置</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ob"><img src="../Images/fa4472fc38a9def6984337afe7c2c41b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZG_CdQK68LX4iRopJMdQqA.png"/></div></div></figure><h2 id="20d8" class="nj md hu bd me nk nl nm mi nn no np mm kj nq nr mq kk ns nt mu kl nu nv my nw dt translated">第四步:最后写点代码:)</h2><figure class="lr ls lt lu fq iv"><div class="bz el l di"><div class="nz oa l"/></div></figure><p id="db97" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated"><strong class="jn hv">该组件处理应用打开或关闭时收到的所有推送通知。<br/> </strong>现在你可以将<code class="eh nf ng nh ni b">&lt;PushNotificationHandler /&gt;</code>放入你的应用的根组件中，以确保它会在应用启动时被挂载。</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><a href="https://calendly.com/oleg-kalyta/30min"><div class="fe ff oc"><img src="../Images/5491b85ab8a637c82385f2a42e9a9bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8IxRX6KgxGcUIceWUyzbw.png"/></div></a></figure><h1 id="02e1" class="mc md hu bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz dt translated">第二部分:服务器端</h1><p id="04eb" class="pw-post-body-paragraph jk jl hu jn b jo na jq jr js nb ju jv kj nc jy jz kk nd kc kd kl ne kg kh ki hn dt translated">要求:你应该有一个有效的<a class="ae jg" href="https://developer.apple.com/programs/" rel="noopener ugc nofollow" target="_blank">苹果开发者计划会员</a> (100美元/年)。</p><h2 id="c4cd" class="nj md hu bd me nk nl nm mi nn no np mm kj nq nr mq kk ns nt mu kl nu nv my nw dt translated">步骤1:确保正确的包标识符</h2><p id="8a03" class="pw-post-body-paragraph jk jl hu jn b jo na jq jr js nb ju jv kj nc jy jz kk nd kc kd kl ne kg kh ki hn dt translated">检查XCode/通用项目设置中的捆绑包标识符是否与Apple Store Connect/App信息中的标识符相同</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff od"><img src="../Images/a4aa906b6c69eb8f17bc67f8ea843586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v30L_b57YxVtvbouv_xhOA.png"/></div></div></figure><h2 id="4f45" class="nj md hu bd me nk nl nm mi nn no np mm kj nq nr mq kk ns nt mu kl nu nv my nw dt translated">步骤2:生成APNs授权密钥</h2><p id="d4df" class="pw-post-body-paragraph jk jl hu jn b jo na jq jr js nb ju jv kj nc jy jz kk nd kc kd kl ne kg kh ki hn dt translated">要使用APN，您需要创建并使用应用程序密钥进行授权。<br/>在你的苹果开发者账户中，打开<a class="ae jg" href="https://developer.apple.com/account/ios/authkey/" rel="noopener ugc nofollow" target="_blank">键</a>:</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff oe"><img src="../Images/b3b1edcacd7b625b3dee09fbfe4ae315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6IdH5tvLGPLVDhDAms0wBw.png"/></div></div></figure><p id="f6af" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">点击<code class="eh nf ng nh ni b">+</code>图标</p><p id="efe8" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">在下一页中，输入您的密钥名称，启用<strong class="jn hv"> APNs </strong>并点击页面底部的<strong class="jn hv">继续</strong>。</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff of"><img src="../Images/f87265bb7bba739d3e1f5d2c2042468c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qoBI9lfJN5NvjmUZrr1_ZQ.png"/></div></div></figure><p id="532d" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">Apple将生成一个包含您的APNs Auth密钥的<code class="eh nf ng nh ni b">.p8</code>密钥文件。</p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div class="fe ff og"><img src="../Images/ede78c2d25e33c4e9d3046e82c563244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*soa70uB8Ix3-qB8z8KRCBA.png"/></div></figure><p id="095a" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">保存<strong class="jn hv">密钥ID </strong>，您将在下一步需要它。</p><p id="f7ac" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">现在，点击Certificates/All，下载带有<code class="eh nf ng nh ni b">.cer</code>扩展名的证书。将该文件另存为<code class="eh nf ng nh ni b">ios_development.cer</code>并放入repo的根文件夹。</p><p id="523a" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">同时找到并保存<strong class="jn hv">团队ID。要获得它，请登录<a class="ae jg" href="http://developer.apple.com" rel="noopener ugc nofollow" target="_blank">developer.apple.com</a>。在右上角点击您姓名下的&gt;查看账户。</strong></p><figure class="lr ls lt lu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff oh"><img src="../Images/52823836d2d3590a0f157364d07c31c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3CAve36lLokcN_ULR-mYtw.png"/></div></div></figure><h2 id="05df" class="nj md hu bd me nk nl nm mi nn no np mm kj nq nr mq kk ns nt mu kl nu nv my nw dt translated">步骤3:发送推送通知</h2><p id="f393" class="pw-post-body-paragraph jk jl hu jn b jo na jq jr js nb ju jv kj nc jy jz kk nd kc kd kl ne kg kh ki hn dt translated">在示例回购中，您会发现<code class="eh nf ng nh ni b">pushServer.js</code>。<br/>用params: <br/> <code class="eh nf ng nh ni b">node pushServer.js keyId teamId token appId message</code>启动</p><p id="166c" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">文章的免费回购:</p><div class="oi oj fm fo ok ol"><a href="https://github.com/ProductCrafters/react-native-ios-push-notifications-example" rel="noopener  ugc nofollow" target="_blank"><div class="om ab ej"><div class="on ab oo cl cj op"><h2 class="bd hv fv z el oq eo ep or er et ht dt translated">product crafters/react-native-IOs-push-notifications-示例</h2><div class="os l"><h3 class="bd b fv z el oq eo ep or er et ek translated">在React-Native上发送和接收推送通知的示例iOS应用程序和服务器脚本</h3></div><div class="ot l"><p class="bd b gc z el oq eo ep or er et ek translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz ja ol"/></div></div></a></div></div><div class="ab cl lv lw hc lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hn ho hp hq hr"><p id="665f" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">用过的文章:<br/><a class="ae jg" href="https://eladnava.com/send-push-notifications-to-ios-devices-using-xcode-8-and-swift-3/" rel="noopener ugc nofollow" target="_blank">https://eladnava . com/send-push-notifications-to-IOs-devices-using-xcode-8-and-swift-3/</a></p><p id="e84e" class="pw-post-body-paragraph jk jl hu jn b jo jp jq jr js jt ju jv kj jx jy jz kk kb kc kd kl kf kg kh ki hn dt translated">🚀<a class="ae jg" href="http://productcrafters.io" rel="noopener ugc nofollow" target="_blank">我的团队</a> <strong class="jn hv">使用JS和React和React Native构建生产应用，历时3年</strong>。我们帮助初创公司的创始人将他们的想法付诸实践。如果你需要帮助，发消息给✉️<a class="ae jg" href="mailto:oleg@productcrafters.io" rel="noopener ugc nofollow" target="_blank">Oleg @ product crafters . io</a></p><figure class="lr ls lt lu fq iv"><div class="bz el l di"><div class="pa oa l"/></div></figure></div></div>    
</body>
</html>