<html>
<head>
<title>Compile Solidity Smart Contracts Faster in Truffle Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在块菌项目中更快地编译Solidity智能合同</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/compile-solidity-smart-contracts-faster-in-truffle-projects-eb8bebb61ec3?source=collection_archive---------6-----------------------#2018-11-15">https://medium.com/hackernoon/compile-solidity-smart-contracts-faster-in-truffle-projects-eb8bebb61ec3?source=collection_archive---------6-----------------------#2018-11-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/e285527841e95589c033f80bd8f6b91f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ILz-SxRepR6q7dDivvN_PQ.png"/></div></div></figure><p id="d68e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Truffle套件是Solidity开发中使用最广泛的开发框架，但它并不完美。我们在<a class="ae ka" href="https://polymath.network/" rel="noopener ugc nofollow" target="_blank">的博学者</a>，处理大量相互关联的智能合约。智能合同的数量之多导致我的日常驱动程序编译时间超过80秒。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/aec71f11f37aec876abee8facb40ab53.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*k34z4hais1ayUiUi2JBfNA.png"/></div><figcaption class="kg kh fg fe ff ki kj bd b be z ek">And adding more contracts everyday :)</figcaption></figure><p id="12a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">幸运的是，我们可以加快编译速度。</p><p id="cfa8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Truffle在默认情况下使用solc.js，而不是本机二进制文件来编译智能合约。solc.js提供了更好的可移植性，但是比本地编译的二进制文件要慢得多。</p><p id="49f9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可能会问，原生二进制文件的速度有多快？我设法将<a class="ae ka" href="https://github.com/PolymathNetwork/polymath-core" rel="noopener ugc nofollow" target="_blank"> Polymath-core的</a>编译时间从80秒减少到不到15秒！</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kk"><img src="../Images/29015917d91f0bf5ccf3dadce44f370f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/0*pw2kjhMCzKfpQb7B.jpg"/></div><figcaption class="kg kh fg fe ff ki kj bd b be z ek">It’s that fast!</figcaption></figure><p id="aae6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为什么大家都还没有使用原生二进制？管理原生二进制文件特别是当你需要在不同的项目中使用不同版本的Solidity是很困难的，但是不要担心，我们可以很容易地使用docker镜像作为一个很好的替代解决方案。我会指导你完成这个过程。</p><p id="0aa7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">松露4。x不允许我们设置自定义编译器，但是Truffle 5。x支持这个特性。然而松露5。x使用Web3 1。x而松露4。x使用Web3 0。这使得迁移到松露5。x更用力。我们实际上不需要完全迁移到松露5。只是为了获得更快的编译速度。我将展示我们如何继续使用松露4。x用于使用Truffle 5时的测试和迁移。为了更快的编译。</p><p id="e7ad" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们从设置Truffle 5.X开始，稍后，我将解释我们如何使用Truffle 5。x连同4。x获得两个世界的最佳。</p><h1 id="ba0a" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">设置Truffle为solc使用Docker映像</h1><ol class=""><li id="9690" class="lj lk hu je b jf ll jj lm jn ln jr lo jv lp jz lq lr ls lt dt translated">首先，你需要安装Docker。最简单的方法是按照<a class="ae ka" href="https://docs.docker.com/install/#supported-platforms" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/install/#supported-platforms</a>上的说明</li><li id="5b70" class="lj lk hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">您需要通过使用以下命令来提取想要使用的docker映像:</li></ol><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="dea7" class="me km hu ma b fv mf mg l mh mi">docker pull ethereum/solc:0.4.25</span></pre><p id="8ccf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用您需要的版本替换solc版本。</p><p id="0401" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.前往项目的根目录，安装truffle 5。x使用:</p><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="79ef" class="me km hu ma b fv mf mg l mh mi">npm install truffle@next</span></pre><p id="1991" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.编辑您的truffle配置(位于项目的根目录中)以指定要使用的solidity版本。要使用docker图像，您需要添加:</p><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="df16" class="me km hu ma b fv mf mg l mh mi">compilers: {<br/>  solc: {<br/>    version: "0.4.25",   // Change this to whatever you need<br/>    docker: true,<br/>  }<br/>}</span></pre><p id="f1f5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您的truffle配置文件应该类似于</p><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="15ca" class="me km hu ma b fv mf mg l mh mi">module.exports = {<br/>  networks: {<br/>    development: {<br/>      host: 'localhost',<br/>      port: 8545,<br/>      network_id: '*' <br/>    },<br/>  },<br/>  compilers: {<br/>    solc: {<br/>      version: "0.4.25",  <br/>      docker: true,<br/>      settings: {<br/>        optimizer: {<br/>          enabled: true, <br/>          runs: 200    <br/>        }<br/>      }<br/>    }<br/>  },<br/>  mocha: {<br/>    enableTimeouts: false<br/>  }<br/>};</span></pre><p id="7127" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.通过执行以下命令，试用新的快速编译器:</p><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="089d" class="me km hu ma b fv mf mg l mh mi">./node_modules/.bin/truffle compile</span></pre><p id="15d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">奖励</strong>:为了使命令更短，将其添加到package.json中的脚本下，如下所示:</p><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="220f" class="me km hu ma b fv mf mg l mh mi">"scripts": {<br/>    "compile": "node_modules/.bin/truffle compile"<br/>}</span></pre><p id="aa81" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，您可以通过运行以下命令来直接使用该命令</p><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="3ac5" class="me km hu ma b fv mf mg l mh mi">npm run compile</span></pre><p id="6fb1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">注意</strong>:我们不会直接调用<code class="eh mj mk ml ma b">truffle compile</code>，因为我们将在全球范围内安装Truffle 4.x。如果你想使用Truffle 5.x，那么你可以全局安装，直接使用Truffle命令</p><h1 id="72ec" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">用松露4号。x连同松露5。X</h1><ol class=""><li id="3c86" class="lj lk hu je b jf ll jj lm jn ln jr lo jv lp jz lq lr ls lt dt translated">安装松露4。x全局使用</li></ol><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="3d94" class="me km hu ma b fv mf mg l mh mi">npm install truffle -g</span></pre><p id="911b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.在truffle测试/迁移命令之前运行<code class="eh mj mk ml ma b">./node_modules/.bin/truffle compile</code>或<code class="eh mj mk ml ma b">npm run compile</code>,这样你可以享受更快的编译。</p><p id="85da" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.正常使用truffle命令。例如，要运行测试，请使用:</p><pre class="kc kd ke kf fq lz ma mb mc aw md dt"><span id="95af" class="me km hu ma b fv mf mg l mh mi">truffle test</span></pre><p id="601f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面的命令将使用Truffle 4运行测试。因为它是全球安装的。</p><p id="ea47" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">注意</strong>:在本文中，我使用的是*nix系统支持的路径。如果您使用的是windows，将路径中的<code class="eh mj mk ml ma b">/</code>替换为<code class="eh mj mk ml ma b">\\</code>，并根据需要进行其他相关更改。另外，考虑双引导Linux系统进行开发:)</p><h1 id="f2e3" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">最后的想法</h1><p id="906b" class="pw-post-body-paragraph jc jd hu je b jf ll jh ji jj lm jl jm jn mm jp jq jr mn jt ju jv mo jx jy jz hn dt translated">Solc.js慢而严肃，而原生二进制快而狂暴！也许结合使用Truffle stable和beta是确保稳定性、特性和速度的最佳方式。</p><p id="5846" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你需要任何帮助，欢迎在这里发表评论或在<a class="ae ka" href="https://gitter.im/ConsenSys/truffle" rel="noopener ugc nofollow" target="_blank">松露的Gitter </a>频道提问。如果你有兴趣加入我在Polymath的工作，请通过我们的<a class="ae ka" href="https://polymath.bamboohr.com/jobs/" rel="noopener ugc nofollow" target="_blank">网站</a>申请。</p></div></div>    
</body>
</html>