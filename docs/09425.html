<html>
<head>
<title>Stripe API, ReactJS, and Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">条带API、ReactJS和Express</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/stripe-api-reactjs-and-express-bc446bf08301?source=collection_archive---------0-----------------------#2018-11-17">https://medium.com/hackernoon/stripe-api-reactjs-and-express-bc446bf08301?source=collection_archive---------0-----------------------#2018-11-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/b568f57ad2837f0aff184fabda120db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3TYu5VrTLKh0cqY0CHZYw.jpeg"/></div></div></figure><blockquote class="jc jd je"><p id="6329" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">* *对条带检出进行了更改。这篇文章正在更新中。感谢您的耐心！** </strong></p></blockquote><p id="9bf8" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">我在<a class="ae kh" href="https://mbsy.co/lambdaschool/43054350" rel="noopener ugc nofollow" target="_blank"> Lambda School </a>(一个为期30周的沉浸式全栈web开发和CS项目)期间，接触了从HTML/CSS、<a class="ae kh" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> Javascript </a>、ReactJS、ExpressJS、API、Python、Django、C等等的一切。我学习并探索了计算机科学的主题，如数据结构、算法和时间复杂性。然而，我想谈论并提供指导的特定主题是我在Lambda实验室项目中遇到的一个任务。将Stripe Checkout与一个<a class="ae kh" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank"> React </a>客户机和一个Express/Node服务器集成在一起。</p><p id="f3c7" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">使用Stripe Checkout时，有两种方式可供选择，一次性付费或订阅付费。我今天会支付一次性费用。如果您对订阅费用感兴趣，我将在以后的文章中介绍这一点。在我们开始编码之前，您需要完成一个步骤。创建一个<a class="ae kh" href="https://stripe.com/" rel="noopener ugc nofollow" target="_blank">条带</a>账户。这是一个免费的帐户，可以很快建立起来。我会在这里等你去准备。回到你的仪表板前。</p><figure class="kj kk kl km fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ki"><img src="../Images/fb63fe0315f43b714bdfb697abc364da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hw6R60RZqLstVzCSIaeiJw.png"/></div></div></figure><p id="cbd9" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">太好了，现在你应该有一个Stripe帐户了。请注意，仪表板处于测试模式。把它放在这里，直到把你的项目投入生产的时候。现在让我们开始编码。</p><h1 id="9ecb" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">前端/客户端</h1><h2 id="910c" class="ll ko hu bd kp lm ln lo kt lp lq lr kx ke ls lt lb kf lu lv lf kg lw lx lj ly dt translated">设置</h2><p id="9122" class="pw-post-body-paragraph jf jg hu ji b jj lz jl jm jn ma jp jq ke mb jt ju kf mc jx jy kg md kb kc kd hn dt translated">让我们从创建客户机开始。我将使用create-react-app来样板化我们的react应用程序。在您的终端中使用以下命令进行设置。</p><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="f3b6" class="ll ko hu mf b fv mj mk l ml mm">create-react-app stripe-client<br/>cd stripe-client<br/>yarn start</span></pre><p id="3de1" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">现在，您应该有一个开发服务器在您的终端上运行，并且能够在新的浏览器窗口中查看您的客户机。当您对应用程序进行更改并保存时，浏览器中的客户端将自动刷新。接下来，我们需要添加所有的库。在新终端中，使用以下命令安装库。</p><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="5d9c" class="ll ko hu mf b fv mj mk l ml mm">yarn add react-stripe-checkout axios</span></pre><p id="bae6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">接下来让我们创建一个<code class="eh mn mo mp mf b">stripeBtn</code>组件。该组件将是一个按钮，单击该按钮将打开反应条纹结帐模式。请遵循以下步骤。</p><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="b3bc" class="ll ko hu mf b fv mj mk l ml mm">cd src<br/>touch stripeBtn.js</span></pre><h2 id="71e8" class="ll ko hu bd kp lm ln lo kt lp lq lr kx ke ls lt lb kf lu lv lf kg lw lx lj ly dt translated">创建反应组件</h2><p id="8803" class="pw-post-body-paragraph jf jg hu ji b jj lz jl jm jn ma jp jq ke mb jt ju kf mc jx jy kg md kb kc kd hn dt translated">现在，将该组件的以下代码复制并粘贴到新文件夹中，我们将在下面讨论细节。</p><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="ac72" class="ll ko hu mf b fv mj mk l ml mm">import React, { Fragment } from "react";<br/>import StripeCheckout from "react-stripe-checkout";<br/>import axios from "axios";</span><span id="aec1" class="ll ko hu mf b fv mq mk l ml mm">const stripeBtn = () =&gt; {<br/>  const publishableKey = "pk_test_ZU3mlTy0q00DATc9EyF9A8jX";<br/>   <br/>  const onToken = token =&gt; {<br/>    const body = {<br/>      amount: 999,<br/>      token: token<br/>  };</span><span id="9a3c" class="ll ko hu mf b fv mq mk l ml mm">  axios<br/>      .post("http://localhost:8000/payment", body)<br/>      .then(response =&gt; {<br/>        console.log(response);<br/>        alert("Payment Success");<br/>      })<br/>      .catch(error =&gt; {<br/>        console.log("Payment Error: ", error);<br/>        alert("Payment Error");<br/>      });<br/>  };</span><span id="3fa8" class="ll ko hu mf b fv mq mk l ml mm">  return (<br/>    &lt;StripeCheckout<br/>      <em class="jh">label</em>="Go Premium" <em class="jh">//Component button text<br/>      name</em>="Business LLC" <em class="jh">//Modal Header<br/>      description</em>="Upgrade to a premium account today."<em class="jh"><br/>      panelLabel</em>="Go Premium" <em class="jh">//Submit button in modal<br/>      amount</em>={999} <em class="jh">//Amount in cents $9.99<br/>      token</em>={onToken}<br/>      <em class="jh">stripeKey</em>={publishableKey}<br/>      image="https://www.vidhub.co" //Pop-in header image<br/>      billingAddress={false}<br/>    /&gt;<br/>  );<br/>};</span><span id="a2b5" class="ll ko hu mf b fv mq mk l ml mm">export default stripeBtn;</span></pre><p id="a252" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">回顾我们在上面所做的。我们创建一个变量来保存我们的可发布密钥。你从仪表板上看到的。从边栏点击开发者&gt; API密匙。这个密钥不是秘密，不需要放在。环境文件。我们有一个函数<code class="eh mn mo mp mf b">onToken()</code>,一会儿会讲到。组件返回一个来自<code class="eh mn mo mp mf b">react-stripe-checkout</code>的<code class="eh mn mo mp mf b">StripeCheckout</code>元素。传递的属性用于定制模态和其他事务细节。确保你包括道具<code class="eh mn mo mp mf b">stripeKey.</code></p><p id="b1c1" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated"><code class="eh mn mo mp mf b">onToken()</code>函数“幕后”将卡信息发送给Stripe并返回一个令牌对象。该对象包含有关交易的有限细节(卡类型、最后4位数字、电子邮件等。)我们的函数通过axios请求将这个令牌和金额发送到我们的后端，以完成交易。差不多就是这样。由于React是模块化的，我们可以在应用程序的多个位置导入组件。我包含了下面的<code class="eh mn mo mp mf b">App.js</code>代码，在这里我将导入并呈现我们的<code class="eh mn mo mp mf b">stripeBtn</code>组件。</p><h2 id="59b6" class="ll ko hu bd kp lm ln lo kt lp lq lr kx ke ls lt lb kf lu lv lf kg lw lx lj ly dt translated">最终步骤和最终确定</h2><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="9972" class="ll ko hu mf b fv mj mk l ml mm">import React, { Component } from "react";<br/>import logo from "./logo.svg";<br/>import "./App.css";<br/>import StripeBtn from "./StripeBtn";</span><span id="2fb3" class="ll ko hu mf b fv mq mk l ml mm">class App <em class="jh">extends</em> Component {</span><span id="3efe" class="ll ko hu mf b fv mq mk l ml mm">  render() {<br/>    return (<br/>      &lt;div <em class="jh">className</em>="App"&gt;<br/>        &lt;header <em class="jh">className</em>="App-header"&gt;<br/>          &lt;img <em class="jh">src</em>={logo} <em class="jh">className</em>="App-logo" <em class="jh">alt</em>="logo" /&gt;<br/>          &lt;p&gt;Stripe Checkout - ReactJS&lt;/p&gt;<br/>          &lt;StripeBtn /&gt;<br/>        &lt;/header&gt;<br/>      &lt;/div&gt;<br/>      );<br/>  }<br/>}</span><span id="7cee" class="ll ko hu mf b fv mq mk l ml mm">export default App;</span></pre><p id="9560" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">打开浏览器，检查新的Stripe组件，它可以在项目的任何地方重用。看看下面的一些截图。</p><div class="kj kk kl km fq ab cb"><figure class="mr iv ms mt mu mv mw paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/75fe29775ce0a453f0d775aa95e7ac63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*xp3kGLjuet7rNuvgvtoyzQ.png"/></div></figure><figure class="mr iv ms mt mu mv mw paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/03d1d4b811f805a10b686aea9c28ae96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*CH6udgVS15nyW5jwyNL16Q.png"/></div><figcaption class="mx my fg fe ff mz na bd b be z ek nb di nc nd">Clicking the button on the left will make the modal appear on the right.</figcaption></figure></div></div><div class="ab cl ne nf hc ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="hn ho hp hq hr"><h1 id="a3cb" class="kn ko hu bd kp kq nl ks kt ku nm kw kx ky nn la lb lc no le lf lg np li lj lk dt translated">后端/服务器</h1><h2 id="783d" class="ll ko hu bd kp lm ln lo kt lp lq lr kx ke ls lt lb kf lu lv lf kg lw lx lj ly dt translated">设置</h2><p id="eb05" class="pw-post-body-paragraph jf jg hu ji b jj lz jl jm jn ma jp jq ke mb jt ju kf mc jx jy kg md kb kc kd hn dt translated">现在我们的服务器…后端。这是很多人开始紧张的地方。不过，别担心，我会尽可能让这一切变得轻松愉快。请记住，我们的后端只是从前端接收令牌，并将其发送到stripe以完成支付。首先在终端中导航到项目的根目录，并运行以下命令。</p><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="442e" class="ll ko hu mf b fv mj mk l ml mm">mkdir server<br/>cd server<br/>touch server.js</span><span id="37de" class="ll ko hu mf b fv mq mk l ml mm">yarn init -y</span><span id="92de" class="ll ko hu mf b fv mq mk l ml mm">yarn add express stripe cors dotenv</span></pre><p id="f4e9" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">在服务器目录中，我们创建一个索引并初始化一个yarn项目。设置<code class="eh mn mo mp mf b">-y</code>标志使用项目的默认值。然后，我们像在前端一样安装了一些我们需要的包。</p><p id="a607" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">接下来，我们将创建一个保存环境变量的<code class="eh mn mo mp mf b">.env</code>文件。您会希望将<code class="eh mn mo mp mf b">.env</code>放在您的<code class="eh mn mo mp mf b">.gitignore</code>文件中。这是因为我们不会将API密匙等敏感信息上传到Github，也不会让公众获得这些信息。我们还将创建一个新的目录和两个新文件。</p><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="29ea" class="ll ko hu mf b fv mj mk l ml mm">touch .env</span><span id="3699" class="ll ko hu mf b fv mq mk l ml mm">mkdir routes<br/>cd routes<br/>touch index.js payment.js</span></pre><p id="6de6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">在<code class="eh mn mo mp mf b">.env</code>文件内添加<code class="eh mn mo mp mf b">STRIPE_SECRET_KEY="YOUR SECRET KEY HERE"</code>。确保你使用了你的dashboard工具条中的密钥(开发者的API密钥)。让我们在<code class="eh mn mo mp mf b">/server/servers.js</code>中创建将使用Express创建的服务器基础。获取下面的代码。</p><h2 id="c55f" class="ll ko hu bd kp lm ln lo kt lp lq lr kx ke ls lt lb kf lu lv lf kg lw lx lj ly dt translated">创建您的服务器</h2><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="2ae6" class="ll ko hu mf b fv mj mk l ml mm">const express = require("express");<br/>const cors = require("cors");<br/>const bodyParser = require("body-parser");<br/>const dotenv = require("dotenv");</span><span id="b7a9" class="ll ko hu mf b fv mq mk l ml mm">dotenv.config()</span><span id="6aa9" class="ll ko hu mf b fv mq mk l ml mm">const app = express();</span><span id="2247" class="ll ko hu mf b fv mq mk l ml mm">app.use(bodyParser.json());</span><span id="dc70" class="ll ko hu mf b fv mq mk l ml mm">app.use(bodyParser.urlencoded({ extended: true }));</span><span id="8281" class="ll ko hu mf b fv mq mk l ml mm">app.use(cors());</span><span id="2942" class="ll ko hu mf b fv mq mk l ml mm">const configureRoutes = require("./routes")</span><span id="362a" class="ll ko hu mf b fv mq mk l ml mm">configureRoutes(app);</span><span id="e91f" class="ll ko hu mf b fv mq mk l ml mm">app.listen(8000, error =&gt; {<br/>  if (error) throw error;<br/>  console.log("Server running on port " + 8000);<br/>});</span></pre><p id="60a6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">上面我们导入express来创建一个应用程序/服务器。导入并配置<code class="eh mn mo mp mf b">dotenv</code>以使用我们的环境变量(<code class="eh mn mo mp mf b">.env</code>)。将<code class="eh mn mo mp mf b">cors</code>应用到应用程序，并用我们的路线目录配置应用程序。最后一步是让你的应用程序监听本地服务器8000。现在我们需要创建我们的<code class="eh mn mo mp mf b">/routes/payments.js</code>端点。复制并粘贴下面的代码开始。</p><h2 id="e55a" class="ll ko hu bd kp lm ln lo kt lp lq lr kx ke ls lt lb kf lu lv lf kg lw lx lj ly dt translated">支付端点</h2><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="d07e" class="ll ko hu mf b fv mj mk l ml mm">const stripe = require("stripe")(process.env.STRIPE_SECRET_KEY);</span><span id="99fb" class="ll ko hu mf b fv mq mk l ml mm">const stripeChargeCallback = res =&gt; (stripeErr, stripeRes) =&gt; {<br/>  if (stripeErr) {<br/>    res.status(500).send({ error: stripeErr });<br/>  } else {<br/>    res.status(200).send({ success: stripeRes });<br/>  }<br/>};</span><span id="67c5" class="ll ko hu mf b fv mq mk l ml mm">const paymentApi = app =&gt; {<br/>  app.get("/", (req, res) =&gt; {<br/>    res.send({<br/>      message: "Hello Stripe checkout server!",<br/>      timestamp: new Date().toISOString()<br/>    });<br/>  });</span><span id="a047" class="ll ko hu mf b fv mq mk l ml mm">app.post("/", (req, res) =&gt; {<br/>    const body = {<br/>      source: req.body.token.id,<br/>      amount: req.body.amount,<br/>      currency: "usd"<br/>    };<br/>    stripe.charges.create(body, stripeChargeCallback(res));<br/>});</span><span id="8f78" class="ll ko hu mf b fv mq mk l ml mm">  return app;<br/>};</span><span id="af3b" class="ll ko hu mf b fv mq mk l ml mm">module.exports = paymentApi;</span></pre><p id="669f" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">在顶部，我们通过从。环境文件。然后创建一个回调，将响应或错误发送回前端。接下来，我们将创建端点(get、post等。)的支付途径。get请求只是您的服务器启动并运行的端点。这是post请求创建令牌id、数量和货币主体的地方。我们使用我们的<code class="eh mn mo mp mf b">stripe</code>实例通过从客户端传入<code class="eh mn mo mp mf b">body</code>对象和响应的回调来创建费用。这将完成购买，并向客户收取一次费用。如果你正在寻找订阅或重复计费，请查看我的另一篇文章。</p><p id="e9e7" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hn dt translated">最后一步是连接您的<code class="eh mn mo mp mf b">server.js</code>和<code class="eh mn mo mp mf b">routes</code>。这已经在<code class="eh mn mo mp mf b">server.js</code>中进行了配置，所以只需在<code class="eh mn mo mp mf b">/routes/index.js</code>中添加以下代码。</p><pre class="kj kk kl km fq me mf mg mh aw mi dt"><span id="9bcf" class="ll ko hu mf b fv mj mk l ml mm">const paymentApi = require("./payment");</span><span id="1b3f" class="ll ko hu mf b fv mq mk l ml mm">const configureRoutes = app =&gt; {<br/>  paymentApi(app);<br/>};</span><span id="dcee" class="ll ko hu mf b fv mq mk l ml mm">module.exports = configureRoutes;</span></pre><h2 id="3b93" class="ll ko hu bd kp lm ln lo kt lp lq lr kx ke ls lt lb kf lu lv lf kg lw lx lj ly dt translated">你成功了</h2><p id="0e2d" class="pw-post-body-paragraph jf jg hu ji b jj lz jl jm jn ma jp jq ke mb jt ju kf mc jx jy kg md kb kc kd hn dt translated">就是这样。将端子<code class="eh mn mo mp mf b">cd</code>插入<code class="eh mn mo mp mf b">/server</code>并运行<code class="eh mn mo mp mf b">yarn start</code>。这将在本地主机8000上运行服务器。在你的浏览器中回到你的客户端，试一试你的新按钮。这里有几张卡片你可以试试:</p><blockquote class="nq"><p id="d0ef" class="nr ns hu bd nt nu nv nw nx ny nz kd ek translated">签证号码:4242 4242 4242 4242-Exp:01/20-CVV:123</p><p id="458a" class="nr ns hu bd nt nu nv nw nx ny nz kd ek translated">万事达卡:5555 5555 5555 4444-Exp:01/20-CVV:123</p></blockquote><p id="ffab" class="pw-post-body-paragraph jf jg hu ji b jj oa jl jm jn ob jp jq ke oc jt ju kf od jx jy kg oe kb kc kd hn dt translated">如果你遇到任何问题，请给我发信息，我会尽力帮助你。如果你喜欢这个，请分享并关注我的<a class="ae kh" href="https://github.com/Jameson13B" rel="noopener ugc nofollow" target="_blank"> Github </a>和<a class="ae kh" href="https://twitter.com/jameson_brown" rel="noopener ugc nofollow" target="_blank"> Twitter </a>。请关注未来的文章，如Stripe订阅费用等。祝你愉快！</p><figure class="kj kk kl km fq iv"><div class="bz el l di"><div class="of og l"/></div></figure></div></div>    
</body>
</html>