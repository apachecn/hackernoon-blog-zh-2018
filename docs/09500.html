<html>
<head>
<title>Hashed Secrets to the Rescue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">拯救散列秘密</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/hashed-secrets-to-the-rescue-1ddc1daff83e?source=collection_archive---------16-----------------------#2018-11-20">https://medium.com/hackernoon/hashed-secrets-to-the-rescue-1ddc1daff83e?source=collection_archive---------16-----------------------#2018-11-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="8ca9" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">防止热情合同锁定用户资金</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/bd2de55d5a93410d71bea6a908eb6013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dd3hPdgr0GMDoQ2ZJ5Fz0g.jpeg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Hashed Secrets — <a class="ae jz" href="https://unsplash.com/photos/UwzalTDCpT4?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Jared Rice</a> on <a class="ae jz" href="https://unsplash.com/search/photos/secret?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ceca" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><strong class="kc hv">执行摘要</strong></p><p id="ce61" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">轻量级合约在正确使用的情况下永远不会锁定用户资金。</p><p id="0dd3" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><strong class="kc hv">简介</strong></p><p id="d0ef" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">开始一个大型软件开发项目总是伴随着许多风险和不确定性。当我们在2016年开始制作<a class="ae jz" href="https://hackernoon.com/tagged/ardor" rel="noopener ugc nofollow" target="_blank">热情</a>时，风险是巨大的，但我们做到了。Ardor于2018年1月在mainnet上推出，正如我们承诺的那样，它的第一个子链伊格尼丝实现了NXT <a class="ae jz" href="https://hackernoon.com/tagged/blockchain" rel="noopener ugc nofollow" target="_blank">区块链</a>等的功能。从那以后，我们一直致力于为这款神奇的产品增加更多的功能和实用性。</p><p id="6ddf" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">一位智者曾经告诉我，当你需要交付一个大型软件项目时，不要花几个月时间做计划，直接开始就行了。你在一周内获得的相关知识和经验将比几个月的计划有用得多。所以我们在轻量级合同项目中这样做了。然而，我们不知道如何提前解决的一件事是，如果合同管理人未能(或不想)运行合同，如何防止合同锁定用户资金。正如我们之前讨论的，轻量级契约不是共识的一部分，只有选择这样做的契约运行器节点才会运行它们。但是，作为一个向合同发送资金的用户，我如何确定合同会执行并且不会锁定我的资金？现在，我们有了一个解决方案。</p><p id="244d" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">你看，大多数智能合同框架不需要担心锁定用户资金，因为合同运行是共识的一部分。如果一个节点在应该运行合同时没有运行，该节点将被留在分叉上。历史上的资金锁定事件是由于合同本身的缺陷，而不是执行框架的缺陷。一个显著的例子是以太坊Paritytech multisig契约，当开发人员忘记移除<a class="ae jz" href="https://github.com/paritytech/parity-ethereum/issues/6995" rel="noopener ugc nofollow" target="_blank"> kill </a>方法时，它从独立状态变成了库。</p><p id="b725" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">但是这种要求每个节点执行每个契约的方法显然是不可伸缩的。所以人们想出了替代的想法，比如<a class="ae jz" href="https://plasma.io/plasma.pdf" rel="noopener ugc nofollow" target="_blank"> Plasma </a>描述了一种将合同执行转移到子链的方法。如果这听起来很熟悉我们在热情中所做的事情，不要感到惊讶，英雄所见略同，但等离子设计师遇到了同样的问题，如果不是每个人都需要运行合同，你如何确保有人会运行它，而不只是锁定你的资金？plasma白皮书提到了一个大规模退出的想法，以防有人在某个子链上恶意行为，每个人都可以从中逃脱。我们认为这是一个坏主意，因为它实现复杂，操作简单。相反，我们的方法是不同的:直到合同成功运行，我们才真正将资金发送到合同帐户。</p><p id="7c4f" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><strong class="kc hv">解决方案——通过散列秘密进行定相</strong></p><p id="7ce8" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">Ardor的一个伟大之处在于，我们是在NXT丰富的功能之上构建它的。我们不像许多其他区块链解决方案那样从零开始。NXT已经有了一个鲜为人知的特性，我们称之为“散列秘密定相”。其思想是将交易与由众所周知的散列函数生成的秘密散列一起提交。余额(或其他状态变化)仅在秘密被单独的批准交易披露后更新。如果秘密没有被特定的块高度泄露，则交易保留在区块链中，但是余额没有更新。该功能存在于NXT中，并从2015年开始在生产中运行。</p><p id="9617" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">现在，我们可以使用轻量级合同来利用这个小宝石。为合同提供资金的客户将指定一个只有他们知道的秘密的散列。基于该触发事务运行的契约将使用相同的“散列秘密”提交其自己的事务。一旦客户端揭示了秘密，两个事务将作为一个原子操作一起应用。如果客户决定不泄露秘密，这两笔交易都将保留在区块链中，但它们的余额变化将被忽略。因此，如果合同未能运行，客户不会泄露秘密，因此当达到阶段高度时，其资金将被释放。简单的局部解决方案，不需要大量退出等。</p><p id="6206" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">让我们看看这在实践中是如何工作的。客户端通过只有它自己知道的秘密的散列来定义批准模式。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff kw"><img src="../Images/bf2ac24af0a4af7d03cf61d6b8373b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*raDFpQO52bbpKuxFJFuImA.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Figure 1 — Define the Hashed Secret</figcaption></figure><p id="9297" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">现在，我们可以通过这个秘密散列触发一个契约并分阶段进行交易</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff kx"><img src="../Images/198bd3ce6c18396585781d6f2eee6db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*jlp253OT0ZdMR1RPkPdt6w.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Figure 2 — Hashed Secret Attached when Sending a Transaction to a Contract</figcaption></figure><p id="dfdc" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">契约使用相同的秘密散列来提交它自己的事务。它不知道秘密，它只回显由触发事务提供的秘密的相同散列。</p><p id="6c13" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">客户端现在检查这两个交易，并通过透露散列秘密来批准它们。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/3e83cf6490e7657c2ca032d9b57893c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*EW9pQa_eA_-gO82i5MeWdQ.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Figure 3 — Approve Both Transactions by Revealing the Phased Secret</figcaption></figure><p id="4217" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">因此，两个交易余额更改都应用于同一个块，而没有锁定或操纵的风险。</p><p id="bda4" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><strong class="kc hv">总结</strong></p><p id="ab20" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">轻量级契约的一个预先设计挑战是锁定用户资金的风险。现在，通过使用合同执行框架中内置的原始NXT“散列秘密定相”功能，这种风险得到了缓解。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure></div></div>    
</body>
</html>