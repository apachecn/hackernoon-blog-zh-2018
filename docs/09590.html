<html>
<head>
<title>Implementing a cron job with Laravel 5 with Scheduling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用带调度的Laravel 5实现cron作业</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/implementing-a-cron-job-with-laravel-5-with-scheduling-ef491d672f45?source=collection_archive---------6-----------------------#2018-11-25">https://medium.com/hackernoon/implementing-a-cron-job-with-laravel-5-with-scheduling-ef491d672f45?source=collection_archive---------6-----------------------#2018-11-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/38c649933af7d904b88bb683ae55ac57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzWzeHIePfOxPdexHmrjVg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/BXOXnQ26B7o?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Aron</a> on <a class="ae jg" href="https://unsplash.com/search/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e51b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Laravel包括“调度”来处理cron作业。您可以在Laravel中使用一种富于表现力且易于使用的语法轻松地安排它们。</p><h1 id="932a" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">行程安排</h1><p id="7302" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">“App\Console\Kernel”类处理Laravel中的所有调度。</p><p id="86aa" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是你不应该在这里放入任何逻辑。这种方法应该只用于设置时间表。要实际定义要运行的内容，应该为每个要运行的任务创建一个新的artisan命令。您可以通过运行<code class="eh li lj lk ll b">php artisan make:command</code>创建一个新命令。如果您的命令叫做“HourlyUpdate ”,运行<code class="eh li lj lk ll b">php artisan make:command HourlyUpdate</code>。</p><p id="f063" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">它将在应用程序/命令中创建新文件。打开它，编辑它的“签名”。它将是从内核类和命令行调用您的任务时使用的名称。</p><p id="e918" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">编辑其描述。它应该是对命令目的的易读解释。</p><p id="1a5a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">编辑它的句柄。句柄是执行任务的方法。</p><p id="bc3d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在在“应用程序/控制台”中打开“Kernel.php ”,并将我们新创建的类添加到“命令”数组中:</p><p id="0d66" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae jg" href="https://gist.github.com/01c903d943a91bbca4b4911489bb6b46" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/01c903d943a91bbca4b4911489bb6b46</a></p><p id="c819" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">编辑“时间表”来安排我们的任务。例如，<code class="eh li lj lk ll b">everyMinute()</code>每分钟运行一次任务，而<code class="eh li lj lk ll b">everyHour()</code>每小时运行一次。您也可以使用<code class="eh li lj lk ll b">monthlyOn(1, '00:01')</code>来指定一个月中的某一天。要查找所有可用选项的列表，请查看[官方文档][4]</p><p id="49df" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您还可以告诉Laravel将任务的输出打印到一个文件<code class="eh li lj lk ll b">appendOutputTo(PATH)</code>。</p><p id="087b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于我们的例子，我们将在每月初运行我们的任务。出于调试目的，我们还将输出保存到一个文件中，并且我们希望确保如果有另一个任务正在运行，一个任务不会启动。</p><p id="a71b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae jg" href="https://gist.github.com/5cb1a689c4b6dbe691e37ce4a0f241c0" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/5cb1a689c4b6dbe691e37ce4a0f241c0</a></p><h1 id="7114" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">测试</h1><p id="7c51" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">您可以通过从终端手动调用cron作业来测试它。您可以使用列出所有自定义动作和默认artisan动作</p><p id="1cf5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae jg" href="https://gist.github.com/1b64da5a8797667df698f2d9c6a7ff5b" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/1b64da5a8797667df698f2d9c6a7ff5b</a></p><p id="f2b9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">它将返回所有可用操作的列表。</p><p id="1294" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae jg" href="https://gist.github.com/f31b531ac186430fb08bc0bbf23a8a2f" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/f31b531ac186430fb08bc0bbf23a8a2f</a></p><p id="ca2d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“每月:配额”是我们的习惯动作。我们可以用<code class="eh li lj lk ll b">php artisan monthly:quota</code>来调用。</p><h1 id="229d" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">添加到Cron</h1><p id="591f" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">最后，您需要实际进入Linux安装中的crontab，并告诉系统每分钟调用Laravel。</p><p id="4ba5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后，Laravel将评估所有的cronjobs，并决定是否需要调度某个东西来执行。如果它不需要执行任何动作，它会直接返回。</p><p id="5385" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">使用终端打开crontab。它通常位于<code class="eh li lj lk ll b">/etc/crontab</code>中，并添加下面一行，确保写在您的Laravel项目的路径中。</p><p id="e003" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae jg" href="https://gist.github.com/03f2d39e6beb05d98f481a5cc902a0a7" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/03f2d39e6beb05d98f481a5cc902a0a7</a></p><p id="731e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们还忽略了输出，因为Laravel已经允许我们配置如何处理输出。</p><p id="83d3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="lm">和往常一样，安排日程时要注意不同的时区。</em></p><h1 id="9230" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">结论</h1><p id="0505" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">Laravel通过一个即时语法和许多配置选项，可以非常容易地安排任务以特定的时间间隔运行。</p><p id="a639" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">不到24小时，我就推出了<a class="ae jg" href="https://markdown.love/" rel="noopener ugc nofollow" target="_blank"><em class="lm">Markdown Love</em></a><em class="lm">，这是一个API，可以将网络上的任何文章都变成Markdown，用Laravel。</em></p><p id="5c5b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以在我的网站和推特上找到我。</p></div></div>    
</body>
</html>