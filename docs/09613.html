<html>
<head>
<title>Create simple gym management in Laravel part 1.2 permission management: easy authorization with Laravel Gate ( official authorization package )</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Laravel part 1.2权限管理中创建简单的健身房管理:使用Laravel Gate(官方授权包)轻松授权</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/create-simple-gym-management-in-laravel-part-1-2-8a564c7fc1ab?source=collection_archive---------22-----------------------#2018-11-26">https://medium.com/hackernoon/create-simple-gym-management-in-laravel-part-1-2-8a564c7fc1ab?source=collection_archive---------22-----------------------#2018-11-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="ab fr cl iv"><img src="../Images/a075d71e32500da343bc53dd42731843.png" data-original-src="https://miro.medium.com/v2/format:webp/1*otQu94kdWEeuarIQOlEkgw.png"/></div></figure><p id="d8ad" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">对于前一部分，我们已经设置了用户和组，以继续我已经实现了Laravel门，并显示如何包工作</p><p id="b13c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">当你看到Laravel文档时，它会给出两个关键字</p><p id="dac7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">大门和政策</p><p id="fba3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">Gate是一个执行所有授权周期的类，Policie是一个组织一组gate的类，这些gate将你想要的东西分开</p><p id="369b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">你将从本章中学到的四个步骤</p><ol class=""><li id="d166" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke dt translated">生成策略类</li><li id="8e45" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">检查用户是否有权执行操作</li><li id="c77d" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">在AuthService proivider中注册策略</li><li id="8c05" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">在控制器或多个地方执行检查，并使用多个助手</li></ol><h2 id="d418" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">生成策略类</h2><p id="7e20" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">首先将控制组和用户的授权</p><p id="4ceb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们用artisan创建策略类</p><pre class="lk ll lm ln fq lo lp lq lr aw ls dt"><span id="bbcd" class="kk kl hu lp b fv lt lu l lv lw">php artisan make:policy GroupPolicy --model=Group<br/>php artisan make:policy UserPolicy --model=User</span></pre><p id="046b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">它从模板生成一个类</p><h2 id="aea9" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">检查用户是否有权执行某项操作</h2><p id="adae" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">策略类中用于检查控制器中权限匹配的函数</p><pre class="lk ll lm ln fq lo lp lq lr aw ls dt"><span id="9892" class="kk kl hu lp b fv lt lu l lv lw">public function create(User $user) {</span><span id="b1ec" class="kk kl hu lp b fv lx lu l lv lw"><em class="ly">     return</em> in_array('group.create',$user-&gt;group-&gt;permission);</span><span id="14d7" class="kk kl hu lp b fv lx lu l lv lw">}</span></pre><p id="6c3e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们使用in_array来检查当前操作在当前登录用户中是否有权限</p><p id="9a2d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">group.create来自Group Controller和create函数以及一个包含我们在上一章中创建的权限列表的数组</p><p id="5011" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><code class="eh lz ma mb lp b">in_array</code>返回布尔这对我们来说太容易了</p><h2 id="14f6" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">在AuthService provider中注册策略</h2><p id="54f3" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">在AuthService provider的功能启动中激活策略</p><pre class="lk ll lm ln fq lo lp lq lr aw ls dt"><span id="38fc" class="kk kl hu lp b fv lt lu l lv lw">public function boot(){</span><span id="adaf" class="kk kl hu lp b fv lx lu l lv lw"><em class="ly">$this</em>-&gt;registerPolicies();</span><span id="18da" class="kk kl hu lp b fv lx lu l lv lw">\Gate::resource('group','App\Policies\GroupPolicy');<br/>\Gate::resource('group','App\Policies\UserPolicy');</span><span id="3e00" class="kk kl hu lp b fv lx lu l lv lw">}</span></pre><h2 id="a665" class="kk kl hu bd km kn ko kp kq kr ks kt ku jj kv kw kx jn ky kz la jr lb lc ld le dt translated">在控制器上或许多地方执行授权，并使用许多助手</h2><p id="3192" class="pw-post-body-paragraph iy iz hu ja b jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv hn dt translated">我们有许多检查授权的帮助函数，如can、cant、allows和denieds，</p><p id="2975" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">例如，检查用户是否不能编辑组，我们返回403</p><pre class="lk ll lm ln fq lo lp lq lr aw ls dt"><span id="b2de" class="kk kl hu lp b fv lt lu l lv lw">public function edit($id){</span><span id="1d72" class="kk kl hu lp b fv lx lu l lv lw"><em class="ly">    if</em>(auth()-&gt;user()-&gt;cant('group.edit')){</span><span id="0453" class="kk kl hu lp b fv lx lu l lv lw"><em class="ly">      return</em> abort(403);<br/>    }</span><span id="f0d9" class="kk kl hu lp b fv lx lu l lv lw">    $group = \App\Group::find($id);</span><span id="fcc6" class="kk kl hu lp b fv lx lu l lv lw"><em class="ly">    return</em> view('group.edit',compact('group'));</span><span id="adbd" class="kk kl hu lp b fv lx lu l lv lw">}</span></pre><p id="5b43" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在让我们试试</p><figure class="lk ll lm ln fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="fe ff mc"><img src="../Images/f361ce16a174e30ee946229e353ab440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NBgi34L_0tgh2Ruiuef1Ng.png"/></div></div></figure><p id="0665" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">您可以使用laravel debugbar查看个人资料您是否看到Gate返回成功</p><p id="0567" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我试过失败案例</p><figure class="lk ll lm ln fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="fe ff mh"><img src="../Images/e45470b35965f1e21c5390cc59ed553e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fg3TRo_NS9oIrdTCsPH6ew.png"/></div></div></figure><p id="ce41" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">将移除<code class="eh lz ma mb lp b">user.create</code>表单管理员角色</p><p id="7f69" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在策略中添加授权检查</p><pre class="lk ll lm ln fq lo lp lq lr aw ls dt"><span id="22eb" class="kk kl hu lp b fv lt lu l lv lw">public function create(User $user){</span><span id="692b" class="kk kl hu lp b fv lx lu l lv lw"><em class="ly">   return</em> in_array('user.create',$user-&gt;group-&gt;permission);</span><span id="d2e4" class="kk kl hu lp b fv lx lu l lv lw">}</span></pre><p id="977b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在控制器中</p><pre class="lk ll lm ln fq lo lp lq lr aw ls dt"><span id="f09a" class="kk kl hu lp b fv lt lu l lv lw">public function create() {</span><span id="be78" class="kk kl hu lp b fv lx lu l lv lw"><em class="ly">   if</em>(auth()-&gt;user()-&gt;cant('user.create')){</span><span id="5766" class="kk kl hu lp b fv lx lu l lv lw"><em class="ly">      return</em> abort(403);</span><span id="41f3" class="kk kl hu lp b fv lx lu l lv lw">   }<br/>   $groups = Group::all();<br/>   <em class="ly">return</em> view('user.create',compact('groups'));</span><span id="6e3b" class="kk kl hu lp b fv lx lu l lv lw">}</span></pre><p id="1ab7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">是的，是工作</p><figure class="lk ll lm ln fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="fe ff mi"><img src="../Images/9f2cfc55a33a11555dd999f9b46c85a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VSo_p3UQsaKUrrS4OnJcsQ.png"/></div></div></figure><p id="89a1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">那么你下一步应该做什么</p><p id="e4c7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这是一个额外的功能，你可以做一般业务需求时完成</p><p id="6f07" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">您可以重复该过程来覆盖所有动作</p></div></div>    
</body>
</html>