<html>
<head>
<title>Draft.js: how to remove formatting of the text</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Draft.js:如何移除文本格式</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/draft-js-how-to-remove-formatting-of-the-text-cd191866d9ad?source=collection_archive---------4-----------------------#2018-11-27">https://medium.com/hackernoon/draft-js-how-to-remove-formatting-of-the-text-cd191866d9ad?source=collection_archive---------4-----------------------#2018-11-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/a3658edd55c04761492924cace903916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMscODOSsggZ8ImhBOqvNA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/NScCnMEYHQ0?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Natalia Y</a> on <a class="ae jg" href="https://unsplash.com/search/photos/type-setters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ba19" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们Propeller在Draft.js中遗漏的一个特性是可以清除所选文本的样式，在编辑器中保留纯文本。我们相信这种行为是普遍使用的，我们的用户可能会期望这个功能在它的位置上。和往常一样，为了添加这个特性，你需要花大量的时间去钻研<a class="ae jg" href="https://draftjs.org/docs" rel="noopener ugc nofollow" target="_blank"> Draft.js文档</a>以便找到所需的信息。</p><blockquote class="kf kg kh"><p id="e8bf" class="jh ji ki jj b jk jl jm jn jo jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd ke hn dt translated">这篇文章描述了你应该采取什么步骤来将这种行为添加到你的项目中。</p></blockquote><h2 id="462b" class="km kn hu bd ko kp kq kr ks kt ku kv kw js kx ky kz jw la lb lc ka ld le lf lg dt translated">TL；速度三角形定位法(dead reckoning)</h2><p id="1fcf" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">和往常一样，有一个<a class="ae jg" href="https://www.npmjs.com/package/draft-js-clear-formatting" rel="noopener ugc nofollow" target="_blank"> npm包</a>可供您使用，不用手动实现所有的东西。</p><p id="f37a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Draft.js中的所有编辑可分为3组:</p><ul class=""><li id="109b" class="lm ln hu jj b jk jl jo jp js lo jw lp ka lq ke lr ls lt lu dt translated">内嵌样式</li><li id="c881" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated">自定义实体(例如图像、链接等。)</li><li id="1108" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated">块类型</li></ul><p id="7bca" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了清理文本，我们需要照顾所有这些群体。</p><h2 id="fc9e" class="km kn hu bd ko kp kq kr ks kt ku kv kw js kx ky kz jw la lb lc ka ld le lf lg dt translated">内嵌样式</h2><p id="7416" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">这个很简单。首先，我们需要定义一个我们在项目中支持的样式列表(在我们的例子中——粗体、斜体和下划线文本)。接下来，我们需要调用作为Draft.js包一部分的<code class="eh ma mb mc md b">Modifier</code>模块的方法<code class="eh ma mb mc md b">removeInlineStyles</code>。很明显，这个方法允许我们从选定的范围中删除指定的内联样式。所以我们需要为我们的<code class="eh ma mb mc md b">styles</code>数组的每一项调用它。</p><p id="544b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了简化代码，我们将在这里使用<code class="eh ma mb mc md b">reduce</code>方法。如果你不熟悉它，你可以在这里阅读。</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="d275" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意，我们在这里使用了两个不同的<code class="eh ma mb mc md b">editorStates</code>——我们在函数中传递的参数表示编辑器的当前状态，而<code class="eh ma mb mc md b">EditorState</code>应该与<code class="eh ma mb mc md b">Modifier</code>模块一起从Draft.js本身导入。</p><p id="979a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh ma mb mc md b">push</code>方法用于创建一个新的<code class="eh ma mb mc md b">EditorState</code>对象，应用<code class="eh ma mb mc md b">contentWithoutStyles</code>作为编辑器的内容。</p><p id="746b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意我们传递给<code class="eh ma mb mc md b">push</code>方法的第三个参数(一个字符串<code class="eh ma mb mc md b">change-inline-style</code>)。这个参数叫做<code class="eh ma mb mc md b">changeType</code>，Draft.js用它来指定一个正确的撤销/重做行为。这个特殊的样式意味着一个或多个字符已经应用或删除了内联样式。</p><h2 id="eeed" class="km kn hu bd ko kp kq kr ks kt ku kv kw js kx ky kz jw la lb lc ka ld le lf lg dt translated">实体</h2><p id="8489" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">这个更简单。我们不需要构建任何额外的样式数组或使用任何迭代函数。相反，我们需要调用完全相同的<code class="eh ma mb mc md b">Modifier</code>模块的<code class="eh ma mb mc md b">applyEntity</code>方法。这个方法允许我们将一个实体应用到选定的范围。为了移除所有实体，我们需要将<code class="eh ma mb mc md b">null</code>作为第三个参数传递给这个函数。</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="2ff5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可能会再次注意到，我们在<code class="eh ma mb mc md b">EditorState.push()</code>调用中使用<code class="eh ma mb mc md b">apply-entity</code>作为变更类型。这意味着一个实体已经被应用或删除到一个或多个字符。</p><h2 id="97e7" class="km kn hu bd ko kp kq kr ks kt ku kv kw js kx ky kz jw la lb lc ka ld le lf lg dt translated">块类型</h2><p id="5747" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">复杂的那个。以便移除不同的块类型(标题、列表项、代码块等。)并保留文本，我们需要将每个块的类型更改为<code class="eh ma mb mc md b">unstyled</code>。你可以在这里阅读更多关于什么是块以及为什么它有不同类型<a class="ae jg" rel="noopener" href="/@rajaraodv/how-draft-js-represents-rich-text-data-eeabb5f25cf2">的信息。这篇文章并不是100%真实的，但是它给了我们正确的思维方式来更好地理解Draft.js是如何工作的。</a></p><p id="5712" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">改变块类型的最好方法是遍历所有的块，并为其中的每个块调用一个改变函数。</p><p id="4ce4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先，我们需要从选择范围中获取所有的块。这里我们可能想使用<code class="eh ma mb mc md b"><a class="ae jg" href="https://github.com/jpuri/draftjs-utils" rel="noopener ugc nofollow" target="_blank">draftjs-utils</a></code>包中的<code class="eh ma mb mc md b">getSelectedBlocksMap</code>方法。</p><p id="cc12" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，我们需要检测我们是否想要在块上执行任何操作。在我们的例子中，我们需要检查块类型，我们通过调用块的<code class="eh ma mb mc md b">getType</code>方法来完成。因此，如果块有任何类型(<code class="eh ma mb mc md b">blockType !== ‘unstyled’</code> ) —块应该被更新。</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="57ce" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一旦我们发现要更新的块，我们需要改变它的类型。这里我们需要更新选择范围来选择整个块(您可以在这里使用文本长度来设置选择范围的结束索引)。</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="7b0a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们需要调用<code class="eh ma mb mc md b">Modifier</code>模块的<code class="eh ma mb mc md b">setBlockType</code>方法来更新块的类型并获得新的<code class="eh ma mb mc md b">contentState</code>，然后我们需要将其推送到<code class="eh ma mb mc md b">EditorState</code>。这个函数期望得到一个<code class="eh ma mb mc md b">blockType</code>参数，在我们的例子中应该是<code class="eh ma mb mc md b">unstyled</code>，因为我们想要清除所有的编辑。该操作的变更类型为<code class="eh ma mb mc md b">change-block-type</code>。我想现在你明白它的意思了:)</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="4fb6" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们把它们结合在一起，使用<code class="eh ma mb mc md b">reduce</code>方法来简化代码，这样我们就像在<code class="eh ma mb mc md b">Inline Styles</code>部分那样只运行<code class="eh ma mb mc md b">EditorState.push()</code>一次。</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mi mj l"/></div></figure><h2 id="5d88" class="km kn hu bd ko kp kq kr ks kt ku kv kw js kx ky kz jw la lb lc ka ld le lf lg dt translated">将一切结合在一起</h2><p id="1187" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">一切就绪！让我们让所有这些功能发挥作用！我会推荐使用<code class="eh ma mb mc md b">lodash</code>包的<a class="ae jg" href="https://lodash.com/docs/4.17.11#flow" rel="noopener ugc nofollow" target="_blank">流</a>函数或者这里的任何替代函数，因为这将极大地增加代码的可读性。让我们试一试:</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mi mj l"/></div></figure><p id="c3c3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是结果:</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/01b71955f898119b9e97bb574ccbaa7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*FvqXOoXS0VlQVfdbYqul4g.gif"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">We select all the text, hit ‘Clear’ button and all editing is removed!</figcaption></figure><p id="c852" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你到现在还在读这篇文章，你可能也想看看我之前关于Draft.js的文章，并把它应用到你的项目中。</p></div></div>    
</body>
</html>