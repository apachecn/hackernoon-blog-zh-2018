<html>
<head>
<title>Automate pfSense with pfSsh.php</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过pfSsh.php实现pfSense自动化</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/automate-pfsense-with-pfssh-php-737856e906c?source=collection_archive---------14-----------------------#2018-11-28">https://medium.com/hackernoon/automate-pfsense-with-pfssh-php-737856e906c?source=collection_archive---------14-----------------------#2018-11-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/232936583bc4d800418b0145c5d6e970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*davOueOBBitaRuzKTHNtFg.jpeg"/></div></div></figure><div class=""/><p id="7697" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从几个版本开始，pfSense 拥有完全重新设计的用户界面。所有设置都可以通过这个界面轻松实现和调整。可自由配置的仪表板也是一个好东西。但是，有时您可能希望通过API或命令行进行设置。pfSense目前没有API，这将只在一个即将推出的版本中可用。在那之前，你可以使用pfSense开发者外壳，也称为<a class="ae ka" href="https://www.netgate.com/docs/pfsense/development/using-the-php-pfsense-shell.html" rel="noopener ugc nofollow" target="_blank">pfSsh.php</a>。</p><h1 id="9c71" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">访问pfSsh.php</h1><p id="89b6" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">到达开发人员shell的最快方法是通过SSH连接到pfSense，或者直接将一个屏幕连接到防火墙。如果SSH尚未激活，您可以在web界面中的<strong class="je ig">系统→高级</strong>下执行此操作。</p><figure class="lf lg lh li fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff le"><img src="../Images/30f2bc5670019a443da4f22e416b0f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IsRxHYqUtxCNuj6gqz8lgw.png"/></div></div></figure><p id="9d6f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最好禁止使用密码登录，只允许使用证书登录。</p><p id="5ba5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果SSH访问已激活，您现在可以使用admin用户登录(调整IP):</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="96b1" class="lo kc if lk b fv lp lq l lr ls">$ ssh admin@192.168.1.254</span></pre><figure class="lf lg lh li fq hw fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/e9c45db61a0d3c6df6ae1c856579c053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*vFvK_oIPsOxtvbwnJlZ7ow.png"/></div></figure><p id="f871" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在第12点下你会发现开发者外壳，它基本上是一个PHP外壳。</p><h1 id="2828" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">pfSsh.php的命令示例</h1><p id="63db" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">下面是一些示例命令，向您展示如何使用shell。每个输入都是正常的PHP代码，必须用<code class="eh lu lv lw lk b">exec;</code>来完成。</p><h2 id="eca4" class="lo kc if bd kd lx ly lz kh ma mb mc kl jn md me kp jr mf mg kt jv mh mi kx mj dt translated">显示DHCP设置</h2><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="1010" class="lo kc if lk b fv lp lq l lr ls">pfSense shell: print_r($config["dhcpd"]);<br/>pfSense shell: exec;<br/>Array<br/>(<br/>    [lan] =&gt; Array<br/>        (<br/>            [range] =&gt; Array<br/>                (<br/>                    [from] =&gt; 10.0.1.7<br/>                    [to] =&gt; 10.0.255.245<br/>                )</span><span id="e314" class="lo kc if lk b fv mk lq l lr ls">)</span><span id="8233" class="lo kc if lk b fv mk lq l lr ls">)</span></pre><h2 id="9bc4" class="lo kc if bd kd lx ly lz kh ma mb mc kl jn md me kp jr mf mg kt jv mh mi kx mj dt translated">设置域</h2><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="256c" class="lo kc if lk b fv lp lq l lr ls">pfSense shell: $config[‘system’][‘domain’] = ‘mydomain.com’;<br/>pfSense shell: write_config();<br/>pfSense shell: exec;</span></pre><h2 id="d450" class="lo kc if bd kd lx ly lz kh ma mb mc kl jn md me kp jr mf mg kt jv mh mi kx mj dt translated">执行常规shell命令</h2><p id="426d" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在PHP shell中，您还可以通过放置“！”来执行普通的shell命令在它面前:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="58c4" class="lo kc if lk b fv lp lq l lr ls">pfSense shell: ! cat /etc/version <br/>pfSense shell: exec; <br/>2.4.3-RELEASE</span></pre><h2 id="6acb" class="lo kc if bd kd lx ly lz kh ma mb mc kl jn md me kp jr mf mg kt jv mh mi kx mj dt translated">“录制”和“回放”命令</h2><p id="a8ba" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">有了pfSsh.php，你还可以“记录”几个命令，以后再“回放”它们。这些所谓的会话对于重复性任务非常有用。一个例子:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="2fe2" class="lo kc if lk b fv lp lq l lr ls">pfSense shell: record echoTest <br/>Recording of echoTest started. <br/>pfSense shell: echo “This\n”; <br/>pfSense shell: echo “is\n”; <br/>pfSense shell: echo “a\n”; <br/>pfSense shell: ! echo “test\n” <br/>pfSense shell: exec; <br/>pfSense shell: stoprecording <br/>Recording stopped.</span></pre><p id="c5f7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些条目保存在<em class="ml"> /etc/phpshellsessions/ </em>下，如果需要，可以在那里进行编辑。</p><p id="c2cd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">“录音”现在可以按如下方式播放:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="368d" class="lo kc if lk b fv lp lq l lr ls">pfSense shell: playback echoTest <br/>Playback of file echoTest started. <br/>The<br/>is <br/>a <br/>test</span><span id="2d54" class="lo kc if lk b fv mk lq l lr ls">pfSense shell:</span></pre><p id="e754" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">或者直接从根外壳:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="8e19" class="lo kc if lk b fv lp lq l lr ls">$ pfSsh.php playback echoTest</span></pre><h1 id="6c0c" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="65b9" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">pfSsh.php是一个使用脚本自动化pfSense或进行定制的有用工具。特别是如果你管理多个实例或者需要一次又一次的设置，pfSsh.php是一个很大的帮助。例如，您可以将所有设置(即PHP代码)打包到一个文件中，保存在<em class="ml"> /etc/phpshellsessions/ </em>下并执行它们，或者将输出直接转发到pfSsh.php:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="3733" class="lo kc if lk b fv lp lq l lr ls">$ ssh admin@192.168.1.254 '/usr/local/sbin/pfSsh.php' &lt; MyConfig.txt</span></pre></div><div class="ab cl mm mn hc mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hn ho hp hq hr"><p id="c082" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ml">原载于</em><a class="ae ka" href="https://openschoolsolutions.org/automate-pfsense-with-pfssh-php/" rel="noopener ugc nofollow" target="_blank"><em class="ml">openschoolsolutions.org</em></a><em class="ml">。</em></p></div></div>    
</body>
</html>