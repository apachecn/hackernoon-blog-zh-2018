<html>
<head>
<title>Workaround the Node JS File System</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解决方法节点JS文件系统</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/workaround-the-node-js-file-system-a596408b1dcf?source=collection_archive---------4-----------------------#2018-11-30">https://medium.com/hackernoon/workaround-the-node-js-file-system-a596408b1dcf?source=collection_archive---------4-----------------------#2018-11-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/d2ead0c39f11d31afcb68773299ab14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JggJLMOPdaUrHEl0NM35HQ.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/o6GEPQXnqMY?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mr Cup / Fabien Barral</a> on <a class="ae jg" href="https://unsplash.com/search/photos/files?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="254f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你好，守夜人的成员们。我们将看到Node的核心API之一，即文件系统。我知道我们一直在关注代码分割、捆绑包分割、预加载和Internet Explorer的永无止境的灾难，但我们将学习Node如何与我们的文件和目录交互。这有助于我们处理服务器上的图像或资产，正确存储它们，读取其他文件的内容，写入文件等。</p><p id="c851" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将使用文件系统构建一个基本的CRUD应用程序。我想我们可以开始了。</p></div><div class="ab cl kf kg hc kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hn ho hp hq hr"><p id="cb11" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们的小文件夹结构应该是这样的:</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="f897" class="kv kw hu kr b fv kx ky l kz la">Database-----(folder)<br/>crud.js------(file)</span></pre><p id="d19a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“数据库”文件夹将包含一个文件，该文件将保存我们的汽车业务数据。这些数据将包括汽车的名称和价格。它将存储在JSON中。显然，这在生产中是做不到的，为了确保没有人想到这一点，我毫不含糊地声明了这一点。</p><h1 id="d002" class="lb kw hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">创造</h1><p id="9d65" class="pw-post-body-paragraph jh ji hu jj b jk ly jm jn jo lz jq jr js ma ju jv jw mb jy jz ka mc kc kd ke hn dt translated">现在，我们将从我们的<strong class="jj hv"> <em class="md"> crud.js </em> </strong>文件创建我们的<strong class="jj hv"> <em class="md"> cars.json </em> </strong>文件。首先，我们需要文件系统模块和路径模块。</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="192d" class="kv kw hu kr b fv kx ky l kz la">const fs = require('fs');<br/>const path = require('path');</span></pre><p id="a143" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后，我们将创建crud对象及其基目录，该目录包含从crud.js文件到数据库文件夹的路径。</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="1249" class="kv kw hu kr b fv kx ky l kz la">const crud = {};<br/>crud.baseDir = path.join(__dirname,'./database');</span></pre><p id="349e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，我们将添加一个创建函数，我们的crud.js文件应该如下所示:</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="8fc6" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“创建”函数保存我们想要创建的文件的名称，以及我们想要写入文件的数据。因此，我们在基目录中定义的路径下打开一个新文件，它采用我们指定的任何名称。</p><p id="d046" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">‘wx’表示我们可以<strong class="jj hv"> w </strong>写入<strong class="jj hv"> </strong>文件，但是如果文件已经存在，操作将会失败。我们可以将许多其他的<a class="ae jg" href="http://www.tutorialsteacher.com/nodejs/nodejs-file-system" rel="noopener ugc nofollow" target="_blank">操作</a>归于该文件。</p><p id="01dc" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果没有错误，Node会为文件指定一个标识符或文件描述符。如果找到了这个标识符，我们就可以写入文件。</p><p id="049f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们希望我们的数据库看起来像这样:</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="d606" class="kv kw hu kr b fv kx ky l kz la">[<br/>    {name: '', price: ''},<br/>    {name: '', price: ''}<br/>]</span></pre><p id="bec3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这就是原因，我们将数据推送到<strong class="jj hv"> jsonArray </strong>变量，然后再发送到文件。</p><p id="433b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们可以转到页面底部，运行以下命令:</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="a501" class="kv kw hu kr b fv kx ky l kz la">crud.create('cars',{'name': 'innoson','price':'$4000'});</span><span id="c1b5" class="kv kw hu kr b fv mg ky l kz la">//Then Obviously(in your console)<br/>node crud</span></pre><p id="9971" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果一切都相同，这将创建一个包含数组的<strong class="jj hv"> cars.json </strong>文件。</p><h1 id="1f0a" class="lb kw hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">阅读</h1><p id="299f" class="pw-post-body-paragraph jh ji hu jj b jk ly jm jn jo lz jq jr js ma ju jv jw mb jy jz ka mc kc kd ke hn dt translated">现在，我们应该能够从刚刚创建的文件中读取数据了。我们的读取函数应该是这样的:</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="bea0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这个函数转到基目录，也就是数据库文件夹，然后从我们传递给函数的文件中读取数据。编码格式是<a class="ae jg" href="https://en.wikipedia.org/wiki/UTF-8" rel="noopener ugc nofollow" target="_blank"> UTF-8 </a>，如果没有错误，我们的数据将被记录。</p><p id="fa02" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们可以在页面底部运行这个:</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="0a14" class="kv kw hu kr b fv kx ky l kz la">crud.read('cars');</span></pre><h1 id="9c33" class="lb kw hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">更新</h1><p id="cc68" class="pw-post-body-paragraph jh ji hu jj b jk ly jm jn jo lz jq jr js ma ju jv jw mb jy jz ka mc kc kd ke hn dt translated">现在，我们可以使用<strong class="jj hv"> fs.truncate() </strong>来更改整个文件的内容，但是我们将使用<strong class="jj hv"> fs.appendFile() </strong>来将数据追加到我们的文件中。</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="fc81" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果我们转到页面底部，运行更新功能</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="8c9c" class="kv kw hu kr b fv kx ky l kz la">crud.update('cars',{name:'Tesla',price:'$10'})</span></pre><p id="12e7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将得到如下输出:</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="fc8e" class="kv kw hu kr b fv kx ky l kz la">[<br/>   {name: 'innoson',price:'#4000'}<br/>]<br/>,<br/>{name: 'Tesla',price:'$10'}</span></pre><p id="14e3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这不是我们想要的，我们需要对象在数组中。为此，我想出了一个计划。</p><ul class=""><li id="7858" class="mh mi hu jj b jk jl jo jp js mj jw mk ka ml ke mm mn mo mp dt translated">我们将读取<strong class="jj hv"> cars.json </strong>文件的当前内容</li><li id="4fe8" class="mh mi hu jj b jk mq jo mr js ms jw mt ka mu ke mm mn mo mp dt translated">然后，我们将追加我们的更新</li><li id="af89" class="mh mi hu jj b jk mq jo mr js ms jw mt ka mu ke mm mn mo mp dt translated"><strong class="jj hv">然后</strong>，我们将截断文件并替换。</li></ul><p id="ec71" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">重点放在“T10”，然后是“T11”，我们需要使用承诺。我们将使用另一个节点API util。</p><p id="1d88" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">转到crud.js文件的顶部，包括:</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="dc53" class="kv kw hu kr b fv kx ky l kz la">const { promisify } = require("util");</span><span id="8d55" class="kv kw hu kr b fv mg ky l kz la">const readFile = promisify(fs.readFile);</span></pre><p id="d065" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因此,' readFile '变量将返回承诺。我们新的crud.update函数应该如下所示:</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="1dda" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因此，我们可以在数据库文件夹中创建一个新的JSON文件，并测试我们的更新功能。</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="535c" class="kv kw hu kr b fv kx ky l kz la">crud.create('cars-updated',{name:'mercedes',price:'$400'})</span><span id="db03" class="kv kw hu kr b fv mg ky l kz la">crud.update('cars-updated',{name:'Toyota',price:'$550'})</span></pre><p id="5459" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">cars-updated.json文件应该具有所需的格式。</p><h1 id="2d17" class="lb kw hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">删除</h1><p id="98f0" class="pw-post-body-paragraph jh ji hu jj b jk ly jm jn jo lz jq jr js ma ju jv jw mb jy jz ka mc kc kd ke hn dt translated">要删除一个文件，我们使用fs.unlink方法。所以我们的crud.delete函数应该是这样的:</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="afa4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因此，我们可以删除cars.json文件，因为不再需要它了。</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="e58f" class="kv kw hu kr b fv kx ky l kz la">crud.delete('cars')</span></pre><p id="f819" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以在这里看到crud.js文件<a class="ae jg" href="https://gist.github.com/obbap1/36654c084ee67ab63017ea4932d724d5.js" rel="noopener ugc nofollow" target="_blank"/></p><p id="4eee" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="md">非常感谢你的阅读，如果你喜欢，请鼓掌。如有任何问题或需要进一步澄清，可以留言或发邮件(paschalobba@yahoo.com)。</em></p></div></div>    
</body>
</html>