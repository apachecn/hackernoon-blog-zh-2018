<html>
<head>
<title>Build a realtime comment app with Go and Pusher Channels</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Go和Pusher频道构建一个实时评论应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-a-realtime-comment-app-with-go-and-pusher-channels-387b2bf20a9e?source=collection_archive---------8-----------------------#2018-11-30">https://medium.com/hackernoon/build-a-realtime-comment-app-with-go-and-pusher-channels-387b2bf20a9e?source=collection_archive---------8-----------------------#2018-11-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="8d85" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">你需要在你的机器上安装Go和SQLite。Go和JavaScript的基础知识会有帮助。</em></p></blockquote><p id="6c6e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">互联网是各种社会活动的温床，因为它扩大了交流的可能性。为了保持web应用程序的社会性和趣味性，为用户提供一个或多个交互界面是非常重要的。一个这样的界面是评论部分。</p><p id="5d30" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">评论区是用户可以讨论他们有权访问的主题(帖子、视频、图片)的地方。过去，一个用户要看到另一个用户的评论，必须刷新浏览器窗口。然而，现在有了实时评论，我们可以自动实时获取评论。本文将介绍如何使用Pusher构建实时评论。</p><p id="c919" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">到本文结束时，我们将构建一个如下所示的应用程序:</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/2f4e529b94132a69e6efd6cf1f59ce1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*qH7sax1zRBE_R3hGABk5zA.gif"/></div></figure><h1 id="133c" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">要求</h1><p id="f8dc" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">要阅读本文，您需要以下内容:</p><ul class=""><li id="d6d6" class="lh li hu ix b iy iz jc jd jt lj ju lk jv ll js lm ln lo lp dt translated">Go(版本&gt; = 0.10.x)安装在您的计算机上。下面是你如何安装Go的方法。</li><li id="e0e3" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated">安装在您机器上的SQLite (v3.x)。<a class="ae lq" href="http://www.sqlitetutorial.net/download-install-sqlite/" rel="noopener ugc nofollow" target="_blank">安装指南</a>。</li><li id="92fa" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated">Go编程语言的基础知识。</li><li id="b354" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated">JavaScript基础知识(ES6)。</li><li id="9f0f" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated">Vue.js的基础知识。</li></ul><h1 id="475d" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">获得推广渠道应用</h1><p id="c70a" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">第一步将是获得一个推广渠道的应用。我们需要应用程序凭证来使我们的实时特性工作。</p><p id="6038" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">去Pusher网站创建一个帐户。创建帐户后，您应该创建一个新的应用程序。遵循应用程序创建向导，然后您应该获得您的应用程序凭证，我们将在本文后面使用它。</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lw"><img src="../Images/109e574b0ce16b1f34a64939d7d911f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WC4JEZEltwJuKbewmgd3ng.png"/></div></div></figure><p id="ba72" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">现在我们有了应用程序，让我们进入下一步。</p><h1 id="414f" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">设置代码库</h1><p id="f011" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">让我们首先导航到位于<code class="eh mb mc md me b">$GOPATH</code>中的<code class="eh mb mc md me b">src</code>目录。然后，我们将在那里为我们的应用程序创建一个新目录。</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="e23a" class="mj kf hu me b fv mk ml l mm mn">$ cd $GOPATH/src<br/>$ mkdir go-realtime-comments<br/>$ cd go-realtime-comments</span></pre><p id="d687" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在这个目录下创建一个<code class="eh mb mc md me b">comments.go</code>文件。</p><p id="e7f6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在我们编写代码之前，我们需要导入几个Go包来帮助运行我们的项目。我们将安装<a class="ae lq" href="https://echo.labstack.com/" rel="noopener ugc nofollow" target="_blank"> Echo框架</a>和<a class="ae lq" href="https://github.com/mattn/go-sqlite3" rel="noopener ugc nofollow" target="_blank"> SQLite包</a>。运行以下命令来拉入包:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="2990" class="mj kf hu me b fv mk ml l mm mn">$ go get github.com/labstack/echo<br/>$ go get github.com/labstack/echo/middleware<br/>$ go get github.com/mattn/go-sqlite3</span></pre><blockquote class="ir is it"><p id="0305" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu">如果你使用Windows，你遇到错误‘cc . exe:对不起，未实现:64位模式未编译入’，那么你需要一个Windows gcc端口，比如</em><a class="ae lq" href="https://sourceforge.net/projects/mingw-w64/" rel="noopener ugc nofollow" target="_blank"><em class="hu">https://sourceforge.net/projects/mingw-w64/</em></a><em class="hu">。又见本</em> <a class="ae lq" href="https://github.com/mattn/go-sqlite3/issues/297" rel="noopener ugc nofollow" target="_blank"> <em class="hu"> GitHub一期</em> </a> <em class="hu">。</em></p></blockquote><p id="836f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">使用您最喜欢的编辑器，打开<code class="eh mb mc md me b">comments.go</code>文件并粘贴以下代码行:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="29cc" class="mj kf hu me b fv mk ml l mm mn">package main</span><span id="0647" class="mj kf hu me b fv mo ml l mm mn">import (<br/>    // "database/sql"</span><span id="d079" class="mj kf hu me b fv mo ml l mm mn">    "github.com/labstack/echo"<br/>    "github.com/labstack/echo/middleware"</span><span id="5d16" class="mj kf hu me b fv mo ml l mm mn">    // _ "github.com/mattn/go-sqlite3"<br/>)</span></pre><h1 id="654f" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">配置数据库和路由</h1><p id="ff16" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">每个Go应用都必须有一个<code class="eh mb mc md me b">main</code>函数。这是应用程序执行的起点，所以让我们创建我们的<code class="eh mb mc md me b">main</code>函数:</p><p id="4b60" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在<code class="eh mb mc md me b">comments.go</code>文件中，在导入下面添加以下内容:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="d32a" class="mj kf hu me b fv mk ml l mm mn">func main() {</span><span id="f7ad" class="mj kf hu me b fv mo ml l mm mn">    // Echo instance<br/>    e := echo.New()</span><span id="bb6b" class="mj kf hu me b fv mo ml l mm mn">    // Middleware<br/>    e.Use(middleware.Logger())<br/>    e.Use(middleware.Recover())</span><span id="0fb1" class="mj kf hu me b fv mo ml l mm mn">    // Define the HTTP routes<br/>    e.GET("/comments", func(c echo.Context) error {<br/>        return c.JSON(200, "GET Comments")<br/>    })</span><span id="3ff4" class="mj kf hu me b fv mo ml l mm mn">    e.POST("/comment", func(c echo.Context) error {<br/>        return c.JSON(200, "POST a new Comment")<br/>    })</span><span id="59a3" class="mj kf hu me b fv mo ml l mm mn">    // Start server<br/>    e.Logger.Fatal(e.Start(":9000"))<br/>}</span></pre><p id="c5c9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在main函数中，我们定义了一些基本的route handler函数，这些函数基本上根据请求向浏览器返回硬编码的文本。最后一行将使用Echo的start方法启动Go的标准HTTP服务器，并在端口9000监听请求。</p><p id="0553" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我们可以通过运行应用程序并使用<a class="ae lq" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>发出一些请求来测试应用程序在这个阶段是否工作。</p><p id="6280" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">下面是运行该应用程序的方法:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="96ed" class="mj kf hu me b fv mk ml l mm mn">$ go run ./comments.go</span></pre><p id="359b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我们可以使用Postman发送HTTP请求。下面是一个使用Postman的GET请求示例:</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mp"><img src="../Images/dd42ec0e6b6493020aac7e717986c99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TELON9tmmh5NyRIsNBF9Fw.png"/></div></div></figure><p id="551e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">邮递员的邮寄请求:</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mp"><img src="../Images/3cf8c3155afd0b40301da1449d244b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WBE5uZH42LOZn3sgLygoYA.png"/></div></div></figure><p id="0c8e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我们将创建一个初始化数据库的函数，为此，我们需要SQL和SQLite3驱动程序。我们已经将它们添加到了<code class="eh mb mc md me b">import</code>语句中，所以取消对它们的注释。我们还将创建一个函数，该函数将使用函数中定义的数据库模式来迁移数据库。</p><p id="d42e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">打开<code class="eh mb mc md me b">comments.go</code>文件，在<code class="eh mb mc md me b">main</code>函数前粘贴以下代码:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="d0a6" class="mj kf hu me b fv mk ml l mm mn">func initDB(filepath string) *sql.DB {<br/>    db, err := sql.Open("sqlite3", filepath)<br/>    if err != nil {<br/>        panic(err)<br/>    }</span><span id="80cd" class="mj kf hu me b fv mo ml l mm mn">if db == nil {<br/>        panic("db nil")<br/>    }<br/>    return db<br/>}</span><span id="9f62" class="mj kf hu me b fv mo ml l mm mn">func migrate(db *sql.DB) {<br/>    sql := `<br/>    CREATE TABLE IF NOT EXISTS comments(<br/>            id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,<br/>            name VARCHAR NOT NULL,<br/>            email VARCHAR NOT NULL,<br/>            comment VARCHAR NOT NULL<br/>    );<br/>    `<br/>    _, err := db.Exec(sql)<br/>    if err != nil {<br/>        panic(err)<br/>    }<br/>}</span></pre><p id="de94" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，将以下代码添加到<code class="eh mb mc md me b">main</code>函数的顶部:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="39b3" class="mj kf hu me b fv mk ml l mm mn">// [...]</span><span id="4f6b" class="mj kf hu me b fv mo ml l mm mn">// Initialize the database<br/>db := initDB("storage.db")<br/>migrate(db)</span><span id="da9f" class="mj kf hu me b fv mo ml l mm mn">// [...]</span></pre><p id="6037" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我们现在可以通过运行应用程序来检查这些函数是否被调用，以及数据库是否在执行过程中被创建:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="6f5c" class="mj kf hu me b fv mk ml l mm mn">$ go run comments.go</span></pre><blockquote class="ir is it"><p id="c05f" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> ⚠️如果你已经在运行Go应用程序，你需要使用键盘上的</em><strong class="ix hv"><em class="hu">ctrl+c</em></strong><em class="hu">终止这个进程，然后重启它以查看变化。</em></p></blockquote><p id="dba7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">当应用程序第一次运行时，如果之前不存在一个<code class="eh mb mc md me b">storage.db</code>文件，将在工作目录中创建该文件。</p><h1 id="9b3f" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">设置处理程序</h1><p id="65b4" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">我们已经测试了我们的应用程序监听指定的端口9000，并按照我们的配置处理HTTP请求。然而，当前的处理函数只是将硬编码的文本返回给浏览器，所以让我们创建新的处理函数来处理对路由的响应。</p><p id="860f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在根目录下创建一个名为<code class="eh mb mc md me b">handlers</code>的新文件夹:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="b720" class="mj kf hu me b fv mk ml l mm mn">$ mkdir handlers<br/>$ cd handlers</span></pre><p id="122c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，创建一个<code class="eh mb mc md me b">handlers.go</code>文件并粘贴以下内容:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="dec8" class="mj kf hu me b fv mk ml l mm mn">package handlers</span><span id="a316" class="mj kf hu me b fv mo ml l mm mn">import (<br/>    "database/sql"<br/>    "go-realtime-comments/models"<br/>    "net/http"<br/>    "github.com/labstack/echo"<br/>)</span></pre><p id="c2a6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">现在我们需要返回到<code class="eh mb mc md me b">comments.go</code>文件并导入处理程序包:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="8bae" class="mj kf hu me b fv mk ml l mm mn">import (<br/>    "go-realtime-comments/handlers"</span><span id="862f" class="mj kf hu me b fv mo ml l mm mn">    // [...]<br/>)</span></pre><p id="4893" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在同一文件中，用以下内容替换之前的路由定义:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="6a7b" class="mj kf hu me b fv mk ml l mm mn">// [...]</span><span id="bb11" class="mj kf hu me b fv mo ml l mm mn">// Define the HTTP routes<br/>e.File("/", "public/index.html")<br/>e.GET("/comments", handlers.GetComments(db))<br/>e.POST("/comment", handlers.PushComment(db))</span><span id="179d" class="mj kf hu me b fv mo ml l mm mn">// [...]</span></pre><p id="9396" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，将以下代码粘贴到导入语句下的<code class="eh mb mc md me b">handlers.go</code>文件中:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="9945" class="mj kf hu me b fv mk ml l mm mn">type H map[string]interface{}</span><span id="8c2c" class="mj kf hu me b fv mo ml l mm mn">// GetComments handles the HTTP request that hits the /comments endpoint<br/>func GetComments(db *sql.DB) echo.HandlerFunc {<br/>    return func(c echo.Context) error {<br/>        return c.JSON(http.StatusOK, models.GetComments(db))<br/>    }<br/>}</span><span id="479c" class="mj kf hu me b fv mo ml l mm mn">func PushComment(db *sql.DB) echo.HandlerFunc {<br/>    return func(c echo.Context) error {<br/>        var comment models.Comment</span><span id="73d8" class="mj kf hu me b fv mo ml l mm mn">        c.Bind(&amp;comment)</span><span id="d552" class="mj kf hu me b fv mo ml l mm mn">        id, err := models.PushComment(db, comment.Name, comment.Email, comment.Comment)<br/>        if err == nil {<br/>            return c.JSON(http.StatusCreated, H{<br/>                "created": id,<br/>            })<br/>        }</span><span id="bd1f" class="mj kf hu me b fv mo ml l mm mn">        return err<br/>    }<br/>}</span></pre><p id="be9a" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated"><code class="eh mb mc md me b">GetComments</code>函数从数据库获取并返回评论，而<code class="eh mb mc md me b">PushComment</code>将评论保存到数据库并返回响应。</p><h1 id="bced" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">建立模型</h1><p id="aa39" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">为了创建模型包，我们需要在应用程序的根目录下创建一个新文件夹:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="ffc3" class="mj kf hu me b fv mk ml l mm mn">$ mkdir models     <br/>$ cd models</span></pre><p id="2375" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，创建一个<code class="eh mb mc md me b">models.go</code>文件并粘贴以下代码:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="5c5a" class="mj kf hu me b fv mk ml l mm mn">package models</span><span id="da13" class="mj kf hu me b fv mo ml l mm mn">import (<br/>    "database/sql"</span><span id="cde6" class="mj kf hu me b fv mo ml l mm mn">    _ "github.com/mattn/go-sqlite3"<br/>)</span></pre><p id="3266" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">让我们创建一个注释<code class="eh mb mc md me b">type</code>，它是一个具有四个字段的结构:</p><ul class=""><li id="b466" class="lh li hu ix b iy iz jc jd jt lj ju lk jv ll js lm ln lo lp dt translated"><code class="eh mb mc md me b">ID</code> -评论的ID。</li><li id="a855" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated"><code class="eh mb mc md me b">Name</code> -发表评论的用户的用户名。</li><li id="a076" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated"><code class="eh mb mc md me b">Email</code> -发表评论的用户的电子邮件。</li><li id="6ab5" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated"><code class="eh mb mc md me b">Comment</code> -评论。</li></ul><p id="d040" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在Go中，我们可以将元数据添加到变量中，方法是将它们放在反勾号中。我们可以用它来定义每个字段在转换成<code class="eh mb mc md me b">JSON</code>时应该是什么样子。这也将有助于<code class="eh mb mc md me b">c.Bind</code>函数在注册新注释时知道如何映射<code class="eh mb mc md me b">JSON</code>数据。</p><p id="318f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">让我们定义一下<code class="eh mb mc md me b">Comment</code>和<code class="eh mb mc md me b">CommentCollection</code>的结构。在<code class="eh mb mc md me b">models.go</code>文件下面粘贴以下导入内容:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="574f" class="mj kf hu me b fv mk ml l mm mn">type Comment struct {<br/>    ID      int    `json:"id"`<br/>    Name    string `json:"name"`<br/>    Email   string `json:"email"`<br/>    Comment string `json:"comment"`<br/>}</span><span id="a2af" class="mj kf hu me b fv mo ml l mm mn">type CommentCollection struct {<br/>    Comments []Comment `json:"items"`<br/>}</span></pre><p id="af64" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，在结构后粘贴以下代码:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="4170" class="mj kf hu me b fv mk ml l mm mn">func GetComments(db *sql.DB) CommentCollection {<br/>    sql := "SELECT * FROM comments"<br/>    rows, err := db.Query(sql)</span><span id="035b" class="mj kf hu me b fv mo ml l mm mn">    if err != nil {<br/>        panic(err)<br/>    }</span><span id="4992" class="mj kf hu me b fv mo ml l mm mn">    defer rows.Close()</span><span id="db36" class="mj kf hu me b fv mo ml l mm mn">    result := CommentCollection{}</span><span id="3030" class="mj kf hu me b fv mo ml l mm mn">    for rows.Next() {<br/>        comment := Comment{}</span><span id="b30f" class="mj kf hu me b fv mo ml l mm mn">        err2 := rows.Scan(&amp;comment.ID, &amp;comment.Name, &amp;comment.Email, &amp;comment.Comment)<br/>        if err2 != nil {<br/>            panic(err2)<br/>        }</span><span id="ba4d" class="mj kf hu me b fv mo ml l mm mn">        result.Comments = append(result.Comments, comment)<br/>    }</span><span id="eb06" class="mj kf hu me b fv mo ml l mm mn">    return result<br/>}</span></pre><p id="664a" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated"><code class="eh mb mc md me b">GetComments</code>函数负责从数据库中检索所有可用的注释，并将它们作为我们定义的<code class="eh mb mc md me b">CommentCollection</code>的实例返回。</p><p id="c49b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，将下面的代码粘贴到上面的代码下面:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="08ec" class="mj kf hu me b fv mk ml l mm mn">func PushComment(db *sql.DB, name string, email string, comment string) (int64, error) {<br/>    sql := "INSERT INTO comments(name, email, comment) VALUES(?, ?, ?)"<br/>    stmt, err := db.Prepare(sql)<br/>    if err != nil {<br/>        panic(err)<br/>    }</span><span id="a11e" class="mj kf hu me b fv mo ml l mm mn">    defer stmt.Close()</span><span id="f285" class="mj kf hu me b fv mo ml l mm mn">    result, err2 := stmt.Exec(name, email, comment)<br/>    if err2 != nil {<br/>        panic(err2)<br/>    }</span><span id="f597" class="mj kf hu me b fv mo ml l mm mn">    return result.LastInsertId()<br/>}</span></pre><p id="cfc4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated"><code class="eh mb mc md me b">PushComments</code>功能向数据库添加新的注释。</p><h1 id="5421" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">构建前端</h1><p id="c135" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">接下来，在我们的应用程序的根目录下创建一个<code class="eh mb mc md me b">public</code>文件夹，并在其中创建一个<code class="eh mb mc md me b">index.html</code>文件。</p><p id="d0bd" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">打开<code class="eh mb mc md me b">index.html</code>文件并粘贴以下代码:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="a8f7" class="mj kf hu me b fv mk ml l mm mn">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;<br/>    &lt;link rel="stylesheet" href="<a class="ae lq" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css</a>" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous"&gt;<br/>    &lt;title&gt;Realtime comments&lt;/title&gt;<br/>    &lt;script src="<a class="ae lq" href="https://unpkg.com/axios/dist/axios.min.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/axios/dist/axios.min.js</a>"&gt;&lt;/script&gt;<br/>    &lt;script src="<a class="ae lq" href="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js" rel="noopener ugc nofollow" target="_blank">https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js</a>"&gt;&lt;/script&gt;<br/>    &lt;style&gt;<br/>        <a class="ae lq" href="http://twitter.com/media" rel="noopener ugc nofollow" target="_blank">@media</a> (min-width: 48em) {<br/>        html {<br/>            font-size: 18px;<br/>        }<br/>        }<br/>        body {<br/>        font-family: Georgia, "Times New Roman", Times, serif;<br/>        color: #555;<br/>        }<br/>        h1, .h1, h2, .h2, h3, .h3, h4, .h4, h5, .h5, h6, .h6 {<br/>        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;<br/>        font-weight: 400;<br/>        color: #333;<br/>        }<br/>        .blog-masthead {<br/>        margin-bottom: 3rem;<br/>        background-color: #428bca;<br/>        box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);<br/>        }<br/>        .nav-link {<br/>        position: relative;<br/>        padding: 1rem;<br/>        font-weight: 500;<br/>        color: #cdddeb;<br/>        }<br/>        .nav-link:hover, .nav-link:focus {<br/>        color: #fff;<br/>        background-color: transparent;<br/>        }<br/>        .nav-link.active {<br/>        color: #fff;<br/>        }<br/>        .nav-link.active::after {<br/>        position: absolute;<br/>        bottom: 0;<br/>        left: 50%;<br/>        width: 0;<br/>        height: 0;<br/>        margin-left: -.3rem;<br/>        vertical-align: middle;<br/>        content: "";<br/>        border-right: .3rem solid transparent;<br/>        border-bottom: .3rem solid;<br/>        border-left: .3rem solid transparent;<br/>        }<br/>        <a class="ae lq" href="http://twitter.com/media" rel="noopener ugc nofollow" target="_blank">@media</a> (min-width: 40em) {<br/>        .blog-title {<br/>            font-size: 3.5rem;<br/>        }<br/>        }<br/>        .sidebar-module {<br/>        padding: 1rem;<br/>        }<br/>        .sidebar-module-inset {<br/>        padding: 1rem;<br/>        background-color: #f5f5f5;<br/>        border-radius: .25rem;<br/>        }<br/>        .sidebar-module-inset p:last-child,<br/>        .sidebar-module-inset ul:last-child,<br/>        .sidebar-module-inset ol:last-child {<br/>        margin-bottom: 0;<br/>        }<br/>        .blog-post {<br/>        margin-bottom: 4rem;<br/>        }<br/>        .blog-post-title {<br/>        margin-bottom: .25rem;<br/>        font-size: 2.5rem;<br/>        text-align: center;<br/>        }<br/>        .blog-post-meta {<br/>        margin-bottom: 1.25rem;<br/>        color: #999;<br/>        text-align: center;<br/>        }<br/>        .blog-footer {<br/>        padding: 2.5rem 0;<br/>        color: #999;<br/>        text-align: center;<br/>        background-color: #f9f9f9;<br/>        border-top: .05rem solid #e5e5e5;<br/>        }<br/>        .blog-footer p:last-child {<br/>        margin-bottom: 0;<br/>        }<br/>        input{<br/>            width: 45% !important;<br/>            display: inline-block !important;<br/>        }<br/>        textarea {<br/>            width: 90%;<br/>            height: 150px;<br/>            padding: 12px 20px;<br/>            box-sizing: border-box;<br/>            border: 2px solid #ccc;<br/>            border-radius: 4px;<br/>            background-color: #f8f8f8;<br/>            resize: none;<br/>        }<br/>        textarea:focus, input:focus{<br/>            outline: none !important;<br/>        }<br/>        #comment-section{<br/>        background: rgb(178, 191, 214); <br/>        padding: 0.5em 2em; width: 90%;<br/>        margin: 10px 0;<br/>        border-radius: 15px;<br/>        }<br/>        #comment-section &gt; div &gt; p {<br/>        color: black;<br/>        display:inline;<br/>        }<br/>        img{<br/>        border-radius: 50%;<br/>        float: left;<br/>        }<br/>    &lt;/style&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;div id="app"&gt;<br/>    &lt;header&gt;<br/>        &lt;div class="blog-masthead"&gt;<br/>            &lt;div class="container"&gt;<br/>            &lt;nav class="nav"&gt;<br/>                &lt;a class="nav-link active" href="#"&gt;Home&lt;/a&gt;<br/>            &lt;/nav&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>        &lt;/header&gt;</span><span id="338d" class="mj kf hu me b fv mo ml l mm mn">&lt;main role="main" class="container"&gt;</span><span id="9cd1" class="mj kf hu me b fv mo ml l mm mn">&lt;div class="row"&gt;</span><span id="c494" class="mj kf hu me b fv mo ml l mm mn">&lt;div class="col-sm-12 blog-main"&gt;</span><span id="a60e" class="mj kf hu me b fv mo ml l mm mn">&lt;div class="blog-post"&gt;<br/>                &lt;h2 class="blog-post-title"&gt;Realtime Comments With Pusher&lt;/h2&gt;<br/>                &lt;p class="blog-post-meta"&gt;January 1, 2018 by &lt;a href="#"&gt;Jordan&lt;/a&gt;&lt;/p&gt;<br/>                &lt;p&gt;This blog post shows a few different types of content that's supported and styled with Bootstrap. Basic typography, images, and code are all supported.This blog post shows a few different types of content that's supported and styled with Bootstrap. Basic typography, images, and code are all supported<br/>                &lt;/p&gt;<br/>                &lt;div class="comment-section"&gt;<br/>        &lt;form class="form-signin"&gt;<br/>        &lt;h5 class="comment"&gt;Comment&lt;/h5&gt;<br/>        &lt;input type="username" ref="username" class="form-control" placeholder="John Doe" required autofocus&gt;<br/>        &lt;input type="email" ref="email" class="form-control" placeholder="<a class="ae lq" href="mailto:Johndoe@gmail.com" rel="noopener ugc nofollow" target="_blank">Johndoe@gmail.com</a>" required&gt;<br/>        &lt;textarea ref="comment"&gt;&lt;/textarea&gt;<br/>        &lt;button class="btn btn-lg btn-primary" <a class="ae lq" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>.prevent="sendComment" type="submit"&gt;Comment&lt;/button&gt;<br/>        &lt;/form&gt;<br/>        &lt;br&gt;<br/>        &lt;div id="comment-section" v-for="comment in comments"&gt;<br/>        &lt;div&gt;<br/>            &lt;img src="<a class="ae lq" href="http://merritos.com/img/team/maleTeam.jpg" rel="noopener ugc nofollow" target="_blank">http://merritos.com/img/team/maleTeam.jpg</a>" width="65px" height="65px"&gt;<br/>            &lt;p&gt;&amp;nbsp;&amp;nbsp;{{comment.name}} &amp;nbsp;&lt; {{comment.email}} &gt;&lt;/p&gt;<br/>            &lt;hr&gt;<br/>        &lt;/div&gt;<br/>        &lt;p style="color:black"&gt;{{comment.comment}}&lt;/p&gt;<br/>        &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;/div&gt;</span><span id="00db" class="mj kf hu me b fv mo ml l mm mn">&lt;/div&gt;</span><span id="3757" class="mj kf hu me b fv mo ml l mm mn">&lt;/main&gt;</span><span id="a4f2" class="mj kf hu me b fv mo ml l mm mn">&lt;footer class="blog-footer"&gt;<br/>        &lt;p&gt;&lt;a href="#"&gt;Back to top&lt;/a&gt;&lt;/p&gt;<br/>        &lt;/footer&gt;</span><span id="2689" class="mj kf hu me b fv mo ml l mm mn">&lt;/div&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="b4ef" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">现在，在同一个文件中，将以下代码粘贴到HTML的结束<code class="eh mb mc md me b">body</code>标记之前:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="2091" class="mj kf hu me b fv mk ml l mm mn">&lt;script&gt;<br/>var app = new Vue({<br/>    el: '#app',<br/>    data: {<br/>        comments : []<br/>    },<br/>    created: function() {<br/>        axios.get('/comments').then(response =&gt; { <br/>        this.comments = response.data.items ? response.data.items : [] <br/>        })<br/>    },<br/>    methods: {<br/>        sendComment: function(index) {<br/>            let comment = {<br/>            name: this.$refs.username.value,<br/>            email: this.$refs.email.value,<br/>            comment: this.$refs.comment.value<br/>            }</span><span id="91ca" class="mj kf hu me b fv mo ml l mm mn">axios.post('/comment', comment).then(response =&gt; { <br/>            this.$refs.username.value = '',<br/>            this.$refs.email.value = '',<br/>            this.$refs.comment.value = ''<br/>            })<br/>        }<br/>    }<br/>})<br/>&lt;/script&gt;</span></pre><p id="f820" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">上面是我们应用程序的Vue.js代码，这是它的功能总结:</p><ul class=""><li id="15cb" class="lh li hu ix b iy iz jc jd jt lj ju lk jv ll js lm ln lo lp dt translated">我们实例化了一个包含所有可用注释的注释数组。</li><li id="1987" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated">在<code class="eh mb mc md me b">created()</code>方法中，我们使用<a class="ae lq" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>从API获取所有可用的注释，并将其存储在<code class="eh mb mc md me b">comments</code>数组中。</li><li id="3a4e" class="lh li hu ix b iy lr jc ls jt lt ju lu jv lv js lm ln lo lp dt translated">在<code class="eh mb mc md me b">sendComment</code>方法中，我们向API发送一个创建新的<code class="eh mb mc md me b">comment</code>的请求。</li></ul><p id="ac66" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我们可以在这个阶段构建我们的应用程序，然后访问<a class="ae lq" href="http://localhost:9000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:9000 </a>，我们应该会看到:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="ac08" class="mj kf hu me b fv mk ml l mm mn">$ go run comments.go</span></pre><p id="5c9f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我们的应用程序应该如下所示:</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mq"><img src="../Images/283eac279638067d61562667093eff03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RNIhuZXYSIaRg-5D0wgJ0g.png"/></div></div></figure><h1 id="c660" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">让评论实时显示</h1><p id="cbef" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">我们需要做的下一件事是确保评论被实时显示。为此，我们需要在每次添加新评论时触发一个事件。我们将在后端使用<a class="ae lq" href="https://github.com/pusher/pusher-http-go" rel="noopener ugc nofollow" target="_blank"> Pusher Go库</a>完成这项工作。</p><p id="24d9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">要拉入Pusher Go库，运行以下命令:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="1550" class="mj kf hu me b fv mk ml l mm mn">$ go get github.com/pusher/pusher-http-go</span></pre><p id="0e72" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，让我们导入库。在我们的<code class="eh mb mc md me b">models.go</code>文件中，在imports语句中执行以下操作:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="8794" class="mj kf hu me b fv mk ml l mm mn">package models</span><span id="46db" class="mj kf hu me b fv mo ml l mm mn">import (<br/>    // [...]</span><span id="803e" class="mj kf hu me b fv mo ml l mm mn">    pusher "github.com/pusher/pusher-http-go"<br/>)</span></pre><p id="9541" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在同一个文件中，在<code class="eh mb mc md me b">type</code>定义之前，粘贴以下代码:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="55b4" class="mj kf hu me b fv mk ml l mm mn">// [...]</span><span id="67ca" class="mj kf hu me b fv mo ml l mm mn">var client = pusher.Client{<br/>    AppId:   "PUSHER_APP_ID",<br/>    Key:     "PUSHER_APP_KEY",<br/>    Secret:  "PUSHER_APP_SECRET",<br/>    Cluster: "PUSHER_APP_CLUSTER",<br/>    Secure:  true,<br/>}</span><span id="013d" class="mj kf hu me b fv mo ml l mm mn">// [...]</span></pre><p id="160e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">这里，我们已经使用之前创建的应用程序中的凭证初始化了Pusher客户端。</p><blockquote class="ir is it"><p id="e145" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> ⚠️用你的Pusher app凭证替换</em> <code class="eh mb mc md me b"><em class="hu">PUSHER_APP_*</em></code> <em class="hu">键。</em></p></blockquote><p id="35e0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，让我们在每次注释保存到数据库时触发一个事件。用以下代码替换<code class="eh mb mc md me b">PushComment</code>功能:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="265c" class="mj kf hu me b fv mk ml l mm mn">func PushComment(db *sql.DB, name string, email string, comment string) (int64, error) {<br/>    sql := "INSERT INTO comments(name, email, comment) VALUES(?, ?, ?)"<br/>    stmt, err := db.Prepare(sql)<br/>    if err != nil {<br/>        panic(err)<br/>    }</span><span id="50d2" class="mj kf hu me b fv mo ml l mm mn">    defer stmt.Close()</span><span id="e27a" class="mj kf hu me b fv mo ml l mm mn">    result, err2 := stmt.Exec(name, email, comment)<br/>    if err2 != nil {<br/>        panic(err2)<br/>    }</span><span id="ccb8" class="mj kf hu me b fv mo ml l mm mn">    newComment := Comment{<br/>        Name:    name,<br/>        Email:   email,<br/>        Comment: comment,<br/>    }</span><span id="9152" class="mj kf hu me b fv mo ml l mm mn">    client.Trigger("comment-channel", "new-comment", newComment)</span><span id="f496" class="mj kf hu me b fv mo ml l mm mn">    return result.LastInsertId()<br/>}</span></pre><p id="fad0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在这个新版本的函数中，我们创建了一个<code class="eh mb mc md me b">newComment</code>对象来保存保存到数据库中的最后一条注释的信息。每当创建新的评论时，我们都会将其发送到推送通道<code class="eh mb mc md me b">comment-channel</code>，以便在事件<code class="eh mb mc md me b">new-comment</code>时触发。</p><p id="48f6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated"><strong class="ix hv">在客户端实时显示数据</strong>为了接收评论，我们必须在前端代码中注册<a class="ae lq" href="https://github.com/pusher/pusher-js" rel="noopener ugc nofollow" target="_blank"> Pusher JavaScript客户端</a>。将这行代码添加到index.html文件中HTML的head标签中:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="8277" class="mj kf hu me b fv mk ml l mm mn">&lt;script src="https://js.pusher.com/4.1/pusher.min.js"&gt;&lt;/script&gt;</span></pre><p id="2423" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">接下来，我们将在<code class="eh mb mc md me b">created()</code>生命周期挂钩中注册一个Pusher实例:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="cfc7" class="mj kf hu me b fv mk ml l mm mn">created: function() {<br/>    const pusher = new Pusher('PUSHER_APP_KEY', {<br/>        cluster: 'PUSHER_APP_CLUSTER',<br/>        encrypted: true<br/>    });</span><span id="66e2" class="mj kf hu me b fv mo ml l mm mn">    const channel = pusher.subscribe('comment-channel');</span><span id="c1b6" class="mj kf hu me b fv mo ml l mm mn">    channel.bind('new-comment', data =&gt; {<br/>        this.comments.push(data)<br/>    });</span><span id="eb76" class="mj kf hu me b fv mo ml l mm mn">    // [...]    <br/>}</span></pre><blockquote class="ir is it"><p id="64ac" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><em class="hu"> ⚠️将</em> <code class="eh mb mc md me b"><em class="hu">PUSHER_APP_*</em></code> <em class="hu">键替换为您的Pusher应用的凭证</em></p></blockquote><p id="4cc4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在上面的代码中，我们创建了一个Pusher实例，然后订阅了一个通道。在那个频道，我们正在收听<code class="eh mb mc md me b">new-comment</code>事件。</p><p id="f788" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">现在我们可以运行我们的应用程序了:</p><pre class="jx jy jz ka fq mf me mg mh aw mi dt"><span id="c13e" class="mj kf hu me b fv mk ml l mm mn">$ go run comments.go</span></pre><p id="682b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我们可以将web浏览器指向这个地址<a class="ae lq" href="http://localhost:9000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:9000 </a>，我们应该可以看到应用程序在运行:</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/2f4e529b94132a69e6efd6cf1f59ce1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*qH7sax1zRBE_R3hGABk5zA.gif"/></div></figure><h1 id="7cbf" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">结论</h1><p id="0b35" class="pw-post-body-paragraph iu iv hu ix b iy lc ja jb jc ld je jf jt le ji jj ju lf jm jn jv lg jq jr js hn dt translated">在本文中，我们研究了如何使用Go、Vue.js和Pusher通道构建实时评论系统。该应用的源代码可在<a class="ae lq" href="https://github.com/neoighodaro/realtime-comments-go-pusher" rel="noopener ugc nofollow" target="_blank"> GitHub上获得。</a></p><p id="b429" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">这篇文章最初出现在<a class="ae lq" href="https://pusher.com/tutorials/live-comments-go-vuejs" rel="noopener ugc nofollow" target="_blank"> Pusher博客</a>上。</p></div></div>    
</body>
</html>