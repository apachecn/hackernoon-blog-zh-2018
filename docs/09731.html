<html>
<head>
<title>Leverage the power of open source and don’t reinvent the wheel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用开源的力量，不要重新发明轮子</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/leverage-the-power-of-open-source-and-dont-reinvent-the-wheel-9f7c82042b19?source=collection_archive---------11-----------------------#2018-12-01">https://medium.com/hackernoon/leverage-the-power-of-open-source-and-dont-reinvent-the-wheel-9f7c82042b19?source=collection_archive---------11-----------------------#2018-12-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/53f5d008b4a714103c984c90fdfeac20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zjK4zNZZc1werueB"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rawpixel</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8ca7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这篇文章中，我将谈论我如何需要一个实用程序，以及我如何克隆和修改一个存储库来实现我所需要的。</p><h2 id="5fd9" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">介绍</h2><p id="5ce2" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">我在<a class="ae jg" href="https://waveapplication.com/" rel="noopener ugc nofollow" target="_blank"> waveapplication </a>所做的事情之一是使用calabash进行自动化测试，以确保应用在发布到应用商店之前的质量。我们正在努力实现完整的持续集成和持续交付，为此，我们需要端到端的功能测试(除了单元和集成测试)。在这个特定的案例中，我需要在Android设备上伪造GPS位置。</p><h2 id="ba7e" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">要求</h2><p id="7577" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">鉴于我将需要这个实用程序来设置应用程序到一个特定的状态，以便检查应用程序的特定特性/功能，我有如下具体要求。</p><ul class=""><li id="df1f" class="lf lg hu jj b jk jl jo jp js lh jw li ka lj ke lk ll lm ln dt translated">基于终端的实用程序</li><li id="65ad" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke lk ll lm ln dt translated">轻量级选手</li><li id="be20" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke lk ll lm ln dt translated">能够复制作为<em class="lt">传递给它的路线。gpx </em>文件。</li></ul><h2 id="7fc5" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">研究</h2><p id="5b1c" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">在开始疯狂编码之前，我停下来对完成给定任务的可用方法和技术做了一些研究。我发现android的ADB为开发者提供了改变设备位置的特定命令。</p><h2 id="228f" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><code class="eh lu lv lw lx b">geo fix</code></h2><p id="c536" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">给定十进制度数的两个参数(<code class="eh lu lv lw lx b">Longitude</code>和<code class="eh lu lv lw lx b">Latitude</code>)和可选参数<code class="eh lu lv lw lx b">satelites</code>和<code class="eh lu lv lw lx b">altitude</code>，它将android设备的位置模拟为给定的参数。<br/>一旦我知道整个项目可以用<code class="eh lu lv lw lx b">geo fix</code>完成，我就寻找已经实现了这个功能的开源库，因为我确信它们的存在。我找到的第一个项目是由<a class="ae jg" href="https://github.com/luv" rel="noopener ugc nofollow" target="_blank"> luv </a>创建的<a class="ae jg" href="https://github.com/luv/mockgeofix" rel="noopener ugc nofollow" target="_blank"> mockgeofix </a>这个库满足了我的所有要求，除了一个要求，它需要一个安装在android设备上的应用程序来模拟设备的位置。这对我来说不是一个选项，但是我还是决定克隆这个库并尝试一下。</p><h2 id="d60d" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">远程登录</h2><p id="c8c5" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">这将用于向给定端口和IP的android设备发送<code class="eh lu lv lw lx b">geo-fix</code>命令。</p><h2 id="660f" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">让mockgeofix适应我的特定需求</h2><p id="61a9" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">这个工具有我需要的一切来模拟设备的GPS定位。它甚至可以根据给定的公里/小时速度调整路线。唯一不符合我要求的是需要一个外部应用程序才能工作，但幸运的是，有一个替代方案。这些是我根据自己的需要调整实用程序的步骤。</p><h2 id="1cc9" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">克隆存储库并删除我不需要的代码。</h2><p id="9f43" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">当我检查完代码后，我删除了所有的java代码(用于android应用程序),只保留了我感兴趣的文件<code class="eh lu lv lw lx b">run_sim.py</code>和它所依赖的所有文件。我还创建了一个<code class="eh lu lv lw lx b">requirements.txt</code>文件来简化启动和运行代码所需的过程。</p><h2 id="30cf" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">添加telnet所需的includes和telnet安全验证的参数</h2><p id="4a0a" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">要使用Telnet，该程序要求您输入位于<code class="eh lu lv lw lx b">~/.emulator_console_auth_token</code>的安全密码。这向客户端授予了执行<code class="eh lu lv lw lx b">geo fix</code>等方法的权限。这意味着我必须在代码中包含参数选项。</p><h2 id="81f2" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">改编主线</h2><p id="c9d2" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">这个线程连接到android应用程序，然后向它发送<code class="eh lu lv lw lx b">geo fix</code>命令。现在，它只需通过telnet连接到手机，并直接向其发送命令。</p><pre class="ly lz ma mb fq mc lx md me aw mf dt"><span id="6db0" class="kf kg hu lx b fv mg mh l mi mj">def start_geofix(args):<br/>    # Start the telnet connection<br/>    tn = telnetlib.Telnet(args.ip, args.port)<br/>    # Wait until keyword "OK" appears<br/>    tn.read_until("OK")<br/>    # Perform security verification<br/>    # The code is located in ~/.emulator_console_auth_token<br/>    tn.write("auth " + args.auth + "\n")<br/>    tn.read_until("OK")<br/>    while True:<br/>        # Send "geo fix" commands forever<br/>        tn.write("geo fix %f %f\r\n" % (curr_lon, curr_lat))<br/>        time.sleep(UPDATE_INTERVAL)</span></pre><h2 id="f652" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">如何运行代码:</h2><h2 id="1b15" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">要求</h2><ol class=""><li id="c37a" class="lf lg hu jj b jk la jo lb js mk jw ml ka mm ke mn ll lm ln dt translated"><a class="ae jg" href="https://www.python.org/downloads/release/python-2715/" rel="noopener ugc nofollow" target="_blank"> python 2.7 </a></li><li id="020f" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke mn ll lm ln dt translated"><a class="ae jg" href="https://virtualenv.pypa.io/en/latest/" rel="noopener ugc nofollow" target="_blank">虚拟人</a></li></ol><h2 id="caf2" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">使用</h2><p id="44b3" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">注意:要工作，这需要连接的设备或运行的模拟虚拟设备</p><ol class=""><li id="d81a" class="lf lg hu jj b jk jl jo jp js lh jw li ka lj ke mn ll lm ln dt translated"><code class="eh lu lv lw lx b">git clone git@github.com:SergioRosello/mockgeofix.git</code></li><li id="fd0a" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke mn ll lm ln dt translated">在项目根目录:<code class="eh lu lv lw lx b">source ENV/bin/activate</code></li><li id="9d6b" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke mn ll lm ln dt translated">在项目根目录:<code class="eh lu lv lw lx b">pip install -r requirements.txt</code></li><li id="5008" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke mn ll lm ln dt translated">在项目根目录:<code class="eh lu lv lw lx b">python run_sim.py -i targetIP -g path/to/gpx/file.gpx -t emulatorConsoleAuthToken</code></li></ol><h2 id="b51a" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><code class="eh lu lv lw lx b">run_sym.py</code>的参数</h2><p id="b0af" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">下面是<code class="eh lu lv lw lx b">run\_sym.py</code>脚本使用的参数列表。</p><h2 id="92b9" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">必需的参数</h2><ul class=""><li id="3782" class="lf lg hu jj b jk la jo lb js mk jw ml ka mm ke lk ll lm ln dt translated"><code class="eh lu lv lw lx b">-i</code>或<code class="eh lu lv lw lx b">--ip</code>:查找设备的ip地址</li><li id="0d64" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke lk ll lm ln dt translated"><code class="eh lu lv lw lx b">-g</code>或<code class="eh lu lv lw lx b">--gpx-file</code>:用于追踪路线的<code class="eh lu lv lw lx b">.gpx</code>文件</li><li id="8620" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke lk ll lm ln dt translated"><code class="eh lu lv lw lx b">-t</code>或<code class="eh lu lv lw lx b">--auth</code>:用于telnet认证的认证令牌</li></ul><h2 id="c000" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">非必需参数</h2><ul class=""><li id="451c" class="lf lg hu jj b jk la jo lb js mk jw ml ka mm ke lk ll lm ln dt translated"><code class="eh lu lv lw lx b">-p</code>或<code class="eh lu lv lw lx b">-port</code>:用于连接的端口。默认值:5554</li><li id="bc01" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke lk ll lm ln dt translated"><code class="eh lu lv lw lx b">-S</code>或<code class="eh lu lv lw lx b">--sleep</code>:在轨迹点之间睡眠。默认值:0.5</li><li id="af33" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke lk ll lm ln dt translated"><code class="eh lu lv lw lx b">-s</code>或<code class="eh lu lv lw lx b">--speed</code>:以km/h为单位的速度(优先于-S)</li><li id="1e95" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke lk ll lm ln dt translated"><code class="eh lu lv lw lx b">-I</code>或<code class="eh lu lv lw lx b">--listen-ip</code>:运行一个HTTP服务器，可视化这个ip上被模仿的位置</li><li id="a98e" class="lf lg hu jj b jk lo jo lp js lq jw lr ka ls ke lk ll lm ln dt translated"><code class="eh lu lv lw lx b">-P</code>或<code class="eh lu lv lw lx b">--listen-port</code> : HTTP服务器的端口。默认值:80</li></ul><h2 id="6434" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">决赛成绩</h2><p id="99fd" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">项目的最终状态可以在这里看到<a class="ae jg" href="https://github.com/SergioRosello/mockgeofix" rel="noopener ugc nofollow" target="_blank">。它利用telnet的能力与电话通信，以便删除之前发送<code class="eh lu lv lw lx b">geo fix</code>命令所必需的应用程序。最后，这段代码完成了前面列出的所有需求，我可以用它在端到端功能测试中模拟一条路由。</a></p><h2 id="485a" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">结论</h2><p id="03be" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">这个项目是我拥有的第一批真正的开源体验之一。这就是开源的意义所在。与世界各地的开发人员合作，使事情变得更容易。这真的是一件非常美好的事情。</p></div></div>    
</body>
</html>