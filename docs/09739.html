<html>
<head>
<title>How to deploy a Laravel web app on Google App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google App Engine上部署Laravel web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-deploy-a-laravel-web-app-on-google-app-engine-ecfbb0d49b00?source=collection_archive---------1-----------------------#2018-12-03">https://medium.com/hackernoon/how-to-deploy-a-laravel-web-app-on-google-app-engine-ecfbb0d49b00?source=collection_archive---------1-----------------------#2018-12-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/f5834fe2ace2ce207b4cef16f2b641ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vsPF6NJ-uwwX0qf6zjuf8Q.png"/></div></div></figure><p id="3cc2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">升级建造独角兽。我们的开发者经历了很多。这些是他们的故事。这是由我们的高级应用程序设计师之一因陀罗讲述的。</p><blockquote class="ka kb kc"><p id="dc41" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">因陀罗:我是一名经验丰富的软件工程师和团队领导。我对我的项目了如指掌——我必须这样做。我负责确保所有部件都组装在一起，服务器正常运行，最困难的任务得以完成。当我不做那件事的时候，我在大学教书和做研究。我无时无刻不渴望提升自己的技能，把自己知道的东西传授给别人。</p></blockquote><p id="b55c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">本周，我们有一个客户希望他的Laravel web应用程序部署在Google App Engine中。这有多种原因:</p><ul class=""><li id="bffa" class="kh ki hu je b jf jg jj jk jn kj jr kk jv kl jz km kn ko kp dt translated">成本(<a class="ae kq" href="https://www.rightscale.com/blog/cloud-cost-analysis/aws-vs-azure-vs-google-cloud-pricing-compute-instances" rel="noopener ugc nofollow" target="_blank">据报道比亚马逊</a>便宜)</li><li id="b90d" class="kh ki hu je b jf kr jj ks jn kt jr ku jv kv jz km kn ko kp dt translated">多区域</li><li id="8bd9" class="kh ki hu je b jf kr jj ks jn kt jr ku jv kv jz km kn ko kp dt translated">自动缩放</li></ul><p id="226b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此外，我们已经在这个特定的应用程序中使用了很多Google APIs，所以这看起来是一件非常容易的工作。</p><p id="365f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你看怪不怪这并不容易。但我最终成功了。</p><p id="53bd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过这次经历，我艰难地发现几乎没有任何关于这个话题的信息。我能找到的唯一一个教程发布在谷歌社区上，它缺少很多细节。</p><p id="b85b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">在开始之前:</strong> <br/> <em class="kd">我建议在开始使用Google App Engine部署Laravel应用程序之前阅读整篇文章。准备好一切。然后才进行部署。否则你可能会像我一样，失去很多时间，给自己压力。</em></p><p id="35f3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">免责声明:</strong> <br/> <em class="kd">虽然我没有对nginx的设置做任何修改，但我会在以后的教程中谈到它。我正在考虑做一个关于添加自定义域和我遇到的问题的教程。但是YouTube上已经有一些关于这个话题的非常好的教程了。</em></p><p id="f2c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kd">此外，我在本教程中使用了标准的MySQL，但是也可以使用大数据。因为我不想让这篇博客难以阅读，在某些部分，我添加了链接和YouTube视频，而不是图片。</em></p><p id="d4b8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kd">Google上缺少一些关于PHP部署的文档，所以我在一些地方用Python的文档替换了它。如果你打算按照Google文档来部署一个带有Google App Engine的Laravel应用程序，我强烈推荐你看一看这两者。</em></p><h2 id="025b" class="kw kx hu bd ky kz la lb lc ld le lf lg jn lh li lj jr lk ll lm jv ln lo lp lq dt translated"><strong class="ak">先决条件阅读</strong>(可以跳到<strong class="ak"> <em class="lr">准备</em>部署</strong>)</h2><p id="8bcc" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">1.<a class="ae kq" href="https://cloud.google.com/shell/docs/quickstart" rel="noopener ugc nofollow" target="_blank">谷歌云壳</a></p><p id="927d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.<a class="ae kq" href="https://cloud.google.com/php/docs" rel="noopener ugc nofollow" target="_blank">谷歌云平台上的PHP</a></p><p id="f42c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将使用灵活的环境，请阅读相关内容。</p><p id="aff9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.(可选)<a class="ae kq" href="https://cloud.google.com/python/docs/?hl=zh-TW" rel="noopener ugc nofollow" target="_blank">Python文档</a></p><h1 id="1822" class="lx kx hu bd ky ly lz ma lc mb mc md lg me mf mg lj mh mi mj lm mk ml mm lp mn dt translated"><strong class="ak">准备部署</strong></h1><p id="ab6a" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">1.创建一个谷歌云账户:<a class="ae kq" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">这里</a>或者更直接<a class="ae kq" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="ef9f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">目前，你可以获得365天或300美元的信用免费试用(以先到者为准)。除非你是一个非常老的用户(测试版)，你也将被要求添加您的信用卡，但你不会被收费。</p><p id="f4e1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.创建一个新项目(快速视频<a class="ae kq" href="https://youtu.be/7n9DkOzjwlA?t=35s" rel="noopener ugc nofollow" target="_blank">此处</a>如果需要)</p><p id="c6ae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.创建一个应用引擎实例(如果需要，在此处快速视频<a class="ae kq" href="https://www.youtube.com/watch?v=GZfV2O0orVo" rel="noopener ugc nofollow" target="_blank"/></p><p id="e36e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.我们将使用<a class="ae kq" href="https://cloud.google.com/shell/docs/quickstart" rel="noopener ugc nofollow" target="_blank"> Google Cloud Shell </a>进行部署</p><p id="4385" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了能够使用它，你需要<a class="ae kq" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank">为你的操作系统下载cloud SDK </a>。</p><p id="fba2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于一些设置，你可以直接从你的浏览器使用云壳，见<a class="ae kq" href="https://youtu.be/elnKjoUgSJE" rel="noopener ugc nofollow" target="_blank">这里</a>。我不使用它，但是阅读文档来了解如何使用。但是你真的应该安装它以便于使用。</p><p id="5b74" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您运行Windows，您需要以管理员权限打开安装程序。遵循谷歌为其他操作系统提供的快速入门教程。</p><p id="4c71" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.在你继续使用Google Cloud Shell之前，我推荐<a class="ae kq" href="https://cloud.google.com/php/docs/?hl=zh-TW" rel="noopener ugc nofollow" target="_blank">阅读这篇关于PHP环境的</a>。</p><p id="17f4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">6.使用命令<strong class="je hv"> gcloud auth login </strong>登录控制台。您将通过浏览器登录。如果你想看到所有可用的命令，在命令行中写下<strong class="je hv">gloud</strong>T24】help并按下<strong class="je hv">回车</strong>。</p><p id="72ce" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">7.在命令行中编写<strong class="je hv">g cloud config set project project _ id</strong>，其中<strong class="je hv"> project_ id </strong>是您刚刚赋予新创建项目的项目id。在<em class="kd">项目信息</em>小部件下选择项目后，可以在谷歌控制台的第一页找到它。</p><p id="e070" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">8.要查看您所有项目的列表，请键入<strong class="je hv"> gcloud项目列表</strong>。</p><p id="809c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是它的先决条件。我们将继续进行所需的数据库设置和下载。</p><h1 id="120d" class="lx kx hu bd ky ly lz ma lc mb mc md lg me mf mg lj mh mi mj lm mk ml mm lp mn dt translated"><strong class="ak">准备您的项目</strong></h1><p id="fd6c" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">对于这一部分，我使用了本教程作为灵感。您可以阅读它，也可以完全跳过它，因为我将介绍部署所需的所有步骤，除了文件存储部分。为此，我会给你一些信息，但不是一个完整的教程。</p><p id="668b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我将使用一个我正在构建的应用程序作为例子。一个简单的博客有作为管理面板的拉勒维尔的<a class="ae kq" href="https://backpackforlaravel.com" rel="noopener ugc nofollow" target="_blank">背包。既然我们在这里，我必须让你知道Vue.js与Google App Engine兼容。你只需要运行<strong class="je hv"> npm install </strong>和<strong class="je hv"> npm run prod </strong>就可以了。在本教程中，我们将不会使用Vue.js。</a></p><p id="8023" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.将目录更改为您的应用程序文件夹。</p><p id="fe68" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了便于使用，您可以像这样设置:</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="d8eb" class="kw kx hu mt b fv mx my l mz na">TUTORIALDIR= C:/Code/updivision-laravel-demo/</span><span id="f551" class="kw kx hu mt b fv nb my l mz na">git clone https://github.com/Updivision/laravel-demo-google-cloud.git $TUTORIALDIR</span><span id="1a4e" class="kw kx hu mt b fv nb my l mz na">cd $TUTORIALDIR</span><span id="7266" class="kw kx hu mt b fv nb my l mz na">git checkout phase0-helloworld</span></pre><p id="5e75" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们需要创建一个<strong class="je hv"> app.yaml </strong>文件。在composer.json的同一级别手动创建即可。</p><p id="fc6b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.现在我们有了文件，我们需要设置数据库和项目细节。</p><p id="515d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.为了设置项目详细信息，我们将不使用。请按照我的app.yaml示例中添加的注释来理解我是如何编写它的。</p><p id="5013" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它需要看起来像这样:</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="d748" class="kw kx hu mt b fv mx my l mz na">runtime: php  # language of the app<br/>env: flex     # let app engine know we use flexible environment</span><span id="d0b0" class="kw kx hu mt b fv nb my l mz na">runtime_config:<br/> document_root: public   #folder where index.php is</span><span id="5e5b" class="kw kx hu mt b fv nb my l mz na"># Ensure we skip ".env", which is only for local development<br/>skip_files:<br/> - .env #we want to skip this to make sure we don’t mess stuff up on the server</span><span id="d056" class="kw kx hu mt b fv nb my l mz na">env_variables:<br/> # Put production environment variables here.<br/> APP_ENV: local   # or production<br/> APP_DEBUG : true # or false <br/> APP_KEY: base64:FqwXmLtL6szdWqIVydb7nKs2eyvHib4lf6d5l6A/XW4= <br/>#go to generate app key paragraf in this tutorial</span><span id="baa1" class="kw kx hu mt b fv nb my l mz na"> CACHE_DRIVER: database</span><span id="433d" class="kw kx hu mt b fv nb my l mz na"># instead of putting the cache in the database I recommend using redis<br/> SESSION_DRIVER: database #or file since both work</span><span id="4dae" class="kw kx hu mt b fv nb my l mz na"> APP_LOG: daily<br/> APP_TIMEZONE: UTC #your timezone of choice<br/></span><span id="ee90" class="kw kx hu mt b fv nb my l mz na"># follow the part of the tutorial on setting up your SQL database<br/> DB_CONNECTION: mysql<br/> DB_HOST: localhost<br/> DB_DATABASE: instance_id<br/> DB_USERNAME: database_user_name<br/> DB_PASSWORD: database_password<br/> DB_SOCKET: /cloudsql/instance_name</span><span id="275a" class="kw kx hu mt b fv nb my l mz na"> QUEUE_DRIVER: database #in case you execute queued jobs</span><span id="b120" class="kw kx hu mt b fv nb my l mz na"> MAIL_DRIVER: smtp<br/> MAIL_HOST: smtp.sparkpostmail.com<br/> MAIL_PORT: 587<br/> MAIL_USERNAME: sparkpost_username<br/> MAIL_PASSWORD: ****************</span><span id="6a18" class="kw kx hu mt b fv nb my l mz na"> LOG_DELETE:  true # this is a parameter added by us in the project .env file. You can add here any setting you would add to your .env file</span><span id="4f17" class="kw kx hu mt b fv nb my l mz na"> GOOGLE_VISION_PROJECT_ID : project_id</span><span id="f5b6" class="kw kx hu mt b fv nb my l mz na">#we need this for the flex environment<br/>beta_settings:<br/>   # for Cloud SQL, set this value to the Cloud SQL connection name,<br/>   # e.g. "project:region:cloudsql-instance"<br/>   cloud_sql_instances: project:cloudsql-instance</span></pre><p id="5f4d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.生成应用密钥。</p><p id="db5e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要为Laravel安装生成应用程序密钥，我们需要运行:</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="2171" class="kw kx hu mt b fv mx my l mz na">php artisan key:generate --show</span></pre><p id="49b2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后复制粘贴到app.yaml中。</p><p id="89b2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.更新composer.json以符合Google App Engine要求。</p><p id="02e0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在脚本中，添加如下脚本。在<strong class="je hv"> post-install-cmd </strong>脚本中，有一个添加<strong class="je hv"> php artisan cache:clear </strong>的建议，但是根据我使用Google deploy的经验，这不起作用。这就是为什么我建议不要写它。在这个composer.json示例中，我只添加了最少的Laravel包。</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="de08" class="kw kx hu mt b fv mx my l mz na">{<br/>   "name": "laravel/laravel",<br/>   "description": "The Laravel Framework.",<br/>   "keywords": ["framework", "laravel"],<br/>   "license": "MIT",<br/>   "type": "project",<br/>   "require": {<br/>       "php": "7.1.*",<br/>       "fideloper/proxy": "~3.3",<br/>       "laravel/framework": "5.5.*",<br/>       "laravel/tinker": "~1.0"<br/>   },<br/>   "require-dev": {<br/>       "filp/whoops": "~2.0",<br/>       "fzaninotto/faker": "~1.4",<br/>       "mockery/mockery": "~1.0",<br/>       "phpunit/phpunit": "~6.0",<br/>       "symfony/thanks": "^1.0"<br/>   },<br/>   "autoload": {<br/>       "classmap": [<br/>           "database/seeds",<br/>           "database/factories"<br/>       ],<br/>       "psr-4": {<br/>           "App\\": "app/"<br/>       }<br/>   },<br/>   "autoload-dev": {<br/>       "psr-4": {<br/>           "Tests\\": "tests/"<br/>       }<br/>   },<br/>   "extra": {<br/>       "laravel": {<br/>           "dont-discover": [<br/>           ]<br/>       }<br/>   },<br/>   "scripts": {</span><span id="5cfd" class="kw kx hu mt b fv nb my l mz na">"post-root-package-install": [<br/>           "@php -r \"file_exists('.env') || copy('.env.example', '.env');\""<br/>       ],<br/>       "post-create-project-cmd": [<br/>           "@php artisan key:generate"<br/>       ],<br/>       "post-autoload-dump": [<br/>           "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",<br/>           "@php artisan package:discover"<br/>       ],<br/>       "post-install-cmd": [<br/>           "Illuminate\\Foundation\\ComposerScripts::postInstall",<br/>           "@php artisan optimize",<br/>           "chmod -R 755 bootstrap\/cache"<br/>       ],<br/>       "post-update-cmd": [<br/>           "Illuminate\\Foundation\\ComposerScripts::postUpdate",<br/>           "@php artisan optimize"<br/>       ],<br/>       "post-autoload-dump": [<br/>           "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",<br/>           "@php artisan package:discover"<br/>       ]<br/>   },<br/>   "config": {<br/>       "preferred-install": "dist",<br/>       "sort-packages": true,<br/>       "optimize-autoloader": true<br/>   }<br/>}</span></pre><p id="f690" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">7.在google sdk命令行中运行<strong class="je hv"> gcloud app deploy </strong>(你必须在应用文件夹中)并在提示时回答<strong class="je hv"> Y </strong>。</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="da11" class="kw kx hu mt b fv mx my l mz na">descriptor:      [\blog\app.yaml]<br/>source:          [\blog]<br/>target project:  [updivision-laravel-demo-197514]<br/>target service:  [default]<br/>target version:  [20180309t203424]<br/>target url:      [https://updivision-laravel-demo-197514.appspot.com]<br/></span><span id="7205" class="kw kx hu mt b fv nb my l mz na">Do you want to continue (Y/n)?  Y</span></pre><p id="4df9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">8.运行<strong class="je hv"> gcloud app浏览</strong>查看你的应用。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/f6ae85a9105a6945ec8a83f02648570a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jgVh_8F1Vnj-GvIW.PNG"/></div></div></figure><h1 id="59b5" class="lx kx hu bd ky ly lz ma lc mb mc md lg me mf mg lj mh mi mj lm mk ml mm lp mn dt translated">设立cron jobs </h1><p id="2bce" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">下面是设置cron作业的<a class="ae kq" href="https://cloud.google.com/appengine/docs/standard/php/config/cron" rel="noopener ugc nofollow" target="_blank"> Google教程</a>。我还看了一下<a class="ae kq" href="https://cloud.google.com/appengine/docs/standard/python/config/cron" rel="noopener ugc nofollow" target="_blank">的Python版本</a>。当有一个Laravel应用程序时，知道如何用Google App Engine设置cron作业是最基本的。我们的应用程序有很多运行中的时间表，我很难让它们工作或在网上找到答案。幸运的是，我们在亚马逊遇到了同样的问题，并且已经知道了解决方法。我用谷歌应用引擎和哈利路亚试过了！</p><p id="daef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.创建一个cron.yaml文件并添加以下代码:</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="c264" class="kw kx hu mt b fv mx my l mz na">cron:<br/>- description: "daily laravel cron"<br/> url: /scheduler<br/> schedule: every 1 mins<br/> retry_parameters:<br/>     min_backoff_seconds: 2.5<br/>     max_doublings: 5</span></pre><p id="7d31" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.在您的路由中，您需要像这样添加调度程序路由(在任何中间件之外):</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="c5e4" class="kw kx hu mt b fv mx my l mz na">Route::get('scheduler', function (){<br/>   \Illuminate\Support\Facades\Artisan::call('schedule:run');<br/>});</span></pre><p id="76fc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.运行<strong class="je hv"> gcloud app部署cron.yaml </strong> <br/> 4。您可以在App Engine任务队列中查看您的crons或手动运行它们。</p><h1 id="4daa" class="lx kx hu bd ky ly lz ma lc mb mc md lg me mf mg lj mh mi mj lm mk ml mm lp mn dt translated"><strong class="ak">设置SQL数据库</strong></h1><p id="c524" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">这似乎让一些人晕头转向，所以我会尽量让它简单直观。我这里还加了一个快速视频<a class="ae kq" href="https://youtu.be/jwtHsT4EmzA" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="9f5c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.转到您的谷歌云控制台。<br/> 2。在菜单中查找SQL并单击它。<br/> 3。单击创建实例并选择MySQL。<br/> 4。选择第二代，并选择一个id和密码。<br/> 5。你的情况越来越糟。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/25e0099781330c8907bd79d6f92a3325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vexQT8WAs8So9Bjq.PNG"/></div></div></figure><p id="a04c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">6.现在复制实例连接名，粘贴到你的app.yaml中<strong class="je hv">beta _ setting cloud _ SQL _ instances:instance _ connection _ name</strong>。</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="3950" class="kw kx hu mt b fv mx my l mz na">beta_settings:<br/>   # for Cloud SQL, set this value to the Cloud SQL connection name,<br/>   # e.g. "project:region:cloudsql-instance"<br/>   cloud_sql_instances: instance_connection_name</span></pre><p id="d35f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">7.还要完成app.yaml中的数据库连接数据。</p><p id="9b4d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">复制实例id并将其粘贴到DB_DATABASE。<br/>然后复制实例连接名，添加到/cloudsql/ for DB_SOCKET之后。</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="3518" class="kw kx hu mt b fv mx my l mz na">DB_CONNECTION: mysql<br/>DB_HOST: localhost<br/>DB_PORT: 3306<br/>DB_DATABASE: instance_id<br/>DB_USERNAME: root<br/>DB_PASSWORD: ***************<br/>DB_SOCKET: /cloudsql/instance_connection_name</span></pre><p id="4993" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">8.再次部署应用程序。</p><p id="2b4c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">9.数据库现在是空的，我得到这个错误:</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/f4c85e7bc4fe42344e8cdce1cbaca889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jGg5LmvGGNDFpFWa.PNG"/></div></div></figure><p id="68d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">10.连接到数据库:</p><ul class=""><li id="955e" class="kh ki hu je b jf jg jj jk jn kj jr kk jv kl jz km kn ko kp dt translated">使用证书(请参阅本文的查看数据部分)。</li><li id="e27d" class="kh ki hu je b jf kr jj ks jn kt jr ku jv kv jz km kn ko kp dt translated">使用命令行(请参阅本文的运行迁移部分)。</li></ul><h1 id="8ad8" class="lx kx hu bd ky ly lz ma lc mb mc md lg me mf mg lj mh mi mj lm mk ml mm lp mn dt translated"><strong class="ak">导入包含数据的完全迁移的数据库</strong></h1><p id="a084" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">要在新创建的数据库中导入完整的数据库，您需要使用Google Bucket。</p><p id="95a5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.转储当前数据库。</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="7e89" class="kw kx hu mt b fv mx my l mz na">mysqldump -uuser -p your_database &gt; your_database_dump.sql</span></pre><p id="f0a0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.转到您的仪表板，在左侧菜单中单击“Storage”。选择一个存储桶并上传您的数据库转储文件<br/> 3。转到您的谷歌控制台仪表板，点击您的实例id</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/7a67fd488ee436eb799196d2ace9e8a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LugrXOG67q0goXHw.PNG"/></div></div></figure><p id="fef3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.点击导入。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/b586d7554549010104be6ff046e1c759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3FHvsOkZ5kGi3UVX.PNG"/></div></div></figure><p id="5fce" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.选择您在步骤2上传的文件。<br/> 6。单击高级选项，并在数据库下选择数据库的名称。7。单击导入。</p><h1 id="96a3" class="lx kx hu bd ky ly lz ma lc mb mc md lg me mf mg lj mh mi mj lm mk ml mm lp mn dt translated"><strong class="ak">查看数据</strong></h1><p id="c3de" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">查看数据的推荐方式，至少在我的经验中，是使用Workbench和Google提供的证书。对于这一部分，我使用了<a class="ae kq" href="https://cloud.google.com/sql/docs/mysql/external-connection-methods" rel="noopener ugc nofollow" target="_blank">这个文档</a>作为灵感。</p><p id="553f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.转到您的谷歌控制台仪表板，并点击您的实例id。<br/> 2。在屏幕顶部(图表的正上方)，选择SSL。<br/> 3。向下滚动并点击创建一个客户端证书，并将它们存储在您的计算机上。我建议每台电脑一个，但这取决于你。<br/> 4。打开MySQL Workbench，在connection选项卡中完成Overview tab = &gt;中的详细信息，连接到这个正方形实例(主要用于ip)。使用与app.yaml相同的用户和密码。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/a4e65823a467cb3a2f27de7366e08c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mmUTzWlcpTk5wfMy.PNG"/></div></div></figure><p id="ac65" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并在SSL选项卡中添加您刚刚下载的证书。在使用ssl下拉列表中选择必需。现在您可以访问您的数据库了。</p><p id="c9cb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">本教程的下一步也是最后一步是运行迁移和种子程序，但是如果您已经得到了您需要的所有东西，可以跳过它。</p><figure class="mo mp mq mr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/a3dd46ac38eb6d1403375887a1064f31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9ia-UqV0Yh4KxzEA.PNG"/></div></div></figure><h1 id="db0f" class="lx kx hu bd ky ly lz ma lc mb mc md lg me mf mg lj mh mi mj lm mk ml mm lp mn dt translated"><strong class="ak">运行迁移和播种</strong></h1><p id="59c8" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">要运行迁移和播种程序，你需要做一些黑客的工作，但是如果你找到了其他方法，请在下面的评论中告诉我，因为我一直在寻找一个更优雅的方法。</p><p id="4137" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.去下载<a class="ae kq" href="https://cloud.google.com/sql/docs/mysql/sql-proxy" rel="noopener ugc nofollow" target="_blank">代理文件</a>。<br/> 2。在Google Cloud控制台中，将目录更改为您下载文件的目录。<br/> 3。创建一个<a class="ae kq" href="https://cloud.google.com/sql/docs/mysql/sql-proxy#create-service-account" rel="noopener ugc nofollow" target="_blank">服务账户文件</a>。<br/> 4。运行以下命令:</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="70a0" class="kw kx hu mt b fv mx my l mz na">cloud_sql_proxy_x64.exe -instances=your_instance_connection_nameive=tcp:3306 -credential_file=path/to/service_account_file &amp;</span></pre><p id="a727" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.在你的。env文件把你的数据库和密码从谷歌和使用本地主机作为主机。<br/> 6。在命令行中，像平常一样运行任何迁移或播种命令。</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="7581" class="kw kx hu mt b fv mx my l mz na">php artisan migrate --seed</span></pre><p id="a495" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">或者您可以运行单个播种机:</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="02d8" class="kw kx hu mt b fv mx my l mz na">php artisan migrate db:seed --class=SeederClass</span></pre><h1 id="fa78" class="lx kx hu bd ky ly lz ma lc mb mc md lg me mf mg lj mh mi mj lm mk ml mm lp mn dt translated"><strong class="ak">设置存储</strong></h1><p id="cf3f" class="pw-post-body-paragraph jc jd hu je b jf ls jh ji jj lt jl jm jn lu jp jq jr lv jt ju jv lw jx jy jz hn dt translated">要设置存储，请在config/filesystem.php中这样做，并为Google添加一个磁盘:</p><pre class="mo mp mq mr fq ms mt mu mv aw mw dt"><span id="ac84" class="kw kx hu mt b fv mx my l mz na">'google' =&gt; [ <br/>'driver' =&gt; 's3', <br/>'key' =&gt; 'xxx', <br/>'secret' =&gt; 'xxx', <br/>'bucket' =&gt; 'qrnotesfiles', <br/>'base_url'=&gt;'https://storage.googleapis.com' ]</span></pre><p id="e75a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">关于在Google App Engine上部署Laravel应用的其他有用资料:</strong></p><ul class=""><li id="605a" class="kh ki hu je b jf jg jj jk jn kj jr kk jv kl jz km kn ko kp dt translated"><a class="ae kq" href="https://cloud.google.com/shell/docs/quickstart?authuser=1#preview_and_deploy_an_app_engine_application" rel="noopener ugc nofollow" target="_blank">预览和部署应用引擎应用</a></li><li id="47d6" class="kh ki hu je b jf kr jj ks jn kt jr ku jv kv jz km kn ko kp dt translated"><a class="ae kq" href="https://github.com/Superbalist/laravel-google-cloud-storage" rel="noopener ugc nofollow" target="_blank">用于Laravel的Google云存储文件系统</a></li></ul><p id="0b65" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我希望你喜欢这篇文章，并发现它很有帮助。你自己有什么提示或建议吗？或者一些问题？欢迎在评论中提问。</p><p id="372c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你试图用Laravel做其他事情并感到停滞不前，请阅读其他分步指南，以<a class="ae kq" rel="noopener" href="/@team_62166/how-to-quickly-deploy-your-laravel-website-or-app-on-heroku-46e7fe6e675f">在Heroku上部署Laravel应用</a>、<a class="ae kq" rel="noopener" href="/@team_62166/how-to-deploy-laravel-on-google-compute-engine-on-linux-87be9d7d6efc">在LINUX上的谷歌计算引擎上</a>或<a class="ae kq" rel="noopener" href="/@team_62166/laravel-e-commerce-from-scratch-aint-nobody-got-time-for-that-d4f9525b629d">建立基于Laravel的电子商务平台</a>。</p><p id="16ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">编码快乐！</p><p id="79bb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你喜欢这个，你可能也会对我们的其他项目感兴趣。在我们的<a class="ae kq" href="https://updivision.com/blog" rel="noopener ugc nofollow" target="_blank">博客</a>上阅读更多内容。关注我们<a class="ae kq" href="https://twitter.com/updivision" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> @ </strong>升级版</a>和上<a class="ae kq" href="https://www.facebook.com/updivision/" rel="noopener ugc nofollow" target="_blank">脸书</a>。</p></div></div>    
</body>
</html>