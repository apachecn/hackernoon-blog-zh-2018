<html>
<head>
<title>How I started doing load testing on GraphQL without writing a single Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何在不编写任何查询的情况下开始在GraphQL上进行负载测试的</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-started-doing-load-testing-on-graphql-without-writing-a-single-query-8604ba38b422?source=collection_archive---------10-----------------------#2018-12-04">https://medium.com/hackernoon/how-i-started-doing-load-testing-on-graphql-without-writing-a-single-query-8604ba38b422?source=collection_archive---------10-----------------------#2018-12-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/a9beed70463316b5bbe5bcb4b8ab43d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*9VyBulcxDuGbfz9FfcZMbg.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek"><a class="ae jc" href="https://github.com/EasyGraphQL" rel="noopener ugc nofollow" target="_blank">EasyGraphQL</a></figcaption></figure><p id="9630" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">前一段时间，我在做一个GraphQL项目，这个项目包含了一些活动，每个活动都可以有一些评论，带有创建评论的用户的信息。你可能想到的第一件事是，这是查询<code class="eh kb kc kd ke b">n + 1</code>的问题，是的；确实是！</p><p id="d302" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我决定实现数据加载器，但由于某种原因，实现时出现了错误，所以它没有缓存查询，结果是对数据库的大量请求。发现这个问题后，我用正确的方法实现了它，将对数据库的查询从46个减少到6个。</p><p id="367f" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">这就是为什么我决定创建一个开源工具来帮助我创建查询和进行负载测试，只要通过我的GraphQL模式。</p></div><div class="ab cl kf kg hc kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hn ho hp hq hr"><h1 id="1a53" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">工作原理:</h1><p id="c2e6" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated"><code class="eh kb kc kd ke b"><a class="ae jc" href="https://github.com/EasyGraphQL/easygraphql-load-tester" rel="noopener ugc nofollow" target="_blank">easygraphql-load-tester</a></code>暂时可以用三种方式:</p><ol class=""><li id="618e" class="lp lq hu jf b jg jh jk jl jo lr js ls jw lt ka lu lv lw lx dt translated">使用<code class="eh kb kc kd ke b">.artillery()</code>和<a class="ae jc" href="https://artillery.io/" rel="noopener ugc nofollow" target="_blank">火炮</a>设置。</li><li id="993a" class="lp lq hu jf b jg ly jk lz jo ma js mb jw mc ka lu lv lw lx dt translated">使用<code class="eh kb kc kd ke b">.k6()</code>和<a class="ae jc" href="https://docs.k6.io/docs" rel="noopener ugc nofollow" target="_blank"> k6 </a>设置。</li><li id="10fd" class="lp lq hu jf b jg ly jk lz jo ma js mb jw mc ka lu lv lw lx dt translated">使用<code class="eh kb kc kd ke b">.createQuery()</code>可以创建查询，这样你就可以使用你最喜欢的负载测试器了。</li></ol><h1 id="7f6d" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">怎么用？</h1><ul class=""><li id="8018" class="lp lq hu jf b jg lk jk ll jo mi js mj jw mk ka ml lv lw lx dt translated">导入<code class="eh kb kc kd ke b"><a class="ae jc" href="https://github.com/EasyGraphQL/easygraphql-load-tester" rel="noopener ugc nofollow" target="_blank">easygraphql-load-tester</a></code>包。</li><li id="7318" class="lp lq hu jf b jg ly jk lz jo ma js mb jw mc ka ml lv lw lx dt translated">阅读模式。</li><li id="f795" class="lp lq hu jf b jg ly jk lz jo ma js mb jw mc ka ml lv lw lx dt translated">初始化测试器，并将模式作为第一个参数传递。</li><li id="f9e7" class="lp lq hu jf b jg ly jk lz jo ma js mb jw mc ka ml lv lw lx dt translated">如果有多个模式，则使用模式和参数传递一个数组。</li><li id="b5ba" class="lp lq hu jf b jg ly jk lz jo ma js mb jw mc ka ml lv lw lx dt translated">第二个参数是查询上的参数，<strong class="jf hv">只有</strong>如果有一些查询的话。</li><li id="12a8" class="lp lq hu jf b jg ly jk lz jo ma js mb jw mc ka ml lv lw lx dt translated"><strong class="jf hv">注意</strong>:为了使用多个模式文件，必须扩展查询和突变。</li><li id="5ff4" class="lp lq hu jf b jg ly jk lz jo ma js mb jw mc ka ml lv lw lx dt translated"><strong class="jf hv">注意</strong>:如果参数是一个数组，它应该作为<code class="eh kb kc kd ke b">string</code>传递，例如:<code class="eh kb kc kd ke b">'["name", "name 2"]'</code></li></ul><h1 id="a0d2" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">一个模式文件</h1><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="59bd" class="mu kn hu ke b fv mv mw l mx my">'use strict' </span><span id="a419" class="mu kn hu ke b fv mz mw l mx my">const EasyGraphQLLoadTester = require('easygraphql-load-tester')<br/>const fs = require('fs')<br/>const path = require('path')</span><span id="5d19" class="mu kn hu ke b fv mz mw l mx my">const userSchema = fs.readFileSync(path.join(__dirname, 'user.gql'), 'utf8')</span><span id="427a" class="mu kn hu ke b fv mz mw l mx my">const loadTester = new EasyGraphQLLoadTester(userSchema)</span></pre><h1 id="4350" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">多个模式文件</h1><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="6eec" class="mu kn hu ke b fv mv mw l mx my">'use strict' </span><span id="f7ee" class="mu kn hu ke b fv mz mw l mx my">const EasyGraphQLLoadTester = require('easygraphql-load-tester')<br/>const fs = require('fs')<br/>const path = require('path')</span><span id="cade" class="mu kn hu ke b fv mz mw l mx my">const userSchema = fs.readFileSync(path.join(__dirname, 'user.gql'), 'utf8')<br/>const familySchema = fs.readFileSync(path.join(__dirname, 'family.gql'), 'utf8')</span><span id="80a8" class="mu kn hu ke b fv mz mw l mx my">const loadTester = new EasyGraphQLLoadTester([userSchema, familySchema])</span></pre><h1 id="4c17" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">大炮</h1><p id="7730" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">要与<a class="ae jc" href="https://artillery.io/" rel="noopener ugc nofollow" target="_blank">cannon</a>一起使用，您必须在您的项目中安装它，以防您没有它，只需运行:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="cb2b" class="mu kn hu ke b fv mv mw l mx my">$ npm install artillery --saved-dev</span></pre><h1 id="f28f" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">索引. js</h1><p id="b0f0" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">您应该配置您的<code class="eh kb kc kd ke b">index.js</code>文件:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="cdbf" class="mu kn hu ke b fv mv mw l mx my">'use strict' </span><span id="5645" class="mu kn hu ke b fv mz mw l mx my">const EasyGraphQLLoadTester = require('easygraphql-load-tester')<br/>const fs = require('fs')<br/>const path = require('path')</span><span id="3014" class="mu kn hu ke b fv mz mw l mx my">const userSchema = fs.readFileSync(path.join(__dirname, 'user.gql'), 'utf8')<br/>const familySchema = fs.readFileSync(path.join(__dirname, 'family.gql'), 'utf8')<br/></span><span id="2f8c" class="mu kn hu ke b fv mz mw l mx my">const args = {<br/>  getMeByTestResult: {<br/>    result: 4<br/>  },<br/>  search: {<br/>    id: '1'<br/>  },<br/>  ,<br/>  searchUser: {<br/>    where: {<br/>      id: '1',<br/>      name: 'demo'<br/>    }<br/>  }<br/>}</span><span id="096e" class="mu kn hu ke b fv mz mw l mx my">const loadTester = new EasyGraphQLLoadTester([userSchema, familySchema], args)</span><span id="057c" class="mu kn hu ke b fv mz mw l mx my">const testCases = loadTester.artillery()</span><span id="76f8" class="mu kn hu ke b fv mz mw l mx my">module.exports = {<br/>  testCases<br/>}</span></pre><h2 id="7a75" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">自定义查询</h2><p id="7ac3" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">您可以将自定义查询传递给负载测试，为此，您必须创建一个对象数组，然后将它传递给options参数:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="0efb" class="mu kn hu ke b fv mv mw l mx my">const queries = [<br/>  {<br/>    name: '&lt;NAME_OF_QUERY_TO_TEST&gt;',<br/>    query: '&lt;YOUR_CUSTOM_QUERY&gt;'<br/>  }<br/>]</span></pre><h2 id="017c" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">选定的查询</h2><p id="0e80" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">您可以选择要测试的查询列表，为此，您必须用要测试的查询的名称创建一个字符串数组。这是可选的，如果你不创建它，所有的查询都将被测试。</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="0b51" class="mu kn hu ke b fv mv mw l mx my">const selectedQueries = ['getFamilyInfo', 'searchUser']</span></pre><h2 id="e64c" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">查询文件</h2><p id="197d" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">如果您想要保存一个包含所有测试过的查询的<code class="eh kb kc kd ke b">JSON</code>文件，您可以在选项pass <code class="eh kb kc kd ke b">queryFile: true</code>上选择这样做，如果您没有传递任何内容，它将不会被保存。</p><h2 id="c2ef" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">选择</h2><p id="30fa" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated"><em class="nn">这是可选的，您可以将第一个参数留空，如果您不想传递任何选项</em>cannon方法将接收一些选项，这些选项将有助于创建自定义查询，并测试特定查询。</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="ad11" class="mu kn hu ke b fv mv mw l mx my">const options = {<br/>  selectedQueries,<br/>  customQueries: queries,<br/>  queryFile: true<br/>}</span></pre><p id="620c" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">然后把它作为第一个参数传递给<code class="eh kb kc kd ke b">loadTester.artillery(options)</code>。<strong class="jf hv">注意</strong>:使用参数编写查询，另外，不要忘记将它们写在查询参数对象上，以便其他查询可以访问它们。</p><p id="a3c5" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">示例:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="f2b0" class="mu kn hu ke b fv mv mw l mx my">const queries = [<br/>  {<br/>    name: 'searchUser(id: "1")',<br/>    query: `<br/>      {<br/>        searchUser(id: "1") {<br/>          name<br/>        }<br/>      }<br/>    `<br/>  }<br/>]</span><span id="dbb1" class="mu kn hu ke b fv mz mw l mx my">const options = {<br/>  selectedQueries: ['getFamilyInfo', 'searchUser'],<br/>  customQueries: queries<br/>}</span><span id="21af" class="mu kn hu ke b fv mz mw l mx my">const testCases = easyGraphQLLoadTester.artillery(options)</span><span id="94e4" class="mu kn hu ke b fv mz mw l mx my">module.exports = {<br/>  testCases<br/>}</span></pre><h1 id="ba33" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">炮兵. yml</h1><p id="1daa" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">火炮文件应该有这样的最低配置，如果需要的话，你可以添加你的:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="6226" class="mu kn hu ke b fv mv mw l mx my">config:<br/>    target: "http://localhost:5000/"<br/>    phases:<br/>      - duration: 5<br/>        arrivalRate: 1<br/>    processor: "./index.js"<br/>  scenarios:<br/>    - name: "GraphQL Query load test"<br/>      flow:<br/>        - function: "testCases"<br/>        - loop:<br/>            - post:<br/>                url: "/"<br/>                json:<br/>                  query: "{{ $loopElement.query }}"<br/>            - log: "----------------------------------"<br/>            - log: "Query: {{ $loopElement.name }}"<br/>          over: cases</span></pre><p id="a7f5" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><em class="nn">在这种情况下，服务器运行在</em><a class="ae jc" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"><em class="nn">http://localhost:5000/</em></a></p><h1 id="8eae" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">如何运行它</h1><p id="68e1" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">为了运行您的负载测试，在您的<code class="eh kb kc kd ke b">package.json</code>上添加这个脚本:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="27ca" class="mu kn hu ke b fv mv mw l mx my">"scripts": {<br/>  "easygraphql-load-tester": "artillery run artillery.yml"<br/>}</span></pre><p id="5b42" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">然后在终端上运行</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="d552" class="mu kn hu ke b fv mv mw l mx my">$ npm run easygraphql-load-tester</span></pre><p id="0040" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><em class="nn">在这种情况下，火炮文件被称为火炮，但你可以用你最喜欢的名字命名你的文件，并运行</em> <code class="eh kb kc kd ke b"><em class="nn">artillery run &lt;MY_FILE_NAME&gt;.yml</em></code></p><h1 id="b72c" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">结果</h1><p id="61ed" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">如果您应用基本配置，结果将是这样的</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="8bde" class="mu kn hu ke b fv mv mw l mx my">All virtual users finished<br/> Summary report @ 15:03:05(-0500) 2018-11-17<br/>   Scenarios launched:  5<br/>   Scenarios completed: 5<br/>   Requests completed:  40<br/>   RPS sent: 8.95<br/>   Request latency:<br/>     min: 1.2<br/>     max: 13<br/>     median: 2<br/>     p95: 6<br/>     p99: 13<br/>   Scenario counts:<br/>     GraphQL Query load test: 5 (100%)<br/>   Codes:<br/>     200: 40</span></pre><figure class="mm mn mo mp fq iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/c81d8ac695de861efa4a796e3b210296.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/1*5E8cnasqkYqn3NQYYIxofw.gif"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">load testing</figcaption></figure><h1 id="1a7d" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">k6</h1><p id="c653" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">要与<a class="ae jc" href="https://docs.k6.io/docs/" rel="noopener ugc nofollow" target="_blank"> k6 </a>一起使用，您必须在您的计算机上安装它，如果您没有它，请访问<a class="ae jc" href="https://docs.k6.io/docs/installation" rel="noopener ugc nofollow" target="_blank">安装指南</a></p><h1 id="9c0c" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">索引. js</h1><p id="0102" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">您应该配置您的<code class="eh kb kc kd ke b">index.js</code>文件:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="346d" class="mu kn hu ke b fv mv mw l mx my">'use strict' </span><span id="b128" class="mu kn hu ke b fv mz mw l mx my">const EasyGraphQLLoadTester = require('easygraphql-load-tester')<br/>const fs = require('fs')<br/>const path = require('path')</span><span id="80d3" class="mu kn hu ke b fv mz mw l mx my">const userSchema = fs.readFileSync(path.join(__dirname, 'user.gql'), 'utf8')<br/>const familySchema = fs.readFileSync(path.join(__dirname, 'family.gql'), 'utf8')<br/></span><span id="182f" class="mu kn hu ke b fv mz mw l mx my">const args = {<br/>  getMeByTestResult: {<br/>    result: 4<br/>  },<br/>  search: {<br/>    id: '1'<br/>  },<br/>  ,<br/>  searchUser: {<br/>    where: {<br/>      id: '1',<br/>      name: 'demo'<br/>    }<br/>  }<br/>}</span><span id="f9dd" class="mu kn hu ke b fv mz mw l mx my">const loadTester = new EasyGraphQLLoadTester([userSchema, familySchema], args)</span><span id="affc" class="mu kn hu ke b fv mz mw l mx my">easyGraphQLLoadTester.k6(&lt;FILE_NAME&gt;)</span></pre><p id="e38d" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><strong class="jf hv">第一个参数是k6配置文件的名称</strong></p><h2 id="d3e1" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">自定义查询</h2><p id="a278" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">您可以将自定义查询传递给负载测试，为此，您必须创建一个对象数组，然后将它传递给options参数:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="8bc5" class="mu kn hu ke b fv mv mw l mx my">const queries = [<br/>  {<br/>    name: '&lt;NAME_OF_QUERY_TO_TEST&gt;',<br/>    query: '&lt;YOUR_CUSTOM_QUERY&gt;'<br/>  }<br/>]</span></pre><h2 id="20c6" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">选定的查询</h2><p id="cb35" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">您可以选择要测试的查询列表，为此，您必须用要测试的查询的名称创建一个字符串数组。这是可选的，如果你不创建它，所有的查询都将被测试。</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="66c0" class="mu kn hu ke b fv mv mw l mx my">const selectedQueries = ['getFamilyInfo', 'searchUser']</span></pre><h2 id="2f55" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">查询文件</h2><p id="b1e0" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">如果您想保存一个包含所有测试过的查询的<code class="eh kb kc kd ke b">JSON</code>文件，您可以在选项pass <code class="eh kb kc kd ke b">queryFile: true</code>上选择这样做，如果您没有传递任何内容，它将不会被保存。</p><h2 id="31e3" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">虚拟用户</h2><p id="731a" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">您可以选择您的测试需要多少虚拟用户，只需传递到选项<code class="eh kb kc kd ke b">vus: &lt;NUMBER_OF_VUS&gt;</code>。</p><h2 id="cc95" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">持续时间</h2><p id="48d0" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">您可以选择测试的持续时间，只需转到选项<code class="eh kb kc kd ke b">duration: '&lt;DURATION&gt;s'</code>。它应该是一个带有时间单位的字符串，例如<code class="eh kb kc kd ke b">s</code></p><h2 id="42ba" class="mu kn hu bd ko na nb nc ks nd ne nf kw jo ng nh la js ni nj le jw nk nl li nm dt translated">选择</h2><p id="0a3f" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated"><em class="nn">这是可选的，你可以将第二个参数留空，如果你不想传递任何选项</em></p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="ece9" class="mu kn hu ke b fv mv mw l mx my">const options = {<br/>  selectedQueries,<br/>  customQueries: queries,<br/>  queryFile: true,<br/>  vus: 10,<br/>  duration: '10s'<br/>}</span></pre><p id="a673" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">然后将其作为第二个参数传递给<code class="eh kb kc kd ke b">loadTester.artillery(&lt;FILE_NAME&gt;, options)</code>。</p><p id="f7e9" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><strong class="jf hv">注意</strong>:使用参数编写查询，另外，不要忘记将它们写在查询参数对象上，以便其他查询可以访问它们。</p><p id="c080" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">示例:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="ffaf" class="mu kn hu ke b fv mv mw l mx my">const queries = [<br/>  {<br/>    name: 'searchUser(id: "1")',<br/>    query: `<br/>      {<br/>        searchUser(id: "1") {<br/>          name<br/>        }<br/>      }<br/>    `<br/>  }<br/>]</span><span id="63dc" class="mu kn hu ke b fv mz mw l mx my">const options = {<br/>  selectedQueries: ['getFamilyInfo', 'searchUser'],<br/>  queryFile: true,<br/>  vus: 10,<br/>  duration: '10s'<br/>}</span><span id="0260" class="mu kn hu ke b fv mz mw l mx my">easyGraphQLLoadTester.k6('k6.js', options)</span></pre><h1 id="4d33" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">k6.js</h1><p id="ed37" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">火炮文件应该有这样的最低配置，如果需要的话，你可以添加你的:</p><p id="b4b4" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><strong class="jf hv">注意:不要更改查询的名称和路线</strong> <code class="eh kb kc kd ke b"><strong class="jf hv">./easygraphql-load-tester-queries.json</strong></code></p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="a072" class="mu kn hu ke b fv mv mw l mx my">import http from "k6/http";</span><span id="4700" class="mu kn hu ke b fv mz mw l mx my">const queries = JSON.parse(open("./easygraphql-load-tester-queries.json"));</span><span id="1958" class="mu kn hu ke b fv mz mw l mx my">export default function() {<br/>  for (const query of queries) {<br/>    const url = "http://localhost:5000/";<br/>    const payload = JSON.stringify({ query: query.query });<br/>    const params =  { headers: { "Content-Type": "application/json" } }<br/>    http.post(url, payload, params);<br/>  }<br/>};</span></pre><p id="22be" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><em class="nn">在这种情况下，服务器运行在</em><a class="ae jc" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"><em class="nn">http://localhost:5000/</em></a></p><h1 id="ba7b" class="km kn hu bd ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf mh lh li lj dt translated">如何运行它</h1><p id="08ac" class="pw-post-body-paragraph jd je hu jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hn dt translated">为了运行您的负载测试，在您的<code class="eh kb kc kd ke b">package.json</code>上添加这个脚本:</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="932f" class="mu kn hu ke b fv mv mw l mx my">"scripts": {<br/>  "easygraphql-load-tester": "node index.js"<br/>}</span></pre><p id="518b" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">然后在终端上运行</p><pre class="mm mn mo mp fq mq ke mr ms aw mt dt"><span id="166d" class="mu kn hu ke b fv mv mw l mx my">$ npm run easygraphql-load-tester</span></pre><figure class="mm mn mo mp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="fe ff no"><img src="../Images/537a342bd7299dd01ec12c3ddb29bddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xik_oz9o5-9ugUXfsByYMA.gif"/></div></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">k6 load test</figcaption></figure><figure class="mm mn mo mp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="fe ff nt"><img src="../Images/fe292054e3c4c620b1ade5adf7039a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uQzYiw48B6chKFD3tFvZQ.png"/></div></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">one of the queries created</figcaption></figure></div><div class="ab cl kf kg hc kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hn ho hp hq hr"><ul class=""><li id="36a3" class="lp lq hu jf b jg jh jk jl jo lr js ls jw lt ka ml lv lw lx dt translated">如果参数是一个数组，它应该像例子<code class="eh kb kc kd ke b">'["test", “test2”]'</code>中那样作为注释传递。</li></ul></div><div class="ab cl kf kg hc kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hn ho hp hq hr"><p id="7a5a" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">如果你喜欢这个包，别忘了在GitHub上给个⭐️。</p><p id="80e6" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">回购:【https://github.com/EasyGraphQL/easygraphql-load-tester T21】</p><p id="4e2a" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">国家预防机制:<a class="ae jc" href="https://www.npmjs.com/package/easygraphql-load-tester" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/easygraphql-load-tester</a></p><p id="143d" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><strong class="jf hv">示例:</strong><a class="ae jc" href="https://github.com/EasyGraphQL/easygraphql-load-tester/tree/master/examples" rel="noopener ugc nofollow" target="_blank">https://github . com/EasyGraphQL/EasyGraphQL-load-tester/tree/master/Examples</a></p><p id="e97e" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><strong class="jf hv">更多easygraphql项目</strong>:<a class="ae jc" href="https://github.com/EasyGraphQL" rel="noopener ugc nofollow" target="_blank">https://github.com/EasyGraphQL</a></p><p id="810b" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><strong class="jf hv">网址:</strong><a class="ae jc" href="https://easygraphql.com/" rel="noopener ugc nofollow" target="_blank">https://easygraphql.com/</a></p></div></div>    
</body>
</html>