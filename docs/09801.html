<html>
<head>
<title>[Laravel tips] How to redirect users to a specific URL/route when the validation fails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Laravel提示]当验证失败时，如何将用户重定向到特定的URL/路由</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/laravel-tips-how-to-redirect-users-to-a-specific-url-route-when-the-validation-fails-2551149d1e4c?source=collection_archive---------17-----------------------#2018-12-04">https://medium.com/hackernoon/laravel-tips-how-to-redirect-users-to-a-specific-url-route-when-the-validation-fails-2551149d1e4c?source=collection_archive---------17-----------------------#2018-12-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/c21a8ebb9608cd62edc64495c9b363f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a4WJbQ2nQucoaFqegBT6_Q.png"/></div></div></figure><p id="8962" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果在数据库中保存表单之前使用<a class="ae ka" href="https://laravel.com/docs/5.7/validation#form-request-validation" rel="noopener ugc nofollow" target="_blank">表单请求</a>来验证表单，当验证失败时，用户通常会被重定向回发起请求的页面。</p><p id="b5e7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如，如果你在<code class="eh kb kc kd ke b">/new-article</code>页面，在你提交你正在创建的文章后，如果用户输入的数据没有通过验证，用户将被自动重定向回这个完全相同的URL。在大多数情况下，这是理想的行为。</p><p id="a38e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最近，我在开发一个表单，需要将用户重定向回另一条路径。</p><p id="29f2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我在开发一个应用程序，其中有用户可以更新的不同设置(从设置页面)，由于不希望一次发送该页面中的所有数据，验证它，然后更新用户设置，所以我创建了多个“小表单”，每个表单都在accordion的一个部分中，只更新一组相关的设置。因此，例如，我可以访问<code class="eh kb kc kd ke b">/settings</code>来查看所有部分/卡片折叠的设置页面，或者我可以访问(<code class="eh kb kc kd ke b">/settings/personal-info</code>)来打开该特定部分的设置页面。</p><p id="6579" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以我可能会访问<code class="eh kb kc kd ke b">/settings/personal-info</code>，然后我会向下滚动到另一个部分来更新它(比如隐私)。在这种情况下，如果验证失败，用户将被重定向到<code class="eh kb kc kd ke b">/settings/personal-info</code>而不是<code class="eh kb kc kd ke b">/settings/privacy</code>。</p><p id="05ca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">PS:我知道这可能不是处理这种情况的最佳方式，但是请耐心听我说，我们的目标是解释如何将用户重定向到不同的路径</p><p id="ece4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">幸运的是，我们可以通过在表单请求类中设置一些属性，将用户重定向到所需的URL/route。</p><p id="f263" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">看一看<code class="eh kb kc kd ke b"><a class="ae ka" href="https://laravel.com/api/5.7/Illuminate/Foundation/Http/FormRequest.html" rel="noopener ugc nofollow" target="_blank">/vendor/laravel/framework/src/Illuminate/Foundation/Http/FormRequest.php</a></code></p><p id="148d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你会发现这三个属性:</p><pre class="kf kg kh ki fq kj ke kk kl aw km dt"><span id="5c09" class="kn ko hu ke b fv kp kq l kr ks">/**<br/>* The URI to redirect to if validation fails.<br/>*<br/>* @var string<br/>*/<br/>protected $redirect;</span><span id="cd46" class="kn ko hu ke b fv kt kq l kr ks">/**<br/>* The route to redirect to if validation fails.<br/>*<br/>* @var string<br/>*/<br/>protected $redirectRoute;<br/>  <br/>/**<br/>* The controller action to redirect to if validation fails.<br/>*<br/>* @var string<br/>*/<br/>protected $redirectAction;</span></pre><p id="2504" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以我们需要做的就是给这个属性中的一个(仅仅一个)赋予我们想要的值。</p><p id="3429" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kb kc kd ke b">protected $redirectRoute = 'get_all_articles';</code></p><p id="5660" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">PS:如果你想知道如果你设置了多个会发生什么，看看同一个类上受保护的函数<code class="eh kb kc kd ke b">getRedirectUrl()</code>方法。</p><p id="1409" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这种情况下，您可能会遇到的一个问题是，当您希望向redirectRoute传递一个值，但又希望传递一个带有类似</p><p id="c3ab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kb kc kd ke b">Route::get('articles/{article}','ArticleController@view')→name('view_article');</code></p><p id="44ae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">解决方案是在构造函数中设置该属性的值，如下所示:</p><pre class="kf kg kh ki fq kj ke kk kl aw km dt"><span id="9801" class="kn ko hu ke b fv kp kq l kr ks">public function __construct()</span><span id="7880" class="kn ko hu ke b fv kt kq l kr ks">{<br/>	$id = ….;<br/>	$this-&gt;redirect = route('view_article', $id);<br/>}</span></pre><p id="bf17" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意，我在这里使用的是$redirect，而不是<code class="eh kb kc kd ke b">$redirectRoute</code>。</p><p id="821e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我希望这个提示对你有用</p><p id="7e08" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">PS:我正在写一本关于如何给你的Laravel CRUD应用程序添加测试的电子书。如果你有兴趣，可以去https://laraveltesting101.com/的<a class="ae ka" href="https://laraveltesting101.com/" rel="noopener ugc nofollow" target="_blank">看看</a></p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><a href="https://laraveltesting101.com/"><div class="fe ff fg"><img src="../Images/52bf9e84126f483254abfde8427668f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fh3jPIRkLQOFi35thK-fkQ.png"/></div></a></figure></div></div>    
</body>
</html>