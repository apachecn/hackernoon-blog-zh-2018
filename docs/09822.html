<html>
<head>
<title>Solving the Kubernetes and Storage Challenge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解决Kubernetes和存储挑战</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/solving-the-kubernetes-and-storage-challenge-39621a7e2afa?source=collection_archive---------4-----------------------#2018-12-05">https://medium.com/hackernoon/solving-the-kubernetes-and-storage-challenge-39621a7e2afa?source=collection_archive---------4-----------------------#2018-12-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/5d38cd77350bca8c2aa87be1ac682104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nbvosY7I5Xjf3419.jpg"/></div></div></figure><h1 id="dfc3" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">企业对Kubernetes的迷恋</h1><p id="2e48" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">似乎每个人都迷恋Kubernetes。每个组织都有一个与Kubernetes合作或计划合作的项目。当采用Kubernetes时，组织很快意识到需要做出许多决定，而且Kubernetes不是一件简单的事情。一些常见问题是:</p><ol class=""><li id="e69f" class="ky kz hu kc b kd la kh lb kl lc kp ld kt le kx lf lg lh li dt translated">我将如何部署Kubernetes？</li><li id="1d11" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">我将在哪里部署Kubernetes？</li><li id="286a" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">我想使用公共云版本的Kubernetes吗？他们可靠吗？</li><li id="3752" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">我们的组织应该使用什么样的网络模型？印花布，编织，法兰绒，其他？</li><li id="c6c3" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">Kubernetes是如何管理和部署存储的？</li><li id="2851" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">一旦我们部署了Kubernetes，第二天的行动呢？</li></ol><p id="6186" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">在这篇博客中，我们将关注Kubernetes上线后的第一个挑战:存储。</p><p id="9fe3" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">当我们在大型企业客户的容器部署方面与他们合作时，一些事实开始浮现。虽然每个客户都希望将Kubernetes作为容器编排的标准，但企业应用程序和更新的云原生应用程序需要数据中心提供的所有企业插件。</p><p id="0700" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">《财富》5000强企业希望以两种方式利用Kubernetes，第一种方式是托管绿地应用程序，但也用于重新架构和现代化遗留应用程序，以便它们基于Kubernetes。Kubernetes提供了健壮的特性和API，这些特性和API提供了高可用性、可伸缩性、对运行可移植容器的支持，以及对诸如滚动升级、canary部署等部署问题的支持。</p><p id="a86d" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">存储对于现实世界中基于pod的基础架构至关重要。容器文件本质上是短暂的，这意味着在终止或崩溃时，所有用户数据都会丢失。此外，组织成pod的容器读取共享文件和数据资产。卷抽象说明了这两种情况。</p><p id="0473" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">因此，Kubernetes的一个关键考虑因素是企业存储支持。在容器中运行的应用程序需要执行一系列数据管理任务和CRUD功能。因此，Kubernetes需要支持各种各样的持久存储范例。存储必须是在关系数据库、消息队列、NoSQL数据库等中运行遗留应用程序的一等公民。</p><p id="ba6e" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">CNCF的Kubernetes项目帮助培育了CSI(容器存储接口),使一系列第三方存储供应商(SP)能够为其产品开发符合CSI API的标准插件。一旦创建，它应该可以无缝集成到许多容器编排(CO)系统中，比如Kubernetes、Mesos等实现CSI的系统。</p><h1 id="8a14" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">进入平台9管理Kubernetes (PMK)</h1><p id="ea3e" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">Platform9提供业内唯一的Kubernetes托管服务。Platform9 Managed Kubernetes (PMK)简化并解决了上述跨任何基础设施或云部署和管理Kubernetes集群的挑战。PMK允许简单地部署Kubernetes集群、扩展这些集群、监控、升级，并提供一流的服务来解决这些部署问题。如果您的组织刚刚使用第一个K8s集群涉足Kubernetes生态系统，或者已经部署了数百个Kubernetes集群，Platform9可以管理这些环境。</p><h1 id="e49b" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">在平台9上部署Kubernetes</h1><p id="b412" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">我已经在9号平台上部署了很多次Kubernetes。我想创建一个新的环境来测试存储和平台9管理的应用程序。我在我们的数据中心设置了7台物理服务器。安装了Ubuntu 16.04，准备安装Kubernetes集群。</p><ol class=""><li id="6be1" class="ky kz hu kc b kd la kh lb kl lc kp ld kt le kx lf lg lh li dt translated">我下载了Platform9代理并安装在每台服务器上</li><li id="1dfe" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">为平台9管理的Kubernetes注册代理</li><li id="d7e7" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">遵循Platform9安装向导并创建了一个Kubernetes集群。</li></ol><figure class="ls lt lu lv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lr"><img src="../Images/c779513b39d8377fa015fb73ede639d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dp-FOl3u5-uut7Oo.png"/></div></div></figure><h2 id="36c2" class="lw jd hu bd je lx ly lz ji ma mb mc jm kl md me jq kp mf mg ju kt mh mi jy mj dt translated">简单！kubernetes 10分钟后开始运行。</h2><p id="b71f" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">一旦部署了Kubernetes，开发团队开始使用新的环境，首先要面对的挑战之一就是:“我如何解决持久存储？”这是组织面临的第一个也是最常见的挑战。虽然开发团队可能希望编写12因素无状态应用程序，但当有状态服务(如数据库、队列、键值存储、大数据和机器学习)在Kubernetes上运行时，将需要管理有状态数据集。关于存储的问题将会出现，这只是一个时间问题，为了让组织在Kubernetes之旅中取得成功，需要解决这个问题。</p><p id="20c5" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">Kubernetes中的存储很复杂，从Kubernetes文档中可以看出，存储有很多种类型，不同的云提供商有不同的存储类型:</p><ol class=""><li id="bf40" class="ky kz hu kc b kd la kh lb kl lc kp ld kt le kx lf lg lh li dt translated">卷</li><li id="7822" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">持久卷</li><li id="b686" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">卷快照</li><li id="e1c1" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">存储类别</li><li id="96da" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">卷快照类</li><li id="4925" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">动态卷供应</li></ol><p id="7cac" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">PMK为部署K8s时需要做出的所有上述决策提供了完全的灵活性。然而，当与<a class="ae mk" href="https://portworx.com/" rel="noopener ugc nofollow" target="_blank"> Portworx </a>结合使用时，存储决策就大大简化了。</p><h1 id="0941" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">输入Portworx——它就能工作！</h1><figure class="ls lt lu lv fq iv fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/02e8dc637b66cf9232e9e15c1d4c2f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/0*Rg_PtyFFAS39rvJq.png"/></div></figure><p id="c8f8" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">在花了似乎几个小时的时间使用谷歌机器和阅读Kubernetes关于存储的文档后，我遇到了Portworx，它为<a class="ae mk" href="https://portworx.com/use-case/kubernetes-storage/" rel="noopener ugc nofollow" target="_blank"> Kubernetes存储</a>提供了一个解决方案。我后来甚至发现Portworx是一个平台合作伙伴。已经部署了Kubernetes，并且很高兴在我新创建的Kubernetes集群上部署一些应用程序，我需要一个简单、快速的解决方案来为我的容器提供存储。</p><p id="72de" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">来自Portworx网站:</p><p id="1e76" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">“Portworx是一家云原生存储公司，企业依靠它来降低跨多个云和本地环境快速部署容器化应用程序的成本和复杂性。</p><p id="ed4c" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">通过Portworx，您可以使用任何容器调度程序管理任何基础设施上的任何数据库或有状态服务。您可以为所有有状态服务获得一个单一的数据管理层，无论它们在哪里运行。Portworx在多云环境中茁壮成长。"</p><p id="609a" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">在我的环境中，我有7台服务器，我使用Platform9部署了一个Kubernetes集群，其中有3个主节点和4个工作节点。点击了几下鼠标后，我浏览了Portworx文档，找到了“在Kubernetes上安装——所有其他发行版”页面。我单击了“生成规范”链接。</p><p id="9e6c" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">我被提示:</p><ol class=""><li id="d13c" class="ky kz hu kc b kd la kh lb kl lc kp ld kt le kx lf lg lh li dt translated">Etcd详情。我选择了Portworx hosted——因为这比我自己安装更容易，而且我不想使用我的Kubernetes etcd。</li><li id="5532" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">选择使用“本地”存储和使用未装载的卷。这对我来说是一个很好的选择，因为我的工作节点上已经有4个50gb的未安装卷。</li><li id="177d" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">我选择了网络的默认值</li><li id="0db6" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">最后，在“高级设置”下，我选择启用UI和Stork，Stork是Portworx创建的Kubernetes调度程序扩展，用于实现pod和存储的超融合以及跨云迁移。</li></ol><p id="b28a" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">好的。这似乎太容易了，不可能是真的。这正是我一直在寻找的。我下载并执行了一个spec.yaml:</p><pre class="ls lt lu lv fq mm mn mo mp aw mq dt"><span id="22d9" class="lw jd hu mn b fv mr ms l mt mu">Kubectl apply -f spec.yaml</span></pre><p id="59b2" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">这再简单不过了。在等待所有docker层下载一段时间后，我有了一个完整的运行Portworx的环境。</p><figure class="ls lt lu lv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lr"><img src="../Images/c12a80944856198dd96c68672fd1223c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YUtyOr8yq7mFatf-.png"/></div></div></figure><h1 id="71b2" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">结论</h1><p id="fe2a" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">最重要的是，在大约30分钟的时间里，我安装了一个完整的Kubernetes集群，并拥有了一个功能齐全的存储解决方案。我认为对这两种工具协同工作的最佳描述应该是“运动中的简单性”。</p><p id="e348" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">在安装好所有东西之后，我想测试一下这个解决方案，以确保动态PVC确实可以工作，并且可以被我的Kubernetes集群使用。所以我决定安装一些需要使用持久存储的应用程序。</p><p id="299d" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">我安装了:</p><ol class=""><li id="f7e2" class="ky kz hu kc b kd la kh lb kl lc kp ld kt le kx lf lg lh li dt translated">minio——为您的本地数据中心提供开源AWS S3环境</li><li id="24da" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">Jenkins-x —开源CI/CD管道环境</li><li id="dcc3" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">普罗米修斯——开源Kubernetes监控</li><li id="763d" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">grafana——我用作Prometheus前端的开源绘图引擎</li><li id="7bc0" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated"><a class="ae mk" href="https://platform9.com/blog/kubernetes-logging-and-monitoring-the-elasticsearch-fluentd-and-kibana-efk-stack-part-1-fluentd-architecture-and-configuration/" rel="noopener ugc nofollow" target="_blank"> EFK堆栈</a> — Kubernetes测井和监测:Elasticsearch、Fluentd和Kibana (EFK)</li></ol><p id="7aaf" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">半天之后，我有了一个高度可用的Kubernetes集群，它运行在平台9管理的Kubernetes上，平台9管理的应用程序和Portworx功能齐全。我从未担心过我的存储环境。</p></div></div>    
</body>
</html>