<html>
<head>
<title>Making a decentralized URL shortener using Ethereumâ›“</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Ethereumâ›“åˆ¶ä½œä¸€ä¸ªåˆ†æ•£çš„URLç¼©çŸ­å™¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/making-a-decentralized-url-shortener-using-ethereum-4fdfccf712a6?source=collection_archive---------9-----------------------#2018-12-05">https://medium.com/hackernoon/making-a-decentralized-url-shortener-using-ethereum-4fdfccf712a6?source=collection_archive---------9-----------------------#2018-12-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="09be" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">æ°¸è¿œä¿å­˜åŒºå—é“¾çš„é“¾æ¥</h2></div><h2 id="2e55" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">è¯¥äº§å“</h2><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="km kn l"/></div></figure><h1 id="c085" class="ko jk hu bd jl kp kq kr jp ks kt ku jt ja kv jb jx jd kw je kb jg kx jh kf ky dt translated">å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„</h1><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/d0755379a713a54f9a10750aefffc28d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/1*e6uPKHACWbRzuaci0bxpXQ.gif"/></div></figure><p id="7883" class="pw-post-body-paragraph lc ld hu le b lf lg iv lh li lj iy lk ju ll lm ln jy lo lp lq kc lr ls lt lu hn dt translated">éƒ¨ç½²åœ¨<a class="ae lv" href="https://0x.now.sh" rel="noopener ugc nofollow" target="_blank"> 0x.now.sh </a>çš„web appä¸éƒ¨ç½²åœ¨<a class="ae lv" href="https://ropsten.etherscan.io/address/0x4b8241f24537d2539d0b310bc074fd68a782e182" rel="noopener ugc nofollow" target="_blank">ä»¥å¤ªåŠRopsten testnet </a>ä¸Šçš„æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚åœ¨testnetä¸Šæ„å‘³ç€ä½ å¯ä»¥ç”¨è‡ªç”±é†šä¸å®ƒäº’åŠ¨ã€‚ç‚¹å‡»è·å–æ‚¨çš„<a class="ae lv" href="https://faucet.metamask.io" rel="noopener ugc nofollow" target="_blank">å…è´¹ä¹™é†šã€‚</a></p><h2 id="f892" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">è¯¥è¿‡ç¨‹</h2><ul class=""><li id="a828" class="lw lx hu le b lf ly li lz ju ma jy mb kc mc lu md me mf mg dt translated">ç”¨æˆ·è¿›è¡Œäº¤æ˜“ï¼Œè¯·æ±‚åŒºå—é“¾å­˜å‚¨URLå­—ç¬¦ä¸²ã€‚</li><li id="2b59" class="lw lx hu le b lf mh li mi ju mj jy mk kc ml lu md me mf mg dt translated">ç”±äºè¿™æ˜¯ä¸€é¡¹æ”¹å˜åŒºå—é“¾ç°çŠ¶çš„äº¤æ˜“ï¼Œå› æ­¤éœ€è¦é™„å¸¦ä¸€å®šæ•°é‡çš„ä¹™é†šï¼Œä»¥ä¾¿çŸ¿å·¥å°†å…¶å¼€é‡‡åˆ°åŒºå—é“¾ã€‚</li><li id="445d" class="lw lx hu le b lf mh li mi ju mj jy mk kc ml lu md me mf mg dt translated">è´¹ç”¨(ä¹Ÿç§°ä¸º<a class="ae lv" href="https://www.cryptocompare.com/coins/guides/what-is-the-gas-in-ethereum/" rel="noopener ugc nofollow" target="_blank">æ°”ä½“</a>)çš„æ•°é‡ç”±Metamask chromeæ‰©å±•å†³å®šï¼Œå¹¶æ˜¾ç¤ºåœ¨æç¤ºæ¡†ä¸­ã€‚</li><li id="cc2c" class="lw lx hu le b lf mh li mi ju mj jy mk kc ml lu md me mf mg dt translated">äº¤æ˜“ç¡®è®¤éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´(5-10ç§’),è¿™å–å†³äºåŒºå—é“¾çš„ç¹å¿™ç¨‹åº¦ã€‚</li><li id="50be" class="lw lx hu le b lf mh li mi ju mj jy mk kc ml lu md me mf mg dt translated">ç”Ÿæˆäº†ç¼©çŸ­çš„URLã€‚https://0x.now.sh/s?id=23</li><li id="b345" class="lw lx hu le b lf mh li mi ju mj jy mk kc ml lu md me mf mg dt translated">å½“ç”¨æˆ·ç‚¹å‡»ç¼©çŸ­çš„URLæ—¶ï¼Œè¿›è¡Œå¦ä¸€ä¸ªäº‹åŠ¡ï¼Œè¯·æ±‚åŒºå—é“¾å“ªä¸ªURLå­—ç¬¦ä¸²ä½äºæ‰€æä¾›çš„å¼•ç”¨å¤„(åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯23)</li><li id="b254" class="lw lx hu le b lf mh li mi ju mj jy mk kc ml lu md me mf mg dt translated">å› ä¸ºè¿™ä¸ªäº¤æ˜“æ²¡æœ‰æ”¹å˜åŒºå—é“¾çš„çŠ¶æ€ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ä¸éœ€è¦æ”¯ä»˜ä»»ä½•ETHï¼Œç”¨æˆ·è¢«æ— ç¼åœ°é‡å®šå‘åˆ°é•¿URLã€‚</li></ul><h2 id="0ddb" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">dApp</h2><p id="bdfd" class="pw-post-body-paragraph lc ld hu le b lf ly iv lh li lz iy lk ju mm lm ln jy mn lp lq kc mo ls lt lu hn dt translated">ä½œä¸ºä¸€ä¸ªåˆ†æ•£çš„åº”ç”¨ç¨‹åºæ„å‘³ç€è¿™ä¸ªwebåº”ç”¨ç¨‹åºä¸éœ€è¦ä»»ä½•é›†ä¸­çš„æ•°æ®åº“æ¥è¿è¡Œã€‚å®ƒä»…ä¸éƒ¨ç½²åœ¨åŒºå—é“¾ä¸Šçš„æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚</p><h2 id="14c8" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">æ™ºèƒ½åˆåŒğŸ“ƒ</h2><pre class="kh ki kj kk fq mp mq mr ms aw mt dt"><span id="57c1" class="jj jk hu mq b fv mu mv l mw mx">pragma solidity ^0.4.24;</span><span id="23d7" class="jj jk hu mq b fv my mv l mw mx">contract e0x {<br/> event Log(string message);<br/> event LinkAdded(uint linkId, string url);<br/> <br/> struct LinkTemplate {<br/>  address userAddress;<br/>  string url;<br/> }<br/> <br/> uint lastLinkId;<br/> mapping (uint =&gt; LinkTemplate) public linkMapping;<br/> <br/> constructor() public {<br/>  lastLinkId = 0;<br/> }<br/> <br/> <br/> function createNewLink(string url) public returns (uint) {<br/>     lastLinkId++;<br/>  linkMapping[lastLinkId] = LinkTemplate(msg.sender, url);<br/>  emit LinkAdded(lastLinkId, url);<br/>  return lastLinkId;<br/> }<br/> <br/> modifier linkExists(uint linkId) {<br/>     //link with the given hash does not exist<br/>  if(linkMapping[linkId].userAddress == 0x0000000000000000000000000000000000000000) {<br/>   revert();<br/>  }<br/>  _;<br/> }<br/> <br/> function getLink(uint linkId) linkExists(linkId) public constant<br/>  returns(<br/>   address,<br/>   string<br/>  ) {<br/>      LinkTemplate memory link = linkMapping[linkId];<br/>   return(<br/>    link.userAddress,<br/>       link.url<br/>   );<br/>  }</span><span id="923a" class="jj jk hu mq b fv my mv l mw mx">}</span></pre></div><div class="ab cl mz na hc nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hn ho hp hq hr"><h1 id="0837" class="ko jk hu bd jl kp ng kr jp ks nh ku jt ja ni jb jx jd nj je kb jg nk jh kf ky dt translated">æŠ€æœ¯æŒ‘æˆ˜</h1><h2 id="84c6" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">ä¸æ™ºèƒ½åˆåŒäº¤äº’</h2><p id="27c0" class="pw-post-body-paragraph lc ld hu le b lf ly iv lh li lz iy lk ju mm lm ln jy mn lp lq kc mo ls lt lu hn dt translated">EthersJSåº“ç”¨äºä¸åŒºå—é“¾å¯¹è¯</p><pre class="kh ki kj kk fq mp mq mr ms aw mt dt"><span id="e5e5" class="jj jk hu mq b fv mu mv l mw mx">// provider picks up the Metamask injected web3 object from browser <br/>let provider = new ethers.providers.Web3Provider(web3.currentProvider);<br/>let address = "ADDRESS_OF_DEPLOYED_SMART_CONTRACT";<br/>let abi = [...] //defines JSON interface for the smart contract</span></pre><h2 id="d796" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">åœ¨åŒºå—é“¾ä¸Šå­˜å‚¨æ•°æ®</h2><pre class="kh ki kj kk fq mp mq mr ms aw mt dt"><span id="59c6" class="jj jk hu mq b fv mu mv l mw mx">// calling the createNewLink function defined in the smart contract<br/>tx = await contract.createNewLink(url);<br/>console.log(tx.hash);</span></pre><h2 id="53c1" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">æ”¶å¬åŒºå—é“¾äº‹ä»¶</h2><pre class="kh ki kj kk fq mp mq mr ms aw mt dt"><span id="a0a6" class="jj jk hu mq b fv mu mv l mw mx">contract.on("LinkAdded", (linkId, linkUrl) =&gt; {<br/>        <br/>        var shortUrl = '{0}/s?id={1}'.f(window.location.origin, linkId.toNumber())<br/>        $("#info").prepend( "Short URL: &lt;a href='{0}'&gt;{0}&lt;/a&gt;&lt;br&gt;".f(shortUrl) );<br/>        <br/>    });</span></pre><h2 id="93de" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">æ­£åœ¨ç”Ÿæˆæœ€è¿‘ç¼©çŸ­çš„URLåˆ—è¡¨</h2><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="fe ff nl"><img src="../Images/968c35c71a9238e315386d48fd02a198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uNfUXj3_USvLnvUAQjbrhQ.png"/></div></div></figure><p id="4c9e" class="pw-post-body-paragraph lc ld hu le b lf lg iv lh li lj iy lk ju ll lm ln jy lo lp lq kc lr ls lt lu hn dt translated">æ¯å½“ä¸€ä¸ªæ–°çš„urlè¢«ç¼©çŸ­æ—¶ï¼Œweb3çš„allEvents()å‡½æ•°è°ƒç”¨è¢«ç”¨æ¥åˆ—å‡ºæ™ºèƒ½åˆçº¦ä¸­è®°å½•çš„æ‰€æœ‰äº‹ä»¶ã€‚</p><pre class="kh ki kj kk fq mp mq mr ms aw mt dt"><span id="34a1" class="jj jk hu mq b fv mu mv l mw mx">MyContract = web3.eth.contract(abi);<br/>    myContractInstance = MyContract.at(address);<br/>    events = myContractInstance.allEvents({event: 'LinkAdded', fromBlock: 0, toBlock: 'latest'});<br/>    events.watch(function(error, result){<br/>      console.log(result.args.url, result.args.linkId.toNumber());<br/>      ...<br/>});</span></pre><h2 id="58a2" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">ä½¿å¾—ç¼©çŸ­çš„URLåœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­éƒ½æ˜¯å¯è®¿é—®çš„</h2><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="fe ff nq"><img src="../Images/e2a149f2ee564b8e8ece02147db383a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4E9XthrjTPB5oB_3360eUA.png"/></div></div></figure><p id="2d8b" class="pw-post-body-paragraph lc ld hu le b lf lg iv lh li lj iy lk ju ll lm ln jy lo lp lq kc lr ls lt lu hn dt translated">è¿™ç›¸å½“æ£˜æ‰‹ï¼Œå› ä¸ºä¸åŒºå—é“¾äº¤äº’éœ€è¦æµè§ˆå™¨æ”¯æŒweb3ï¼Œå¹¶å®‰è£…ä¸€äº›é’±åŒ…(å…ƒæ©ç æˆ–ç±»ä¼¼çš„)ã€‚ç›®å‰ï¼Œweb3å’Œé’±åŒ…æ”¯æŒä»…é€‚ç”¨äºæ¡Œé¢ç‰ˆçš„Chromeå’ŒFirefoxã€‚</p><p id="0782" class="pw-post-body-paragraph lc ld hu le b lf lg iv lh li lj iy lk ju ll lm ln jy lo lp lq kc lr ls lt lu hn dt translated">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸å¾—ä¸åˆ›å»ºä¸€ä¸ªé’±åŒ…ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><pre class="kh ki kj kk fq mp mq mr ms aw mt dt"><span id="193b" class="jj jk hu mq b fv mu mv l mw mx">provider = ethers.getDefaultProvider('ropsten');<br/>wallet = ethers.Wallet.createRandom();<br/>wallet = wallet.connect(provider);</span></pre><p id="5a72" class="pw-post-body-paragraph lc ld hu le b lf lg iv lh li lj iy lk ju ll lm ln jy lo lp lq kc lr ls lt lu hn dt translated">å‘ä»¤äººæ•¬ç•çš„<a class="ae lv" href="https://github.com/ethers-io/ethers.js/" rel="noopener ugc nofollow" target="_blank"> ethersJSåº“</a>å¤§å£°ç–¾å‘¼ï¼Œæ„Ÿè°¢å®ƒå¯¹æ­¤çš„æ”¯æŒã€‚</p><h2 id="2234" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">ç»Ÿè®¡URLè®¿é—®é‡</h2><p id="9903" class="pw-post-body-paragraph lc ld hu le b lf ly iv lh li lz iy lk ju mm lm ln jy mn lp lq kc mo ls lt lu hn dt translated">ä½¿ç”¨è¿™ç§æµè§ˆå™¨çš„çµæ´»æ€§æ˜¯æœ‰ä»£ä»·çš„ã€‚æ¯æ¬¡ç”¨æˆ·ç‚¹å‡»ç¼©çŸ­çš„ç½‘å€æ²¡æœ‰æ”¹å˜åŒºå—é“¾çš„çŠ¶æ€ï¼Œå› æ­¤ä¸å¯èƒ½ç¡®å®šæ¯ä¸ªé“¾æ¥è¢«ç‚¹å‡»äº†å¤šå°‘æ¬¡ã€‚è¿™ä¸ªé—®é¢˜ä»ç„¶æ²¡æœ‰è§£å†³ã€‚</p><p id="8ba8" class="pw-post-body-paragraph lc ld hu le b lf lg iv lh li lj iy lk ju ll lm ln jy lo lp lq kc lr ls lt lu hn dt translated">è¯¥é¡¹ç›®çš„å®Œæ•´æºä»£ç åœ¨<a class="ae lv" href="https://github.com/sauravtom/ethereum-url-shortener" rel="noopener ugc nofollow" target="_blank"> Github </a>ä¸Šã€‚</p><p id="8d91" class="pw-post-body-paragraph lc ld hu le b lf lg iv lh li lj iy lk ju ll lm ln jy lo lp lq kc lr ls lt lu hn dt translated">æ¬¢è¿æå–è¯·æ±‚ğŸ˜</p></div></div>    
</body>
</html>