<html>
<head>
<title>sudo make me a sandwich. Then I’ll pwn your fridge.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">sudo给我做个三明治。然后我会打开你的冰箱。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/sudo-make-me-a-sandwich-then-ill-pwn-your-fridge-d4f36fb85db5?source=collection_archive---------15-----------------------#2018-12-06">https://medium.com/hackernoon/sudo-make-me-a-sandwich-then-ill-pwn-your-fridge-d4f36fb85db5?source=collection_archive---------15-----------------------#2018-12-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/cab5e0f6482f8e3613fa0464fc74f4a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*XlDjwO5LuWdhAnHk5Dhiww.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek"><a class="ae jc" href="https://xkcd.com/149/" rel="noopener ugc nofollow" target="_blank">https://xkcd.com/149/</a></figcaption></figure><p id="8640" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">Sudo是一个用于Unix类计算机操作系统的程序，它允许用户以另一个用户的安全特权运行程序。<a class="ae jc" href="https://en.wikipedia.org/wiki/Sudo" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Sudo</a></p><p id="ae41" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">假设我们有一个名为<strong class="jf hv">/行李箱/ </strong>的文件夹。行李里装着一些非常贵重的东西。Rincewind和twoflower是两个带着这种行李旅行了一段时间的用户。因为，灵思风不想让twoflower读octavo，但如果他看着相机就没问题，相机和相机都在行李里。<strong class="jf hv">/行李箱/相机//行李箱/octavo/ </strong>我们已经允许twoflower只运行cat命令作为rincewind，并且只在位置<strong class="jf hv">/行李箱/相机/ </strong>文件夹中运行。因为我们不知道这些照片会被命名为什么，所以我们将在<strong class="jf hv">/行李箱/相机/* </strong>中使用通配符</p><p id="b28b" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">灵思风认为twoflower将永远无法读取octavo中的任何内容，当然也永远无法读取文件夹中的咒语，并且文件权限都设置为0700。<br/>下面是<strong class="jf hv">/etc/sudoers . d/012-two flower</strong>文件的输出和一个命令输出。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="2bda" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我们对这个设置感觉很好，它只允许twoflower在一个单独的路径中使用一个单独的命令。接下来我们让两朵花来试试。然后可怕的事情发生了。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="398c" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">双花念出了八开体内的咒语，一切都结束了。怎么会？什么？这就是通配符与sudo配合使用的方式。只是乌龟，一直往下。我们永远不应该在sudo中使用这样的通配符。</p><p id="b261" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">接下来，锁定它，我们将去掉cat命令，用VI代替它，这样就不会有参数传递给VI，因为如果包含了通配符路径，VI就会遇到同样的目录遍历问题。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="cbe9" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">更糟糕的是，现在，不仅twoflower仍然可以在octavo中读取和编辑咒语，VIM还可以作为sudoer使用shell。这是因为在会话作为sudoer启动后，VIM正在调用shell。蜜獾(VIM)不在乎sudoers.d/file说了什么。<br/>好吧，下一步，去掉VIM，少给twoflower一个文件夹，只给一个文件，因为越少越好。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="7732" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">这可能有点难以理解，所以这里还有一些截图。</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div class="fe ff kh"><img src="../Images/38e8c772df5fe7206274f3ec708df2cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*SX2BiLjxjEAESPiGthSctg.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">start the sudo less command and pass the picture file</figcaption></figure><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div class="fe ff ki"><img src="../Images/d9c6bebca089e4d293d6a96b3775f2dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*Ia4b-J1rtNNPj2J5MPFyDw.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">less is now displaying the picture file</figcaption></figure><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/767b5cdecefbb42d2c441e79dbb0dcc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*S5OdZPufT3WH8UNFBeBnWw.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">!bash&lt;enter&gt;</figcaption></figure><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kk"><img src="../Images/9165139b1ce7fb4b64974110a1b99113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*3KA9olId3isEXTqrDAq9hQ.png"/></div></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">less has launched an escaped shell as rincewind and now we can read the spell (facepalm)</figcaption></figure><p id="c596" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">Sudo是一个超级强大而且极其危险的工具。允许sudo访问的命令需要仔细考虑，功能也需要理解。这些例子都不是利用或溢出。它们都完全按照设计运行。理解你正在授予sudo的特权，否则有人会进入你的冰箱，吃掉你所有的食物，然后烧掉你的房子。</p><p id="8865" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">关于受限shells和命令的更深入解释的重要资料。</p><div class="kp kq fm fo kr ks"><a href="https://pen-testing.sans.org/blog/2012/06/06/escaping-restricted-linux-shells" rel="noopener  ugc nofollow" target="_blank"><div class="kt ab ej"><div class="ku ab kv cl cj kw"><h2 class="bd hv fv z el kx eo ep ky er et ht dt translated">SANS渗透测试</h2><div class="kz l"><h3 class="bd b fv z el kx eo ep ky er et ek translated">编者按:几个月前，在GPWN无笔测试课程校友的邮件列表上，我们有一个很好的，生动的…</h3></div><div class="la l"><p class="bd b gc z el kx eo ep ky er et ek translated">pen-testing.sans.org</p></div></div></div></a></div></div></div>    
</body>
</html>