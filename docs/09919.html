<html>
<head>
<title>How to Free AWS Lambda Code Storage (CodeStorageExceeded)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何释放AWS Lambda代码存储(CodeStorageExceeded)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-free-aws-lambda-code-storage-codestorageexceeded-4b7e81c2d575?source=collection_archive---------5-----------------------#2018-12-10">https://medium.com/hackernoon/how-to-free-aws-lambda-code-storage-codestorageexceeded-4b7e81c2d575?source=collection_archive---------5-----------------------#2018-12-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/b3803dda51f793ceb965105b21303664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZgBFz4msqZN12zqcEcsMzw.jpeg"/></div></div></figure><p id="b38d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您已经使用AWS Lambda运行了几个月，突然您得到以下错误:</p><blockquote class="ka"><p id="0b70" class="kb kc hu bd kd ke kf kg kh ki kj jz ek translated"><strong class="ak"> <em class="kk">出现错误:TestDashdeliveryLambdaFunction—超出代码存储限制。(服务:AWSLambda状态码:400；错误代码:CodeStorageExceededException请求ID:05d 3a e68-e7f 6–11e 8–948 e-41c 27396380 e)。</em>T3】</strong></p></blockquote><h1 id="01db" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">有什么问题？</h1><p id="f581" class="pw-post-body-paragraph jc jd hu je b jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz hn dt translated">对于高达75GB的<a class="ae lo" href="https://docs.aws.amazon.com/lambda/latest/dg/limits.html" rel="noopener ugc nofollow" target="_blank">Lambda函数，AWS限制了它在内部S3上节省的“代码存储量”。</a></p><p id="ea6f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然听起来空间很大，但是你很容易达到那个极限。如果您使用的是<a class="ae lo" href="http://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>，那么它的默认设置是<a class="ae lo" href="https://serverless.com/framework/docs/providers/aws/guide/functions/#versioning-deployed-functions" rel="noopener ugc nofollow" target="_blank">为您进行的每个部署</a>存储一个版本。</p><h1 id="6e07" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw lp ky kz la lq lc ld le lr lg lh li dt translated">解决问题</h1><p id="6929" class="pw-post-body-paragraph jc jd hu je b jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz hn dt translated">如果您不需要为每个部署存储一个版本(像我们中的许多人一样)，您可以通过在您的<em class="ls"> serverless.yml </em>文件中添加以下内容来轻松地取消它:</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="7705" class="mc km hu ly b fv md me l mf mg">provider:<br/>  name: aws<br/>  runtime: python3.6<br/>  versionFunctions: false<br/>  region: ${opt:region, 'us-east-1'}<br/>  stage: ${opt:stage, 'dev'}</span></pre><p id="5744" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">添加<em class="ls"> versionFunctions: false </em>参数将取消版本存储。</p><h1 id="8357" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw lp ky kz la lq lc ld le lr lg lh li dt translated">清除-λ-存储:自动清除旧版本</h1><p id="aea8" class="pw-post-body-paragraph jc jd hu je b jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz hn dt translated">如果您确实希望保留旧版本(例如，为了能够快速回滚)，您将需要手动清理旧版本。幸运的是，在Epsagon，我们喜欢共享开源工具(例如，<a class="ae lo" href="https://epsagon.com/blog/the-curse-of-dead-lambda-functions/" rel="noopener ugc nofollow" target="_blank">发现死函数</a>)！这次是<a class="ae lo" href="https://github.com/epsagon/clear-lambda-storage" rel="noopener ugc nofollow" target="_blank">透明λ存储</a>。听起来很简单，它将负责从每个Lambda函数和每个区域中删除旧的和未使用的版本(即，既不是当前部署的也不是$LATEST)。运行它非常简单:</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="b353" class="mc km hu ly b fv md me l mf mg">git clone https://github.com/epsagon/clear-lambda-storage<br/>cd clear-lambda-storage/<br/>pip install -r requirements.txt<br/>python clear_lambda_storage.py</span></pre><p id="dec2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它将输出已经删除了多少个版本，从多少个函数中删除了多少个版本，以及释放了多少MB:</p><pre class="lt lu lv lw fq lx ly lz ma aw mb dt"><span id="7831" class="mc km hu ly b fv md me l mf mg">Deleted 9412 versions from 502 functions<br/>Freed 42056 MBs</span></pre><p id="12be" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你觉得这个工具有用吗？随时要求额外的功能，并贡献自己。</p><p id="dee5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">快乐的无服务器⚡！</p></div><div class="ab cl mh mi hc mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hn ho hp hq hr"><p id="e04e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ls">原载于2018年12月10日epsagon.com</em><em class="ls">T21</em><a class="ae lo" href="https://epsagon.com/blog/how-to-free-aws-lambda-code-storage-codestorageexceeded/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>