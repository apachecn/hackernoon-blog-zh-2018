<html>
<head>
<title>Build Your Own Simple Slackbot with Serverless PubNub Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用无服务器的PubNub函数构建你自己的简单Slackbot</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-your-own-simple-slackbot-with-serverless-pubnub-functions-98549204ec39?source=collection_archive---------32-----------------------#2018-12-12">https://medium.com/hackernoon/build-your-own-simple-slackbot-with-serverless-pubnub-functions-98549204ec39?source=collection_archive---------32-----------------------#2018-12-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b0ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大家都在用<a class="ae jp" href="https://hackernoon.com/tagged/slack" rel="noopener ugc nofollow" target="_blank">懈怠</a>。从分享代码到在凌晨2点给同事发送猫迷因，Slack已经成为企业的聊天和协作平台。不幸的是，信息传递并不在<a class="ae jp" href="https://hackernoon.com/tagged/productivity" rel="noopener ugc nofollow" target="_blank">生产力</a>食物链的顶端。</p><p id="f66b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">真正震撼数据分析者和思想领袖的是对聊天机器人的普遍需求。也就是休闲裤。这背后的原因是，机器人允许24小时进行任务处理或信息查找，而不需要另一个人。你可以这样想，如果没有Slackbots，我们将被迫安排自己的会议。哦，人类！</p><h1 id="e165" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">所以你想造一个懒人机器人？</h1><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/79a3536c6e1f874762317010665bc49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*6qZy6Zluq20Fa1Hd.gif"/></div></figure><p id="92da" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，去<a class="ae jp" href="https://api.slack.com/" rel="noopener ugc nofollow" target="_blank"> Slack API资源中心</a>创建一个新的Slack应用。我们需要设置一个名称，也是一个发展松弛组。在我的例子中，我将它命名为mined <strong class="it hv"> PNbot </strong>，并将其分配给我的一个组。</p><p id="e77c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦创建了应用程序，我们就可以选择向应用程序添加不同的功能。由于我们的重点是创建一个Slackbot，点击进入<code class="eh kw kx ky kz b">Bots</code>选项。</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff la"><img src="../Images/020b6796e0c8593f7849ebcddf3db2df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cc86qncGhfX7lbdp.png"/></div></div></figure><p id="f32a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在机器人部分，我们将有机会为我们的机器人添加用户名和显示名称。在这两种情况下，我都选择将机器人命名为<strong class="it hv"> pnbot </strong>。请记住，在底部附近有一个开关，当被选中时，它会保持机器人在线。这在我们的场景中是有意义的，因为多亏了PubNub，我们的机器人将在大约99.999%的时间内可用。</p><p id="3d90" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以我们现在有了机器人，但是我们如何让它在我们的工作空间中工作呢？只需点击侧边栏设置部分的安装应用副标题。就是这样！我们的bot现在应该可以在我们的演示工作区中使用了。</p><p id="f123" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就这样，我们的机器人开始运行了！现在下一步是查看Slack API站点侧栏中的特性部分。在该部分，我们将找到<a class="ae jp" href="https://api.slack.com/events-api" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">事件订阅</strong> </a>按钮并导航至该按钮。这将把我们带到一个空白页面，但不用担心，因为如果我们单击切换按钮，我们可以启用该功能。</p><p id="bb1c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">启用后，请注意有一个用于重定向URL的空间。不要太担心这个，因为我们会在构建<em class="lf">无服务器</em>功能时深入探讨这个问题。我们将看到的是重定向URL下面的工作区事件。在这里，我们可以选择一些事件，这些事件已经在文档中进行了适当的概述。在我们的例子中，为了简单起见，我们将选择提及事件。这意味着，当bot出现在任何渠道中时，它将向重定向URL发送一个包含相关信息的JSON有效负载。到目前为止，这就是我们现在所需要的。</p><h1 id="454a" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">创建无服务器Slackbot函数</h1><p id="44a9" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">首先，你必须<a class="ae jp" href="https://admin.pubnub.com/#/register" rel="noopener ugc nofollow" target="_blank">注册一个PubNub账户</a>。按照这个顺序，我们需要- &gt;创建一个应用- &gt;导航到键集- &gt;点击左边的函数选项卡。在这里，我们将创建一个新的按需模块。这意味着我们的模块将作为一个web挂钩，Slackbot可以重定向到这个挂钩。</p><p id="872e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经配置了我们的函数，我们需要设置一个路径，并复制URL以设置在我们之前避免的重定向URL字段中。这将使得每次提到机器人时，我们的函数都会收到类似于以下内容的有效载荷:</p><pre class="kp kq kr ks fq ll kz lm ln aw lo dt"><span id="0158" class="lp jr hu kz b fv lq lr l ls lt">"request"{  <br/>   <strong class="kz hv">"verb"</strong>:"rest",<br/>   <strong class="kz hv">"pubkey"</strong>:"your pub key",<br/>   <strong class="kz hv">"subkey"</strong>:"your sub key",<br/>   <strong class="kz hv">"timetoken"</strong>:null,<br/>   <strong class="kz hv">"timetoken_v1"</strong>:null,<br/>   <strong class="kz hv">"timetoken_v2"</strong>:null,<br/>   <strong class="kz hv">"version"</strong>:"v1",<br/>   <strong class="kz hv">"meta"</strong>:{  <br/>      <strong class="kz hv">"clientip"</strong>:"100.25.152.207",<br/>      <strong class="kz hv">"origin"</strong>:"pubsub.pubnub.com",<br/>      <strong class="kz hv">"useragent"</strong>:"Slackbot 1.0 (+https://api.slack.com/robots)"<br/>   },<br/>   <strong class="kz hv">"params"</strong>:{  <br/><br/>   },<br/>   <strong class="kz hv">"uri"</strong>:"/your-path/bot",<br/>   <strong class="kz hv">"path"</strong>:"/bot",<br/>   <strong class="kz hv">"method"</strong>:"POST",<br/>   <strong class="kz hv">"body"</strong>:"{\"token\":\"token\",\"team_id\":\"T0431NL8C\",\"api_app_id\":\"AEQFW5DFV\",\"event\":{\"client_msg_id\":\"4d282463-9622-4979-ae71-2b073895711c\",\"type\":\"message\",\"text\":\"&amp;lt;@UEQEUM144&amp;gt; &amp;lt;@UEQG0576F&amp;gt;\",\"user\":\"UA69Q4A64\",\"ts\":\"1544556685.000600\",\"channel\":\"DES1K0SGN\",\"event_ts\":\"1544556685.000600\",\"channel_type\":\"im\"},\"type\":\"event_callback\",\"event_id\":\"EvESLB9J4E\",\"event_time\":1544556685,\"authed_users\":[\"UEQG0576F\"]}",<br/>   <strong class="kz hv">"headers"</strong>:{  <br/>      <strong class="kz hv">"user-agent"</strong>:"Slackbot 1.0 (+https://api.slack.com/robots)",<br/>      <strong class="kz hv">"content-length"</strong>:"418",<br/>      <strong class="kz hv">"accept"</strong>:"*/*",<br/>      <strong class="kz hv">"accept-encoding"</strong>:"gzip,deflate",<br/>      <strong class="kz hv">"content-type"</strong>:"application/json",<br/>      <strong class="kz hv">"pfunc-original-uri"</strong>:"/your url/bot",<br/>      <strong class="kz hv">"x-forwarded-host"</strong>:"sub-key_js-on-rest",<br/>      <strong class="kz hv">"x-slack-request-timestamp"</strong>:"1544556686",<br/>      <strong class="kz hv">"x-slack-signature"</strong>:"v0=signature"<br/>   }<br/>}</span></pre><p id="349c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的机器人现在连接到我们的函数，现在我们希望我们的机器人开始发送消息。查看Slack文档，我们可以看到最好的方法是将我们的消息发送到Slack web API。</p><p id="a529" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这种情况下，我们将为我们的机器人启用<a class="ae jp" href="https://api.slack.com/incoming-webhooks" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">传入webhooks </strong> </a>。这将允许我们能够发布到webhook，让我们的消息被发送。我们可以通过导航到“功能”部分中的子标题来启用此功能，在该部分中我们启用了事件订阅。</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff la"><img src="../Images/e460cc5c2389c7c0e725f2b6cee0b231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Fk9MDReYYRtTOTMh.png"/></div></div></figure><p id="9059" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">授权完成后，我们要发布到的端点将如下所示:</p><pre class="kp kq kr ks fq ll kz lm ln aw lo dt"><span id="1019" class="lp jr hu kz b fv lq lr l ls lt"><a class="ae jp" href="https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX" rel="noopener ugc nofollow" target="_blank">https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX</a></span></pre><p id="f80a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了测试功能性，在我们的无服务器函数内部，发送<a class="ae jp" href="https://www.pubnub.com/docs/blocks/xhr-module" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> XHR请求</strong> </a>给传入的webhook Slack提供给我们一个消息。</p><pre class="kp kq kr ks fq ll kz lm ln aw lo dt"><span id="9f63" class="lp jr hu kz b fv lq lr l ls lt">export default (request, response) =&gt; {<br/>  const pubnub = require("pubnub");<br/>  const kvstore = require("kvstore");<br/>  const xhr = require("xhr");<br/>  let body = JSON.parse(request.body);<br/>  const http_options = {<br/>    method: "POST",<br/>    headers: { "Content-Type": "application/json" },<br/>    body: JSON.stringify({ text: "cool story bro!!!" })<br/>  };<br/>  const url =<br/>    "<a class="ae jp" href="https://hooks.slack.com/services/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" rel="noopener ugc nofollow" target="_blank">https://hooks.slack.com/services/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</a>";<br/>  response.status = 200;<br/>  response.headers["X-Custom-Header"] = "CustomHeaderValue";<br/>  return xhr.fetch(url, http_options).then(x =&gt; {<br/>    return response.send(body);<br/>  });<br/>};</span></pre><p id="140c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这种情况下，每当在一个频道中提到我们的bot时，它都会回复“酷故事老弟！！!"。</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff la"><img src="../Images/c7736a8cdeea0cd64b81c96a8e36fd90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*718jSF3fbevF_SdU.png"/></div></div></figure><h1 id="ced5" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">后续步骤</h1><p id="ccb2" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">就是这样！如果我激起了你对机器人或无服务器的兴趣，我强烈推荐你看看这些文章:</p></div><div class="ab cl lu lv hc lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hn ho hp hq hr"><p id="8ad0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lf">原载于</em><a class="ae jp" href="https://www.pubnub.com/blog/build-your-own-simple-slackbot-serverless-pubnub-functions/" rel="noopener ugc nofollow" target="_blank"><em class="lf">www.pubnub.com</em></a><em class="lf">。</em></p><figure class="kp kq kr ks fq kt"><div class="bz el l di"><div class="mb mc l"/></div></figure></div></div>    
</body>
</html>