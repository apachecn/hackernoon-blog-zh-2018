<html>
<head>
<title>Django ORM Relationships Cheat Sheet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django ORM关系备忘单</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/django-orm-relationships-cheat-sheet-14433d6cf68c?source=collection_archive---------1-----------------------#2018-12-13">https://medium.com/hackernoon/django-orm-relationships-cheat-sheet-14433d6cf68c?source=collection_archive---------1-----------------------#2018-12-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/2f70587520173627fb9830bab6769ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EPdRAqNCSy22bAAYRDv_7A.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Credits — author : Jez Timms; illustrator : Tatuna Gverdtsiteli</figcaption></figure><p id="6a35" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">Django ORM关系的备忘单—版本2.1</p><p id="b679" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我想以感谢<a class="ke kf gr" href="https://medium.com/u/df333b2420b7?source=post_page-----14433d6cf68c--------------------------------" rel="noopener" target="_blank"> Mahmoud Zalt </a>开始这个故事，他在大约一年前发表了一篇非常有用的文章“<a class="ae kg" href="https://hackernoon.com/eloquent-relationships-cheat-sheet-5155498c209" rel="noopener ugc nofollow" target="_blank">雄辩的关系小抄</a>”，并允许我在我的文章中使用相同的结构/图片/例子。</p></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><ul class=""><li id="28a4" class="ko kp hu ji b jj jk jn jo jr kq jv kr jz ks kd kt ku kv kw dt translated"><strong class="ji hv">一对一的关系</strong></li><li id="7e0b" class="ko kp hu ji b jj kx jn ky jr kz jv la jz lb kd kt ku kv kw dt translated"><strong class="ji hv">一对多关系</strong></li><li id="c330" class="ko kp hu ji b jj kx jn ky jr kz jv la jz lb kd kt ku kv kw dt translated"><strong class="ji hv">多对多关系</strong></li><li id="dd23" class="ko kp hu ji b jj kx jn ky jr kz jv la jz lb kd kt ku kv kw dt translated"><strong class="ji hv">多态一对多关系—类属关系</strong></li><li id="f35c" class="ko kp hu ji b jj kx jn ky jr kz jv la jz lb kd kt ku kv kw dt translated"><strong class="ji hv">多态一对多关系—django-多态包</strong></li><li id="65c4" class="ko kp hu ji b jj kx jn ky jr kz jv la jz lb kd kt ku kv kw dt translated"><strong class="ji hv">多态多对多关系—django-多态包</strong></li></ul></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="59a3" class="lc ld hu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz dt translated">一对一的关系</h1><h2 id="7c28" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">演示详情:</h2><p id="85f1" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated">在这个演示中，我们有2个模型(<strong class="ji hv">所有者</strong>和<strong class="ji hv">汽车</strong>)和2个表格(<strong class="ji hv">所有者</strong>和<strong class="ji hv">汽车</strong>)。</p><h2 id="a552" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">业务规则:</h2><p id="fb97" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">车主</strong>可以拥有一辆<strong class="ji hv">汽车</strong>。<br/>汽车可以归一个<strong class="ji hv">车主</strong>所有。</p><h2 id="e754" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系图:</h2><figure class="mu mv mw mx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/f31e5aa8066797f0bdd8a0391a292801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J4_eoR9kwo4HWynzhTerTA.png"/></div></div></figure><h2 id="9347" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系详情:</h2><p id="a9fc" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">汽车</strong>表应该存储<strong class="ji hv">车主</strong>ID<strong class="ji hv">ID</strong>。</p><h2 id="f11d" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">型号:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="f447" class="ma ld hu mz b fv nd ne l nf ng"><em class="nh">class </em>Owner(models.Model):<br/><br/>    #...<br/>    name = models.CharField(max_length=255)</span><span id="1d8a" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh">class </em>Car(models.Model):<br/><br/>    #...<br/>    name = models.CharField(max_length=255)<br/>    owner = models.OneToOneField(<br/>        Owner,<br/>        on_delete=models.CASCADE,<br/>        related_name='car'<br/>    )</span></pre><h2 id="e5f1" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">商店记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="b5c2" class="ma ld hu mz b fv nd ne l nf ng">car = Car.objects.get(id=1)<br/>owner  = Owner.objects.get(id=1)</span><span id="2eaf" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between Owner and Car.</span><span id="a29b" class="ma ld hu mz b fv ni ne l nf ng">owner.car = car<br/>owner.car.save()</span><span id="83e6" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between Car and Owner.</span><span id="3f31" class="ma ld hu mz b fv ni ne l nf ng">car.owner = owner<br/>car.save()</span></pre><h2 id="c1a2" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">检索记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="f102" class="ma ld hu mz b fv nd ne l nf ng"># Get Owner Car</span><span id="69ce" class="ma ld hu mz b fv ni ne l nf ng">owner.car<br/></span><span id="c809" class="ma ld hu mz b fv ni ne l nf ng"># Get Car Owner</span><span id="60d5" class="ma ld hu mz b fv ni ne l nf ng">car.owner;</span></pre></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="32c9" class="lc ld hu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz dt translated">一对多关系</h1><h2 id="b6e0" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">演示详情:</h2><p id="8be8" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated">在这个演示中，我们有2个模型(<strong class="ji hv">小偷</strong>和<strong class="ji hv">汽车</strong>，以及2个表(<strong class="ji hv">小偷</strong>和<strong class="ji hv">汽车</strong>)。</p><h2 id="a6f6" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">业务规则:</h2><p id="2e82" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">小偷</strong>可以偷很多<strong class="ji hv">车</strong>。<br/>汽车<strong class="ji hv">汽车</strong>可以被一个<strong class="ji hv">小偷</strong>偷走。</p><h2 id="8249" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系图:</h2><figure class="mu mv mw mx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nj"><img src="../Images/fac0cef1b01dca3337977a8f52e499f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SirFSA6MH7Rv--hpIHkbAA.png"/></div></div></figure><h2 id="7fd0" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系详情:</h2><p id="52be" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">汽车</strong>表应该存储<strong class="ji hv">小偷ID </strong>。</p><h2 id="9f5f" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">型号:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="753f" class="ma ld hu mz b fv nd ne l nf ng"><em class="nh">class </em>Thief(models.Model):<br/><br/>    # ...<br/>    name = models.CharField(max_length=255)<br/></span><span id="a4fe" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh">class </em>Car(models.Model):<br/><br/>    # ...<br/>    name = models.CharField(max_length=255)<br/>    thief = models.ForeignKey(<br/>        Thief,<br/>        on_delete=models.CASCADE,<br/>        related_name='cars'<br/>    )</span></pre><h2 id="8ef1" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">商店记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="3020" class="ma ld hu mz b fv nd ne l nf ng">thief  = Thief.objects.get(id=1)<br/>car1 = Car.objects.get(id=1)<br/>...</span><span id="3619" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between Thief and Car.</span><span id="5410" class="ma ld hu mz b fv ni ne l nf ng">thief.cars.add(car1,car2, car3)</span><span id="cad8" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between Car and Thief.</span><span id="e8e1" class="ma ld hu mz b fv ni ne l nf ng">car.thief = thief<br/>car.save()</span><span id="ed1b" class="ma ld hu mz b fv ni ne l nf ng"># When we creating new car : <br/>car = Car(name = 'test name', thief=thief)<br/>car.save()</span></pre><h2 id="d0b4" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">检索记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="e323" class="ma ld hu mz b fv nd ne l nf ng"># Get Thief Car  </span><span id="8065" class="ma ld hu mz b fv ni ne l nf ng">thief.cars.all()</span><span id="6483" class="ma ld hu mz b fv ni ne l nf ng"># Get Car Thief</span><span id="25e7" class="ma ld hu mz b fv ni ne l nf ng">car.thief</span></pre></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="a49b" class="lc ld hu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz dt translated">多对多关系</h1><h2 id="497e" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">演示详情:</h2><p id="d283" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated">在这个演示中，我们有2个模型(<strong class="ji hv"> Driver </strong>和<strong class="ji hv"> Car)、</strong>和3个表(<strong class="ji hv"> drivers </strong>、<strong class="ji hv"> cars </strong>和一个名为<strong class="ji hv"> car_drivers </strong>的数据透视表)。</p><h2 id="dc61" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">业务规则:</h2><p id="c682" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">司机</strong>可以驾驶多辆<strong class="ji hv">车</strong>。<br/><strong class="ji hv">车</strong>可以由很多<strong class="ji hv">司机</strong>驾驶。</p><h2 id="db3b" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系图:</h2><figure class="mu mv mw mx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nj"><img src="../Images/27ec08c7eb63a6502e14a9a877aa7e4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ItYKJ5bF0Ae6RB8OtZDf9Q.png"/></div></div></figure><h2 id="54cf" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系详情:</h2><p id="ae3a" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv"> Pivot </strong>表“car_driver”应该存储<strong class="ji hv">司机ID </strong>和<strong class="ji hv">汽车ID </strong>。</p><h2 id="e404" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">型号:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="2d27" class="ma ld hu mz b fv nd ne l nf ng"><em class="nh">class </em>Driver(models.Model):<br/><br/>    # ...<br/>    name = models.CharField(max_length=255)</span><span id="f987" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh">class </em>Car(models.Model):<br/><br/>    # ...<br/>    name = models.CharField(max_length=255)<br/>    drivers = models.ManyToManyField(<br/>        Driver,<br/>        related_name='cars'<br/>    )</span></pre><h2 id="b239" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">商店记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="0621" class="ma ld hu mz b fv nd ne l nf ng"># Create relation between Driver and Car.</span><span id="8bfe" class="ma ld hu mz b fv ni ne l nf ng">driver  = Driver.objects.get(id=1)<br/>car1 = Car.objects.get(id=1)<br/>car2 = Car.objects.get(id=2)</span><span id="b010" class="ma ld hu mz b fv ni ne l nf ng">driver.cars.add(car1,car2)</span><span id="787c" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between Car and Driver.<br/>car = Car.objects.get(id=1)<br/>driver1  = Driver.objects.get(id=2)<br/>driver2  = Driver.objects.get(id=3)<br/><br/>car.drivers.add(driver1, driver2)</span></pre><h2 id="cfd8" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">检索记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="cdf5" class="ma ld hu mz b fv nd ne l nf ng"># Get Driver Car</span><span id="fff4" class="ma ld hu mz b fv ni ne l nf ng">driver.cars.all()</span><span id="0429" class="ma ld hu mz b fv ni ne l nf ng"># Get Car Drivers</span><span id="ffe6" class="ma ld hu mz b fv ni ne l nf ng">car.drivers.all()</span></pre></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="3bfb" class="lc ld hu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz dt translated">多态一对多关系</h1><p id="3efa" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">与Django的类属关系</strong></p><h2 id="36c2" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">演示详情:</h2><p id="4805" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated">在这个演示中，我们有3个模型(<strong class="ji hv">男人、女人</strong>和<strong class="ji hv">汽车)、</strong>和3张桌子(<strong class="ji hv">男人</strong>、<strong class="ji hv">女人</strong>和<strong class="ji hv">汽车</strong>)。</p><h2 id="b4a5" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">业务规则:</h2><p id="5a75" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated">这个<strong class="ji hv">人</strong>(买家)可以买很多<strong class="ji hv">车</strong>。<br/>那个<strong class="ji hv">女人</strong>(买家)可以买很多<strong class="ji hv">车</strong>。<br/>汽车<strong class="ji hv">汽车</strong>可以由一个买家(<strong class="ji hv">男</strong>或<strong class="ji hv">女</strong>)购买。</p><h2 id="6004" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系图:</h2><figure class="mu mv mw mx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nk"><img src="../Images/c63edebbf993b5cfc6323faf8e608d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3w1tZvcf23DfnPP_NbINFg.png"/></div></div></figure><h2 id="08a4" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系详情:</h2><p id="8d59" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">汽车</strong>表应存储<strong class="ji hv">采购员ID </strong>，采购员表应存储<strong class="ji hv"> ID </strong>和<strong class="ji hv">类型</strong>之间的关系。</p><h2 id="09ab" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">型号:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="8a81" class="ma ld hu mz b fv nd ne l nf ng"><em class="nh">from </em>django.contrib.contenttypes.fields <em class="nh">import </em>GenericForeignKey<br/><em class="nh">from </em>django.contrib.contenttypes.fields <em class="nh">import </em>GenericRelation<br/><em class="nh">from </em>django.contrib.contenttypes.models <em class="nh">import </em>ContentType</span><span id="70a7" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh">class </em>Car(models.Model):</span><span id="0fdb" class="ma ld hu mz b fv ni ne l nf ng">    # ...<br/>    name = models.CharField(max_length=255)</span><span id="2cc0" class="ma ld hu mz b fv ni ne l nf ng">    content_type = models.ForeignKey(ContentType,         on_delete=models.CASCADE)<br/>    object_id = models.PositiveIntegerField()<br/>    content_object = GenericForeignKey()</span><span id="2e84" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh">class </em>Woman(models.Model):</span><span id="d586" class="ma ld hu mz b fv ni ne l nf ng">    # ...<br/>    name = models.CharField(max_length=255)<br/>    cars = GenericRelation(Car)</span><span id="5eda" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh">class </em>Man(models.Model):</span><span id="676c" class="ma ld hu mz b fv ni ne l nf ng">    # ...<br/>    name = models.CharField(max_length=255)<br/>    cars = GenericRelation(Car)</span></pre><h2 id="76b6" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">商店记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="88eb" class="ma ld hu mz b fv nd ne l nf ng">man = Man.objects.get(id=1)<br/>woman = Woman.objects.get(id=1)</span><span id="471e" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between buyer (Man/Woman) and Car.</span><span id="8fd1" class="ma ld hu mz b fv ni ne l nf ng">car = Car.objects.get(id=1)<br/>woman.cars.add(car)</span><span id="bcd6" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between Car and buyer (Men/Women).</span><span id="5d37" class="ma ld hu mz b fv ni ne l nf ng">man = Man.objects.get(id=1)<br/>woman = Woman.objects.get(id=1)</span><span id="0751" class="ma ld hu mz b fv ni ne l nf ng">c = Car(name = 'test name',content_object=man)<br/>c.save()</span><span id="6068" class="ma ld hu mz b fv ni ne l nf ng">c = Car(name = 'test name',content_object=woman)<br/>c.save()</span></pre><h2 id="9072" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">检索记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="a504" class="ma ld hu mz b fv nd ne l nf ng"># Get buyer (Man/Woman) Cars</span><span id="ea67" class="ma ld hu mz b fv ni ne l nf ng">man.cars.all()<br/>woman.cars.all()</span><span id="9851" class="ma ld hu mz b fv ni ne l nf ng"># Get Car buyer (Man and Woman)</span><span id="8f43" class="ma ld hu mz b fv ni ne l nf ng">car.content_object</span></pre></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="ad5a" class="lc ld hu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz dt translated">多态一对多关系</h1><p id="1f74" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">同包——</strong><a class="ae kg" href="https://github.com/django-polymorphic/django-polymorphic" rel="noopener ugc nofollow" target="_blank"><strong class="ji hv">姜戈——多态</strong> </a> <strong class="ji hv">。</strong></p><h2 id="c53f" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">演示详情:</h2><p id="042e" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated">在这个演示中，我们有4个模型(<strong class="ji hv">买家</strong>、<strong class="ji hv">男人、女人</strong>和<strong class="ji hv">汽车)、</strong>和4张桌子(<strong class="ji hv">买家</strong>、<strong class="ji hv">男人</strong>、<strong class="ji hv">女人</strong>和<strong class="ji hv">汽车</strong>)。</p><h2 id="5026" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">业务规则:</h2><p id="8eb8" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">人</strong>(买家)可以买很多<strong class="ji hv">车</strong>。<br/><strong class="ji hv">女</strong>(买家)可以买很多<strong class="ji hv">车</strong>。<br/><strong class="ji hv">车</strong>可以由一个买家(<strong class="ji hv">男</strong>或<strong class="ji hv">女</strong>)购买。</p><h2 id="a71a" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系图:</h2><figure class="mu mv mw mx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nk"><img src="../Images/c63edebbf993b5cfc6323faf8e608d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3w1tZvcf23DfnPP_NbINFg.png"/></div></div></figure><h2 id="5a39" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系详情:</h2><p id="8170" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">汽车</strong>表应存储<strong class="ji hv">采购员ID </strong>，采购员表应存储<strong class="ji hv"> ID </strong>和<strong class="ji hv">类型</strong>之间的关系。</p><h2 id="bc15" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">型号:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="a3ef" class="ma ld hu mz b fv nd ne l nf ng"><em class="nh">from </em>polymorphic.models <em class="nh">import </em>PolymorphicModel</span><span id="0bb4" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh">class </em>Buyer(PolymorphicModel):<br/>    <em class="nh">pass<br/><br/>class </em>Woman(Buyer):<br/><br/>    # ...<br/>    name = models.CharField(max_length=255)<br/><br/><br/><br/><em class="nh">class </em>Man(Buyer):<br/><br/>    # ...<br/>    name = models.CharField(max_length=255)<br/><br/><br/><br/><em class="nh">class </em>Car(models.Model):<br/><br/>    # Fields<br/><br/>    name = models.CharField(max_length=255)<br/>    buyer = models.ForeignKey(<br/>        Buyer,<br/>        on_delete=models.CASCADE,<br/>        related_name='cars'<br/>    )</span></pre><h2 id="1910" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">商店记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="f7f2" class="ma ld hu mz b fv nd ne l nf ng">man = Buyer.objects.get(id=1) # or Man.objecets.get(id=1)<br/>woman = Buyer.objects.get(id=2) # or Woman.objecets.get(id=2)</span><span id="938d" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between buyer (Man/Woman) and Car.</span><span id="0463" class="ma ld hu mz b fv ni ne l nf ng">man.cars.add(car1, car2)</span><span id="ea38" class="ma ld hu mz b fv ni ne l nf ng">woman.cars.add(car1, car2)</span><span id="a248" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between Car and buyer (Men/Women).</span><span id="959a" class="ma ld hu mz b fv ni ne l nf ng">c = Car(name = 'test name', buyer = man)<br/>c.save()</span><span id="3ed2" class="ma ld hu mz b fv ni ne l nf ng">c = Car(name = 'test name', buyer = woman)<br/>c.save()</span></pre><h2 id="1eed" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">检索记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="4e75" class="ma ld hu mz b fv nd ne l nf ng"># Get buyer (Man/Woman) Cars</span><span id="51f5" class="ma ld hu mz b fv ni ne l nf ng">man.cars.all()<br/>woman.cars.all()</span><span id="cdfc" class="ma ld hu mz b fv ni ne l nf ng"># Get Car buyer (Man and Woman)</span><span id="d4b1" class="ma ld hu mz b fv ni ne l nf ng">car.buyer</span></pre></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="191d" class="lc ld hu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz dt translated">多态多对多关系</h1><p id="4ad3" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">同包—</strong><a class="ae kg" href="https://github.com/django-polymorphic/django-polymorphic" rel="noopener ugc nofollow" target="_blank"><strong class="ji hv">django—多态</strong> </a> <strong class="ji hv">。</strong></p><h2 id="7ee2" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">演示详情:</h2><p id="eb2c" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated">在这个演示中，我们有3个模型(<strong class="ji hv">男仆、车主</strong>和<strong class="ji hv">汽车)、</strong>和4张桌子(<strong class="ji hv">男仆</strong>、<strong class="ji hv">车主、</strong> <strong class="ji hv">汽车</strong>和<strong class="ji hv">司机</strong>)。</p><h2 id="dd1d" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">业务规则:</h2><p id="38eb" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv">代客</strong>(司机)可以开多辆<strong class="ji hv">车</strong>。<br/><strong class="ji hv">车主</strong>(司机)可以开多辆<strong class="ji hv">车</strong>。<br/><strong class="ji hv">车</strong>可由多名司机驾驶(<strong class="ji hv">代客</strong>或/和<strong class="ji hv">车主</strong>)。</p><h2 id="992d" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系图:</h2><figure class="mu mv mw mx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/b3ba9d8f735963a75144aee0fb0f5935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aB0WT0yGN8nQluL7qLak7Q.png"/></div></div></figure><h2 id="e9c3" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">关系详情:</h2><p id="a3d9" class="pw-post-body-paragraph jg jh hu ji b jj mo jl jm jn mp jp jq jr mq jt ju jv mr jx jy jz ms kb kc kd hn dt translated"><strong class="ji hv"> Pivot </strong>表“drivers”应存储<strong class="ji hv"> Driver </strong> <strong class="ji hv"> ID </strong>、<strong class="ji hv"> Driver </strong> <strong class="ji hv"> Type </strong>和<strong class="ji hv"> CarID </strong>。<br/> <em class="nh">“司机”是对一群模特(代客和车主)的称呼。而且不限于两个。驱动类型是模型的真实名称。</em></p><h2 id="5783" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">型号:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="4a84" class="ma ld hu mz b fv nd ne l nf ng"><em class="nh">from </em>polymorphic.models <em class="nh">import </em>PolymorphicModel</span><span id="7b06" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh">class </em>Driver(PolymorphicModel):<br/>    <em class="nh">pass</em></span><span id="d202" class="ma ld hu mz b fv ni ne l nf ng"><em class="nh"><br/>class </em>Owner(Driver):<br/><br/>    # ...<br/>    name = models.CharField(max_length=255)<br/><br/><br/><em class="nh">class </em>Valet(Driver):<br/><br/>    # ...<br/>    name = models.CharField(max_length=255)<br/><br/><br/><br/><em class="nh">class </em>Car(models.Model):<br/><br/>    # ...<br/><br/>    name = models.CharField(max_length=255)<br/>    drivers = models.ManyToManyField(<br/>        Driver,<br/>        related_name='cars'<br/>    )<br/></span></pre><h2 id="6abd" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">商店记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="0d26" class="ma ld hu mz b fv nd ne l nf ng"># Create relation between driver (Valet/Owner) and Car.</span><span id="69e5" class="ma ld hu mz b fv ni ne l nf ng">owner.cars.add(car1, car2)</span><span id="c224" class="ma ld hu mz b fv ni ne l nf ng"># Create relation between Car and driver (Valet/Owner).</span><span id="bf81" class="ma ld hu mz b fv ni ne l nf ng">car.drivers.add(owner, valet)</span></pre><h2 id="a346" class="ma ld hu bd le mb mc md li me mf mg lm jr mh mi lq jv mj mk lu jz ml mm ly mn dt translated">检索记录:</h2><pre class="mu mv mw mx fq my mz na nb aw nc dt"><span id="fb2e" class="ma ld hu mz b fv nd ne l nf ng"># Get driver (Valet/Owner) Cars</span><span id="8520" class="ma ld hu mz b fv ni ne l nf ng">valet.cars.all()<br/>owner.cars.all()</span><span id="1ce8" class="ma ld hu mz b fv ni ne l nf ng"># Get Car drivers (Valet and Owner)</span><span id="5cbb" class="ma ld hu mz b fv ni ne l nf ng">car.drivers.all()<br/>car1.drivers.instance_of(Valet)<br/>car1.drivers.instance_of(Owner)</span></pre><p id="4029" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我也强烈推荐阅读<a class="ae kg" rel="noopener" href="/@MicroPyramid/django-generic-many-to-many-field-implementation-dd53ad642473">文章</a>，它描述了与另一个django包(django-gm2m)的多态多对多关系。</p></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><p id="2a8b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">感谢阅读并停留在<a class="ae kg" href="https://twitter.com/entGriff" rel="noopener ugc nofollow" target="_blank">触摸</a>。</p></div></div>    
</body>
</html>