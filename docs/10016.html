<html>
<head>
<title>Using AWS DynamoDB with Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS DynamoDB和烧瓶</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/using-aws-dynamodb-with-flask-9086c541e001?source=collection_archive---------2-----------------------#2018-12-13">https://medium.com/hackernoon/using-aws-dynamodb-with-flask-9086c541e001?source=collection_archive---------2-----------------------#2018-12-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b7e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我将介绍如何轻松地将AWS DynamoDB与Python的web开发服务器Flask集成。您将创建一个简单的RESTful API，允许您从DynamoDB中提取项目。</p><h2 id="e195" class="jp jq hu bd jr js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj dt translated">DynamoDB</h2><p id="a94a" class="pw-post-body-paragraph ir is hu it b iu kk iw ix iy kl ja jb jc km je jf jg kn ji jj jk ko jm jn jo hn dt translated">DynamoDB是AWS对NoSQL云数据库的回应。与其他<a class="ae kp" href="https://hackernoon.com/tagged/aws" rel="noopener ugc nofollow" target="_blank"> AWS </a>服务类似，DynamoDB允许你为一个应用程序加速运行数据库，而不必担心基础设施、备份和冗余。您可以通过AWS控制台或AWS API与数据库进行交互。在本教程中，我们将使用AWS的命令行包以及boto 3——一个<a class="ae kp" href="https://hackernoon.com/tagged/python" rel="noopener ugc nofollow" target="_blank"> Python </a>包装器——与AWS进行交互。这两种方法都利用了AWS API。</p><h2 id="5c4a" class="jp jq hu bd jr js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj dt translated">Boto3</h2><p id="505a" class="pw-post-body-paragraph ir is hu it b iu kk iw ix iy kl ja jb jc km je jf jg kn ji jj jk ko jm jn jo hn dt translated">Boto3是一个Python包，充当AWS CLI的包装器。这是使用Python与AWS交互的推荐包。</p><h2 id="0558" class="jp jq hu bd jr js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj dt translated">瓶</h2><p id="047b" class="pw-post-body-paragraph ir is hu it b iu kk iw ix iy kl ja jb jc km je jf jg kn ji jj jk ko jm jn jo hn dt translated">Flask是Python web框架。在最基本的层面上，它提供了开发服务器和调试器。Flask是高度可扩展的。允许添加其他应用程序功能，例如:表单验证、上传处理和身份验证。本教程将使用它的web服务器功能。</p><h1 id="a7d7" class="kq jq hu bd jr kr ks kt jv ku kv kw jz kx ky kz kc la lb lc kf ld le lf ki lg dt translated">先决条件</h1><p id="44c7" class="pw-post-body-paragraph ir is hu it b iu kk iw ix iy kl ja jb jc km je jf jg kn ji jj jk ko jm jn jo hn dt translated">本教程假设您对以下内容有基本的了解:</p><ul class=""><li id="f44c" class="lh li hu it b iu iv iy iz jc lj jg lk jk ll jo lm ln lo lp dt translated">Linux命令行界面(bash)</li><li id="5da5" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo lm ln lo lp dt translated">Python3编程</li><li id="9c60" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo lm ln lo lp dt translated">点</li><li id="1e0a" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo lm ln lo lp dt translated">瓶</li><li id="8a26" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo lm ln lo lp dt translated">AWS和IAM</li></ul><p id="166b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您的本地机器上还没有安装Python3，请在这里下载最新版本的<a class="ae kp" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="da1f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Python包管理器，应该和Python一起安装。如果由于某种原因，它不在您的本地机器上，请到<a class="ae kp" href="https://pip.pypa.io/en/stable/installing/" rel="noopener ugc nofollow" target="_blank">这里</a>获取如何安装它的说明。</p><p id="486c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果没有安装AWS CLI，请运行以下终端命令:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="a2c6" class="jp jq hu ly b fv mh mi l mj mk">pip install awscli --upgrade --user</span></pre><p id="2f5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lv lw lx ly b">awscli</code>允许您从命令行运行AWS命令。使用这个包，我们能够创建EC2实例，将对象插入到S3实例中，并从DynamoDB表中删除条目，这只是几个例子。这也是一个<code class="eh lv lw lx ly b">boto3</code>依赖，允许它与AWS交互。</p><p id="e649" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，您需要配置<code class="eh lv lw lx ly b">awscli</code>,以便它可以访问和许可您的AWS帐户。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="a980" class="jp jq hu ly b fv mh mi l mj mk">aws configure</span></pre><p id="a26d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将为您提供以下提示:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="95b1" class="jp jq hu ly b fv mh mi l mj mk">AWS Access Key ID [None]: ***PASTE ACCESS KEY ID HERE*** AWS Secret Access Key [None]: ***PASTE SECRET ACCESS KEY HERE*** Default region name [None]: ***TYPE YOUR PREFERRED REGION*** Default output format [None]: json</span></pre><p id="8c6f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您在此输入的访问密钥ID和秘密访问密钥将定义<code class="eh lv lw lx ly b">awscli</code>在与AWS交互时将拥有何种权限。您将从IAM控制台获得此信息。如果您以前没有AWS权限的经验，请点击<a class="ae kp" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html" rel="noopener ugc nofollow" target="_blank">此处</a>了解更多信息。</p><p id="eaef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您还应该指定默认区域。默认情况下，这将是您的<code class="eh lv lw lx ly b">awscli</code>运行大多数命令的区域。AWS可用区域列表可在<a class="ae kp" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="84aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了便于阅读，这里默认的输出格式设置为json，但这是可以改变的。</p><h2 id="7c45" class="jp jq hu bd jr js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj dt translated">创建测试表</h2><p id="d100" class="pw-post-body-paragraph ir is hu it b iu kk iw ix iy kl ja jb jc km je jf jg kn ji jj jk ko jm jn jo hn dt translated">因为我们的API将公开的唯一操作是一个非常基本的<code class="eh lv lw lx ly b">GET</code>，所以您需要创建一个新的DynamoDB表，并用一些条目填充它。这将使用AWS CLI来完成。</p><p id="1549" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，创建一个指定表模式的<code class="eh lv lw lx ly b">json</code>文件。</p><p id="f700" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过终端创建一个<code class="eh lv lw lx ly b">create-table.json</code>文件。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="05f4" class="jp jq hu ly b fv mh mi l mj mk">touch create-table.json</span></pre><p id="f984" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并添加以下代码。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="c11c" class="jp jq hu ly b fv mh mi l mj mk">{<br/>    "TableName": "YourTestTable",<br/>    "KeySchema": [<br/>      { "AttributeName": "Artist", "KeyType": "HASH" },<br/>      { "AttributeName": "SongTitle", "KeyType": "RANGE" }<br/>    ],<br/>    "AttributeDefinitions": [<br/>      { "AttributeName": "Artist", "AttributeType": "S" },<br/>      { "AttributeName": "SongTitle", "AttributeType": "S" }<br/>    ],<br/>    "ProvisionedThroughput": {<br/>      "ReadCapacityUnits": 5,<br/>      "WriteCapacityUnits": 5<br/>    }<br/>}</span></pre><p id="e314" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将告诉AWS创建一个名为<code class="eh lv lw lx ly b">YourTestTable</code>的新表，带有字符串属性<code class="eh lv lw lx ly b">Artist</code>和<code class="eh lv lw lx ly b">SongTitle</code>。它还指定了<code class="eh lv lw lx ly b">Artist</code>和<code class="eh lv lw lx ly b">SongTitle</code>属性都将被用作主键。</p><p id="bacd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lv lw lx ly b">ProvisinedThroughput</code>键告诉DynamoDB将读写容量设置为多少。更多信息可在<a class="ae kp" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.ReadWriteCapacityMode.html#HowItWorks.ProvisionedThroughput.Manual" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><p id="fe65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，创建一个名为<code class="eh lv lw lx ly b">batch-write.json</code>的文件。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="0c4b" class="jp jq hu ly b fv mh mi l mj mk">touch batch-write.json</span></pre><p id="170b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并在下面插入json代码:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="bb58" class="jp jq hu ly b fv mh mi l mj mk">{<br/>  "YourTestTable": [<br/>    {<br/>      "PutRequest": {<br/>        "Item":<br/>        {<br/>          "Artist": {<br/>            "S": "Bowie"<br/>          },<br/>          "SongTitle": {<br/>            "S": "Life on Mars"<br/>          }<br/>        }<br/>      }<br/>    },<br/>    {<br/>      "PutRequest": {<br/>        "Item": {<br/>          "Artist": {<br/>            "S": "Rolling Stones"<br/>          },<br/>          "SongTitle": {<br/>            "S": "Paint it Black"<br/>          }<br/>        }<br/>      }<br/>    },<br/>    {<br/>      "PutRequest": {<br/>        "Item" : {<br/>          "Artist": {<br/>            "S": "The Doors"<br/>          },<br/>          "SongTitle": {<br/>            "S": "Light My Fire"<br/>          }<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="9aa2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当在我们的表上运行批量写命令时，上面的json文件将被<code class="eh lv lw lx ly b">awscli</code>解析。如您所见，我们正在传递一个包含三个<code class="eh lv lw lx ly b">PutRequest</code>的列表，每个列表包含一个<code class="eh lv lw lx ly b">Item</code>，它由一个对应于我们的表属性的键/值对的字典组成。</p><p id="a013" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我们运行终端命令来创建和填充我们的表。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="e96d" class="jp jq hu ly b fv mh mi l mj mk">aws dynamodb create-table --cli-input-json file://create-table.json </span><span id="6bf9" class="jp jq hu ly b fv ml mi l mj mk">aws dynamodb batch-write-item --request-items file://batch-write.json</span></pre><p id="57a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果没有发生错误，您现在应该有一个填充的新表。您可以到AWS控制台验证该表是否存在。</p><p id="4a10" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意:该表将在默认区域中创建，该区域被指定为AWS配置的一部分。</strong></p><h1 id="3cdc" class="kq jq hu bd jr kr ks kt jv ku kv kw jz kx ky kz kc la lb lc kf ld le lf ki lg dt translated">项目设置</h1><p id="ac1e" class="pw-post-body-paragraph ir is hu it b iu kk iw ix iy kl ja jb jc km je jf jg kn ji jj jk ko jm jn jo hn dt translated">现在您的本地机器已经安装了所有的依赖项，您现在需要创建根项目目录。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="d72f" class="jp jq hu ly b fv mh mi l mj mk">mkdir flaskdynamodb <br/>cd flaskdynamodb</span></pre><p id="d345" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为我们将安装python包，所以我们需要创建一个虚拟环境。创建虚拟环境会将Python可执行文件复制到包中，这样从命令行对<code class="eh lv lw lx ly b">python</code>的任何调用都会运行虚拟环境本地Python可执行文件。虚拟环境也会将<code class="eh lv lw lx ly b">pip</code>包安装到这个相同的环境中。防止程序包与系统范围的程序包发生冲突。</p><p id="2200" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意:在某些linux发行版中，python虚拟环境模块不是预装的。在Ubuntu和Debian发行版的情况下，你需要用下面的命令</strong> <code class="eh lv lw lx ly b"><strong class="it hv">sudo apt-get install python3-venv</strong></code> <strong class="it hv">来安装它。如果下面的命令在你的系统上不起作用，你可能需要安装</strong>T3</p><p id="ff4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用以下终端命令创建虚拟环境:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="2230" class="jp jq hu ly b fv mh mi l mj mk">python3 -m venv env <br/>source env/bin/activate</span></pre><p id="1e48" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lv lw lx ly b">-m</code>选项告诉<code class="eh lv lw lx ly b">python</code>运行虚拟环境模块，并创建一个名为<code class="eh lv lw lx ly b">env</code>的新虚拟环境目录。</p><p id="0c20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lv lw lx ly b">source env/bin/activate</code>命令激活虚拟环境。这意味着您的系统现在将使用安装在虚拟环境文件夹中的Python可执行文件和pip包。</p><p id="ea88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意:在上面的python命令中，假设</strong> <code class="eh lv lw lx ly b"><strong class="it hv">python3</strong></code> <strong class="it hv">指的是Python3。如果您的系统</strong>上有 <code class="eh lv lw lx ly b"><strong class="it hv">python</strong></code> <strong class="it hv">链接到Python3，这个命令可能不起作用</strong></p><h2 id="3aa8" class="jp jq hu bd jr js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj dt translated">装置</h2><p id="1f92" class="pw-post-body-paragraph ir is hu it b iu kk iw ix iy kl ja jb jc km je jf jg kn ji jj jk ko jm jn jo hn dt translated">现在项目目录和虚拟环境已经设置好了，是时候安装<code class="eh lv lw lx ly b">flask</code>和<code class="eh lv lw lx ly b">boto</code>了</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="272d" class="jp jq hu ly b fv mh mi l mj mk">pip install flask pip install boto3</span></pre><p id="e9bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将再次提到，这些包将被安装到虚拟环境目录中。如果您查看<code class="eh lv lw lx ly b">env/lib/site_packages</code>目录，您会看到<code class="eh lv lw lx ly b">boto3</code>和<code class="eh lv lw lx ly b">flask</code>的目录。</p><p id="402b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">烧瓶配置</p><p id="f244" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在编写任何代码之前，您需要导出环境变量，该变量告诉<code class="eh lv lw lx ly b">flask</code>主应用程序文件将会是什么。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="b6a3" class="jp jq hu ly b fv mh mi l mj mk">export FLASK_APP=app.py</span></pre><p id="10f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可能已经注意到文件<code class="eh lv lw lx ly b">app.py</code>还没有创建。稍后我们将创建这个文件，它将包含我们的Flask应用程序代码。</p><h2 id="30e8" class="jp jq hu bd jr js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj dt translated">应用代码</h2><p id="f572" class="pw-post-body-paragraph ir is hu it b iu kk iw ix iy kl ja jb jc km je jf jg kn ji jj jk ko jm jn jo hn dt translated">现在，您将创建实际代码将要驻留的文件。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="dc5a" class="jp jq hu ly b fv mh mi l mj mk">touch app.py aws_controller.py</span></pre><p id="8023" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将以下代码添加到<code class="eh lv lw lx ly b">app.py</code>:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="d02d" class="jp jq hu ly b fv mh mi l mj mk">from flask import Flask<br/><br/>app = Flask(__name__)<br/><br/><br/>@app.route('/')<br/>def index():<br/>    return "This is the main page."<br/>    <br/><br/>@app.route('/get-items')<br/>def get_items():<br/>    return 'TODO: Implement Functionality'<br/><br/><br/>if __name__ == '__main__':<br/>    app.run()</span></pre><p id="5014" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的代码创建了一个Flask应用程序，其中公开了两条路线，<code class="eh lv lw lx ly b">/</code>和<code class="eh lv lw lx ly b">/get-items</code>。目前，这些路由将简单地用文本来响应。我们稍后将返回该文件，以便让<code class="eh lv lw lx ly b">/get-items</code>回复我们对AWS的呼叫。</p><p id="37ab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意:如果你不确定Flask是如何工作的，看看他们的</strong> <a class="ae kp" href="http://flask.pocoo.org/docs/1.0/quickstart/#a-minimal-application" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">快速入门指南</strong> </a> <strong class="it hv">。</strong></p><p id="6859" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是时候在<code class="eh lv lw lx ly b">aws_controller.py</code>文件中实现实际与DynamoDB交互的代码了。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="bd49" class="jp jq hu ly b fv mh mi l mj mk">import boto3<br/><br/>dynamo_client = boto3.client('dynamodb')<br/><br/>def get_items():<br/>    return dynamo_client.scan(<br/>        TableName='YourTestTable'<br/>    )</span></pre><p id="1619" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么上面的代码是做什么的？</p><ol class=""><li id="3450" class="lh li hu it b iu iv iy iz jc lj jg lk jk ll jo mm ln lo lp dt translated">首先导入<code class="eh lv lw lx ly b">boto3</code>模块。</li><li id="9dc9" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo mm ln lo lp dt translated"><code class="eh lv lw lx ly b">dynamo_client = boto3.client('dynamodb')</code>创建一个允许我们与DynamoDB API交互的客户端。</li><li id="bcc8" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo mm ln lo lp dt translated">函数<code class="eh lv lw lx ly b">get_items</code>对所提供的表名进行扫描。在这种情况下，我们正在扫描<code class="eh lv lw lx ly b">YourTestTable</code>。在DynamoDB中，a <code class="eh lv lw lx ly b">scan</code>返回整个表。这与<code class="eh lv lw lx ly b">query</code>操作不同，后者基于主键属性值搜索一个表。在这种情况下，运行<code class="eh lv lw lx ly b">scan</code>以获取整个表。</li></ol><p id="75b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是时候回去修改Flask代码，以便它运行<code class="eh lv lw lx ly b">get_items</code>函数了。</p><p id="edfa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将app.py文件更改为包含以下代码:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="a32a" class="jp jq hu ly b fv mh mi l mj mk">from flask import Flask, jsonify<br/>import aws_controller<br/><br/>app = Flask(__name__)<br/><br/>@app.route('/')<br/>def index():<br/>    return "This is the main page."<br/>    <br/>@app.route('/get-items')<br/>def get_items():<br/>    return jsonify(aws_controller.get_items())<br/><br/><br/>if __name__ == '__main__':<br/>    app.run()</span></pre><p id="03f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个文件中，我们更改了两件事</p><ol class=""><li id="98ce" class="lh li hu it b iu iv iy iz jc lj jg lk jk ll jo mm ln lo lp dt translated">我们进口了<code class="eh lv lw lx ly b">aws_controller.py</code>。这将使我们能够访问<code class="eh lv lw lx ly b">get_items</code>功能。</li><li id="0ee8" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo mm ln lo lp dt translated"><code class="eh lv lw lx ly b">/get-items</code> route现在从<code class="eh lv lw lx ly b">aws_controller.get_items</code>函数返回结果，但不是在将结果传递给<code class="eh lv lw lx ly b">jsonify()</code>之前，后者将对象转换成客户端浏览器能够呈现的json等价物。</li></ol><p id="5780" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在一切都设置好了，您可以通过在终端中运行以下命令来启动Flask web服务器。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="db2e" class="jp jq hu ly b fv mh mi l mj mk">flask run</span></pre><p id="f967" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果Flask能够绑定到正确的套接字，服务器现在应该正在运行，您应该会看到下面的输出。</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="988b" class="jp jq hu ly b fv mh mi l mj mk"><em class="mn">(env)</em> flaskdynamodb$ <em class="mn">flask</em> run<br/> <em class="mn">*</em> Serving Flask app "app.py"<br/> <em class="mn">*</em> Environment: production<br/>   <em class="mn">WARNING:</em> Do not use the development server in a production environment.<br/>   <em class="mn">Use</em> a production WSGI server instead.<br/> <em class="mn">*</em> Debug mode: off<br/> <em class="mn">*</em> Running on http://127.0.0.1:5000/ (Press <em class="mn">CTRL+C</em> to quit)<br/>127.0.0.1 <em class="mn">-</em> - [12/Dec/2018 22:51:21] "GET / HTTP/1.1" 404 -<br/><em class="mn">127.0.0.1</em> - - [12/Dec/2018 22:51:21] "GET /favicon.ico HTTP/1.1" 404 -<br/><em class="mn">127.0.0.1</em> - - [12/Dec/2018 22:51:26] "GET /get-items HTTP/1.1" 200 -<br/><em class="mn">127.0.0.1</em> - - [12/Dec/2018 22:51:26] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><p id="621f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">打开浏览器，转到输出中指定的url。这个默认会是<a class="ae kp" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/ </a>。</p><p id="8a8f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在输入<code class="eh lv lw lx ly b">/get-items</code>的网址。<a class="ae kp" href="http://127.0.0.1:5000/get-items" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:5000/get-items</a>。</p><p id="a3a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您应该会看到表中所有项目的列表。</p><figure class="lz ma mb mc fq mp fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff mo"><img src="../Images/810e4b4fde491cb12865874dfab50d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vcpvD0QfrSrvHEae.png"/></div></div></figure><p id="f188" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！您现在有了一个简单的RESTful API，可以与DynamoDB交互。</p><p id="6ae6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感谢跟随。</p><p id="7243" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae kp" href="https://github.com/albertacuna" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p></div><div class="ab cl mw mx hc my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="hn ho hp hq hr"><p id="3492" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="mn">原载于2018年12月13日</em><a class="ae kp" href="http://blog.albertoacuna.com/using-aws-dynamodb-with-flask/" rel="noopener ugc nofollow" target="_blank"><em class="mn">blog.albertoacuna.com</em></a><em class="mn">。</em></p><figure class="lz ma mb mc fq mp"><div class="bz el l di"><div class="nd ne l"/></div></figure></div></div>    
</body>
</html>