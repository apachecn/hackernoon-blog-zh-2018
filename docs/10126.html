<html>
<head>
<title>Panic like a Pro</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像专业人士一样恐慌</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/panic-like-a-pro-89044d5a2d35?source=collection_archive---------5-----------------------#2018-12-17">https://medium.com/hackernoon/panic-like-a-pro-89044d5a2d35?source=collection_archive---------5-----------------------#2018-12-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="4b59" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">高级Go紧急编程</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/659bc334204845ba1ec095ce83a7e7da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZkzQ4sJtZ8sP9eInIfz3w.jpeg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">I do it cause I need to…</figcaption></figure><h2 id="0941" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">先决条件</h2><p id="beff" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">本文期望你已经熟悉了<code class="eh lq lr ls lt b">golang</code>、<code class="eh lq lr ls lt b">panic</code>、&amp;、<code class="eh lq lr ls lt b">recover</code>函数以及任何其他具有<code class="eh lq lr ls lt b">exceptions</code> ( <code class="eh lq lr ls lt b">try-catch</code>)概念的编程语言。</p><h2 id="f754" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">介绍</h2><p id="33bb" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">你可能已经在<a class="ae lu" href="https://www.openmymind.net/The-Little-Go-Book/" rel="noopener ugc nofollow" target="_blank">的小围棋书</a>里看到过这样的东西:</p><blockquote class="lv"><p id="b066" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">Go处理错误的首选方式是通过返回值，而不是异常</p></blockquote><p id="6d81" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">也许你已经看过go wiki上的“<a class="ae lu" href="https://github.com/golang/go/wiki/CodeReviewComments#dont-panic" rel="noopener ugc nofollow" target="_blank"> CodeReviewComments </a>”页面，上面写着:</p><blockquote class="lv"><p id="2078" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">不要使用panic进行正常的错误处理。使用错误和多个返回值</p></blockquote><p id="b049" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">还有，你可能已经看过“<a class="ae lu" href="https://golang.org/doc/effective_go.html#panic" rel="noopener ugc nofollow" target="_blank">有效围棋</a>”的文章，其中说:</p><blockquote class="lv"><p id="7a69" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">向调用者报告错误的通常方式是将错误作为额外的返回值返回</p></blockquote><p id="b3c6" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">此外，你可能已经在戴夫·切尼的博客文章“<a class="ae lu" href="https://dave.cheney.net/tag/panic" rel="noopener ugc nofollow" target="_blank">为什么Go会有例外</a>”上看到过，文章说:</p><blockquote class="lv"><p id="2d65" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">当你在围棋中惊慌失措时，你会吓坏，这不是别人的问题，而是人类的游戏</p></blockquote><p id="2e0b" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">可能感觉恐慌是在自己的项目中最好避免的事情…<br/>但这是否意味着没有人使用恐慌？<br/>一起来看看吧！让我们对流行的<code class="eh lq lr ls lt b">go</code>项目运行下一个命令，看看恐慌是否是没有人使用的东西:</p><pre class="jk jl jm jn fq mk lt ml mm aw mn dt"><span id="7996" class="jz ka hu lt b fv mo mp l mq mr">grep "panic(" -r --include=*.go . | wc -l</span></pre><p id="241e" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">结果:</p><pre class="jk jl jm jn fq mk lt ml mm aw mn dt"><span id="0f4f" class="jz ka hu lt b fv mo mp l mq mr">+-------------+-----------------+<br/>| name        | count of panics |<br/>+-------------+-----------------+<br/>| <a class="ae lu" href="https://github.com/golang/go" rel="noopener ugc nofollow" target="_blank">go</a>          |            4050 |<br/>| <a class="ae lu" href="https://github.com/kubernetes/kubernetes" rel="noopener ugc nofollow" target="_blank">kubernetes</a>  |            4087 |<br/>| <a class="ae lu" href="https://github.com/gin-gonic/gin" rel="noopener ugc nofollow" target="_blank">gin</a>         |              46 |<br/>| <a class="ae lu" href="https://github.com/prometheus/prometheus" rel="noopener ugc nofollow" target="_blank">prometheus</a>  |             693 |<br/>| <a class="ae lu" href="https://github.com/hashicorp/terraform" rel="noopener ugc nofollow" target="_blank">terraform</a>   |            1161 |<br/>| <a class="ae lu" href="https://github.com/labstack/echo" rel="noopener ugc nofollow" target="_blank">echo</a>        |              14 |<br/>| <a class="ae lu" href="https://github.com/golang/dep" rel="noopener ugc nofollow" target="_blank">dep</a>         |             157 |<br/>| <a class="ae lu" href="https://github.com/gorilla/mux" rel="noopener ugc nofollow" target="_blank">gorilla mux</a> |               9 |<br/>| <a class="ae lu" href="https://github.com/go-sql-driver/mysql" rel="noopener ugc nofollow" target="_blank">mysql</a>       |               5 |<br/>| <a class="ae lu" href="https://github.com/lib/pq" rel="noopener ugc nofollow" target="_blank">pq</a>          |              46 |<br/>+-------------+-----------------+</span></pre><p id="6c25" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">嗯…</p><h2 id="4656" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">如何与之共存</h2><p id="9aa1" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">乍一看，文档、书籍和文章说不要使用恐慌，这可能会让人感到困惑，但现实是另一回事，我们可以在任何地方看到恐慌…</p><p id="1d51" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">希望你会同意恐慌不是简单地说“使用或不使用”的想法。</p><p id="02f4" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">因此，让我们尝试更深入地了解恐慌的光明面和黑暗面的界限在哪里，为什么github上有这么多恐慌，为什么所有的书籍和文档都不喜欢恐慌。</p><h2 id="c6c9" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">什么是恐慌</h2><p id="87d1" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated"><a class="ae lu" href="https://golang.org/pkg/builtin/#panic" rel="noopener ugc nofollow" target="_blank">官方文件</a>说:</p><blockquote class="lv"><p id="b784" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">panic内置函数停止当前goroutine的正常执行</p></blockquote><p id="264c" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">“<a class="ae lu" href="https://github.com/golang/go/wiki/PanicAndRecover" rel="noopener ugc nofollow" target="_blank">panic Andre recover</a>”维基页面说:</p><blockquote class="lv"><p id="767d" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">panic和recover函数的行为类似于其他一些语言中的异常和try/catch</p></blockquote><p id="9878" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">而“<a class="ae lu" href="https://gobyexample.com/panic" rel="noopener ugc nofollow" target="_blank">以身作则</a>”也说:</p><blockquote class="lv"><p id="7e85" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">恐慌通常意味着出现了意想不到的问题。大多数情况下，我们使用它来快速失败在正常操作期间不应该发生的错误</p></blockquote><p id="be9c" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">好的…现在感觉恐慌就像其他语言中的异常，这解释了前面提到的github项目中的大量恐慌。</p><p id="14f7" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">但是如果你看过戴夫·切尼的博客文章“<a class="ae lu" href="https://dave.cheney.net/tag/panic" rel="noopener ugc nofollow" target="_blank">为什么Go会有例外</a>”，你可能会看到:</p><blockquote class="lv"><p id="13a9" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">你可能会认为恐慌和呕吐是一样的，但是你错了</p></blockquote><p id="bd49" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">这意味着恐慌和其他语言中的<code class="eh lq lr ls lt b">throw exception</code>有一点点不同，有自己的优点和缺点。</p><h2 id="c71c" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">优势</h2><ol class=""><li id="57f8" class="mx my hu kz b la lb ld le kk mz ko na ks nb lp nc nd ne nf dt translated">像其他语言中的<code class="eh lq lr ls lt b">throw exception</code>一样，停止程序执行并将堆栈展开到顶层函数调用。</li><li id="679f" class="mx my hu kz b la ng ld nh kk ni ko nj ks nk lp nc nd ne nf dt translated">不需要处理多个返回值，不需要写无聊的检查:<code class="eh lq lr ls lt b">if err != nil { // handle error }</code>。<br/>因此——代码更容易阅读。</li></ol><h2 id="cd11" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">不足之处</h2><ol class=""><li id="7351" class="mx my hu kz b la lb ld le kk mz ko na ks nb lp nc nd ne nf dt translated">如果你不做<code class="eh lq lr ls lt b">recover</code>，将会停止程序。</li><li id="3bb4" class="mx my hu kz b la ng ld nh kk ni ko nj ks nk lp nc nd ne nf dt translated">当<code class="eh lq lr ls lt b">go</code>执行展开堆栈时，它会收集整个调用堆栈的信息，这可能会很慢。</li><li id="3a37" class="mx my hu kz b la ng ld nh kk ni ko nj ks nk lp nc nd ne nf dt translated">函数<code class="eh lq lr ls lt b">recover</code>返回<code class="eh lq lr ls lt b">interface{}</code>，您必须对获得的值执行类型检查，这可能会很慢(尤其是在反射的情况下)。而且不像其他语言中的<code class="eh lq lr ls lt b">catch</code>确定<code class="eh lq lr ls lt b">exception</code>。</li><li id="c939" class="mx my hu kz b la ng ld nh kk ni ko nj ks nk lp nc nd ne nf dt translated">在<code class="eh lq lr ls lt b">goroutine</code>死机的情况下，功能<code class="eh lq lr ls lt b">recover</code>不会停止死机。这也不是其他语言中的传统方式。</li></ol><h2 id="97bb" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">何时使用恐慌</h2><p id="b1a0" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">现在很明显，恐慌是锋利的*工具，你在使用它之前必须三思。并解释了简介部分提供的所有注意事项。</p><p id="ef5c" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">又“<a class="ae lu" href="https://golang.org/doc/effective_go.html#panic" rel="noopener ugc nofollow" target="_blank">有效走</a>说:</p><blockquote class="lv"><p id="bac6" class="lw lx hu bd ly lz ma mb mc md me lp ek translated">一个可能的反例是在初始化期间:如果库真的不能自我设置，那么恐慌是合理的</p></blockquote><p id="83d6" class="pw-post-body-paragraph kx ky hu kz b la mf iv lc ld mg iy lf kk mh lh li ko mi lk ll ks mj ln lo lp hn dt translated">如果你遇到由于某些情况而无法继续执行的情况，你可能会惊慌地停止程序。</p><h2 id="e514" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">又多了一个使用恐慌的理由</h2><p id="3322" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">我相信，如果您正在构建具有复杂业务逻辑和分层架构(此外，支持领域驱动设计)的reach应用程序，您必须使用panic。你可能讨厌我，但我相信这是唯一不会陷入错误处理和拥有清晰业务逻辑的方法。</p><h2 id="b60c" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">到处都是恐慌</h2><p id="1da1" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">首先，引言部分提供的数字意味着我们总是必须处理恐慌(即使我们没有在代码中明确使用恐慌)<br/>因为下游的某些东西可能会恐慌，甚至语言本身也可能会恐慌，为了避免程序停止，我们必须有恐慌处理程序(<code class="eh lq lr ls lt b">recover</code>)。<br/>如果项目有用户界面(从用户/其他服务获取命令/请求，并提供结果/响应),这也非常重要，因为我们必须始终以确定的消息格式提供结果/响应，即使是在未处理的严重错误的情况下。<br/>所以在<code class="eh lq lr ls lt b">main.go</code>中，我们必须有这样的东西:</p><pre class="jk jl jm jn fq mk lt ml mm aw mn dt"><span id="cb82" class="jz ka hu lt b fv mo mp l mq mr">func main() {<br/>    defer func() {<br/>        if r := recover(); r != nil {<br/>            // handle panic<br/>        }<br/>    }()<br/>    // ...<br/>}</span></pre><p id="acac" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">这只是一个简单的例子，但是你可以在这里阅读更多关于<code class="eh lq lr ls lt b">defer-recover</code> <a class="ae lu" href="https://blog.golang.org/defer-panic-and-recover" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="e82b" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">同样重要的是，承认你必须有<code class="eh lq lr ls lt b">defer-recover</code>，以防你开始新的<code class="eh lq lr ls lt b">goroutine</code>，否则你将无法处理<code class="eh lq lr ls lt b">goroutine</code>带来的恐慌。<br/>您可能会在“处理错误和恐慌”一章的“<a class="ae lu" href="https://www.amazon.com/Go-Practice-Techniques-Matt-Butcher/dp/1633430073" rel="noopener ugc nofollow" target="_blank">练习</a>”一书中读到更多相关内容，这里我将提供一些最有趣的图片:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nl"><img src="../Images/8e776adc787d3ba422b619174005d9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kgprUaP5FPqKdbP4z93f6g.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Normal flow.</figcaption></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nm"><img src="../Images/5396e595ff79e4e54c41ac74caf4c4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFQsIXxixfheh4tDCMUIsg.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Panic.</figcaption></figure><h2 id="885b" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">语法糖</h2><p id="4155" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">一旦你开始更频繁地使用恐慌，你也必须更频繁地执行<code class="eh lq lr ls lt b">recover</code>，并且有目的地以稍微愉快的方式去做，你可以使用类似于<a class="ae lu" href="https://github.com/thepkg/recover" rel="noopener ugc nofollow" target="_blank">恢复</a>的包。此产品包背后的主要思想是简化紧急恢复，并提供以以下方式执行恢复的机会:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="c126" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">您可能会发现这种语法与其他语言中的传统方式<code class="eh lq lr ls lt b">catch exception</code>非常相似，但是这种方法的主要目标是简单明了，并且易于阅读、理解和预测代码块的行为。</p><h2 id="bd51" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">比较</h2><p id="353d" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">让我们比较两种方法:1 —返回错误，2 —死机。<br/>为了比较，让我们用一个简单的例子:假设我们有:<br/> 1) <code class="eh lq lr ls lt b">facade</code> —在facebook、twitter和pinterest上创建用户的服务。调用facade服务，检查错误并打印结果。<br/>序列图看起来是这样的:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff np"><img src="../Images/6bf6e6d0a9ebb297c78c1515e45d590b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*6lepeB7q6MCWy-Xao_Mnmw.png"/></div></figure><h2 id="badb" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">实施#1</h2><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nn no l"/></div></figure><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="90d2" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">在这里你可以看到控制器中的超级简单函数<code class="eh lq lr ls lt b">SignUp</code>，它调用<code class="eh lq lr ls lt b">service.SignUp</code>然后检查服务错误并打印结果(一切都清晰、简单和直接)。</p><p id="03d9" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">众所周知，这段代码习惯于处理<code class="eh lq lr ls lt b">go</code>中的错误。而且很棒！</p><p id="55dc" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">但是说到服务，你会发现很多重复的代码，感觉好像有什么地方出错了…</p><p id="e4b4" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">(这里可以找到源代码<a class="ae lu" href="https://github.com/cn007b/eop/tree/master/src/app/examples/error" rel="noopener ugc nofollow" target="_blank">)。</a></p><h2 id="bc2e" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">实施#2</h2><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nn no l"/></div></figure><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="675f" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">这里你可以看到控制器中同样的函数<code class="eh lq lr ls lt b">SignUp</code>，它调用<code class="eh lq lr ls lt b">service.MustSignUp</code>然后执行<code class="eh lq lr ls lt b">recover</code>(通过<a class="ae lu" href="https://github.com/thepkg/recover" rel="noopener ugc nofollow" target="_blank">恢复</a>包)并打印结果(同样的流程)。<br/>如果你看一看服务，你可能会发现现在它看起来更短更简单，更容易阅读和理解这样的业务逻辑。</p><p id="61da" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">但是这个代码在<code class="eh lq lr ls lt b">go</code>是被禁止的，原因如前所述…</p><p id="5995" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">(你可以在这里找到源代码<a class="ae lu" href="https://github.com/cn007b/eop/tree/master/src/app/examples/pro_panic" rel="noopener ugc nofollow" target="_blank">)。</a></p><h2 id="aee6" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">真的很糟糕吗</h2><p id="622f" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">从技术上来说，这两种实现是相同的，并提供相同的功能、相同的错误和相同的结果(你可以在这里查看<a class="ae lu" href="https://github.com/cn007b/eop" rel="noopener ugc nofollow" target="_blank"/>)。<br/>但是关于代码量，很明显第二个更简单，你可以在下图中看到:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nq"><img src="../Images/8cbeea9fb2f2bcdb7c72f943c247dde7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15_iXfTggdlDDAxGWOU7QA.png"/></div></div></figure><p id="4462" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">此外，第一个实现没有<code class="eh lq lr ls lt b">recover</code>，但它应该有，因为每个用户友好的项目都必须有recover，这意味着第一个实现将有更多的代码。</p><h2 id="4a99" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">它慢吗</h2><p id="0f60" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">对这样的小例子进行基准测试可能看起来很傻，但无论如何，让我们看看它看起来如何，并找出我们是否有倾斜的数字:</p><pre class="jk jl jm jn fq mk lt ml mm aw mn dt"><span id="4029" class="jz ka hu lt b fv mo mp l mq mr">+---------------------------------+----------+----------+<br/>| case                            | imp. #1  | imp. #2  |<br/>+---------------------------------+----------+----------+<br/>| error: username cannot be blank | 53000 ns | 45000 ns |<br/>| error: username already taken   | 51000 ns | 46000 ns |<br/>| ok                              | 32000 ns | 34000 ns |<br/>+---------------------------------+----------+----------+</span></pre><p id="3bd8" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">看起来在出错的情况下会更快，但在成功的情况下— <code class="eh lq lr ls lt b">recover</code>会产生一些开销… <br/>请注意，所有提供的数字都以纳秒为单位表示时间，<br/>这意味着:对于这种特殊的情况，我们在两种方法之间没有太大的区别…</p><p id="4c50" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">(你可以在这里找到与这个基准测试<a class="ae lu" href="https://github.com/cn007b/eop/blob/master/src/app/main.go" rel="noopener ugc nofollow" target="_blank">相关的源代码)。</a></p><h2 id="629a" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">Go 2草稿</h2><p id="40c4" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">你可能已经知道在<code class="eh lq lr ls lt b">go 2</code>中，错误处理将通过<code class="eh lq lr ls lt b">check-handle</code>组合得到改进(如果没有，请<a class="ae lu" href="https://go.googlesource.com/proposal/+/master/design/go2draft-error-handling-overview.md" rel="noopener ugc nofollow" target="_blank">看一看</a>)，它将以真正优雅的方式简化一切！但是它有助于构建复杂的分层应用程序吗？<br/>答案是肯定的，对于像我们这样非常简单的应用程序(控制器服务)，但不幸的是，对于大型应用程序，尤其是支持域驱动设计的应用程序来说<code class="eh lq lr ls lt b">check-handle</code>没有用，<br/>我相信您仍然必须使用panic…</p><h2 id="2d00" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">结论</h2><p id="86a2" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">这篇文章的重点是要表明恐慌只是一种工具，你不必害怕这种工具，你必须知道何时以及如何使用恐慌… <br/>一旦你知道了这种工具的优点和缺点，你就可以决定是否使用它。</p><h2 id="8a15" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">附言（同postscript）；警官（police sergeant）</h2><p id="8287" class="pw-post-body-paragraph kx ky hu kz b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">你可以在这里找到演示项目<a class="ae lu" href="https://github.com/cn007b/monitoring" rel="noopener ugc nofollow" target="_blank"/>的分层架构(不是DDD，而是许多层),这是建立在恐慌无处不在的想法，也许它会是说明性的。</p><p id="2a0d" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">此外，您可以在这里找到更多使用这两种方法的例子<code class="eh lq lr ls lt b">errors vs panic </code><a class="ae lu" href="https://github.com/cn007b/eop" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="68a7" class="pw-post-body-paragraph kx ky hu kz b la ms iv lc ld mt iy lf kk mu lh li ko mv lk ll ks mw ln lo lp hn dt translated">如果您不喜欢恐慌，您可能会发现另一种方法如何以另一种方式简化错误处理。</p></div></div>    
</body>
</html>