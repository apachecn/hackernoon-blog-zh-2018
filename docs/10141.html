<html>
<head>
<title>How to Install pfSense</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何安装pfSense</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-install-pfsense-dad8a98d5c6?source=collection_archive---------20-----------------------#2018-12-17">https://medium.com/hackernoon/how-to-install-pfsense-dad8a98d5c6?source=collection_archive---------20-----------------------#2018-12-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/84a61146bde2eba3e10aa4dda24d7009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v9OlqLzovxHbwj3KzDiiSw.jpeg"/></div></div></figure><div class=""/><p id="4f70" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">pfSense是使用最广泛的开源防火墙解决方案之一。我们已经在学校使用它好几年了，我们对它非常满意，因为它提供了许多<a class="ae ka" href="https://www.pfsense.org/about-pfsense/features.html" rel="noopener ugc nofollow" target="_blank">的功能</a>，而这些功能你必须在别处投入大量资金。今天我想向大家展示如何安装pfSense以及如何设置它。在此之前，我想先说说各种适合运行pfSense的硬件。</p><h1 id="5482" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">我需要什么硬件？</h1><p id="6c67" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">一般来说，你可以说理论上你可以用任何一台至少有两块网卡的电脑来运行pfSense。例如，这可能是一台您不再需要的旧计算机，您为它配备了第二块网卡。但通常旧电脑不是很节能，其他替代品更合适。除了功耗，预期用例也起着决定性的作用。我是在只有几个用户的家里使用防火墙，还是在有更多访问的学校或公司使用防火墙，这是有区别的。</p><p id="ba78" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">家用电脑引擎的<a class="ae ka" href="https://amzn.to/2GpNfNG" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> APU2C4 </strong> </a>板很受欢迎(主要在欧洲)，但也有被动冷却的迷你电脑，如<a class="ae ka" href="https://amzn.to/2S4enDn" rel="noopener ugc nofollow" target="_blank"><strong class="je ig"/></a>或<a class="ae ka" href="https://amzn.to/2ChEmSd" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig">那台</strong> </a>。对于学校或公司，建议使用至少4块网卡的主板，具体取决于要求。我们使用Netgate的SG-4860。如果你在亚马逊或全球速卖通搜索pfSense，你会发现很多优惠。唯一重要的是CPU支持AES-NI，因为pfSense的这个特性在以后的版本中是绝对必要的。</p><p id="f5e6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在pfSense 项目的<a class="ae ka" href="https://www.pfsense.org/products/#requirements" rel="noopener ugc nofollow" target="_blank">网站上，有一些关于硬件要求的一般提示:</a></p><ul class=""><li id="2445" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">最低→512兆内存，500兆赫CPU</li><li id="315c" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">推荐→ 1GB内存，1Ghz CPU</li></ul><p id="cf23" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择硬件时还应考虑可用带宽，否则pfSense可能会成为瓶颈。</p><ul class=""><li id="2807" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">10–20 Mbps→至少500MHz的英特尔或AMD CPU。</li><li id="3953" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">21–100 Mbps→当前1Ghz的英特尔或AMD CPU</li><li id="cf31" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">101–500 Mbps→当前英特尔或AMD CPU，至少2 Ghz和一个PCI-e网卡</li><li id="017d" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">501+ Mbps →服务器硬件，带多核CPU，每个CPU至少2 Ghz，PCI-e网卡</li></ul><h1 id="ba7c" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">准备pfSense安装</h1><h2 id="0a2a" class="ls kc if bd kd lt lu lv kh lw lx ly kl jn lz ma kp jr mb mc kt jv md me kx mf dt translated">下载图像</h2><p id="0cb6" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在开始安装之前，您需要知道您需要哪个pfSense映像。例如，这取决于所使用的硬件是具有VGA/HDMI输出还是只有串行控制台。或者是想通过光盘、u盘还是直接在硬盘上安装。因此，我想在这里给出一些提示:</p><p id="9676" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">建筑:</p><ul class=""><li id="04cf" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">只有当您也使用Netgate产品时，才需要Netgate ADI。</li><li id="1b53" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">AMD64适用于所有其他产品(英特尔AMD64位CPU)</li></ul><p id="aaae" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">图像类型</p><ul class=""><li id="72e2" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">使用USB记忆棒进行安装需要USB记忆棒安装程序。</li><li id="d0fa" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">光盘映像(ISO)安装程序用于光盘安装或虚拟机安装</li></ul><p id="44ca" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">安慰</p><ul class=""><li id="4056" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">串行—如果只有一个串行端口可用(USB或RS-232)</li><li id="6a86" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">VGA —如果使用的硬件具有VGA/DVI或HDMI输出。</li></ul><p id="caf8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你知道你需要哪个图像，你可以从pfSense网站下载。</p><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/4a58582810c8cc30232c680706c3a34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*_mQOo1qAsYKyoz_SqpeEFg.png"/></div></figure><h2 id="4fb8" class="ls kc if bd kd lt lu lv kh lw lx ly kl jn lz ma kp jr mb mc kt jv md me kx mf dt translated">准备USB闪存驱动器</h2><p id="7d6a" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><a class="ae ka" href="https://www.pfsense.org/download/" rel="noopener ugc nofollow" target="_blank"> pfSense文档</a>包含了很多关于准备u盘的信息。在我们的例子中，我们假设一个USB记忆棒VGA安装程序。首先你应该格式化或清空u盘。这在Linux下非常容易</p><pre class="mh mi mj mk fq ml mm mn mo aw mp dt"><span id="122d" class="ls kc if mm b fv mq mr l ms mt">$ sudo dd if=/dev/zero of=/dev/sdz bs=1M count=1</span></pre><blockquote class="mu mv mw"><p id="16e6" class="jc jd mx je b jf jg jh ji jj jk jl jm my jo jp jq mz js jt ju na jw jx jy jz hn dt translated"><strong class="je ig"> <em class="if">注意:一定要注意of=/dev/之后指定的是哪个设备。否则，您可能会清空主分区，数据会不可挽回地丢失！</em> </strong> <em class="if">要找出设备名称，最好插上u盘，然后在一个终端中运行</em> <code class="eh nb nc nd mm b"><em class="if">dmesg</em></code> <em class="if">。然后你就可以看到u盘得到了哪个设备名(往往是</em> /dev/sdb <em class="if">)。</em></p></blockquote><p id="13ae" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在上面链接的文档中可以找到在Windows或macOS下清除USB闪存驱动器的说明。</p><p id="6a41" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您可以将下载的映像写入USB闪存驱动器。</p><pre class="mh mi mj mk fq ml mm mn mo aw mp dt"><span id="6dbd" class="ls kc if mm b fv mq mr l ms mt">$ gzip -dc pfSense-memstick-2.4.4-RELEASE-amd64.img.gz | sudo dd of=/dev/sdz bs=1M $ sync</span></pre><p id="3b03" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">USB闪存驱动器现已准备就绪。下一步从这个USB拇指驱动器启动，并开始安装。根据BIOS，记忆棒将被识别为USB设备或另一个硬盘。引导顺序必须经常改变，以避免从第一个硬盘引导。如果引导不起作用，文档<a class="ae ka" href="https://www.netgate.com/docs/pfsense/install/installation-troubleshooting.html" rel="noopener ugc nofollow" target="_blank">也提供了一些想法。</a></p><h1 id="d331" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">安装pfSense</h1><p id="3def" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">成功引导后，会出现pfSense欢迎屏幕。</p><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ne"><img src="../Images/fd2ac365794e193188e98a775af00e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ObrH3yYHLs2ZaYUvx01NRQ.png"/></div></div></figure><p id="ff74" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里你选择“<em class="mx">安装</em>”。在下一个对话框中，您可以定义键盘布局。对于分区，最好使用“<em class="mx">自动(UFS) </em>”，并按回车键再次确认。</p><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ne"><img src="../Images/cd3ce4f946553f57cc932be902bcbc07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wc6K-ADe6zdM1Tkr_l_03g.png"/></div></div></figure><p id="5272" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后自动安装开始。安装完成后，会询问您是否要打开一个shell(您可以否认)。最后，您必须重启系统(“<em class="mx"> Reboot </em>”)。在接下来的引导中，你应该确保你不会再从u盘引导，而是从硬盘引导！</p><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ne"><img src="../Images/0ec374ec9d017796170a782f87721324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rButAx0BgBtAUXEIcUQeeg.png"/></div></div></figure><h1 id="369d" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">设置网络接口</h1><h2 id="43f5" class="ls kc if bd kd lt lu lv kh lw lx ly kl jn lz ma kp jr mb mc kt jv md me kx mf dt translated">分配网络接口</h2><p id="0f63" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">重启期间，pfSense会自动尝试配置WAN接口。WAN接口是连接到互联网服务提供商的路由器或互联网的网卡。如果自动配置成功，将出现pfSense控制台菜单，否则将出现一个对话框。</p><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ne"><img src="../Images/ecf6e142fb4ec3a016669419e3fcf4a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iU5McFeKUGZbL3JukDlCqA.png"/></div></div></figure><p id="d0c1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要更改WAN和LAN接口，选择1“分配接口”。现在你必须回答一些问题:</p><ul class=""><li id="948b" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">现在应该设置VLANs吗？→否(否)</li><li id="a1c4" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">输入WAN接口名称或“a”进行自动检测→您必须在此输入WAN网卡的名称。MAC地址显示在对话框的开头。在我们的例子中，它被称为<em class="mx"> em0 </em>。</li><li id="6346" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">输入LAN接口名称或“a”进行自动检测→您必须在此输入LAN网卡的名称。在我们的例子中，它被称为<em class="mx"> em1 </em>。</li><li id="e329" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">是否要继续→ y(是)。作业的简短摘要将会预先展示。</li></ul><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ne"><img src="../Images/837c3e577006f257dc3808bfda498523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRsISdLjZax3X3qAttJAdw.png"/></div></div></figure><h2 id="bb26" class="ls kc if bd kd lt lu lv kh lw lx ly kl jn lz ma kp jr mb mc kt jv md me kx mf dt translated">设置IP地址</h2><p id="1cde" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">如果DHCP服务器在WAN接口上运行，它应该自动拥有一个IP地址。否则，您必须为WAN和LAN接口配置IP地址。作为一个例子，我将在这里展示它的局域网接口。选择№2 " <em class="mx">设置接口IP地址</em>。</p><ul class=""><li id="68c1" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">输入您要配置的接口编号→ 2表示LAN接口</li><li id="abf6" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">输入新的局域网IPv4地址→例如10.10.10.1或10.10.10.1/24</li><li id="9006" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">如果在上一步中没有指定网络掩码，现在必须指定:输入新的LAN IPv4子网位数(1到31)。→ 24(相当于255.255.255.0，即254个IP地址)。</li><li id="cf44" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">在下一个问题中，必须定义网关。这对于LAN接口不是必需的，对于WAN接口才是必需的。→只需按回车键(无)。</li><li id="389b" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">输入新的局域网IPv6地址。按<enter>无→回车(无)</enter></li><li id="f333" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">您想在局域网上启用DHCP服务器吗？→ y(是)，除非局域网中已经有DHCP服务器。</li><li id="2a09" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">输入IPv4客户端地址范围的起始地址→ 10.10.10.10(客户端可以在局域网中获得的第一个IP地址)</li><li id="2316" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">输入IPv4客户端地址范围的结束地址→ 10.10.10.200(客户端可以在局域网中获得的最后一个IP地址)</li><li id="64cc" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">是否要恢复HTTP作为webConfigurator协议？→否(不，HTTPS应保留)</li></ul><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ne"><img src="../Images/ff9edac9b08cd557cef5fd182b0642c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H8eHGgn67T7MEbFJRSa5Jg.png"/></div></div></figure><h1 id="0d61" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Web界面中的更多设置</h1><p id="df26" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">使用一台连接到局域网的计算机，您可以通过<a class="ae ka" href="https://10.10.10.1" rel="noopener ugc nofollow" target="_blank"> https://10.10.10.1 </a>访问pfSense web界面进行一些基本设置。第一次出现证书警告。因为这是用于HTTPS连接的自签名证书，所以您必须接受它。默认凭证为<strong class="je ig"> <em class="mx"> admin </em> </strong>，密码为<strong class="je ig"> <em class="mx"> pfsense </em> </strong>。</p><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nf"><img src="../Images/cdb8b8114104c62d6591875c75e9f702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9tiwSQTjn3kALQf-Ly4bMw.png"/></div></div></figure><p id="2627" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">登录后，你会看到一个助手。在第二步中，您可以为防火墙分配一个主机名并输入域。同样重要的是主DNS服务器和辅助DNS服务器，以及是否可以通过WAN接口上的DHCP覆盖DNS服务器(例如，使用互联网服务提供商的DNS)。</p><figure class="mh mi mj mk fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ng"><img src="../Images/868ac0e3ad3c247517aada2ec3194b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mM12-990sUetMoC3gGCpvQ.png"/></div></div></figure><p id="4126" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在接下来的步骤中，您将设置时区，再次检查WAN和LAN接口的配置，并在步骤6中分配一个新的管理员密码。这就完成了设置。</p><h1 id="5454" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="1be2" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">安装pfSense通常很容易。有时很难选择正确的镜像来安装或从u盘引导，或者设置串行连接。pfSense文档处理了许多这样的问题，并提供了解决方案的建议。初始配置完成后，防火墙就可以使用了。然而，防火墙仍然可以大大扩展和适应。这应该是以后文章的主题。</p></div><div class="ab cl nh ni hc nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hn ho hp hq hr"><p id="b69d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mx">原载于</em><a class="ae ka" href="https://openschoolsolutions.org/install-pfsense/" rel="noopener ugc nofollow" target="_blank"><em class="mx">openschoolsolutions.org</em></a><em class="mx">。</em></p></div></div>    
</body>
</html>