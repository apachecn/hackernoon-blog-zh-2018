<html>
<head>
<title>glTF: An Image Format for AR/VR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">glTF:一种用于增强现实/虚拟现实的图像格式</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/gltf-an-image-format-for-ar-vr-68087bfed6f1?source=collection_archive---------32-----------------------#2018-12-17">https://medium.com/hackernoon/gltf-an-image-format-for-ar-vr-68087bfed6f1?source=collection_archive---------32-----------------------#2018-12-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b9dd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">增强现实和虚拟现实(AR/VR)是越来越主流的酷技术。虽然今天它们可能主要在游戏中，有些需要像Oculus这样的花哨耳机，但有一些技术正在将AR/VR带入主流。例如，A-Frame是一个web框架，允许您将VR体验带入浏览器。作为一个框架，在语法上类似于写HTML，给很多开发者带来了较低的入门门槛。如果你不熟悉A-Frame，并且想了解更多——<a class="ae jp" href="https://aframe.io/docs/0.8.0/introduction/" rel="noopener ugc nofollow" target="_blank">教程</a>非常棒。</p><p id="ad42" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在A-frame中构建一个简单的世界很容易——一旦你完成了上面链接的教程，你将拥有一个简单的世界！但是让这个世界不仅仅是盒子、球体和圆柱体会很酷。幸运的是，有数百名(如果不是数千名)3D艺术家正在创作可用于你的AR/VR世界的物体渲染图。更好的是，这些文件有一个开放的、免版税的标准，在整个生态系统中都得到很好的支持:<a class="ae jp" href="https://www.khronos.org/gltf/" rel="noopener ugc nofollow" target="_blank"> glTF </a>。</p><p id="fc53" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这篇文章中的样本glTF文件来自KhronosGroup的<a class="ae jp" href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/AnimatedCube/glTF" rel="noopener ugc nofollow" target="_blank"> Github的样本文件</a>，以及来自<a class="ae jp" href="https://sketchfab.com/" rel="noopener ugc nofollow" target="_blank"> SketchFab </a>，我在那里下载了<a class="ae jp" href="https://sketchfab.com/models/9ddbc5b32da94bafbfdb56e1f6be9a38" rel="noopener ugc nofollow" target="_blank">“瓶中船”</a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/28632d5ab4006b5d07f54a37aa3898c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CrUgBwa8OPnqKryG"/></div></div></figure><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff kc"><img src="../Images/6fd14d2554fa898afa66b6e88c2d93c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/0*NQhEpkOlT43vIzqJ"/></div></figure><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff kd"><img src="../Images/7cfd082c93ef8044af5a0e4901a7cf93.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/0*rZyZ6rpVXzdfLFyx"/></div></figure><p id="9fd5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些文件以及它们的优化版本都在一个<a class="ae jp" href="https://github.com/dougsillars/glTF_optimization" rel="noopener ugc nofollow" target="_blank"> GitHub存储库中。</a></p><h1 id="70b3" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">glTF</h1><p id="70dd" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">glTF被其创始人称为“3D的JPEG ”,它基于JSON，但在其层次结构中有支持文件来创建3D结构。从上面链接的glTF页面:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lh"><img src="../Images/e343dbfe3ec545fcb55ea527e7dcf75a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HjjACYRecKyoM-jV.jpg"/></div></div></figure><p id="c30b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">的。gltf文件(如上所示)只是直接的JSON-将文件和几何图形链接成一个3D文件。例如，以下是Avocado gltf文件的文件结构:</p><h1 id="549c" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">glTF在行动</h1><p id="70b8" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">让我们展示一下afra frame中的3D鳄梨。为此，我们将Avocado gltf建立为一项资产，然后显示该实体。(它被放大了10倍，因为默认情况下这个鳄梨显示得非常小。):</p><pre class="jr js jt ju fq li lj lk ll aw lm dt"><span id="aeb1" class="ln kf hu lj b fv lo lp l lq lr">&lt;a-scene&gt; &lt;a-assets&gt; &lt;a-asset-item id="avocado" src="Avocado/glTF/Avocado.gltf"&gt;&lt;/a-asset-item&gt; &lt;/a-assets&gt; &lt;a-entity position="0 1.5 -1"scale="10 10 10" rotation="0 0 0" gltf-model="#avocado"&gt;&lt;/a-entity&gt; &lt;/a-scene&gt;</span></pre><p id="18bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你在你最喜欢的开发者工具中打开这个链接，你会看到这个简单的Avocado用了8.2 MB在页面上渲染。其中7.9 MB是因为图像。一个鳄梨。我认为我们可以做得更好。</p><p id="fd4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在所有测试的模型中，用于包装模型的图像占gltf文件大小的95%以上。</p><h1 id="97ed" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">图像优化</h1><p id="0173" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">与gltf文件相关的图像可以在Github repo的相关文件夹中找到。它们似乎是作为3D渲染引擎的原始输出导出的，很少考虑文件大小。由于这些模型中的任何一个都被设计为在应用程序或网站中分发，因此这些图像的大小应该是加载时间(和一般数据量)的一个问题。</p><p id="1561" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一个很远的论点，VR应用程序通常运行在具有快速网络条件的设备上，这些非常大的文件仍然会增加场景加载到页面上的明显延迟。在慢速网络上，文件大小可能会阻止3D模型的加载。</p><p id="8fe9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了优化我研究的gltfs中的图像，我选择了两种图像优化方法:改变图像格式和降低图像质量。为此，我将所有原始文件上传到Cloudinary，然后使用他们的图像转换工具为浏览器选择最佳格式——我在Chrome中进行测试，因此PNG和jpg大多被转换为WebP。我还利用结构相似性降低了图像质量，使其分辨率达到人眼无法分辨的程度。为此，我将图片上传到Cloudinary，并在url中添加参数q_auto、f_auto。</p><p id="9662" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要将这些新图像应用到gltf文件，我们必须替换gltf JSON中的图像引用。在这里，他们从本地参考转移到第三方云URI:</p><p id="9439" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">收件人:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/9d1f51206a9624c46ef9bea68d2a84c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IT0oGjX1A-7dhUfY"/></div></div></figure><p id="d105" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同样，gltf文件都在GitHub repo中，优化后的gltf和html页面都在文件名后附加了“_opt”。</p><h1 id="3fbd" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">结果:</h1><p id="cf3a" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">这是瓶中船的两个相似视图:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/e34fe0873e745aee76c3ae440e52caa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PvILh8LGOWlxLv8l"/></div></div></figure><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/d21ca639cbd90f964a87b2d680cde1fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ijnugXecvOdhGQof"/></div></div></figure><p id="a932" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从视觉上看，两个船帆没有什么大的区别。使用Chrome DevTools和一个模拟的5 MBPS下行链路连接，我估计了4种不同型号的MB和加载时间:</p><p id="f9ed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">原始(MB)优化(MB)加载(原始)加载(优化)%数据节省加载时间节省Cube 1.1 0.33 3.7 1.3 70.00% 64.86% Avocado 8.2 0.584 14 1.85 92.88% 86.79% Camera 43.5 4.7 80 8.5 89.20% 89.38% Ship 31.2 9.1 51 15.1 70.83% 70.39</p><p id="ec0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用优化的映像，数据节省在70–93%之间，加载时间加快了65–90%。</p><p id="85ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以自己比较一下:</p><h1 id="54cc" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">glTF优化的现状</h1><p id="f9f4" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">从快速阅读文档来看，有一些关于图像格式的工作将会变得更小，但是似乎没有做什么来降低现在使用的JPG或PNG文件的大小。</p><p id="4034" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另一个重点是Draco优化/压缩的使用，它允许更快地读取构建几何图形的gltf和bin文件。这是一项伟大的工作(查看演示Draco加速渲染<a class="ae jp" href="https://cesium.com/blog/2018/04/09/draco-compression/" rel="noopener ugc nofollow" target="_blank">曼哈顿</a>。性能的提高是惊人的。当我使用<a class="ae jp" href="https://github.com/AnalyticalGraphicsInc/gltf-pipeline" rel="noopener ugc nofollow" target="_blank"> gltf管道</a>通过Draco优化运行AntiqueCamera模型时，整个gltf是一个JSON文件。在查看这个文件时，它是59MB，所有的图像都是在JSON中进行Base64编码的。我最近<a class="ae jp" href="https://calendar.perfplanet.com/2018/performance-anti-patterns-base64-encoding/" rel="noopener ugc nofollow" target="_blank">研究了Base64作为图像的反模式</a>。Base64编码的图像将比原始的JPG或PNG文件大10–20 %,此外，Base64的渲染速度比原始文件慢。让我们希望这种模式不会在glTF优化中继续下去。</p><h1 id="7aea" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">结论</h1><p id="e3d9" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">AR/VR的使用正在增长，现在可以很容易地添加到主流游戏、应用和网站中。有数以千计的3D渲染对象可以添加到这些世界中，并且有一个很棒的、免版税的、开放的标准叫做gltf，它允许轻松共享和重用这些对象。</p><p id="ce84" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，这些对象远没有优化到可以在互联网上传送。图像往往是PNG或JPG文件，没有质量降低或试图格式化为较小的尺寸。在这个简单的实验中，我通过利用JPG、WebP和结构相似性，将4个gltf文件的大小缩小了70–92 %,图像清晰度几乎没有损失。</p><p id="b7aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感谢<a class="ae jp" href="https://twitter.com/tanay1337" rel="noopener ugc nofollow" target="_blank"> @ <strong class="it hv"> tanay1337 </strong> </a>在glTF在圣彼得堡DevFest的演讲中向我介绍了他。</p></div><div class="ab cl ls lt hc lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hn ho hp hq hr"><p id="b11c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lz">原载于2018年12月17日</em><a class="ae jp" href="https://dougsillars.com/2018/12/17/gltf-jpeg-for-3d/" rel="noopener ugc nofollow" target="_blank"><em class="lz">dougsillars.com</em></a><em class="lz">。</em></p></div></div>    
</body>
</html>