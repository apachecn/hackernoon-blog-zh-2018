<html>
<head>
<title>Use a YubiKey as a MFA device to replace Google Authenticator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用YubiKey作为MFA设备来替换Google Authenticator</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/use-a-yubikey-as-a-mfa-device-to-replace-google-authenticator-b4f4c0215f2?source=collection_archive---------3-----------------------#2018-12-20">https://medium.com/hackernoon/use-a-yubikey-as-a-mfa-device-to-replace-google-authenticator-b4f4c0215f2?source=collection_archive---------3-----------------------#2018-12-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/5b5d262eccea5d3f4ee1a274d26560d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jm26JbzkwxHhygXBY7_ZMg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Yep, just a door lock.</figcaption></figure><blockquote class="jg jh ji"><p id="731f" class="jj jk jl jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hn dt translated"><strong class="jm hv">T1】免责声明T3】</strong></p><p id="f4a5" class="jj jk jl jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hn dt translated">在可能的情况下应该使用U2F，因为它比任何其他替代方案都要安全得多。我使用TOTP而不是U2F的唯一原因是因为亚马逊网络服务不支持两个MFA设备连接到同一个用户，他们的AWS CLI也不支持U2F。</p><p id="82a2" class="jj jk jl jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hn dt translated">基本上，您可以使用U2F来访问web控制台，但在终端中运行CLI命令时，请忘记使用U2F(对我来说，这是不可接受的)。</p></blockquote><h1 id="d4e4" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">什么是YubiKey</h1><p id="51b7" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">YubiKey是一款小型硬件认证设备，由Yubico开发，支持多种认证协议。</p><p id="a5a4" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">它是一个USB key(有些版本支持USB-A，有些USB-C，最新版本甚至支持NFC)，带一个LED和一个按钮<em class="jl">。</em></p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lo"><img src="../Images/f07d5b3f65684511402eaf450c993f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1ZR-aV1W9zIdZI2o6K5nA.png"/></div></div></figure><blockquote class="jg jh ji"><p id="3f62" class="jj jk jl jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hn dt translated"><strong class="jm hv">注意:</strong>似乎YubiKey 4的固件版本介于4.2.6和4.3.4之间，存在一个安全漏洞，使得攻击者能够使用公钥重建私钥。你可以在这里和<a class="ae lt" href="https://crocs.fi.muni.cz/public/papers/rsa_ccs17" rel="noopener ugc nofollow" target="_blank">阅读更多关于这个</a><a class="ae lt" href="https://www.yubico.com/keycheck/" rel="noopener ugc nofollow" target="_blank">的内容。</a></p></blockquote><h2 id="7b54" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">USB接口</h2><p id="f72d" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">Yubico将这些<em class="jl"> USB接口称为</em>，它们中的每一个都支持一种或多种模式/协议。</p><ol class=""><li id="65a4" class="mi mj hu jm b jn jo jr js li mk lk ml lm mm kh mn mo mp mq dt translated"><strong class="jm hv"> FIDO: </strong>该接口仅支持<strong class="jm hv"> U2F </strong>协议。</li><li id="d55e" class="mi mj hu jm b jn mr jr ms li mt lk mu lm mv kh mn mo mp mq dt translated"><strong class="jm hv"> OTP: </strong>这个接口有2个插槽(短按和长按)。每一个都可以配置使用为:<strong class="jm hv">宣誓-HOTP，优必科OTP，</strong>T22】挑战-响应或者<strong class="jm hv">静态密码</strong>。默认情况下，Yubico OTP预先配置在第一个插槽中。</li><li id="ab2d" class="mi mj hu jm b jn mr jr ms li mt lk mu lm mv kh mn mo mp mq dt translated">CCID: 这是允许钥匙充当智能卡的接口。最多支持<strong class="jm hv"> 32个誓言-TOTP/誓言-HOTP </strong> <strong class="jm hv">代码，PIV </strong>和<strong class="jm hv"> OpenPGP </strong>。</li></ol><h2 id="68c9" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">U2F</h2><p id="75c4" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">一种开放式身份认证标准，支持对任意数量的基于web的应用程序进行强大的双因素身份认证，例如Gmail、Salesforce、Amazon Web Services、Twitter和数百种其他服务。</p><p id="79ac" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">U2F是推荐的双因素方法。与TOTP/谷歌认证器不同，它可以防止网络钓鱼，而且比短信/语音通话方式更难破解。</p><p id="b43d" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">它不需要任何软件或驱动程序。默认情况下，它可以在Chrome和Firefox中运行(你需要改变一个配置标志)。阅读更多关于<a class="ae lt" href="https://www.yubico.com/applications/fido/" rel="noopener ugc nofollow" target="_blank"> FIDO U2F </a>的信息。</p><h2 id="101a" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">智能卡(PIV)</h2><p id="8849" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">智能卡包含一个代理数据交换的芯片。这些相同的功能包含在YubiKey 4和5系列中，基于CCID协议的行业标准个人身份和验证卡(PIV)接口，该接口支持USB接口上的PIV。</p><h2 id="4884" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">尤比科OTP</h2><p id="27f4" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">YubiKey生成一次性使用的加密密码。黑客需要物理访问您的YubiKey来生成动态口令。这是一个奇怪的字符串，如果你触摸你的YubiKey来输入文本。</p><h2 id="3b5f" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">OpenPGP</h2><p id="81e9" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">在现实世界中，文档和数据通常通过签名进行验证。在虚拟世界中，OpenPGP是一种基于标准的公钥加密技术，用于对文本、电子邮件、文件等进行签名、加密和解密。</p><h2 id="8648" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated"><strong class="ak">静态密码</strong></h2><p id="96c3" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">一个基本的YubiKey功能，它可以生成一个38个字符的静态密码，与任何应用程序登录兼容。它最常用于无法改造以支持其他双因素身份认证方案(如预启动登录)的遗留系统。</p><blockquote class="jg jh ji"><p id="8bf9" class="jj jk jl jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hn dt translated">注意:这种模式容易受到键盘记录程序的攻击，所以应该尽可能避免。</p></blockquote><h2 id="ea80" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">誓言-TOTP/誓言-HOTP</h2><p id="6f6e" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">该密钥生成一个6或8个字符的动态口令(或一次性密码)，用于登录任何支持TOTP誓言或HOTP誓言的服务。</p><p id="eeb4" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">TOTP誓言和HOTP誓言的区别在于前者是基于时间的，这意味着新密码会在设定的时间间隔生成，通常是每30秒生成一次。后者是基于事件的，意味着为每个事件生成一个新的一次性密码。</p><h2 id="bca6" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">挑战-回应</h2><p id="f7c9" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">挑战-响应方法最适合离线验证。用于Windows、Mac和Linux电脑登录。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mw"><img src="../Images/a5fbe0f9ef7e7e2315095af381f514a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AWLjOhXJFP1u4uGl8v9sEA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">USB Interfaces and the different modes supported</figcaption></figure><h2 id="8dff" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">将使用哪个接口？</h2><p id="3833" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">出于我们的目的，我们将使用<strong class="jm hv"> CCID接口</strong>，因为它允许存储多达32个誓言-TOTP/誓言-HOTP条目。如果我们只关心一个誓言HOTP提供者，我们可以使用OTP接口。然而，谷歌认证和Authy都是基于TOTP。</p><h1 id="c2a4" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">设置(GNU/Linux)</h1><h2 id="c7f0" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">确保PC/SC智能卡守护程序正在运行</h2><p id="9256" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated"><a class="ae lt" href="https://linux.die.net/man/8/pcscd" rel="noopener ugc nofollow" target="_blank"> PC/SC智能密钥守护程序</a>(或pcscd)是一项旨在与智能卡交互的服务。</p><p id="d60f" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">我正在运行Arch Linux(我再也坚持不住了:P ),所以我将使用<code class="eh mx my mz na b">systemctl</code>来启动/启用pcscd服务。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nb"><img src="../Images/36d422336a11d8a25b854fb18c07d712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TawizUid8ZCgB5VC_nKGew.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">pcscd status</figcaption></figure><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nb"><img src="../Images/47a1cabe4cb5dfe17240d3d1e4d54bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sya_w4XND3plR3iVnZAcUg.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Start and enable pcscd.service</figcaption></figure><h2 id="3409" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">安装YubiKey管理器CLI工具</h2><p id="9e12" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">在Arch Linux上，你只需要运行<code class="eh mx my mz na b">sudo pacman -S yubikey-manager</code>。安装完成后，您应该能够运行<code class="eh mx my mz na b">ykman info</code>从您的密钥中检索详细信息。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/d9ac46a2b181539312ba3c0a67652751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYrkLrSTvfazkX2BLnXR2Q.png"/></div></div></figure><p id="d4bf" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">我们只对CCID接口感兴趣，所以我们可以选择用下面的命令<code class="eh mx my mz na b">ykman mode "CCID"</code>禁用OTP和FIDO，但这不是必需的。</p><h1 id="ca74" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">通过不同的提供商使用您的YubiKey 4</h1><p id="fe59" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">当你在手机中使用Google Authenticator或Authy时，你必须用你的相机扫描二维码，然而很明显，你不能用你的YubiKey做到这一点。</p><p id="095f" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">相反，你必须得到一个<a class="ae lt" href="https://en.wikipedia.org/wiki/Base32" rel="noopener ugc nofollow" target="_blank"> Base32 key </a>，并使用之前安装的<code class="eh mx my mz na b">ykman</code>工具将其传递给YubiKey。要使用此工具为服务添加2FA/MFA，您需要提供上述密钥和标识符，以帮助您以后识别您的服务/帐户。</p><pre class="lp lq lr ls fq nd na ne nf aw ng dt"><span id="af44" class="lu kj hu na b fv nh ni l nj nk">ykman oath add -t &lt;SERVICE_NAME&gt; &lt;YOUR_BASE32_KEY&gt;</span></pre><p id="4488" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated"><code class="eh mx my mz na b">-t</code>标志表示您需要触摸您的钥匙，以便稍后获得6位数字代码。建议这样做是为了防止恶意软件在没有任何用户干预的情况下生成代码。</p><p id="06ad" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">运行前面的命令后，您现在应该能够生成一个6位数的代码，再次运行<code class="eh mx my mz na b">ykman</code>。</p><pre class="lp lq lr ls fq nd na ne nf aw ng dt"><span id="219d" class="lu kj hu na b fv nh ni l nj nk">ykman oath code &lt;SERVICE_NAME&gt;</span></pre><p id="1595" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">它会要求你触摸你的YubiKey，然后在屏幕上显示代码。</p><h2 id="6431" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">开源代码库</h2><p id="923d" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">进入你的用户设置&gt;安全，点击“启用双因素认证”。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nl"><img src="../Images/e4dc04d5dc6f44d431921107cdca9682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LsiHNdl9KCSBsBS39TlNzw.png"/></div></div></figure><p id="3102" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">在下一个屏幕中，当出现提示时，您需要选择“使用应用程序设置”。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nm"><img src="../Images/2a06efdd214e22729d9767a69a8f6c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OiBkstH0ydX6aPFz3IF-yw.png"/></div></div></figure><p id="a5d2" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">在此之后，您将进入一个屏幕，在那里您可以下载一组安全代码，以防您丢失或损坏MFA设备而无法登录。据我所知，这不是每个服务都实现的，在其中一些服务中，如果你丢失了密钥…那就完了。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div class="fe ff nn"><img src="../Images/eb45db1a3fdf4eb8221e3fab9b9fad4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*Cm-UeVkP-BwGxtwL-jWxIA.png"/></div></figure><p id="21d1" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">一旦你进入带有二维码的屏幕，你需要点击“输入这个文本代码”的链接，然后一个带有Base32键的模式就会打开。您可以使用以下命令配置您的密钥:</p><pre class="lp lq lr ls fq nd na ne nf aw ng dt"><span id="8bcc" class="lu kj hu na b fv nh ni l nj nk">ykman oath add -t github.com &lt;YOUR_BASE_32_KEY&gt;</span></pre><p id="5377" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">之后，您需要运行<code class="eh mx my mz na b">ykman oath code github.com</code>来获取您的6位数代码并完成2FA设置。</p><h2 id="5513" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">AWS (IAM用户，而非root帐户)</h2><p id="7b4b" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">登录后，转到IAM &gt;用户，然后单击您的用户名。然后，您需要单击“安全凭证”选项卡。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff no"><img src="../Images/e755788e63dce5807168c32ec6b7a893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Fv-XtT_IbW-TWeyJ2hxIQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Security credentials tab</figcaption></figure><p id="390e" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">如您所见，没有分配MFA设备，因此要分配一个，只需单击“Manage”。在下一个屏幕中，选择“虚拟MFA设备”。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff np"><img src="../Images/b650df3e1f0f4951fcd9881ce40798be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmtFaAFISYRv9HVrHkQ7WA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Setting up a MFA device</figcaption></figure><p id="15fc" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">在这里，您可以选择显示二维码或显示密钥。出于我们的目的，我们只想要密钥。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff np"><img src="../Images/c4ed335211bb0fe3dd4d203baa426587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*03oAMWub9o6SKdSkv9RbAg.png"/></div></div></figure><p id="a6a2" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">然后可以运行<code class="eh mx my mz na b">ykman</code>来配置AWS MFA:</p><pre class="lp lq lr ls fq nd na ne nf aw ng dt"><span id="1648" class="lu kj hu na b fv nh ni l nj nk">ykman oath add -t aws-username &lt;YOUR_BASE_32_KEY&gt;</span></pre><p id="48d8" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">然后运行<code class="eh mx my mz na b">ykman oath code aws-username</code>两次，得到两个6位数的代码，完成设置。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nq"><img src="../Images/a8ac9784f770b40665491014b3f86a0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-Mw41U2JLTXaeywINJ5Zw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">MFA has been set up correctly</figcaption></figure><h2 id="93fb" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">GitLab</h2><p id="ac45" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">转到您的用户设置&gt;帐户并选择“启用双因素身份验证”。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nr"><img src="../Images/0d2d073dd4361f27a96af906023621f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l9Jsw_y6J5g1Z2XuTJKprg.png"/></div></div></figure><p id="a76a" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">在下一个屏幕中，你会看到二维码，以及右边的一些文字。这包含您的Base32密钥。</p><blockquote class="jg jh ji"><p id="4c41" class="jj jk jl jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hn dt translated"><strong class="jm hv">注意:</strong>在使用<code class="eh mx my mz na b">ykman</code>键之前，您需要删除空格。</p></blockquote><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ns"><img src="../Images/93e54b3d3d02266a5a43ce29dfd4cc4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_hv0o4d2RlsJAJlL6a2Gg.png"/></div></div></figure><p id="6851" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">拿到密钥后，流程和GitHub一模一样。首先，您需要在YubiKey中配置GitLab，运行以下命令。</p><pre class="lp lq lr ls fq nd na ne nf aw ng dt"><span id="a9d4" class="lu kj hu na b fv nh ni l nj nk">ykman oath add -t gitlab.com &lt;YOUR_BASE_32_KEY&gt;</span></pre><p id="0e2a" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">在此之后，只需运行<code class="eh mx my mz na b">ykman oath code gitlab.com</code>来获得您的6位数代码，并完成2FA设置。</p><h1 id="135a" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">额外的东西！</h1><h2 id="e1be" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">使用<code class="eh mx my mz na b">fzf</code>简化您的工作流程</h2><p id="b1ad" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">如果你是一个重度CLI用户，不知道<code class="eh mx my mz na b">fzf</code>，你应该停止阅读这篇文章，转到<a class="ae lt" href="https://github.com/junegunn/fzf#examples" rel="noopener ugc nofollow" target="_blank">这里</a>或者<a class="ae lt" rel="noopener" href="/@sidneyliebrand/how-fzf-and-ripgrep-improved-my-workflow-61c7ca212861">这里</a>。</p><pre class="lp lq lr ls fq nd na ne nf aw ng dt"><span id="bb06" class="lu kj hu na b fv nh ni l nj nk">ykman oath code $(ykman oath list | fzf)</span></pre><p id="db09" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">使用<code class="eh mx my mz na b">ykman oath list</code>,我们可以获得用这个键配置的不同服务的列表。该命令的工作方式是:</p><ol class=""><li id="1d41" class="mi mj hu jm b jn jo jr js li mk lk ml lm mm kh mn mo mp mq dt translated">将<code class="eh mx my mz na b">ykman oath list</code>的输出传递给<code class="eh mx my mz na b">fzf</code>。</li><li id="2444" class="mi mj hu jm b jn mr jr ms li mt lk mu lm mv kh mn mo mp mq dt translated">选择要验证的服务，然后按enter键。</li><li id="5a86" class="mi mj hu jm b jn mr jr ms li mt lk mu lm mv kh mn mo mp mq dt translated"><code class="eh mx my mz na b">ykman</code>将要求您触摸按键，并输出与之前选择的服务相关的正确的6位数字代码。</li></ol><p id="4f9a" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">你可以在这里看到这个动作<a class="ae lt" href="https://asciinema.org/a/217104" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="13ed" class="lu kj hu bd kk lv lw lx ko ly lz ma ks li mb mc kw lk md me la lm mf mg le mh dt translated">使用Yubico验证器而不是ykman来获取6位代码</h2><p id="d0a1" class="pw-post-body-paragraph jj jk hu jm b jn lg jp jq jr lh jt ju li lj jx jy lk ll kb kc lm ln kf kg kh hn dt translated">如果你不想使用<code class="eh mx my mz na b">ykman</code>来获得你的6位数代码，你也可以选择使用<a class="ae lt" href="https://www.yubico.com/products/services-software/download/yubico-authenticator/" rel="noopener ugc nofollow" target="_blank"> Yubico认证器</a>(一个基于GUI的工具)。</p><p id="44f2" class="pw-post-body-paragraph jj jk hu jm b jn jo jp jq jr js jt ju li jw jx jy lk ka kb kc lm ke kf kg kh hn dt translated">在我的例子中，我必须从Arch用户库(AUR)安装<code class="eh mx my mz na b"><a class="ae lt" href="https://aur.archlinux.org/packages/yubico-yubioath-desktop/" rel="noopener ugc nofollow" target="_blank">yubico-yubioath-desktop</a></code>。</p><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nt"><img src="../Images/56e128215ffac7e7d3e2ffd3b483a87c.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*31KVZuYGkp7sbeitCW1yag.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">OOOPS! I need to insert the key</figcaption></figure><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nt"><img src="../Images/ce8027c39c6a1fde5011fd012c42d13c.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*smNrPev9VLaNiwLohIXs4g.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">List of services using YubiKey</figcaption></figure><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div class="fe ff nu"><img src="../Images/0c1b50ffaedab57cf8b20c38cc41ae80.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*BiJLbZubkFTrUz_Wj0X2TA.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Touch your YubiKey and you will see a 6-digit code for the selected service</figcaption></figure><figure class="lp lq lr ls fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nt"><img src="../Images/e6a7347bb6a1a560b6dcdd653dae5ffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*4_77THwwhSwJ0MEc-CWprA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">DONE!</figcaption></figure></div></div>    
</body>
</html>