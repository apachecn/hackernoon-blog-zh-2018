<html>
<head>
<title>The Hitchhiker’s Guide to Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器的搭便车指南</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-hitchhikers-guide-to-serverless-ec5efb8075d6?source=collection_archive---------2-----------------------#2018-12-27">https://medium.com/hackernoon/the-hitchhikers-guide-to-serverless-ec5efb8075d6?source=collection_archive---------2-----------------------#2018-12-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="36f1" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">关于无服务器，宇宙和一切你应该知道的。</h2></div><p id="45aa" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">正如任何新的技术一样，T2的无服务器生态系统正在迅速发展。云提供商每月都会发布新的功能和服务。作为一个新用户，这可能会令人不知所措。所以在这篇文章中，我将帮助你搞清楚<a class="ae kf" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>动物园中的谁是谁——我将概述构建无服务器应用程序时你应该知道的服务，讨论你何时应该(或不应该)使用它们，并列出使用它们时的一些常见问题。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kl km l"/></div><figcaption class="kn ko fg fe ff kp kq bd b be z ek">Serverless was the top mentioned technology during AWS re:Invent 2019.</figcaption></figure><p id="8ced" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我将把重点放在AWS无服务器服务上，因为AWS是我选择的云。然而，其他云提供商的产品与我们将在这里讨论的非常相似，所以你可以使用类似于<a class="ae kf" href="https://cloud.google.com/free/docs/map-aws-google-cloud-platform" rel="noopener ugc nofollow" target="_blank"> AWS到GCP </a>或<a class="ae kf" href="https://docs.microsoft.com/en-us/azure/architecture/aws-professional/services" rel="noopener ugc nofollow" target="_blank"> AWS到Azure </a>的列表，这些列表就像是云提供商的罗塞塔石碑，帮助你开始选择云供应商。</p><p id="a8a4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我们开始之前，还有一件事:无服务器是有优势的，但是整个生态系统在开始时可能会很难接受。因此，我能给你的关于开始使用无服务器的最好建议，也是在银河系旅行的一个很好的建议，是<strong class="jl hv">不要惊慌</strong>。一开始似乎很难掌握所有的东西，但是学习曲线非常陡峭，结果是值得的。所以，废话少说，让我们开始我们的无服务器之旅。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff kr"><img src="../Images/964978648716be679520f930833a4ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fT1BREdVMrE4DFZmRfLX_w.jpeg"/></div></div><figcaption class="kn ko fg fe ff kp kq bd b be z ek">DON’T PANIC. It’s easier then it looks.</figcaption></figure><h1 id="767b" class="ky kz hu bd la lb lc ld le lf lg lh li ja lj jb lk jd ll je lm jg ln jh lo lp dt translated">无服务器的宇宙</h1><h2 id="24e9" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">希腊字母的第11个</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/c30705b5ef7f16f78deff694134bb031.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*OZUCv6AgdA4TqPvkQikgeg.png"/></div></figure><p id="67ba" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于开始我们的无服务器之旅来说，Lambda 是显而易见的选择。它是一种Faas(功能即服务)产品，这是一种由云供应商提供的事件驱动的计算服务，允许您在不管理任何服务器的情况下执行代码。您压缩您的代码并将其发送给云提供商。然后配置代码应该执行的事件(比如HTTP请求、放入队列的消息等。)云提供商负责剩下的工作。</p><p id="40bf" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Lambda(和Faas)是大多数无服务器系统不可或缺的一部分。它可以自动扩展，并且是按使用付费的(就像大多数无服务器服务一样)。我建议在大多数情况下选择Lambda，尽管还有一些其他无服务器计算服务针对更具体的用例，我们将在后面介绍。</p><p id="fab5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是，在使用Lambda时，您应该注意一些新的问题:</p><ol class=""><li id="1b16" class="mf mg hu jl b jm jn jp jq js mh jw mi ka mj ke mk ml mm mn dt translated">Lambda有一个时间、内存和并发限制——确保你没有达到它，否则AWS将节流你的功能！同样，如果构建一个面向用户的API，或者一个延迟很大的API，你应该注意<a class="ae kf" href="https://blog.octo.com/en/cold-start-warm-start-with-aws-lambda/" rel="noopener ugc nofollow" target="_blank">冷启动</a>。</li><li id="7e7d" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">避免独石——无服务器生态系统与<a class="ae kf" href="https://microservices.io/" rel="noopener ugc nofollow" target="_blank">微服务架构</a>完美契合。不要把一个完整的web应用打包到一个Lambda中。你的每一个函数都应该做一件事情。</li><li id="2dca" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">当使用Lambda时，确保你的函数<strong class="jl hv">转换</strong>数据，而不是<strong class="jl hv">传输</strong>数据。有更好的AWS服务可以使用。</li></ol><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kl km l"/></div></figure><p id="0ad2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Lambda是大多数大型无服务器应用的基石，因此有更多的陷阱，并且需要时间来适应这种无服务器思维。但这应该能让你步入正轨。</p><h2 id="6d56" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">SQS</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/12bf2a061359bd048fde64e4a94acaec.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Jv0TpSJaIy45EitmUkd6DA.png"/></div></figure><p id="0219" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">SQS(简单队列服务)是一个完全无服务器的队列服务。您可以通过点击一个按钮来创建一个队列，并开始通过它发送消息。队列是分布式系统中的常见组件。它们用于解耦我们系统的不同部分，因此每个部分都可以独立运行。SQS提供了两种类型的队列:保证消息顺序的FIFO队列和不保证顺序的标准队列，但是队列的吞吐量几乎是无限的。</p><p id="64d1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在无服务器系统中使用SQS队列作为组件时，有几点需要注意:</p><ol class=""><li id="62d9" class="mf mg hu jl b jm jn jp jq js mh jw mi ka mj ke mk ml mm mn dt translated">一个SQS队列只能有一个客户端。这意味着，如果你想让信息到达多个目的地，你应该使用另一种服务(如SNS或Kinesis)。从架构上讲，<strong class="jl hv">拥有队列的微服务应该是接收端</strong> —每个人都可以给队列发消息，但是只有一个服务会对消息做出反应。</li><li id="72af" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">当使用SQS队列作为<a class="ae kf" href="#24e9" rel="noopener ugc nofollow">λ</a>函数的触发器时，只能使用标准(非FIFO)队列。这是有意义的，因为您希望允许Lambdas为不同的队列消息并发执行。如果你确实需要按顺序处理，看看Kinesis吧。</li></ol><h2 id="d363" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">社交网站（Social Network Site的缩写）</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/cb22c7c8d3a30818f8087d9614233bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Utk_jlV5eFWd_wgZ8R7J-Q.png"/></div></figure><p id="0812" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae kf" href="https://aws.amazon.com/sns/" rel="noopener ugc nofollow" target="_blank"> SNS </a>(简单通知服务)是一种托管的发布/订阅服务。一个SNS“实体”叫做话题。每个主题可以有几个订阅者(HTTP端点、Lambda函数或SQS队列)。</p><p id="dafe" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">SNS的一个典型用例是服务向系统的其余部分广播事件。假设我有几个微服务需要对一个新用户的注册做出反应。每当用户注册时，我可以让我的注册服务发布一条消息，并将所有其他组件作为该主题的订阅者(通过Lambda触发器、SQS消息或HTTP挂钩)。经典酒吧/酒馆。</p><p id="62ac" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">使用社交网络时，请记住以下几点:</p><ol class=""><li id="c747" class="mf mg hu jl b jm jn jp jq js mh jw mi ka mj ke mk ml mm mn dt translated">使用SNS有两种架构设置:一对多和多对多。要么<strong class="jl hv">发送端拥有主题</strong>，要么是自己的一个没有所有者的服务。如果你的SNS只有一个客户(并且一直会有，不仅仅是因为你还没有开发系统的那个部分)并且归他所有——也许SNS不是这个用例的正确选择。考虑使用<a class="ae kf" href="#6d56" rel="noopener ugc nofollow"> SQS </a>队列/变身。</li><li id="0fe6" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated"><a class="ae kf" href="https://hackernoon.com/applying-the-pub-sub-and-push-pull-messaging-patterns-with-aws-lambda-73d5ee346faa#bf71" rel="noopener ugc nofollow" target="_blank">与其他消息服务相比，社交网络在规模上可能变得相当昂贵</a>。在某些情况下，可以考虑使用<a class="ae kf" href="#37e3" rel="noopener ugc nofollow"> Kinesis </a>来代替。</li></ol><h2 id="37e3" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">由外界刺激引起的不随意运动</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/95fbbc2e08fd12e1c9cc2eb2e2b5af46.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*sDIAOKEpPxDNaEKN7grkMg.png"/></div></figure><p id="85fd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae kf" href="https://aws.amazon.com/kinesis/" rel="noopener ugc nofollow" target="_blank"> Kinesis </a>是一个完全管理的流。它允许以非常高的规模有序地处理数据记录。为了支持并行数据处理，每个流都由几个“碎片”组成，并且只有碎片被按顺序处理。在将消息插入Kinesis时，您可以通过使用相同的标识符来保证同一个碎片将处理两个不同的消息。</p><p id="6ecf" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Kinesis是一个服务系列，包括标准的Kinesis、<a class="ae kf" href="https://aws.amazon.com/kinesis/video-streams/" rel="noopener ugc nofollow" target="_blank"> Kinesis视频流</a>和<a class="ae kf" href="https://aws.amazon.com/kinesis/data-firehose/" rel="noopener ugc nofollow" target="_blank"> Kinesis Firehose </a>，后者是一个用于数据聚合的服务。</p><p id="19a5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以使用KCL (Kinesis客户端库)从Kinesis读取数据，或者用它触发一个Lambda。以下是一些关于将Kinesis集成到无服务器系统的注意事项:</p><ol class=""><li id="fa38" class="mf mg hu jl b jm jn jp jq js mh jw mi ka mj ke mk ml mm mn dt translated">一个Kinesis流可以支持多个消费者，并将数据复制给他们所有人(<a class="ae kf" href="https://docs.aws.amazon.com/streams/latest/dev/introduction-to-enhanced-consumers.html" rel="noopener ugc nofollow" target="_blank">互不影响</a>)。有用！</li><li id="62a4" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">一个Kinesis流可以有许多不同的用例(从架构上来说)。因为它的目的是作为一个流，所以有时把它作为一个服务的输入，有时作为一个输出，有时作为一个完全独立的服务是有意义的。</li><li id="6149" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">Kinesis是为规模而生的，它的定价很好。不要害怕在系统最繁忙的部分使用它。</li><li id="70a3" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">Kinesis还不支持自动缩放。这意味着您必须提前提供碎片数量。有一些解决这个问题的方法，但是在使用kinesis的时候需要考虑。</li></ol><h2 id="e684" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">阶跃函数</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/83a6f51c96e3ccb088b505484a03d7f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*UhGRFCyN4c9GI82nIxmpzA.png"/></div></figure><p id="6480" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">由于Lambda函数是无状态的，管理状态有时会很困难。但是不要害怕，因为<a class="ae kf" href="https://aws.amazon.com/step-functions/" rel="noopener ugc nofollow" target="_blank">步功能</a>是来救援的！Step Functions是一个AWS服务，它允许您以代码的形式管理状态。它是一种编排服务，允许您将工作流建模为状态机。你可以在这个由<a class="ae kf" href="https://twitter.com/theburningmonk?lang=en" rel="noopener ugc nofollow" target="_blank">崔琰</a>(我剽窃了他的名字)写的<a class="ae kf" href="https://epsagon.com/blog/hitchhikers-guide-to-aws-step-functions/" rel="noopener ugc nofollow" target="_blank">精彩帖子</a>中找到更多细节。</p><p id="a9b3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">请注意<a class="ae kf" href="https://aws.amazon.com/about-aws/whats-new/2018/11/aws-step-functions-adds-eight-more-service-integrations/" rel="noopener ugc nofollow" target="_blank"> AWS在re:Invent 2018 </a>上宣布支持Step函数的更多服务集成，如与DynamoDB、Fargate、SNS和SQS的集成，所以你可以使用Step函数来编排很多东西，而不仅仅是Lambda。这项服务有点昂贵，所以在一些用例中，它可能有点过头了，但对于大多数情况来说，它是一个非常棒的工具。</p><h2 id="4775" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">S3</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/5ced4f553d94e192aa150eda40dc6c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*805UgjiLxpscwhUc-Ed7pw.png"/></div></figure><p id="686b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae kf" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> S3 </a>(简单存储服务)可能是世界上最流行的对象存储服务。虽然它有许多可能的使用案例(例如备份、静态网站)，但无服务器系统显示了它的全部潜力。</p><p id="22b8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">构建无服务器微服务时，通常需要一些数据库。在某些情况下，S3将是一个很好的选择——它易于使用，高度可用，耐用，而且非常便宜。它与Lambda集成在一起，您可以将它配置为它的一个事件源。此外，当与其他无服务器服务(如Athena或Glue)结合使用时，尽管它很简单，但还是非常强大。</p><p id="a17d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然而，当选择S3作为您的服务的数据库时，首先要确保它是一个合适的数据库:S3是一个对象存储库。它没有像锁定机制和事务这样的数据库特性，这对于一些需要并行访问数据库的服务来说是一个问题(Lambda的常见模式)，所以要确保情况不是这样(现在或在可预见的将来)。如果你没有并行写/它们不会中断你的服务，恭喜你，S3可能是一个很好的选择。</p><h2 id="cd8f" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">DynamoDB</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/5c338739db4abd1258bc7f97d2756743.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Fsaf-tuyppWX-8o3vJpPfg.png"/></div></figure><p id="d374" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae kf" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> DynamoDB </a>是一个无服务器的键值文档数据库。它是在AWS上构建无服务器应用程序的流行数据库。当我说DynamoDB是无服务器的时，它需要几个特性:</p><ol class=""><li id="5550" class="mf mg hu jl b jm jn jp jq js mh jw mi ka mj ke mk ml mm mn dt translated">开始时，您只需创建一个表，无需配置服务器。</li><li id="2533" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">DynamoDB的API在HTTP端点之上——使用它时不需要担心数据库连接，这在使用Lambda时非常好，因为它可以有数千个并行执行。</li><li id="1f60" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">自从<a class="ae kf" href="https://aws.amazon.com/about-aws/whats-new/2018/11/announcing-amazon-dynamodb-on-demand/" rel="noopener ugc nofollow" target="_blank"> AWS最新公告</a>以来，你可以在按使用付费模式下使用DynamoDB(你仍然可以使用保留容量，有时会便宜一点)</li></ol><p id="a944" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">DynamoDB是一个非常灵活的数据库，最适合单一用途的服务。如果你用DynamoDB构建一个整体，并把它作为一个通用的数据库，那你的日子就不好过了。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff mt"><img src="../Images/645c1e028cacc80e7f50fdca7ef49cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bBKXljdGQK_L72w4o45p8w.jpeg"/></div></div></figure><p id="f4c1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我这样说并不是因为这是不可能的，或者因为这将比其他数据库更难(可能会，但这不是重点)。这是因为当您尽可能保持数据简单时，DynamoDB是最容易使用的。为许多不同的目的添加许多索引(对于每个目的，您可能需要一小部分数据)是一种反模式。附加索引在某些情况下是有效的，但是要明智地使用它们。</p><p id="6fc1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">DynamoDB最近宣布<a class="ae kf" href="https://aws.amazon.com/blogs/aws/new-amazon-dynamodb-transactions/" rel="noopener ugc nofollow" target="_blank">事务支持</a>，这是使其成为终极无服务器数据库所缺少的最后一块。然而，有些情况下DynamoDB并不是最合适的:当您必须对数据执行复杂的搜索时，或者当您持有原始分析或时间序列数据时，您可能会发现DynamoDB很难使用。对于这些情况，使用<a class="ae kf" href="#d0d4" rel="noopener ugc nofollow">其他无服务器数据库之一。</a></p><h2 id="d0d4" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">其他无服务器数据库</h2><p id="b820" class="pw-post-body-paragraph jj jk hu jl b jm mu iv jo jp mv iy jr js mw ju jv jw mx jy jz ka my kc kd ke hn dt translated">AWS最近宣布了除DynamoDB之外的几个无服务器数据库。有些仍处于预览阶段，但将于今年发布。我不会单独阐述它们中的每一个(因为DynamoDB非常适合大多数用例，至少是基本用例)，但这并不意味着你不应该使用它们。恰恰相反——您应该充分了解它们，并使用最适合您的用例的一个！永远要为正确的工作准备正确的工具。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kl km l"/></div><figcaption class="kn ko fg fe ff kp kq bd b be z ek">Serverless databases on AWS. choose from key-value (DynamoDB), graph (Neptune), time-series (Timestream) or ledger (QLDB)</figcaption></figure><h2 id="fbfd" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">API网关</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/6e9abf09dea28b550c6c30f2a45930f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Vax89_LpfbRW2fM3iy-Ayg.png"/></div></figure><p id="5a40" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae kf" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> API网关</a>是应用程序的网关。它让你可以轻松地管理你的API，并集成了许多计算服务来处理请求(Lambda就是其中之一！).它是基于REST的(意味着您可以使用不同的HTTP动词)，并且有一些特性可以让您更好地控制API，比如对API设置限制或对API使用不同的授权者，从而将身份验证逻辑与主要业务逻辑分离开来。</p><p id="3acb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">虽然这是一个方便的服务，但请注意，它给你的请求增加了一些延迟(例如，与通过SDK直接调用Lambda相比)，而且它不是很便宜(也不太贵，但在中间)。API Gateway是REST面向用户的API的绝佳选择。对于内部API同步调用(微服务之间)，这取决于用例。在这种情况下，不要只是将API Gateway作为默认设置——比如，检查一下直接调用另一个服务Lambda有什么好处。有时候会有一些；有时候不会。</p><h2 id="2d6f" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">AppSync</h2><p id="2830" class="pw-post-body-paragraph jj jk hu jl b jm mu iv jo jp mv iy jr js mw ju jv jw mx jy jz ka my kc kd ke hn dt translated">这一个令人兴奋。我们已经提到，你应该使用Lambda来转换，而不是传输。但是(假设您正在构建一个面向用户的应用程序)您应该如何向用户发送数据呢？这不正是Lambda + API Gateway所做的吗？简而言之就是可以，但是你可以做得更好。</p><p id="0723" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae kf" href="https://aws.amazon.com/appsync/" rel="noopener ugc nofollow" target="_blank"> AppSync </a>是一个面向移动/网络/任何API消费应用的无服务器后端。与API Gateway不同，它为您的服务使用一个<a class="ae kf" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank"> GraphQL API </a>。要使用AppSync，您必须定义您的数据模式。然后，您必须设置您的数据源，AppSync从该数据源读取数据。默认的数据源是DynamoDB，但是还有许多其他选项(例如，您甚至可以在后台将它与API Gateway一起使用，用于遗留API)。如果您需要在将数据发送给用户之前转换数据，您总是可以对请求使用Lambda解析器，并让它处理数据。然后让AppSync处理剩下的事情。</p><p id="5184" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">编写使用API Gateway + Lambda来服务用户请求的API可能是一项重要的工作，你可以把它花在其他地方。为此，我强烈推荐使用AppSync。然而——它确实需要一些GraphQL的基础知识。如果您正处于无服务器过渡的开始阶段，有些人可能会希望一步一步来，而不是一次将所有这些新技术都引入到您的堆栈中。</p><h2 id="0ade" class="lq kz hu bd la lr ls lt le lu lv lw li js lx ly lk jw lz ma lm ka mb mc lo md dt translated">雅典娜(&amp;胶水)</h2><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff me"><img src="../Images/c53d171af9405368c00d53a2b35c3634.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*00L-iykyaXr5jn31V6OmBw.png"/></div></figure><p id="851e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">爱情分析？这是给你的。Athena是一个基于T2的无服务器工具，它可以让你使用标准的SQL查询快速而便宜地分析存储在S3的大量数据。数据可以以多种格式存储，包括CSV、JSON或Parquet。另一个值得一提的是，Athena集成了<a class="ae kf" href="https://aws.amazon.com/glue/" rel="noopener ugc nofollow" target="_blank"> Glue </a>，这是一个无服务器的ETL服务，它本身就很酷。您可以对Glue数据目录中的数据源使用Athena查询。</p><p id="f595" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">使用Athena时要记住的一点是，您不仅要为Athena付费(根据读取的万亿字节来定价)，还要为Athena进行的S3调用付费。需要注意的一些事项包括:</p><ol class=""><li id="9306" class="mf mg hu jl b jm jn jp jq js mh jw mi ka mj ke mk ml mm mn dt translated">在你的S3数据湖上使用分区。当执行Athena查询时，可以在SQL语句的WHERE子句中指定要搜索的分区。这样，您将只扫描您需要的数据。</li><li id="1ed0" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">请注意，在使用Athena时，您也要为S3 API调用付费。如果您的数据湖由许多小的S3文件组成，这可能会变得非常昂贵，并且还会影响性能。</li><li id="db07" class="mf mg hu jl b jm mo jp mp js mq jw mr ka ms ke mk ml mm mn dt translated">如果你需要一些比SQL查询更重的数据，你可以使用<a class="ae kf" href="https://docs.aws.amazon.com/glue/latest/dg/console-custom-created.html" rel="noopener ugc nofollow" target="_blank"> Glue的定制脚本</a>来运行一个无服务器的spark作业！相当酷。</li></ol><p id="2c96" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">曼吉特·查耶尔和梅尔特·霍查宁提供了更多与雅典娜合作的技巧</p><h1 id="571b" class="ky kz hu bd la lb lc ld le lf lg lh li ja lj jb lk jd ll je lm jg ln jh lo lp dt translated">好了，现在怎么办？</h1><p id="532b" class="pw-post-body-paragraph jj jk hu jl b jm mu iv jo jp mv iy jr js mw ju jv jw mx jy jz ka my kc kd ke hn dt translated">这只是冰山一角。在写这篇文章的时候，我不得不删掉很多东西，现在仍然很拥挤。像AWS Batch、CloudFront、Route 53这样的服务，以及不同的物联网和机器学习服务只是我遗漏的几个其他服务。每当您觉得需要在应用程序中实现某些东西时，您应该检查是否已经存在这样的服务。但是您至少熟悉在您的无服务器之旅中将使用的最基本和最常见的服务。</p><p id="08d2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">此外，这些只是基本的构建模块——现在该由您开始使用它们了。你应该注意的一点是，无服务器应用程序的<a class="ae kf" href="https://hackernoon.com/tagged/architecture" rel="noopener ugc nofollow" target="_blank">架构</a>是非常不同的，学会正确使用它需要一段时间。这里有一个<a class="ae kf" href="https://hackernoon.com/yubls-road-to-serverless-part-1-overview-ca348370acde" rel="noopener ugc nofollow" target="_blank">无服务器转换的例子</a>(还是崔琰写的)和一篇<a class="ae kf" href="https://www.jeremydaly.com/serverless-microservice-patterns-for-aws/" rel="noopener ugc nofollow" target="_blank">关于无服务器设计模式的好文章</a>(作者<a class="ae kf" href="https://twitter.com/jeremy_daly?lang=en" rel="noopener ugc nofollow" target="_blank">杰瑞米·戴利</a>让你对无服务器应用程序有个大概的了解。你也可以使用AWS新的<a class="ae kf" href="https://aws.amazon.com/well-architected-tool/" rel="noopener ugc nofollow" target="_blank">架构良好的工具</a>来帮助你。</p><p id="2030" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">像任何新技术一样，走向无服务器需要时间和精力。但好消息是你并不孤单！无服务器社区是一个不断增长的社区，并且真正具有包容性。加入slack上的<a class="ae kf" href="https://join.slack.com/t/serverless-forum/shared_invite/enQtMzc5NjI5MDY5NzE5LTM3MjY3YzljZDE0MDdiOGIyZjg0MDI2ZDM5NDYyODA0MWQ2Y2M0MWZkMjdjZDJhZWUwNjFkZmE4MGRlNjg0YzI" rel="noopener ugc nofollow" target="_blank">无服务器论坛</a>或访问<a class="ae kf" href="https://serverlessdays.io/" rel="noopener ugc nofollow" target="_blank">无服务器日</a>，你肯定会找到帮助你迈出第一步的人。</p><p id="b73f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">再见，感谢所有的功能！</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="mz km l"/></div></figure></div></div>    
</body>
</html>