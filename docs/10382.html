<html>
<head>
<title>AWK for the win</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWK赢了</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/awk-for-the-win-b09750ca9ce1?source=collection_archive---------15-----------------------#2018-12-27">https://medium.com/hackernoon/awk-for-the-win-b09750ca9ce1?source=collection_archive---------15-----------------------#2018-12-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/93c19477fca5f8d422616c17cd51af27.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*zz2ZQzr8ggPUI_TsBuFsQA.gif"/></div></figure><p id="b046" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">几个月前，我接到任务，要对Creditas的一些数据进行大规模更新。作为一个“ruby主义者”，我想:“好吧，我将简单地构建一个ruby脚本来读取运营部门给我的CSV文件，并执行更新”。简单的任务，对吧？</p><p id="7165" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">是的，但是如果你仔细想想，用那种方法我不得不浪费时间写脚本，在本地或者在试运行环境中测试(脚本也有错误！)并最终设置生产中的一切来运行脚本。这很简单，但要做到这一切需要时间。</p><p id="4871" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在谁来拯救我们？</p></div><div class="ab cl jw jx hc jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hn ho hp hq hr"><h1 id="3315" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">AWK</h1><p id="c831" class="pw-post-body-paragraph iy iz hu ja b jb lb jd je jf lc jh ji jj ld jl jm jn le jp jq jr lf jt ju jv hn dt translated"><a class="ae lg" href="https://hackernoon.com/tagged/awk" rel="noopener ugc nofollow" target="_blank"> AWK </a>是一种<a class="ae lg" href="https://hackernoon.com/tagged/programming" rel="noopener ugc nofollow" target="_blank">编程</a>语言，创建于1977年。该语言是逐行解释的，其目的是使shell脚本更加强大。它基于C语言，通常用于<strong class="ja hv">处理文本</strong>和<strong class="ja hv">操作文件。</strong>在这里你可以找到awk的创作者们写的书:<a class="ae lg" href="https://www.amazon.com/AWK-Programming-Language-Alfred-Aho/dp/020107981X" rel="noopener ugc nofollow" target="_blank">https://www . Amazon . com/AWK-编程-语言-Alfred-Aho/dp/020107981X </a></p><p id="68a2" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">所以AWK给了你一些工具，可以让你快速处理文本和文件。让我们看一些例子:</p><p id="c1db" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">假设您有一个包含以下内容的<strong class="ja hv"> test.txt </strong>文件:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="701d" class="lq ke hu lm b fv lr ls l lt lu">test1 test2 test3</span></pre><p id="4314" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果您在控制台中键入以下命令:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="1c43" class="lq ke hu lm b fv lr ls l lt lu">awk ‘{print $0}’ test.txt</span></pre><p id="f880" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">您将看到整个文件的结果:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="83f4" class="lq ke hu lm b fv lr ls l lt lu">test1 test2 test3</span></pre><p id="7516" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们可以看到，AWK给了我们一些变量，0美元在控制台中打印文件的全部内容。现在，如果在最后一个命令中使用$1变量，将会得到以下结果:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="2c8f" class="lq ke hu lm b fv lr ls l lt lu">test1</span></pre><p id="7a39" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">变量$2和$3也是如此，分别打印“test2”和“test3”。</p></div><div class="ab cl jw jx hc jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hn ho hp hq hr"><p id="361a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">好的，但是AWK如何帮助我之前描述的场景呢？我将举例说明一个类似于我不得不处理的例子。假设您需要更新所有客户端的名称，您会收到一个csv文件，如下所示:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="7e0f" class="lq ke hu lm b fv lr ls l lt lu">id,new_name<br/>1,new_name_1<br/>2,new_name_2<br/>...</span></pre><p id="639c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">您可以处理<strong class="ja hv"> test.csv </strong>文件，并使用如下命令生成所有更新语句:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="672a" class="lq ke hu lm b fv lr ls l lt lu">awk -F "," '{print "UPDATE client SET name='\''"$2"'\'' WHERE id='\''"$1"'\''"}' test.csv</span></pre><p id="b21c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">结果将会是:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="84c6" class="lq ke hu lm b fv lr ls l lt lu">UPDATE client SET name='new_name_1' WHERE id='1'<br/>UPDATE client SET name='new_name_2' WHERE id='2'<br/>...</span></pre><p id="5061" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意，我们需要用<strong class="ja hv"> -F </strong>标志指定逗号分隔符。而且我们还需要转义<strong class="ja hv">’</strong>字符。除了这两点，这个命令并不复杂。</p><p id="932a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在有了所有的update语句，您可以直接连接到您的数据库并一次执行所有的语句。不需要连接到您的生产机器来执行任何脚本，也不需要为了保证bug安全性而在试运行环境中进行测试。</p><p id="0801" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">AWK语言中还有很多其他的特性，比如for循环和if语句。我认为AWK是一种未知的语言，特别是对于那些开始职业生涯的人来说，一旦你习惯了它，你的工作效率会提高很多。你可以点击这个链接查看更多例子:<a class="ae lg" href="https://likegeeks.com/awk-command/" rel="noopener ugc nofollow" target="_blank">https://likegeeks.com/awk-command/</a></p></div><div class="ab cl jw jx hc jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hn ho hp hq hr"><p id="0bd7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">大家到此为止，感谢阅读！</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="lv lw l"/></div></figure></div></div>    
</body>
</html>