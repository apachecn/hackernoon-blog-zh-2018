# 将安全性应用于十二因素应用程序

> 原文：<https://medium.com/hackernoon/applying-security-to-the-twelve-factor-app-753ce9a30379>

毫无疑问，数据是未来的燃料，数据的膨胀导致了云服务的快速采用。作为云计算服务的主要类别之一，

软件即服务( [SaaS](https://hackernoon.com/tagged/saas) )在很大程度上已经成为组织的“新常态”，不再需要在自己的计算机或数据中心安装和运行应用程序。

虽然这为公司和他们的客户提供了无数的好处，但是从构建和部署的角度来看，开发人员发现他们自己在快速创建 SaaS 应用程序方面承受着越来越大的压力。[十二要素应用](https://12factor.net/)的推出是为了帮助开发者快速高效地构建基于网络的应用。这种方法简单而强大，提倡创建在现代既可扩展又可维护的应用程序。

虽然指南促进了可伸缩性、弹性、连续交付和可维护性，但是软件继续以更快的速度被编写和部署的事实提出了另一个重要的问题。有可能安全地构建一个十二因素的应用程序吗？有没有被遗忘的第 13 个因素？

怀特哈特[安全](https://hackernoon.com/tagged/security)首席科学家埃里克·谢里丹和他的团队认为，安全应该嵌入现有的 12 个因素中，而不是第 13 步。因此，他们专门为开发人员和架构师创建了一个针对十二要素应用程序的*安全附录* *，该附录提供了可操作的指导，说明如何在十二要素中的每一个要素上显著提高安全状态。*

本文研究了每个因素，并解释了如何在每个因素中实现安全性。

十二要素应用程序中的第一个要素侧重于代码库，并建议将所有代码放入一个可以在版本控制系统(如 GitHub 或 Subversion)中跟踪的存储库或源代码控制系统中，并利用多个部署环境(考虑登台、开发、生产等)。)

虽然这是理想状态，但重要的是要记住代码的安全性取决于用来构建它的系统。作为代码及其所在系统的守护者，开发人员可以采取什么步骤来确保存储库的安全呢？

● ***锁定下来。*** 如今源代码是大多数企业的核心，因此保护它势在必行。做到这一点的最佳方式是通过限制只有经过身份验证的用户才能访问源代码库来施加限制。此外，将提交限制为拉请求，而不是直接提交。通过这种方式，负责主代码的团队审查拉请求，然后决定是否将新代码与现有基础代码合并。

● ***不再有秘密。编写代码时，就像你所做的一切都是开源的一样。“公开行动”实际上可能是最好的保护。这意味着在编写应用程序代码时，假设它可能会被公开，所以理想情况下，目标应该是在实际应用程序中没有秘密。将秘密具体化，并通过启动参数使它们的位置为人所知。这意味着将秘密放在人们可以找到的配置文件中。使用环境来保护配置。***

● ***定期复习代码。*** 通过审查所有拉取请求，实施安全编码准则。同样重要的是教育团队如何解决未通过代码审查的请求。通过共享反馈和经验的协作将大大有助于提高意识和支持快速、正确和安全地进行的应用程序编码。

十二因素应用程序方法的第二个因素要求显式声明和隔离依赖关系。所有运行代码的环境都需要有一些依赖关系，比如数据库或图像库。大多数现代应用程序仅由 10%的构建代码和高达 90%的借用代码组成。因为开源在任何地方都被使用，所以它可以从任何地方输入代码是合乎逻辑的，而且通常应用程序的安全漏洞也随之而来。

根据美国国防和安全部的数据，在美国所有记录在案的安全威胁中，90%是由针对软件缺陷的攻击造成的，而不是网络漏洞。因此，为了确保应用程序的安全性，了解您的代码中有哪些第三方组件非常重要。他们是否受到已知安全漏洞的影响？它们是否是最新的，是否符合许可证政策？

使用软件组合分析可以很容易地知道哪些应用程序正在直接或间接地使用一个特定的库。

● ***知道你的作文*** 。软件组合分析将使您能够识别已经集成到您的应用程序中的第三方和开源组件。它会通知您各种因素，例如每个组件的许可，以及需要升级或修补的库。本质上，漏洞数据是从许多不同的来源收集的，软件组合分析可以识别哪些已经过验证。

● ***知道自己的风险。软件组合分析提供了关于许可风险的信息，因此可以帮助组织减少这些可能隐藏在开源协议中的风险。这扩展到识别和补救那些可能引入安全和/或法律风险的依赖关系。***

● ***定期复习依赖关系。*** 既然您已经知道了这些依赖项使用的许可证，那么识别和删除那些与业务策略相冲突的许可证就很容易了。自动化组合和负债的提取，并通过集成到构建管道中来实施风险接受策略。

十二因素应用程序的第三个因素建议在环境中存储配置。根据 12-factor.net 的说法，一个应用的*配置*是在[部署](https://12factor.net/codebase)之间可能发生变化的一切(登台、生产、开发者环境等)。这包括数据库的资源句柄、外部服务(如 Amazon S3 或 Twitter)的凭证，以及每个部署的值，如部署的规范主机名。

它继续解释说，应用程序有时会将配置作为常量存储在代码中。这违反了要求将配置与代码严格分离的十二要素。配置在不同的部署中有很大的不同，代码则没有。

十二因素鼓励信息的外部化，但是安全“陷阱”可能在于环境本身的安全性。例如，如果一个属性文件被标记为“全球可读”，任何有权访问该系统的人都可以开始读取生产属性，其中可能包括后端服务的机密凭据、密钥和令牌。

因此，在外部化时，审计环境非常重要。确定并对环境应用强化准则，并利用机会利用第三方安全团队来评估环境。

十二因素方法中的第四个因素建议将后勤服务视为附属资源。它将后台服务定义为应用程序之外的任何东西，可以被视为一种资源。例如，它有助于鼓励封装开发和更小的程序，但是从安全的角度来看，后台服务也可能无意中封装漏洞。请记住:

● ***你承担他们的风险。*** 了解后台服务的安全态势，并编写代码，就好像它正在被攻击，或者正在攻击您。

● ***保护您的通信安全。*** 使用传输层安全性建立所有连接，使用最低特权帐户验证后台服务。

● ***资源安全抽象。*** 将安全检查封装在资源抽象中，并限制资源抽象的用户对安全感知的需求。

第五个因素建议将构建和运行阶段严格分开。这一因素更多地与过程相关，强调识别和分离应用程序开发的每个阶段，并鼓励每个阶段之间的自动化，以加速过程。从安全角度来看，在构建、发布和运行阶段，请记住以下关键活动:

●***Build—enf*force 安全策略。**构建阶段负责自动执行安全策略，并破坏不符合所述策略的构建。

● ***释放* — *安全通过/不通过。*** 发布阶段应提供应用程序风险的综合视图，从而允许对发布做出“通过/不通过”的决定。

● ***运行—生产保护。*** 运行阶段应提供降低被利用漏洞(无论已知还是未知)的业务影响的能力。

在第六个因素中，十二因素方法鼓励通过使用在网络上通信的小程序，将应用作为一个或多个无状态进程来执行。许多组织正在进行“平台再造”之旅，在这一过程中，总体平台被分解为更面向服务的小程序，从而能够更快地做出改变。

不幸的是，这一旅程的一个主要安全缺陷是，当您开始将一个大的构建块分解成更小的块时，攻击面会增加。这意味着有更多的地方可以向您的基础设施发送请求，这就意味着有更多的机会发起攻击。因此，请始终假设所有流程输入都由黑客控制，并创建一个或多个专门用于安全服务的流程。

第七个因素侧重于通过端口绑定导出服务，实际上是第六个因素的扩展。它鼓励在运行的应用程序中集成网络处理流量代码。例如，PHP 应用程序可能作为一个模块在 Apache HTTPD 内部运行，或者 Java 应用程序可能在 Tomcat 内部运行。

挑战在于，这些模块仍然必须进行配置，如果应用程序绑定到特权端口或使用糟糕的密码保护，这可能会导致安全风险。要提高安全性，请避免绑定到特权端口，而是使用端口转发到非特权端口。完成后，立即丢弃绑定到特权端口的特权。

因素八或并发性建议通过流程模型向外扩展。对这个因素的一个简单解释是想象许多处理特定需求的小进程，比如 web 请求、API 调用或发送 tweets。保持所有这些独立工作意味着应用程序将更好地伸缩，并且您将能够同时管理更多的活动。

这方面的安全挑战是，扩展能力要求我们关注已知会引入拒绝服务问题的 API。一种这样的 API 被称为“readLine”。这种方法的实现几乎可以在每一个软件开发平台上使用，但是会受到拒绝服务的攻击。“readLine”将从给定的输入流中连续读取字节，直到找到一个换行符。假设攻击者控制了那个流…如果攻击者从不提供换行符呢？会发生什么？通常情况下，这将导致内存耗尽引起的错误和稳定性问题。

● ***禁止可做 API。*** 为您的平台记录相关的可用 API(例如 Readline)并禁止它们。

● ***资源关闭。*** 暴露简单化的模式以便于关闭 I/O 资源(例如。范围)。

在第九个因素，一次性，该方法建议最大限度地提高快速启动和优雅关闭的鲁棒性。这一因素侧重于让代码和应用程序部署快速脱离起始模块并立即发挥作用。同样，您的应用程序也需要强大的抗崩溃能力，如果崩溃了，它需要能够干净地重启。

关于可处置性，要记住的一个重要事项是应用签名和过期来限制派生安全断言的生命周期。例如，如果编写的代码没有过期，并且它通过网络被截获，那么令牌很容易被重用，这是您不希望发生的。

第十个因素，开发/产品对等建议尽可能保持开发、试运行和生产的相似性。十二因素应用程序非常强调在产品开发生命周期的各个阶段保持服务的一致性。然而，当你在 12 个因素中努力实现开发/生产对等时，不要分享产品秘密，因为优步发现了一个艰难的方法，当它[在一个公共 GitHub 页面上存储了一个敏感的数据库密钥](https://arstechnica.com/information-technology/2015/03/in-major-goof-uber-stored-sensitive-database-key-on-public-github-page/)。

● ***执行职责分离。*** 这意味着DEV 看不到 QA 中的任何秘密，QA 看不到 STAGE 中的任何秘密，STAGE 看不到 PROD 中的任何秘密。

● ***复制安全服务。*** 简单来说，产品安全服务必须在 DEV、QA 和 STAGE 流程中复制。

第十一个因素建议将日志视为事件流。这个因素中最重要的安全步骤是以这样一种方式进行安全日志记录，即聚合日志的任何人都可以轻松地提取安全日志消息，以避免例如堆栈跟踪的负担。

换句话说，为每个具有支持信息的安全关键事件创建一个日志记录，并创建一个“安全”日志记录类别来帮助进行汇总。

最后也是第十二个因素，主要是管理流程以及作为一次性流程运行管理/管理任务。

从安全角度来看，管理流程必须接受与因素 I 到 XI 相同的安全审查。将一次性管理流程作为“产品”讨论的一部分，并了解与一次性管理流程相关的安全风险。

怀特哈特十二因素 App 安全附录清单包含了本文讨论的所有信息。它以列表的形式发布，以便于开发人员理解和使用。