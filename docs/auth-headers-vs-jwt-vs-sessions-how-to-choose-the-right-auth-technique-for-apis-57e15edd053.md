# 认证头 vs JWT vs 会话——如何为 API 选择正确的认证技术

> 原文：<https://medium.com/hackernoon/auth-headers-vs-jwt-vs-sessions-how-to-choose-the-right-auth-technique-for-apis-57e15edd053>

认证 REST APIs 需要选择适合您的应用程序的正确 API。有几种方法:

单页应用程序有两种选择:

*   基于会话
*   基于令牌的认证

需要问的一组问题是:

1.  会话是否应该在到期前失效？如果是，则必须优先选择会话。
2.  **会话是否应该基于不活动而结束，而不是在固定时间后结束？**如果是，则必须优先选择会话。
3.  **me 功能应该被记住吗？**如果是，则必须优先选择会话。
4.  **移动应用程序会使用相同的 API 吗？**如果是，则首选基于令牌的身份验证(但要确保为这些用例构建单独的 API)
5.  **您的 web 框架能够抵御 CSRF 吗？如果答案是“否”或者如果您不知道 CSRF 是什么，则首选基于令牌的身份验证。**

如果首选基于令牌的身份验证，请避免使用 JSON Web 令牌。JWT 应该被用作一个简短的一次性令牌，而不是可以多次重用的令牌。或者，您可以创建一个随机令牌，将其存储在 Redis/Memcached 中，并在每次请求时验证它。

首选基于令牌的身份验证。

移动应用程序不会自动维护和发送会话 cookies。因此，与设置会话 cookie 相比，移动应用程序开发人员设置身份验证令牌要容易得多。

基于签名的机制也没有用，因为密钥不能嵌入到移动应用程序中。只有当你有另一个渠道，比如说二维码，来传递秘密时，你才能使用基于签名的机制。

存储在 Redis 或 Memcached 中的随机令牌是最理想的方法。确保在编程中使用加密安全的随机生成器。

从服务器端应用程序调用的 API 有三种选择，包括:

*   基于 https 的基本身份验证
*   基于令牌的认证
*   基于签名的认证

1.  **API 会不会只供内部使用，只供你控制的应用使用，API 本身价值低吗？**如果是，只要您使用 HTTPS，基本认证是可以接受的。
2.  **你想让密钥长寿吗？**如果是，因为密钥本身从不通过网络发送，所以采用基于签名的认证。
3.  **您希望移动应用和网络应用使用相同的 API 吗？**如果是，因为基于签名的身份验证要求客户端存储机密，所以最好使用基于令牌的身份验证。
4.  你正在使用 OAuth 吗？如果是，决定已经为你做好了。OAuth 1 使用基于签名的认证，而 OAuth 2 使用基于令牌的认证。
5.  你提供客户端库来访问你的 API 吗？如果是，最好使用基于签名的身份验证，因为您可以一次性编写加密代码，并将其提供给所有客户。

JWT 最适合一次性令牌。理想情况下，每次使用都必须生成一个新的 JWT。
可接受的用例:

1.  服务器到服务器的 API 调用，其中客户端可以存储一个共享秘密，并为每个 API 调用生成一个新的 JWT。
2.  生成即将过期的链接，例如用于电子邮件验证的链接
3.  作为一个系统向登录用户提供对另一个系统的受限访问的方式。

仅当满足以下标准时，才应使用 OAuth:

1.  消费者或特定于用户的数据由您的 API 公开
2.  您不信任的第三方开发人员正在访问一些特定于用户的数据
3.  如果您想询问您的用户是否愿意与第三方开发者共享他们的数据

如果 3 个问题的答案都是“是”，那么您需要 OAuth。

*原载于 2018 年 6 月 18 日【hashedin.com】[](https://hashedin.com/auth-headers-vs-jwt-vs-sessions-choosing-right-auth-technique-for-apis/)**。***