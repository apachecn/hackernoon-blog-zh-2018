# BigQuery:ç”¨è¿™äº›é«˜çº§æŠ€å·§æå‡ä½ çš„æŸ¥è¯¢æ°´å¹³

> åŸæ–‡ï¼š<https://medium.com/hackernoon/bigquery-level-up-your-queries-with-these-advanced-tricks-c87de1fde235>

## **ä»¥å¤§éƒ½ä¼šè‰ºæœ¯åšç‰©é¦†å’Œäº‘è§†è§‰ API ä¸ºç‰¹è‰²**

![](img/dd1e3ad6ff43c070140e803f0edee540.png)

[BigQuery](https://hackernoon.com/tagged/bigquery) æ˜¯ Google Cloud æä¾›çš„æ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆã€‚ç»„ç»‡ä½¿ç”¨æ•°æ®ä»“åº“å°†å¤šä¸ªæ•°æ®æºæ”¶é›†åˆ°ä¸€ä¸ªå®ä½“ä¸­ï¼Œå¹¶ä½¿ç”¨é¢å‘ä¸šåŠ¡çš„æ¨¡å¼å°†å®ƒä»¬é‡æ–°æ•´åˆåˆ° SQL æ•°æ®åº“ä¸­ã€‚

> è¿™ä½¿å¾—ç»„ç»‡çš„åˆä½œè€…å¯ä»¥é€šè¿‡ä¸€ä¸ªç‹¬ç‰¹çš„æœåŠ¡ï¼Œåªéœ€å‡ ä¸ª SQL æŸ¥è¯¢å°±å¯ä»¥è®¿é—®å¤šä¸ªåˆ†æå°±ç»ªæ•°æ®æºã€‚

å› æ­¤ï¼Œè·¨æºæ•°æ®åˆ†æå¾ˆå®¹æ˜“å®ç°ã€‚

è¿™ç§ç±»å‹çš„æœåŠ¡å¯¹äºä»»ä½•æ•°æ®é©±åŠ¨çš„å…¬å¸åŠŸèƒ½éƒ½éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯[ä¸šåŠ¡](https://hackernoon.com/tagged/business)æƒ…æŠ¥åˆ†æå¸ˆæˆ–æ•°æ®ç§‘å­¦å®¶ã€‚

BigQuery è¿˜å¸¦æœ‰å…¬å…±æ•°æ®é›†(*å¦‚* `hackernews`ã€`stackoverflow`æˆ–`github_repos`)ã€‚æœ€å¥½çš„æ˜¯ï¼Œè¯¥åˆ—è¡¨å®šæœŸæ›´æ–°ã€‚

å¦‚æœä½ æ˜¯ BigQuery çš„æ–°æ‰‹ï¼Œæƒ³è¦æ¢ç´¢è¿™äº›å¼€æ”¾æ•°æ®ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æœ‰ä»·å€¼çš„ä¿¡æ¯:[å…è´¹è¯•ç”¨ big query](https://cloud.google.com/bigquery/)ã€‚

æ­¤å¤–ï¼ŒFelipe Hoffa è¿˜æä¾›äº†ä¸€äº›å…³äº BigQuery å…¬å…±æ•°æ®é›†çš„æœ‰è¶£åˆ†æ:

*   [*Github ä¸­çš„æ‰€æœ‰å¼€æºç°åœ¨åœ¨ BigQuery å†…å…±äº«:åˆ†ææ‰€æœ‰ä»£ç ï¼*](/google-cloud/github-on-bigquery-analyze-all-the-code-b3576fd2b150)
*   [*è¿™äº›æ˜¯çœŸå®çš„æ ˆæº¢å‡ºè¶‹åŠ¿:ä½¿ç”¨æµè§ˆé‡*](https://towardsdatascience.com/these-are-the-real-stack-overflow-trends-use-the-pageviews-c439903cd1a)
*   [*2017 å¹´è°å¯¹å¼€æºè´¡çŒ®æœ€å¤§ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ Github çš„æ•°æ®ï¼Œä¸€æ¢ç©¶ç«Ÿã€‚*](https://medium.freecodecamp.org/the-top-contributors-to-github-2017-be98ab854e87)

ä½œä¸ºæˆ‘å·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä¸ªäººå·²ç»ä½¿ç”¨ BigQuery å°†è¿‘ä¸€å¹´äº†ï¼Œè¿™é‡Œæ˜¯æˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—çš„ä¸€äº›ç»éªŒï¼Œå¯èƒ½å¯¹ä½ æœ‰ç”¨ã€‚ä¸ºäº†æ”¯æŒæˆ‘çš„é™ˆè¿°ï¼Œæˆ‘å°†ä½¿ç”¨å…¬å…±æ•°æ®é›†`bigquery-public-data.the_met`ã€‚

# æ•°æ®é›†

`the_met`æ•°æ®é›†ä»çº½çº¦å¤§éƒ½ä¼šè‰ºæœ¯åšç‰©é¦†çš„ 20 ä¸‡ä»¶è‰ºæœ¯å“ä¸­æ”¶é›†æ•°æ®ã€‚æ•°æ®åŒ…æ‹¬å¯¹è±¡å…ƒæ•°æ®å’Œå›¾ç‰‡è¡¨ç¤ºã€‚

![](img/b6b5d36df3b11f2fbdc0a37fa650ae0b.png)

æœ€é‡è¦çš„æ˜¯ï¼Œç”±äºæœ‰äº†[äº‘è§†è§‰ API](https://cloud.google.com/vision/) ï¼Œæ‰€æœ‰çš„å›¾åƒéƒ½å¾—åˆ°äº†æ³¨é‡Š:è¿™ä¸ª API å…·æœ‰å‡ ä¸ªé¢„å…ˆè®­ç»ƒå¥½çš„è®¡ç®—æœºè§†è§‰æ¨¡å‹ï¼Œæä¾›äº†ä¸°å¯Œçš„è§†è§‰ä¿¡æ¯(å…¶ä¸­åŒ…æ‹¬å›¾åƒåˆ†ç±»ã€äººè„¸æ£€æµ‹å’Œå®šä½ã€å…‰å­¦å­—ç¬¦è¯†åˆ«)ã€‚

è¿™äº›æ³¨é‡Šåœ¨æ•°æ®é›†ä¸­å¯ç”¨ï¼Œå¹¶åŒ…å«è®¸å¤šåµŒå¥—å­—æ®µï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºä¸æ•°æ®äº‰è®ºçš„ä¸€ä¸ªå¾ˆå¥½çš„åœºæ‰€ã€‚

![](img/4e1738bd7f26a456b69646ec2602e081.png)

Logo Detection request to Cloud Vision with **The Death of Socrates**, David (1787)

æ•°æ®é›†ç”± 3 ä¸ªè¡¨ç»„æˆ:

*   `the_met.images`ä¸ºå›¾ç‰‡ç½‘å€
*   `the_met.objects`å¯¹äºå¯¹è±¡å…ƒæ•°æ®
*   `the_met.vision_api_data`å¯¹äº vision api ç”Ÿæˆçš„æ³¨é‡Š

å¸¸ç”¨é”®æ˜¯`object_id`ã€‚

æ›´å¤šå…³äº`the_met`çš„ä¿¡æ¯å¯ä»¥ä»è¨æ‹‰Â·ç½—å®¾é€Šçš„[è¿™ç¯‡æ–‡ç« ](https://cloud.google.com/blog/products/gcp/when-art-meets-big-data-analyzing-200000-items-from-the-met-collection-in-bigquery)ä¸­è·å¾—ã€‚

# æ‹›æ•°æ€ä¹ˆæ ·ï¼Ÿ

è¿™é‡Œæè¿°çš„æŠ€å·§ä¸ä¸€å®šèƒ½è§£å†³å¤æ‚çš„æƒ…å†µã€‚å®ƒä»¬æ›´å€¾å‘äºå¸®åŠ©æ‚¨ç¼–å†™æ›´çŸ­ã€æ›´é«˜æ•ˆçš„æŸ¥è¯¢ï¼Œé€šå¸¸ä¼šå¿½ç•¥ä¸€äº›å‘½ä»¤ã€‚

æˆ‘ä»¬å°†è®¨è®ºçš„ä¸»é¢˜å¦‚ä¸‹:

1.  **ç­‰å¹‚éšæœºæ‹†åˆ†è¡¨æ ¼è¡Œ**
2.  **ä½¿ç”¨**å’Œ`**EXCEPT**`ç¼©çŸ­æ‚¨çš„æŸ¥è¯¢
3.  **ç”¨**ä¿®æ”¹æ•°ç»„å†…è”`**ARRAY**`
4.  **å½“ SQL æ— æ³•å¤„ç†å®ƒæ—¶ï¼Œå°± JS å®ƒ**
5.  **big query ML ä¸Šçš„é™„åŠ éƒ¨åˆ†**

> **å…è´£å£°æ˜**:ä¸‹é¢çš„ä¾‹å­å°†ä½¿ç”¨æ ‡å‡† SQLï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå®ƒæ¯” BigQuery é—ç•™ SQL æä¾›äº†æ›´å¤šçš„ç‰¹æ€§[ã€‚å®ƒä»¬å‡è®¾æ‚¨å·²ç»ç†Ÿæ‚‰ BigQueryã€è¡Œèšåˆã€è®°å½•ã€é‡å¤å­—æ®µå’Œå­æŸ¥è¯¢ã€‚](https://cloud.google.com/bigquery/docs/reference/standard-sql/migrating-from-legacy-sql)

# 1.å¹‚ç­‰éšæœºæ‹†åˆ†è¡¨æ ¼è¡Œ

å½“è¯•éªŒæœºå™¨å­¦ä¹ å’Œ BigQuery æ•°æ®æ—¶ï¼Œèƒ½å¤Ÿä»¥ç»™å®šçš„åˆ†æ•°éšæœºæ‹†åˆ†è¡¨å¬èµ·æ¥å¯èƒ½å¾ˆæœ‰ç”¨ã€‚

å¦‚æœæŸ¥è¯¢æ˜¯å¹‚ç­‰çš„ï¼Œé‚£å°±æ›´å¥½äº†:æ— è®ºè¿è¡Œå¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚

ç”¨ä¾‹å‡ºç°åœ¨å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œå¼€å‘é›†æ—¶ã€‚

ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬å¯¹`the_met.objects`è¿›è¡Œ 80â€“20 åˆ†å‰²ã€‚è¿™ä¸ªæƒ³æ³•åœ¨äºæ•£åˆ—ä¸€ä¸ªå­˜åœ¨äºæ‰€æœ‰è¡Œä¸­å¹¶ä¸”å¯¹äºæ¯ä¸€è¡Œéƒ½æ˜¯å”¯ä¸€çš„åˆ—å­—æ®µï¼Œ*ä¾‹å¦‚*å’Œ`[FARM_FINGERPRINT](https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators#farm_fingerprint)`ã€‚

ç„¶åå¯ä»¥åˆ©ç”¨æ•´æ•°æ•£åˆ—çš„ç®—æœ¯å±æ€§æ¥å¹‚ç­‰åœ°åŒºåˆ†è¡Œã€‚

å¯¹äº 20%çš„åˆ†å‰²ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡ 5 å€¼ã€‚åœ¨è¿™é‡Œï¼Œè¿™ä¸ªå­—æ®µå¯ä»¥æ˜¯`object_number`ã€‚

ä¸Šé¢çš„æŸ¥è¯¢è¿”å›äº† 401596 è¡Œä¸­çš„ 80221 è¡Œã€‚ 19.97%)ã€‚è€¶ï¼

![](img/9daff63bc0c2e9364781442902c53f0c.png)

Samples of objects with their number, FARM_FINGERPRINT hash, corresponding group and title

# 2.ä½¿ç”¨`EXCEPT`ç¼©çŸ­æ‚¨çš„æŸ¥è¯¢

ä¸€ä¸ªç»å¸¸è¢«å¿½è§†çš„å…³é”®è¯æ˜¯`EXCEPT`ã€‚è¿™å…è®¸æ‚¨æŸ¥è¯¢é™¤äº†å®ƒä»¬çš„å­é›†ä¹‹å¤–çš„æ‰€æœ‰åˆ—ã€‚

äº‹å®è¯æ˜ï¼Œå½“è¡¨æ¨¡å¼éå¸¸å®Œå¤‡æ—¶ï¼Œå¦‚åœ¨`the_met.objects`ä¸­ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚

ä¾‹å¦‚:

With `EXCEPT`, 4 lines

Without `EXCEPT`, 43 lines

`the_met.vision_api_data`ä¸­æä¾›çš„å¦ä¸€ä¸ªå›¾åƒæ³¨é‡Šç¤ºä¾‹ã€‚åœ¨å¯ç”¨çš„æ³¨é‡Šä¸­ï¼Œæœ‰`faceAnnotations`:

![](img/4e53369ec3a5bbee40a2a247a7a93e57.png)

Schema for `face_annotations` in `the_met.vision_api_data`

å¦‚æœæˆ‘ä»¬å¯¹é™¤äº†`faceAnnotations.surpriseLikelihood`å’Œ`faceAnnotations.sorrowLikelihood`ä¹‹å¤–çš„æ‰€æœ‰åˆ—éƒ½æ„Ÿå…´è¶£ï¼Œè¿™ä¸ªæŸ¥è¯¢ä¼šèµ·ä½œç”¨å—ï¼Ÿ

This query references nested queries and is invalid.

å®é™…ä¸Šï¼Œè¿™ä¸ªæŸ¥è¯¢æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºå®ƒå¼•ç”¨äº†`EXCEPT`ä¸­çš„ä¸€ä¸ªåµŒå¥—å­—æ®µã€‚`faceAnnotations`éœ€è¦`UNNEST` *ed* æ‰èƒ½å¼•ç”¨ã€‚

This query is valid but the `faceAnnotations` are now unnested.

ä¸Šé¢çš„æŸ¥è¯¢æœ‰æ•ˆï¼Œä½†æ˜¯`faceAnnotations`ç°åœ¨æ²¡æœ‰åµŒå¥—ã€‚

ä¸‹ä¸€èŠ‚å°†å±•ç¤ºå¦‚ä½•åœ¨ä¿ç•™åµŒå¥—ç»“æ„çš„åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œè¿™è¦å½’åŠŸäºå…³é”®å­—`ARRAY`ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸å®Œå…¨æ‰å¹³åŒ–çš„è¡¨ç›¸æ¯”ï¼Œç»´æŠ¤åµŒå¥—ç»“æ„åœ¨å­˜å‚¨å’Œå¤„ç†èƒ½åŠ›æ–¹é¢æ›´å…·æˆæœ¬æ•ˆç›Šã€‚

# 3.ç”¨`ARRAY`ä¿®æ”¹æ•°ç»„

åœ¨ BigQuery ä¸­ï¼Œ`ARRAY`å­—æ®µ(åˆåã€‚`REPEATED`å­—æ®µ)æŒ‡ä¸€è¡Œå¯ä»¥æœ‰å¤šä¸ªå¯¹åº”å€¼çš„åˆ—ã€‚ä¾‹å¦‚åœ¨`vision_api_data`ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥å¯¹åº”å¤šä¸ª`faceAnnotations`:

![](img/a13d71b3482155c9ae13b512b8e4b620.png)

To one line (=one `object_id`) can correspond several `faceAnnotations`

ä½ å¯èƒ½çŸ¥é“`ARRAY_AGG`æˆ–`ARRAY_LENGTH`ï¼Œä½†ä½ å¬è¯´è¿‡ç»å¸¸è¢«å¿½è§†çš„`ARRAY`å—ï¼Ÿ

æ ¹æ®[æ–‡æ¡£](https://cloud.google.com/bigquery/docs/reference/standard-sql/array_functions) , `ARRAY(subquery)`è¿”å›ä¸€ä¸ª`ARRAY`ï¼Œå­æŸ¥è¯¢ä¸­çš„æ¯ä¸€è¡Œéƒ½æœ‰ä¸€ä¸ªå…ƒç´ ã€‚è®©æˆ‘ä»¬çœ‹å‡ ä¸ªç”¨ä¾‹ã€‚

## 3.1 è¿‡æ»¤æ‰åµŒå¥—å­—æ®µï¼ŒåŒæ—¶ä¿ç•™åµŒå¥—ç»“æ„

è®©æˆ‘ä»¬å†æ¬¡å¤„ç†å‰é¢çš„ä¾‹å­ï¼Œä½†æ˜¯è¿™æ¬¡ç”¨ä¸€ä¸ªæ›´ä¼˜é›…çš„æ–¹æ³•ã€‚

And I never unnested any column

æ³¨æ„ï¼Œå½“åœ¨ä¸€ä¸ª`ARRAY`å­å¥ä¸­æŸ¥è¯¢å¤šä¸ªåˆ—æ—¶ï¼Œ`SELECT AS STRUCT`æ˜¯å¿…éœ€çš„ã€‚

## 3.2 ç­›é€‰æ•°ç»„å­—æ®µä¸­çš„è¡Œ

è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†æ ¹æ®åµŒå¥—åˆ—ä¸Šçš„æ¡ä»¶ï¼Œè¿‡æ»¤æ‰`ARRAY`ä¸­çš„è¡Œï¼Œè€Œä¸æ˜¯è¿‡æ»¤æ‰åˆ—ã€‚

å‡è®¾æˆ‘ä»¬å¯¹å¾ˆå¯èƒ½æ›å…‰ä¸è¶³çš„äººè„¸ä¸æ„Ÿå…´è¶£ã€‚ `underExposedLikelihood='VERY_LIKELY'`)ã€‚

The query

![](img/4a44826c2f24b231ec80393e7aea08b1.png)

Above: `faceAnnotations` before `WHERE` filtering

![](img/7ef50063b6c4cbcc987930013741d792.png)

Above: `faceAnnotations` after `WHERE` filtering

## 3.3 ç”¨åµŒå¥—å­—æ®µä¸Šçš„è¿æ¥æ¥ä¸°å¯Œæ•°ç»„

åœ¨é¢éƒ¨æ³¨é‡Šçš„é¡¶éƒ¨ï¼Œäº‘è§†è§‰ API æä¾›äº†ç½‘ç»œæ£€æµ‹åŠŸèƒ½ï¼Œç±»ä¼¼äºè°·æ­Œå›¾åƒåå‘æœç´¢ã€‚

![](img/81c1dbd638df7f57676a9a5991a61b0e.png)

`webDetection` schema

è®©æˆ‘ä»¬ç”¨æ¥è‡ª`the_met.images`çš„åŒ¹é…`object_id`(åšç‰©é¦†ç‰©å“çš„å›¾ç‰‡ URL)æ¥ä¸°å¯Œè¿™ä¸ªæ¨¡å¼ã€‚è¿™æ˜¯ç›®æ ‡æ¨¡å¼:

![](img/b9acf1f2c6c05e4232fe5e50bb5fb863.png)

Target enriched `webDetection` schema

ç›¸åº”çš„æŸ¥è¯¢

ç»“æœå‘¢

![](img/d7eb0d64edc461dd3e4a0971fc30826e.png)

Samples of the `webDetection` schema enrichment. The output schema has been simplified for readability.

ä¾‹å¦‚ï¼Œä»é‚£é‡Œä½ å¯ä»¥è¯„ä¼°è°·æ­Œåå‘å›¾åƒæœç´¢çš„å›¾åƒæ£€ç´¢æ€§èƒ½ã€‚

# 4.å½“ SQL ä¸èƒ½å¤„ç†å®ƒæ—¶ï¼Œå°±ç”¨ JS

BigQuery å…è®¸æ‚¨ç”¨ JavaScript ç¼–å†™è‡ªå·±çš„[ç”¨æˆ·å®šä¹‰å‡½æ•°](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions)(UDF)ï¼Œè¿™åœ¨ StandardSQL ä¸æ”¯æŒæ‚¨æƒ³è¦å®ç°çš„åŠŸèƒ½æ—¶ä¼šå¾ˆæœ‰ç”¨ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å¯¹ä»`vision_api_data`ä¸­ä¸ºæ¯ä¸ª`object_id`æå–å…·æœ‰ç¬¬äºŒé«˜`score`çš„`labelAnnotation`æ„Ÿå…´è¶£ã€‚åœ¨ StandardSQL ä¸­ï¼Œå¯ä»¥é€‰æ‹©ç¬¬ä¸€è¡Œï¼Œä½†ä¸èƒ½é€‰æ‹©ç¬¬äºŒè¡Œ(è‡³å°‘ä¸èƒ½åœ¨å•ä¸ªæŸ¥è¯¢ä¸­)ã€‚

> **ç¼–è¾‘:**åä¸€é¡¹ä»»åŠ¡å®é™…ä¸Šå¾ˆå®¹æ˜“å®ç°ã€‚è¯·å‚è€ƒè¯„è®ºéƒ¨åˆ†ï¼Œçœ‹çœ‹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°

ç»“æœå‘¢

![](img/79e9b44ad8f45d9423bc876e5bc6b740.png)

We prepended the table schema with the argument of the UDF for convenience.

è¯·æ³¨æ„ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒBigQuery è§†å›¾ä¸æ”¯æŒ UDFã€‚

# 5.BigQuery ML çš„é™„åŠ éƒ¨åˆ†

BigQuery ML æ˜¯ BigQuery çš„æœ€æ–°ç‰¹æ€§ä¹‹ä¸€ã€‚å®ƒå…è®¸æ‚¨åªä½¿ç”¨å‡ ä¸ª SQL å‘½ä»¤æ¥æ„å»ºã€è®­ç»ƒå’Œéƒ¨ç½²æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚è¿™å¯ä»¥èŠ‚çœä½ å»ºç«‹æ•°æ®ç®¡é“çš„æ—¶é—´ï¼Œæˆ–è®¸è¿˜å¯ä»¥åŠ é€Ÿå…¶ä»–æœåŠ¡ï¼Œæ¯”å¦‚ Google AppEngineã€‚

ä¸ºäº†è¿™ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªå¯¹è±¡çš„ä¸€äº›å…ƒæ•°æ®æ˜¯å¦å¯ä»¥å¾ˆå¥½åœ°é¢„æµ‹ä¸€å¼ è„¸æ˜¯å¦å‡ºç°åœ¨å®ƒä¸Šé¢ã€‚

![](img/d354f335867af347c8d96eea6a7054c0.png)

Logistic Regression task: predict whether or not an art piece has a face representation

æˆ‘ä»¬å°†ä¾é äº‘è§†è§‰ API å¯¹äººè„¸çš„å­˜åœ¨è¿›è¡Œåœ°é¢å®å†µæ ‡è®°:

```
IF(
  ARRAY_LENGTH(faceAnnotations)=0 OR faceAnnotations IS NULL
  , 0
  , 1
) AS label
```

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨çº¿æ€§[é€»è¾‘å›å½’](https://en.wikipedia.org/wiki/Logistic_regression)ã€‚

åœ¨ BigQuery ä¸Šåˆ›å»ºæ¨¡å‹å°±åƒç”¨å‡ ä¸ªå‘½ä»¤é¢„å…ˆæŒ‚èµ·è®­ç»ƒé›†æŸ¥è¯¢ä¸€æ ·ç®€å•ã€‚

å‡è®¾æ‚¨å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸º`bqml`çš„æ•°æ®é›†(å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºå®ƒ)ï¼Œè¯­æ³•å¦‚ä¸‹æ‰€ç¤º:

æ³¨æ„è¾“å…¥ç‰¹æ€§ä¸­çš„æ··åˆç±»å‹:`STRING`ã€`BOOLEAN`ã€`INTEGER`ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒBigQuery é€šè¿‡å¯¹éæ•°å­—ç‰¹å¾è¿›è¡Œä¸€æ¬¡æ€§ç¼–ç æ¥å¤„ç†è¿™ç§å¤šæ ·æ€§ã€‚è¿˜è¦æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸Šè¿°å¹‚ç­‰åˆ†è£‚æŠ€å·§æ¥è®­ç»ƒ 80%æ•°æ®çš„æ¨¡å‹ã€‚

åŸ¹è®­ç»“æŸåï¼Œè®©æˆ‘ä»¬ç”¨ä»¥ä¸‹æ–¹æ³•åœ¨å¼€å‘é›†(å…¶ä»– 20%çš„æ•°æ®)ä¸Šè¯„ä¼°æ¨¡å‹:

è¯„ä¼°æŸ¥è¯¢è¿”å›

```
[
   {
      "precision": "0.6363636363636364",
      "recall": "4.160228218233686E-4",
      "accuracy": "0.8950143845832215",
      "f1_score": "8.315020490586209E-4",
      "log_loss": "0.3046493172393632",
      "roc_auc": "0.857339"
   }
]
```

é¡ºä¾¿æä¸€ä¸‹ï¼Œå…ˆéªŒåˆ†å¸ƒå¦‚ä¸‹:

```
[
   { 
      "pc_with_faces": "0.1050043372170668", 
      "pc_no_faces": "0.8949956627829332" 
   } 
]
```

ç»™å®šéå¸¸ä½çš„å¬å›åˆ†æ•°å’Œå‡ ä¹ä¸è¶…è¿‡å…ˆéªŒåˆ†å¸ƒçš„å‡†ç¡®åº¦åˆ†æ•°ï¼Œæˆ‘ä»¬ä¸èƒ½è¯´æ¨¡å‹å·²ç»ä»è¾“å…¥ç‰¹å¾ä¸­å­¦ä¹ äº†ğŸ˜Šã€‚

ç„¶è€Œï¼Œè¿™ä¸ªä¾‹å­å¯ä»¥ä½œä¸º BigQuery ML çš„ä»‹ç»ã€‚

ä¸ºäº†æé«˜æ¨¡å‹çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹åƒ`culture`å’Œ`classification`è¿™æ ·çš„å­—æ®µè¿›è¡Œå­—ç¬¦ä¸²é¢„å¤„ç†å’Œåˆ†è§£ã€‚å¯ä»¥åˆ©ç”¨å…¶ä»–éç»“æ„åŒ–çš„æè¿°æ–‡æœ¬å­—æ®µï¼Œä½†æ˜¯è¿™è¶…å‡ºäº† BigQuery ML çš„å½“å‰èŒƒå›´ã€‚

å¦‚æœæ‚¨çƒ­è¡·äºåœ¨äº‘ä¸­æä¾›æœºå™¨å­¦ä¹ ï¼Œä½†å‘ç° BigQuery ML æœ‰å±€é™æ€§ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°æˆ‘çš„[ä¸Šä¸€ç¯‡æ–‡ç« ](https://towardsdatascience.com/https-towardsdatascience-com-deploying-machine-learning-has-never-been-so-easy-bbdb500a39a)å¾ˆæœ‰ç”¨ã€‚

*åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ŒBigQuery ML æ˜¯ä¸€ä¸ªæµ‹è¯•ç‰ˆã€‚*

> **å°±è¿™æ ·ç»“æŸäº†ï¼è°¢è°¢ä½ è¯»åˆ°è¿™é‡Œã€‚æˆ‘çœŸçš„å¾ˆå–œæ¬¢åˆ†äº«è¿™äº›çŸ¥è¯†ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›å®ƒä»¬å¯¹ä¸€äº›äººæœ‰ç”¨ã€‚**

åœ¨ Sephora South-East Asia(Sephora SEA ),æˆ‘ä»¬åˆ©ç”¨ BigQuery å®ç°æ›´ç®€å•çš„æ•°æ®æ”¯æŒå†³ç­–ï¼Œå¹¶æ›´å¥½åœ°äº†è§£æˆ‘ä»¬çš„å®¢æˆ·ã€‚

*Sephora SEA çš„æ•°æ®å›¢é˜Ÿå°½å¯èƒ½åœ°å…³æ³¨æ•°æ®çš„å†…éƒ¨æ°‘ä¸»åŒ–ï¼Œéƒ¨åˆ†æ˜¯é€šè¿‡å…³äº BigQuery çš„ SQL åŸ¹è®­ã€‚*

*æœ¬æ–‡çŒ®ç»™ä»–ä»¬ï¼Œä¹ŸçŒ®ç»™æˆ‘ä»¬æ‰€æœ‰çš„å®ä¹ ç”Ÿå’Œå¾€å±Šæ¯•ä¸šç”Ÿã€‚*

*æ­£å¦‚æˆ‘çš„åŒäº‹*[*aurÃ©lien*](/@auvalade_52739)*ä¼šè‡ªè±ªåœ°è¯´:*

```
SELECT thanks FROM you
```

*ç…§ç‰‡è‡´è°¢:* [*å‡¯æ–‡Â·æ‹‰æ˜æ‰˜*](https://unsplash.com/@kxvn_lx?utm_source=medium&utm_medium=referral) *ä¸Š*[*Unsplash*](https://unsplash.com?utm_source=medium&utm_medium=referral)