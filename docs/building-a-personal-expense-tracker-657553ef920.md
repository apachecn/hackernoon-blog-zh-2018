# 建立个人支出追踪系统

> 原文：<https://medium.com/hackernoon/building-a-personal-expense-tracker-657553ef920>

![](img/263df6638cb2117470bfdd11af759a96.png)

Photo by [Mirza Babic](https://unsplash.com/@mirzababic?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

最近，我对分析和跟踪我每月的消费模式产生了兴趣。有像 [Mint](https://www.mint.com/) 这样的工具可以帮助你做到这一点。然而，我更感兴趣的是访问历史原始信用卡交易数据进行分析。此外，我发现像[铸币厂](https://www.mint.com/)这样的服务在准确分类交易方面做得不是很好。例如，如果我在亚马逊或谷歌上买东西，费用会被归入一般的*购物*类别。举例来说，如果我试图计算出我每个月在亚马逊上购物的花费，这不是很有用。

很自然地，我决定构建我自己的更适合我的用例的东西，包括:

*   访问原始历史信用卡交易数据
*   更精细的事务分类

这篇文章的其余部分详细描述了我如何构建了一个跟踪我每月开销的小应用程序。

## 获取信用卡交易数据

银行和信用卡公司不会让您轻松地以编程方式查询信用卡交易数据。谢天谢地[格子](https://plaid.com/)让这变得超级简单。Plaid 提供了各种编程语言的客户端 SDK，您可以使用这些 SDK 连接到您的信用卡或借记卡帐户，并查询交易数据。

为了开始使用 Plaid，我需要创建一个帐户并请求 API 访问密钥。Plaid 确实为开发和测试提供了一个免费层，能够连接多达 100 个实时凭证。这已经足够了，除非您打算编写一个供成百上千用户使用的商业应用程序。你可以在这里注册一个格子[的账号。](https://dashboard.plaid.com/signup)

一旦我创建了一个帐户并有了 API 访问密钥，下一步就是向我的银行和信用卡提供商进行身份验证，以获得用于 plaid API 的访问令牌。最简单的方法是使用 Plaid 提供的[快速启动](https://github.com/plaid/quickstart)应用程序。获得访问令牌后，我就可以开始使用 plaid API 查询事务数据了。

我使用 Plaids ruby SDK 创建了一个简单的包装器类来查询信用卡交易数据。该类的结构如下:

在这个类的`initialize`方法中，我创建了一个`Plaid::Client`对象的实例，用于应用程序和 Plaid 服务器之间的所有通信。我使用`vault`来管理我所有的访问令牌。方法`load_secrets_from_vault`只是从我运行的`vault`服务器的本地实例中加载应用程序秘密。方法`get_credit_card_accounts`只获取我在银行的信用卡账户的账户元数据(特别是账户 id，用于以后的交易查询)。这是必要的，因为我只想跟踪我的信用卡账户上的交易活动(因为这些是我日常开销所用的)。最后，方法`get_transactions`获取给定数据范围的所有事务。因为事务的数量可能很大，所以 Plaid API 返回一个分页的响应，这个响应由`get_transactions`函数来处理。

在检索事务数据之后，我需要对它进行一些清理。具体来说，我想删除未决交易和信用卡付款。此外，我想对事务分类进行一点清理。Plaid 返回与事务相关的类别的层次分类。对于我的用例，我对类别的层次结构并不感兴趣——所以我最终将它们连接起来，得到一个完全合格的描述性类别名称。此外，有时事务没有与之相关联的类别。在本例中，我没有将类别留空，而是使用了与交易相关联的供应商名称。最后，Plaid 返回的事务对象有很多属性。我倾向于只提取我需要的。下面的`DataSanitize`类代码片段捕获了这些清理方法。

最后，我编写了一个小模块来每月汇总所有交易，并生成每月支出报告。

我还最终生成了一份月度 HTML 电子邮件报告，并将所有原始交易数据保存到了 AWS DynamoDB 中，供以后使用和分析。你可以点击查看完整的代码库[。](https://github.com/skabbass1/spendthrift)