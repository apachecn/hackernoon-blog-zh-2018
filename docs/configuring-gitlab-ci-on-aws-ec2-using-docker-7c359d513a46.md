# ä½¿ç”¨ Docker åœ¨ AWS EC2 ä¸Šé…ç½® GitLab CI

> åŸæ–‡ï¼š<https://medium.com/hackernoon/configuring-gitlab-ci-on-aws-ec2-using-docker-7c359d513a46>

[GitLab CI](https://hackernoon.com/tagged/gitlab-ci) å­¦èµ·æ¥å¯èƒ½å¾ˆéšæ™¦ï¼Œå³ä½¿ç»´æŠ¤è€…è¯´[å¾ˆå®¹æ˜“](https://docs.gitlab.com/ee/ci/quick_start/#examples)ã€‚åŸå› æ˜¯ä½ éœ€è¦ç»å†è¯¸å¦‚é…ç½®ä¸€ä¸ªâ€œRunnerâ€ä¹‹ç±»çš„éº»çƒ¦ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªä½ å‡ ä¹ä¸çŸ¥é“è¦æ”¾ä»€ä¹ˆè¿›å»çš„æ–‡ä»¶ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç»§ç»­ä»é›¶å¼€å§‹åœ¨ AWS EC2 ä¸Šå®‰è£… GitLabï¼ŒGitLab CIï¼Œå¹¶å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Docker runner å’Œ GitLabã€‚

å¸–å­:

1.  [ã€æ•™ç¨‹â€”æŒ‡å—ã€‘ä»é›¶å¼€å§‹åœ¨ AWS EC2 ä¸Šå®‰è£… GitLabï¼ŒGitLab CIã€‚](/@josjaviasilis/tutorial-guide-installing-gitlab-gitlab-ci-on-aws-ec2-from-zero-751927e5ae5)
2.  ä½¿ç”¨ Docker åœ¨ AWS EC2 ä¸Šé…ç½® GitLab CI(æœ¬æ–‡)
3.  [æ­£åœ¨é…ç½®ã€‚gitlab-ci.yml](/@josjaviasilis/configuring-gitlab-ci-yml-150a98e9765d)
4.  [git lab å’Œ GitLab CI æ•…éšœæ’é™¤](/@josjaviasilis/troubleshooting-gitlab-and-gitlab-ci-79d3b71ad79f)

æˆ‘å°†é€ä¸€ä»‹ç»è¿™äº›æ­¥éª¤ã€‚[å¦‚æœ‰éœ€è¦æ¾„æ¸…çš„åœ°æ–¹ï¼Œæ¬¢è¿åé¦ˆ](https://hackernoon.com/tagged/feedback)ã€‚å¦‚æœä½ æ˜¯æ¥æ‰¾`.gitlab-ci.yml`æ–‡ä»¶ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒçš„ï¼Œè¯·ç‚¹å‡»[è¿™é‡Œ](/@josjaviasilis/configuring-gitlab-ci-yml-150a98e9765d)ã€‚

ä»ç¬¬ä¸€éƒ¨åˆ†:ä½ å­¦ä¹ äº†å¦‚ä½•åœ¨ AWS EC2 å®ä¾‹ä¸Šè®¾ç½® git labâ€¦ä½†æ˜¯ GitLab CI å‘¢ï¼Ÿå—¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ã€‚ä½†æ˜¯å¦‚æœä½ å·²ç»èµ°äº†è¿™ä¹ˆè¿œï¼Œæ‹æ‹ä½ è‡ªå·±çš„åèƒŒï¼Œè®©æˆ‘ä»¬ç»§ç»­ï¼

æˆ‘å°†å‡è®¾ä½ :

*   å·²ç»è®¾ç½®äº† GitLabã€‚
*   æ‚¨å·²ç»åˆ›å»ºæˆ–å¯¼å…¥äº†ä¸€ä¸ªé¡¹ç›®(è¯·åœ¨æ‚¨ä¸º GitLab å®ä¾‹åˆ†é…äº†ä¸€ä¸ªå¼¹æ€§ IP ä¹‹å**æ‰§è¡Œæ­¤æ“ä½œ)ã€‚**

# **#1-ç®€ä»‹**

è‡ªä» GitLab 10.3 ä»¥æ¥ï¼Œäº‹æƒ…å‘ç”Ÿäº†å˜åŒ–ã€‚GitLab å¼•å…¥äº†ä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œå…è®¸æ‚¨åœ¨å…¶ä¸­è¿è¡Œ CIã€‚Kubernetes æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç®¡ç†å¹³å°(æ‚¨å¯ä»¥åœ¨å…¶ä¸­éƒ¨ç½² Docker æ˜ åƒ)ã€‚è¿™ä¸ªæ•™ç¨‹**ä¸ä¼šæ¶µç›–è¿™ä¸ª**ã€‚è¿™å°†åŒ…æ‹¬è¿è¡Œä¸€ä¸ª**å•ç‹¬çš„ Docker å®ä¾‹**æ¥è¿è¡Œ CIã€‚æˆ‘ä¼šåšä¸€ä¸ªæœªæ¥çš„æ•™ç¨‹ï¼Œå¦‚ä½•è®¾ç½®å®ƒä¸è°·æ­Œäº‘å¹³å°ã€‚

ä¸ºäº†è®© GitLab ä½¿ç”¨ CIï¼Œå®ƒéœ€è¦æ¥è‡ªå®ƒæ‰€è°“çš„ [GitLab runner](https://docs.gitlab.com/runner/) çš„å¸®åŠ©ã€‚å®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ‰§è¡Œ CI ä½œä¸šçš„ sciptã€‚æ˜¯çš„ï¼Œå®ƒä»¬é€šå¸¸**é©»ç•™åœ¨ä¸ä½ çš„ GitLab å®‰è£…ä¸åŒçš„æœåŠ¡å™¨ä¸Š**(æ˜¯çš„ï¼Œå¦ä¸€ä¸ªé¢å¤–çš„æœåŠ¡å™¨)ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥å®‰è£…åœ¨æ‚¨å½“å‰çš„æœºå™¨ä¸Šï¼Œå¹¶åœ¨é‚£é‡Œè¿›è¡Œå¤„ç†ã€‚è¿˜æ²¡è°ƒæŸ¥è¿‡ã€‚æ— è®ºå¦‚ä½•æˆ‘éƒ½ä¸ä¼šæ¨èå®ƒï¼Œå› ä¸º GitLab æœ¬èº«å°±æ˜¯èµ„æºå¯†é›†å‹çš„ã€‚

å¥½æ¶ˆæ¯æ˜¯å®ƒä»¬è¿è¡Œèµ·æ¥å¾ˆä¾¿å®œã€‚æ‚¨å¯ä»¥åœ¨å¾®ç±³ã€çº³ç±³ç”šè‡³ç‚¹å®ä¾‹ä¸­è¿è¡Œå®ƒä»¬ï¼å¦‚æœä½ ä¸ç†Ÿæ‚‰åè€…ï¼Œäºšé©¬é€Šæœ‰ä»–ä»¬æ‰€è°“çš„[ç°è´§å®ä¾‹](https://aws.amazon.com/ec2/spot/)ã€‚åŸºæœ¬ä¸Šï¼Œç”±äº runner ä¸ä¼šæ€»æ˜¯è¿è¡Œ(å®ƒåªåœ¨æœ‰äººå°† CI é…ç½®æ–‡ä»¶æ¨é€åˆ°æœåŠ¡å™¨æ—¶è¿è¡Œ)ï¼Œæ‚¨ä¸éœ€è¦ 100%æ´»åŠ¨çš„æœåŠ¡å™¨ã€‚ä½ åªéœ€åœ¨æœ‰é™çš„æ—¶é—´å†…ç§Ÿç”¨å®ƒ(ç°åœºå®ä¾‹)ï¼Œä½ å°±å¯ä»¥å¼€å§‹äº†ã€‚

# #2-åˆ›å»ºå®ä¾‹ã€‚

éå¸¸æ¬¢è¿æ‚¨åˆ›å»ºä¸€ä¸ªä¸“ç”¨å®ä¾‹ï¼Œå¹¶åœ¨ä¸éœ€è¦æ—¶å…³é—­å®ƒã€‚æ‚¨ä¸éœ€è¦ä¸º spot å®ä¾‹æˆ–è€… GitLab runner æ­£åœ¨ä½¿ç”¨çš„ä¸“ç”¨å®ä¾‹åˆ†é…ä¸€ä¸ªå¼¹æ€§ IPã€‚**æ˜¯è·‘æ­¥è€…ä¸ GitLab** äº¤æµï¼Œè€Œä¸æ˜¯ç›¸åã€‚

è®©æˆ‘ä»¬è½¬åˆ° EC2 ä»ªè¡¨æ¿

![](img/9006aad9f712f8c30ffe8d3cb1b3f47b.png)

You can arrive here, by clicking â€œServicesâ€ on the top and then clicking â€œEC2â€

å•å‡»æ˜¾ç¤ºâ€œå¯åŠ¨å®ä¾‹â€çš„ä½ç½®

![](img/47cf8c16e35744197112eb5435489e21.png)

åœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸Šï¼Œé€‰æ‹© Ubuntu Server 64 ä½ï¼Œå®ƒæœ‰ä¸€ä¸ªå…è´¹å±‚(å¦‚æœæ‚¨é€‚ç”¨)ã€‚ä½ é€‰æ‹©çš„ Linux ç‰ˆæœ¬å¹¶ä¸é‡è¦ã€‚Ubuntu åªæ˜¯ç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚

![](img/3eebf102abf2c15cb7523d1250a5c587.png)

æ‚¨å¸Œæœ›é€‰æ‹© t2.microï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šä¸ºæ‚¨æä¾›ä¸€ä¸ªå…è´¹å±‚ã€‚ä¸éœ€è¦å¾ˆå¤§çš„åŠ›é‡(è¿™åªæ˜¯åˆšå¼€å§‹ã€‚å¦‚æœä½ éœ€è¦æ›´å¤šçš„èƒ½åŠ›å’Œé€Ÿåº¦ï¼Œé‚£å°±å¯ç”¨æ›´å¥½çš„å®ä¾‹ã€‚å¶å°”çŠ¯ä¸€æ¬¡(æ¯å¤© 1-2 æ¬¡)ä½ ä¸ä¼šæ­»)

ç„¶åï¼Œé€‰æ‹©â€œä¸‹ä¸€æ­¥:é…ç½®å®ä¾‹è¯¦ç»†ä¿¡æ¯â€

![](img/f0bb7f0b94e20319d72d98e62a231175.png)

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥é€‰æ‹©[â€œè¯·æ±‚ Spot å®ä¾‹â€](https://aws.amazon.com/ec2/spot/)ã€‚æˆ‘å»ºè®®ä½ åšè¿™ä»¶äº‹ï¼Œå› ä¸ºå®ƒèƒ½ä¸ºä½ çœé’±ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äº EC2 Spot å®ä¾‹çš„å†…å®¹ã€‚

![](img/464113859ccc064afe18b0f61ce2c480.png)

ä¸è¦ä½ä¼°ä¸‹ä¸€æ­¥ã€‚å°½å¯èƒ½å¤šåœ°æ·»åŠ ç©ºé—²å±‚æä¾›çš„ SSDã€‚GitLab CI å¯ä»¥ä½¿ç”¨ Docker(è¿™å°†æ˜¯æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„æ–¹æ³•ã€‚ä½ ä¸å¿…ä¸ºäº†ä½¿ç”¨å®ƒè€Œå­¦ä¹  Docker)ï¼Œè€Œä¸”å®ƒå°†å¾ˆå¿«å¡«æ»¡ç©ºé—´(ä½ å°†ä¸å¾—ä¸éšç€æ—¶é—´çš„æ¨ç§»è¿›è¡Œç»´æŠ¤ï¼Œå¹¶åˆ é™¤å›¾åƒï¼Œç¨åä¼šè¯¦ç»†ä»‹ç»)ã€‚

ä¹‹åï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥:æ·»åŠ æ ‡ç­¾â€

![](img/a687e8d8d8a12997428ff03562816e89.png)

æ ‡ç­¾ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°è·³è¿‡è¿™ä¸€æ­¥ã€‚

![](img/414e4f113296f563b0193a5c5314aac2.png)

æˆ‘æ€»æ˜¯æ¨èä¸‹é¢çš„æ­¥éª¤ï¼Œå› ä¸ºå®ƒä¿æŠ¤äº†å®ƒï¼Œå¹¶å¢åŠ äº†ä¸€å±‚å®‰å…¨æ¥é˜²æ­¢ä¸å¿…è¦çš„è®¿é—®ã€‚åªå…è®¸è®¿é—®æ‚¨çš„ IPã€‚è¯·ç†è§£ï¼Œæ¯å½“æ‚¨çš„ IP æ”¹å˜å¹¶ä¸”æ‚¨æƒ³è¦è¿æ¥åˆ°æœºå™¨æ—¶ï¼Œæ‚¨éƒ½å¿…é¡»æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹(å¦‚æœ IP ä¿æŒä¸å˜ï¼Œé‚£ä¹ˆæ‚¨ä¸éœ€è¦åšä»»ä½•äº‹æƒ…)ã€‚

![](img/de59b9e7a8eb81ad603e260ffc4064d5.png)

æ£€æŸ¥ä¸€åˆ‡æ­£å¸¸ï¼Œç„¶åå‘å°„ï¼

![](img/56bfb69e9c32cc4c8c7842d24bf5c7f8.png)

ä¸‹é¢çš„å±å¹•å°†è¯¢é—®æ‚¨æ˜¯è¦ä½¿ç”¨ç°æœ‰çš„è¿˜æ˜¯æ–°çš„ã€‚å¦‚æœæ‚¨æƒ³è·å¾—æœ€é«˜çš„å®‰å…¨æ€§ï¼Œè¯·ä½¿ç”¨ä¸“é—¨é’ˆå¯¹ GitLab Runner çš„æ–°å¯†é’¥ã€‚

![](img/997237823509cd8caa833f5397fd0a1f.png)

# #3 å®‰è£… GitLab è½¬è½®

ä¸€æ—¦å®ä¾‹å¯åŠ¨å¹¶è¿è¡Œï¼Œé€šè¿‡ PuTTY è¿æ¥åˆ°å®ƒã€‚è¿™ä¸ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„è¿‡ç¨‹ç›¸åŒã€‚å°† IPv4 åœ°å€æ”¾å…¥ PuTTY

![](img/0ea702202c7d78597fb843cddbe79691.png)

æŠŠå®ƒæ”¾è¿›æ²¹ç°é‡Œ(è®°ä½ã€‚ppk æ–‡ä»¶ä¹Ÿæ˜¯ï¼)

![](img/fa0692a2c7742e8b73933a5b0a188e56.png)![](img/67e55f860efb4748141cf83e32597c8b.png)

Click on Yes.

ç™»å½•å:

![](img/aac199fa4eb5ff922d1586b3dc1b9d37.png)

åœ¨å‘½ä»¤ä¸­è¿è¡Œ:

```
sudo apt-get updatecurl -L [https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh](https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh) | sudo bashsudo apt-get install gitlab-runner
```

å¦‚æœæ‚¨æƒ³æ›´æ–°è·‘æ­¥è€…ï¼Œåªéœ€:

```
sudo apt-get update
 sudo apt-get install gitlab-runner
```

ç°åœ¨æ‚¨å¿…é¡»æ³¨å†Œè·‘æ­¥è€…:

```
sudo gitlab-runner register
```

æ‚¨å°†å¾—åˆ°ä»¥ä¸‹æç¤º

![](img/bca518da64e575b510931106b69522df.png)

å¯¹äº URLï¼Œé”®å…¥ IPv4 åœ°å€ï¼Œå¹¶ä»¥æ–œæ ç»“å°¾(æœ«å°¾ä¸ºæ–œæ )ã€‚ä¾‹å¦‚:

```
[http://ec2â€“28-251â€“133-100.us-east-2.compute.amazonaws.com/](http://ec2-18-217-233-100.us-east-2.compute.amazonaws.com/)
```

ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å» GitLabã€‚è½¬åˆ°æ‚¨æƒ³è¦è®¾ç½® CI çš„é¡¹ç›®ï¼Œå¹¶è½¬åˆ°ä¸» repo é¡µé¢ã€‚ç„¶åï¼Œåœ¨å·¦è¾¹æ ï¼Œä¼šæœ‰ä¸€ä¸ªâ€œè®¾ç½®â€é“¾æ¥ã€‚ç‚¹å‡»é‚£é‡Œã€‚å®ƒä¼šåœ¨åº•éƒ¨æ˜¾ç¤º CI/CDã€‚ä¸€æ—¦ä½ åœ¨é‚£é‡Œï¼Œå¯»æ‰¾â€œè·‘æ­¥è€…è®¾ç½®â€ï¼Œå¹¶ç‚¹å‡»â€œæŠ˜å â€ã€‚

![](img/b594b4b2961cf057b89b80126506c15b.png)![](img/4e02b1b2d8bc4a3b962efdfc9f9623be.png)

ç„¶åå®ƒä¼šé—®ä½ ä¸€ä¸ªæè¿°ï¼Œä½ å¯ä»¥è¾“å…¥â€œDocker Runnerâ€

# **#3.1 å…³äºæ ‡ç­¾çš„å¿«é€Ÿè¯´æ˜ã€‚**

åœ¨ GitLab CI(æŒç»­é›†æˆ)ç¯å¢ƒä¸­ä½¿ç”¨æ ‡ç­¾æ¥åˆ†ç±»å’Œæ§åˆ¶å¯¹è¿è¡Œè€…çš„è®¿é—®(ä» GitLab ä¸­çš„é¡¹ç›®)ã€‚å®ƒä»¬åœ¨ä»¥ä¸‹ä¸¤è€…ä¸­è¿›è¡Œäº†é…ç½®:ã€‚gitlab-ci.yml(ç¨åå°†è¯¦ç»†ä»‹ç»)ï¼Œä»¥åŠè·‘æ­¥è€…æœ¬èº«ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒç•™ç©ºã€‚éå¸¸æ¬¢è¿æ‚¨ä¸ºè·‘æ­¥è€…æ·»åŠ æ ‡ç­¾ã€‚

å½“å®ƒè¯¢é—®æ‚¨æ˜¯å¦å°†è·‘æ­¥è€…é”å®šåˆ°å½“å‰é¡¹ç›®[å¯¹/é”™]æ—¶ï¼Œæˆ‘å°†ç”±æ‚¨å†³å®šã€‚å¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨åŒä¸€ä¸ªå®ä¾‹æ¥å¤„ç†å¤šä¸ªé¡¹ç›®:

é€‰æ‹©é”™è¯¯â€¦

(é”™è¯¯)è¿™ä¼šå¸®ä½ çœé’±ã€‚è¿™æ„å‘³ç€è®¸å¤šé¡¹ç›®(ä¹Ÿç§°ä¸ºå­˜å‚¨åº“)å°†ä½¿ç”¨åŒä¸€ä¸ªè¿è¡Œå™¨æ¥å¤„ç†é›†æˆç®¡é“ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå°å›¢é˜Ÿï¼Œå¹¶ä¸”ä½ åœ¨ä¸åŒçš„æ—¶é—´è¡¨å’Œä¸€å¤©ä¸­çš„å°‘æ•°å‡ ä¸ªæ—¶é—´æŠ•å…¥ï¼Œè¿™æ˜¯å®Œç¾çš„ã€‚çœŸå®)

é€‰æ‹©çœŸâ€¦

è¿™æ„å‘³ç€ä½ å¿…é¡»ä¸ºæ¯ä¸ªé¡¹ç›®æ³¨å†Œä¸€ä¸ªæ–°çš„è·‘æ­¥è€…ã€‚æ˜¯çš„ï¼Œæ‚¨å¯ä»¥åœ¨åŒä¸€ä¸ªå®ä¾‹ä¸­æ³¨å†Œå¤šä¸ªè¿è¡Œè€…ï¼Œå°½ç®¡æ‚¨å¿…é¡»è®°ä½æ¯ä¸ªè¿è¡Œè€…åœ¨è¿è¡Œæ—¶éƒ½ä¼šæ¶ˆè€— CPU(æ²¡æœ‰åŒå…³è¯­)ã€‚å› æ­¤ï¼Œæˆ‘å»ºè®®ï¼Œæ— è®ºä½•æ—¶ä½ æœ‰ä¸€ä¸ªä¸­ç­‰è§„æ¨¡çš„å›¢é˜Ÿ(æˆ–è€…ä½ æ¯å¤©å¤šæ¬¡é›†æˆå¤šä¸ªé¡¹ç›®)ï¼Œéƒ½è¦æœ‰å•ç‹¬çš„è·‘æ­¥è€…ã€‚å¯¹ä½ æ¥è¯´ï¼Œæ·»åŠ å•ç‹¬çš„æµé“ï¼Œæ˜¯ç›¸åŒçš„ç¨‹åºï¼Œæ¯”æˆ‘ä»¬ç°åœ¨åšçš„ã€‚

ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†é€‰æ‹© falseï¼Œæˆ‘ä»¬å°†é˜²æ­¢è·‘æ­¥è€…è¢«é”å®šåˆ°å½“å‰é¡¹ç›®ã€‚

ä¸€æ—¦ä½ è¿™æ ·åšäº†ï¼Œå®ƒä¼šé—®ä½ :

![](img/721cf02b1fe012a92fb8fb7b08fe3768.png)

æ‚¨å°†é”®å…¥ **shell** ã€‚*ä¸è¦*å¼çš„ç å¤´å·¥äººã€‚åŸå› æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æŒ‡å®š Dockerï¼Œæˆ‘ä»¬å°†ä» Docker hub æŒ‡å®šæˆ‘ä»¬ç§°ä¸º[çš„ Docker æ˜ åƒ](https://docs.docker.com/get-started/)ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†åœ¨ç¨ååˆ›å»ºçš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šæˆ‘ä»¬çš„æ˜ åƒã€‚

æˆ‘ä»¬å¼€å§‹å§:

![](img/532042be1c44fc36df24ffd1d904ba9b.png)

# #3.2-ç§»é™¤æœªä½¿ç”¨çš„æ»‘é“

è¿è¡Œå¤šæ¬¡ gitlab-runner register ä¼šåˆ›å»ºå¤šä¸ª runnerï¼Œå®ƒä¸ä¼šä¸ºä½ åˆ é™¤å®ƒä»¬ã€‚å¦‚æœæ‚¨æƒ³åˆ é™¤æœªä½¿ç”¨çš„è·‘æ­¥è€…ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è·‘æ­¥:

```
sudo gitlab-runner verify â€” delete
```

è¦éªŒè¯è·‘æ­¥è€…æ˜¯å¦åœ¨å·¥ä½œ:

```
sudo gitlab-runner start 
```

å¯¼èˆªåˆ°æ‚¨ä¹‹å‰æ‰€åœ¨çš„é¡µé¢(Project Settings => CI/CD)ï¼Œå¹¶éªŒè¯ runner æ˜¯å¦å·²æ³¨å†Œå¹¶æ­£åœ¨è¿è¡Œã€‚

![](img/cfd60031dc5c677c5b6d47eca3c15284.png)

# #3.3 åœ¨ GitLab è½¬è½®ä¸Šå®‰è£… Docker

è¿™éµå¾ªäº† Docker åœ¨ Ubuntu æœåŠ¡å™¨ä¸­çš„æ­£å¸¸å®‰è£…ã€‚æ£€æŸ¥[æ­¤é“¾æ¥](https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository)äº†è§£æ­£å¼çš„å®‰è£…æ–¹æ³•ã€‚æˆ‘å°†åœ¨è¿™é‡Œä»‹ç»è¿™äº›æ­¥éª¤:

1.  æ›´æ–° apt åŒ…ç´¢å¼•:

```
sudo apt-get update
```

2.å®‰è£…è½¯ä»¶åŒ…ä»¥å…è®¸ apt é€šè¿‡ HTTPS ä½¿ç”¨å­˜å‚¨åº“:

```
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common
```

3.æ·»åŠ  Docker å®˜æ–¹ GPG é”®:

```
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
```

4.è®¾ç½®å­˜å‚¨åº“:

```
sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
```

5.æ›´æ–°åŒ…

```
sudo apt-get update
```

6.å®‰è£… Docker cE çš„æœ€æ–°ç‰ˆæœ¬:

```
sudo apt-get install docker-ce
```

è¿™å°†å¸¦æ¥ä¸€ä¸ªæ˜¯/å¦é—®é¢˜:é€‰æ‹©æ˜¯å®‰è£…ã€‚

![](img/956c90559bf0d22fb983af10b993f4e4.png)

7.é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒéªŒè¯ Docker å®‰è£…æ˜¯å¦æ­£ç¡®:

```
sudo docker run hello-world
```

![](img/b9856ce972dc482d232e405908284626.png)

This is it! Finally, the runner has been configured ğŸ‰ğŸ‰

æœ‰äº†è¿™äº›ï¼Œè·‘æ­¥è€…åº”è¯¥å·²ç»è¢«æˆåŠŸé…ç½®äº†ã€‚

# #4 åœ¨ GitLab ä¸­é…ç½® CI ç®¡é“

å°±æ˜¯è¿™ä¸€åˆ»äº†ï¼Œå„ä½ï¼æœ€ç»ˆé…ç½® CI ç®¡é“çš„æ—¶åˆ»åˆ°äº†ï¼

ğŸ˜±:â€œåšæŒä½ä¹”ï¼ä½ æ˜¯åœ¨å‘Šè¯‰æˆ‘æˆ‘ä»¬è¿˜æ²¡æœ‰åš***å—ï¼Ÿâ€

ğŸ”¥:â€œæ²¡é”™ï¼æˆ‘ä»¬åªæ˜¯åœ¨å‡†å¤‡åšèœçš„åŸæ–™ã€‚ç°åœ¨æˆ‘ä»¬æ­£åœ¨å‡†å¤‡ã€‚â€

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€åšçš„ä¸€åˆ‡éƒ½æ˜¯ä¸º CI çš„å·¥ä½œè®¾ç½®ç¯å¢ƒã€‚æ‰€æœ‰çš„æŒç»­é›†æˆ(CI)å°†é€šè¿‡ ***ä½ *** éœ€è¦åœ¨é¡¹ç›®ä¸­åˆ›å»ºçš„ä¸€ä¸ª`.gitlab-ci.yml`æ–‡ä»¶æ¥å·¥ä½œã€‚

è¿™ä¸ªæ–‡ä»¶çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼ŒCI ç®¡é“åªè€¦åˆ(ä¾èµ–)äºè¯¥æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥åšä»»ä½•æ‚¨æƒ³åšçš„äº‹æƒ…ã€‚

æ–‡ä»¶çš„å®Œæ•´è§„èŒƒå¯åœ¨[è¿™é‡Œ](https://docs.gitlab.com/ee/ci/yaml/#before_script-and-after_script)æ‰¾åˆ°:

 [## ä½¿ç”¨é…ç½®æ‚¨çš„ä½œä¸šã€‚gitlab-ci.yml | GitLab

### GitLab ç¤¾åŒºç‰ˆã€GitLab ä¼ä¸šç‰ˆã€Omnibus GitLab å’Œ GitLab Runner çš„æ–‡æ¡£ã€‚

docs.gitlab.com](https://docs.gitlab.com/ee/ci/yaml/#before_script-and-after_script) 

ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç¯‡æ–‡ç« å˜å¾—å¤ªé•¿äº†ï¼Œæˆ‘ä¸å¾—ä¸æŠŠå®ƒåˆ†æˆä¸€ç¯‡æ¬¡è¦çš„ã€‚

è®©æˆ‘ä»¬ç»§ç»­ä¸‹é¢çš„ä¸€ä¸ª:

[æ­£åœ¨é…ç½®ã€‚gitlab-ci.ymlï¼Œå¸¦ AWS EC2ï¼Œç”¨äºæŒç»­é›†æˆ(ci)æˆ–æŒç»­éƒ¨ç½²(CD)](/@josjaviasilis/configuring-gitlab-ci-yml-150a98e9765d)