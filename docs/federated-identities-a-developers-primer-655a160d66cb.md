# 联合身份:开发人员入门

> 原文：<https://medium.com/hackernoon/federated-identities-a-developers-primer-655a160d66cb>

![](img/13fc31ed10b98b0e0080eb1b73ccdbb0.png)

SSO、OAuth、联合身份管理——这些都是互联网上流传的术语，但是你可能会弄不清它们 ***实际上*** 的意思(对你，作为一名开发人员来说)。描述身份验证系统的术语经常被误用和混淆，这加剧了混乱。

因此，当有人说，“*使用 SMAL 联合身份实现单点登录”*时，他们实际上在说什么呢？理清大量误用的术语、协议和框架是理解这些身份验证机制的关键。为了解决这个问题，让我们从一些简单的定义开始。

![](img/9ca550a21725e9c29947b912f1ef40b2.png)

## 什么是单点登录？

![](img/4914cd18ada00c66229ae7ac6e4e9b57.png)

SSO 是一个身份验证过程或用例，它允许用户进行一次身份验证，然后就可以访问多个应用程序或服务(称为资源)。SSO 不是协议，也不是框架。它没有对如何实现这一点作出任何假设。

实现 s so 解决方案有几种标准方法，但有些方法是针对特定用户、流和用户代理的，因此在搜索 SSO 解决方案时，记住一些事情是很重要的。

谁是你的用户？您是否为公司员工(B2I)提供单点登录能力？例如，一家公司在其网络中使用了几个基于 web 的应用程序，并希望在这些应用程序之间向员工颁发一组证书。

或者，您的公司是否通过多个应用程序向客户提供服务(B2C ),并试图在整个应用程序套件中提供单点登录体验？

**您支持哪些设备？** 您支持原生移动应用还是仅支持基于浏览器的 web 应用？SSO 为用户管理员和最终用户提供了很多好处。然而，在深入研究 SSO 解决方案之前，我们必须介绍一些基本的先决主题，这些主题将有助于推动稍后的 SSO 讨论。

## 什么是联合身份管理(FIM)？

首先，什么是**联合身份**？

许多定义都有类似的表述*“联合身份是指一个人在一个系统中的身份，该身份与同一个人在多个其他系统中的身份相关联。”那么，让我们来看看这个令人困惑的定义是什么意思。*

![](img/e9b222e694c28c896a178e13fca3670a.png)

因此，通过联合，身份可以跨多个应用程序使用。这种应用程序分组有时被称为**身份联合**——其中它们都共享一组公共的**联合标识符**。通过 IdP 认证后，用户可以在联盟内的应用程序之间自由移动。

![](img/7f1c345b32b85e9a58849c08cc443171.png)

这可能还不是很清楚。当有人说，“*我的认证被‘联合’到 ABC* ”时， it *真正的含义是什么？用最简单的话来说，不是服务提供商自己对用户进行身份验证，而是将其身份验证卸载给另一个系统(称为身份提供商)。服务提供者**必须**信任身份提供者的认证能力。*

但是联合不仅仅是共享一组公共标识符的应用程序。它也是关于链接不同系统中的标识符。用户可以使用联盟内**任何**应用程序的凭证向 IdP 进行身份验证。例如，如果 IdP 接受脸书凭证或 Google+凭证，用户可以使用这两种凭证登录其中一个联合应用程序。使用哪一个并不重要，联邦应用程序将经过身份验证的用户视为同一个用户。

**联合身份管理**指的是用于以下目的的标准和协议:I)实现身份提供商和服务提供商之间的信息交换；ii)使识别信息可移植(格式和属性),以便可以跨多个应用程序使用 iii)支持所需用户数量的系统。

换句话说，服务提供商不再存储用户凭证。服务生产者也不需要验证它们。相反，身份提供者验证用户，并通知服务提供者用户确实是他们所说的那个人。

联合还提供了额外的好处，即应用程序不需要获取用户凭证。通过 FIM 协议，应用程序只需要被告知用户已经通过了身份验证，并且有一种方法可以验证这一点。服务提供商不会看到或接触到密码。这对于个别开发团队必须有限地接触用户凭证的环境来说非常好。

请记住，在这个定义中，我们没有断言这是如何发生的。how 是一个实现细节。还要注意，我们没有在 SSO 和联合身份的概念之间进行绑定。尽管 SSO 的许多实现都利用了联合身份管理，但这两者是**不同的概念**。

**有人可能会说，SSO 不就是 FIM 的一个子集吗？**

![](img/9c465f31fd7ce928c1b49285d9c607f1.png)

**回答**:是和否。SSO 的定义中没有要求 FIM 的内容，但是 SSO 的大多数实际实现都使用 FIM 的形式(或者说，一旦应用程序联合身份验证给第三方 IdP，SSO 就可以很容易地跨所有联合应用程序实现)。因此，这两个术语经常被错误地与 T21 互换使用。

## 联合身份验证流

让我们看一个示例流。当我们开始研究实现联合身份管理(和 SSO)的特定协议时，我们将重新检查实现细节，但现在重要的是掌握基本流程。在这个例子中，我们将假设用户使用浏览器访问服务提供商(它提供 web 前端 HTML 并有一个服务器后端), IdP 使用使用重定向的认证流。

首先，SP 可能有一种机制，根据它维护的任何会话状态来检查用户当前是否通过了身份验证。在某些情况下，SP 将总是重定向到 IdP，并让它检查用户的当前状态。

![](img/24e8dba2e5781f4951c36c497e4e0ae2.png)

如果用户未通过身份验证，他们将被重定向到身份提供商的登录页面。

![](img/b15be7b10ee7b8233ad2753fb149283f.png)

然后，用户输入他们的凭证(即用户名和密码)。当他们单击提交按钮时，身份提供者会验证他们的凭据，并将用户返回给服务提供者(如果有效)。

![](img/d3d8b732c3238c89f7fb5908ea2cb064.png)

此外，身份提供者创建一些已签名的数据，随 HTTP 请求一起发送回去。该数据告诉服务提供商用户已经成功登录(以及其他)。服务提供商现在验证这些数据，如果发现数据有效，应用程序就可以将用户视为已通过身份验证。

![](img/ff8c5a62209a7a0eb6b3a21e0d190c37.png)

请记住，这个流程排除了许多特定的细节，特别是这个“数据”是什么，数据的验证是如何完成的，以及其他重要的特定安全细节(与实现相关)。您应该看到的是，服务提供商从未处理过用户的凭证。验证由 IdP 完成，并使用安全的数据格式来传达成功的身份验证(这可以是 XML、JWT 等)。

## 委托认证

委托认证仅仅意味着服务提供商不自己提供认证，而是将该任务委托给另一个第三方服务(IdP)。一个允许用户通过脸书连接登录的网站就是一个例子。

联合身份验证使用一种委托身份验证形式，但是委托身份验证不一定是联合的。两者之间的关键区别在于不同服务提供者对身份的接受程度。例如，如果两个或更多服务提供商信任同一个 IdP 进行身份验证，并且用户身份在两个应用程序中都有效，那么我们称之为联合(和联合身份验证)。

![](img/ce6eaf9e681ddfaac55ea2190b0189ae.png)

Federated Authentication

通过委托，应用程序仅使用一组已知的 IDP 进行身份验证。在下面的例子中，应用程序允许使用脸书和 Twitter 登录，但仅限于这两个。关键区别在于，上面的联邦示例接受来自 IdP 接受的任何系统的凭证。

![](img/146e2caad1971256b1597588a7140774.png)

Delegated Authentication

接下来，我们将看看联合身份管理的一些具体实现，以及如何使用它们来实现 SSO。

## 中央认证服务协议(CAS)

CAS 是用于实现联合标识符管理协议。更令人困惑的是，CAS 项目(由 Apereo 运行)提供了 CAS 协议的实现(以及其他实现)。在 CAS、SAML 和 OpenID Connect 之间，CAS 是最不受欢迎的。

## 安全声明标记语言(SAML)

SAML 是一个成熟的基于 XML 的标准，用于在系统之间交换身份验证和授权数据(关于身份验证，在 IdP 和 SP 之间)。与 CAS(一种协议)不同，SAML 标准定义了 XML 文档结构以及应用程序应该如何使用它。

已经建立了完善的 SAML 身份验证流程，这些流程定义了创建联合 SSO 体验的规则和过程。像 CAS 一样，浏览器用户代理的 SAML 体验也是如此，它的应用程序后端可以解析和验证重量级的 SAML 令牌。

## OpenID 连接

OpenID Connect 是一个轻量级身份验证协议，它使用 JSON web 令牌(JWT)来使用基于 REST 的消息流。OpenID Connect 非常适合单页面应用程序、本地移动应用程序和其他非浏览器用户代理。OpenID Connect 构建在 OAuth2 框架之上，并使用 OAuth2 之类的流进行身份验证(OAuth2 并不适合这种情况)。

# 结论

![](img/10d36300e581fe9e63e1c65dd1a693e8.png)

联盟在 B2C 和 B2I 世界都有好处。在企业世界中，联合允许您的员工只记住一组凭证。对你的客户来说，它允许他们使用已有的凭证(脸书、Gmail 或 Twitter)，从而减轻了注册的负担。最后，联合身份管理系统实现了系统之间的信任。

我还[写了一篇后续文章](/@dev78digital/evaluating-authentication-as-a-service-providers-6903895a8450)，内容是关于你在选择认证服务提供商之前需要考虑的问题。