# å¦‚ä½•é€šè¿‡ Laravel æŠ¤ç…§è®¤è¯æ¨é”€å•†(ç¬¬ä¸€éƒ¨åˆ†)

> åŸæ–‡ï¼š<https://medium.com/hackernoon/how-to-authenticate-for-pusher-through-laravel-passport-part-1-7269edda0276>

![](img/56340696b23f1d65d4fc3ca0b2eee6ba.png)

Photo by [Cristina Gottardi](https://unsplash.com/@cristina_gottardi?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

å‡è®¾æ‚¨æœ‰ä¸€ä¸ª Laravel åº”ç”¨ç¨‹åºã€ä¸€ä¸ª iOS åº”ç”¨ç¨‹åºå’Œä¸€äº›åœ¨è¿™äº›åº”ç”¨ç¨‹åºä¹‹é—´æ¨é€çš„æ•°æ®ã€‚iOS åº”ç”¨ç¨‹åºéœ€è¦å°½å¿«(å®æ—¶)æ˜¾ç¤ºæ¥è‡ª Laravel åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚è¿™å°±æ˜¯ Pusher æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚åœ¨è¿™ 2 ç¯‡æ–‡ç« ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¾ç½® Laravel æ¥å¤„ç†å¸¦æœ‰ Laravel Passport çš„è®¤è¯è¯·æ±‚ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†é…ç½® Pusher æ¥å‘é€äº‹ä»¶ã€‚

æˆ‘åˆ›å»ºäº†ä¸‹å›¾æ¥è¯´æ˜è¿™ä¸ªè¿‡ç¨‹:

![](img/d7c9f341f27f5bcfe4d8b6459cd20995.png)

1.  iOS åº”ç”¨ç¨‹åºå°è¯•å¯¹ç§æœ‰é€šé“è¿›è¡Œé‰´å®šã€‚è¿™æ˜¯é€šè¿‡ä» Laravel åº”ç”¨ç¨‹åºè¯·æ±‚è®¿é—®æ¥å®Œæˆçš„ã€‚
2.  å¦‚æœè®¤è¯æˆåŠŸï¼Œå¥—æ¥å­—ä»¤ç‰Œè¢«å‘é€å› iOSã€‚
3.  ä½¿ç”¨å¥—æ¥å­—ä»¤ç‰Œï¼ŒiOS å¯ä»¥è®¢é˜… Pusher ä¸­çš„ç§æœ‰é€šé“ã€‚
4.  å¦‚æœ Laravel é€šè¿‡ç§æœ‰é€šé“å‘é€äº‹ä»¶ï¼ŒiOS èƒ½å¤Ÿæ¥æ”¶åˆ°å®ƒğŸ˜ƒ

è¿™çœ‹èµ·æ¥ç›¸å½“ç®€å•ï¼Œä½†æ˜¯è®¤è¯è¿‡ç¨‹æ¯”é¢„æœŸçš„è¦éš¾ä¸€äº›ã€‚ç”±äºæˆ‘æ‰¾ä¸åˆ°ä»»ä½•å…³äºå¦‚ä½•é€šè¿‡å®ç° oauth çš„ Laravel Passport è¿›è¡Œèº«ä»½éªŒè¯çš„å¥½æ•™ç¨‹ï¼Œæ‰€ä»¥æˆ‘æƒ³å†™ä¸€ä¸ªç®€å•çš„æ•™ç¨‹ã€‚

## è®¾ç½®æ¨åŠ¨å™¨

è¦ä½¿ç”¨ Pusher ä½œä¸ºå¹¿æ’­æœåŠ¡ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªå…è´¹è´¦æˆ·[ã€‚åœ¨ pusher ä¸­åˆ›å»ºä¸€ä¸ªåä¸º laravel-pusher çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºæˆåŠŸåˆ›å»ºæ—¶ï¼Œæ‚¨å°†ä½¿ç”¨å„ç§ä»£ç æ¥å®ç° Pusherã€‚æœå¯»ç€*ã€‚env* å®ç°ã€‚è®©å®ƒå¼€ç€ï¼Œå› ä¸ºæˆ‘ä»¬ä»¥åä¼šç”¨åˆ°å®ƒã€‚](https://dashboard.pusher.com/accounts/sign_up)

## è®¾ç½® Laravel

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ä¸€ä¸ªæ–°çš„ Laravel é¡¹ç›®:

```
$ composer create-project laravel/laravel laravel-pusher
```

è¿™å°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ–°çš„ laravel é¡¹ç›®çš„ç›®å½• laravel-pusherã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®‰è£… Laravel Passport å’Œ Pusher ä¾èµ–é¡¹:

```
$ composer require laravel/passport pusher/pusher-php-server
```

ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä¸ä¼šè§£é‡Š Laravel Passport çš„æ•´ä¸ªå®‰è£…è¿‡ç¨‹ï¼Œä½†æ˜¯è¿™é‡Œçš„[æ˜¯æ–‡æ¡£æä¾›çš„å®‰è£…æŒ‡å—ã€‚](https://laravel.com/docs/5.6/passport#installation)

å¦‚æœæˆ‘ä»¬æ•å¼€å¿ƒæ‰‰ã€‚æˆ‘ä»¬å°†çœ‹åˆ°å„ç§ç¯å¢ƒå˜é‡ã€‚æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„äº§å“å¦‚ä¸‹:

```
PUSHER_APP_ID=
PUSHER_APP_KEY=
PUSHER_APP_SECRET=
PUSHER_APP_CLUSTER=mt1
```

ç°åœ¨æˆ‘ä»¬å›åˆ° Pusher ç½‘ç«™ï¼Œä½ åº”è¯¥è¿˜åœ¨ä½ çš„æµè§ˆå™¨ä¸­ï¼Œå°†ä»£ç ä» Pusher å¤åˆ¶ç²˜è´´åˆ°ä½ çš„ã€‚ç¯å¢ƒæ–‡ä»¶ã€‚Pusher_APP_CLUSTER å˜é‡ä¸æ˜¯ç”± PUSHER æä¾›çš„ï¼Œè€Œæ˜¯å¡«å……æ‚¨åœ¨åˆ›å»º PUSHER åº”ç”¨ç¨‹åºæ—¶é€‰æ‹©çš„é›†ç¾¤ã€‚

å¦ä¸€ä¸ªé‡è¦æ­¥éª¤æ˜¯å°†`BROADCAST_DRIVER`è®¾ç½®ä¸º`pusher`ã€‚

å› ä¸º iOS å°†è¯·æ±‚è®¿é—®è®¢é˜… Pusherï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª HTTP è·¯ç”±æ¥å¤„ç†èº«ä»½éªŒè¯è¯·æ±‚ã€‚æˆ‘ä»¬å°†åœ¨ routes/api.php ä¸­åˆ›å»ºè·¯ç”±ã€‚

> å› ä¸ºè·¯ç”±æ”¾åœ¨ routes/api.php æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å®ƒä¼šè‡ªåŠ¨ä»¥/api ä½œä¸ºå‰ç¼€ã€‚å®Œæ•´è·¯å¾„å°†æ˜¯/api/broadcast/authã€‚

æ­¤è·¯ç”±æŒ‡å‘ä¸€ä¸ªå°šä¸å­˜åœ¨çš„æ§åˆ¶å™¨ã€‚åˆ›å»ºæ§åˆ¶å™¨:

```
php artisan make:controller Api\\BroadcastAuthController
```

è¿™å°†åœ¨ app\Http\Controllers å’Œæ§åˆ¶å™¨æœ¬èº«ä¸­åˆ›å»ºä¸€ä¸ªåä¸º Api çš„æ–‡ä»¶å¤¹ã€‚ä»¥ä¸‹æ–¹æ³•å°†é‰´å®šæ¥è‡ª iOS åº”ç”¨ç¨‹åºçš„è¯·æ±‚:

åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¼ å…¥é€šé“åå’Œå¥—æ¥å­— id ç›´æ¥è°ƒç”¨æ¨é€å™¨åº“ã€‚`socket_auth`æ–¹æ³•å°†åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ä»¤ç‰Œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å°†æ¥æ¥è‡ª iOS åº”ç”¨ç¨‹åºçš„è¯·æ±‚ä¸­ä½¿ç”¨å®ƒã€‚

## å‰ç«¯

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æ–‡æœ¬è¾“å…¥æ¥å‘é€æ¶ˆæ¯ç»™ Pusherã€‚

![](img/20a15386dff9a56275abc44d26e765f8.png)

Enter a message to submit

ç»§ç»­åˆ›å»ºä¸€ä¸ªæ¼‚äº®çš„ä¸»é¢˜ç½‘é¡µæˆ–å°†æˆ‘çš„è¡¨å• HTML å¤åˆ¶åˆ°ä½ çš„`welcome.blade.php`

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨ web.php ä¸­åˆ›å»ºæˆ‘ä»¬åœ¨ä¸Šé¢çš„ HTML ä¸­å¼•ç”¨çš„è·¯ç”±:

å½“å‘å¸ƒåˆ°`/broadcasting`æ—¶ï¼Œæˆ‘ä»¬å°†å‘é€ä¸€ä¸ªå¸¦æœ‰è¾“å…¥æ–‡æœ¬çš„äº‹ä»¶ã€‚è¦å‘ Laravel å‘é€äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ­¤åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç±»:

```
php artisan make:event SendMessage
```

åœ¨è¿™ä¸ªäº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†è®¾ç½®ä¸€ä¸ªåä¸º`$message`çš„ç±»å˜é‡ï¼Œè¯¥å˜é‡å¯ç”¨äº iOS åº”ç”¨ç¨‹åºã€‚è®°ä½ï¼ŒLaravel äº‹ä»¶ä¸­çš„æ‰€æœ‰`public`å˜é‡å¯¹äºæ­£åœ¨ç›‘å¬äº‹ä»¶çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯å¯ç”¨çš„ã€‚è¯¾ç¨‹çš„å†…å®¹å°†æ˜¯:

è¿™å°†åœ¨é€šé“`messages`ä¸­å‘é€ä¸€ä¸ªåä¸º`message.sent`çš„äº‹ä»¶ã€‚æ¶ˆæ¯çš„å†…å®¹å¯ä»¥åœ¨`$message`å˜é‡ä¸­æ‰¾åˆ°ã€‚

> æ‰“å¼€ Pusher ä»ªè¡¨ç›˜ä¸­çš„è°ƒè¯•æ§åˆ¶å°ï¼Œæµ‹è¯•æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼

![](img/c86673ea1e53609b6473e9d9fff27c49.png)

Pusher dashboard

è¿™æ˜¯æˆ‘ä»¬å°†è¦æ„å»ºä¸¤ä¸ªå¯ä»¥é€šè¿‡ websockets ç›¸äº’é€šä¿¡çš„åº”ç”¨ç¨‹åºç³»åˆ—çš„ç¬¬ 1 éƒ¨åˆ†ã€‚è¿™é‡Œçš„é‡ç‚¹æ˜¯é€šè¿‡ Laravel Passport è¿›è¡Œè®¤è¯ã€‚ä½ å¯ä»¥åœ¨ [GitHub](https://github.com/mratiebatie/laravel-pusher) ä¸Šæ‰¾åˆ°æœ¬æ•™ç¨‹çš„æ‰€æœ‰ä»£ç ã€‚

**Sjors van Dongen æ˜¯ä¸€ä½è·å…°äººï¼Œå¯¹å‘å±•ã€åˆ›ä¸šå’Œä¸ªäººæˆé•¿å……æ»¡çƒ­æƒ…ã€‚ä»–ç›®å‰æ­£åœ¨ä¸ºä»–çš„æ•°å­—è®¿å®¢æ³¨å†Œè½¯ä»¶** [**å·¥ä½œ**](https://incheckert.nl)