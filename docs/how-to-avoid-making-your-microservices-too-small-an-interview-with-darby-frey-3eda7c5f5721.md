# 如何避免让你的微服务变得太小:达比·弗雷访谈

> 原文：<https://medium.com/hackernoon/how-to-avoid-making-your-microservices-too-small-an-interview-with-darby-frey-3eda7c5f5721>

*这次采访是为我们的* [*创业微服务*](https://buttercms.com/books/microservices-for-startups/) *电子书做的。一定要去看看关于微服务的实用建议。*

![](img/cdd02af64204226c3798628068bbe4b4.png)

Darby Frey

[*达比弗雷*](https://twitter.com/darbyfrey) *是* [*色域*](https://www.gamut.com/) *的高级工程主管—平台。Gamut 专注于快速交付工业产品，并为客户提供快速搜索引擎，使客户能够快速识别正确的产品。*

对于上下文，您的工程团队有多大？

我们的工程团队目前大约有 30 人，但我们在今年开始时不到 10 人，所以我们在这一年里已经显著地扩大了团队。

**你是从整体开始，后来采用微服务的吗？**

当我们开始时，我们有意识地决定不建造一个整体。基于以前公司的经验，预期的规模，以及我们认为给定我们的母公司我们将走向哪里。我们可以想象这样的场景，我们会很快从一个庞然大物中成长出来，最终不得不拆开我们刚刚建造的东西。

因此，我们决定从一些较大的服务开始，而不是许多微服务。这迫使我们从不同的角度考虑基础设施和部署，而不是从一个整体开始。因此，我们不仅构建了我们的服务，还专注于构建 API 网关、CI/CD 管道和所有相关基础设施，以部署多种应用。

作为一个团队/工程组织，你是如何处理微服务这个话题的？

当我们开始的时候，团队中的许多人都有一些关于服务架构的经验，我认为这真的很有帮助。每个人都有类似这样的故事，“是的，我们以前在这里搞砸了，我不想再做一次。”

我们都从第一次经历中学到了东西，所以当再次经历时，我们都有了更多的信息。要知道这样做需要很大的基础设施成本，而且我们不能忽视部署多个应用程序所涉及的工作量。然后，围绕如何创建服务之间的依赖关系存在一些问题。非常紧密耦合的服务意味着你不能在一个服务中做任何事情，除非另一个服务可用，这使得本地开发具有挑战性，并且使得隔离你正在工作的东西变得困难。我们已经经历了许多这样的问题，所以它为我们围绕如何构建服务制定的规则提供了信息。

为了应对采用微服务，您是否改变了团队的组织或运营方式？

“一个团队负责一个特定的服务”的模式是你在服务架构中经常看到的。我们不这么做，有几个原因:

主要的商业原因是我们希望团队不负责特定的代码，而是负责面向客户的特性。一个团队可能负责订单处理，因此会涉及多个代码库，但业务的最终结果是有一个团队拥有端到端的所有东西，因此事情失败的可能性更小。另一个主要原因是，我认为人们可以通过这种方式对某个功能或业务的一部分拥有更多所有权。他们实际上可以从整体上考虑这个问题。

**在技术选择上有多少自由？你们是否都同意坚持使用一个堆栈，或者是否有尝试新堆栈的灵活性？你是如何做出那个决定的？**

在我的上一家公司，我们有很多服务和一个相当小的团队，让它工作的主要因素之一，特别是对于我们的团队规模来说，是每个应用程序都是一样的。每个后端服务都是一个 Ruby 应用。它有相同的测试框架，相同的数据库后端，相同的后台作业处理工具，相同的消息总线。一切都是一样的，所以当一个工程师在应用程序之间跳来跳去时，他们不必每次都学习一种新的模式或学习一种不同的语言。所以我们非常清楚并非常严格地保持这种共性。

不时有人想要引入一种新的语言，我喜欢尝试新事物的想法，但是拥有多语言架构会增加开发和维护成本。如果一切都一样，您可以专注于业务价值和业务特性，而不必过于局限于服务的运营方式。

> *我不认为每个人都喜欢这个决定，但是当一天结束的时候，当他们不得不在周末或半夜修理东西的时候，他们会很感激。*

**你如何确定服务边界？**

归根结底，数据才是最重要的。

> 如果你需要频繁地连接数据库中的两个表，那么这两个表应该相邻。如果访问模式不太频繁，那么这可能是分离的候选。

表 A 需要一直知道表 B 里有什么吗？如果是这样的话，就把它们放在同一个服务中，否则你就要通过网络请求来获取这些数据，这会带来一系列新的挑战。如果不是这样，如果表 A 做自己的事情，表 B 也可以做同样的事情，然后他们可能会经常在一起，那么这些可能是独立的服务。

**你们团队内部的讨论是怎样的？**

当更大的功能出现时，我们会停下来进行对话。我们讨论了数据需求和预期的访问模式。我们查看我们现有的服务，并尝试确定新功能是否会在一个或多个地方出现，或者是否应该是它自己的东西，并尝试从那里进行调用。

**你从尺码服务中学到了什么？**

> 你绝对可以把它们做得太小。这可能是我最不同意许多微服务方法的地方。

我听说每个服务应该只有一个数据库表，并且应该尽可能小，或者只有一个 API 端点之类的事情。这又回到了 Unix 的极简程序哲学，您可以将它们链接在一起做事情。我看到了这种方法，也看到了它如何在单台机器上工作，但是当您实际上必须建立基础架构来支持它时，它会变得更加耗时和昂贵。

从操作上来说，每个应用程序都需要将其日志聚集在某个地方，并需要被监控和发出警报。你需要有标准的操作程序和操作手册，以备出现故障时使用。您必须管理 SSH 访问，等等。一个应用程序要运行，必须要有一个巨大的基础。如果您是为一个表和一个 API 端点这样做，成本可能会非常高。所以我认为他们比那要大得多。

但是我也考虑如何在一个代码库中保存一个事物的上下文。这又回到了我们之前讨论过的边界。这些数据是对自身进行操作，还是可以孤立存在？也许那个东西可以孤立存在，它只是一张不需要其他东西的桌子。但如果它的访问模式也很低，如果它一天被攻击三次，那么花费运营精力让它成为自己的东西就没有意义了。

**微服务对您的开发和运营流程有何影响？**

拥有多个服务无疑增加了团队构建特性的复杂性。为了帮助实现这一点，我们构建了一个自主开发的服务运行器类型的工具，它将为您完成所有的腿部工作，以获取所有的代码，安装依赖项，创建和播种数据库，然后以预先确定的方式启动所有的服务。因此，您只需运行一个命令，就可以获得所需的一切。

这个工作起来很不错，但是花了一些时间来构建，这是我们必须做出的投资来支持这个架构。还有持续的维护成本。随着架构的变化，我们需要保持工具的同步。

**微服务对您的测试方式有何影响？**

测试微服务并不容易。在 monolith 中，你只需旋转应用程序并运行测试，你就很棒了。建立一个允许您进行测试的环境肯定需要付出更多的努力。当你决定这是否应该是另一个自己的服务时，这是你必须考虑的另一个因素。

我们想要运行多少服务？因为这意味着不仅要在生产和试运行中运行，还要将其添加到测试环境中。设置它、获得正确的数据种子等工作变得更加繁重。但不管你愿不愿意，它确实迫使你做的事情是为它建立一个非常健壮的自动化过程。

如果没有这一点，您就无法做到这一点，并且您会进入一种对部署没有信心的状态，因为您不确定部署服务 A 是否会破坏服务 b 中的某些东西。采用服务方法是有成本的，但它给你的结果是一个更稳定、更持久的系统。

**微服务对安全性和控制数据访问有何影响？**

拥有更多服务意味着拥有更多潜在安全风险的表面积。这迫使我们变得更加全面，迫使我们创建自动系统来扫描漏洞或潜在的利用。这也迫使我们围绕访问控制创建更严格的策略和审计。最终，我们无论如何都希望所有这些系统都到位。如果我们一开始就建立一个整体，我们可能会推迟一些，但服务迫使我们这样开始。

*再次感谢 Darby 的时间和投入！这次采访是为我们的* [*创业微服务*](https://buttercms.com/books/microservices-for-startups/) *电子书做的。一定要去看看关于微服务的实用建议。*

*最初发表于*[*【buttercms.com】*](https://buttercms.com/blog/microservices-for-startups-an-interview-with-darby-frey-of-gamut)*。更多类似这样的内容，在 Twitter 上关注*[*ButterCMS*](https://twitter.com/ButterCMS)*并订阅我们的* [*博客*](https://buttercms.com/blog/) *。*