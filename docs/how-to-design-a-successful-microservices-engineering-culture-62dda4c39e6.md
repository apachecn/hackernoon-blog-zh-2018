# 如何设计成功的微服务工程文化

> 原文：<https://medium.com/hackernoon/how-to-design-a-successful-microservices-engineering-culture-62dda4c39e6>

回想我和 Java 开发人员一起工作的时候，我记得在谁来开发最新最丰富的特性的问题上，阵营内部有一种紧张的来源。我们的工程领导层已经决定，我们将专门使用 Java 来构建所有新的微服务。

这个决定有很好的理由，但是——我将在本章后面解释——这样一个限制性的决定也带来了一些影响。请注意，在可能的范围内，向团队传达技术决策的 *why* 可以大大有助于创建一种文化，在这种文化中，人们被保持在循环中。

当谈到围绕微服务组织和管理团队时，平衡团队的情绪、士气和整体文化总是具有挑战性。在大多数情况下，领导层需要平衡团队成员使用新技术的风险与客户和业务本身的需求。

这种困境，以及许多其他类似的困境，已经导致 CTO 问自己这样的问题:当采用新技术时，我应该给我的团队多大的自由？或许更重要的是，我如何管理我的团队中的总体文化？

我们向专家寻求一些指导。

# 稳定性与灵活性

假设你雇佣了一个新的初级开发人员。他们可能会对一些全新的刚出版的 [JavaScript 框架](https://en.wikipedia.org/wiki/List_of_JavaScript_libraries)感到兴奋。几乎*太*新。

该框架虽然取得了一些技术突破，但可能还没有在生产环境中证明自己，并且很可能没有很好的支持。首席技术官们面临着艰难的选择，要么为了团队的士气和激情而同意这一举措，要么为了维护公司的需求、保护公司的底线以及在截止日期临近时保持项目稳定而拒绝这一举措。

正确的答案取决于很多不同的因素，这也意味着没有正确的答案。

“在考虑技术选择时，我们给予我们的团队和我们自己 100%的自由。Honeybadger 的联合创始人本杰明·柯蒂斯(Benjamin Curtis)在我们的采访中说:“我们最终确定了两到三项最终不使用的技术，主要是因为不想让我们的部署故事变得复杂。

“换句话说，在创建我们的微服务时，我们考虑将新语言和新方法引入我们的技术堆栈，我们实际上在一个不同的堆栈上部署了一个生产微服务。[虽然我们通常]坚持使用我们了解的技术，以简化我们的运营堆栈，但我们会定期重新审视这一决定，看看采用新技术是否会带来潜在的性能或可靠性优势，但迄今为止我们尚未做出改变，”柯蒂斯继续说道。

当我与 pub nub 的首席技术官 Stephen Blum 交谈时，他也表达了类似的观点，支持欢迎几乎所有能解决问题的技术:

“我们对此完全开放。Blum 说:“我们希望继续推进可用的新开源技术，我们对团队只有几个非常公平的限制:必须在容器环境中运行，并且必须具有成本效益。”。

另一方面，[Lead honest 的联合创始人达比·弗雷(Darby Frey)对技术选择采取了更严格的方法。](https://buttercms.com/blog/microservices-for-startups-an-interview-with-darby-frey-of-gamut)

“在我的上一家公司，我们有很多服务和一个相当小的团队，让它工作的主要因素之一，特别是对于我们的团队规模来说，是每个应用程序都是一样的。每一个后端服务都是一个 Ruby 应用，”他解释道。

Frey 告诉我这如何帮助简化了他的团队的生活，因为每个服务都有，“相同的测试框架，相同的数据库后端，相同的后台作业处理工具，等等。一切都是一样的。”

“这意味着，当工程师在应用程序之间切换时，他们不必每次都学习新的模式或不同的语言。所以我们非常清楚并非常严格地保持这种共性，”弗雷说。

与此同时，Frey 对开发者想要引入一种新语言的想法表示同情，承认他“喜欢尝试新事物的想法”。然而，他觉得弊大于利。

“拥有多语言架构会增加开发和维护成本。如果一切都一样，您可以专注于业务价值和业务特性，而不必过于局限于服务的运营方式。我不认为每个人都喜欢这个决定，但当一天结束时，他们不得不在周末或半夜修理东西，他们会很感激，”弗雷说。

# 给每个团队成员一个发展的机会

让我们从本章开始重温我的故事。如果你还记得的话，工程领导者认为 Java 是构建微服务时最好的技术。Java 是高性能的，我们团队中的许多高级人员都精通它，所以这就是我们选择 Java 的原因。然而，并不是团队中的每个人都有 Java 经验。

问题是，我们的团队分成了两个阵营:Java 团队和 JavaScript 团队。随着时间的推移，新的令人兴奋的项目出现了，我们总是用 Java 来完成工作。不久，JavaScript 阵营内部出现了一些烦恼。

“为什么 Java 开发人员总是去做令人兴奋的新项目，而我们却被留下来做诸如实现第三方分析工具之类的普通前端任务？我们也想要一个令人兴奋的大项目！”

像大多数裂缝一样，它开始很小，但随着时间的推移越来越严重。

我从那次经历中得到的教训是，在为您的微服务选择事实上的技术堆栈时，以及在调整您给团队挑选和选择工具的自由度时，要考虑到您团队的专业知识和喜欢的技术。

当然，你需要有一些结构，但是如果你限制太多，或者更糟糕的是，无视团队成员用不同技术创新的愿望，你可能会有自己的裂缝需要管理。

所以，仔细评估你的团队，想出一个让团队中每个人都有能力的计划。这样，你团队的每个部分都可以参与到主要项目中，可以说，没有人会觉得他们被留在了板凳上。

# 团队组织的问题

你的团队结构也将影响你的微服务工程文化——或好或坏。

例如，软件工程师通常在将代码发送给运营团队之前编写代码，运营团队再将代码部署到服务器上。但是当事情发生时(事情总是会发生！)，发生内部冲突。

因为运营工程师自己不写代码，所以他们很少能在问题刚出现的时候理解问题。因此，他们必须与编写代码的人——软件工程师——取得联系。因此，从一开始，您就有一个中间人在问题和可以解决问题的团队之间传递消息。

更复杂的是，因为软件工程师不参与操作，他们通常不能完全理解他们的代码如何影响平台的整体操作。只有当运营工程师抱怨时，他们才知道任何问题。如你所见，这是一段注定会不断冲突的关系。

解决这个问题的一个方法是效仿网飞和亚马逊，这两家公司都支持分权治理。詹姆斯·刘易斯和马丁·福勒，两位软件开发思想领袖，通过一篇冗长的博客文章展示了他们的想法。根据他们的观点，分散治理是微服务团队组织的发展方向。

“集中治理的后果之一是倾向于在单一技术平台上实现标准化。经验表明，这种方法是有局限性的——不是每个问题都是钉子，也不是每个解决方案都是锤子，”文章写道。

“也许去中心化治理的顶点是亚马逊推广的‘建立它，运行它’的精神。团队对他们构建的软件的所有方面负责，包括 24/7 运行软件，”它继续说道。

Lewis 和 Fowler 写道，网飞是另一家在开发团队中推行更高级别的责任的公司。他们假设，因为他们将负责并在以后出现任何问题时被调用，所以在开发和测试阶段将更加小心，以确保每个微服务都处于良好状态。

“这些想法与传统的中央集权治理模式相去甚远，”他们总结道。

# 高度自由、高度负责的概念

在我与 Sumo Logic 首席技术官 Christian Beedgen 和首席架构师 Stefan Zier 的访谈中，他们就此话题展开了讨论，进一步强调了这样一个观点，即如果要让开发者自由选择他们的技术，就必须附带高度的责任感。

“软件(无论是谁开发的)都必须完全拥有它，这一点非常重要。换句话说，他们不仅构建软件，还运行软件，并对整个生命周期负责，”他们说。

他们接着解释说，应该建立一个类似于联邦政府系统的系统，通过加强责任来帮助控制这些自由。

“[你真的需要]一种联邦文化。你必须有一个系统，在这个系统中，多个独立的团队可以为了更大的目标而走到一起。这在某种程度上限制了这些单位的独立性，因为它们必须同意潜在地存在某种形式的联邦政府。但在那些较小的群体中，他们可以在更高层次上建立的指导原则范围内自己做尽可能多的决定，”他说。

分散的、联邦的，或者无论你想怎么组织，看起来都是构建微服务团队的一个有吸引力的方法。这是一种给每个团队和每个团队成员他们想要的自由的方法——没有给任何人将整个项目撕裂的自由。

但并不是所有人都同意。

# 谁会在周末收到传呼？

你看，一个分散的系统意味着每个分散的团队负责一个服务，或者一组服务。但是这也产生了一个问题；筒仓。

这也是 Darby Frey，诚实领导的联合创始人，不支持分权治理概念的一个原因。

“在微服务架构中，你会经常看到‘一个团队负责一项特定服务’的模式。我们不这么做，有几个原因。主要的商业原因是，我们希望团队不负责特定的代码，而是负责面向客户的特性。一个团队可能负责订单处理，因此会涉及多个代码库，但业务的最终结果是有一个团队端到端地拥有整个事情，因此事情失败的可能性更小，”Frey 解释道。

他继续说，另一个主要原因是开发商可以对整个项目拥有更多的所有权:

“他们实际上可以全面地考虑[这个项目]，”弗雷说。

Nathan Peck，Amazon Web Services 容器服务的开发者倡导者，[更深入地解释了这个问题。本质上，当你将软件工程师和操作工程师分开时，无论何时代码出现问题，你都会让你的团队的日子更难过——这对最终用户来说也是坏消息。](/@nathankpeck/microservice-principles-decentralized-governance-4cdbde2ff6ca)

但我是这么想的。去中心化需要导致分离和孤岛化吗？

Peck 继续解释说，他的解决方案在于 DevOps，这是一种旨在通过拉近这两个团队的距离，加强团队文化和沟通来收紧反馈回路的模型。Peck 将此描述为“你构建它，你运行它”的方法。

然而，这并不意味着团队必须孤立或远离参与某些任务，正如 Frey 所建议的那样。

佩克写道:“去中心化治理最有力的方法之一是建立一种‘devo PS’的心态。”。“[使用这种方法]，工程师参与软件管道的所有部分:编写代码、构建代码、部署最终产品，以及在生产中操作和监控它。DevOps 的方式与旧的将开发团队与运营团队分开的模式形成了对比，它让开发团队将代码“越过墙”传送给运营团队，然后运营团队负责运行和维护它。”

正如[军械库首席技术官 Isaac Mosquera 解释的那样](https://buttercms.com/blog/microservices-for-startups-an-interview-with-isaac-mosquera-of-armory)，DevOps 是一种敏捷软件开发框架和文化，这得益于——嗯，几乎是 Peck 所说的一切。

有趣的是，莫斯克拉认为这种方法实际上违背了康威定律:

> “设计系统的组织……不得不生产这些组织的通信结构的复制品。”— M .康韦

“现在软件架构驱动通信，而不是通信驱动软件设计。不仅团队以不同的方式运作和组织，而且需要一套新的工具和流程来支持这种类型的架构，即 DevOps，”Mosquera 解释道。

工程 SparkPost 副总裁克里斯·麦克法登有一个有趣的例子，也许值得一试。在 SparkPost，你会发现分散治理——但你不会发现一个团队一项服务的文化。

“开发这些微服务的团队最初是一个团队，但现在他们分成了三个团队，隶属于同一个更大的团队。麦克法登说:“每个团队在某些领域和某些专业知识方面都有一定程度的责任，但这些服务的所有权并不局限于其中任何一个团队。

麦克法登解释说，这种方法允许任何团队从事任何工作，从新功能到 bug 修复，再到与这些服务相关的生产问题。这是完全灵活的，看不到筒仓。

“这使得(团队)在新产品开发方面更加灵活，因为你不会受到太多限制，这是基于我们作为公司和工程团队的规模。我们真的需要保留一些灵活性，”他继续说道。

然而，规模在这里可能很重要，因为麦克法登承认，如果 SparkPost 大得多，“那么让一个更大的团队拥有其中一个微服务就更有意义了。”

“[我认为]对这些服务承担更广泛的责任会更好，这给了你更多的灵活性。至少在这个时候这对我们有用，我们是一个组织，”他说。

另一方面，Pusher 的工程副总裁 Sam Stagg 采用了 Conway 的方法——选择让团队在项目的不同领域工作:

“我们曾试图组织我们的团队来利用康威定律。因此，我们有一个小团队为平台构建核心共享服务，而支持特定产品的服务由构建产品的团队来构建，”Stagg 说。

# 成功的微服务工程文化需要微妙的平衡

说到技术，自由——伴随着责任——看起来是最有回报的途径。拥有不同技术偏好的团队成员会来来去去，而新的挑战可能需要你放弃以前对你很有用的技术。软件开发是不断变化的，所以当新的设备、技术和客户出现时，你需要不断地平衡你的团队的需求。

至于构建你的团队，一个分散的，但非孤立的方法，利用 DevOps 并灌输“你构建它，你运行它”的思想，似乎很受欢迎，尽管也存在其他的思想流派。像往常一样，你将不得不进行试验，看看什么最适合你的团队。

以下是如何确保您的团队文化与微服务架构完美融合的快速回顾:

*   **保持可持续性，同时保持灵活性:**平衡可持续性，不要忘记灵活性，以及当合适的机会到来时，你的团队需要创新。然而，对于如何实现这种平衡，存在明显的意见分歧。
*   **给予平等的机会:**不要偏袒团队中的某一部分。如果你要施加限制，确保它不会从一开始就疏远团队成员。思考你的产品路线图是如何形成的，并预测它将如何构建，以及谁来做这项工作。
*   **让你的团队变得敏捷而有责任感:**分散治理和敏捷开发是当今的潮流，这是有充分理由的，但是不要忘记在每个团队中树立责任感。

*感谢以下个人对本章的贡献:* [*本·柯蒂斯*](https://twitter.com/stympy?lang=en)*[*斯蒂芬·布鲁姆*](https://twitter.com/stephenlb?lang=en)*[*达比·弗雷*](https://twitter.com/darbyfrey)*[*克里斯蒂安·比根*](https://twitter.com/raychaser)*[*斯蒂芬·齐尔*](https://twitter.com/stefanzier)****

***最初发表于*[*【buttercms.com】*](https://buttercms.com/books/microservices-for-startups/designing-a-successful-microservices-engineering-culture)*。***