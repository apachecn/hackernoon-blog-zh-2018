# 如果你在考虑 MVP 的微服务，你可能做错了

> 原文：<https://medium.com/hackernoon/if-youre-thinking-about-microservices-for-an-mvp-you-re-probably-doing-it-wrong-6fef8341fce4>

这源于菲律宾科技黑客 [Slack](https://slack.com/) 小组(或 [Phackers](https://github.com/phackers) )的一段对话。在我们的#architecture 频道中有一个关于使用微服务启动 MVP 的问题，这引发了一场关于何时使用或不使用微服务的讨论。

![](img/ac99bf2c88b6a8387c6c0701b128f685.png)

“Stacks of shipping containers in the Port of Barcelona” by [Igor Ovsyannykov](https://unsplash.com/@igorovsyannykov?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

微服务“运动”是相当新的— [Martin Fowler 将其描述为“2014 年的热门词汇”](https://martinfowler.com/microservices/)。从它的基本定义来看，它是一堆小应用程序组合在一起形成一个复杂的应用程序(当然我们都知道它比这要复杂得多，但为了简单起见，我将使用它)。

回到讨论上来——有人问走微服务路线**获得 MVP** 是否是个好主意。需要明确的是，这一讨论源于他们正在从头开始构建服务，并且计划使用微服务来实现这一点。那个人质疑首先使用微服务是否是正确的决定，主要原因是未来的可扩展性。

很多人都同意这一点，但没有好的理由让微服务先行。以下是主要原因:

# **太复杂，无法从**开始

如果你正在构建一个 [**最小可行产品**](https://en.wikipedia.org/wiki/Minimum_viable_product) **，**最高效最快的方法就是最短路径——阻力最小的路径。现在，你可以说微服务很容易创建，因为你将创建更小的部分，但是考虑集成。这意味着你要将你的每项任务乘以你的服务数量。例如，如果您计划创建 5 个微服务，您将构建 5 个独立的测试套件、部署脚本和存储库，更不用说您还将监控所有 5 个。如果你不打算这么做，那么你就做错了微服务，应该选择 monolith。

另一件事是当规格改变时。我们都经历过(或者你将会！)—你正在用写好的规范启动一个绿色领域的应用程序，突然，规范发生了变化。每个人都争相改变它，一切都很好。除非你使用微服务。对于微服务，每个更改都需要传播到使用它的另一个服务，这就引出了下一点:

# **团队管理会很难**

让我们从一个小团队开始。想象 5 个人各自做自己的服务。整合它们在一开始将是一场噩梦。你会如何谈论一个仍然由你团队中的某个人构建的服务？你最多可以假设某些输入(或输出)，但仅此而已。还记得我上面提到的规格变化吗？每一次改变都意味着你将在开发的同时不断改变你的[契约](https://docs.pact.io/)和 API，这会成倍地增加花费的时间。

![](img/9cdf05ce5f2a23d16b77cd0a4740766f.png)

When pacts are broken, fights break out! Photo by [CloudVisual](https://unsplash.com/@cloudvisual?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

好吧，你的团队很大。事情并没有变得更简单，现在你要管理四倍多的人。当你有一个明确而直截了当的目标时，这一切都很好——比方说，当将现有的整体结构分解为微服务时，但从它开始？这意味着每次有变化时，你都需要更新所有的 20 个人。同样，规格在开发过程中多久改变一次？

# 这是过早的优化

我们都知道这个术语。基本上是优化，不需要测量任何东西，例如“我认为我们会有大量的流量，所以我们需要微服务”。首先，单片也可以很好地扩展(有些甚至比微服务更容易做到)。第二，这是基于推测，通常当我们优化时，我们基于现有的测量。请注意，过早的优化和为快速和可伸缩的架构做准备是有区别的。不过在我看来，作为 MVP，monolith 可以像微服务一样轻松扩展，所以以快速和可扩展为唯一理由走微服务路线*几乎毫无意义。*

*还有很多原因，包括链接到[马丁·福勒的“Monolith First”文章](https://martinfowler.com/bliki/MonolithFirst.html)，这篇文章比我能说的更有深度。如果你还没有，请读一读，重新考虑你的决定。就个人而言，我认为 95%的情况下，正确的选择是 MVP 的整体(再次强调，具体问题是 MVP)。MVP 和最终产品之间有着巨大的差异。如果你打算一开始就推出一个最终的、经过打磨的产品(而且你有时间和资源)，微服务可能不是一个坏主意。真的取决于你的目标、时间和预算。我假定剩下的 5%的可能性是，在某个地方，微服务是 MVP 的答案。*

*至此，我将分享过去几年中关于微服务的两个亲身经历。我的第一次经历是在我现在的公司，在那里我们开发了一个史诗般的功能，这应该是我们的旗舰产品。这是我的第一个项目，我们已经讨论了一个月(有点太久了！)关于如何正确地做到这一点。*

*我们已经初步讨论了这个微服务。在此之前，我们所有的功能都托管在一个巨大的 Rails 3 平台下。我们深思熟虑了很久，我们都相信微服务是最好的选择。在我们开始之前的两天多一点，我的老板改变了主意，并提到去 monolith 可能仍然是一个好主意。*

*首先，这意味着我们只需要监控站点(就像我的第一点)。第二，这也意味着我们不会处理任何新的技术或堆栈，只是增加我们当前的 Rails 堆栈。最后，我们在为变化做准备——我们知道在所有事情都在实施的时候会有很多变化，所以我们选择了 monolith。*

*这是个好决定。曾经有一段时间，人们争论生日字段应该放在哪里。移动它并不简单:我们必须将它移动到另一个资源中，检查测试，并修复所有的集成测试。生日字段在开发期间(发布前)至少更改了三次，在发布后可能还会更改几次。想象一下，如果有一个微服务，每当有人想把这个领域移到某个地方，我们就会改变这两个应用程序！*

*![](img/3d88c981a863c3b286e47ef149d6cdbc.png)*

*What about monolithic microservices?! (“Clouds over iconic Stonehenge rock formations” by [Inja Pavlić](https://unsplash.com/@inja_jeki?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral))*

*我的第二次经历更近一些。我志愿参加了一个名为 [FLOW PERTH](http://www.flowperth.org/) 的活动，这个项目是为了帮助[同谋](https://www.cahoots.org.au/)，这是一个帮助残疾儿童和年轻人的非营利组织。据我统计，大概有 30 多名志愿者，所以计划是分成小组，然后帮助一名员工完成他们的任务(通过提供服务或其他方式)或网站的另一部分。*

*现在考虑到这个问题，任何人都会首先想到微服务。为什么？有多个独立的团队。团队 A 不需要团队 b 的任何重要东西，但是每个项目都将被整合到现有的站点中。此外，每个团队都有不同层次的经验和语言(有些人知道 Rails、Node 或 Java)。*

*我们都应该在一天内完成这项工作，就像黑客马拉松一样——这很好，除了我认为我们都非常乐观(我非常乐意成为志愿者，我认为其他人也是如此！)导致承诺过多。当把它们整合在一起的时候，一切都变得不连贯了。每个部分本身都很好，但是 UI/UX 就是不存在。我们有一个 styleguide(我的任务是做前端)，但是跳到每个项目的不同实现是一场噩梦。一个是带有 angular 和 Typescript 的节点应用。另一个只是一个简单的带有 jQuery 的 HTML/CSS 应用程序——即使有统一的样式指南，将 CSS 复制到每个应用程序也是低效的。*

*这让我们把所有东西都融合成一个整体。现在一切都更容易了，UI/UX 也一样。我们只需要选择一种大多数人都知道的通用语言(node)就可以了。*

*我认识一些开发者，他们就是爱微服务。我是其中之一。它们很容易实现和使用，但是对于一个 MVP 来说，它真的不是合适的工具。即使这样，总是想着你在建造什么也是很棒的。思考，反思，再反思一些。问问自己“为什么？”至少五次。即便如此，质疑你的决定——你真的认为微服务是答案，还是仅仅因为你想使用它？你正在决定一个时髦的词，或者一个独石不能解决的问题的解决方案吗？*