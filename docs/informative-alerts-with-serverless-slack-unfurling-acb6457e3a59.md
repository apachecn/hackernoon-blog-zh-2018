# æ— æœåŠ¡å™¨æ¾å¼›å±•å¼€çš„ä¿¡æ¯è­¦æŠ¥

> åŸæ–‡ï¼š<https://medium.com/hackernoon/informative-alerts-with-serverless-slack-unfurling-acb6457e3a59>

## äº†è§£å¦‚ä½•ä½¿ç”¨ Node.jsã€Serverless.js å’Œ AWS Lambda å°†é‡è¦ä¿¡æ¯é™„åŠ åˆ°æ¾å¼›æ¶ˆæ¯ä¸­

![](img/cc1e9c347ef82eab1d26b038937a01d6.png)

å½“ä½ å¤åˆ¶å’Œç²˜è´´ä¸€ä¸ªé“¾æ¥æ—¶,ä¼šæ˜¾ç¤ºå¤§é‡çš„ç»†èŠ‚ã€‚ç»§ç»­ç²˜è´´[ä¸€ä¸ªæ¥è‡ªåª’ä½“](https://engineering.opsgenie.com/4-advantages-of-using-java-with-aws-lambda-21c0dc539de3)çš„é“¾æ¥ã€‚æ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

![](img/5c7eeea02271440e0f1c19247cbc2a23.png)

Slack attaches details to your messages. This is called unfurling.

è¿™åœ¨ Slack ä¸­è¢«ç§°ä¸ºâ€œé“¾æ¥å±•å¼€â€ã€‚å¯¹äºä¸€äº›æ¶ˆæ¯ï¼ŒSlack ä¼šè‡ªåŠ¨å®Œæˆè¿™é¡¹å·¥ä½œ(ç»å…¸çš„å±•å¼€)ï¼Œå¹¶é™„ä¸Šä¸€äº›éå¸¸æ¼‚äº®çš„ç»†èŠ‚ï¼Œæ¯”å¦‚â€œé˜…è¯»æ—¶é—´â€ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œä½ ä¹Ÿå¯ä»¥è¿™æ ·åšä½ çš„é“¾æ¥ï¼å½“æ‚¨éœ€è¦æ›´å¤šä¿¡æ¯æˆ–éœ€è¦ä»éœ€è¦ç”¨æˆ·æ‰¹å‡†/èº«ä»½éªŒè¯çš„å—ä¿æŠ¤æºä¸­æ£€ç´¢æ•°æ®æ—¶ï¼Œè¿™å°¤å…¶æœ‰ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦ç¨å¾®åŠ¨æ‰‹ï¼Œæ„å»ºè‡ªå·±çš„ Slack åº”ç”¨ç¨‹åºã€‚

åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæ‚¨å°†é€šè¿‡ä¸€ä¸ªçœŸå®çš„ä¾‹å­ä¸€æ­¥ä¸€æ­¥åœ°å­¦ä¹ å¦‚ä½•æ„å»ºè‡ªå·±çš„ Slack å±•å¼€åº”ç”¨ç¨‹åºã€‚å½“æ‚¨å…±äº« OpsGenie è­¦æŠ¥çš„é“¾æ¥æ—¶ï¼Œæˆ‘ä»¬ä¼šå°†è¯¦ç»†ä¿¡æ¯é™„åŠ åˆ°æ‚¨çš„ OpsGenie è­¦æŠ¥ä¸­ã€‚

å¯¹äºé‚£äº›ä¸ç†Ÿæ‚‰çš„äººæ¥è¯´ï¼Œ [OpsGenie](https://www.opsgenie.com/?utm_source=medium&utm_medium=hackernoon) æ˜¯ä¸€æ¬¾é¢å‘ DevOps å’Œ ITOps å›¢é˜Ÿçš„äº‹ä»¶å’Œéšå«éšåˆ°ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å°†åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨ OpsGenieï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä½¿ç”¨å®ƒçš„é›†æˆå’Œ API çš„ç»éªŒã€‚æˆ‘ä»¬è¿˜è®¤ä¸ºï¼Œå½“æ‚¨å¤åˆ¶å’Œç²˜è´´é“¾æ¥æ—¶ï¼ŒæŸ¥çœ‹è­¦æŠ¥è¯¦ç»†ä¿¡æ¯éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å‡å°‘åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚

## è®¾ç½®æ‚¨çš„ç¯å¢ƒ

åœ¨æˆ‘ä»¬æ·±å…¥å¼€å‘ç»†èŠ‚ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå‡†å¤‡å¥½æ‚¨çš„å¼€å‘ç¯å¢ƒã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦ AWSã€Slack å’Œ OpsGenie å¸æˆ·æ¥è¿è¡Œè¿™ä¸ªé¡¹ç›®ã€‚

æˆ‘ä»¬ä¸ºè¿™ä¸ªé¡¹ç›®é€‰æ‹©äº†æ— æœåŠ¡å™¨(AWS Lambda)è®¡ç®—æœåŠ¡ï¼Œå› ä¸ºå®ƒçš„ä»·æ ¼æ˜¯æŒ‰è§¦å‘ä»˜è´¹çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒç»´æŠ¤ã€‚å¯¹äºè¿™ç§å¯èƒ½æœ‰å°‘é‡è¯·æ±‚çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™å¾ˆæœ‰æ„ä¹‰ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ Lambdaï¼ŒAWS çš„ API ç½‘å…³æœåŠ¡ï¼ŒNode.js ä½œä¸ºè¯­è¨€ï¼ŒServerless.js ç”¨äºéƒ¨ç½²é¡¹ç›®ã€‚

æˆ‘å°†è·³è¿‡ npm å’Œ Node.js å®‰è£…ã€‚ä½ å¯ä»¥è°·æ­Œä¸€ä¸‹â€”â€”:Dï¼Œä¸è¦å¿˜è®°å®‰è£… Node.js v6.10 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬å°†åœ¨ AWS Lambda ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒæ˜¯æœ€æ–°æ”¯æŒçš„ç‰ˆæœ¬ã€‚è¦å®‰è£… Serverless.jsï¼Œè¯·è¿è¡Œ:

```
npm install -g serverless
```

## æ¾å¼›å±•å¼€æµæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

å½“æˆ‘ä»¬å®Œæˆäº†åˆå§‹è®¾ç½®ï¼Œæ˜¯æ—¶å€™äº†è§£è¿™ä¸ªé¡¹ç›®çš„æµç¨‹äº†ã€‚é€šè¿‡è·Ÿè¸ªå›¾ä¸Šçš„æ•°å­—ï¼Œæ‚¨å¯ä»¥äº†è§£æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæµç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

![](img/94b3b35fe9aa8073014c52842ba8fd2c.png)

Application flow

è¿™é‡Œä¸€ä¸ªé‡è¦çš„ç»†èŠ‚æ˜¯ Slack çš„ Events APIã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ª API åœ¨å‘ç”Ÿæ–°æ¶ˆæ¯æˆ–å‘æ¶ˆæ¯æ·»åŠ  pin ç­‰äº‹ä»¶æ—¶å¾—åˆ°é€šçŸ¥ã€‚

## åˆ›å»ºæ‚¨çš„ Slack åº”ç”¨ç¨‹åº

ç°åœ¨ï¼Œæ˜¯æ—¶å€™æ·±å…¥ç ”ç©¶ Slack åº”ç”¨ç¨‹åºéƒ¨åˆ†äº†ã€‚æˆ‘ä»¬å°†å»ºç«‹ä¸€ä¸ªå†…éƒ¨çš„æ¾æ•£é›†æˆã€‚å†…éƒ¨é›†æˆå°±åƒå¸¸è§„çš„ Slack åº”ç”¨ç¨‹åºä¸€æ ·ï¼Œåªæ˜¯å®ƒä»¬åªèƒ½å®‰è£…åœ¨ä½ çš„å·¥ä½œç©ºé—´ä¸­ï¼›å› æ­¤ï¼Œæ‚¨ä¸éœ€è¦å®ç° [OAuth è®¤è¯æµç¨‹](https://api.slack.com/docs/slack-button)ã€‚è¿™æ›´å®¹æ˜“ï¼Œæ›´é€‚åˆæˆ‘ä»¬çš„ç”¨ä¾‹ã€‚

é¦–å…ˆè¿›å…¥ https://api.slack.com/apps[çš„](https://api.slack.com/apps)é“¾æ¥ï¼Œç‚¹å‡»â€œ*åˆ›å»ºæ–°åº”ç”¨*æŒ‰é’®ã€‚ç„¶åï¼Œæ‚¨å°†ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå‘½åï¼Œå¹¶é€‰æ‹©æ‚¨å¸Œæœ›åº”ç”¨ç¨‹åºå­˜åœ¨çš„å·¥ä½œåŒºã€‚ä¸è¦æ‹…å¿ƒï¼Œæ‚¨å¯ä»¥ç¨åæ›´æ”¹è¿™äº›ç»†èŠ‚ã€‚

![](img/c49c073205561a246d2fe607a486744c.png)

Create your new Slack app!

ç›®å‰å°±è¿™äº›ï¼Œä¸€æ—¦æˆ‘ä»¬å°†åŠŸèƒ½éƒ¨ç½²åˆ° AWSï¼Œæˆ‘ä»¬å°†å†æ¬¡è®¿é—®è¿™ä¸ªé¡µé¢ã€‚

## ä» OpsGenie è·å– API å¯†é’¥

[å¦‚æœæ‚¨è¿˜æ²¡æœ‰å¸æˆ·ï¼Œè¯·åœ¨ OpsGenie](https://app.opsgenie.com/customer/register?utm_source=medium&utm_medium=hackernoon) ä¸­ç”³è¯·ä¸€ä¸ªæ–°å¸æˆ·ã€‚åœ¨é›†æˆ- >ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ API é›†æˆã€‚

![](img/f3a9b15fbdacf8e0a39ddb7b02a99a3e.png)

Create an API integration in OpsGenie

è¿™ä¸ªå‡½æ•°çš„ä¸€ä¸ªé‡è¦æç¤ºæ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ª API é”®æ¥æ›´æ–° OpsGenie ä¸­çš„é…ç½®æˆ–å‘é€é€šçŸ¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†é›†æˆé…ç½®ä¸ºåªè¯»è®¿é—®å¹¶ç¦æ­¢é€šçŸ¥ã€‚

## åˆ›å»ºä½ çš„ Lambda å‡½æ•°

åˆ›å»º Lambda å‡½æ•°æœ€ç®€å•çš„æ–¹æ³•æ˜¯å…‹éš†ä¸‹é¢çš„é“¾æ¥åº“ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿®æ”¹ä»£ç ã€‚ç„¶åï¼Œåªéœ€å®‰è£…ä¾èµ–é¡¹ã€‚

```
git clone [https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling](https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling)cd serverless-opsgenie-slack-alert-unfurlingnpm install
```

å¦‚æœæ‚¨æƒ³ä»å¤´å¼€å§‹æˆ–æ„å»ºè‡ªå·±çš„ä»£ç ï¼Œæ‚¨æœ‰ä¸‰ç§é€‰æ‹©:

*   ä½¿ç”¨è¿™ä¸ªé¡¹ç›®å¹¶æ›¿æ¢é€»è¾‘ï¼Œ
*   ä½¿ç”¨ AWS Lambda æä¾›çš„è“å›¾ä¹‹ä¸€ï¼Œæˆ–è€…ä½¿ç”¨ AWS CodeStart ä¸ºæ›´å¤§çš„é¡¹ç›®æä¾›æ›´å®Œæ•´çš„è®¾ç½®ï¼Œ
*   è¿è¡Œä»¥ä¸‹æ— æœåŠ¡å™¨å‘½ä»¤åˆ›å»ºæ–°çš„ Lambda å‡½æ•°:

```
serverless create â€” template aws-nodejs â€” path my-service
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»£ç çš„ä¸»è¦æ„å»ºå—ã€‚é™¤äº†ä»è¿™é‡Œçœ‹ï¼Œä½ è¿˜å¯ä»¥çœ‹çœ‹ GitHub ä¸Šçš„[è¿™~100 è¡Œä»£ç ](https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling/blob/master/handler.js)ã€‚

æµç¨‹æ˜¯è¿™æ ·çš„:

*   æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å‘ Lambda å‡½æ•°ä¼ é€’äº†æ­£ç¡®çš„å¯†é’¥(æ¾å¼›éªŒè¯ä»¤ç‰Œã€æ¾å¼›è®¿é—®ä»¤ç‰Œ-API ä»¤ç‰Œå’Œ OpsGenie API å¯†é’¥)
*   é€šè¿‡æ¯”è¾ƒæˆ‘ä»¬æ‹¥æœ‰çš„éªŒè¯ä»¤ç‰Œå’Œä»è¯·æ±‚ä¸­æ”¶åˆ°çš„ä»¤ç‰Œï¼ŒéªŒè¯è¯·æ±‚æ¥è‡ª Slack
*   æ£€æŸ¥äº‹ä»¶è´Ÿè½½å’Œæˆ‘ä»¬æ”¶åˆ°çš„äº‹ä»¶çš„ç±»å‹ã€‚
    å¦‚æœäº‹ä»¶ä¸ºï¼›
    -"*URL _ verification*"äº‹ä»¶:ä» JSON è´Ÿè½½å‘å› *challenge* å€¼ï¼Œå› ä¸ºè¯¥äº‹ä»¶æ„å‘³ç€ Slack æ­£åœ¨æ£€æŸ¥æ‚¨çš„ç«¯ç‚¹çš„å¥åº·çŠ¶å†µ
    - " *event_callback* "äº‹ä»¶:è¿è¡Œé€»è¾‘

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†ä¸»è¦çš„æ„å»ºæ¨¡å—ï¼Œè®©æˆ‘ä»¬ä¹Ÿæ¥è®¨è®ºä¸€ä¸‹å½“æ¥æ”¶åˆ° event_callback æ—¶è¿è¡Œçš„é€»è¾‘ã€‚æˆ‘ä»¬ä½¿ç”¨ Slack å’Œ OpsGenie Node.js SDKs æ¥é¿å…åœ¨è®¿é—® API æ—¶ç¼–å†™æ ·æ¿ä»£ç ã€‚é€»è¾‘éƒ¨åˆ†åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤:

*   ä¸€æ¡æ¶ˆæ¯å¯ä»¥åŒ…å«æ¥è‡ªæˆ‘ä»¬æ³¨å†ŒåŸŸåçš„å¤šä¸ªé“¾æ¥(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ app.opsgenie.com)ã€‚æ¾å¼›äº‹ä»¶ API ä»¥æ•°ç»„çš„å½¢å¼å‘é€è¿™äº›é“¾æ¥ã€‚æˆ‘ä»¬è¿­ä»£è¿™äº›é“¾æ¥(*æœ‰æ•ˆè´Ÿè½½*ä¸­çš„ event.links)å¹¶ä¸ºæ¯ä¸ªé“¾æ¥è¿è¡Œ*messageAttachmentFromLink*å‡½æ•°
*   é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼ä»è¿™æ ·çš„é“¾æ¥ä¸­æå– alertId å¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨çš„é“¾æ¥å¯ä»¥æ”¯æŒå…¶ä»–å¤§å°å†™

```
https://app.opsgenie.com/alert/V2#/show/df2d5224-6df3-4905-a98d-c08c9388f3b5-1516805551907/details
```

*   ä½¿ç”¨ OpsGenie ä¸­çš„è­¦æŠ¥ ID æ£€ç´¢è­¦æŠ¥è¯¦ç»†ä¿¡æ¯
*   ä½¿ç”¨æˆ‘ä»¬è·å¾—çš„è¯¦ç»†ä¿¡æ¯æ„å»ºæˆ‘ä»¬çš„æ¾å¼›æ¶ˆæ¯é™„ä»¶
*   ä½¿ç”¨ Slack API æ›´æ–°åŒ…å«å¿…è¦é™„ä»¶çš„ Slack æ¶ˆæ¯

æˆ‘ä»¬äº†è§£äº†æˆ‘ä»¬çš„åŠŸèƒ½æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä½†æ˜¯ï¼Œæˆ‘å»ºè®®ä½ è¿˜æ˜¯ç»§ç»­é˜…è¯»ä»£ç ï¼Œå› ä¸ºè¿™å¯¹å¤§å¤šæ•°å¼€å‘è€…æ¥è¯´æ›´æœ‰æ„ä¹‰ã€‚

## éƒ¨ç½² Lambda å‡½æ•°çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬

åœ¨åˆ›å»º Slack åº”ç”¨ç¨‹åºã€OpsGenie é›†æˆå’Œç¼–å†™æˆ‘ä»¬çš„å‡½æ•°ä¹‹åï¼Œç°åœ¨æ˜¯æ—¶å€™éƒ¨ç½²æˆ‘ä»¬çš„å‡½æ•°äº†ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„å‡½æ•°æ”¾åœ¨ AWS Lambda ä¸Šï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬ä»ç„¶æ²¡æœ‰ä¸€ä¸ª API ç«¯ç‚¹æ¥å‘Šè¯‰ Slack å‘å‡ºè¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜ä¸èƒ½åœ¨æˆ‘ä»¬çš„å·¥ä½œåŒºä¸­å®‰è£…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¹Ÿæ²¡æœ‰å®‰è£…åº”ç”¨ç¨‹åºåä¼šå¾—åˆ°çš„ Slack API å¯†é’¥ã€‚

ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†åŠŸèƒ½éƒ¨ç½²ï¼Œæˆ‘ä»¬å°†ä» API Gateway service è·å¾—ä¸€ä¸ª HTTPS ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å®Œæˆæˆ‘ä»¬åœ¨ Slack ä¸­çš„é…ç½®ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†é€šè¿‡è®¾ç½® Slack API é”®æ¥æ›´æ–° Slack åº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œå¹¶å†æ¬¡éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚

ä¸€æ­¥ä¸€æ­¥æ¥ã€‚æ‰€ä»¥åœ¨è¿™ä¸€æ­¥ï¼Œä½ åº”è¯¥ä» Slack app ä¸­è·å–éªŒè¯ä»¤ç‰Œï¼Œå¹¶ç²˜è´´åˆ° *serverless.yml* æ–‡ä»¶ä¸­çš„*Slack _ verification _ token*config ä¸­ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªä»¤ç‰Œé€šè¿‡ä¸æ”¶åˆ°çš„ä»¤ç‰Œè¿›è¡Œæ¯”è¾ƒæ¥éªŒè¯è¯·æ±‚æ¥è‡ª Slackã€‚

![](img/1cba61963b0340fe7d2d7b2dbefefabb.png)

Slack verification token can be found under ***Basic information -> App credentials***

æˆ‘ä»¬è¿˜æœ‰ OpsGenie API å¯†é’¥ï¼Œè®©æˆ‘ä»¬ä¹Ÿå°†å®ƒç²˜è´´åˆ°æˆ‘ä»¬çš„é…ç½®ä¸­ã€‚æˆ‘ä»¬çš„é…ç½®å°†å¦‚ä¸‹æ‰€ç¤º(å”¯ä¸€ç¼ºå°‘çš„æ˜¯ *slack_access_token* ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨å·¥ä½œåŒºä¸­å®‰è£…åº”ç”¨ç¨‹åº):

![](img/397711f32989bbf8605109a56cf1dce9.png)

Our config before we deploy first time

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²ã€‚è½¬åˆ°é¡¹ç›®çš„ä¸»æ–‡ä»¶å¤¹ï¼Œè¿è¡Œéƒ¨ç½²å‘½ä»¤:

```
serverless deploy
```

æ‰€æœ‰è¿™äº›éƒ½å°†ç”± *serverless.js å¤„ç†ã€‚* Serverless ä½¿ç”¨ AWS CloudFormation æ¥æå‡æ‚¨çš„å †æ ˆã€‚æ‚¨ä¹Ÿå¯ä»¥è®¿é—® CloudFormation äº†è§£æ›´å¤šä¿¡æ¯ã€‚

![](img/e5ee010d1751fe9ee6d34493bfb3a528.png)

CloudFormation Stack Serverless.js created

![](img/247f03ea2d194d497d061028dc449b32.png)

After you run **serverless deploy** command

è¿è¡Œå‘½ä»¤å¹¶å®Œæˆå †æ ˆåˆ›å»ºåï¼Œæ‚¨å°†åœ¨ç»ˆç«¯ä¸­çœ‹åˆ°ä¸€ä¸ª HTTP ç«¯ç‚¹ã€‚æŠ„ä¸‹æ¥ç»§ç»­ä¸‹ä¸€éƒ¨åˆ†ï¼

## é…ç½®æ¾å¼›åº”ç”¨ç¨‹åº

æ‚¨æ‹¥æœ‰ API ç½‘å…³ç«¯ç‚¹ã€‚Slack å°†ä½¿ç”¨è¿™ä¸ª API ç«¯ç‚¹æ¥å‘é€äº‹ä»¶ç»†èŠ‚ã€‚è¦å°†æ­¤äº‹å‘ŠçŸ¥ Slackï¼Œè¯·è½¬åˆ°*äº‹ä»¶è®¢é˜…*é€‰é¡¹å¡ã€‚

![](img/60e9f3ddb5b6ebfe8a35e1be985e667c.png)

å¯ç”¨*äº‹ä»¶*å¹¶å°†æ‚¨è·å¾—çš„ç«¯ç‚¹ç²˜è´´åˆ°â€œè¯·æ±‚ URLâ€è¾“å…¥ä¸­ã€‚æ­¤æ—¶ï¼ŒSlack å°†å‘æ‚¨çš„ç«¯ç‚¹å‘å‡ºè¯·æ±‚ï¼Œä»¥ç¡®ä¿å®ƒèƒ½å¤Ÿå·¥ä½œã€‚ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬çš„ä»£ç çŸ¥é“å¦‚ä½•å¤„ç†è¿™ä¸ªæœ‰æ•ˆè½½è·ï¼Œå¹¶èƒ½è¿”å›æ­£ç¡®çš„å“åº”ã€‚

åœ¨ä½ è·å¾—â€œ*éªŒè¯*æ ‡å¿—åï¼Œç°åœ¨æ˜¯æ—¶å€™è®¢é˜…ä¸€äº›æ´»åŠ¨äº†ã€‚Slack åªä¼šå‘é€æ‚¨è®¢é˜…çš„äº‹ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå½“ä¸€ä¸ªé“¾æ¥åŒ…å« app.opsgenie.com çš„åŸŸæ—¶ï¼Œä¸ºäº†è°ƒç”¨æˆ‘ä»¬çš„ç«¯ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è®¢é˜…é“¾æ¥å…±äº«äº‹ä»¶ã€‚

è¿™ä¸€é¡µçš„æœ€åä¸€æ­¥æ˜¯å‘Šè¯‰ Slack ä½ æƒ³è¦ç›‘å¬å“ªäº›åŸŸã€‚åœ¨ App å±•å¼€åŸŸåéƒ¨åˆ†*ä¸‹æ·»åŠ *app.opsgenie.com*åŸŸåã€‚*

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»ä¾§è¾¹æ åˆ‡æ¢åˆ° *OAuth & Permissions* é¡µé¢ã€‚åœ¨è¿™ä¸ªé¡µé¢ä¸­ï¼Œä½ éœ€è¦ç¡®ä¿ä½ æœ‰*é“¾æ¥:è¯»*å’Œ*é“¾æ¥:å†™*èŒƒå›´ã€‚è¯»èŒƒå›´æ˜¯ Slack å‘æˆ‘ä»¬å‘é€äº‹ä»¶æ‰€å¿…éœ€çš„ï¼Œå†™èŒƒå›´æ˜¯æˆ‘ä»¬ç”¨é™„ä»¶æ›´æ–°æ¶ˆæ¯æ‰€å¿…éœ€çš„ã€‚ç”¨æˆ·éœ€è¦åœ¨å®‰è£…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ—¶æ‰¹å‡†è¿™ä¸€ç‚¹ã€‚

## åœ¨ä½ çš„å·¥ä½œåŒºå®‰è£…ä½ çš„ Slack åº”ç”¨

ç°åœ¨ï¼Œæ˜¯æ—¶å€™å®‰è£…åº”ç”¨ç¨‹åºå¹¶è·å¾— **OAuth è®¿é—®ä»¤ç‰Œ**æ¥è®¿é—® Slack API äº†ã€‚è¿›å…¥**å®‰è£… App** é¡µé¢å¹¶å®‰è£…:)

![](img/8ad99054483293e6ef8f4e6e9ac2047a.png)

Click Install App to Workspace

![](img/ca8c6b5ea8f7d58775a1bfb708ea8cbf.png)

Authorize the app

æˆæƒåº”ç”¨ç¨‹åºåï¼Œæ‚¨ç¦»å®Œæˆè®¾ç½®åªæœ‰ä¸€æ­¥ä¹‹é¥ï¼

## æ›´æ–°æ‚¨çš„å‡½æ•°å¹¶å†æ¬¡éƒ¨ç½²

åœ¨ Slack é‡å®šå‘ä½ çš„é¡µé¢ä¸­å®‰è£…ä¹‹åï¼Œä½ ä¼šçœ‹åˆ° **OAuth è®¿é—®ä»¤ç‰Œ**ã€‚å¤åˆ¶ç²˜è´´åˆ° *serverless.yml* æ–‡ä»¶çš„ *slack_access_token* é…ç½®ä¸­ã€‚

![](img/a612b0881e0d8248bc8d4d397f976df5.png)

OAuth Access Token we need to access Slack API

ç„¶åå†æ¬¡éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œç¬¬äºŒæ¬¡è¿è¡Œéƒ¨ç½²å‘½ä»¤:

```
serverless deploy
```

å°±æ˜¯è¿™æ ·ï¼â›±

## è¯•è¯•çœ‹æœ‰æ²¡æœ‰ç”¨ï¼

æˆ‘ä»¬éœ€è¦ä¸€ä¸ª OpsGenie è­¦æŠ¥æ¥æµ‹è¯•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ‚¨å¯ä»¥é€šè¿‡é”®å…¥*/ç²¾çµè­¦æŠ¥â€œæµ‹è¯•æˆ‘çš„è­¦æŠ¥â€*å‘½ä»¤æˆ–ä»…ä½¿ç”¨ web ç•Œé¢ä» Slack åˆ›å»ºä¸€ä¸ªã€‚

![](img/56db5e5adc3302a2238500bad7b6650a.png)

Create a new OpsGenie alert

å•å‡»è­¦æŠ¥è¯¦ç»†ä¿¡æ¯ï¼Œåœ¨æµè§ˆå™¨ä¸Šï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ç«¯ç‚¹:

```
https://app.opsgenie.com/alert/V2#/show/df2d5224-6df3-4905-a98d-c08c9388f3b5-1516805551907/details
```

å¤åˆ¶è¿™ä¸ªé“¾æ¥å¹¶ç²˜è´´åˆ° Slackï¼Œäº«å—ä½ çš„å·¥ä½œï¼

![](img/8d46a0816621caaaff6b2afeeb84d08d.png)

Enjoy your work!

ä»£ç å¯åœ¨æ­¤åº“ä¸­æ‰¾åˆ°:
[https://github . com/serhatcan/server less-ops genie-slack-alert-unfurling](https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling)

## è¿›ä¸€æ­¥çš„æ”¹è¿›å’Œæç¤º

æ‚¨å¯ä»¥åšä¸€äº›äº‹æƒ…æ¥å¢å¼ºè¿™ç§é›†æˆ:

*   ä½¿ç”¨ KMS æ¥å®‰å…¨åœ°ç®¡ç†æ‚¨çš„å¯†é’¥â€”â€”ä¸å»ºè®®å¯¹å¯†é’¥ä½¿ç”¨ç¯å¢ƒå˜é‡
*   ç”¨æ›´å¤šç»†èŠ‚æ”¹è¿›æ¾å¼›æ¶ˆæ¯ï¼Œå¯èƒ½æ·»åŠ æŒ‰é’®ï¼
*   å¦‚æœä½ æ­£åœ¨è€ƒè™‘å¤„ç†æ›´å¤šçš„äº‹ä»¶ï¼Œå¹¶ä¸”æƒ³è¦éšè—ä¸€äº›å¤æ‚æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨ [Slack Events API æ¨¡å—ç”¨äºèŠ‚ç‚¹ã€‚](https://github.com/slackapi/node-slack-events-api)

Slack æœ‰[å¾ˆå¥½çš„æ–‡æ¡£](https://api.slack.com/docs/message-link-unfurling)å’Œ[åœ¨ Github](https://github.com/slackapi/sample-app-unfurls) ä¸Šå±•ç¤ºçš„å¾ˆå¥½çš„æ ·æœ¬ã€‚éµå¾ªè¿™äº›ï¼Œä½ å°±å¯ä»¥è®©ä½ çš„åº”ç”¨è¿›å…¥ä¸‹ä¸€æ­¥äº†ï¼

## **å‚è€ƒæ–‡çŒ®åŠç›¸å…³é“¾æ¥**

*   [https://github . com/serhatcan/server less-ops genie-slack-alert-unfurling](https://github.com/serhatcan/serverless-opsgenie-slack-alert-unfurling)
*   [https://api.slack.com/docs/message-link-unfurling](https://api.slack.com/docs/message-link-unfurling)
*   [https://github.com/slackapi/sample-app-unfurls](https://github.com/slackapi/sample-app-unfurls)

æ„Ÿè°¢æ‚¨è¯»åˆ°è¿™é‡Œï¼

å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•™ç¨‹ï¼Œåˆ«å¿˜äº†ğŸ‘ä¸ºäº†è¡¨ç¤ºä½ çš„æ”¯æŒğŸ˜ƒ