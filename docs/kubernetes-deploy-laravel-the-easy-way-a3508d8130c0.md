# Kubernetes:ä»¥æœ€ç®€å•çš„æ–¹å¼éƒ¨ç½² Laravel

> åŸæ–‡ï¼š<https://medium.com/hackernoon/kubernetes-deploy-laravel-the-easy-way-a3508d8130c0>

![](img/ef568d9c213d1d9d50a49803e3c2f905.png)

Laravel æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç”¨äºå¼€å‘ PHP åº”ç”¨ç¨‹åºçš„[æ¡†æ¶](https://hackernoon.com/tagged/framework)ã€‚æ— è®ºä½ éœ€è¦ä¸€ä¸ªæ–°æƒ³æ³•çš„åŸå‹ï¼Œå¼€å‘ä¸€ä¸ª MVP(æœ€å°å¯è¡Œäº§å“)è¿˜æ˜¯å‘å¸ƒä¸€ä¸ªæˆç†Ÿçš„ä¼ä¸šç³»ç»Ÿï¼ŒLaravel éƒ½å¯ä»¥å¸®åŠ©ä½ å®Œæˆæ‰€æœ‰çš„å¼€å‘ä»»åŠ¡å’Œå·¥ä½œæµç¨‹ã€‚

å¦‚ä½•å¤„ç†åº”ç”¨ç¨‹åºçš„éƒ¨ç½²æ˜¯ä¸€ä¸ªä¸åŒçš„æ•…äº‹ã€‚åœ¨è®¾ç½®ç±»ä¼¼äºè¿œç¨‹æœåŠ¡å™¨çš„æœ¬åœ°ç¯å¢ƒæ–¹é¢ï¼Œvagger åšå¾—éå¸¸å¥½ã€‚ç„¶è€Œï¼Œåœ¨ç”Ÿäº§ä¸­ï¼Œæ‚¨å¾ˆå¯èƒ½éœ€è¦ä¸æ­¢ä¸€ä¸ª web ä¸»æœºå’Œä¸€ä¸ªæ•°æ®åº“ã€‚æ‚¨å¯èƒ½ä¼šä¸ºå‡ ä¸ªéœ€æ±‚æä¾›å•ç‹¬çš„æœåŠ¡ã€‚æ‚¨è¿˜éœ€è¦æœ‰é€‚å½“çš„æœºåˆ¶æ¥ç¡®ä¿åº”ç”¨ç¨‹åºå§‹ç»ˆåœ¨çº¿ï¼Œå¹¶ä¸”æœåŠ¡å™¨å¯ä»¥æœ‰æ•ˆåœ°å¹³è¡¡è´Ÿè½½ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è§£é‡Šå¦‚ä½•å¤„ç†ä½œä¸ºæœ¬åœ° Kubernetes è®¾ç½®è¿è¡Œ Laravel åº”ç”¨ç¨‹åºçš„ç®€å•éœ€æ±‚ã€‚

# Kubernetesï¼Œä¸ºä»€ä¹ˆå’Œä»€ä¹ˆï¼Ÿ

Kubernetes æ˜¯ä¸€ä¸ªå¼€æºç³»ç»Ÿï¼Œæœ€åˆç”± Google è®¾è®¡ï¼Œç”¨äºåœ¨é›†ç¾¤ç¯å¢ƒä¸­ä¿ƒè¿›å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„ç®¡ç†ã€‚æœ‰äº›äººå°†å…¶ç§°ä¸ºç¼–æ’å¹³å°ï¼ŒKubernetes å¹¶ä¸æ˜¯è¿™ç§ç±»å‹çš„å”¯ä¸€å¯ç”¨å¹³å°ã€‚è™½ç„¶ï¼Œå®ƒç¡®å®æœ‰å¾ˆé«˜å¾ˆå¿«çš„é‡‡ç”¨ç‡ã€‚æ›´ä¸ç”¨è¯´ï¼Œä¸€æ—¦ä½ ä¹ æƒ¯äº†ï¼Œå®ƒæ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚

å¦‚æœä½ ä»ç„¶æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæœ‰äººå¯ä»¥ä»ä½¿ç”¨ Kubernetes ä¸­å—ç›Šï¼Œç­”æ¡ˆå¾ˆç®€å•ã€‚Kubernetes ä½¿å¾—è·¨å¤šä¸ªé¡¹ç›®è®¾ç½®å’Œç®¡ç†ä»»æ„å¤šçš„é›†ç¾¤å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

# å°† Laravel åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Minikube

æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†ä¸€ä¸ªç®€å•çš„æ— çŠ¶æ€ Laravel åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Kubernetesã€‚æˆ‘çš„ç›®æ ‡æ˜¯è¯¦ç»†è¯´æ˜å®ç°è¿™ä¸€ç›®æ ‡æ‰€æ¶‰åŠçš„æ­¥éª¤ï¼ŒåŒæ—¶è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦å…·ä½“çš„è¡ŒåŠ¨ã€‚æ­¤å¤–ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å¿«é€Ÿæ‰©å±•åº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨å…¥å£æ§åˆ¶å™¨ä½¿å…¶åœ¨æŒ‡å®šçš„ä¸»æœºä¸Šå¯ç”¨ã€‚

ä½ å¯ä»¥åœ¨å‡ ä¸ªäº‘ä¸»æœºæä¾›å•†ä¸Šè¿è¡Œ Kubernetesï¼Œæ¯”å¦‚ Google Cloud Engine å’Œ Amazon Web Servicesã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†åœ¨ Minikube ä¸Šè¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼ŒMinikube æ˜¯ä¸€ä¸ªä½¿æœ¬åœ°è¿è¡Œ Kubernetes å˜å¾—å®¹æ˜“çš„å·¥å…·ã€‚

ä¸ vagger ç±»ä¼¼ï¼ŒMinikube ä»…ä»…æ˜¯ä¸€ä¸ªåŒ…å« Kubernetes å¹³å°å’Œ Docker çš„è™šæ‹Ÿæœºã€‚æ‚¨æ—¢éœ€è¦å°†åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸º Docker å®¹å™¨ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨ Kubernetes å°†å®ƒæ‰©å±•åˆ°ä¸‰ä¸ªå®ä¾‹ã€‚

**ç”³è¯·**

æˆ‘å‡†å¤‡äº†ä¸€ä¸ªç®€å•çš„ Laravel åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä» [GitHub](https://github.com/learnk8s/laravel-kubernetes-demo) ä¸­å…‹éš†å®ƒã€‚è¿™åªä¸è¿‡æ˜¯ä¸€ä¸ªæ–°çš„ Laravel è£…ç½®ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¼”ç¤ºåº”ç”¨ç¨‹åºæˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„ Laravel åº”ç”¨ç¨‹åºæ¥éµå¾ªè¿™ä¸ªç¤ºä¾‹ã€‚è¦ä½¿ç”¨æ¼”ç¤ºåº”ç”¨ç¨‹åºï¼Œè¯·å°†å…¶å…‹éš†åˆ°æ‚¨çš„é¡¹ç›®ç›®å½•ä¸­ã€‚

```
cd /to/your/working/directory git clone git@github.com:learnk8s/laravel-kubernetes-demo.git .
```

**å…ˆå†³æ¡ä»¶**

è¦è¿›è¡Œæœ¬æ¼”ç¤ºï¼Œæ‚¨éœ€è¦åœ¨æœ¬åœ°ç³»ç»Ÿä¸Šå®‰è£…ä»¥ä¸‹è½¯ä»¶:

1) [Docker](https://docs.docker.com/install/)

2) [åº“è´å…‹ç‰¹å°”](https://kubernetes.io/docs/tasks/tools/install-kubectl/)

3) [Minikube](https://github.com/kubernetes/minikube/releases)

> *åœ¨ Windows ä¸Šå®‰è£…å’Œè¿è¡Œè¿™äº›åº”ç”¨ç¨‹åºæ˜¯å¦æœ‰é—®é¢˜ï¼ŸæŸ¥çœ‹æ–‡ç« *[*Windows 10*](https://learnk8s.io/blog/installing-docker-and-kubernetes-on-windows)*ä¸Šçš„ Docker å’Œ Kubernetes å…¥é—¨ï¼Œè·å¾—é€æ­¥æŒ‡å—ã€‚*

**Docker å›¾åƒ**

Kubernetes éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå› æ­¤ä½œä¸ºç¬¬ä¸€æ­¥ï¼Œæ‚¨éœ€è¦æ„å»ºæ¼”ç¤ºåº”ç”¨ç¨‹åºçš„ Docker æ˜ åƒã€‚ç”±äºæœ¬æ•™ç¨‹å°†åœ¨ Minikube ä¸Šæœ¬åœ°è¿è¡Œï¼Œæ‚¨å¯ä»¥ä»ç¤ºä¾‹ä»£ç ä¸­åŒ…å«çš„`Dockerfile`æ„å»ºä¸€ä¸ªæœ¬åœ° Docker æ˜ åƒã€‚

```
FROM composer:1.6.5 as build 
WORKDIR /app 
COPY . /app 
RUN composer installFROM php:7.1.8-apache 
EXPOSE 80 
COPY --from=build /app /app 
COPY vhost.conf /etc/apache2/sites-available/000-default.conf 
RUN chown -R www-data:www-data /app \ 
  && a2enmod rewrite
```

æ­¤`Dockerfile`ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:

*   ç¬¬ä¸€éƒ¨åˆ†æ‰©å±•äº†ä¸€ä¸ª PHP `composer`æ˜ åƒï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥å®‰è£…åº”ç”¨ç¨‹åºçš„ä¾èµ–é¡¹ã€‚
*   ç¬¬äºŒéƒ¨åˆ†ç”¨ Apache web æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªæœ€ç»ˆçš„ Docker æ˜ åƒæ¥ä¸ºåº”ç”¨ç¨‹åºæä¾›æœåŠ¡ã€‚

åœ¨æµ‹è¯• Docker æ˜ åƒä¹‹å‰ï¼Œæ‚¨éœ€è¦æ„å»ºå®ƒ:

```
cd /to/your/project/directory 
docker build -t yourname/laravel-kubernetes-demo .
```

ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œåº”ç”¨ç¨‹åº:

```
docker run -ti \ 
  -p 8080:80 \ 
  -e APP_KEY=base64:cUPmwHx4LXa4Z25HhzFiWCf7TlQmSqnt98pnuiHmzgY= \     
  laravel-kubernetes-demo
```

å¹¶ä¸”åº”ç”¨åº”è¯¥åœ¨`[http://localhost:8080](http://localhost:8080.)` [å¯ç”¨ã€‚](http://localhost:8080.)

é€šè¿‡è¿™ç§è®¾ç½®ï¼Œå®¹å™¨æ˜¯é€šç”¨çš„ï¼Œå¹¶ä¸”`APP_KEY`ä¸æ˜¯ç¡¬ç¼–ç æˆ–å…±äº«çš„ã€‚

**åœ¨ Minikube å†…æ„å»ºå›¾åƒ**

```
cd /to/your/project/directory 
eval $(minikube docker-env) 
docker build -t yourname/laravel-kubernetes-demo .
```

> ä¸è¦å¿˜è®°æ‰§è¡Œè¯„ä¼°ã€‚åœ¨è™šæ‹Ÿæœºä¸­æ„å»ºæ˜ åƒæ˜¯å¿…è¦çš„ã€‚æ‚¨åº”è¯¥åœ¨å½“å‰ç»ˆç«¯ä¸­åªè¿è¡Œä¸€æ¬¡è¯¥å‘½ä»¤ã€‚

**éƒ¨ç½²é•œåƒ**

æ—¢ç„¶åº”ç”¨ç¨‹åºçš„æ˜ åƒå·²ç»æ„å»ºå¥½å¹¶åœ¨ Minikube ä¸­å¯ç”¨ï¼Œæ‚¨å°±å¯ä»¥ç»§ç»­éƒ¨ç½²å®ƒäº†ã€‚

æˆ‘æ€»æ˜¯é¦–å…ˆç¡®ä¿`kubectl`åœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šä¸‹æ–‡æ˜¯ Minikubeã€‚æ‚¨å¯ä»¥å¿«é€Ÿåˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
kubectl config use-context minikube
```

ç„¶åï¼Œæ‚¨å¯ä»¥éƒ¨ç½²å®¹å™¨æ˜ åƒ:

```
kubectl run laravel-kubernetes-demo \ 
  --image=yourname/laravel-kubernetes-demo \ 
  --port=80 \ 
  --image-pull-policy=IfNotPresent \ 
  --env=APP_KEY=base64:cUPmwHx4LXa4Z25HhzFiWCf7TlQmSqnt98pnuiHmzgY=
```

ä¸Šé¢çš„å‘½ä»¤å‘Šè¯‰`kubectl`ä» Docker æ˜ åƒè¿è¡Œæˆ‘ä»¬çš„æ¼”ç¤ºåº”ç”¨ç¨‹åºã€‚è¯¥å‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°åªæ˜¯è¦æ±‚`kubectl`ä¸è¦ä»æ³¨å†Œä¸­å¿ƒ(æ¯”å¦‚ Docker Hub)è·å–å›¾åƒï¼Œå¦‚æœå®ƒå­˜åœ¨äºæœ¬åœ°çš„è¯ï¼Œåœ¨æœ¬ä¾‹ä¸­å®ƒç¡®å®å­˜åœ¨ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä»ç„¶éœ€è¦ç™»å½• Dockerï¼Œä»¥ä¾¿`kubectl`å¯ä»¥æ£€æŸ¥å›¾åƒæ˜¯å¦æ˜¯æœ€æ–°çš„ã€‚

æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æ˜¯å¦ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºäº† Pod:

```
kubectl get pods
```

è¿™å°†è¿”å›ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡º:

```
NAME                                     READY STATUS RESTARTS AGE 
laravel-kubernetes-demo-7dbb9d6b48-q54wp 1/1   Running 0       18m
```

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Minikube GUI ä»ªè¡¨æ¿æ¥ç›‘æ§é›†ç¾¤ã€‚GUI ä¹Ÿæœ‰åŠ©äºå¯è§†åŒ–å¤§å¤šæ•°è®¨è®ºçš„æ¦‚å¿µã€‚è¦æŸ¥çœ‹ä»ªè¡¨æ¿ï¼Œåªéœ€è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
minikube dashboard
```

æˆ–è€…è·å–ä»ªè¡¨æ¿çš„ URL åœ°å€:

```
minikube dashboard --url=true
```

**æ›å…‰ä¸€é¡¹æœåŠ¡**

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»åˆ›å»ºäº†ä¸€ä¸ªè¿è¡Œåº”ç”¨ç¨‹åºå®¹å™¨çš„éƒ¨ç½²ã€‚åœ¨é›†ç¾¤ä¸­è¿è¡Œçš„ Pod æœ‰ä¸€ä¸ªåŠ¨æ€ IPã€‚å¦‚æœæ‚¨ä½¿ç”¨ IP å°†æµé‡ç›´æ¥è·¯ç”±åˆ°å®ƒï¼Œæ‚¨å¯èƒ½ä»ç„¶éœ€è¦åœ¨æ¯æ¬¡é‡æ–°å¯åŠ¨ Pod æ—¶æ›´æ–°è·¯ç”±è¡¨ã€‚äº‹å®ä¸Šï¼Œåœ¨æ¯æ¬¡éƒ¨ç½²æˆ–å®¹å™¨é‡å¯æ—¶ï¼Œéƒ½ä¼šä¸º Pod åˆ†é…ä¸€ä¸ªæ–°çš„ IPã€‚ä¸ºäº†é¿å…æ‰‹åŠ¨ç®¡ç† IP åœ°å€ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸€ä¸ªæœåŠ¡ã€‚è¯¥æœåŠ¡å……å½“ä¸€ç»„ pod çš„è´Ÿè½½å¹³è¡¡å™¨ã€‚å› æ­¤ï¼Œå³ä½¿ä¸€ä¸ª Pod çš„ IP åœ°å€å‘ç”Ÿå˜åŒ–ï¼ŒæœåŠ¡ä¹Ÿæ€»æ˜¯æŒ‡å‘å®ƒã€‚ç”±äºæœåŠ¡æ€»æ˜¯æœ‰ç›¸åŒçš„ IPï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨æ›´æ–°ä»»ä½•ä¸œè¥¿ã€‚

![](img/e6d7f28ddd9cf6b94054442aa88b0cf4.png)

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºæœåŠ¡:

```
kubectl expose deployment laravel-kubernetes-demo --type=NodePort --port=80
```

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ç¡®è®¤:

```
service "laravel-kubernetes-demo" exposed
```

è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
kubectl get services
```

å°†å‘æ‚¨æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„æœåŠ¡åˆ—è¡¨ã€‚æ‚¨è¿˜å¯ä»¥åœ¨ä»ªè¡¨æ¿ä¸­çš„â€œæœåŠ¡â€å¯¼èˆªèœå•ä¸‹æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„æœåŠ¡ã€‚éªŒè¯è¿™ç§éƒ¨ç½²å’ŒæœåŠ¡å…¬å¼€çš„æ›´ä»¤äººå…´å¥‹çš„æ–¹æ³•æ˜¾ç„¶æ˜¯åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºğŸ˜Š

è¦è·å–åº”ç”¨ç¨‹åº(æœåŠ¡)çš„ URLï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:

```
minikube service --url=true laravel-kubernetes-demo
```

å®ƒå°†è¾“å‡ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ IP åœ°å€å’Œç«¯å£å·:

```
[http://192.168.99.101:31399](http://192.168.99.101:31399)
```

æˆ–è€…ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­å¯åŠ¨åº”ç”¨ç¨‹åº:

```
minikube service laravel-kubernetes-demo
```

***ä¸è¦é”™è¿‡ä¸‹ä¸€ä¸ªæ•…äº‹ï¼Œå®éªŒæˆ–è€…æç¤ºã€‚å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç»§ç»­å…³æ³¨ã€‚å°†æ–°å†…å®¹ç›´æ¥å‘é€åˆ°æ‚¨çš„æ”¶ä»¶ç®±ï¼Œå¹¶æé«˜æ‚¨åœ¨ Kubernetes ä¸­çš„ä¸“ä¸šæ°´å¹³ã€‚* [*ç°åœ¨å°±è®¢é˜…*](https://learnk8s.io/newsletter)**

**ç¼©æ”¾**

å°±æ˜¯è¿™æ ·ã€‚æ‚¨å·²ç»æˆåŠŸåœ°åœ¨ Kubernetes ä¸­éƒ¨ç½²äº†åº”ç”¨ç¨‹åºã€‚å¾ˆåˆºæ¿€ã€‚ä½†æ˜¯åšè¿™äº›æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿå—¯ï¼Œæ‚¨åªæœ‰ä¸€ä¸ªéƒ¨ç½²ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª Pod æ­£åœ¨è¿è¡Œï¼Œè¢«æä¾›ç»™ä¸€ä¸ªå…·æœ‰å…¬å¼€çš„ web æœåŠ¡çš„èŠ‚ç‚¹ã€‚è®©æˆ‘ä»¬å°†è¿™ä¸ªéƒ¨ç½²æ‰©å±•åˆ°åº”ç”¨ç¨‹åºçš„å¦å¤–ä¸¤ä¸ªå®ä¾‹ã€‚

![](img/578139ec17d969166b57a5b41cdc2299.png)

ä¸ºäº†è®©æ‚¨äº†è§£è‡ªå·±æ­¤æ—¶æ‰€å¤„çš„ä½ç½®ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è·å–æ‰€éœ€çš„å’Œå¯ç”¨çš„ pod åˆ—è¡¨:

```
kubectl get deploymentNAME                    DESIRED CURRENT UP-TO-DATE AVAILABLE AGE 
laravel-kubernetes-demo 1       1       1          1         57m
```

æ¯ä¸ªçš„è¾“å‡ºå°†æ˜¯â€œ1â€ã€‚æ‚¨å¸Œæœ›æœ‰ä¸‰ä¸ªå¯ç”¨çš„å•å…ƒï¼Œå› æ­¤è®©æˆ‘ä»¬æ‰©å±•ä¸€ä¸‹:

```
kubectl scale --replicas=3 deployment/laravel-kubernetes-demo 
deployment "laravel-kubernetes-demo" scaled
```

å®Œæˆäº†ã€‚æ‚¨å·²ç»å°†ç¬¬ä¸€ä¸ªå•å…ƒå¤åˆ¶åˆ°äº†å¦å¤–ä¸¤ä¸ªå•å…ƒï¼Œè¿™æ ·å°±æœ‰ä¸‰ä¸ªå•å…ƒè¿è¡Œè¿™ä¸ªæœåŠ¡ã€‚è¿è¡Œ`get deployment`å‘½ä»¤å°†éªŒè¯è¿™ä¸€ç‚¹ã€‚

```
kubectl get deploymentNAME                    DESIRED CURRENT UP-TO-DATE AVAILABLE AGE 
laravel-kubernetes-demo 3       3       3          3         59m
```

æ‚¨ä¹Ÿå¯ä»¥åœ¨é¢æ¿ä¸­çš„â€œçª—æ ¼â€ä¸‹æˆ–åœ¨â€œæœåŠ¡è¯¦ç»†ä¿¡æ¯â€å±å¹•ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚

ç°åœ¨ï¼Œæ‚¨ä½¿ç”¨ä¸‰ä¸ª pod è¿è¡Œåº”ç”¨ç¨‹åºçš„ä¸‰ä¸ªå®ä¾‹ã€‚

æƒ³è±¡ä¸€ä¸‹æ‚¨çš„åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ æµè¡Œã€‚æˆåƒä¸Šä¸‡çš„è®¿é—®è€…æ­£åœ¨ä½¿ç”¨ä½ çš„ç½‘ç«™æˆ–è½¯ä»¶ã€‚è¿‡å»ï¼Œæ‚¨å¯èƒ½ä¸€ç›´å¿™äºç¼–å†™æ›´å¤šçš„è„šæœ¬æ¥åˆ›å»ºåº”ç”¨ç¨‹åºçš„æ›´å¤šå®ä¾‹ã€‚åœ¨ Kubernetes ä¸­ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæ‰©å±•åˆ°å¤šä¸ªå®ä¾‹:

```
kubectl scale --replicas=10 deployment/laravel-kubernetes-demo 
deployment "laravel-kubernetes-demo" scaled
```

ä½ å¯ä»¥çœ‹åˆ°ä½¿ç”¨ Kubernetes æ¥æ‰©å±•ä½ çš„ç½‘ç«™æ˜¯å¤šä¹ˆæ–¹ä¾¿ã€‚

**å…¥å£**

æ‚¨å·²ç»å–å¾—äº†å·¨å¤§çš„æˆå°±ï¼Œéƒ¨ç½²äº†åº”ç”¨ç¨‹åºå¹¶æ‰©å±•äº†éƒ¨ç½²ã€‚å½“æŒ‡å‘ç¾¤é›†çš„(Minikube) IP åœ°å€å’ŒèŠ‚ç‚¹çš„ç«¯å£å·æ—¶ï¼Œæ‚¨å·²ç»åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°äº†æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚ç°åœ¨ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä½•é€šè¿‡åˆ†é…çš„ URL è®¿é—®åº”ç”¨ç¨‹åºï¼Œå°±åƒéƒ¨ç½²åˆ°äº‘æ—¶ä¸€æ ·ã€‚

è¦åœ¨ Kubernetes ä¸­ä½¿ç”¨ URLï¼Œæ‚¨éœ€è¦ä¸€ä¸ªå…¥å£ã€‚å…¥å£æ˜¯ä¸€ç»„å…è®¸å…¥ç«™è¿æ¥åˆ°è¾¾ Kubernetes é›†ç¾¤çš„è§„åˆ™ã€‚å…¥å£æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºåœ¨ Kubernetes ä¸­ï¼Œåƒ Pods è¿™æ ·çš„èµ„æºåªæœ‰ IP åœ°å€ï¼Œè¿™äº› IP åœ°å€å¯ä»¥ç”±é›†ç¾¤è·¯ç”±ï¼Œä¹Ÿå¯ä»¥åœ¨é›†ç¾¤å†…è·¯ç”±ã€‚è¿™æ„å‘³ç€å®ƒä»¬å¯¹äºå¤–éƒ¨ä¸–ç•Œæ˜¯ä¸å¯è®¿é—®æˆ–ä¸å¯åˆ°è¾¾çš„ã€‚

![](img/76122a395825f27489e1a46bed54b196.png)

æˆ‘å·²ç»åœ¨è¿™ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åºçš„æºä»£ç ä¸­åŒ…å«äº†ä¸€ä¸ª`ingress.yaml`æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹:

```
apiVersion: extensions/v1beta1 
kind: Ingress 
metadata: 
  name: laravel-kubernetes-demo-ingress 
  annotations: ingress.kubernetes.io/rewrite-target: / 
spec: 
  backend: 
    serviceName: default-http-server 
    servicePort: 80 
  rules: 
  - host: laravel-kubernetes.demo 
  - http: 
      paths: 
      - path: / 
        backend: 
          serviceName: laravel-kubernetes-demo 
          servicePort: 80
```

åœ¨ Kubernetes èµ„æºæ–‡ä»¶çš„åŸºæœ¬å†…å®¹ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†è·¯ç”±å…¥ç«™æµé‡æ—¶è¦éµå¾ªçš„ä¸€ç»„è§„åˆ™ã€‚`laravel-kubernetes.demo` URL å°†æŒ‡å‘åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œçš„æœåŠ¡ï¼Œå¦‚ä¹‹å‰åœ¨ç«¯å£ 8181 ä¸Šæ ‡è®°çš„`laravel-kubernetes-demo`ã€‚

æ²¡æœ‰å…¥å£æ§åˆ¶å™¨ï¼Œå…¥å£èµ„æºå°±æ²¡æœ‰ç”¨ï¼Œå› æ­¤æ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨æˆ–ä½¿ç”¨ç°æœ‰çš„æ§åˆ¶å™¨ã€‚æœ¬æ•™ç¨‹ä½¿ç”¨ Nginx å…¥å£æ§åˆ¶å™¨æ¥è·¯ç”±æµé‡ã€‚Minikube (v0.14 åŠä»¥ä¸Šç‰ˆæœ¬)é™„å¸¦ Nginx å®‰è£…ç¨‹åºï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨å¯ç”¨å®ƒ:

```
minikube addons enable ingress
```

> *è¯·æ³¨æ„ï¼ŒMinikube ä¸‹è½½å¹¶å®‰è£… Nginx ä½œä¸ºå…¥å£å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚*

ä¸€æ—¦æ‚¨å¯ç”¨äº† Ingress æ’ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»º Ingress:

```
kubectl create -f path-to-your-ingress-file.yaml
```

æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯å¹¶è·å–å…¥å£ä¿¡æ¯:

```
kubectl describe ing laravel-kubernetes-demo-ingress
```

å…¶è¾“å‡ºç±»ä¼¼äº:

```
Name: laravel-kubernetes-demo-ingress 
Namespace: default 
Address: 192.168.99.101 
Default backend: default-http-server:80 (<none>) 
Rules: 
  Host Path Backends 
  ---- ---- -------- 
  * 
       / laravel-kubernetes-demo:8181 (172.17.0.6:8181) 
Annotations: 
  rewrite-target: / 
Events: 
Type   Reason Age  From                     Message 
----   ------ ---- ----                     ------- 
Normal CREATE 39s  nginx-ingress-controller Ingress default/laravel-kubernetes-demo-ingressNormal UPDATE 20s  nginx-ingress-controller Ingress default/laravel-kubernetes-demo-ingress
```

ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡å¦‚ä¸Šæ‰€ç¤ºçš„ minikube IP åœ°å€è®¿é—®åº”ç”¨ç¨‹åºã€‚è¦é€šè¿‡ URL[https://laravel-kubernetes . demoï¼Œ](https://laravel-kubernetes.demo,)è®¿é—®åº”ç”¨ç¨‹åºï¼Œæ‚¨éœ€è¦åœ¨ hosts æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ã€‚

# è¿™ä»…ä»…æ˜¯å¼€å§‹

å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ ç†Ÿæ‚‰ Kubernetesã€‚ä»æˆ‘è‡ªå·±çš„ç»éªŒæ¥çœ‹ï¼Œä¸€æ—¦ä¸€ä¸ªäººæ‰§è¡Œäº†å‡ æ¬¡æˆ–æ›´å¤šæ¬¡ç±»ä¼¼çš„éƒ¨ç½²ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—ä¹ ä»¥ä¸ºå¸¸ï¼Œå˜å¾—æ›´æœ‰æ„ä¹‰ã€‚ä½†æ˜¯æˆ‘ä»¬çš„ Kubernetes ä¹‹æ—…æ‰åˆšåˆšå¼€å§‹ã€‚åœ¨ä»¥åçš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»æ›´å¤šä½¿ç”¨å­˜å‚¨å·æ¥æŒä¹…åŒ–çŠ¶æ€çš„çœŸå®åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬è¿˜å°†äº†è§£å¦‚ä½•éƒ¨ç½²åˆ°äº‘æä¾›å•†ï¼Œå¦‚ Google çš„äº‘å¹³å°ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè¯·æŸ¥çœ‹è¿™äº›[è¯¾ç¨‹](https://learnk8s.io/training)ä»¥æé«˜é€Ÿåº¦ï¼Œç”šè‡³æœ‰å¯èƒ½æˆä¸ºè®¤è¯ Kubernetes ç®¡ç†å‘˜(CKA)ã€‚

# æˆä¸º Kubernetes ä¸­éƒ¨ç½²å’Œæ‰©å±•åº”ç”¨ç¨‹åºçš„ä¸“å®¶

æœ¬æ–‡æ˜¯ learnk8s ç ”è®¨ä¼šâ€œåœ¨ Kubernetes ä¸­éƒ¨ç½²å’Œæ‰©å±•åº”ç”¨ç¨‹åºâ€çš„ä¸€éƒ¨åˆ†ã€‚

åœ¨æœ¬è¯¾ç¨‹çš„å‰©ä½™éƒ¨åˆ†ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•:

*   è½»æ¾å¤„ç†æœ€ç¹å¿™çš„æµé‡ç½‘ç«™
*   å°†æ‚¨çš„ä½œä¸šæ‰©å±•åˆ°æ•°åƒå°æœåŠ¡å™¨ï¼Œå¹¶å°†ç­‰å¾…æ—¶é—´ä»å‡ å¤©ç¼©çŸ­åˆ°å‡ åˆ†é’Ÿ
*   äº†è§£æ‚¨çš„åº”ç”¨åœ¨å¤šäº‘è®¾ç½®ä¸‹é«˜åº¦å¯ç”¨ï¼Œè®©æ‚¨é«˜æ•æ— å¿§
*   é€šè¿‡ä»…ä½¿ç”¨æ‚¨éœ€è¦çš„èµ„æºï¼Œåœ¨æ‚¨çš„äº‘è´¦å•ä¸ŠèŠ‚çœå¤§é‡ç°é‡‘
*   å¢å¼ºæ‚¨çš„äº¤ä»˜æ¸ é“ï¼Œå…¨å¤©å€™éƒ¨ç½²åº”ç”¨ç¨‹åº

é™„:ä¸è¦é”™è¿‡ä¸‹ä¸€ä¸ªå®éªŒï¼Œæ´å¯ŸåŠ›ï¼Œæˆ–*æŠ˜æ‰£* : [è®¢é˜…é‚®ä»¶åˆ—è¡¨ï¼](https://learnk8s.io/newsletter)

*æ–‡ç« åŸè½½äº*[*learn k8s*](https://learnk8s.io/blog/kubernetes-deploy-laravel-the-easy-way)*ã€‚io*