# 让网络再次变得伟大:一次一个终点。(第 1 部分—前端)

> 原文：<https://medium.com/hackernoon/make-the-web-great-again-one-end-at-a-time-part-1-frontend-f9a9e462513a>

这是一个由三部分组成的系列文章的第 1 部分，我希望在这里分享我在 web 开发方面的一些经验，以及它们如何帮助用户获得更快的 web 体验。在这一部分，重点是前端。(注:我是一名后端开发人员，所以我可能会遗漏一些东西)

# 一点背景知识…

![](img/6afac2aeca794929721c965144700b34.png)

PS: I have no associations with the public figure linked with these type of caps.

就 web 应用程序和网站的开发或部署方式而言，web 开发领域已经经历了很多变化。这些变化大部分的原因很简单一件事，速度！开发速度、部署速度、执行速度。这是因为网络在很长一段时间里落后于所有的本地平台。缓慢的网络连接也没有帮助。但是所有这些都在改变，并且还在继续改变。设备规格在不断发展，新的技术和工艺正在开发中，以解决所有这些问题。

这里有一个非详尽的列表，列出了你可以在前端/客户端做的事情，让你的网络应用/网站更快。尽情享受吧！

# 1.考虑速度的设计

我有幸在[的 Devshop](http://devshop.co.zw) 和我认识的一些最伟大的前端开发人员一起工作。其中一个人，[弗里曼](https://twitter.com/CmdRaptor)，总是说“jpg 是为疯狂的人准备的”【用一个不那么名副其实的博客帖子取代疯狂的人】。他认为图像背景不仅难看，而且会使网站加载速度变慢。取而代之的是，他建议使用类似渐变的东西，这显然比图片加载更快，这很有意义。一个完美的例子是[对话](https://dialogue.co.zw)的设计，这是一个我们开发的社交媒体应用程序，用于发送带有特定关键字或标签的推文。

考虑速度的设计意味着开发者在用户能够真正看到或使用应用程序/网站之前，对用户的浏览器必须下载的内容持谨慎态度。请记住，用户可能在使用计量移动数据的缓慢或不稳定的网络上，因此他们从你的应用程序/网站获得价值的价格必须总是很低。但这不仅有助于用户，而且确保浏览器下载更少的资源，有更少的渲染阻塞操作要做，然后给出闪电般的速度。

# 2.减少渲染阻塞操作

浏览器渐进地处理 HTML 和 CSS，这意味着它会在元素出现时呈现它们。例如，当呈现 body 元素时，如果已经有了样式，浏览器会希望立即对其应用样式。如果没有，那么它会一直等到拥有它们，这通常是下载一个外部样式表。这就是渲染阻塞脚本的本质含义。这就是为什么建议使用内联样式，因为这样可以减少浏览器等待样式应用于元素的次数。这也是为什么样式被加载在顶部的原因，这样浏览器就已经有了它所需要的一切来进行绘制。

执行 [Javascript](https://hackernoon.com/tagged/javascript) 。这是导致渲染受阻的另一个常见原因。每当浏览器遇到一个<脚本>标签，它必须下载 Javascript 文件，如果是外部文件，解析然后执行。浏览器会等待这一切发生，因为 Javascript 可以改变元素，因此在呈现下一个元素之前必须完全加载。这就是为什么建议在 HTML 的底部加载 Javascript。这样，浏览器已经呈现了所有的元素，并对它们进行了着色。即使交互性还不可用，但至少用户不会盯着一个空白页面😉。

(侧栏，Chrome 通过使用即时编译器将 Javascript 编译成机器码来提高速度，这与产生字节码或任何其他中间代码的解释器不同。在这里阅读。)

# 3.并行资产加载

这涉及到跨不同的域和子域传播网站的资产。这很有帮助，因为一个浏览器在同一时间只能建立有限数量(我想是 6 个)的连接到同一个域。因此，分散资产意味着浏览器同时下载更多的内容。

这就是 cdn 大放异彩的地方。这些内容交付网络通过将您的文件副本托管在全球多个地区来确保全球范围内的高可用性。他们不仅会更快地为你的文件提供服务，而且会从一个不是你网站的域名提供服务。这意味着浏览器反而节省了一个到网站服务器的连接。

即使你不使用 CDN，你也可以将你的资产分散到你网站的子域名中。与顶级域相比，浏览器将子域视为完全不同的域。这是因为子域需要自己的 DNS 查找。我听到你说“那不就意味着浏览器有更多的 DNS 查询要做吗？”。嗯，是的，但不尽然。

现代浏览器实现了一种叫做 DNS 预取的功能。W3C 规范中的定义说

> DNS-预取链接关系类型用于指示将用于获取所需资源的来源，并且用户代理应尽早解决

实际上，浏览器会在实际需要解析域名之前对其进行预解析。这是通过在 HTML 的中添加下面的<link>来实现的。

```
<link rel="dns-prefetch" href="https://subdomain.mydomain.com">
<link rel="dns-prefetch" href="https://cdn.com">
```

因此，您可以对您的子域和 CDN 域这样做，以改善用户感知的延迟。

对于 Javascript，我推荐 [JSDeliver](https://www.jsdelivr.com/) ，这是一个免费、快速、可靠的开源 CDN。我真的很喜欢它，因为它可以提供来自 [npm](https://npmjs.com) 的脚本，并在运行中缩小它们。因此，要在 npm 上加载 Javascript SDK，对于我曾经在这里写的新闻 API，只需使用下面的脚本。

```
<script type="text/javascript" src="[https://cdn.jsdelivr.net/npm/zimnews-api@0.0.1/index.min.js](https://cdn.jsdelivr.net/npm/zimnews-api@0.0.1/index.min.js)>
```

对于图片，我强烈推荐 [Cloudinary](https://cloudinary.com) ，这是云中的一个端到端媒体管理平台。将图像/视频托管的负担交给他们，他们在全球 cdn 上为您的媒体提供服务方面做得非常好。

# 4.压缩和缩小

![](img/b61d931388ae0131a9fa0d8c439854e0.png)

Lol.

这两者有时会被混淆(我也曾经这样认为)，但事实上它们不是。然而，他们合作得很好，在减少文件大小方面取得了很大的进步，并最终提高了网站的速度。

缩小是指删除文件中的空白、注释和不必要的分号的过程，这只会使代码对开发人员可读，但对浏览器不一定有用。

Gzipping 是一种压缩技术，它用指向第一次出现的文本的指针来替换重复的文本。这对于必然会出现大量重复的 CSS 文件尤其有用。Javascript 文件也是如此，其中可能有对特定函数的多个引用，因此函数名变成了被替换的重复文本。
替换文本通常比它所替换的文本更小，即字符更少，这就是 Gzipping 减小文件大小的方式。

为了说明这一点，这里有一个来自 CSS-tricks.com 的例子。

![](img/6b3b1badcfd958c8bf0616eec13244d0.png)

Please allow those savings to sink in!

因此，这意味着在你的构建管道中，你必须再增加一个步骤来缩小和压缩你的资产，也许是在你把它们推到 CDN 之前。有些服务器可以为您压缩资产，但这是本系列第 3 部分的内容。

# 5.服务人员

![](img/09c39bdfccc1038cd748e1c214daf7a8.png)

I still don’t know what the flying cat is for 😂

如果你关注我的大部分帖子或者了解我，你会知道我是 PWAs 的超级粉丝。渐进式网络应用是网络坐在本地男孩的桌子上，并在用户的主屏幕上占据一席之地的成功尝试。这项技术允许网络应用程序/网站的图标保存在用户的主屏幕上。这显然意味着应用程序/网站必须随需应变，即使用户的设备离线！就像，不再有恐龙了！

PWAs 的核心是服务人员。这是一种特殊类型的 Javascript 工作者，他们只是在后台运行的脚本，在他们自己的线程中。众所周知，服务工作者在网络和客户端之间充当代理，进行缓存。有了这个，你可以缓存你的应用程序启动所需的所有资产，并为用户提供价值，即使他们离线。这显然意味着即使在设计中，离线功能也要考虑在内。

除了离线使用，服务人员还被用来显著加快 web 应用/网站的后续加载速度。这是通过根据要缓存的文件的性质/优先级来实现这里描述的缓存策略之一来实现的。

有很多关于如何编写自己的服务人员的教程，但是我强烈推荐使用 WorkboxJs。这是一个为您处理生成服务工作者的库，甚至在构建时也是如此。这个生成的服务工作者基于您给 WorkboxJs 的配置。我在这篇文章中写到了它。

[](https://codeburst.io/workbox-the-easier-way-of-adding-a-service-worker-to-your-web-app-b0a1f26ef96c) [## Workbox，向您的 web 应用程序添加服务人员的更简单方式。

### Workbox 是一个库和构建工具的集合，可以很容易地将您的网站文件存储在本地，在您的…

codeburst.io](https://codeburst.io/workbox-the-easier-way-of-adding-a-service-worker-to-your-web-app-b0a1f26ef96c) 

# 6.利用网络工作者完成大型任务

都 2018 年了！主线程成为 UI 线程的年份。网络工作者非常适合卸载任何潜在的计算繁重的任务。Web workers 很像服务 worker，运行在独立于主线程的自己的线程中。与服务人员的规格不同，他们对于执行计算繁重的任务非常有用，如[对图像应用滤镜](https://www.youtube.com/watch?v=X57mh8tKkgE)，搜索大型数据集等。

最近，我为自己的小公司开发的一个应用程序出现了问题，这个应用程序叫做 [frello](http://frello.co.zw) 。我发现在手机上搜索数据表时性能下降了。为了解决这个问题，我将搜索功能移到了一个 web worker 中。本质上，onkeyup 将数组/数据和搜索关键字传递给 worker，然后 worker 根据传递的关键字进行搜索。然后使用 postMessage()将结果传递回主线程，并显示在表中。删除了许多 jank，并且有明显的性能提升，因为键盘在输入时不会再冻结。

我想探索的另一个途径是让两个线程共享对同一个数据存储的访问，这样 onkeyup 就只传递搜索短语。我确信这样做会有更多的性能提升。

不服气？Checkout [greenlet](https://www.npmjs.com/package/greenlet) by [杰森·米勒](https://twitter.com/_developit)，一个将任何异步代码转移到工人身上的小脚本。因此，像从远程服务中检索数据这样的任务可以通过 web worker 中的 fetch()来完成。起初我认为这整个热潮是疯狂的，但仔细想想，它确实很有意义。

# 7.代码分割

这是把你的应用程序分成块，然后异步加载，遵循用户加载你的 web 应用程序/站点的典型方式。例如，假设您的 SPA 有一个登录，通过代码分割，您可以将处理加载用户访问的第一个页面的代码与处理登录的代码分开。然后，当用户导航到登录部件时，异步加载后面的代码。这样，对于初始加载，用户的浏览器必须下载足够显示第一部分所需的 Javascript(和/或 CSS)。查看这篇伟大的文章，它解释了如何用 Webpack 编写 split VueJs 应用程序。

[](/js-dojo/3-code-splitting-patterns-for-vuejs-and-webpack-b8fff1ea0ba4) [## VueJS 和 Webpack 的 3 种代码分割模式

### 对单页应用程序进行代码拆分是提高其初始加载速度的一个很好的方法。因为用户不必…

medium.com](/js-dojo/3-code-splitting-patterns-for-vuejs-and-webpack-b8fff1ea0ba4) 

块的异步加载是由 ES6 动态导入()函数实现的，这个函数不是一个函数(不要问我为什么，[这个](/@WebReflection/javascript-dynamic-import-export-b0e8775a59d4)可能会帮助你)。import()以非阻塞方式加载异步模块。

然而，这意味着浏览器必须在每次页面加载时异步加载数据块。但是，如果您安装了一个服务工作者，并且您正确地预缓存了所有资产，那么这种异步加载可能只在第一次发生(或者永远不会发生)，因为块存储在缓存中。

代码分割显著减小了捆绑的 Javascript 文件的大小。正如上面第二个技巧所强调的，这最终提高了页面负载。

# 结论

我故意省略了堆栈，因为这完全是一个非常固执己见的讨论。然而，有一些 Javascript 框架可以让你的视图看起来更亮，从而加载更快，让你对不同的角度有更少的反应，你可以使用不同的角度来查看相同的橙色。(领会言外之意😂).UI 库也扮演着重要的角色，但是这也依赖于设计者或组织的设计模式倾向、最终用户的人口统计以及许多其他原因。

请随意分享你的意见、补充、建议等。谢谢你，❤️.