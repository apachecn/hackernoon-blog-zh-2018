# 验证 API 资源存在的中介行为

> 原文：<https://medium.com/hackernoon/mediatr-behaviors-to-validate-api-resource-existence-f81182e8a36c>

![](img/09ebd9e01b38fad249d3184796d6f094.png)

MediatR logo borrowed from [https://bit.ly/2N4Jz6S](https://bit.ly/2N4Jz6S)

在构建健壮的 API 时，验证和描述性的错误消息和状态代码非常重要。

在这篇文章中，我将向您展示如何通过添加 MediatR 行为来处理资源存在的验证，从而消除请求处理程序中的重复代码。

[mediator](https://github.com/jbogard/MediatR)是。NET 支持请求/响应、命令、查询、事件等。如果你没看过，就去看看吧。

在 MediatR 中，有一种叫做行为的东西，它允许你为请求建立自己的管道。我将它们用于横切关注点，比如日志记录和请求参数的验证。

最近，当一些端点被开发用于微服务时，我在我的请求处理程序中与重复代码作斗争，这是必须的。

为了给你一个例子，让我们从几个 API 端点开始，以及用重复代码实现请求处理程序。

本例中的端点是:

`PUT /groups/{id}`

`POST /groups/{id}/users`

控制器:

两个端点都需要验证 id 参数实际上匹配给定的组，以便能够更新组/向组添加用户(在我的示例中，我使用 EF Core 作为持久性，但是您可以安全地忽略它)。

正如您所看到的，在两个处理程序中都有一个针对组存在的 if-check。

我们应该如何摆脱这种重复？在这里使用某种“验证”作为预备步骤，这样请求处理程序看起来就像这样，不是很好吗？

为此感谢行为！让我们介绍一个请求:`UpdateGroupRequest`和`AddUserToGroupRequest`都实现的接口。

然后创建一个对上面定义的接口有通用约束的行为实现类，这样行为只适用于实现`IGroupRequest`接口的请求。

以及使用 Autofac 的注册示例:

现在，我们可以在没有 if 语句的情况下重写我们的请求处理程序，但仍然可以获得验证的好处！

假设我们现在添加了几个端点:

`GET /groups/{id}`

`POST /groups/{id}/permissions`

将`IGroupRequest`接口添加到您的请求中，您将获得开箱即用的特性。相当简单！我发现这种方法非常有用。你怎么想呢?

我们必须记住，这种方法既有优点也有缺点。我发现的是:

# 骗局

*   如果您有一个验证存在性的数据库，则需要多次往返。
*   验证作为一个单独的类，这可能会让一些开发人员感到困惑

# 赞成的意见

*   实际请求处理程序中更干净的代码
*   没有分散在所有需要验证实体存在的请求处理程序中的重复代码

如果你喜欢这篇文章。你知道该怎么做！👏