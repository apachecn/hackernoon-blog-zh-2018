# 创业公司的微服务:采访 Cloud66 的 Khash Sajadi

> 原文：<https://medium.com/hackernoon/microservices-for-startups-an-interview-with-khash-sajadi-of-cloud66-3df2ca945972>

*这次采访是为我们的* [*创业微服务*](https://buttercms.com/books/microservices-for-startups/) *电子书做的。一定要去看看关于微服务的实用建议。感谢卡什的时间和投入！*

![](img/bcfbd061e0de12f3e19005d5b0af51e5.png)

[*Khash Sajadi*](https://twitter.com/khash?lang=en)*是*[*cloud 66*](https://cloud66.com/?utm_source=-&utm_medium=-&utm_campaign=Microservices-for-Startups-ebook)*的首席执行官，这是一项在您自己的服务器上构建、部署和管理应用的服务。*

对于上下文，您的工程团队有多大？您是否正在使用微服务，能否概述一下您是如何使用它们的？
目前我们团队有 14 名工程师，几乎所有人都是全栈开发人员。他们中的大多数都关注后端，主要是围绕微服务。

我们在 2012 年末推出了 Cloud66，并在 2013 年初推出了我们的首款产品。正如你可以想象的那样，当时微服务并不一定是一件大事，或者人们并没有真正考虑容器。我们想做的是，鉴于我们的背景看到了我们在大公司的初创公司中面临的相同挑战，我们希望让人们能够简单地在云中启动和运行，并将服务器的供应和配置带入云空间。

然而，不变的是你面前的 Linux 终端让服务器做你想让它做的事情所需要的时间。因此，虽然我们把八周缩短到了五分钟，但我们并没有对之后发生的事情做太多。这就是我们要做的。所以我们从 Ruby on Rails 开始，把它作为很多开发人员使用的框架；我们开始自动化，前提是，你可以考虑使用自己的服务器。这使我们在该领域获得了很多客户，大约在 2014 年，你开始听说 Cloud66 对 Rails 很好，但我想拥有我的 Node.js，或者我想拥有我的 G，o API，或者我有这个 PHP 东西。我们开始四处寻找，并意识到如果我们知道在哪里围绕什么是开发人员的角色和什么是运营人员的角色绘制一个非常清晰的边界，我们也可以做同样的事情。我们认为容器内的任何东西——如果我们选择容器作为向客户交付服务的技术——容器内的任何东西都是开发人员的责任。集装箱外的任何东西都是行动组的责任。因此，容器作为微服务的心脏或引擎或大脑，其清晰的边界是我们踏上这一旅程的第一步。

**你是从单体开始，后来采用微服务的吗？采用微服务的动机是什么？你是如何评估权衡的？**

我们一开始是一个整体，周围只有很少的辅助服务。

我们建造了这个整体，它表面上是整体，因为它是相同的代码库，它存在于相同的存储库中。但是，在不同的架构层之间，以及在同一个整体中的不同微服务之间，会有这样的界限。

因为我们没有那些支持微服务的基础架构或运营组件，随着我们向团队中添加更多的人员，他们开始偏离这一点，所以我们开始有了这个想法。我们偏离了这一点。然后，当我们开始拥有能够让我们采用微服务的工具集时。

**作为一个团队/工程组织，你是如何处理微服务这个话题的？是否围绕微服务的定义进行了讨论？**

我们是一个小团队，这意味着我们很少就如何解决具体问题进行正式讨论。几乎每个人都参与了每一步。我们仍然或多或少处于几个披萨饼大小的团队中。因此，这并没有真正以正式的方式发生，因为有一个软件团队拥有微服务架构，或者有一个微服务 cop 组负责管理或规定架构指导方针。

随着团队的成长，遵循这一原则变得越来越困难，因为当它开始时，你想快速交付，你想快速前进，你专注于成长和围绕它的各种事情，这意味着当你雇佣更多的人时，他们不一定分享你的背景，他们甚至不一定熟悉隔离的面向服务的架构的原则。

为了应对采用微服务，您是否改变了团队的组织或运营方式？

作为一个小团队的功能，在很多情况下，你最终会把一个或几个开发人员孤立到一个特定的特性中。作为一名业务开发经理，[你]应该委托一两个开发人员去做发现、设计、演示、实现和测试。在许多情况下，甚至在操作上，如果您很小，也要在操作上支持应用程序中的特定功能。尽管您希望在您的小型开发团队中共享关于小型系统或大型系统的几乎所有方面的知识，以便您可以传播知识并降低您的组织风险，但如果您希望获得网络等方面的网关支持，那么很自然地就会有这样一个人。另一个人非常了解备份系统，因为他们开始设计、展示、实施并支持它。现在这些团队/人/子团队之间基本上结束了一个组织的微服务。因此，备份人员找到存储人员，说:“我们有这些东西，希望您长期存储。”这就好像他们在谈论基于合同的编程。然后仓库的人会说，“好的，以这种格式给我们，然后在这个集合点放下它。我们会拿起它，这是您请求恢复的方式。它可能不会真正变成一个整体中的两个独立的微服务，甚至不会变成一个微服务架构。但你可以看到人们尊重彼此的契约和界限，并沿着这些路线发展。

**在技术选择上有多少自由？你们是否都同意坚持使用一个堆栈，或者是否有尝试新堆栈的灵活性？你是如何做出那个决定的？**

这是一个非常有趣的问题，因为你可以看到采用微服务、容器、云协调和所有这些东西几乎解放了开发人员或团队，让他们可以选择任何他们想要的最佳工具来完成工作，并以一种安全不会泄漏到其他东西的方式来实现它。另一方面，也许我们作为一个行业来做这件事的时间还不够长，还没有看到其中的陷阱。

我有点知道其中的陷阱，现在我可以看到运营人员说，“这是一台装满糖果的自动售货机。你知道 M&M 和其他任何你想要的。我们只是用我们认可的方式包装它。你只需要让开发人员进来，输入你想要的 M&M 类型的数量，它们就会掉下来。”而且效果很好。你不会让任何人被解雇的。你也可以为这个自动贩卖机做贡献，把你自己的糖果打包放在牢房里给下一个人。

你有没有把一个单一的应用程序分解成更小的微服务？如果是的话，你能给我们介绍一下这个过程吗？

将一个 monolith 应用程序放入一个单独的容器中运行，并说我们将它容器化，这是没有什么价值的。容器的价值来自微服务，来自于将应用程序分解成更小的部分，并在您的开发团队中实施您需要的规程，以推动此事向前发展。从那时起，我们开始将微服务集成到 Cloud66 中。

**你是如何完成这项任务的？**

我们的背景是，我们已经与面向服务的架构、整个 Martin Fowler 领域驱动的设计、基于合同的设计一起工作过——我们拥有的所有这些理论都被引入到软件工程中。我们意识到，作为一家公司，我们需要为自己以及我们的客户解决的微服务挑战与 10 年前我们不得不采用面向服务的架构时非常相似，不仅如此，还不止于此。

现在，在 2017 年，我们完全在容器中运行 Cloud66。这是一个基于微服务的架构。Cloud66.com 本身就在集装箱里运行。我们在由 Docker 作为运行时引擎支持的社区中运行。我们有一些非常大的组件，它们不是微服务，不在容器内。为此，我们也采用了与微服务相同的方法。一个例子就是我们所说的构建网格，它是一组构建映像的裸机服务器，我们无法在容器内完成。这不可能发生在服务内部。我们仍然在思考这个问题，我们仍然把它作为一项服务来做。可能不是微服务。这更像是一项宏观服务，但仍是一回事。我们采用了完全相同的服务发现和弹性原则，这带来了可伸缩性，试图实现无状态性，所有这些都与容器无关。因此，我们的数据库、存储、关键价值存储、排队系统、指标和构建网格都不在容器内，而是遵循微服务原则。

**有哪些不可预见的问题和经验教训？**

我们建造了这个整体，它表面上是一个整体，因为它是相同的代码库，它存在于相同的存储库中。但是，在不同的架构层之间，以及在同一个整体中的不同微服务之间，会有这样的界限。但是随着团队的成长，遵循这一原则变得越来越困难，因为当它开始时，你想要快速交付，你想要快速前进，你专注于成长和围绕它的各种事情，这意味着当你雇佣更多的人时，他们不一定分享你的背景，他们甚至不一定熟悉隔离的面向服务的架构的原则。还因为面向服务的架构，例如，对代码编写方式非常肤浅，而不是在支持微服务的基础设施中。很容易偏离那个原则。一个例子是:例如，如果你正在运行微服务，你需要有支持它的基础设施。例如，服务发现是微服务的一个关键特性，在面向服务的架构中，你有 DIs 之类的东西，以及提供某种疯狂的半服务发现的东西，但你不一定必须拥有它。因为我们没有支持一个微服务的基础架构或运营组件，随着我们向团队中添加更多的人员，他们开始偏离这一点，所以我们开始有了这个想法。我们偏离了这一点。然后，当我们开始拥有工具集，使我们能够在组织级别和运营级别采用微服务时，我们再次开始往回走。

你如何确定服务边界？

对我来说，我认为这是一件有多重答案的事情，没有一个答案是对或错的。只是看你遵循哪个原则了。对我们来说，这很大程度上是我们在领域驱动设计的基础上遵循面向服务架构的相同原则。这就是我们决定要做的事情。

**你团队中的讨论是怎样的？**

我们采用了领域驱动的设计，因为我们希望能够以一种他们能理解，我们也能理解的方式，用一种语言与企业交流。我们基本上同意这个共同的词汇，当我们说“数据库”，你的意思是什么？是服务器还是数据库？这意味着什么呢？当我们说网络时，我们指的是什么？当你说港口的时候——就像所有的事情一样。我说的业务是指运营人员，也就是在云中运行数据中心的人员。所以我们采用了领域驱动的技术设计，这是马丁·福勒的定义，因为我们想和我们的客户有一个共同的语言。在此基础上，你就可以开始服务于操纵特定领域的小事物。因此，我们有了工厂的概念，我们有了存储库的概念，然后你有了服务的概念，其中业务功能从头到尾都在一个或多个域对象上操作。这是其中一个定义。但好的一面是，如果你全盘接受的话，这是有意义的。如果你完全按照领域驱动的设计、存储库和工厂以及所有类似的东西去做，那么服务的定义基本上是有意义的。你看到一切都开始适应它们的位置。我们的一些客户完全不同地划分系统的界限，有时他们的服务会互相影响。有时这是可行的，但对我们来说，我们见过的最成功的微服务实现要么是基于软件设计原则，如领域驱动设计，面向服务的架构，要么是反映组织方法的架构。

你能举些例子吗？

以支付团队为例，他们有支付服务或信用卡验证服务，这是他们向外界提供的服务。所以不一定和软件有关。它主要是关于 It 部门内的业务单位或团队向外部世界提供多一项服务。我们主要在银行中看到这种情况，尤其是在量化分析领域，那里有一些服务或库，为其他服务提供一些数学计算。这份合约的远期价格是多少？美元和英镑之间的汇率预测是多少？那些过去在 Windows 的世界里，在 D&L 和 dry 库里的服务，你可以编译到你的应用中的模块，现在作为服务被提供，有时甚至作为一个服务只是 Lambda 风格的东西。这是它的另一个苦恼。所以有一个与此无关的团队。过去，一些业务分析师通过电子表格、Excel 电子表格提供这些功能，然后调用模块库，在代码中进行编译，现在就可以作为服务端点提供。因此，我们基本上已经看到了这三种将边界划分到面向服务或微服务的最成功的方式。

**微服务对你的开发过程有什么影响？您的运营和部署流程？出现了哪些挑战，你是如何解决的？你能举些例子吗？**

因此，很多时候我们将容器和虚拟机相提并论，我们说当你想简化事情时，容器在很大程度上就像更小的虚拟机。但现实是，你不仅需要运营人员的支持来采用容器，你还需要开发人员的大力支持，因为这将开始进入微服务。从这个意义上来说，把一个整体应用程序放在一个容器中运行并说我们把它容器化了是没有什么价值的。容器的价值来自微服务，来自于将应用程序分解成更小的部分，并在您的开发团队中实施您需要的规程，以推动此事向前发展。从那时起，我们开始将微服务集成到 Cloud66 中。因此，我们的背景是，我们已经与面向服务的架构、整个马丁福勒领域驱动设计、基于合同的设计一起工作过——我们拥有的所有这些理论都被引入到软件工程中。我们意识到，作为一家公司，我们需要为我们自己以及我们的客户解决的微服务挑战与 10 年前我们不得不采用面向服务的架构所面临的挑战非常相似，不仅如此，还有更多的挑战。因此，如果你看看面向服务的架构所面临的挑战，例如，关于严格的纪律，关于服务之间的契约，我们所有兼容性和契约的版本以及围绕它的各种事情。你不仅有这些，而且边界不局限在同一个系统内。它可以被分解成多个系统、多个团队、多个代码库、多个基础设施需求等。从 2014 年开始，我们开始了这一旅程。现在，在 2017 年，我们完全在容器中运行 Cloud66。这是一个基于微服务的架构，我们 Cloud66.com 自己提供微服务。我们在由 Docker 作为运行时引擎支持的社区中运行。我们有一些非常大的组件，它们不是微服务，不在容器内。为此，我们也采用了与微服务相同的方法。我们采用了完全相同的服务发现和弹性原则，这带来了可伸缩性，试图实现无状态，所有这些都与容器无关。因此，我们的数据库、存储、关键价值存储、排队系统、指标和构建网格都不在容器内，而是遵循微服务原则。

**微服务对您的测试方式有何影响？**

我觉得微服务本身从你想到的任何方面来说，都只能是对测试有好处。它们不一定对质量有好处，但是如果你喜欢测试，每个人都应该这样，并且你认真对待测试，那么我认为微服务只会对质量有好处。原因是我们有传统的测试，单元测试，提取方法，标出软件不同部分之间的交互，用模拟的辅助工具单独测试每个部分，这很好，我们应该继续这样做。这就是代码覆盖的全部思想，等等。很像计算机科学 101。

在这方面有什么经验或建议？你能举些例子吗？

下一步是集成测试。我认为作为一个行业，作为软件工程师——我不想用“挣扎”这个词，但这一直是测试的症结所在。集成测试一直是症结所在，因为在您的生产中，事情实际上必须工作，您有这个昂贵的 Oracle 数据库，其中可能有特定的存储系统。或者甚至在云中，你可能有连接事物的特定方式。我们从来没有能够优先考虑微服务。我们从来没有在现实世界中真正做到过。微服务将允许我们——作为容器和围绕它的所有编排的副产品的反映——允许我们构建和启动这些迷你环境，这些运行的多方面应用程序实际上是真实的。你不需要模仿系统或你的数据库或其他任何东西。例如，如果它在生产中运行 MySQL，那么在测试中也运行 MySQL，而不是 SQLite。这是一个奇怪的例子，但你可以看出后面有很多。例如，在许多情况下，我们看到测试环境在微服务之前不使用真正的组件，如 RabbitMQ 或队列系统。他们用的是仿制的。所以我认为这是一件好事。

**微服务对安全性和控制数据访问有何影响？**

我认为如果使用得当，微服务作为一种软件工程实践是非常有益的。我回到我们采用的领域驱动设计和存储库的概念，本质上，你有一个位于数据前面的服务。因此系统中没有人说话，例如，直接对任何文件或任何数据库说话。对它的每一次访问都是通过一个叫做存储库的服务来管理的。这是 DDD 的设计原则。现在，它不一定是最好的。不一定是唯一的，这是肯定的。但如果你这样做了，你可以想象一下，你有一个这样的微服务作为你的数据的守护者和看门人，然后你可以从许多其他事情中受益，从 IP 访问控制列表到读写访问的不同部分，等等。这成为了一种很好的数据访问方式。我认为这是一个积极的方面，当你处理微服务时，你可以从中受益。本质上，服务是数据的看门人。

在这方面有什么经验或建议？你能举些例子吗？

当谈到真正实现这一点，而想象一个停留访问服务是相当容易做到的，而且在许多情况下也相当容易实现。实际上，当需要编写大量代码时，您往往会将整个系统暴露给比其他情况下更安全的用户。原因是，归根结底，这些服务是在某个地方建立的。如今大多数时候，它是一个容器。它运行在一个容器引擎中，例如以非常真实的方式来自一个 Docker 映像。然后，您会遇到 Docker 映像或容器映像的安全性问题，以及它的构建位置。谁是为这个东西提供上游的供应商？是否存在任何安全漏洞？例如，如果我要直接与我的数据库对话以获取某些东西，这是我和数据库之间的事情，主要是在私人防火墙后面，各种各样的事情。但是，如果我通过一个服务提供这种访问，而这个服务运行在一个易受攻击的 Linux 发行版上，并通过一个可能易受某种安全攻击的 GRPC 服务公开，那么我就成倍地增加了这种影响。因此，微服务本身作为一种理论可以真正有助于保证对数据的安全密集型访问，这一点始终很重要。但有时在非常技术性和非常低级的方面，他们实际上妥协更多，所以你必须有最好的工具和实践到位，以确保你知道计算机的漏洞，你可以修补它们和各种各样的事情。所以这就有了整个授权的问题，认证之类的事情也随之而来。

因此，我们有一个名为 Cloud66 Skycap 的产品，本质上我们称之为容器交付管道。它从您的代码库开始，到您的 orchestrator 结束。它所做的基本上就是处理这些事情，比如，我得到你的代码，我以这种方式构建它，你必须签署它，并且检查它来自哪里的上游。一部分是访问，一部分是安全性，一部分是最佳实践，一部分是工作流。可能是像在构建的不同部分之间移动工件这样的事情，这样你就可以确保开发人员不会错误地签入他们的 SSH 密钥，例如在映像中。

*再次感谢 Khash 的时间和投入！这次采访是为我们的* [*创业微服务*](https://buttercms.com/books/microservices-for-startups/) *电子书做的。一定要去看看关于微服务的实用建议。*

*本文原载于*[*buttercms.com*](https://buttercms.com/blog/microservices-for-startups-an-interview-with-khash-sajadi-of-cloud66)*。这是《创业公司的微服务》一书* [*采访系列的一部分。新章节一发布，你就可以通过电子邮件收到。*](https://buttercms.com/books/microservices-for-startups/)

如果你喜欢这篇文章，请在下面鼓掌帮助它传播！更多类似内容，请关注我们的[*Twitter*](https://twitter.com/ButterCMS)*和* [*订阅我们的博客*](https://buttercms.com/blog/) *。*

如果你想在你的网站上添加一个博客或者内容管理系统，而不是用 Wordpress， [*你应该试试黄油内容管理系统*](https://buttercms.com/) *。*