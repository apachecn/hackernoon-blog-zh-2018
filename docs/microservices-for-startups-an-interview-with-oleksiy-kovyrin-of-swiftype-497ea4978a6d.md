# 创业公司的微服务:采访 Swiftype 的 Oleksiy Kovyrin

> 原文：<https://medium.com/hackernoon/microservices-for-startups-an-interview-with-oleksiy-kovyrin-of-swiftype-497ea4978a6d>

*这次采访是为我们的* [*创业微服务*](https://buttercms.com/books/microservices-for-startups/) *电子书做的。一定要去看看关于微服务的实用建议。感谢 Oleksiy 的时间和投入！*

![](img/d0df9e7d2d82fb85b0c79a0eb86dcacb.png)

[*奥莱克西*](https://twitter.com/kovyrin?lang=en) *是 SRE*[*swift type*](https://twitter.com/Swiftype)*的负责人。Swiftype 是领先的网站搜索和企业搜索平台，支持对数千家企业和网站的搜索。Swiftype 是一家* [*弹性*](https://twitter.com/elastic) *公司。*

对于上下文，您的工程团队有多大？您是否正在使用微服务，能否概述一下您是如何使用它们的？

我们的团队相对较小。我们总共大约有 20 个人。三个专注于技术运营，其余的是工程师和设计师。我们的主要应用是一个多功能的整体(部署在不同的配置中以执行不同的任务)，但在过去几年中，它的许多功能已经被提取到微服务中:秘密管理、异步内容处理(特定于业务)等。

**你是从整体开始，后来采用微服务的吗？如果是，采用微服务的动机是什么？**

我们从一个整体开始，并且仍然在构建和维护一个包含我们大部分核心业务逻辑的大型中央应用程序上进行大量投资。该应用程序的结构支持添加和独立维护不同的 API，依赖于一组非常成熟的通用功能(如身份验证、访问控制、数据库访问、日志记录等)的内部抽象。monolith 应用程序中的 API 由不同的业务应用程序使用，完全可以被视为独立的服务。

除了主应用程序之外，我们还有许多高度专业化的微服务——专门处理少量紧密集中任务的应用程序。它们是在主要应用程序生命周期的不同时间引入的，目的也各不相同，但通常它们的开发背后至少有以下原因之一:

*   **不同的平台需求** —我们的主要应用程序是一个 Ruby 应用程序。这带来了许多非常有用的特性，如易接近性和非常成熟的图书馆生态系统等。不幸的是，有时候 Ruby 最终并不是最好的工具，我们使用不同的技术来实现更高效的服务。这里最受欢迎的选项之一是 JRuby——基于 Java 的 Ruby 实现，它为我们提供了真正的多线程并发，而没有全局解释器锁和更成熟的内存管理模型。
*   **共享组件** —我们的一些内部微服务已被部署为公共服务基础设施的一部分，并被多个业务应用程序用来实现秘密管理或身份验证等功能。
*   **高度专业化**——我们开发了几个微服务(或者更确切地说，是独立于 monolith 的专用应用程序),主要是因为它们有一个非常干净的小 API 来与主应用程序交互，并且它们使用专用的后端数据库、队列等，这使它们成为从 monolith 中分离出来的完美候选。

**作为一个团队/工程组织，你是如何看待微服务这个话题的？**

我们基础设施中的大多数微服务都是有机引入的。该团队认为从整体上分离出一个组件是有意义的，我们会对它进行调用。

在将新技术引入堆栈方面，我们有非常严格的内部政策来限制堆栈的大小。我们故意选择“令人厌烦的技术”，并尽量不引入新的技术，直到我们完全确定现有的组件无法解决该任务。在引入微服务时，我们非常清楚的一个重要问题是它们在生产中的可观察性和管理。添加到基础架构中的每个新服务都会增加运营它所需的资源量。当我们呼吁将功能从整体中分离出来时，这是我们考虑的最重要的问题之一，限制您的堆栈中不同技术的数量有助于简化多个服务的部署和操作。

**你有没有把一个单一的应用程序分解成更小的微服务？如果是的话，你能给我们介绍一下这个过程吗？**

根据我们的经验，我们倾向于在主要的 monolith 应用程序中开发我们的功能，我们可以访问许多重要的非常成熟的组件，如 auth、数据库访问层等。如果我们觉得某个特性应该被提取到一个专用的服务中，那么它会被有意地开发为 monolith 中的一个隔离的 API，然后，当它对团队有意义时(参见引入微服务的原因)，我们会将它拆分到一个单独的存储库/应用程序/服务中。

你如何确定服务边界？

我们在开发新服务时使用的一个主要基本原则是，它们不应该跨越数据库边界。每个服务都应该依赖于自己的底层数据存储集，并且应该是从业务逻辑层进入该数据存储的唯一入口点。这允许我们在应用程序中集中访问控制、审计日志、缓存逻辑等，并将数据库访问的范围限制到单个应用程序。关注数据库关系模型有助于识别可以作为独立服务轻松部署的潜在组件——如果数据库表/集合的子集与数据集的其余部分没有或只有很少的连接，这是一个强烈的信号，表明组件可以被隔离到独立的 API 或独立的服务中。

**微服务对您的开发流程、运营和部署流程有何影响？**

正如我之前提到的，每次我们考虑推出一项新服务时，我们都必须考虑这样做的运营成本。每个新的服务都增加了基础设施的复杂性，并使推理系统内的服务关系变得更加困难。运营我们的基础设施的最大成功之一是高度重视开发和部署流程所有方面的标准化。我们推出了用于配置管理、机密加密、漏洞管理、CI、部署、监控、日志记录等的库、框架和系统。我们对通用功能的标准化程度越高，部署和运营附加服务就越容易。

**微服务对你的测试方式有什么影响？**

将一项功能转变为微服务，必然会迫使我们对其外部接口(API)进行标准化，这使得隔离测试变得更加容易。这意味着更快的 CI 构建，更紧密的工程师反馈循环，从而导致更快的开发周期。在使用微服务时，我们必须牢记的一个重要问题是 API 稳定性和 API 版本控制。为了避免中断依赖于服务的应用程序，我们需要确保我们有一套针对微服务 API 的可靠集成测试，如果发生重大更改，我们必须为客户提供向后兼容的方式，以便他们按照自己的节奏迁移到新版本，从而避免大型跨服务 API 更改部署。

**微服务对安全性和控制数据访问有何影响？**

引入具有自己的数据存储的微服务使我们能够缩小数据库访问和应用凭证的范围。使用服务级访问控制可以让我们在控制访问的方式上更加灵活:在某些情况下，一个共享的秘密就足够了，对于某些服务，我们可以实现非常复杂的系统，包括令牌认证、审计日志等。

**您在微服务架构中遇到过管理数据一致性的问题吗？**

我们从不允许跨服务的数据库访问，所以我们所有的一致性控制都是在“拥有”数据库的服务中执行的。在某些情况下，这会导致数据集的有意非规范化，以确保特定数据库中的数据一致性，但我们接受这一功能，因为它使服务更少依赖于外部数据集。

*再次感谢 Oleksiy 的时间和投入！这次采访是为我们的* [*创业微服务*](https://buttercms.com/books/microservices-for-startups/) *电子书做的。一定要去看看关于微服务的实用建议。*

*本文原载于*[*buttercms.com*](https://buttercms.com/blog/microservices-for-startups-an-interview-with-oleksiy-kovyrin-of-swiftype)*。这是《创业公司的微服务》一书* [*采访系列的一部分。新章节一发布，你就可以通过电子邮件收到。*](https://buttercms.com/books/microservices-for-startups/)

如果你喜欢这篇文章，请在下面鼓掌帮助它传播！更多类似内容，请关注我们的 [*推特*](https://twitter.com/ButterCMS) *和* [*订阅我们的博客*](https://buttercms.com/blog/) *。*

如果你想在你的网站上添加一个博客或者内容管理系统，而不是用 Wordpress， [*你应该试试黄油内容管理系统。*](https://buttercms.com/)