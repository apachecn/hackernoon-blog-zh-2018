# 模仿？存根？还是垫片？

> 原文：<https://medium.com/hackernoon/mocks-stubs-or-shims-f22164422020>

![](img/1004985ffacec017d0817d08e64f030e.png)

如果你正在构建比简单的“Hello World”更复杂的东西。“app，有可能你会以依赖()告终。这些依赖关系在任何地方都可能不同，从访问系统资源(你认为“ *Hello World！*“真的到了你的屏幕？)、系统中的其他组件、外部资源、外部应用程序等等。更糟糕的是

*   依赖关系可能也在开发中
*   即使它们是稳定的，您也可能没有访问它们所必需的一切(例如，在 S3 获得的认证框架)
*   即使这样，您可能想要测试您不能保证的特定响应(它需要总是失败。或者成功。或者基于 PRNG 随机选择)

这就是*嘲讽*的用武之地，在这里你实质上假装你与依赖项的交互，这样你就可以在不依赖于你的依赖项的情况下实现*你的*东西。
这一切都很好，而且当你认真对待它时，实际上有点直观，有一个警告——当你开始搜索时，你可能会听到术语*模仿*、*存根*和*垫片*在某种程度上互换使用。

我倾向于坚持下面的语义。你可以选择也可以不选择使用这些，但是无论你用什么，一定要确保你和你团队中的其他人都达成一致。此外，为了将来的团队成员，也为了将来的你，把它记录下来！。
(或者见鬼，你可以沿着“*模仿是一种代码味道，#JustSayNo* ”的方式去存在。只要你对“*嘲弄*”的意思有一个一致的定义😆)

***模仿*** :完全替代依赖，复制你实际给出的大部分或全部行为。这些实际上会变得有些棘手(因此上面的“*代码味道*”裂缝)，因为，*在极端情况下*，你基本上需要跟踪/复制依赖的功能。话又说回来，如果你*能*在适当的地方设置一个好的嘲讽系统，那将是非常有价值的。
然而，关键是你与 mock 的交互方式与依赖项的交互方式完全相同，通过 API、接口、消息或其他方式。

![](img/e7e24b7e83a1b2622bddac3b8b4cfd5a.png)

***存根*** :这些是*模仿*的极度简化版本，它们通常只返回一组硬编码的值，并且/或者以简单的方式再次失败。如上所示，将 stub←→Mocks spectrum 想象成一个从最小功能到完整功能的过程。您与存根的交互方式与您与依赖项(API、接口等)的交互方式完全相同。).存根对于测试依赖关系的接口特别有用，因为只是让事情开始(硬编码的响应比没有响应要好！)

***垫片*** :有时你没有能力创建一个*存根*或一个*模拟*，要么是由于时间限制、复杂性，要么就是缺乏资源。在这些情况下，您可能会滑入一些代码，这些代码的行为基本上就像您在与依赖项进行交互一样。
使用*垫片*的关键是你*不要*使用接口——API、消息等。—你通常会得到的资源。例如，如果您需要从 S3 检索某些东西，您只需绕过整个 S3 界面，只需从本地文件中获取对象。

根据我的经验，垫片造成的混乱比我能应付的还要多。它们在你的代码中制造了一些弯路，这些弯路会让你产生一种错误的安全感，或者更糟，让你忘记自己曾经走过的弯路。小心使用它们，并且只在你绝对需要的时候使用(是的，有时候你会这样做！)

所以你有了它— *模拟*对*存根*对*垫片*！

*(* [*这篇文章也出现在我的博客上*](https://dieswaytoofast.blogspot.com/2018/09/mocks-stubs-or-shims.html) *)*