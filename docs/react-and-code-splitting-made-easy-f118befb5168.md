# ååº”å’Œä»£ç åˆ†å‰²å˜å¾—å®¹æ˜“

> åŸæ–‡ï¼š<https://medium.com/hackernoon/react-and-code-splitting-made-easy-f118befb5168>

ä»£ç åˆ†å‰²ä¸€ç›´æ˜¯ä¸ªé—®é¢˜ã€‚ä»é‚£æ—¶èµ·ï¼Œå½“ä½ æ·»åŠ å¤§é‡ä¸åŒçš„è„šæœ¬æ ‡ç­¾ï¼Œç›´åˆ° RequireJS å‡ºç°ã€‚

ä»£ç åˆ†å‰²ä¸€ç›´å­˜åœ¨ï¼Œè¢«æ”¯æŒï¼Œè¢«ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬è·³è¿‡â€œå¦‚ä½•â€æ”¯æŒå’Œä½¿ç”¨å®ƒçš„é—®é¢˜ã€‚æ— è®ºå¦‚ä½•â€”â€”ä»æµ·å¤–å¸¦æ¥ä»£ç å¹¶æ‰§è¡Œæ¸…å…³â€”â€”è¿™æ˜¯å¯ä»¥è®¨è®ºçš„ã€‚

![](img/dad984d22e751d8c7f3f7358cf174eb1.png)

Importing componentsâ€¦.

æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬è·³è¿‡å†å²è¯¾ï¼Œç›´æ¥è·³åˆ°ä¸€ä¸ªåŠ¨ä½œçš„å¼€å§‹ã€‚

## Webpack 2 å‡ºæ¥äº†ï¼Œç»™äº†ä¸€ä¸ªå¯¼å…¥ã€‚

ä»£ç åˆ†å‰²(åˆä¸€æ¬¡)æˆä¸ºä¸€ä»¶äº‹ï¼Œä¸‹å‘¨æˆ‘ä»¬æœ‰ä¸€ç¾¤â€œååº”åŠ è½½å™¨â€ã€‚ä½ æœ€å¥½é—®çš„ç¬¬ä¸€ä¸ªé—®é¢˜å¾ˆç®€å•

> ä¸ºä»€ä¹ˆæˆ‘éœ€è¦â€œåŠ è½½å™¨â€ï¼Ÿ

æ‰€ä»¥ï¼Œä½ åº”è¯¥å¯ä»¥æ¥å— npm åŒ…æˆ– React ç»„ä»¶åªç”¨äº*ä¸€åˆ‡*ã€‚ä¸ºä»€ä¹ˆä¸ç»™è£…è½½æœºè£…ä¸€ä¸ªç‰¹æ®Šçš„éƒ¨ä»¶å‘¢ï¼Ÿ

è¿™ç§ç»„ä»¶æœ€ç®€å•çš„ä»£ç æ˜¯ç®€çŸ­çš„ã€‚

è¿˜æœ‰ä»€ä¹ˆï¼Ÿè¿™ä¸ªç»„ä»¶å®é™…ä¸Šæ˜¯åšä¸€äº›çŠ¶æ€å¤„ç†ï¼Œå¹¶ä¸ºä½ çš„åº”ç”¨æä¾›ä»£ç åˆ†å‰²ã€‚ä½ å¯ä»¥ç…§åŸæ ·ä½¿ç”¨å®ƒã€‚

åªéœ€æ·»åŠ ä¸€äº›é”™è¯¯å¤„ç†ï¼Œé‡è¯•åŠ è½½ã€é¢„ç¼“å­˜ã€æµ‹è¯•çš„èƒ½åŠ›ï¼Œå½“æ‚¨åŠ è½½æˆ–æœªèƒ½åŠ è½½æ—¶æ˜¾ç¤ºæŸäº›å†…å®¹ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªçœŸæ­£çš„ react ç»„ä»¶ã€‚ä½ åº”è¯¥åªå†™ä¸€æ¬¡ï¼Œæˆ–è€…æœ€å¥½ä¸è¦èŠ±æ—¶é—´ä½¿ç”¨ç°æœ‰çš„è§£å†³æ–¹æ¡ˆâ€”â€”ä¸€äº›æ¥è‡ªå¼€æºçš„åº“ã€‚

## é‚£å¥½å§ã€‚æ€ä¹ˆæŒ‘é‚£ä¸ªåº“ï¼Ÿ

å¦‚æœä½ å» github æœç´¢ä¸€ä¸ªåº“â€”â€”ä½ ä¼šæ‰¾åˆ°å‡ ä¸ªï¼Œä»–ä»¬ä¼šé€‰æ‹©ä½ è¦ç”¨çš„é‚£ä¸ªã€‚

> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¦‚ä½•é€‰æ‹©ï¼Ÿ

é¦–å…ˆâ€”â€”å¿½ç•¥æ˜Ÿçº§è®¡æ•°ã€æäº¤ã€æ´»åŠ¨ç­‰ç­‰ã€‚â€œè£…è½½æœºâ€ä¸æ˜¯ç«ç®­ï¼Œæ­£å¦‚æˆ‘ä»¬åˆšåˆšå‘ç°çš„â€”â€”è¿™æ˜¯ **22 è¡Œç¨€ç–ä»£ç **ã€‚

ç¬¬äºŒâ€”çœ‹ APIã€‚ä½ è¦ç”¨ï¼ŒAPI è¦â€œé€‚åˆâ€ä½ ã€‚å®é™…ä¸Šï¼ŒAPI æœ‰ä¸¤ç§â€œå½¢å¼â€ã€‚

```
1\. loadable(() => import('./Home'))
2\. loadable({ loader: () => import('./Home') })
```

ä½ å¯ä»¥åœ¨ [react-imported-component](https://github.com/theKashey/react-imported-component) ã€[react-universal-component](https://github.com/faceyspacey/react-universal-component)å’Œ[loadable-component](https://github.com/smooth-code/loadable-components)ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªï¼Œè€Œç¬¬äºŒä¸ªâ€” [react-loadable](https://github.com/jamiebuilds/react-loadable) å’Œ [react-async-component](https://github.com/ctrlplusb/react-async-component) ã€‚

åœ¨â€œé¢å¤–çš„â€é€‰é¡¹ä¸­ä¹Ÿæœ‰ä¸€ç‚¹å°å°çš„ä¸åŒï¼Œä½ å¯ä»¥ä¼ é€’åˆ°åŠ è½½å™¨ä¸­

1.  å¯åŠ è½½å…ƒä»¶-æ‚¨å¯ä»¥æŒ‡å®šåŠ è½½æ—¶è¦æ˜¾ç¤ºçš„å†…å®¹ï¼Œåœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæˆ–è€…å¦‚ä½•æ˜¾ç¤ºå…ƒä»¶ã€‚

```
const Home = loadable(() => import('./Home'), {
  LoadingComponent: Loading,
  ErrorComponent: ErrorDisplay,
  render: ({ Component, loading, ownProps }) => {...})
});
```

Loadable-components è¿˜æå‡ºç”¨ç¬¬ä¸‰æ–¹å·¥å…·æ¥å¤„ç†å»¶è¿Ÿå’Œè¶…æ—¶ã€‚

[](https://github.com/smooth-code/loadable-components) [## å¹³æ»‘ä»£ç /å¯åŠ è½½ç»„ä»¶

### å¯åŠ è½½ç»„ä»¶ååº”ä»£ç åˆ†è£‚ï¼Œä½¿ç®€å•çš„âœ‚ï¸âœ¨

github.com](https://github.com/smooth-code/loadable-components) 

2.React-imported-component å®é™…ä¸Šæœ‰ç›¸åŒçš„ APIï¼Œåªæ˜¯å¼•å…¥äº†é¢å¤–çš„ onError å±æ€§ã€‚æœ€å¥½å‚è€ƒå¯åŠ è½½ç»„ä»¶è‡ªè¿°æ–‡ä»¶æ¥ç†è§£å¦‚ä½•å¤„ç†ååº”å¯¼å…¥ç»„ä»¶ã€‚

[](https://github.com/theKashey/react-imported-component) [## kashey/react-å¯¼å…¥ç»„ä»¶

### react-imported-component-Bundler ç‹¬ç«‹äºä»»ä½•å»¶è¿Ÿç»„ä»¶çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥å®ç°æ›´å¥½çš„ SSRã€ä»£ç æ‹†åˆ†å’Œâ€¦

github.com](https://github.com/theKashey/react-imported-component) 

3.React-async-component ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æœ‰å¾ˆå¤šæœ‰è¶£çš„é—®é¢˜å’Œç­”æ¡ˆã€‚

[](https://github.com/ctrlplusb/react-async-component) [## ctrl plusb/react-async-ç»„ä»¶

### å¼‚æ­¥è§£æç»„ä»¶ï¼Œæ”¯æŒä»£ç åˆ†å‰²å’Œé«˜çº§æœåŠ¡å™¨ç«¯â€¦

github.com](https://github.com/ctrlplusb/react-async-component) 

4.React-loadable ç•¥æœ‰ä¸åŒï¼Œé¦–å…ˆæ¥å—çš„ä¸ä»…ä»…æ˜¯â€œå¯¼å…¥â€å‡½æ•°ï¼Œè€Œæ˜¯ç”±æœ€ç»ˆç»„ä»¶è§£å†³(å³å®ƒå¯ä»¥å¤„ç†â€œæ˜ å°„â€)ï¼Œå°† LoadingComponent å’Œ ErrorComponent æ··åˆåœ¨ä¸€èµ·ï¼Œå¹¶å†…ç½®â€œå»¶è¿Ÿâ€åŠŸèƒ½ä»¥å‡å°‘åŠ è½½â€œå¾®è°ƒå™¨â€çš„é—ªçƒã€‚

```
Loadable({
  loader: () => import('./WillFailToLoad'), // oh no!
  loading: (props) => {
     if (props.error) {
       return <div>Error!</div>;
     } else {
       return <div>Loading...</div>;
     }
  }
});
```

 [## jamiebuilds/react-loadable

### react-loadable-:hourglass _ flow _ sand:ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œç”¨äºåŠ è½½å¸¦æœ‰æ‰¿è¯ºçš„ç»„ä»¶ã€‚

github.com](https://github.com/jamiebuilds/react-loadable) 

5.React-universal-component ä¸æ‰€æœ‰å…¶ä»–ç»„ä»¶ä¹Ÿæ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚å”¯ä¸€ä¸€ä¸ªæœ‰çœŸæ­£åŠ¨æ€çš„åŠ¨æ€å¯¼å…¥ã€‚

```
const Component = universal(props => import(`./${props.page}`))
```

> PS:è¿™ç§åšæ³•å¯èƒ½å‰¯ä½œç”¨å¾ˆå¤§ï¼Œè¦æ³¨æ„ã€‚

[](https://github.com/faceyspacey/react-universal-component) [## é¢ç©ºé—´/ååº”é€šç”¨ç»„ä»¶

### ååº”-é€šç”¨-ç»„ä»¶-ğŸš€React é€šç”¨ç»„ä»¶çš„æœ€ç»ˆç­”æ¡ˆ:åŒæ­¥ SSR +ä»£ç æ‹†åˆ†

github.com](https://github.com/faceyspacey/react-universal-component) 

å®ƒä»¬éƒ½å¾ˆå¥½åœ°å®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºä»£ç æ‹†åˆ†æœ¬èº«çš„çŸ¥è¯†ï¼Œè¯·å‚è€ƒå…³äºè¿™äº›åŠ è½½å™¨çš„æ–‡ç« ã€‚

[](/faceyspacey/announcing-react-universal-component-2-0-babel-plugin-universal-import-5702d59ec1f4) [## React é€šç”¨ç»„ä»¶ 2.0 &å·´åˆ«å¡”æ’ä»¶é€šç”¨å¯¼å…¥

### æ€ä¹ˆäº†ï¼Œå¤§è¥¿æ´‹ï¼

medium.com](/faceyspacey/announcing-react-universal-component-2-0-babel-plugin-universal-import-5702d59ec1f4) [](https://jamie.build/react-loadable.html) [## ä»‹ç» React Loadable

### Reactâ€œThe Beach House(Mndsgn Remix)â€ä¸­ä»¥ç»„ä»¶ä¸ºä¸­å¿ƒçš„ä»£ç æ‹†åˆ†å’ŒåŠ è½½

æ°ç±³ã€‚å»ºç«‹](https://jamie.build/react-loadable.html) [](/smooth-code/introducing-loadable-components-ï¸-646dd3ab0aa6) [## å¼•å…¥å¯åŠ è½½ç»„ä»¶âœ‚ï¸âœ¨

### ä¸€ä¸ªè§£å†³ React ä»£ç åˆ†å‰²å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„åº“ã€‚

medium.com](/smooth-code/introducing-loadable-components-ï¸-646dd3ab0aa6) 

> PS:å…¶å®é‚£äº›æ–‡ç« å¤§å¤šæ˜¯å…³äºâ€œè¿›å£â€çš„ä¸œè¥¿ã€‚

å¦‚æœæ‚¨æ­£åœ¨æ„å»ºçº¯ç²¹çš„å‰ç«¯ SPAï¼Œå¯ä»¥éšæ„é€‰æ‹©â€œåŠ è½½å™¨â€ï¼Œç”šè‡³ä½¿ç”¨æ‚¨è‡ªå·±çš„åŠ è½½å™¨ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚

## å®¢æˆ·ç«¯ä»£ç åˆ†å‰²å’ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“

> ä»è¡¨é¢ä¸Šçœ‹ï¼Œå®ƒä»¬éƒ½æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œå°¤å…¶æ˜¯åœ¨åªä¸å®¢æˆ·æ–¹æ‰“äº¤é“æ—¶ã€‚ç„¶è€Œï¼Œæˆ‘ä¸ªäººå‘ç°ï¼Œå½“æ‚¨å°è¯•æ‰§è¡ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ï¼Œæ¯ä¸ªè§£å†³æ–¹æ¡ˆä¹‹é—´çš„çœŸæ­£åŒºåˆ«å˜å¾—å¾ˆæ˜æ˜¾ã€‚â€” [react-async-loader](https://github.com/ctrlplusb/react-async-component/issues/37) ï¼Œç¬¬ 37 æœŸ

å®¢æˆ·ç«¯ä»£ç æ‹†åˆ†æ˜¯**ä¸€ä»¶è¶…çº§å®¹æ˜“çš„äº‹æƒ…**ã€‚â€œå¥½çš„â€å®¢æˆ·ç«¯ä»£ç åˆ†è§£æˆæ›´å¤æ‚çš„ä¸œè¥¿â€¦ä½†æ˜¯ä½ ä»ç„¶å¯ä»¥åœ¨ä¸€ä¸¤ä¸ªå°æ—¶å†…å†™å®Œæ‰€æœ‰ä½ éœ€è¦çš„ä¸œè¥¿ã€‚ç»“æœå¯èƒ½ä¼šæ¯”ä¸Šé¢æ‰€æœ‰çš„åº“æ›´å¥½ã€‚æ˜¯çš„ï¼Œä¸ºå®¢æˆ·ç«¯ç¼–å†™â€œåŠ è½½ç¨‹åºâ€å¾ˆå®¹æ˜“ã€‚

æœåŠ¡å™¨ç«¯å’Œä»£ç æ‹†åˆ†ï¼Ÿå•Šï¼Ÿå®é™…ä¸Šæ²¡æœ‰äººè§£å†³è¿™ä¸ªé—®é¢˜ã€‚

## é—®é¢˜æ˜¯

ä½ æ­£åœ¨**æœåŠ¡å™¨**ä¸Šæ¸²æŸ“ä½ çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å°†**çš„æ•´ä¸ª** html å‘é€åˆ°**å®¢æˆ·ç«¯**ã€‚æ¥ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯ ***é‡æ–°æ°´åˆ*** ä»£ç ï¼Œç”¨ React è¡¨ç¤ºæ›¿æ¢æ­»çš„ htmlï¼Œè®©å®ƒæ´»èµ·æ¥ã€‚æ²¡æœ‰ä»£ç åˆ†å‰²çš„ç®€å•**ã€‚**

é—®é¢˜#1 æ˜¯â€”â€”ç”±äºä»£ç åˆ†å‰²ï¼Œå®¢æˆ·ç«¯**æ²¡æœ‰**æ‰€æœ‰å¿…éœ€çš„**ä»£ç **æ¥å®Œå…¨æ¢å¤æœåŠ¡å™¨å‘ˆç°çš„å“åº”ã€‚ä¸€ç§’é’Ÿå‰è¿˜ä¸é”™çš„é¡µé¢è¢« spinners å–ä»£äº†ï¼Œå‡ ç§’é’Ÿååˆå˜å¾—ä¸é”™äº†ã€‚å®ƒå°†å°½å¯èƒ½å¤šåœ°æ¸²æŸ“ï¼ŒåŠ è½½å»¶è¿Ÿçš„éƒ¨åˆ†ï¼Œç„¶åé‡æ–°æ¸²æŸ“å…¶ä½™éƒ¨åˆ†ã€‚äº‹æƒ…å°±æ˜¯è¿™æ ·è¿ä½œçš„ï¼

> ä½ æç ¸äº†ä½ åœ¨ SSR ä¸Šåšçš„æ‰€æœ‰å·¥ä½œï¼Œè®©å®¢æˆ·ç”Ÿæ°”ï¼Œç”šè‡³ç”±äºé—ªçƒçš„å†…å®¹å’Œæ—‹è½¬çš„åŠ è½½ç¨‹åºè€Œå¯¼è‡´ç™«ç—«å‘ä½œã€‚

> è§„åˆ™#1 â€”é¦–å…ˆè£…è½½æ‰€æœ‰â€œå¤‡ç”¨â€é›¶ä»¶ã€‚åªæœ‰ä¸‹ä¸€ä¸ªå¤æ°´å†…å®¹ï¼Œä½¿å®¢æˆ·çœ‹ä¸åˆ°å¤æ°´ã€‚

é—®é¢˜#2 æ˜¯â€”â€”æœåŠ¡å™¨ç«¯ React æ¸²æŸ“æ˜¯åŒæ­¥çš„ã€‚â€œä»£ç åˆ†ç¦»â€ç»„ä»¶æ˜¯â€œå¼‚æ­¥â€åŒæ­¥çš„ã€‚å¦‚æœæ‚¨å°†åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“å®ƒä»¬ï¼Œæ‚¨å°†ä»€ä¹ˆä¹Ÿä¸æ¸²æŸ“ï¼Œæˆ–è€…â€œåŠ è½½ç»„ä»¶â€ï¼Œä½†ä¸æ˜¯æ‚¨å¿…é¡»æ¸²æŸ“çš„ React ç»„ä»¶ã€‚å®ƒæ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”å°†åœ¨æ‚¨å°†ç»“æœå‘é€åˆ°å®¢æˆ·ç«¯ä¹‹åå‡†å¤‡å¥½å‘ˆç°**ã€‚ç­”å¯¹äº†ã€‚ç¬¬ä¸€ä»·æ ¼ï¼**

> è§„åˆ™#2 â€”å®¢æˆ·ç«¯å¼‚æ­¥ã€‚åœ¨æœåŠ¡å™¨ä¸ŠåŒæ­¥ã€‚ä¸è¦æ··ã€‚

é‚£äº›é—®é¢˜æ˜¯çº ç¼ åœ¨ä¸€èµ·çš„â€”â€”ä½ å¾—çŸ¥é“ä½ åœ¨æ¸²æŸ“æ—¶â€œå°†è¦â€åŠ è½½ä»€ä¹ˆï¼Œâ€œæ˜¯å¦â€åŠ è½½äº†å®ƒï¼Œè¿˜è¦è®©å®¢æˆ·ç«¯çŸ¥é“å¦‚ä½•é‡å¤ã€‚

ä¹Ÿè®¸ Lyft çš„ [**é€šç”¨å¼‚æ­¥ç»„ä»¶**](https://github.com/lyft/universal-async-component) å°±æ˜¯ *cheatest* é‚£ä¸ªã€‚ä»–ä»¬ä½¿ç”¨â€œstring-replace-loaderâ€æ¥æ›¿æ¢â€œimport â€,è®©å®ƒåœ¨æœåŠ¡å™¨ä¸ŠåŒæ­¥ï¼Œç„¶åä» webpack stats ä¸­æå–â€œusedâ€è„šæœ¬ã€‚æ‰€æœ‰å†…å®¹ 50 è¡Œä»£ç ã€‚

[**React-lodable**](https://github.com/jamiebuilds/react-loadable)**åšçš„å‡ ä¹ä¸€æ ·ï¼Œä½†æ˜¯ä½¿ç”¨ babel æ’ä»¶æ¥â€œä¼ è¾“â€å…³äºæ‰€ç”¨å¯¼å…¥çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨å¼‚æ­¥å¯¼å…¥ä¹‹åæä¾›åŒæ­¥éœ€æ±‚ã€‚**

****é€šç”¨éƒ¨ä»¶**èµ°äº†ç›¸ä¼¼å’Œä¸åŒçš„è·¯ã€‚ä»–ä»¬åšç€åŒæ ·çš„äº‹æƒ…ï¼Œé€šè¿‡ babel-plugin-universal-import ä¼ é€’â€œè§£å¯†â€çš„ä¿¡æ¯ï¼Œä½†ä»–ä»¬ä¼ é€’çš„æ˜¯â€œå¯¼å…¥â€ä¸­çš„ä¿¡æ¯ã€‚**

**æ¥ä¸‹æ¥ä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰åº“å°†è®¿é—® webpack stat ä¿¡æ¯ï¼Œä»¥ç¡®å®šç”¨æˆ·åœ¨ä¸»ä¸Šä¸‹æ–‡ä¹‹å‰å¿…é¡»åŠ è½½å“ªäº›é¢å¤–çš„è„šæœ¬ã€‚**

> **ä¼˜ç‚¹:ä»–ä»¬å®Œæˆäº†å·¥ä½œã€‚**
> 
> **ç¼ºç‚¹:ä»… webpackï¼Œå°†åœ¨ä¸»è„šæœ¬ä¹‹å‰åŒæ­¥å¯¼å…¥é¢å¤–çš„è„šæœ¬ã€‚å¯èƒ½ä¼šå—åˆ° webpack å°†æ¥å¯èƒ½å¼•å…¥çš„ä¸€äº›ä¼˜åŒ–çš„å½±å“ã€‚**

****å¯åŠ è½½å’Œå¼‚æ­¥ç»„ä»¶**éå¸¸ä¸åŒâ€”â€”å®ƒä»¬åœ¨æœåŠ¡å™¨ç«¯ç²¾ç¡®åœ°â€œ**æ¸²æŸ“ååº”æ ‘**ï¼Œä¸ºæœ€ç»ˆç»“æœæä¾›â€œå¼‚æ­¥æ¸²æŸ“â€çš„ä¸œè¥¿ã€‚è¿™ä¸éœ€è¦ä»»ä½• webpack æˆ– babel æ’ä»¶ï¼Œä½†å¯èƒ½ä¼šå½±å“é¡µé¢æ¸²æŸ“çš„æ€§èƒ½ã€‚æ‚¨å¿…é¡»åœ¨å®¢æˆ·ç«¯æ‰§è¡Œå®¢æˆ·ç«¯æ¸²æŸ“ï¼Œå°†æ‰€æœ‰å†…å®¹é‡æ–°æ¸²æŸ“å‡ æ¬¡ã€‚**

**æ¥ä¸‹æ¥ï¼Œä»–ä»¬åœ¨å‰ç«¯åšäº†å‡ ä¹ç›¸åŒçš„äº‹æƒ…ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜â€”â€”æ‚¨ä¸€æ¬¡åªèƒ½å¯¼å…¥ä¸€ä¸ªâ€œçº§åˆ«â€çš„å¯¼å…¥ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå¼‚æ­¥é¡µé¢ï¼Œå®ƒåŠ è½½å¼‚æ­¥å°éƒ¨ä»¶â€”â€”ä»–ä»¬å°†é¦–å…ˆåŠ è½½é¡µé¢ï¼Œåªæœ‰åœ¨å®ƒä¹‹åï¼Œä»–ä»¬æ‰èƒ½å¤Ÿ**åŠ è½½å°éƒ¨ä»¶ï¼Œå¹¶å¾—åˆ°ä»£ç æ¥å®Œæˆå®ƒã€‚****

**PS: Loadable-components æœ‰ä¸€ä¸ªå·´åˆ«å¡”æ’ä»¶æ¥ç¼“è§£(ä¸€ç‚¹)è¿™ä¸ªé—®é¢˜ã€‚**

> **ä¼˜ç‚¹:å¯ä»¥ä½¿ç”¨ä»»ä½•æ†æ‰æœºï¼Œå³ä½¿æ²¡æœ‰é¢å¤–çš„é…ç½®**
> 
> **ç¼ºç‚¹:æ…¢é€Ÿå¼‚æ­¥ SSRï¼Œæ…¢é€Ÿâ€œå—æ³¢æµªå½±å“â€çš„å‰ç«¯æ¸²æŸ“ã€‚**

****React-imported-component** ä»‹äºä¸¤è€…ä¹‹é—´ã€‚å®ƒä»ç„¶æ€»æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯é€šè¿‡ç®€å•åœ°æ‰§è¡Œå¯¼å…¥å¹¶åœ¨ç¬¬ä¸€ä¸ªç”¨æˆ·ç”Ÿæˆé¡µé¢ä¹‹å‰è®°å¿†ç»“æœï¼Œä½¿ SSR å‘ˆç°åŒæ­¥ã€‚åªæ˜¯ä¸€ä¸ªç®€å•çš„å‡è®¾ï¼Œæ‰¿è¯ºå°†åœ¨æ‰€æœ‰å¥—æ¥å­—ä¹‹å‰æ‰§è¡Œï¼Œéœ€è¦æ¥å—ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ¥å‘ˆç°ä¸€äº›ä¸œè¥¿ã€‚**

**æ¥ä¸‹æ¥ï¼Œå®ƒå°†è·Ÿè¸ªå¯¼å…¥çš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶å°è¯•åœ¨å®¢æˆ·ç«¯è¡¥æ¶²ä¹‹å‰é‡æ”¾å®ƒä»¬ã€‚**

> **ä¼˜ç‚¹:è¿™æ˜¯å·¥ä½œå—**
> 
> **ç¼ºç‚¹:ä¸åªæ˜¯ webpackï¼Œä¸å— wave å½±å“ï¼Œä¸æ…¢ï¼Œå°†æ¥ä¹Ÿä¸ä¼šåã€‚**

## **ç“¦ç‰¹ï¼Ÿ**

**æœ‰ä¸€ä»¶äº‹ï¼Œæˆ‘å¿˜äº†è¯´â€”â€”è¿™äº›åŠ è½½å™¨å¦‚ä½•å‘å‡ºâ€œåŒæ­¥â€è¯·æ±‚ï¼Œå¹¶äº†è§£åœ¨å†æ°´åˆä¹‹å‰å®¢æˆ·ç«¯å¿…é¡»åŠ è½½ä»€ä¹ˆã€‚**

**ä»–ä»¬ä½¿ç”¨ babel æ¥æ‰¾åˆ°â€œimport â€,å¹¶ä½¿ç”¨ import é‡Œé¢çš„å­—ç¬¦ä¸²ä½œä¸ºâ€œmark â€,å¹¶ä½œä¸ºæ–‡ä»¶åæŒ‡å‘`require`çœŸæ­£çš„æ–‡ä»¶ã€‚å–œæ¬¢**

```
const LoadableComponent = Loadable({
  loader: () => import('./my-component'),
  loading: Loading,
});
```

**ä½†æ˜¯ï¼å¦‚æœæ‚¨å°†å¯¼å…¥ä»è¯¥åŠŸèƒ½ä¸­ç§»å‡º**

```
const loader = () => import('./my-component');
const LoadableComponent = Loadable({
  loader,
  loading: Loading,
});
```

**å®ƒä¼šæ‰“ç¢ä¸œè¥¿ã€‚è¿™æ˜¯[å·²çŸ¥çš„](https://github.com/jamiebuilds/react-loadable#how-do-i-avoid-repetition)é—®é¢˜ã€‚è¿™ä»…é€‚ç”¨äº SSRã€‚**

**å¦‚æœä½ æƒ³å°†åŠ è½½å™¨ä½œä¸º UI åº“æˆ– UI å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘çš„æ„æ€æ˜¯â€”â€”æ ‡å‡†ç«™ç‚¹èŒƒå›´çš„â€œåŠ è½½â€æˆ–â€œé”™è¯¯â€ã€åˆ†æã€ç›‘æ§â€”â€”ä½ å°†æ— æ³•é€šè¿‡å¸®åŠ©å™¨å‡½æ•°åŒ…è£…â€œåŠ è½½å™¨â€æˆ–è½¬æ¢æˆ HOCã€‚å®ƒå°†**æ­£ç¡®åœæ­¢ SSR** ï¼Œåªè¦å®ƒå°†ä¸¢å¤±ä½¿ç”¨è¿‡çš„ç»„ä»¶çš„è½¨è¿¹ã€‚**

**å®é™…ä¸Šï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªâ€œå¸¸è§â€çš„é—®é¢˜:**

*   **react-universal-component [ç”¨`universalImport`æ›¿æ¢äº†](https://github.com/faceyspacey/babel-plugin-universal-import) `import`ï¼Œè¢«å¯¼å…¥çš„åŒæ­¥å’Œå¼‚æ­¥â€œç‰ˆæœ¬â€æ‰€è¿·æƒ‘ã€‚**
*   **react-imported-component å‡ ä¹åšäº†åŒæ ·çš„äº‹æƒ…ï¼Œç”¨â€œfindableâ€åŒ…è£…å™¨ä»£æ›¿ã€‚**
*   **universal-async-component ä¹Ÿç”¨å®ƒä»¬çš„åŒ…è£…å™¨ä»£æ›¿äº†`import`ã€‚**

**æ‰€ä»¥â€”â€”ä»–ä»¬éƒ½å°†èƒ½å¤Ÿç†è§£æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œå¹¶ä½¿ç”¨â€œé—´æ¥â€è¿›å£ã€‚â€œé—®é¢˜â€åªæ˜¯ react-loadable å’Œ loadable-components çš„â€œé—®é¢˜â€ã€‚webpack v4 å¯¹`mjs`æ–‡ä»¶[çš„æ”¯æŒå¯èƒ½ä¼šç ´å](https://github.com/smooth-code/loadable-components/issues/46)æ–‡ä»¶ï¼Œå› ä¸ºç›®å‰çš„å®ç°æ–¹å¼ã€‚**

**ç¬¬äºŒä»¶é‡è¦çš„äº‹æƒ…â€”â€”å¦‚æœä½ æƒ³åŠ è½½æ¨¡å—â€œAâ€â€”â€”web pack å¯èƒ½ä¼šåŠ è½½â€œBâ€ã€â€œCâ€å’Œâ€œDâ€ã€‚ç”±äº CommonChunkã€AsyncChunkã€Webpack v4 AutoMagicChunking æˆ–ä»–ä»¬å°†æ¥ä¼šå‘æ˜çš„ä»»ä½•ä¸œè¥¿ã€‚ç†è§£(å’Œé¢„æµ‹)webpack stat æ–‡ä»¶çš„æ‰€æœ‰é­”åŠ›å¹¶ä¸å®¹æ˜“ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç”±äºâ€œæ„å¤–çš„â€ä¸²è”æ’ä»¶ universal-async-component å¯èƒ½å·²ç»è¢«ç ´åäº†ã€‚**

****ååº”å¯¼å…¥ç»„ä»¶**æ”¹å˜äº†è¿™ä¸€ç‚¹ã€‚ä¸€ç‚¹ç‚¹ã€‚è¿™ä¸æ˜¯å¥½çš„ï¼Œä¹Ÿä¸æ˜¯æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆï¼Œä½†å¯èƒ½ç°åœ¨å¯¹æ¯ä¸ªäººéƒ½æœ‰æ•ˆã€‚**

1.  **å®ƒå°†æ‚¨æä¾›çš„â€œå¯¼å…¥å‡½æ•°â€è½¬æ¢ä¸º stringï¼Œå¹¶åœ¨å…¶ä¸­æ³¨å†Œå¯¼å…¥ã€‚æ‰€ä»¥ä½ å¯ä»¥ä»ä»»ä½•åœ°æ–¹ä¼ é€’â€œimport â€,ä½†æ˜¯ä½ ä»ç„¶ä¸èƒ½ä½¿ç”¨å¤æ‚çš„å‡½æ•°ï¼Œåªè¦é™¤äº† loader å‡½æ•°ä½“ä¹‹å¤–çš„æ‰€æœ‰ä¸œè¥¿å¯¹å¯¼å…¥çš„ç»„ä»¶éƒ½æ˜¯ä¸å¯è§çš„ã€‚
    ä¸åŒæ ·â€œæ”»å‡»â€å¯¼å…¥çš„ react-universal-component å’Œ universal-async-component çš„åŒºåˆ«å¾ˆç®€å•â€”â€”å¯¼å…¥çš„ç»„ä»¶ä¸ä¼šæ¯æ¬¡éƒ½æ‰§è¡Œâ€œå¯¼å…¥åŠŸèƒ½â€ã€‚åœ¨å¯åŠ¨æ—¶åªæœ‰ä¸€ä¸ªï¼Œä¿æŒå¼‚æ­¥ï¼Œå…è®¸ä½ åœ¨é‡Œé¢æ”¾å…¥ä»»ä½•é€»è¾‘(åƒä¸€å †å¯¼å…¥ï¼Œç­‰å¾…ï¼Œæœ€åäº§ç”Ÿä¸€ä¸ªæ–°çš„ç»„ä»¶)ã€‚**
2.  **å®ƒåœ¨æ‚¨çš„ä»£ç åº“ä¸­æœç´¢å¯¼å…¥ï¼Œäº§ç”Ÿä¸€ä¸ªâ€œæŸ¥æ‰¾â€æ–‡ä»¶ï¼ŒåŒ…å«æ‚¨é¡¹ç›®ä¸­çš„æ¯ä¸€ä¸ª`import`ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒå¯ä»¥ä½¿ç”¨å®ƒé€šè¿‡â€œmarkâ€(å¯¼å…¥åç§°)å¯¼å…¥ä¸€äº›ä¸œè¥¿ï¼Œä»¥å‡å°‘â€œåŠ è½½æ³¢â€ã€‚**

**å¹¶ä¸”åŠ è½½å°†æ˜¯**å¼‚æ­¥çš„**ã€‚å¹¶ä¸”åœ¨ä¸»æŸä¹‹åè£…è½½ã€‚åœ¨â€œä»€ä¹ˆæ—¶å€™â€åŠ è½½ä¸œè¥¿â€”â€”åœ¨â€œmainâ€ä¹‹å‰åŒæ­¥æˆ–è€…åœ¨â€œmainâ€ä¹‹åå¼‚æ­¥â€”â€”æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿå½“ç„¶ï¼Œç¬¬äºŒä¸ªç‰ˆæœ¬ä¼šæ›´å¿«ï¼Œå¿«${numberOfExtraScripts}å€ã€‚**

> **ä¼˜ç‚¹:å¯ä»¥å’Œä»»ä½•æ†ç»‘å·¥ä¸€èµ·å·¥ä½œã€‚**
> 
> **ç¼ºç‚¹:éœ€è¦å•ç‹¬æ­¥éª¤ä»ä»£ç åº“ä¸­â€œæå–â€å¯¼å…¥ã€‚è¿˜æœ‰å·´åˆ«ã€‚**

**æœ‰å¾ˆå¤šè£…è½½æœºï¼Œæ‰€ä»¥å°è¯•ä¸€ä¸‹è¿™ä¸ªæ–°çš„ã€‚å®é™…ä¸Šï¼Œå®ƒå¹¶ä¸æ–°é²œï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ä¸€å¹´å‰ä½œä¸º React-Hot-Loader çš„â€œreact-hot-component-loaderâ€è€Œè¯ç”Ÿçš„ã€‚ä¹Ÿå¯ä»¥éšæ„å°è¯•æˆ‘ä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰å…¶ä»–åº“ã€‚åªæ˜¯å› ä¸ºä»–ä»¬éƒ½æ˜¯ä¸åŒçš„ï¼Œä»–ä»¬ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯èƒ½æ›´é€‚åˆä½ ã€‚ä»–ä»¬éƒ½ä¼šå˜å¾—æ›´å¥½å¹¶è¿›åŒ–ã€‚**

> **PS:å°±åƒ react-imported-components åˆšåˆšåšçš„é‚£æ ·(è¿™å·²ç»æ˜¯ç¬¬ 4 ç‰ˆäº†)**

**![](img/0c02142b18bb98f18f73bc86432148a2.png)**

**è€Œä»£ç æ‹†åˆ†æœ¬èº«å‘¢ï¼Ÿå»åšå§ï¼ä¸å¤šã€‚ä¸»è¦æ˜¯åœ¨é€»è¾‘å±‚ï¼Œè€Œä¸æ˜¯ç»„ä»¶å±‚ã€‚**

**å…³é”®æ€æƒ³æ˜¯â€”â€”å°†â€œæ‹†åˆ†â€çš„ä»£ç ä¸â€œæ•°æ®â€å¹¶è¡ŒåŠ è½½ã€‚æˆ–è€…æ‚¨å¿…é¡»é¦–å…ˆåŠ è½½ä»£ç ï¼Œè¿™å°†å¼€å§‹åŠ è½½æ•°æ®ã€‚æˆ‘ä»¬ä¸ºå®¢æˆ·ä½“éªŒè€Œæˆ˜ï¼Œè€Œä¸æ˜¯ä»£ç åˆ†å‰²æœ¬èº«ã€‚**

## **æƒ³è¦æ›´å¤šå—ï¼Ÿ**

**[](/@antonkorzunov/react-server-side-code-splitting-made-again-a61f8cbbd64b) [## React æœåŠ¡å™¨ç«¯ä»£ç æ‹†åˆ†å·²å®Œæˆ..åˆ

### React ä»£ç æ‹†åˆ†åœ¨ä¸€å¹´å‰å°±æˆä¸ºäº†ä¸€ä»¶äº‹ã€‚ä»é‚£æ—¶èµ·ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¯»æ‰¾æ–°çš„æ–¹æ³•æ¥ä»£ç åˆ†å‰²å’Œæ¨è¿Ÿâ€¦

medium.com](/@antonkorzunov/react-server-side-code-splitting-made-again-a61f8cbbd64b)**