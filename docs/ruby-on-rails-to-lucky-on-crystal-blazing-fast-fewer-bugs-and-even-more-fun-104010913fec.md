# Ruby on Rails 到 Lucky on Crystal:速度极快，错误更少，甚至更有趣。

> 原文：<https://medium.com/hackernoon/ruby-on-rails-to-lucky-on-crystal-blazing-fast-fewer-bugs-and-even-more-fun-104010913fec>

![](img/e7bc3095e474eefd227280febf82919c.png)

我喜欢 Ruby，也喜欢 Rails，但我发现自己在寻找更多的东西。一些快速，所以我不需要添加缓存。某种类型安全的东西，这样客户会发现更少的错误。一些有趣的东西，所以我真的*喜欢*构建应用程序。

**仙丹能帮我止痒吗？**这是一个好的开始。写漂亮的代码很有趣，但是我仍然在产品中遇到错误，这些错误*可以用更好的类型系统*发现。

**有榆树**。太美了。好玩。但是只在前端可用。

我短暂地玩了一下 **Go 和 Rust** ，但是我觉得类型系统和语法对我来说太不友好了，我不喜欢使用它们。

# 最后，我试了试[水晶](https://crystal-lang.org)

起初，我对克里斯托相当反感。它看起来和 Ruby 几乎一模一样，所以我为什么要尝试呢？

最终我尝试了，并且爱上了她💙

虽然水晶看起来和红宝石相似，但水晶是不同的东西。它足够熟悉，可以很快上手，但又足够新，会以有趣的方式挑战你。我喜欢水晶的一些地方:

1.  **漂亮的语法**——毫不羞耻地像红宝石一样。有些人可能不喜欢，但我喜欢。
2.  **在编译时捕捉 bug**—光是写这个就让我焦虑:`Undefined method on Nil`。我已经看过太多次了。Crystal 有助于在编译时捕获这些错误，因此它们永远不会被发现。
3.  **用宏进行元编程** — Crystal 使用宏为你生成代码。再见样板文件。
4.  难以置信的快——在许多基准测试中，Crystal 击败了 Go、Elixir，有时甚至是原始 C 代码。很快。

# 介绍为 Crystal 编写的 web 框架 [Lucky](https://luckyframework.org)

目标是:防止错误，忘记大多数性能问题，将更多的时间花在代码上，而不是调试和编写测试。

总之，**让编写令人惊叹的 web 应用程序变得快速、有趣、简单。**

# 为什么要尝试呢？

1.  易于掌握——直观的 API 和有用的编译时错误有助于使事情变得更简单。[向导](https://luckyframework.org/guides/installing/)和我们有用的[聊天室](https://gitter.im/luckyframework/Lobby)可以在你遇到困难时提供帮助。
2.  **包括电池—** 不再需要拼凑一百万个库。Lucky 包含了大部分 app 需要的东西。电子邮件、用于处理数据库的[或](https://hackernoon.com/tagged/orm) M、模板、为您设置的 webpack、自动化浏览器测试、认证和轻松部署。
3.  **快如闪电** —不再担心性能和您需要多少台服务器。大多数带有大量 HTML 和多个数据库请求的响应在价格适中的服务器上每秒处理数千个请求。
4.  **为你捕捉 bug**——少花点时间担心测试覆盖率和偷偷摸摸的类型错误。让 Crystal 编译器帮你解决这个问题。
5.  **灵活的** —构建服务器呈现的 HTML，使用 SPA 的内置 webpack 配置，或者通过用`--api`初始化您的项目来构建 JSON API
6.  **不再有 N+1 问题** —如果您不小心忘记预加载关联，Lucky 会在开发过程中提出，从而防止缓慢的 N+1 查询。

# 要点很无聊，看起来像什么？

## 处理 HTTP 请求

*   呼叫`route`会自动建立到`”/users”`的路线。
*   如果您愿意，您可以为非休息路线设置像`get “sign_in”`这样的自定义路线。
*   如果你忘记传递页面需要的东西，Lucky 会在编译时通知你。

## 建立模型

*   设置您想要使用的列及其类型
*   当列可以是`nil`时，可以在类型中添加`?`。Crystal 会帮助你记住不要在它上面调用无效的方法。
*   Lucky 将为必填字段(`name`和`email`，因为它们没有被标记为 nilable)设置在场验证。

## 查询数据库

*   `User::BaseQuery`是在你定义一个模型时自动生成的。从它继承来定制查询。
*   用实例方法设置命名范围。
*   Lucky 为所有的列设置了方法，这样如果你输入了错误的列名，它会在编译时告诉你。
*   在 String 列上使用`lower`方法，确保 Postgres 对所有内容进行小写排序。Lucky 有很多强大的抽象来创建复杂的查询，以及特定类型的方法(比如`lower`)。

## 防止可怕的 N+1 查询

*   如果您忘记预加载一个关联，Lucky 将在开发和测试环境中引发一个运行时错误。**N+1 个查询不会意外降低请求速度。**
*   在生产中，查询不会引发。这样，如果您不小心做了一个更改，并且没有对它进行测试，它就不会为您的用户抛出错误。相反，您可以稍后修复性能问题。
*   有时你只是想加载一个没有预加载舞蹈的关联，你可以接受轻微的性能冲击。添加`!`来加载关联，而不会触发运行时错误。

## 呈现 HTML

*   `needs users : UserQuery`告诉编译器它必须被传递给`UserQuery`类型的`users`。
*   如果你忘记传递某个页面需要的东西，它会在编译时通知你。**bug 更少，调试更快。**
*   用水晶方法写标签。标签会自动关闭，空白会被删除。
*   很容易提取命名的方法，因为页面是由常规的类和方法组成的。这使得你的 HTML 页面非常容易阅读。
*   轻松链接到其他页面。只需使用行动名称:`Users::New`。用`Users::Show.with(user.id)`传递参数。**不再试图记忆路径助手以及助手是否是复数**。
*   如果您忘记将一个参数传递给一个路由，Lucky 会在编译时通知您。
*   因为我们将`column age : Int32?`定义为 nilable，所以如果你只是做了`text user.age`，Lucky 将无法编译页面，因为它不允许打印`nil`。因此，我们添加了一个后备方案。**不再意外打印 HTML 中的空文本！**

# 从幸运开始

这里有一些你可以开始的方法

*   在[幸运 GitHub 回购](https://github.com/luckyframework/lucky)上抛给我们一颗星星😉
*   在推特上关注 [@luckyframework](https://twitter.com/luckyframework) 。
*   检查[导轨](https://luckyframework.org/guides/installing/)并开始使用。
*   在我们的 [Gitter 频道](https://gitter.im/luckyframework/Lobby)寻求帮助或获得想法。

## 恐惧

总是有一个陷阱，克里斯托和幸运也是如此。

Lucky 和 Crystal 都没有升级到 1.0，这意味着对于一些新版本，你必须在升级时做出改变。与 Ruby 和其他更成熟的语言相比，库和教程也更少。

对于一些人来说，这是一个有趣的机会，可以从一开始就参与进来，帮助塑造社区，但并不适合所有人。

如果你感兴趣，*但还没有准备好飞跃*、[、**在 twitter 上关注@ lucky framework**、*在*、](https://twitter.com/luckyframework)[、 *GitHub* 、](https://github.com/luckyframework/lucky)、*上给我们一颗星星。*