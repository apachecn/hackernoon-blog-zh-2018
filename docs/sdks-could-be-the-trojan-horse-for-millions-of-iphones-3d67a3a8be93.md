# SDK 可能成为数百万部 IPhones 的特洛伊木马

> 原文：<https://medium.com/hackernoon/sdks-could-be-the-trojan-horse-for-millions-of-iphones-3d67a3a8be93>

![](img/9182ddc23de95e2f94485e2d412d9f86.png)

约翰·多恩曾经说过:“没有人是一座孤岛。”如果他生活在 21 世纪，他可能会对软件说同样的话。从表面上看，程序似乎是完全不同的实体，实际上是由其他开发商和公司制造的许多其他组件组成的。

互联网上有数以百万计的第三方库和软件开发工具包(SDK)。开发人员下载它们并将其集成到他们的软件中，从而在构建特性和功能时节省时间。没有必要为他们想做的每一件事重新发明轮子。

但是它们也是安全的致命弱点吗？湾区安全专家费利克斯·克劳斯检查了几个最流行的 SDK，发现[许多缺乏传输级安全](https://krausefx.com/blog/trusting-sdks)。或者，更简单地说，它们是以一种不安全的方式提供的，允许恶意的第三方截取和修改内容。

# 你的应用是草

在我们继续之前，我想说 Krause 的研究是平台不可知的。它影响了所有种类的软件。[窗户](https://thenextweb.com/topic/windows/)。Linux。马科斯。[安卓](https://thenextweb.com/topic/android/)。 [iOS](https://thenextweb.com/topic/ios/) 。阿米加可能也是。

也就是说，在这一部分，我将谈论 iOS 应用程序，因为它对大多数人来说都很熟悉，也因为它是一个特别有趣的案例研究。这也恰好是克劳斯感兴趣的主要领域，也是他大部分研究的基础平台。

让我们假设你想用恶意软件感染一百万个 iPhone 用户。我不知道为什么，但你知道。这是一个棘手的问题。首先，苹果对 iOS 的封锁比诺克斯堡还要严格。抓住一个 iOS 零日也是不可能的；那些起价在六到七位数之间。

所以，作为最后的手段，你偷偷给开发人员一个被攻破的 SDK，然后他们把危险的代码插入到他们的应用程序中(我们将在后面讨论这是如何工作的)。然后你或多或少地得到了王国的钥匙。虽然苹果的 killjoy 沙盒停止了真正的乐趣，但恶意代码仍然可以访问:

*   应用程序可以访问的任何文件和文件夹
*   该应用程序可以访问的任何权限(你好，麦克风和定位服务！)
*   属于 app 的 [iCloud](https://thenextweb.com/topic/icloud/) 容器
*   应用程序可以访问的所有钥匙串数据
*   应用程序和远程服务器之间交换的所有信息。

呀。简而言之，你可以把一个表面上合法的应用程序变成一台奥威尔式的间谍机器，记录下其中的每一次点击——每一次按键。它甚至可以记录用户去过哪里。它可以获得证书，这些证书可以卖给其他坏演员。

而这一切都是以难以想象的规模完成的。一个单独的 SDK 可能会获得数百个应用程序，而每个应用程序又会吸引成千上万的用户。

# 这是如何工作的

中间人攻击并不新鲜。这项研究不是关于它们的，而是关于软件的重要部分是如何传输的，以及这如何影响更广泛的软件安全生态系统。然而，了解这种攻击是如何进行的是很重要的。

这种攻击需要第三方将自己定位在开发人员的计算机和网络的其余部分之间，或者定位在网络和提供 SDK 下载的服务器之间。这允许他们观察和修改从计算机到外部世界的流量。如果你好奇的话，可以在克劳斯的博客上阅读更好的技术细节。

受害者可能在任何地方:旅馆、咖啡馆或机场。没关系。一旦攻击者被定位，他们就可以开始提供伪造的 SDK。Krause 指出，替换 HTML 文档中的文本是微不足道的。因此，他们可以将下载页面上的链接位置改为指向其他地方。

Krause 给出的一个例子探索了将 Localytics 的 SDK 的位置改为一个视觉上相似的、不太可能引起怀疑的位置。看看你是否能发现不同之处:

*   https://s3.amazonaws.com/localytics-sdk/sdk.zip
*   【https://s3.amazonaws.com/localytics-sdk-binaries/sdk.zip 

前者是合法的 SDK，而包含“localytics-sdk-binaries”的是为恶意代码服务的。

克劳斯还创建了一个概念验证，允许他实时切换 ZIP 文件和二进制文件的内容。这是通过一种叫做 sslstrip 的工具将加密格式的流量降级为没有这种保护的格式来实现的。一步一步来，这是如何工作的:

*   开发人员下载 SDK
*   然后修改它，插入他们自己的恶意代码
*   攻击者压缩代码。
*   攻击者监视网络流量，等待开发人员下载 SDK。
*   然后，它们用自己的有效负载替换任何匹配特定模式的 ZIP 文件。

# 供应商正在提供不安全的 SDK

Krause 的研究强调的攻击途径是一种威胁，因为一件事:供应商正在以一种完全不安全的方式提供 SDK。

克劳斯查看了 41 个最流行的 SDK。其中 13 个可能容易受到中间人攻击，而 5 个根本没有提供安全下载 SDK 的方法。其中许多都属于知名科技公司。

以亚马逊为例(值得称道的是，它在三个工作日内就解决了这个问题)。这家总部位于西雅图的科技巨头通过极不安全的 HTTP 提供 AWS(亚马逊网络服务)SDK 下载。

另一个主要的 SDK 提供商 Localytics(也解决了这个问题)有一个链接到其 SDK 的未加密文档子网站。如前所述，攻击者可能截获了该链接，并将其替换为恶意的替代链接。

根据道德披露程序，Krause 给了受影响的 SDK 开发人员一个有意义的机会在披露前解决问题。这意味着他联系了每个组织内的相关利益相关者，并给他们三个月的时间来解决问题，直到他满意为止。

这个问题很容易解决。与许多需要数周时间调查的漏洞不同，供应商只需确保他们的 SDK 通过加密渠道下载。

然而，令人沮丧的是，供应商未能采取任何有意义的行动。在这篇文章发表的五天前，Krause 写信告诉我，近三分之二受影响的 SDK 提供商未能保护他们的 SDK 下载。他说:

> *我刚刚浏览了列表，检查了 SDK 提供商是否修复了他们的网站:*
> 
> *我在 2017 年 11 月和 12 月通知了所有受影响的人，给他们足够的时间来解决这个问题，然后再公开发表博客。在 13 个受影响的 SDK 中，1 个在三个工作日内解决了问题，4 个在一个月内解决了问题，8 个 SDK 在本文发布时仍易受此攻击。仍然受到影响的 SDK 提供商没有回复我的电子邮件，或者只是回复说“我们会调查这件事”——他们都在最常用的 50 个 SDK 中。*
> 
> *这令人震惊……*

# 软件食物链

仔细想想，软件和你可能在超市买的一块牛排没什么不同。你购买它时认为它可以安全食用。要做到这一点，需要在制造过程的每个阶段都进行适当的处理。从农场到餐桌，每个人都需要做好自己的工作。

软件有点像。最终用户从他们的超市(在这个场景中，是应用程序商店)购买一个软件，并假设它不会伤害他们。但是为了让这个假设成为现实，每个人都需要遵守安全最佳实践:不仅仅是开发人员。

*这个故事由* [*马修·休斯、*](https://thenextweb.com/author/matthewhughes/) *撰写，最初发表在*[*Next Web 上。*](https://thenextweb.com/security/2018/02/15/want-hack-million-iphones-target-sdks-finds-security-researcher/)