# 可靠性陷阱以及如何避免它们

> 原文：<https://medium.com/hackernoon/solidity-pitfalls-and-how-to-avoid-them-24ba87735c7a>

![](img/2f8c45a85213126f9d0a88bfbe784d10.png)

Solidity 仍然是一种新的、快速变化的语言，它有一些严重的缺陷。和所有新事物一样，bug 和逻辑错误是不可避免的。幸运的是，ICO 热潮引发了一场新的研究运动，研究区块链和高级编程语言的安全方面，因为某些智能合约持有数百万美元，使其成为黑客的完美目标。

*本文基于以下研究* [*论文*](https://brage.bibsys.no/xmlui/bitstream/handle/11250/2479191/18400_FULLTEXT.pdf?sequence=1) *:《以太坊智能合约:安全漏洞和安全工具》作者是挪威科技大学的 Ardit Dika。*

# ERC20 关键错误

ERC20 采用两种方式执行令牌交易。

1.  *转账*功能可让您向某人的地址发送代币。
2.  要将令牌存入智能合约，您必须使用组合'*批准&转移自*'。

但是，当您使用转账功能向智能合约发送令牌时，智能合约不会检测到您的存款请求。这导致永久失去你的资金。很多新手开发者都亲身经历过这个严重的错误。

像 ERC223 和 ERC777 这样的标准试图减轻这种缺陷。更具体地说，ERC223 允许开发人员使用相同的函数将资金发送到一个地址或合同: *transfer* 。ERC223 允许开发人员处理传入的令牌交易，并拒绝不支持的令牌。最后，ERC223 令牌标准更有效率，因为它是一个单步流程，而不是从两步流程到*批准&转移。简而言之，ERC777 通过提供广泛的交易处理机制来关注采用。—来源:[联合情报局](https://www.cointelligence.com/content/comparison-erc20-erc223-new-ethereum-erc777-token-standard/)。*

# 未检查的发送功能

Kalra S .、Goel S .等人最近发表了一篇关于分析智能合同安全性的研究论文[。他们描述了](http://wp.internetsociety.org/ndss/wp-content/uploads/sites/25/2018/02/ndss2018_09-1_Kalra_paper.pdf)[未检查](http://hackingdistributed.com/2016/06/16/scanning-live-ethereum-contracts-for-bugs/) *发送*函数的问题:“由于 Solidity 在发送调用时只允许 2300 gas，接收契约中计算量大的回退函数将导致调用发送失败。没有正确处理此类失败调用并允许在发送调用失败后修改全局状态的协定可能会错误地导致以太网丢失。

# 公开可见的数据

以太坊区块链的所有数据对任何人都是公开可见的。不管以太坊有什么正面影响，好处都是受限于这个属性的。公司不能使用以太坊支付员工的工资，因为这将暴露他们的月收入。

如您所见，非常需要引入更多安全属性(如加密、数据混淆和安全事务处理机制)的区块链。英格玛项目通过其所谓的“T0”秘密智能合同“T1”做了一件大事。

# 不可更改的智能合同

一旦部署了智能合约，就不可能对其进行修改或变更。这是有利的，因为它代表了一个值得信赖的平台。另一方面，由于这一特性，大量智能合约包含可被利用来获取非法利润的漏洞。

此外，ICO 的一个常见安全指南是在 testnet 上部署其 ICO 智能合约时使用任意名称。在 ICO 智能合同被黑客攻击之前就发生过这种情况，因为攻击者能够在主网上实际部署之前几周就找到 testnet 智能合同，给他们足够的时间找到关键的 bug。

2016 年，Luu 等人开发了一种符号执行分析工具( [Oyente](https://eprint.iacr.org/2016/633.pdf) )。该工具揭示了当时 19，366 份智能合同中的 45%至少存在一个已知的安全问题。

# 超过最大气体量

让我们以一个略显滑稽的问题来结束。政府网站赚了大钱。幸运的获胜者可以获得大量的 1100 ETH。然而，由于代码中的一个错误，需要 5057945 的气体量来声明以太。但是，在当时，一笔交易的最大用气量只有 4712388。

该问题是由一个数组引起的，该数组循环所有债权人并逐个删除它们，返回获胜者。甚至 Vitalik Buterin 也跳出来给出了这条建议:“总的来说，我们似乎需要一条针对合同开发人员的新的标准建议:确保如果您有用户可以扩展的数组，那么要么找到一些方法让每个用户单独处理与他们自己相关联的数组元素，要么将工作划分到几个事务中。”

幸运的是，这个问题现在已经解决了。这样难以发现的问题以后还会不断冒出来。

# 黄金提示:使用专家和审计审计审计！

我不想无礼，但不要相信新奇的 Solidity 开发者会给你的 ICO 智能合约编码。合适的开发人员知道过去发生的问题，并知道如何应对。

大多数正在开发的固体合同将用于 ico，所以我们谈论的是数百万美元。让几个独立的机构审核你的智能合同，这是为了你的安全。