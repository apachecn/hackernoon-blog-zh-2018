# 云本地路径

> 原文：<https://medium.com/hackernoon/the-cloud-native-path-b8ae6b14b79e>

![](img/13cbff1eafdb5a9a454edaaa7474acaf.png)

Orchestration on cloud (k8 on Azure)

这可能不是你第一次听到云这个词。这是现在的时尚，它被许多顾问和技术公司所传播。当然，他们都在说，你必须登上这趟列车，好处是巨大的，你当然不能失去它。但是它到底意味着什么，为什么云计算还不够？为了回答这个问题，让我简单解释一下几年前我对云计算的理解，以及之后我学到了什么。

## 自动缩放

早在 2012 年，我就在 AWS 上部署了第一个生产应用。它不是为云设计的，我们正在启动一个虚拟机，连接到它，复制二进制文件并启动 web 服务器。但是一个版本接一个版本，我们学习并理解了云的力量在一个词里意味着什么:*自动伸缩*。

为了支持向上和向下扩展，您的应用程序必须是无状态的:您不能将内容保存到本地磁盘或正在进行的会话细节中，因为虚拟机总是会因向下扩展事件而终止。日志也是如此:如果以前在磁盘上写日志就足够了，因为你可以随时检索它们，现在这种奢侈已经一去不复返了。但这很棒，因为这是许多团队采用像 Kibana 或 Graylog 这样的工具的原因。自动扩展带来的另一个好处是，您不必过度配置，您从处理能力开始，然后根据指标，您可以降低或增加该能力。云的好处是，我们的账单完全是按我们所使用的来算的，如果一个虚拟机只运行了 2 个小时，我们就只支付这些小时的费用，而不支付其他费用。

![](img/7ae01154e0ee46307f367f34f6d87426.png)

Autoscaling on AWS

真正的收获不是钱。我曾与一些公司合作，他们没有迁移到云，只是因为他们已经进行了大量的基础设施投资，当他们计算每月的云账单时，即使有所有的折扣，也太多了。

云意味着没有前期投资，但从长远来看，你实际上要支付更多，所以对于已经在基础设施上有大量投资的公司来说，这远不可行。但这是一个非常简单的观点。主要收益来自于我们获得的灵活性，我们能够处理来自客户的高峰，并在流量较少时降低成本。更重要的是，我们将基础设施完全外包给了优秀的工程师，他们为我们提供了可靠的 API。我们都知道好的开发者很难找到。

## 自动化

很快我们意识到我们正在做的是相当重复的工作:在现有的虚拟机上复制二进制文件，为虚拟机创建一个新的映像，并创建一个新的自动扩展组。此外，术语“不可变基础设施”越来越受到关注，因此我们的下一个自然步骤是开始使用配置管理工具，如 Ansible 或 Chef，然后为基础设施添加 Terraform。这使我们能够始终为新版本创建新的虚拟机，并在负载平衡器中用新的虚拟机替换旧的虚拟机。这使我们几乎没有停机部署，我们只需将数据库部署与代码部署分开(或数据库支持 2 个不同的代码版本)。

![](img/cffb5b259d610800832b1def11547ef7.png)

devops.com

从我开始自动化应用程序安装到今天发生了什么？现在我看到所有东西都在管道里。你需要一个全新的环境来测试你的新功能吗？管道应该做到这一点，无论输出是一个新的 kubernetes 集群还是一组新的应用和数据库虚拟机，或者只是一个新的 s3 存储桶和一个静态站点托管的 route53 条目。需要为您的数据库运行升级脚本？当然，应该有一个管道来处理这个问题(并且与代码完全分离)。应用程序部署也是如此。记住把 CI 和 CD 分开就行了。

## 转向微服务

甚至从我合作的第一个 monolith 开始，我们就在讨论分离垂直产品。如果你在你的网站上销售酒店客房和汽车租赁，为什么一个产品的部署会影响另一个呢？那时候他们总是这样。我们可以从网站上禁用汽车租赁，对其进行升级，然后重新启用。所以我们转向微服务是正常的途径，即使当我们开始使用它时，我们实际上是在构建一个分布式的整体。

![](img/7a9523cc4a7601b63208e79cd6b4edf2.png)

[people.groupon.com](http://people.groupon.com)

在使用微服务时，你很快就会开始使用容器，因为你会意识到每个虚拟机运行一个微服务太多了，特别是当你最终拥有大量微服务时。所以我们从自动扩展开始，使用一些自动化，这将我们带到了微服务和后来的容器化的道路上。实现云原生还有最后一步，那就是使用容器编排引擎。

## 管弦乐编曲

当您达到大量微服务时，运行微服务和容器变得非常困难。必须添加新主机，同时一些主机需要维护。微服务的新版本不断增加，我们需要不同的方式来部署这些新版本。所以下一步自然是开始使用 ECS、Docker Swarm 或 Kubernetes 这样的容器编排引擎。实际上，首先你可能会为编排编写许多脚本，但是你很快就会意识到这样的解决方案是不可扩展的。在过去的几年里，Kubernetes 是编排的默认选择，不知何故，它成了采用云原生方式的起点。

## 云原生

所以在一开始，我说云计算对我来说相当于自动伸缩，我试图解释我是如何得出自动伸缩意味着使用云的力量而不是传统的托管解决方案的结论的。

![](img/150fb3a236daffcbb7bf945c8b50d57c.png)

pivotal.io

现在，如果您采用云原生方式，您很可能会使用 kubernetes 或其他容器编排解决方案。因为这意味着您正在运行容器，您已经有了微服务架构，自动化和管道正在用于部署，并且您的主机和微服务正在根据您对应用程序的监控进行自动扩展。这些是云计算的支柱。

我记得从一个经典应用程序到一个能够自动缩放的应用程序是一个相当艰难的转变，持续了一年多(对我们来说几乎是两年)。现在，从云计算到容器编排，所有的管道都到位，这也是一个旅程，我认为这将需要更多的时间，有人甚至说这条路没有尽头。当然这是完全值得的，你不能错过这趟火车。

## 参考资料:

AWS:什么是云计算？[https://aws.amazon.com/what-is-cloud-computing/](https://aws.amazon.com/what-is-cloud-computing/)

Pivotal.io:什么是云原生应用？https://pivotal.io/cloud-native

Container-Solutions:六步成功云原生迁移[https://container-Solutions . com/六步成功云原生迁移-part-1/](https://container-solutions.com/six-steps-to-successful-cloud-native-migration-part-1/)