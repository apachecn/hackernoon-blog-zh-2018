# 关于 gRPC 的思考

> 原文：<https://medium.com/hackernoon/thoughts-on-grpc-c7ff8dcf8476>

![](img/022cefed4e48c1e28b686d73cdaa1d03.png)

Go 和 gRPC 已经成为最近微服务的流行选择。gRPC 是一种高效的有线通信协议。构建在 http/2 和 protobuf 之上(理论上也支持其他序列化协议)，这应该更快，网络开销更少，是一个高效的协议。

## **什么是 http/2**

Http 2 是 Http 协议的下一个版本(http 1.1 是最常用的当前版本)。关于 http 2.0 有几点需要注意

1.  它支持连接多路复用。因此，如果有多个并行请求从一个服务器发送到另一个服务器，所有的响应都可以通过一个连接一起、交错地发送，与通过单独的连接发送响应相比，速度更快。
2.  在 http 1.1 中，标头是作为二进制数据而不是纯文本进行压缩和传输的。
3.  连接重用也意味着 ssl 握手的开销更少。
4.  目前大部分实现只支持 https 模式(虽然这似乎不是一个要求，只是目前实现在浏览器中的一种做法)，使其更加安全。

如果 http 2.0 这么好，为什么不是所有人都用？

## **陷阱**

1.  主要是针对 web 用例。RFC 谈到了这一点，核心焦点是浏览器用例。虽然也可以用于非浏览器场景。
2.  如果只涉及一个请求响应，多路复用实际上会增加开销。在基于代理或 dns 的循环方案的情况下，每个请求可能被路由到不同的下游，多路复用不能很好地工作。在同一个请求上下文中同时对同一个服务进行多个下游调用的可能性也较小。因此在这种情况下多路复用可能效率不高。
3.  非浏览器用例中的标题数量通常是有限的。在浏览器用例中，较大的标题大小可能主要归因于 cookies。头的数量越少，压缩增益就越小。
4.  压缩的二进制标题也意味着检查变得困难，并且需要升级工具集。

## **什么是 protobuf**

Protobuf 是一种用于有线通信的消息协议。作为一种二进制传输协议，它将数据压缩成一种紧凑的格式，以便高效、快速地进行数据传输。使用 protobuf 的客户端库有几种语言版本。Golang 有原生的 protobuf 支持。

## **序列化协议简史**

很久以前，XML 是一种默认的序列化格式，Java 的日益流行可以归功于它的兴起。

虽然 xml 对于人和机器来说都很容易读/写/操作，但是它太冗长了，而且对于较大的有效负载来说，它有很高的开销。

随着 javascript 的流行，另一种很酷的序列化格式也开始流行，即 JSON。JSON 的大小要小得多，仍然完全可读，也不那么冗长。

虽然 JSON 可读性很强，但是它的规范似乎不是很清楚，而且有时不同的库会对它有不同的解释。解析 JSON 似乎也更加耗费 CPU 资源。golang 中默认的 JSON 解析器实际上似乎更慢。

因为，更大的有效载荷导致更高的网络传输成本，一种替代方法是在传输之前压缩数据，然后在另一端解压缩。这种技术非常流行，事实上大多数现代浏览器都支持 gzip 压缩，并且默认启用，这有助于减少有效负载的大小。因此，对于基于 json/xml 的服务，通常启用压缩，这在很大程度上减少了有效负载的大小。

为了更有效地打包数据，需要更好的选项。专注于核心需求，而不是作为一个通用的序列化解决方案，许多公司开发了自己的协议，这些协议附加了较少的元数据，从而减少了有效负载的大小。

Protobuff 就是这样一种选择。它是在 Google 内部开发的，后来开源了。节俭是另一个由脸书开发的，后来开源了。

**要问的几个问题**

1.  协议对我们感兴趣的语言有库支持吗(考虑客户端和服务器语言)
2.  如果需要的话，它有从命令行手动请求响应的工具吗(主要用于调试和测试)
3.  API 的用户会习惯使用它吗？一般来说，浏览器在处理 gzip 时对 json/xml 有很好的支持。类似地，其他流行的工具如 curl、postman 支持 json/xml，但需要 gRPC 的良好支持。

**参考文献**:

[https://cdn-1 . WP . NGINX . com/WP-content/uploads/2015/09/NGINX _ http 2 _ White _ Paper _ v4 . pdf](https://cdn-1.wp.nginx.com/wp-content/uploads/2015/09/NGINX_HTTP2_White_Paper_v4.pdf)

 [## HTTP/2 常见问题

### 这些是关于 HTTP/2 的常见问题。

http2.github.io](https://http2.github.io/faq/#what-about-non-browser-users-of-http) [](https://grpc.io/docs/guides/#working-with-protocol-buffers) [## grpc /指南

### 一个高性能、开源的通用 RPC 框架。客户端应用程序可以直接调用服务器上的方法…

grpc.io](https://grpc.io/docs/guides/#working-with-protocol-buffers)  [## 解析 JSON 是雷区|黑客新闻

### 第三，解析一切都是雷区，包括 HTML。我们作为一个团体投入了大量的集体努力…

news.ycombinator.com](https://news.ycombinator.com/item?id=12796556)