# 使用承诺来减少喋喋不休并提高绩效

> 原文：<https://medium.com/hackernoon/use-promises-to-cut-down-on-chatter-and-improve-performance-98aa44865489>

如今，几乎每个人都以这样或那样的形式使用承诺。我充分使用了它们，以至于我创建了一个 [VS 代码](https://hackernoon.com/tagged/vs-code)片段来生成这个样板文件:

很多时候，你有一些异步[函数](https://hackernoon.com/tagged/function)要调用，并希望它在每次调用时返回一个全新的承诺。然而，在一些重要的用例中，您只需要在每次页面加载时执行一次 promise 的逻辑。考虑用户简档检索功能。大多数时候，当用户点击一个应用程序时，你需要从一些后端数据存储(通常通过 HTTP)中检索他们的用户配置文件信息，通过考虑他们记录的偏好、显示他们的姓名等等来提供个性化的体验。

让我们暂时假设用户的配置文件在页面加载之间不会改变(我很快会回到这个假设)。这在我的经历中很常见。在这种情况下，不需要每次页面上的组件需要它完成工作时都出去检索用户的配置文件。当然，您可以这样做，许多第一次实现都是这样做的。这将使你的应用程序变得不必要的“喋喋不休”——页面上有多个不同的组件，每个组件都找到用户的个人资料，以提供个性化的触摸。

你可以依靠承诺的内置记忆来减少喋喋不休的话题([如果你不熟悉](https://medium.freecodecamp.org/understanding-memoize-in-javascript-51d07d19430e) [Divyanshu Maithani](https://medium.freecodecamp.org/@divyanshu013) 的概念，可以在这里阅读这个重要的技巧)。您可以多次调用同一个承诺。如果它已经用特定的用户配置文件记录进行了解析()，则后续调用将使用相同的用户配置文件记录进行解析，而无需重新运行其逻辑。换句话说，更少的 HTTP 调用，更少的聊天。

如果您像这样通过一个可重用的服务类型组件(如 Angular service、redux action 或您最喜欢的实现数据 I/O 层的技术)来集中所有的 http 调用，那么这样做效果最好。如果您的各种 UI 组件都在进行自己的 HTTP 调用，那么就很难有效地利用这种能力。

因此，我的扩展示例现在看起来更像这样:

如果 getUserProfilePromise 类属性未初始化，getUserProfile 方法将创建一个新的承诺。如果它已经被初始化，它只是返回现有的承诺。最后，Promise 的逻辑(和昂贵的 HTTP 调用)只执行一次。

但是，如果假设是错误的呢？如果用户的配置文件在单个页面加载过程中通常保持不变，但并不总是如此，那该怎么办？这通常发生在我的单页应用程序中，当用户编辑他们的个人资料时，编辑事务不会触发页面重新加载。在服务上很容易处理——只需将保持承诺的变量置空。这将迫使服务代码在下次调用时重新执行承诺的逻辑。

我通常创建一个“重新读取”类型的方法，只是为了在代码中说明这一点:

我一直使用 user profile 作为例子，但是您可以想象有一类数据在每次页面加载时只需要读取一次。在我目前正在开发的应用程序中，有一些主表很少发生变化，如果它们在用户在页面上时发生了变化，我们在获得最新信息之前等待页面刷新也没关系。例如，这包括国家主菜单、区域主菜单、菜单选项和类似的内容。

一如既往的希望这个有用！留下你的想法和经历吧！