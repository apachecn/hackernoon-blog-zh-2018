# ä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹© Kotlin æ¥åˆ›å»º Android åº”ç”¨

> åŸæ–‡ï¼š<https://medium.com/hackernoon/why-we-choose-kotlin-for-creating-android-apps-46030b10d19c>

![](img/e2d84511126dcf1856e2309595794db6.png)

Me, trying to convince Android team to use Kotlin

å¤§çº¦ä¸¤å¹´å‰ï¼Œæˆ‘ä»¬çš„å›¢é˜Ÿå†³å®šå°è¯•ä¸€äº›æ–°ä¸œè¥¿:å®Œå…¨ç”¨ JetBrains çš„ä¸€ç§ T2 ç¼–ç¨‹è¯­è¨€ Kotlin T1 å¼€å‘ä¸€ä¸ªå•†ä¸šåº”ç”¨ç¨‹åºã€‚å½“æ—¶ï¼Œæˆ‘ä»¬æœ‰è¿‡ Kotlin çš„ç»éªŒï¼Œä½†è§„æ¨¡è¦å°å¾—å¤š:å°†åº”ç”¨ç¨‹åºçš„æŸäº›éƒ¨åˆ†è½¬æ¢æˆä¸€ç§æ–°è¯­è¨€ï¼Œæˆ–è€…åœ¨è‡ªå·±å–œæ¬¢çš„é¡¹ç›®ä¸Šå°è¯•ã€‚ç„¶è€Œï¼Œç”¨æ–°çš„ç¼–ç¨‹è¯­è¨€å¼€å‘å•†ä¸šåº”ç”¨ç¨‹åºä¼šå¸¦æ¥ä¸€äº›å›°éš¾:

*   æˆ‘ä»¬æ·±æ·±æ‰æ ¹äºåŸºäº Java çš„ Android å¼€å‘ã€‚åˆ‡æ¢åˆ° Kotlin ç›¸å½“å›°éš¾ï¼Œå°¤å…¶æ˜¯å¯¹äºæ²¡æœ‰å‡½æ•°å¼ç¼–ç¨‹ç»éªŒçš„å¼€å‘äººå‘˜æ¥è¯´
*   æœ‰äº›ä¸œè¥¿å°±æ˜¯ä¸è¡Œã€‚åŒ•é¦–åœ¨ç›’å­å¤–é¢å¹¶ä¸å¥½ç”¨

æ‰€æœ‰è¿™äº›éƒ½å¯èƒ½å¯¼è‡´é”™è¿‡äº¤ä»˜æ—¥æœŸå’Œåº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§é—®é¢˜ã€‚

ä¸€ä¸ªäººåº”è¯¥æœ‰å¼ºçƒˆçš„åŠ¨æœºå»å®Œæˆè½¬å˜ã€‚æˆ‘ä»¬çš„åŠ¨æœºæ˜¯ç›¸ä¿¡**ç§‘ç‰¹æ—å°†æˆä¸º Android å¹³å°å¼€å‘çš„æ¸¸æˆæ”¹å˜è€…ã€‚è¿™å¾ˆæœ‰è¶£ã€‚**

ä¿æŒ Kotlin å‚è€ƒå¼€æ”¾ï¼Œæˆ‘ä»¬å¼€å§‹å¼€å‘[é€‰æ°‘åº”ç”¨ç¨‹åºã€‚Kotlin æ˜¯ä¸€ç§å…·æœ‰ 100% Java äº’æ“ä½œæ€§çš„ JVM è¯­è¨€ï¼Œå¦‚æœä½ ç†Ÿæ‚‰ Javaï¼Œå­¦ä¹  Kotlin å¾ˆå®¹æ˜“ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æƒ³å……åˆ†åˆ©ç”¨è¿™ç§è¯­è¨€ï¼Œç†è§£å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µæ˜¯å¿…ä¸å¯å°‘çš„ã€‚](https://uptech.team/#portfolio)

> å­¦ä¹ å‡½æ•°å¼ç¼–ç¨‹éœ€è¦ä¸€æ®µæ—¶é—´ã€‚æ‰€ä»¥è¦æœ‰è€å¿ƒã€‚

è€Œå‡½æ•°å¼ç¼–ç¨‹å¹¶ä¸å®¹æ˜“ã€‚è‡³å°‘åœ¨å¼€å§‹çš„æ—¶å€™ã€‚ç›´åˆ°å®ƒå˜å¾—æœ‰è¶£ã€‚æˆ‘å¼ºçƒˆå»ºè®®å‚åŠ  Martin Ordersky çš„[ç³»åˆ—è¯¾ç¨‹â€œScala ä¸­çš„å‡½æ•°å¼ç¼–ç¨‹â€ã€‚Scala æœ‰æ—¶è®©äººä¸çŸ¥æ‰€æªï¼Œä½†å®ƒå¾ˆå¥½åœ°æ¦‚è¿°äº†æ–°çš„å‡½æ•°å¼ç¼–ç¨‹æ€ç»´ã€‚ä½ å¯ä»¥æŠŠ Kotlin çœ‹ä½œæ˜¯ Scala çš„ä¸€ä¸ªæ›´ç®€å•çš„ç‰ˆæœ¬ã€‚](https://www.coursera.org/specializations/scala)

# æ˜¯ä»€ä¹ˆè®©æˆ‘ä»¬è½¬å‘ç§‘ç‰¹æ—ä¸€è¾¹

## åŠŸèƒ½æ€§ç¼–ç¨‹é£æ ¼

Kotlin ä¸ Java 100%äº’æ“ä½œã€‚æ­¤å¤–ï¼ŒKotlin æ˜¯ä¸€ç§å‡½æ•°å¼è¯­è¨€ã€‚åè€…å…è®¸ç¼–å†™æ›´ä¼˜é›…ã€æ›´æœ‰è¡¨ç°åŠ›çš„ä»£ç ã€‚

1.  **åŠŸèƒ½çº¯åº¦**

çº¯å‡½æ•°çš„æ¦‚å¿µ(ä¸€ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„å‡½æ•°)æ˜¯æœ€é‡è¦çš„å‡½æ•°æ¦‚å¿µï¼Œå®ƒå…è®¸æˆ‘ä»¬æå¤§åœ°é™ä½ä»£ç çš„å¤æ‚æ€§å¹¶æ‘†è„±å¤§å¤šæ•°å¯å˜çŠ¶æ€ã€‚

> åœ¨ Javascriptã€Javaã€C#ç­‰å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå‰¯ä½œç”¨æ— å¤„ä¸åœ¨ã€‚è¿™ä½¿å¾—è°ƒè¯•éå¸¸å›°éš¾ï¼Œå› ä¸ºå˜é‡å¯ä»¥åœ¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹æ›´æ”¹ã€‚é‚£ä¹ˆå½“ä½ å› ä¸ºä¸€ä¸ªå˜é‡åœ¨é”™è¯¯çš„æ—¶é—´è¢«æ”¹æˆäº†é”™è¯¯çš„å€¼è€Œå‡ºç° bug çš„æ—¶å€™ï¼Œä½ å»å“ªé‡Œæ‰¾å‘¢ï¼Ÿåˆ°å¤„éƒ½æ˜¯ï¼Ÿè¿™å¯ä¸å¥½ã€‚

è¯·æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨ä¸æ”¹å˜æ•°æ®å†…å®¹çš„æƒ…å†µä¸‹æ“ä½œæ•°æ®çš„ã€‚

**2ã€‚é«˜é˜¶å‡½æ•°**

> é«˜é˜¶å‡½æ•°è¦ä¹ˆå°†å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¦ä¹ˆä½œä¸ºè¿”å›å‡½æ•°ï¼Œè¦ä¹ˆä¸¤è€…éƒ½æ˜¯ã€‚

é«˜é˜¶å‡½æ•°æ— å¤„ä¸åœ¨ã€‚æ‚¨åªéœ€å°†å‡½æ•°ä¼ é€’ç»™é›†åˆï¼Œä½¿ä»£ç æ˜“äºé˜…è¯»ã€‚è¯»èµ·æ¥åƒç®€å•çš„è‹±è¯­ã€‚æ˜¯ä¸æ˜¯å¾ˆå¥‡å¦™ï¼Ÿ

è®©æˆ‘ä»¬è®¾æƒ³ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬æƒ³è¦ç»Ÿè®¡ä¸åŒç±»å‹çš„æœªè¯»æ¶ˆæ¯çš„æ•°é‡ã€‚å…¸å‹çš„æ–¹æ³•æ˜¯:

å¦‚æ‚¨æ‰€è§ï¼Œéšç€æ–°éœ€æ±‚çš„å¼•å…¥ï¼Œä»£ç å˜å¾—ä¸å¯è¯»å’Œä¸å¯ç®¡ç†ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç”¨é«˜é˜¶å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜:

æˆ‘ä»¬å¯ä»¥æƒ³è±¡è¿™æ ·çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬æƒ³è¦å‚æ•°åŒ–`fold`å‡½æ•°å‚æ•°ï¼Œæ¯”æ–¹è¯´ï¼Œç”¨äºè®¡ç®—æœªè¯»æ¶ˆæ¯çš„ä¹˜ç§¯ã€‚

ä½¿ç”¨é«˜é˜¶å‡½æ•°çš„å¦ä¸€ä¸ªä¾‹å­æ˜¯ç”¨ç®€å•çš„é«˜é˜¶å‡½æ•°æ›¿æ¢å¤§é‡çš„ç›‘å¬å™¨:

```
BillingView : LinearLayout {var billingChangeListener: (() -> Unit)? = null
...}... // in an activity far, far away
billingView.billingChangeListener { updateUI() }
```

**3ã€‚ä¸å˜æ€§** ä¸å˜æ€§ä½¿ä»£ç æ›´å®¹æ˜“ç¼–å†™ã€ä½¿ç”¨å’Œæ¨ç†(ç±»ä¸å˜é‡å»ºç«‹ä¸€æ¬¡ï¼Œç„¶åä¸å˜)ã€‚ä½ çš„åº”ç”¨ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ä¼šæ›´åŠ ä¸€è‡´ã€‚Kotlin é€šè¿‡å¼•å…¥`val`å…³é”®å­—å’Œ Kotlin é›†åˆæ¥å¢å¼ºä¸å˜æ€§ï¼Œç¼ºçœæƒ…å†µä¸‹ kot Lin é›†åˆæ˜¯ä¸å¯å˜çš„ã€‚ä¸€æ—¦`val`æˆ–é›†åˆè¢«åˆå§‹åŒ–ï¼Œä½ å°±å¯ä»¥ç¡®å®šå®ƒçš„æœ‰æ•ˆæ€§ã€‚(å…³äº`val`å…³é”®è¯çš„æ›´å‡†ç¡®å®šä¹‰ï¼Œè§ UPD)ã€‚

```
data class Address(val line1: String, val city: String)**val** items = listOf(Address("242 5th St", "Los Angeles"),   Address("Dovzhenka St. 5", "Kiev"))
```

## é›¶å®‰å…¨

è¿™ä¸ªè¯­è¨€ç‰¹æ€§è®©æˆ‘ä»¬ä»”ç»†è€ƒè™‘æ¨¡å‹ç±»ä¸­å­—æ®µçš„å¯ç©ºæ€§ã€‚ä»¥å‰ï¼Œæ‚¨ä¸èƒ½ç¡®å®š DTO ä¸­çš„å­—æ®µæ˜¯å¦å·²åˆå§‹åŒ–ï¼Œ@Nullable å’Œ@NotNull æ³¨é‡Šä¼šæœ‰æ‰€å¸®åŠ©ï¼Œä½†ä½œç”¨ä¸å¤§ã€‚ç°åœ¨ï¼Œæœ‰äº† Kotlinï¼Œæ‚¨å¯ä»¥ç²¾ç¡®åœ°çŸ¥é“ä»€ä¹ˆå­—æ®µå¯ä»¥ä¸ºç©ºï¼Œä»€ä¹ˆå­—æ®µç¨åè¢«åˆå§‹åŒ–(ä¾‹å¦‚ç”± Dagger æ³¨å…¥çš„å­—æ®µ)ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥å¯¹è¿™äº›å­—æ®µè¿›è¡Œä¸¥æ ¼çš„æ§åˆ¶ã€‚ç»“æœï¼Ÿå‡ ä¹æ²¡æœ‰`NullPointerExceptions`ã€‚(æˆ‘ä»¬å†…éƒ¨ç§°`?.`ä¸º[é¹…](https://pixabay.com/static/uploads/photo/2014/05/26/11/23/swan-354448_960_720.jpg)è¿ç®—ç¬¦ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥åƒé¹…çš„è„–å­)

```
brand?.let { badge.enabled = brand.isNewBadge }
// Can also be written as 
badge.enabled = brand?.isNewBadge?:false
```

## å®‰ç§‘

Anko DSL æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„åº“ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº†è§†å›¾ã€çº¿ç¨‹å’Œ android ç”Ÿå‘½å‘¨æœŸçš„å·¥ä½œã€‚Github çš„æè¿°ç§° Anko æ˜¯â€œä»¤äººæ„‰å¿«çš„ Android åº”ç”¨ç¨‹åºå¼€å‘â€,äº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ã€‚

æ³¨æ„ï¼Œå½“åœ¨ Activity å†…éƒ¨è°ƒç”¨`uiThread`æ—¶ï¼Œå¦‚æœ`isFinishing`æ˜¯`true`ï¼Œé‚£ä¹ˆè¿™ä¸ªå—å°†ä¸ä¼šæ‰§è¡Œã€‚æˆ‘ä»¬å®é™…ä¸Šå¹¶ä¸ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå› ä¸º RxJava å¤„ç†æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰çº¿ç¨‹ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ã€‚

**ç”¨ Anko ä»£æ›¿ XML** ã€‚è™½ç„¶ Anko è¿˜æ²¡æœ‰å‡†å¤‡å¥½å–ä»£æ ‡å‡†çš„ Android UI æ„å»ºï¼Œä½†æœ‰æ—¶å®ƒéå¸¸æ–¹ä¾¿ã€‚

å¦‚ä½ æ‰€è§ï¼ŒAnko DSL å…è®¸ä½ åœ¨ Android å†…ç½®è§†å›¾æ—è¾¹ä½¿ç”¨è‡ªå®šä¹‰è§†å›¾ã€‚è¿™å°±æ˜¯å®ƒæ¯”æ ‡å‡† XML æ›´æœ‰ä¼˜åŠ¿çš„åœ°æ–¹ã€‚

## Kotlin Android æ‰©å±•:ç§»é™¤ ButterKnife ä¾èµ–

**æ— èŠäº†æ²¡ï¼Ÿæˆ‘æ‰“èµŒä½ æ²¡çœ‹å°±æ»šåŠ¨äº†ã€‚åœ¨ç§‘ç‰¹æ—ï¼Œä½ ä¸éœ€è¦è¿™äº›ã€‚æ‚¨å¯ä»¥é€šè¿‡@id XML å‚æ•°å¼•ç”¨è§†å›¾å±æ€§ï¼Œè¿™äº›å±æ€§çš„åç§°å°†ä¸ XML æ–‡ä»¶ä¸­å£°æ˜çš„åç§°ç›¸åŒã€‚æ›´å¤šä¿¡æ¯å¯åœ¨[å®˜æ–¹æ–‡ä»¶](https://kotlinlang.org/docs/tutorials/android-plugin.html)ä¸­æ‰¾åˆ°ã€‚**

## å…¶ä»–ç®€æ´çš„åŠŸèƒ½

1.  **æ‰©å±•åŠŸèƒ½&æ„å»ºå™¨**

`apply`ã€`let`å’Œæ‰©å±•å‡½æ•°å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨æ¥åˆ›å»ºä¼˜é›…çš„æ„å»ºå™¨ã€‚

**2ã€‚åœ¨æœ€åˆçš„å‡ å¤©é‡Œï¼Œä½ ç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜:ä½ ä¸çŸ¥é“å¦‚ä½•ç”¨ Kotlin ç¼–å†™ä¸€ä¸ªç›¸å½“ç®€å•çš„ Java è¡¨è¾¾å¼ã€‚
ä¸€ä¸ªç®€å•çš„çªé—¨æ˜¯ç”¨ Java å†™ä¸€æ®µä»£ç ï¼Œç„¶åç²˜è´´åˆ° Kotlin æ–‡ä»¶ä¸­ã€‚å¤šäºäº† JetBrains é‡Œçš„äººï¼Œå®ƒè¢«è‡ªåŠ¨è½¬æ¢æˆ Kotlinã€‚Hackyï¼Œä½†å·¥ä½œåƒä¸€ä¸ªé­…åŠ›ï¼**

**3ã€‚æ‘†è„±ä¸å¿…è¦çš„ä¾èµ–** Kotlin æ›¿ä»£äº†å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚ ButterKnifeã€Google Autovalueã€Retrolambdaã€Lombok å’Œä¸€äº› RxJava ä»£ç ã€‚

# æ‘˜è¦

ä½œä¸ºä¸€ä¸ªè½¯ä»¶å¼€å‘å›¢é˜Ÿï¼Œæˆ‘ä»¬é¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜æ˜¯äº¤ä»˜ä¼˜ç§€çš„äº§å“å’Œæœ‰æ•ˆåœ°å®Œæˆå·¥ä½œã€‚è™½ç„¶è¦å¼€å§‹åœ¨ Kotlin ä¸­æœ‰æ•ˆåœ°å¼€å‘ï¼Œæ‚¨éœ€è¦ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹çš„å…ˆå†³çŸ¥è¯†ï¼Œä½†æ˜¯æŠ•å…¥æ—¶é—´å­¦ä¹ å®ƒç¡®å®ä¼šæœ‰å›æŠ¥ã€‚æˆ‘ç›¸ä¿¡ Kotlin æ˜¯å¯¹ä¼ ç»Ÿ Android å¼€å‘çš„ä¸€ä¸ªé‡å¤§æ”¹è¿›ï¼Œå®ƒå…è®¸æˆ‘ä»¬æŒ‰æ—¶äº¤ä»˜ä¼˜ç§€çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”é”™è¯¯å°‘å¾—å¤šã€‚

è¯·éšæ„æé—®ï¼Œæˆ‘ä»¬å°†ä¹æ„å¸®åŠ©å…¶ä»–äººå®Œæˆè¿‡æ¸¡ã€‚åœ¨ä¸‹é¢åˆ†äº«ä½ çš„æƒ³æ³•/è¯„è®ºå§ï¼

> ç©¿ç€è¡£æœç¼–ç¨‹æ˜¯ä½ èƒ½å¾—åˆ°çš„æœ€å¤§ä¹è¶£ã€‚
> 
> çº¦ç¿°Â·å¤å¡”æ ¼

*UPD:* `*val*` *å®é™…ä¸Šå¹¶ä¸æ˜¯æŒ‡â€˜ä¸å¯å˜â€™ï¼Œè€Œæ˜¯æŒ‡â€˜åªè¯»â€™ã€‚è¯¦è§* [*æœ¬æ–‡*](https://artemzin.com/blog/kotlin-val-does-not-mean-immutable-it-just-means-readonly-yeah/) *ã€‚*

> è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨ [UPTech å›¢é˜Ÿåšå®¢](http://blog.uptech.team)ä¸Šã€‚å…³æ³¨æˆ‘ä»¬ï¼Œè·å–æ›´å¤šå…³äºå¦‚ä½•æ„å»ºä¼˜ç§€äº§å“çš„æ–‡ç« ğŸ’ª

**å‚è€ƒæ–‡çŒ®**

1.  [ç§‘ç‰¹æ—å‚è€ƒ](https://kotlinlang.org/docs/reference/)
2.  [æ‰€ä»¥ä½ æƒ³æˆä¸ºä¸€åå‡½æ•°å¼ç¨‹åºå‘˜](/@cscalfani/so-you-want-to-be-a-functional-programmer-part-1-1f15e387e536#.8cmkitum2)
3.  [ä¸ºä»€ä¹ˆå‡½æ•°å¼ç¼–ç¨‹å¾ˆé‡è¦](https://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf)
4.  [ç”¨ Java ä¸å¯å˜å¯¹è±¡ç¼–ç¨‹çš„ 6 ä¸ªå¥½å¤„](https://www.linkedin.com/pulse/20140528113353-16837833-6-benefits-of-programming-with-immutable-objects-in-java)
5.  [Anko DSL vs Android XML-First](http://maximomussini.com/posts/anko-vs-android-xml/)
6.  [å°†åº”ç”¨ç¨‹åºè½¬æ¢æˆ 100% Kotlin çš„ç»éªŒæ•™è®­](/keepsafe-engineering/lessons-from-converting-an-app-to-100-kotlin-68984a05dcb6#.jkxs39qko)
7.  [ç»“æœ:é€‰æ°‘ç”³è¯·](https://play.google.com/store/apps/details?id=app.voter.xyz&hl=en)ã€‚99.8%æ— å´©æºƒç”¨æˆ·ã€‚
8.  Kotlin: val å¹¶ä¸æ„å‘³ç€ä¸å¯å˜ï¼Œå®ƒåªæ˜¯æ„å‘³ç€åªè¯»