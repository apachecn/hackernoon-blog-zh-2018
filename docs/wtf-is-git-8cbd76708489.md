# WTF 就是 git？

> 原文：<https://medium.com/hackernoon/wtf-is-git-8cbd76708489>

![](img/9a521710421a399547aacef2a4025fa2.png)

你可能听过你的工程师谈论 git、Github 或源代码控制。可能是在“让我从 git 上拉最新的变更”或者“Github 宕机了；我们去喝杯啤酒吧。”所以 wtf 就是 git？

为了做好准备，我们先打个比方。假设你正在和几个同事合作起草一份时事通讯。你可能会面临哪些问题？假设谷歌文档和类似的在线编辑器还没有被发明出来，因为它们解决了很多这样的问题，事实上，git 可以被认为是代码的谷歌文档。

*   你的每个同事都负责一个不同的部门，你们都在平行工作。你如何聚合最终版本？你可以每个人分别写你的部分，然后在最后聚在一起合并，但是在那之前你看不到他们在做什么，所以你不能协调一致的流程和校对彼此的工作。
*   你[精通 HTML](/@adamberlinskyschine/i-wrote-the-sql-query-in-5-mins-why-does-my-engineer-say-it-will-take-a-month-80f03fa3eb03) ，但是你在时事通讯应该发布的那天醒来，意识到你引入了一个你无法解决的奇怪错误。如何轻松地恢复到旧版本或检查您所做的可能导致问题的更改？
*   你的同事做了一些小的编辑，并发送了一份修订版供你校对。你怎么知道他们做了什么改变，这样你就不用重新回顾整个事情了？
*   你在飞机上，或者是少数几个很难找到 wifi 信号的地方之一。重新上线后，您如何继续工作并与同事保持同步？
*   您的计算机崩溃，或者您使用多台计算机来完成工作。您如何确保可以在另一台机器上从中断的地方继续工作？
*   假设您的公司制作了许多这样的时事通讯，并且正在同时制作多份。现在假设你的设计者对标题进行了修改。你如何在不进行大量复制和粘贴的情况下将此应用于所有当前和未来的时事通讯？

现在考虑这些问题，将它们乘以您团队中的工程师数量，并假设他们可以同时处理代码的相邻部分。它只是一份巨大的时事通讯，包含成千上万的句子，在你的产品生命周期中无限延续。这或多或少就是在软件开发团队中工作的感觉。像 git 这样的源代码控制解决方案使这些挑战变得易于管理。

Git 是最流行的源代码控制系统。还有其他的(subversion、perforce、mercurial)，但是 git 是目前最流行的。你可以把一个源代码控制系统想象成一个专门用于代码的 Dropbox 或者 Google Drive。工程师们*向系统提交*新代码，他们*提取*彼此的变更。在本文的剩余部分，我将只提到 git，但是大多数原则也适用于其他源代码控制系统。

使用源代码控制系统的主要原因是为了支持协作。如果一个项目只有一个工程师，他们避免使用源代码控制是可行的，尽管他们可能无论如何都想获得我们将要讨论的其他一些好处。他们可以将文件保存在笔记本电脑上，根据需要进行修改，并将代码从笔记本电脑复制到生产服务器上。但是一旦两个或更多的工程师在同一个代码库上工作，这很快就变得难以控制了。他们如何共享代码？一有变化就发邮件给对方？如果他们在代码的同一个区域工作，并且做了冲突的更改，那该怎么办？

在不了解源代码控制的情况下，您的第一想法可能是将代码存储在一个集中的地方，如 Dropbox 或 Google Drive，这样多个工程师就可以修改同一个代码库。但是这些解决方案不太适合源代码。每当一个人将新代码保存到驱动器或者另一个人下载他们同事的更改时，很容易错误地覆盖彼此的更改，并且很难看到什么时候更改了什么。

# 分支

源代码管理类似于一棵树。通常有一个*主*代码副本，然后是许多“分支”——即修改后的代码副本。这些分支本身可以有分支，因此有了树的比喻。分支通常是在工程师开始开发一个新特性或新的 bug 修复时创建的。当工作完成后，分支可以被合并到一起。“完整”的定义因团队而异:可能是在准备好测试时，在代码审查后，或者在通过 QA 后。

不同的开发团队有不同的工作流程，导致不同的分支结构。Git 本身没有在树的“形状”上强制任何结构，并且分支上的分支会变得难以管理。想象一个由大型开发团队开发的、需要几轮 QA 的数月项目。可能会为该特性创建一个初始分支，然后每个开发人员从该分支中创建一个分支来处理他们的项目部分。在这些分支中发现了错误，于是新的分支就从它们中产生了……你可以看到它是如何迅速变得一团糟的。

大多数人都同意，最佳实践是努力减少一次开发中的活动分支的数量。一个典型的工作流包括一个*主*分支，它是在生产中运行的代码(有时被称为*黄金*分支，因为它被认为是最稳定和经过彻底测试的分支)，一个*开发*分支，它跟踪公司的登台环境(有时被称为 *dev* 或 *wip* 表示“工作进行中”)。开发人员从*开发*中分支——也就是说，他们创建一个新的分支，作为开发分支的副本——来处理新的特性或修复，然后*在测试和评审之后将分支合并*回开发分支。当团队准备好部署到生产时，开发分支被合并到主分支中。主分支变成了在生产中运行的代码，或者通过*连续部署*过程(未来文章的主题)自动运行，或者通过手动过程运行。团队还可能有一个*热修复*过程，用于需要立即部署的快速、紧急的变更，其中从主分支而不是开发分支创建一个分支，并且一旦准备好就合并回主分支。

# 合并

分支(例如创建一个新的分支)非常简单；不会有太多问题。这本质上与将硬盘上的目录复制到新位置是一样的。合并可能要复杂得多。对于相同代码的稍微不同的克隆，如何解决差异呢？如果做得不完美，某人的更改可能会被覆盖，或者更糟糕的是，不正确的合并可能会导致整个应用程序无法工作——源代码并不十分宽容。Git 非常擅长在变化彼此完全不相关的情况下自动合并代码，但是当两个或更多开发人员在代码的同一部分工作时，需要手动干预。这被称为*合并冲突*，这意味着 git 无法自信地自动合并变更，因此开发人员需要手动完成。这种情况比您想象的更常见:即使您的代码库有数万行或数十万行代码，也往往会有比其他代码更频繁更改的热点，并且最近引入的功能往往比长期建立的代码需要更多的更改和错误修复。当代码的相同部分受到影响时，git 会保守地提示开发人员检查差异并选择适当的行动方案，这并不总是显而易见的。幸运的是，git 提供了优秀的工具来协助这个过程。尽管如此，您可能会听到您的工程师谈论“糟糕的合并”，这意味着出现了错误，要么覆盖了某人的更改，要么以意想不到的方式破坏了应用程序。

# Git 历史

git 最强大的特性之一是它维护了对代码库所做的所有更改的完整历史。您可以看到任何旧版本的代码和任何分支，除非它已被故意删除。这在出现问题时尤其有用。当一组变更被部署到生产中，并且出现了一个似乎与它们没有直接关系的新 bug 时(正如我们在[为什么一切都坏了](/@adamberlinskyschine/why-is-everything-broken-707f1a57bfe8)中所探讨的那样，这种情况经常发生)，git 允许开发人员探索什么改变了，什么时候，为什么，以及由谁改变的。它还能让工程师们快速地*将*恢复到旧的变更，这在部署到产品时发生严重的事情时特别有用:恢复到以前的版本通常比调试问题和修复新代码更快。这些是开发人员甚至在单独的项目中使用 git 的一些原因。

Git 历史在紧急情况之外也很有用。新开发人员可以回顾以前的更改，看看类似的任务在过去是如何实现的。通过查看特定时间点的 git 更改，可以追踪到不明显的 bug，以了解问题开始出现时可能发生了什么变化。Git 有一个厚脸皮的名字，但是非常有用的*责备*命令显示哪个人做了影响任何代码行的最后一次更改。

# 开源代码库

太好了，我现在懂源码控制和 git 了！但是 WTF 是 Github？

Git 是开源软件，需要在某个地方的服务器上运行。系统管理员或开发人员可以设置一个服务器来实现这一点，但是您必须支付费用，处理维护和升级，并担心备份(您肯定不想失去您的源代码控制库！)使用托管解决方案更便宜也更容易，Github 是市场领导者(还有其他的，包括 Atlassian 的 Bitbucket，它有时会因为其更慷慨的免费层而被选中)。所以 Github 只是为您运行 git，这样您的工程师就不必这么做了。Github 还投资了工具和用户界面，让使用 git 变得越来越容易。

# 代码审查

虽然不严格依赖于源代码控制，但是让我们花一点时间来讨论代码审查。代码审查——也称为*拉请求*，因为*拉*是用于合并和检索分支的 git 命令——通常被开发团队用来校对彼此的工作。许多团队有一个政策，没有至少一次代码评审，就没有代码被合并到开发或主分支。

在典型的代码评审中，熟悉相关代码但没有亲自编写的开发人员将通读*diff*——旧代码和新代码之间的突出差异——并添加建议。代码评审员偶尔会发现 bug，但这并不是重点。更常见的批评与代码风格和完成任务的更有效方式有关。在一些公司中，这是一个正式的过程，在代码被合并之前，工程领导必须在代码上签字；在其他情况下，这是一个非正式的过程。在我管理的团队中，代码审查是必需的，但这是一个非正式的过程，没有要求审查者比编写代码的人更高级。不管经验如何，参与其中的两个人都能从这个过程中学到一些东西。

# 那么我需要学习 git 吗？

过去，我教过一些非技术同事使用 git，这样他们就可以做一些简单的修改，比如复制、图片和轻微的 HTML 修改。正如我在之前[所写的，我发现创始人和非技术团队成员学习独立完成一些技术任务，让工程师专注于只有他们能做的事情，这对早期](/@adamberlinskyschine/i-wrote-the-sql-query-in-5-mins-why-does-my-engineer-say-it-will-take-a-month-80f03fa3eb03)[创业](https://hackernoon.com/tagged/startups)非常有用。学习使用 git 通过让您自己实际修改生产代码，将您的自主性带到了一个新的层次。想想如果你能修改文案、主题等，你能做些什么。不会分散您的工程团队的注意力。

但我不会在这里教你怎么做。大部分工作是学习你的团队的代码库和他们的源代码控制工作流程。希望他们的工作流程包括代码审查，这应该可以防止你陷入太多的麻烦。Git 极其强大；即使大多数高级工程师也只理解 git 的一个子集。问问你的工程师，让你自己设置 git 并开始做一些小的改变是否有意义。