# XJoy——在 Windows PC 游戏中使用 Switch Joy-Cons 作为虚拟 Xbox 控制器

> 原文：<https://medium.com/hackernoon/xjoy-use-switch-joy-cons-as-a-virtual-xbox-controller-in-windows-pc-games-30c50b84ce4>

关于任天堂 Switch 配备的创新型可拆卸 Joy-Con 控制器，人们已经说了很多。好了，现在有了我的 XJoy 实用程序，你可以使用这些令人愉快的蓝牙设备作为你最喜欢的支持 Xbox 控制器输入的 PC 游戏的输入。

![](img/1035b3fb9d06a518ff95d595d0c5d896.png)

[访问 XJoy 项目了解更多信息](https://github.com/sam0x17/XJoy)

# 快乐骗局的可及性

这个项目最初源于我丈夫神经受损的手腕——电脑游戏鼠标，甚至人体工程学鼠标都让他的手腕承受了太多压力。他在 Xbox 和 PS4 控制器上也有过同样糟糕的经历，因为他的大部分压力来自于双手过于靠近。因此，令我丈夫非常沮丧的是，当他的病情恶化时，他不能玩任何电脑或游戏机游戏——也就是说，直到他的任天堂 Switch 到来。

这个转变改变了我丈夫的一切。因为这两个玩具可以分开，以休息的姿势放在他的左右手中，他又可以玩游戏了，而且一玩就是几个小时！

尽管如此，他仍然希望能够玩他的旧 PC 游戏，因为 Switch 上可用的游戏(和流派)数量(与任何基于任天堂的平台一样)非常有限，而且他的 Steam 库中有数百款游戏。因此，我开始了我的探索，把我丈夫的快乐游戏输入映射到他可以用来玩电脑游戏的东西上。

# 单干——XJoy 起源

起初，我尝试将 [joycon-driver](https://github.com/mfosse/JoyCon-Driver) 项目与 [VJoy](http://vjoystick.sourceforge.net/site/) 结合使用。这在一些游戏中工作得很好，比如《星谷》,但是这个配置非常不稳定，而且只在某些游戏中有效。特别是在 BeamNG 完全不行，那是我老公无聊的时候必玩的围棋游戏，于是就出了这个解决方案。这个阶段也是由 Steam 中编辑控制器窗口的一些特定于 Steam 的错误所主导的。

接下来，我变得固执起来，并决定完全绕过这整个控制器仿真的废话，编写自己的跨平台 Node.js 程序，该程序使用 HID 库和 robotjs 来读取 Joy-Con 输入，并将其转换为鼠标和键盘。通过实验，我能够通过观察数字来找出 HID 数据的哪些部分做了什么，最终我能够绘制出两个 Joy-Cons 的所有控件(这比简单地查找每个按钮的值有趣得多)。

这在一开始工作得非常好，但是像《无人的天空》这样的游戏，几乎每个菜单和游戏中的每个交互都有不同的控制器映射，我不得不开始在程序将进入的自定义“模式”中编码，其中控制器到键盘加鼠标的映射会基于任何数量的因素而改变。当有些模式不使用热键就无法激活时(因为它们依赖于游戏中的某些东西的存在，而我不分析屏幕截图是无法检测到的)，这一切都土崩瓦解了。我估计要完全覆盖无人天空中的所有功能，我需要超过 45 种模式，所以我很快放弃了这种方法。尽管如此，在 Linux、Windows 和 OSX 上使用 Joy-Con 模拟棒控制鼠标是非常酷的，我肯定会在未来的项目中做一些事情，只是不是以游戏为主的方式。

# 可行的解决方案

在做了更多的研究后，我偶然发现了 [ViGEm](https://vigem.org/) ，这是一个用 C++编写的非常好的、维护良好的虚拟 Xbox 360(和 DS4)Windows 控制器库。发现这一点后，我移植了所有的 Joy-Con 解析代码，以便在 windows C++中使用 HIDApi 和 ViGEm。那起了作用。我能够将每个 Joy-Con 按钮翻译成虚拟 Xbox 控制器上的东西。

我遇到的一个困难是我很晚才意识到我需要多线程化程序，因为左右两边的 Joy-Cons 需要单独的线程来正确地维护它们的 HID-read 循环。一旦我将所有的东西都改装成可以在两个线程上运行(并且添加了互斥锁之后)，所有的东西都完美地工作了——我可以用我的游戏控制任意的 PC 游戏了！